<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>JWT漏洞学习 | Sherlock</title><meta name="keywords" content="智商不够,勤勉来凑;眼神不太好"><meta name="author" content="Sherlock"><meta name="copyright" content="Sherlock"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="JWT漏洞学习"><meta name="application-name" content="JWT漏洞学习"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="JWT漏洞学习"><meta property="og:url" content="http://example.com/2024/10/08/JWT%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/index.html"><meta property="og:site_name" content="Sherlock"><meta property="og:description" content="借鉴JWT渗透姿势  JWT（JSON Web Token）是一种无状态认证机制，通过将用户身份和权限信息存储在令牌中，实现安全地在网络应用间传递信息。它具有跨域支持、扩展性和灵活性、安全性以及可扩展的验证方式等特点，成为现代应用开发中重要的认证和授权解决方案。 JWT的组成JWT的结构由三部分组成"><meta property="og:locale" content="en"><meta property="og:image" content="http://example.com/img/Sherlock.jpg"><meta property="article:author" content="Sherlock"><meta property="article:tag" content="智商不够,勤勉来凑;眼神不太好"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/Sherlock.jpg"><meta name="description" content="借鉴JWT渗透姿势  JWT（JSON Web Token）是一种无状态认证机制，通过将用户身份和权限信息存储在令牌中，实现安全地在网络应用间传递信息。它具有跨域支持、扩展性和灵活性、安全性以及可扩展的验证方式等特点，成为现代应用开发中重要的认证和授权解决方案。 JWT的组成JWT的结构由三部分组成"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/10/08/JWT%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🔍 分享与热心帮助","🤝 喜欢团结协作","🏃 脚踏实地行动派","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: Sherlock","link":"Link: ","source":"Source: Sherlock","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Sherlock',
  title: 'JWT漏洞学习',
  postAI: '',
  pageFillDescription: '借鉴, JWT的组成, Header 部分, Payload 部分, Signature 部分, 完整的JWT, JWT名词, 解密平台, 工作原理, JWT 基础安全问题（bp靶场）, 1、未对签名进行验证, 2、未对加密算法进行强验证, 3、弱密钥, JWT标头注入, 1、通过jwk参数注入自签名的JWT, 漏洞工作原理, 攻击过程, 题目, 2、通过jku参数注入自签名的JWT, 漏洞成因, 题目, 3、通过 kid 注入 JWT与目录遍历攻击相结合, 攻击原理, 攻击流程, 题目, JWT算法混淆, 1、对称加密与非对称加密, 2、算法混淆漏洞产生的原因, 3、执行算法混淆攻击的步骤, 4、通过算法混淆（泄露了密钥）绕过 JWT 身份验证, 5、通过算法混淆（不暴露密钥）绕过 JWT 身份验证借鉴渗透姿势是一种无状态认证机制通过将用户身份和权限信息存储在令牌中实现安全地在网络应用间传递信息它具有跨域支持扩展性和灵活性安全性以及可扩展的验证方式等特点成为现代应用开发中重要的认证和授权解决方案的组成的结构由三部分组成分别是和下面是每一部分的详细介绍和示例部分在中部分存储的是类型和加密算法通常使用对象表示并使用编码其中包含两个字段和指定了使用的加密算法常见的有和等算法指定了的类型通常为下面是一个示例部分包含了的主要信息通常使用对象表示并使用编码中包含三个类型的字段注册声明公共声明和私有声明公共声明是自定义的字段用于传递非敏感信息例如用户角色等私有声明是自定义的字段用于传递敏感信息例如密码信用卡号等注册声明预定义的标准字段包含了一些的元数据信息例如发行者过期时间等下面是一个示例其中表示主题表示名称表示的签发时间部分是使用指定算法对和进行签名生成的用于验证的完整性和真实性的生成方式通常是将和连接起来然后使用指定算法对其进行签名最终将签名结果与和一起组成的生成和验证需要使用相同的密钥下面是一个示例其中是使用算法进行签名和是经过编码的和是用于签名和验证的密钥最终将和连接起来用句点分隔就形成了一个完整的完整的第一部分是第二部分是第三部分是它们之间由三个分隔注意中的每一部分都是经过编码的但并不是加密的因此中的信息是可以被解密的下面是一个示例名词是指已签名的它由的和组成其中是使用密钥对和进行数字签名得到的通过验证签名可以确保的完整性和真实性是指用于的密钥它可以是对称加密密钥例如密码也可以是非对称加密密钥例如公钥私钥对用于生成和验证的签名确保只有拥有正确密钥的一方能够对进行操作是指经过加密的它是在基础上进行了进一步的加密将的部分加密后得到的结果可用于保护敏感信息确保只有授权的接收方能够解密和读取的内容是中的一个字段该字段包含一个用于指定用于验证令牌密钥的服务器当需要获取公钥或密钥集合时可以使用字段指定的来获取相关的信息是中的一个字段它是一个指向一组公钥证书类似于字段用于指定可用于验证的公钥证书的位置标准是一种密码学标准定义了公共密钥基础设施中的数字证书格式这些证书包含有关实体例如个人组织或设备的信息以及相关的公钥和数字签名证书在许多互联网协议中广泛使用如等解密平台下面是一个在线构造和解构的平台工作原理的工作流程如下用户在客户端登录并将登录信息发送给服务器服务器使用私钥对用户信息进行加密生成并将其发送给客户端客户端将存储在本地每次向服务器发送请求时携带进行认证服务器使用公钥对进行解密和验证根据中的信息进行身份验证和授权服务器处理请求并返回响应客户端根据响应进行相应的操作基础安全问题靶场未对签名进行验证库会通常提供一种验证令牌的方法和一种解码令牌的方法比如库有和有时开发人员会混淆这两种方法只将传入的令牌传递给方法这意味着应用程序根本不验证签名下边我们通过靶场来演示一下这个漏洞案例要求此实验室使用基于的机制来处理会话由于实现缺陷服务器不会验证它收到的任何的签名要解决该实验请修改您的会话令牌以访问上的管理面板然后删除用户您可以使用以下凭证登录自己的帐户首先我们先登录题目提供的账号然后去的历史记录里面查看相关条目可以发现在我们登陆的时候响应包设置了一个值观察其结构可以发现是形式的其部分选中即可查看在该条目下可以发现我们登录成功的凭证是值根据题目提示可以知道该题只有解码没有验证所以我们可以直接修改部分实现身份变更访问回显提示需要身份才可以访问将条目发送至在请求面板中转到选项卡注意该选项卡需要提前安装插件将其中的值改为复制值在处进行替换便可以成功访问删除用户题目解决未对加密算法进行强验证在的中的值用于告诉服务器使用哪种算法对令牌进行签名从而告诉服务器在验证签名时需要使用哪种算法同时也支持将算法设定为如果字段设为则标识不签名后面签名部分可以直接删去这样一来任何都是有效的设定该功能的最初目的是为了方便调试但是若不在生产环境中关闭该功能攻击者可以通过将字段设置为来伪造他们想要的任何接着便可以使用伪造的冒充任意用户登陆网站下面为靶场中的一个漏洞案例此实验室使用基于的机制来处理会话服务器被不安全地配置为接受未签名的要解决该实验请修改您的会话令牌以访问上的管理面板然后删除用户您可以使用以下凭证登录自己的帐户开启题目环境登录账号后按照上一题进行操作结果会失败回显表明该题有开启验证方法将部分的值改为后同时将签名部分删去要保留部分的点更改值并访问成功如下然后便可以删去用户解决题目弱密钥如果使用了不安全的算法如弱哈希算法或者算法参数如密钥长度不足够强攻击者可以通过暴力破解碰撞攻击或其他密码学攻击来伪造有效的下面为靶场中的一个漏洞案例要解决实验室问题请先暴力破解网站的密钥获得此令牌后使用它对修改后的会话令牌进行签名该令牌允许您访问的管理面板然后删除用户您可以使用以下凭证登录自己的帐户前面两种方法都不起作用所以开始尝试爆破密钥字典我们使用来爆破使用教程首先登录拿到账号的然后将该拿去爆破结果如下可以看到结果中表明就是该的密钥拿到解密平台中去伪造一个我们所需的要记得值要为管理员的身份然后拿着伪造的去访问成功访问删除要求用户便可以题目解决标头注入通过参数注入自签名的通过参数注入自签名的漏洞是一种利用不安全的处理方式来伪造有效身份的攻击手法这个漏洞主要是由于不安全地处理和解析的公钥特别是当服务器允许用户通过提供自定义的时攻击者可以利用该漏洞来伪造合法的签名从而冒充其他用户或提升权限漏洞工作原理通常用于在客户端和服务器之间安全地传输身份信息的安全性依赖于正确的签名和验证过程以下是漏洞的关键点签名与验证机制可以使用对称算法如或非对称算法如来进行签名在非对称算法中如签名是通过私钥生成的而验证则使用公钥是一种用于表示密钥的标准化格式头部中可以包含一个字段表示公钥的相关信息当服务器在验证时如果发现中包含参数它会尝试从中解析出公钥并用该公钥来验证的签名参数注入的攻击思路服务器如果允许用户通过的头部传递自定义的并没有严格验证这个公钥的来源或合法性那么攻击者可以利用这一点注入自己的公钥来生成和验证伪造的签名攻击者首先生成一对私钥公钥使用自己的私钥对进行签名然后在的头部包含攻击者的公钥信息由于服务器错误地信任了中的参数它会用攻击者提供的公钥验证攻击者的伪造签名从而认为是合法的攻击过程生成攻击者的密钥对攻击者首先生成一对非对称密钥对私钥和公钥用于伪造伪造攻击者用自己的私钥签名一个自定义的可以修改载荷中的敏感数据例如提升权限在头部的参数中攻击者包含自己的公钥用于让服务器在验证时错误地接受这个伪造的公钥头部示例发送伪造的攻击者将伪造的发送给服务器服务器错误地使用中的攻击者公钥来验证签名绕过签名验证由于服务器使用攻击者的公钥验证通过攻击者成功伪造了一个合法的从而绕过身份验证或权限控制题目了解了原理之后靶场中的题目便可以轻松解决了要求此实验室使用基于的机制来处理会话服务器支持标头中的参数这有时用于将正确的验证密钥直接嵌入到令牌中但是它无法检查提供的密钥是否来自受信任的来源要解决实验问题请修改并签署一个该允许您访问的管理面板然后删除用户您可以使用以下凭证登录自己的帐户首先登录账号利用获取到利用中的插件生成一个新的密钥将我们所需的条目只要有值得都可以放入重放器中选项选择值要改为刚生成的密钥值要改为管理员首先点击攻击选择第一个后将我们刚刚生成的密钥导入进去最后将新生成的复制即可回到谷歌利用插件将我们的值进行更改保存访问删去用户题目解决通过参数注入自签名的漏洞成因信任外部源在一些情况下服务器允许客户端通过参数提供一个服务器会从这个获取公钥来验证的签名如果服务器没有对参数中的进行严格限制或校验攻击者可以将该指向他们控制的服务器从而提供一个伪造的公钥自签名攻击者可以生成一个合法格式的并使用自己的私钥进行签名随后他们将指向自己控制的服务器该服务器会返回与其私钥对应的公钥由于服务器信任提供的公钥因此会错误地验证攻击者签名的绕过签名验证通过操控参数攻击者可以伪造一个有效的服务器由于使用了错误的公钥验证签名认为该是合法的这可能导致攻击者获得提升的权限或未授权的访问题目要求此实验室使用基于的机制来处理会话服务器支持标头中的参数但是在获取密钥之前它无法检查提供的是否属于受信任的域要解决实验问题请伪造一个让您能够访问的管理面板然后删除用户您可以使用以下凭证登录自己的帐户首先登陆账号获取到我们所需的因为接受参数所以我们就需要伪造一个首先复制公钥将其拿到题目提供的服务器中去要记住再粘贴之前需要加上头如下复制漏洞服务器的地址回到中我们需要修改和值添加键值对更改结束后点击要选对模式然后将新生成的复制后拿去替换掉原来的值进入删去用户题目解决通过注入与目录遍历攻击相结合在验证机制中是头部字段的一部分通常用于指示服务器应使用哪个密钥来验证的签名然而如果服务器处理时没有适当的输入验证攻击者可以利用注入与目录遍历攻击相结合绕过的签名验证或滥用服务器的密钥管理逻辑导致未授权访问或权限提升当使用的是对称加密算法的时候极有可能存在目录遍历的漏洞我们能够强制服务器使用其文件系统中的任意文件作为验证密钥攻击原理的头部示例的作用在头部中参数用于指示服务器应使用哪个密钥或密钥文件来验证签名例如服务器从预定义的路径中加载对应的密钥如如果攻击者可以操控的值并且服务器在读取密钥时存在文件路径拼接问题攻击者就可以通过目录遍历访问到敏感文件目录遍历攻击如果服务器使用以下代码来加载密钥没有过滤或处理路径输入当攻击者将设置为时拼接后的路径变为经过目录遍历后实际读取到的文件路径是这就导致服务器读取了不应访问的系统文件并将该内容作为密钥进行验证结合签名绕过在某些情况下服务器会将文件的内容如当作的密钥来验证签名攻击者可以提前生成一个以内容作为密钥的签名并通过这种方式欺骗服务器完成签名验证从而绕过认证攻击流程攻击者生成一个伪造头部中的字段为使用内容作为密钥生成签名将伪造的发送给服务器服务器根据的值读取并使用其内容验证签名签名验证通过攻击者成功伪造获得未授权的访问题目接下来我们来看靶场中的一道题要求此实验室使用基于的机制来处理会话为了验证签名服务器使用标头中的参数从其文件系统中获取相关密钥要解决实验问题请伪造一个让您能够访问的管理面板然后删除用户您可以使用以下凭证登录自己的帐户从获取到的中我们可以看到该题使用的是对称密码加密所以我们来到插件生成一个也就是对称密钥并将的值修改为编码的字节接着我们去修改将的值修改为该文件默认为空文件修改完后点击密钥要选择刚刚生成的对称密钥以及选择第一个选项将生成的复制下来拿去更改我们的值后访问删去用户解决题目算法混淆对称加密与非对称加密可以使用一系列不同的算法对进行签名其中一些如使用对称密钥这意味着服务器使用单个密钥对进行签名和验证显然这需要保密就像密码一样其他算法例如使用非对称密钥对它由服务器用来签署令牌的私钥和可用于验证签名的数学相关的公钥组成顾名思义私钥必须保密但公钥通常是共享的以便任何人都可以验证服务器颁发的令牌的签名算法混淆漏洞产生的原因算法混乱漏洞通常是由于库的实现有缺陷而引起的尽管实际的验证过程因所使用的算法而异但许多库提供了一种与算法无关的单一方法来验证签名这些方法依赖于令牌标头中的参数来确定它们应执行的验证类型以下伪代码显示了此泛型方法的声明在库中的简化示例当随后使用此方法的网站开发人员假设它将专门处理使用等非对称算法签名的时就会出现问题由于这个有缺陷的假设他们可能总是将固定的公钥传递给该方法如下所示在这种情况下如果服务器收到使用等对称算法签名的令牌则库的通用方法会将公钥视为密钥这意味着攻击者可以使用和公钥对令牌进行签名并且服务器将使用相同的公钥来验证签名上边是抄官方的话下边我们用大白话来解释一下假设开发使用的是这非对称加密算法生成的由于信息泄露等原因攻击者可以拿到这个公钥因为上边说过公钥通常是共享的攻击者使用算法伪造一个用这个公钥作为签名的密钥程序会使用这个方法来验证有没有被篡改但是这个库设计的有问题问题他是通过你头中来判断是使用那种算法来进行签名的所以我们可以篡改他的算法这块就会使用生成的公钥作为的秘钥来验证攻击者伪造的这个公钥攻击者可控所以伪造的就会通过验证执行算法混淆攻击的步骤获取服务器的公钥将公钥转换为合适的格式创建一个恶意其负载经过修改标头设置为使用公钥作为秘密使用对令牌进行签名通过算法混淆泄露了密钥绕过身份验证来看看靶场中的题目要求此实验室使用基于的机制来处理会话它使用强大的密钥对对令牌进行签名和验证但是由于实现缺陷此机制容易受到算法混淆攻击要解决该实验问题请首先获取服务器的公钥这是通过标准端点公开的使用此密钥对修改后的会话令牌进行签名该令牌允许您访问的管理面板然后删除用户您可以使用以下凭证登录自己的帐户提示可以假设服务器将其公钥存储为文件服务器有时会通过映射到或的标准端点将其公有密钥作为密钥对象公开这些可以存储在称为的数组中这称为集所以我们尝试访问获取到如下内容将其中的部分复制下来转到的中新生成一个密钥将复制的内容粘贴进去点击生成后右键选中最后一行空行不要删掉将该部分内容拿去编码后把便编码结果复制起来如下生成一个对称加密的把替换成我们刚修改完格式的公钥接着去修改我们的值修改值值签名选择我们刚刚生成的对称密钥将新生成的拿去替换成功访问题目解决通过算法混淆不暴露密钥绕过身份验证',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-10-14 20:38:13',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/Sherlock.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Sherlock</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/essay/"><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> Search</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/cors/" style="font-size: 1.05rem;">cors<sup>1</sup></a><a href="/tags/csrf/" style="font-size: 1.05rem;">csrf<sup>1</sup></a><a href="/tags/php/" style="font-size: 1.05rem;">php<sup>5</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>3</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>3</sup></a><a href="/tags/ssrf/" style="font-size: 1.05rem;">ssrf<sup>1</sup></a><a href="/tags/ssti/" style="font-size: 1.05rem;">ssti<sup>2</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>3</sup></a><a href="/tags/xss/" style="font-size: 1.05rem;">xss<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 1.05rem;">前端<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">December 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">November 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">October 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">September 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">June 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">May 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a></span><span class="article-meta tags"></span></div></div><h1 class="post-title" itemprop="name headline">JWT漏洞学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-10-08T11:28:17.000Z" title="Created 2024-10-08 19:28:17">2024-10-08</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-10-14T12:38:13.883Z" title="Updated 2024-10-14 20:38:13">2024-10-14</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为福建"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>福建</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/10/08/JWT%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"><header><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a><h1 id="CrawlerTitle" itemprop="name headline">JWT漏洞学习</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Sherlock</span><time itemprop="dateCreated datePublished" datetime="2024-10-08T11:28:17.000Z" title="Created 2024-10-08 19:28:17">2024-10-08</time><time itemprop="dateCreated datePublished" datetime="2024-10-14T12:38:13.883Z" title="Updated 2024-10-14 20:38:13">2024-10-14</time></header><h1 id="借鉴"><a href="#借鉴" class="headerlink" title="借鉴"></a>借鉴</h1><p><a target="_blank" rel="noopener" href="https://forum.butian.net/share/2734">JWT渗透姿势</a></p>
<hr>
<p>JWT（JSON Web Token）是一种无状态认证机制，通过将用户身份和权限信息存储在令牌中，实现安全地在网络应用间传递信息。它具有跨域支持、扩展性和灵活性、安全性以及可扩展的验证方式等特点，成为现代应用开发中重要的认证和授权解决方案。</p>
<h1 id="JWT的组成"><a href="#JWT的组成" class="headerlink" title="JWT的组成"></a>JWT的组成</h1><p>JWT的结构由三部分组成，分别是Header、Payload和Signature，下面是每一部分的详细介绍和示例：</p>
<h2 id="Header-部分"><a href="#Header-部分" class="headerlink" title="Header 部分"></a>Header 部分</h2><p>在 JWT 中 Header 部分存储的是 Token 类型和加密算法，通常使用JSON对象表示并使用Base64编码，其中包含两个字段：alg和typ</p>
<ul>
<li>alg(algorithm)：指定了使用的加密算法，常见的有HMAC、RSA和ECDSA等算法</li>
<li>typ(type)：指定了JWT的类型，通常为JWT</li>
</ul>
<p>下面是一个示例Header：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="Payload-部分"><a href="#Payload-部分" class="headerlink" title="Payload 部分"></a>Payload 部分</h2><p>Payload包含了JWT的主要信息，通常使用JSON对象表示并使用Base64编码，Payload中包含三个类型的字段：注册声明、公共声明和私有声明</p>
<ul>
<li>公共声明：是自定义的字段，用于传递非敏感信息，例如:用户ID、角色等</li>
<li>私有声明：是自定义的字段，用于传递敏感信息，例如密码、信用卡号等</li>
<li>注册声明：预定义的标准字段，包含了一些JWT的元数据信息，例如:发行者、过期时间等</li>
</ul>
<p>下面是一个示例Payload：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;sub&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1234567890&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;John Doe&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;iat&quot;</span><span class="punctuation">:</span> <span class="number">1516239022</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>其中sub表示主题，name表示名称，iat表示JWT的签发时间</p>
<h2 id="Signature-部分"><a href="#Signature-部分" class="headerlink" title="Signature 部分"></a>Signature 部分</h2><p>Signature是使用指定算法对Header和Payload进行签名生成的，用于验证JWT的完整性和真实性</p>
<ul>
<li>Signature的生成方式通常是将Header和Payload连接起来然后使用指定算法对其进行签名，最终将签名结果与Header和Payload一起组成JWT</li>
<li>Signature的生成和验证需要使用相同的密钥</li>
</ul>
<p>下面是一个示例Signature</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">HMACSHA256</span>(<span class="title function_ invoke__">base64UrlEncode</span>(header) + <span class="string">&quot;.&quot;</span> +<span class="title function_ invoke__">base64UrlEncode</span>(payload),secret)</span><br></pre></td></tr></table></figure>

<p>其中HMACSHA256是使用HMAC SHA256算法进行签名，header和payload是经过Base64编码的Header和Payload，secret是用于签名和验证的密钥，最终将Header、Payload和Signature连接起来用句点(.)分隔就形成了一个完整的JWT</p>
<h2 id="完整的JWT"><a href="#完整的JWT" class="headerlink" title="完整的JWT"></a>完整的JWT</h2><p>第一部分是Header，第二部分是Payload，第三部分是Signature，它们之间由三个 <code>.</code> 分隔，注意JWT 中的每一部分都是经过Base64编码的，但并不是加密的，因此JWT中的信息是可以被解密的</p>
<p>下面是一个示例JWT</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span><br></pre></td></tr></table></figure>

<h1 id="JWT名词"><a href="#JWT名词" class="headerlink" title="JWT名词"></a>JWT名词</h1><ol>
<li>JWS（Signed JWT）：JWS是指已签名的JWT。它由JWT的Header、Payload和Signature组成，其中Signature是使用密钥对Header和Payload进行数字签名得到的。通过验证签名，可以确保JWT的完整性和真实性。</li>
<li>JWK（JSON Web Key）：JWK是指用于JWT的密钥。它可以是对称加密密钥（例如密码），也可以是非对称加密密钥（例如公钥&#x2F;私钥对）。JWK用于生成和验证JWT的签名，确保只有拥有正确密钥的一方能够对JWT进行操作。</li>
<li>JWE（Encrypted JWT）：JWE是指经过加密的JWT。它是在JWS基础上进行了进一步的加密，将JWT的Payload部分加密后得到的结果。JWE可用于保护敏感信息，确保只有授权的接收方能够解密和读取JWT的内容。</li>
<li>JKU（JSON Web Key Set URL）：JKU是JWT Header中的一个字段，该字段包含一个URI，用于指定用于验证令牌密钥的服务器。当需要获取公钥或密钥集合时，可以使用JKU字段指定的URI来获取相关的JWK信息。</li>
<li>X5U：X5U是JWT Header中的一个字段，它是一个URL，指向一组X.509公钥证书。类似于JKU，X5U字段用于指定可用于验证JWT的公钥证书的位置。</li>
<li>X.509标准：X.509是一种密码学标准，定义了公共密钥基础设施（PKI）中的数字证书格式。这些证书包含有关实体（例如个人、组织或设备）的信息，以及相关的公钥和数字签名。X.509证书在许多互联网协议中广泛使用，如TLS&#x2F;SSL等。</li>
</ol>
<h1 id="解密平台"><a href="#解密平台" class="headerlink" title="解密平台"></a>解密平台</h1><p>下面是一个JWT在线构造和解构的平台：</p>
<p><a target="_blank" rel="noopener" href="https://jwt.io/">https://jwt.io/</a></p>
<h1 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h1><p>JWT的工作流程如下：</p>
<ul>
<li>用户在客户端登录并将登录信息发送给服务器</li>
<li>服务器使用私钥对用户信息进行加密生成JWT并将其发送给客户端</li>
<li>客户端将JWT存储在本地，每次向服务器发送请求时携带JWT进行认证</li>
<li>服务器使用公钥对JWT进行解密和验证，根据JWT中的信息进行身份验证和授权</li>
<li>服务器处理请求并返回响应，客户端根据响应进行相应的操作</li>
</ul>
<h1 id="JWT-基础安全问题（bp靶场）"><a href="#JWT-基础安全问题（bp靶场）" class="headerlink" title="JWT 基础安全问题（bp靶场）"></a>JWT 基础安全问题（bp靶场）</h1><h2 id="1、未对签名进行验证"><a href="#1、未对签名进行验证" class="headerlink" title="1、未对签名进行验证"></a>1、未对签名进行验证</h2><p>JWT库会通常提供一种验证令牌的方法和一种解码令牌的方法，比如:Node.js库jsonwebtoken有verify()和decode()，有时开发人员会混淆这两种方法，只将传入的令牌传递给decode()方法，这意味着应用程序根本不验证签名</p>
<p>下边我们通过portswigger靶场来演示一下这个漏洞案例：</p>
<p><strong>要求</strong>：此实验室使用基于 JWT 的机制来处理会话。由于实现缺陷，服务器不会验证它收到的任何 JWT 的签名。<br>要解决该实验，请修改您的会话令牌以访问 <code>/admin</code> 上的管理面板，然后删除用户 <code>carlos</code>。<br>您可以使用以下凭证登录自己的帐户：<code>wiener：peter</code></p>
<hr>
<p>首先我们先登录题目提供的账号wiener，然后去bp的HTTP历史记录里面查看相关条目</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241010152114542.png" alt="image-20241010152114542"></p>
<p>可以发现在我们登陆的时候响应包设置了一个seesion值，观察其结构可以发现是JWT形式的，其payload部分选中即可查看</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241010152303186.png" alt="image-20241010152303186"></p>
<p>在该条目下可以发现我们登录成功的凭证是session值，根据题目提示可以知道该题只有解码，没有验证，所以我们可以直接修改payload部分实现身份变更</p>
<p>访问&#x2F;admin，回显提示需要administrator身份才可以访问</p>
<p>将条目&#x2F;my-account?id&#x3D;wiener发送至repeater，在请求面板中，转到 <strong>JSON Web Token</strong> 选项卡（注意该选项卡需要提前安装插件JWT Editor）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241010153000287.png" alt="image-20241010153000287"></p>
<p>将其中的sub值改为administrator，复制JWT值，在session处进行替换，便可以成功访问&#x2F;admin，删除用户carlos，题目解决</p>
<h2 id="2、未对加密算法进行强验证"><a href="#2、未对加密算法进行强验证" class="headerlink" title="2、未对加密算法进行强验证"></a>2、未对加密算法进行强验证</h2><p>在JWT的Header中alg的值用于告诉服务器使用哪种算法对令牌进行签名，从而告诉服务器在验证签名时需要使用哪种算法，JWT同时也支持将算法设定为”None”，如果”alg”字段设为”None”，则标识不签名（后面签名部分可以直接删去），这样一来任何token都是有效的，设定该功能的最初目的是为了方便调试，但是若不在生产环境中关闭该功能，攻击者可以通过将alg字段设置为”None”来伪造他们想要的任何token，接着便可以使用伪造的token冒充任意用户登陆网站</p>
<p>下面为portswigger靶场中的一个漏洞案例：</p>
<p>此实验室使用基于 JWT 的机制来处理会话。服务器被不安全地配置为接受未签名的 JWT。<br>要解决该实验，请修改您的会话令牌以访问 <code>/admin</code> 上的管理面板，然后删除用户 <code>carlos</code>。<br>您可以使用以下凭证登录自己的帐户：<code>wiener：peter</code></p>
<hr>
<p>开启题目环境，登录账号后按照上一题进行操作，结果会失败，回显表明该题有开启验证方法</p>
<p>将header部分alg的值改为none后，同时将签名部分删去，要保留payload部分的点</p>
<p>更改session值并访问&#x2F;admin，成功如下</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241010160322492.png" alt="image-20241010160322492"></p>
<p>然后便可以删去用户carlos，解决题目</p>
<h2 id="3、弱密钥"><a href="#3、弱密钥" class="headerlink" title="3、弱密钥"></a>3、弱密钥</h2><p>如果使用了不安全的算法（如弱 HMAC 哈希算法），或者算法参数（如密钥长度）不足够强，攻击者可以通过暴力破解、碰撞攻击或其他密码学攻击来伪造有效的 JWT</p>
<p>下面为portswigger靶场中的一个漏洞案例：</p>
<p>要解决实验室问题，请先暴力破解网站的密钥。获得此令牌后，使用它对修改后的会话令牌进行签名，该令牌允许您访问 <code>/admin</code> 的管理面板，然后删除用户 <code>carlos</code>。<br>您可以使用以下凭证登录自己的帐户：<code>wiener：peter</code></p>
<hr>
<p>前面两种方法都不起作用，所以开始尝试爆破密钥</p>
<ul>
<li>JWT字典：<a target="_blank" rel="noopener" href="https://github.com/wallarm/jwt-secrets">https://github.com/wallarm/jwt-secrets</a></li>
<li>我们使用<code>jwt_tool</code>来爆破JWT：<a target="_blank" rel="noopener" href="https://github.com/ticarpi/jwt_tool">https://github.com/ticarpi/jwt_tool</a></li>
<li>使用教程：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/xiaozi/p/12005929.html">https://www.cnblogs.com/xiaozi/p/12005929.html</a></li>
</ul>
<p>首先登录拿到账号的jwt，然后将该jwt拿去爆破，结果如下：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241010203738399.png" alt="image-20241010203738399"></p>
<p>可以看到结果中表明secret1就是该jwt的密钥</p>
<p>拿到解密平台中去伪造一个我们所需的jwt</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241010203912720.png" alt="image-20241010203912720"></p>
<p>要记得sub值要为管理员的身份</p>
<p>然后拿着伪造的jwt去访问&#x2F;admin，成功访问，删除要求用户便可以，题目解决</p>
<h1 id="JWT标头注入"><a href="#JWT标头注入" class="headerlink" title="JWT标头注入"></a>JWT标头注入</h1><h2 id="1、通过jwk参数注入自签名的JWT"><a href="#1、通过jwk参数注入自签名的JWT" class="headerlink" title="1、通过jwk参数注入自签名的JWT"></a>1、通过jwk参数注入自签名的JWT</h2><p>通过 <strong>JWK（JSON Web Key）参数注入自签名 JWT</strong> 的漏洞是一种利用不安全的 JWT 处理方式来伪造有效身份的攻击手法。这个漏洞主要是由于不安全地处理和解析 JWT 的 <strong>公钥</strong>，特别是当服务器允许用户通过 JWT 提供自定义的 <strong>JWK</strong> 时，攻击者可以利用该漏洞来伪造合法的签名，从而冒充其他用户或提升权限。</p>
<h3 id="漏洞工作原理"><a href="#漏洞工作原理" class="headerlink" title="漏洞工作原理"></a>漏洞工作原理</h3><p>JWT 通常用于在客户端和服务器之间安全地传输身份信息。JWT 的安全性依赖于正确的签名和验证过程。以下是漏洞的关键点：</p>
<ol>
<li><strong>JWT 签名与验证机制</strong>：<ul>
<li>JWT 可以使用对称算法（如 <code>HS256</code>）或非对称算法（如 <code>RS256</code>）来进行签名。</li>
<li>在非对称算法中（如 <code>RS256</code>），签名是通过 <strong>私钥</strong> 生成的，而验证则使用 <strong>公钥</strong>。</li>
</ul>
</li>
<li>**JWK (JSON Web Key)**：<ul>
<li>JWK 是一种用于表示密钥的标准化格式。JWT 头部中可以包含一个 <code>jwk</code> 字段，表示公钥的相关信息。</li>
<li>当服务器在验证 JWT 时，如果发现 JWT 中包含 <code>jwk</code> 参数，它会尝试从中解析出公钥，并用该公钥来验证 JWT 的签名。</li>
</ul>
</li>
<li><strong>JWK 参数注入的攻击思路</strong>：<ul>
<li>服务器如果允许用户通过 JWT 的头部传递 <strong>自定义的 JWK</strong>，并没有严格验证这个公钥的来源或合法性，那么攻击者可以利用这一点，注入自己的公钥来生成和验证伪造的签名。</li>
<li>攻击者首先生成一对 <strong>私钥&#x2F;公钥</strong>，使用自己的私钥对 JWT 进行签名，然后在 JWT 的头部包含攻击者的公钥信息。由于服务器错误地信任了 JWT 中的 JWK 参数，它会用攻击者提供的公钥验证攻击者的伪造签名，从而认为 JWT 是合法的。</li>
</ul>
</li>
</ol>
<h3 id="攻击过程"><a href="#攻击过程" class="headerlink" title="攻击过程"></a>攻击过程</h3><ol>
<li><p><strong>生成攻击者的密钥对</strong>： 攻击者首先生成一对非对称密钥对（私钥和公钥），用于伪造 JWT。</p>
</li>
<li><p><strong>伪造 JWT</strong>：</p>
<ul>
<li>攻击者用自己的 <strong>私钥</strong> 签名一个自定义的 JWT（可以修改载荷中的敏感数据，例如提升权限）。</li>
<li>在 JWT 头部的 <code>jwk</code> 参数中，攻击者包含自己的 <strong>公钥</strong>，用于让服务器在验证时错误地接受这个伪造的公钥。</li>
</ul>
<p>JWT 头部示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;jwk&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;kty&quot;</span><span class="punctuation">:</span> <span class="string">&quot;RSA&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;n&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&lt;attacker&#x27;s public key modulus&gt;&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;e&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AQAB&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>发送伪造的 JWT</strong>： 攻击者将伪造的 JWT 发送给服务器，服务器错误地使用 JWT 中的攻击者公钥来验证签名。</p>
</li>
<li><p><strong>绕过签名验证</strong>： 由于服务器使用攻击者的公钥，验证通过，攻击者成功伪造了一个合法的 JWT，从而绕过身份验证或权限控制。</p>
</li>
</ol>
<h3 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h3><p>了解了原理之后，靶场中的题目便可以轻松解决了</p>
<p>要求：此实验室使用基于 JWT 的机制来处理会话。服务器支持 JWT 标头中的 <code>jwk</code> 参数。这有时用于将正确的验证密钥直接嵌入到令牌中。但是，它无法检查提供的密钥是否来自受信任的来源。<br>要解决实验问题，请修改并签署一个 JWT，该 JWT 允许您访问 <code>/admin</code> 的管理面板，然后删除用户 <code>carlos</code>。<br>您可以使用以下凭证登录自己的帐户：<code>wiener：peter</code></p>
<p>首先登录账号，利用bp获取到jwt</p>
<p>利用bp中的插件JWT Editor生成一个新的RSA密钥</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241011105710075.png" alt="image-20241011105710075"></p>
<p>将我们所需的条目（只要有JWT值得都可以）放入重放器中，选项选择JSON Web Token</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241011110002632.png" alt="image-20241011110002632"></p>
<p>kid值要改为刚生成的密钥id，sub值要改为管理员</p>
<p>首先点击攻击，选择第一个后将我们刚刚生成的RSA密钥导入进去，最后将新生成的JWT复制即可</p>
<p>回到谷歌，利用插件Cookie Editor将我们的session值进行更改，保存</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241011110222168.png" alt="image-20241011110222168"></p>
<p>访问&#x2F;admin，删去用户carlos，题目解决</p>
<h2 id="2、通过jku参数注入自签名的JWT"><a href="#2、通过jku参数注入自签名的JWT" class="headerlink" title="2、通过jku参数注入自签名的JWT"></a>2、通过jku参数注入自签名的JWT</h2><h3 id="漏洞成因"><a href="#漏洞成因" class="headerlink" title="漏洞成因"></a>漏洞成因</h3><ol>
<li><strong>信任外部 <code>jku</code> 源</strong>：在一些情况下，服务器允许客户端通过 <code>jku</code> 参数提供一个 URL，服务器会从这个 URL 获取公钥来验证 JWT 的签名。如果服务器没有对 <code>jku</code> 参数中的 URL 进行严格限制或校验，攻击者可以将该 URL 指向他们控制的服务器，从而提供一个伪造的公钥。</li>
<li><strong>自签名 JWT</strong>：攻击者可以生成一个合法格式的 JWT，并使用自己的私钥进行签名。随后，他们将 <code>jku</code> 指向自己控制的服务器，该服务器会返回与其私钥对应的公钥。由于服务器信任 <code>jku</code> 提供的公钥，因此会错误地验证攻击者签名的 JWT。</li>
<li><strong>绕过签名验证</strong>：通过操控 <code>jku</code> 参数，攻击者可以伪造一个有效的 JWT，服务器由于使用了错误的公钥验证签名，认为该 JWT 是合法的。这可能导致攻击者获得提升的权限或未授权的访问。</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241011112137858.png" alt="image-20241011112137858"></p>
<h3 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h3><p>要求：此实验室使用基于 JWT 的机制来处理会话。服务器支持 JWT 标头中的 <code>jku</code> 参数。但是，在获取密钥之前，它无法检查提供的 URL 是否属于受信任的域。<br>要解决实验问题，请伪造一个 JWT，让您能够访问 <code>/admin</code> 的管理面板，然后删除用户 <code>carlos</code>。<br>您可以使用以下凭证登录自己的帐户：<code>wiener：peter</code></p>
<p>首先登陆账号，获取到我们所需的jwt</p>
<p>因为接受jku参数，所以我们就需要伪造一个</p>
<p>首先复制公钥，将其拿到题目提供的服务器中去</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241011113019785.png" alt="image-20241011113019785"></p>
<p>要记住再粘贴之前需要加上key头</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;keys&quot;: [</span><br><span class="line"></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241011113219558.png" alt="image-20241011113219558"></p>
<p>复制漏洞服务器的地址</p>
<p>回到bp中，我们需要修改kid和sub值，添加jku键值对</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241011113439659.png" alt="image-20241011113439659"></p>
<p>更改结束后，点击Sign，要选对模式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241011113528994.png" alt="image-20241011113528994"></p>
<p>然后i将新生成的jwt复制后拿去替换掉原来的jwt值，进入&#x2F;admin，删去用户carlos，题目解决</p>
<h2 id="3、通过-kid-注入-JWT，与目录遍历攻击相结合"><a href="#3、通过-kid-注入-JWT，与目录遍历攻击相结合" class="headerlink" title="3、通过 kid 注入 JWT，与目录遍历攻击相结合"></a>3、通过 kid 注入 JWT，与目录遍历攻击相结合</h2><p>在 JWT (JSON Web Token) 验证机制中，<code>kid</code>（Key ID）是 JWT 头部字段的一部分，通常用于指示服务器应使用哪个密钥来验证 JWT 的签名。然而，如果服务器处理 <code>kid</code> 时没有适当的输入验证，攻击者可以利用 <strong><code>kid</code> 注入</strong>与<strong>目录遍历攻击</strong>相结合，绕过 JWT 的签名验证或滥用服务器的密钥管理逻辑，导致未授权访问或权限提升。</p>
<p>当 JWT 使用的是对称加密算法的时候，极有可能存在目录遍历的漏洞，我们能够强制服务器使用其文件系统中的任意文件作为验证密钥</p>
<hr>
<h3 id="攻击原理"><a href="#攻击原理" class="headerlink" title="攻击原理"></a>攻击原理</h3><p>JWT 的头部示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;alg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HS256&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;typ&quot;</span><span class="punctuation">:</span> <span class="string">&quot;JWT&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;kid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../../etc/passwd&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong><code>kid</code> 的作用</strong>：</p>
<ul>
<li>在 JWT 头部中，<code>kid</code> 参数用于指示服务器应使用哪个密钥（或密钥文件）来验证签名。例如，服务器从预定义的路径中加载 <code>kid</code> 对应的密钥（如 <code>keys/&lt;kid&gt;.key</code>）。</li>
<li>如果攻击者可以操控 <code>kid</code> 的值，并且服务器在读取密钥时存在<strong>文件路径拼接</strong>问题，攻击者就可以通过目录遍历访问到敏感文件。</li>
</ul>
</li>
<li><p><strong>目录遍历攻击</strong>：</p>
<ul>
<li><p>如果服务器使用以下代码来加载密钥（没有过滤或处理路径输入）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$kid</span> = <span class="variable">$_JWT</span>[<span class="string">&#x27;header&#x27;</span>][<span class="string">&#x27;kid&#x27;</span>];</span><br><span class="line"><span class="variable">$key</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;/var/keys/&quot;</span> . <span class="variable">$kid</span> . <span class="string">&quot;.key&quot;</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>当攻击者将 <code>kid</code> 设置为 <code>../../etc/passwd</code> 时，拼接后的路径变为 <code>/var/keys/../../etc/passwd.key</code>，经过目录遍历后，实际读取到的文件路径是 <code>/etc/passwd</code>。</p>
</li>
<li><p>这就导致服务器读取了不应访问的系统文件，并将该内容作为密钥进行 JWT 验证。</p>
</li>
</ul>
</li>
<li><p><strong>结合签名绕过</strong>：</p>
<ul>
<li>在某些情况下，服务器会将文件的内容（如 <code>/etc/passwd</code>）当作 HMAC 的密钥来验证签名。攻击者可以提前生成一个以 <code>/etc/passwd</code> 内容作为密钥的 JWT 签名，并通过这种方式欺骗服务器完成签名验证，从而绕过认证。</li>
</ul>
</li>
</ol>
<hr>
<h3 id="攻击流程"><a href="#攻击流程" class="headerlink" title="攻击流程"></a>攻击流程</h3><ol>
<li>攻击者生成一个 JWT，伪造头部中的 <code>kid</code> 字段为 <code>../../etc/passwd</code>。</li>
<li>使用 <code>/etc/passwd</code> 内容作为 HMAC 密钥生成 JWT 签名。</li>
<li>将伪造的 JWT 发送给服务器。</li>
<li>服务器根据 <code>kid</code> 的值读取 <code>/etc/passwd</code>，并使用其内容验证签名。</li>
<li>签名验证通过，攻击者成功伪造 JWT，获得未授权的访问</li>
</ol>
<h3 id="题目-2"><a href="#题目-2" class="headerlink" title="题目"></a>题目</h3><p>接下来我们来看靶场中的一道题</p>
<p>要求：此实验室使用基于 JWT 的机制来处理会话。为了验证签名，服务器使用 JWT 标头中的 <code>kid</code> 参数从其文件系统中获取相关密钥。<br>要解决实验问题，请伪造一个 JWT，让您能够访问 <code>/admin</code> 的管理面板，然后删除用户 <code>carlos</code>。<br>您可以使用以下凭证登录自己的帐户：<code>wiener：peter</code></p>
<p>从获取到的JWT中我们可以看到该题使用的是对称密码加密</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241012210122949.png" alt="image-20241012210122949"></p>
<p>所以我们来到插件JWT Editor，生成一个 <strong>Symmetric Key</strong>，也就是对称密钥，并将 k 的值修改为<code>AA==</code>（base64编码的null字节）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241012210353154.png" alt="image-20241012210353154"></p>
<p>接着我们去修改JWT，将kid的值修改为<code>../../../../../dev/null</code>I（该文件默认为空文件）</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241012210605979.png" alt="image-20241012210605979"></p>
<p>修改完后，点击Sign，密钥要选择刚刚生成的对称密钥，以及选择第一个选项</p>
<p>将生成的JWT复制下来，拿去更改我们的session值，后访问&#x2F;admin，删去用户carlos，解决题目</p>
<h1 id="JWT算法混淆"><a href="#JWT算法混淆" class="headerlink" title="JWT算法混淆"></a>JWT算法混淆</h1><h2 id="1、对称加密与非对称加密"><a href="#1、对称加密与非对称加密" class="headerlink" title="1、对称加密与非对称加密"></a>1、对称加密与非对称加密</h2><p>可以使用一系列不同的算法对 JWT 进行签名。其中一些，如HS256（HMAC + SHA-256）使用“对称”密钥。这意味着服务器使用单个密钥对 Token 进行签名和验证。显然，这需要保密，就像密码一样。</p>
<p>其他算法，例如 RS256 (RSA + SHA-256) 使用“非对称”密钥对。它由服务器用来签署令牌的私钥和可用于验证签名的数学相关的公钥组成。</p>
<p>顾名思义，私钥必须保密，但公钥通常是共享的，以便任何人都可以验证服务器颁发的令牌的签名。</p>
<h2 id="2、算法混淆漏洞产生的原因"><a href="#2、算法混淆漏洞产生的原因" class="headerlink" title="2、算法混淆漏洞产生的原因"></a>2、算法混淆漏洞产生的原因</h2><p>算法混乱漏洞通常是由于 <code>JWT 库的实现有缺陷而引起</code>的。尽管实际的验证过程因所使用的算法而异，但许多库提供了一种与算法无关的单一方法来验证签名。这些方法依赖于<code>alg</code>令牌标头中的参数来确定它们应执行的验证类型。</p>
<p>以下伪代码显示了此泛型<code>verify()</code>方法的声明在 JWT 库中的简化示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">verify</span><span class="params">(token, secretOrPublicKey)</span>&#123; </span><br><span class="line">    algorithm = token.getAlgHeader(); </span><br><span class="line">    <span class="keyword">if</span>(algorithm == <span class="string">&quot;RS256&quot;</span>)</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment">// Use the provided key as an RSA public key </span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (algorithm == <span class="string">&quot;HS256&quot;</span>)</span><br><span class="line">    &#123; </span><br><span class="line">        <span class="comment">// Use the provided key as an HMAC secret key </span></span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当随后使用此方法的网站开发人员假设它将专门处理使用 RS256 等非对称算法签名的 JWT 时，就会出现问题。由于这个有缺陷的假设，他们可能总是将固定的公钥传递给该方法，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">publicKey = &lt;<span class="keyword">public</span>-key-of-server&gt;; </span><br><span class="line">token = request.getCookie(<span class="string">&quot;session&quot;</span>); </span><br><span class="line">verify(token, publicKey);</span><br></pre></td></tr></table></figure>

<p>在这种情况下，如果服务器收到使用 HS256 等对称算法签名的令牌，则库的通用<code>verify()</code>方法会将公钥视为 HMAC 密钥。这意味着攻击者可以使用 HS256 和公钥对令牌进行签名，并且服务器将使用相同的公钥来验证签名。</p>
<p>上边是抄官方的话，下边我们用大白话来解释一下：</p>
<ul>
<li>假设开发使用的是<code>RS256</code>这非对称加密算法生成的jwt。</li>
<li>由于信息泄露等原因攻击者可以拿到这个<code>公钥</code>，因为上边说过公钥通常是共享的</li>
<li>攻击者使用<code>HS256</code>算法伪造一个jwt，用这个<code>公钥</code>作为签名的密钥。</li>
</ul>
<p>程序会使用<code>verify()</code>这个方法来验证jwt有没有被篡改。但是这个库设计的有问题（问题：他是通过你jwt头中<code>alg</code>来判断是使用那种算法来进行签名的。所以我们可以篡改他的算法），这块就会使用<code>RS256</code>生成的公钥作为<code>HS256</code>的秘钥来验证攻击者伪造的jwt。这个公钥攻击者可控，所以伪造的jwt就会通过验证。</p>
<h2 id="3、执行算法混淆攻击的步骤"><a href="#3、执行算法混淆攻击的步骤" class="headerlink" title="3、执行算法混淆攻击的步骤"></a>3、执行算法混淆攻击的步骤</h2><ul>
<li><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/algorithm-confusion#step-1-obtain-the-server-s-public-key">获取服务器的公钥</a></li>
<li><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/algorithm-confusion#step-2-convert-the-public-key-to-a-suitable-format">将公钥转换为合适的格式</a></li>
<li><a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/algorithm-confusion#step-3-modify-your-jwt">创建一个恶意 JWT，</a>其负载经过修改，<code>alg</code>标头设置为<code>HS256</code>.</li>
<li>使用公钥作为秘密，使用 <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/jwt/algorithm-confusion#step-4-sign-the-jwt-using-the-public-key">HS256 对令牌进行签名。</a></li>
</ul>
<h2 id="4、通过算法混淆（泄露了密钥）绕过-JWT-身份验证"><a href="#4、通过算法混淆（泄露了密钥）绕过-JWT-身份验证" class="headerlink" title="4、通过算法混淆（泄露了密钥）绕过 JWT 身份验证"></a>4、通过算法混淆（泄露了密钥）绕过 JWT 身份验证</h2><p>来看看靶场中的题目</p>
<p>要求：此实验室使用基于 JWT 的机制来处理会话。它使用强大的 RSA 密钥对对令牌进行签名和验证。但是，由于实现缺陷，此机制容易受到算法混淆攻击。<br>要解决该实验问题，请首先获取服务器的公钥。这是通过标准端点公开的。使用此密钥对修改后的会话令牌进行签名，该令牌允许您访问 <code>/admin</code> 的管理面板，然后删除用户 <code>carlos</code>。<br>您可以使用以下凭证登录自己的帐户：<code>wiener：peter</code></p>
<p>提示：可以假设服务器将其公钥存储为 X.509 PEM 文件</p>
<hr>
<p>服务器有时会通过映射到 <code>/jwks.json</code> 或 <code>/.well-known/jwks.json</code> 的标准端点将其公有密钥作为 JSON Web 密钥 （JWK） 对象公开。这些可以存储在称为 <code>keys</code> 的 JWK 数组中。这称为 JWK 集。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;keys&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;kty&quot;: &quot;RSA&quot;,</span><br><span class="line">            &quot;e&quot;: &quot;AQAB&quot;,</span><br><span class="line">            &quot;kid&quot;: &quot;75d0ef47-af89-47a9-9061-7c02a610d5ab&quot;,</span><br><span class="line">            &quot;n&quot;: &quot;o-yy1wpYmffgXBxhAUJzHHocCuJolwDqql75ZWuCQ_cb33K2vh9mk6GPM9gNN4Y_qTVX67WhsN3JvaFYw-fhvsWQ&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;kty&quot;: &quot;RSA&quot;,</span><br><span class="line">            &quot;e&quot;: &quot;AQAB&quot;,</span><br><span class="line">            &quot;kid&quot;: &quot;d8fDFo-fS9-faS14a9-ASf99sa-7c1Ad5abA&quot;,</span><br><span class="line">            &quot;n&quot;: &quot;fc3f-yy1wpYmffgXBxhAUJzHql79gNNQ_cb33HocCuJolwDqmk6GPM4Y_qTVX67WhsN3JvaFYw-dfg6DH-asAScw&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以我们尝试访问&#x2F;jwks.json，获取到如下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;keys&quot;:[&#123;&quot;kty&quot;:&quot;RSA&quot;,&quot;e&quot;:&quot;AQAB&quot;,&quot;use&quot;:&quot;sig&quot;,&quot;kid&quot;:&quot;1c5caebf-7b98-464a-a532-f29489724191&quot;,&quot;alg&quot;:&quot;RS256&quot;,&quot;n&quot;:&quot;9cl7xLTPv-2lil8QK7FPE4yZR0evPLStVq9QgBHQyqQBsKBC1j6n3Av361kRrVyS3aZGycr0OzVdOgNNQalgHOevwgLEOY_t9BhTJdNe5x7hWiV4BKuI_RPupVTZetDHdtSBamY6fg5MHXbDQMF82dUYE_MJncIMWzUuz7UjIcGuf9fInDcaRZ8cvEEW_Q6em-xxIOTTHE1BK7fO_nNDHcggENAsR0CZCXLVzwZA8KvgPDYinhPDIZoN8AKL8kcJUhzJdERfT1TcQM7uajeItu55mHLE4V16lwzOxhXyLgAnBMPPjMUcXD_GCFilhT7fseceS8H__9EX7zEJgTT7lw&quot;&#125;]&#125;</span><br></pre></td></tr></table></figure>

<p>​	将其中的jwt部分复制下来，转到bp的JWT Editor中新生成一个RSA密钥，将复制的内容粘贴进去，点击生成后，右键选中”Copy Public Key as PEM”，<strong>最后一行空行不要删掉</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA9cl7xLTPv+2lil8QK7FP</span><br><span class="line">E4yZR0evPLStVq9QgBHQyqQBsKBC1j6n3Av361kRrVyS3aZGycr0OzVdOgNNQalg</span><br><span class="line">HOevwgLEOY/t9BhTJdNe5x7hWiV4BKuI/RPupVTZetDHdtSBamY6fg5MHXbDQMF8</span><br><span class="line">2dUYE/MJncIMWzUuz7UjIcGuf9fInDcaRZ8cvEEW/Q6em+xxIOTTHE1BK7fO/nND</span><br><span class="line">HcggENAsR0CZCXLVzwZA8KvgPDYinhPDIZoN8AKL8kcJUhzJdERfT1TcQM7uajeI</span><br><span class="line">tu55mHLE4V16lwzOxhXyLgAnBMPPjMUcXD/GCFilhT7fseceS8H//9EX7zEJgTT7</span><br><span class="line">lwIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将该部分内容拿去base64编码后把便编码结果复制起来，如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUE5Y2w3eExUUHYrMmxpbDhRSzdGUApFNHlaUjBldlBMU3RWcTlRZ0JIUXlxUUJzS0JDMWo2bjNBdjM2MWtSclZ5UzNhWkd5Y3IwT3pWZE9nTk5RYWxnCkhPZXZ3Z0xFT1kvdDlCaFRKZE5lNXg3aFdpVjRCS3VJL1JQdXBWVFpldERIZHRTQmFtWTZmZzVNSFhiRFFNRjgKMmRVWUUvTUpuY0lNV3pVdXo3VWpJY0d1ZjlmSW5EY2FSWjhjdkVFVy9RNmVtK3h4SU9UVEhFMUJLN2ZPL25ORApIY2dnRU5Bc1IwQ1pDWExWendaQThLdmdQRFlpbmhQRElab044QUtMOGtjSlVoekpkRVJmVDFUY1FNN3VhamVJCnR1NTVtSExFNFYxNmx3ek94aFh5TGdBbkJNUFBqTVVjWEQvR0NGaWxoVDdmc2VjZVM4SC8vOUVYN3pFSmdUVDcKbHdJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg==</span><br></pre></td></tr></table></figure>

<p>生成一个对称加密的key，把k替换成我们刚修改完格式的公钥</p>
<p>接着去修改我们的jwt值，修改alg值，sub值，签名选择我们刚刚生成的对称密钥</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../source/imgs/$%7Bfiilname%7D/image-20241013205410135.png" alt="image-20241013205410135"></p>
<p>将新生成的jwt拿去替换，成功访问&#x2F;admin，题目解决</p>
<h2 id="5、通过算法混淆（不暴露密钥）绕过-JWT-身份验证"><a href="#5、通过算法混淆（不暴露密钥）绕过-JWT-身份验证" class="headerlink" title="5、通过算法混淆（不暴露密钥）绕过 JWT 身份验证"></a>5、通过算法混淆（不暴露密钥）绕过 JWT 身份验证</h2><p><a target="_blank" rel="noopener" href="https://forum.butian.net/share/2734">https://forum.butian.net/share/2734</a></p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Sherlock</div><div class="post-copyright__author_desc">言念君子，温其如玉</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/10/08/JWT%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/10/08/JWT%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/')">JWT漏洞学习</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/10/08/JWT%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=JWT漏洞学习&amp;url=http://example.com/2024/10/08/JWT%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/09/20/test/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">test</div></div></a></div><div class="next-post pull-right"><a href="/2024/10/15/MoeCTF%E5%A4%8D%E7%9B%98/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">MoeCTF复盘</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" ait="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这里是我<b style="color:#fff">记录学习</b>收获的个人博客，<b style="color:#fff">也希望</b>能和大家一起<b style="color:#fff">进步</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">愿你可以在这里找到对你有<b style="color:#fff">帮助</b>的<b style="color:#fff">文章</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Sherlock</h1><div class="author-info__desc">言念君子，温其如玉</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/cina666" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>Announcement</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%80%9F%E9%89%B4"><span class="toc-number">1.</span> <span class="toc-text">借鉴</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JWT%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-number">2.</span> <span class="toc-text">JWT的组成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Header-%E9%83%A8%E5%88%86"><span class="toc-number">2.1.</span> <span class="toc-text">Header 部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Payload-%E9%83%A8%E5%88%86"><span class="toc-number">2.2.</span> <span class="toc-text">Payload 部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Signature-%E9%83%A8%E5%88%86"><span class="toc-number">2.3.</span> <span class="toc-text">Signature 部分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E7%9A%84JWT"><span class="toc-number">2.4.</span> <span class="toc-text">完整的JWT</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JWT%E5%90%8D%E8%AF%8D"><span class="toc-number">3.</span> <span class="toc-text">JWT名词</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%A3%E5%AF%86%E5%B9%B3%E5%8F%B0"><span class="toc-number">4.</span> <span class="toc-text">解密平台</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JWT-%E5%9F%BA%E7%A1%80%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98%EF%BC%88bp%E9%9D%B6%E5%9C%BA%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">JWT 基础安全问题（bp靶场）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E6%9C%AA%E5%AF%B9%E7%AD%BE%E5%90%8D%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81"><span class="toc-number">6.1.</span> <span class="toc-text">1、未对签名进行验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E6%9C%AA%E5%AF%B9%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95%E8%BF%9B%E8%A1%8C%E5%BC%BA%E9%AA%8C%E8%AF%81"><span class="toc-number">6.2.</span> <span class="toc-text">2、未对加密算法进行强验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E5%BC%B1%E5%AF%86%E9%92%A5"><span class="toc-number">6.3.</span> <span class="toc-text">3、弱密钥</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JWT%E6%A0%87%E5%A4%B4%E6%B3%A8%E5%85%A5"><span class="toc-number">7.</span> <span class="toc-text">JWT标头注入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E9%80%9A%E8%BF%87jwk%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5%E8%87%AA%E7%AD%BE%E5%90%8D%E7%9A%84JWT"><span class="toc-number">7.1.</span> <span class="toc-text">1、通过jwk参数注入自签名的JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">7.1.1.</span> <span class="toc-text">漏洞工作原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E8%BF%87%E7%A8%8B"><span class="toc-number">7.1.2.</span> <span class="toc-text">攻击过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE"><span class="toc-number">7.1.3.</span> <span class="toc-text">题目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E9%80%9A%E8%BF%87jku%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5%E8%87%AA%E7%AD%BE%E5%90%8D%E7%9A%84JWT"><span class="toc-number">7.2.</span> <span class="toc-text">2、通过jku参数注入自签名的JWT</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%88%90%E5%9B%A0"><span class="toc-number">7.2.1.</span> <span class="toc-text">漏洞成因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-1"><span class="toc-number">7.2.2.</span> <span class="toc-text">题目</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E9%80%9A%E8%BF%87-kid-%E6%B3%A8%E5%85%A5-JWT%EF%BC%8C%E4%B8%8E%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E6%94%BB%E5%87%BB%E7%9B%B8%E7%BB%93%E5%90%88"><span class="toc-number">7.3.</span> <span class="toc-text">3、通过 kid 注入 JWT，与目录遍历攻击相结合</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86"><span class="toc-number">7.3.1.</span> <span class="toc-text">攻击原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%94%BB%E5%87%BB%E6%B5%81%E7%A8%8B"><span class="toc-number">7.3.2.</span> <span class="toc-text">攻击流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A2%98%E7%9B%AE-2"><span class="toc-number">7.3.3.</span> <span class="toc-text">题目</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JWT%E7%AE%97%E6%B3%95%E6%B7%B7%E6%B7%86"><span class="toc-number">8.</span> <span class="toc-text">JWT算法混淆</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1%E3%80%81%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E4%B8%8E%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86"><span class="toc-number">8.1.</span> <span class="toc-text">1、对称加密与非对称加密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2%E3%80%81%E7%AE%97%E6%B3%95%E6%B7%B7%E6%B7%86%E6%BC%8F%E6%B4%9E%E4%BA%A7%E7%94%9F%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">8.2.</span> <span class="toc-text">2、算法混淆漏洞产生的原因</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E3%80%81%E6%89%A7%E8%A1%8C%E7%AE%97%E6%B3%95%E6%B7%B7%E6%B7%86%E6%94%BB%E5%87%BB%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-number">8.3.</span> <span class="toc-text">3、执行算法混淆攻击的步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4%E3%80%81%E9%80%9A%E8%BF%87%E7%AE%97%E6%B3%95%E6%B7%B7%E6%B7%86%EF%BC%88%E6%B3%84%E9%9C%B2%E4%BA%86%E5%AF%86%E9%92%A5%EF%BC%89%E7%BB%95%E8%BF%87-JWT-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">8.4.</span> <span class="toc-text">4、通过算法混淆（泄露了密钥）绕过 JWT 身份验证</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5%E3%80%81%E9%80%9A%E8%BF%87%E7%AE%97%E6%B3%95%E6%B7%B7%E6%B7%86%EF%BC%88%E4%B8%8D%E6%9A%B4%E9%9C%B2%E5%AF%86%E9%92%A5%EF%BC%89%E7%BB%95%E8%BF%87-JWT-%E8%BA%AB%E4%BB%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">8.5.</span> <span class="toc-text">5、通过算法混淆（不暴露密钥）绕过 JWT 身份验证</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/12/26/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BRMI%E4%B8%93%E9%A2%98/" title="java反序列化之RMI专题">java反序列化之RMI专题</a><time datetime="2024-12-26T08:41:11.000Z" title="Created 2024-12-26 16:41:11">2024-12-26</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/23/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8BCommonsBeanutils/" title="java反序列化之CommonsBeanutils">java反序列化之CommonsBeanutils</a><time datetime="2024-11-23T11:50:58.000Z" title="Created 2024-11-23 19:50:58">2024-11-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/21/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%B9%8Bshiro%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" title="java反序列化之shiro反序列化">java反序列化之shiro反序列化</a><time datetime="2024-11-21T06:44:38.000Z" title="Created 2024-11-21 14:44:38">2024-11-21</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/15/JavaDeserializeLabs/" title="JavaDeserializeLabs">JavaDeserializeLabs</a><time datetime="2024-11-15T07:36:32.000Z" title="Created 2024-11-15 15:36:32">2024-11-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/06/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" title="JDK动态代理">JDK动态代理</a><time datetime="2024-11-06T04:04:04.000Z" title="Created 2024-11-06 12:04:04">2024-11-06</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2025 By <a class="footer-bar-link" href="/" title="Sherlock" target="_blank">Sherlock</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">50</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">7</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/essay/"><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/cors/" style="font-size: 0.88rem;">cors<sup>1</sup></a><a href="/tags/csrf/" style="font-size: 0.88rem;">csrf<sup>1</sup></a><a href="/tags/php/" style="font-size: 0.88rem;">php<sup>5</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>3</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>3</sup></a><a href="/tags/ssrf/" style="font-size: 0.88rem;">ssrf<sup>1</sup></a><a href="/tags/ssti/" style="font-size: 0.88rem;">ssti<sup>2</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>3</sup></a><a href="/tags/xss/" style="font-size: 0.88rem;">xss<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 0.88rem;">前端<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("10/04/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Sherlock 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("10/04/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
      img.title = "下班了就该开开心心的玩耍，嘿嘿~";
      img.alt = "下班了就该开开心心的玩耍，嘿嘿~";

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>